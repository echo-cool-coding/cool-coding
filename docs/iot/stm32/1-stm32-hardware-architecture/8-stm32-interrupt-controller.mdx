---
title: STM32 中断控制器
description: 了解STM32微控制器中的中断控制器，掌握其工作原理、配置方法以及实际应用场景。
---

## 介绍

在嵌入式系统中，中断是一种重要的机制，它允许处理器在执行主程序的同时，响应外部或内部事件。STM32微控制器中的**中断控制器（NVIC, Nested Vectored Interrupt Controller）**负责管理和处理这些中断请求。通过中断，系统可以高效地处理实时事件，而不需要频繁地轮询外部设备的状态。

本文将详细介绍STM32中断控制器的工作原理、配置方法以及实际应用场景，帮助初学者快速掌握这一重要概念。

---

## 中断控制器的工作原理

STM32的中断控制器（NVIC）是一个高度可配置的硬件模块，它支持多达240个中断源，并且可以对这些中断进行优先级管理。NVIC的主要功能包括：

1. **中断优先级管理**：每个中断源都可以分配一个优先级，NVIC会根据优先级决定哪个中断先被处理。
2. **中断嵌套**：高优先级的中断可以打断低优先级的中断，从而实现中断嵌套。
3. **自动向量表跳转**：当发生中断时，NVIC会自动跳转到对应的中断服务程序（ISR）。

:::tip
中断优先级数值越小，优先级越高。例如，优先级为0的中断会比优先级为1的中断先被处理。
:::

---

## 配置STM32中断控制器

要使用STM32的中断功能，通常需要以下几个步骤：

1. **使能外设中断**：首先需要使能外设的中断功能。例如，如果使用GPIO引脚作为外部中断源，需要配置GPIO的中断模式。
2. **配置NVIC**：设置中断的优先级，并使能对应的中断通道。
3. **编写中断服务程序（ISR）**：在ISR中处理中断事件。

以下是一个简单的代码示例，展示了如何配置GPIO引脚作为外部中断源，并在中断发生时点亮LED。

```c
#include "stm32f4xx.h"

void EXTI0_IRQHandler(void) {
    if (EXTI_GetITStatus(EXTI_Line0) != RESET) {
        // 点亮LED
        GPIO_SetBits(GPIOD, GPIO_Pin_12);
        // 清除中断标志
        EXTI_ClearITPendingBit(EXTI_Line0);
    }
}

int main(void) {
    // 初始化GPIO引脚
    RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOD, ENABLE);
    GPIO_InitTypeDef GPIO_InitStruct;
    GPIO_InitStruct.GPIO_Pin = GPIO_Pin_12;
    GPIO_InitStruct.GPIO_Mode = GPIO_Mode_OUT;
    GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
    GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;
    GPIO_Init(GPIOD, &GPIO_InitStruct);

    // 配置外部中断
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_SYSCFG, ENABLE);
    SYSCFG_EXTILineConfig(EXTI_PortSourceGPIOA, EXTI_PinSource0);
    EXTI_InitTypeDef EXTI_InitStruct;
    EXTI_InitStruct.EXTI_Line = EXTI_Line0;
    EXTI_InitStruct.EXTI_Mode = EXTI_Mode_Interrupt;
    EXTI_InitStruct.EXTI_Trigger = EXTI_Trigger_Rising;
    EXTI_InitStruct.EXTI_LineCmd = ENABLE;
    EXTI_Init(&EXTI_InitStruct);

    // 配置NVIC
    NVIC_InitTypeDef NVIC_InitStruct;
    NVIC_InitStruct.NVIC_IRQChannel = EXTI0_IRQn;
    NVIC_InitStruct.NVIC_IRQChannelPreemptionPriority = 0;
    NVIC_InitStruct.NVIC_IRQChannelSubPriority = 0;
    NVIC_InitStruct.NVIC_IRQChannelCmd = ENABLE;
    NVIC_Init(&NVIC_InitStruct);

    while (1) {
        // 主循环
    }
}
```

:::note
在STM32中，每个外设的中断服务程序名称是固定的，例如`EXTI0_IRQHandler`用于处理GPIO引脚0的中断。
:::

---

## 实际应用场景

中断控制器在嵌入式系统中有着广泛的应用。以下是一些常见的应用场景：

1. **按键检测**：通过配置GPIO引脚为外部中断源，可以在按键按下时立即响应，而不需要轮询按键状态。
2. **定时器中断**：使用定时器中断可以定期执行某些任务，例如数据采集或系统状态更新。
3. **通信接口中断**：在UART、SPI、I2C等通信接口中，中断可以用于处理接收或发送完成事件。

---

## 总结

STM32的中断控制器（NVIC）是嵌入式系统中非常重要的一个模块，它能够高效地管理和处理多个中断源。通过合理配置中断优先级和编写中断服务程序，可以实现实时响应外部事件的功能。

:::caution
在使用中断时，务必确保中断服务程序的执行时间尽可能短，以避免影响其他中断的响应。
:::

---

## 附加资源与练习

1. **练习**：尝试配置一个定时器中断，每隔1秒钟点亮一次LED。
2. **参考文档**：STM32参考手册中的NVIC章节提供了更多关于中断控制器的详细信息。
3. **进阶学习**：了解如何使用DMA（直接内存访问）与中断结合，实现高效的数据传输。

希望本文能帮助你更好地理解STM32中断控制器的工作原理和应用方法。继续探索，你会发现嵌入式系统的更多奥秘！