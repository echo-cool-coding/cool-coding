---
title: STM32 复位系统
description: 了解STM32微控制器的复位系统，包括复位类型、复位源及其工作原理。本文适合初学者，包含代码示例和实际应用场景。
---

## 介绍

在嵌入式系统中，复位是一个关键的操作，它确保微控制器从一个已知的初始状态开始运行。STM32微控制器提供了多种复位机制，以确保系统在异常情况下能够恢复正常运行。本文将详细介绍STM32的复位系统，包括复位的类型、复位源以及如何在实际应用中使用这些复位机制。

## 复位类型

STM32微控制器支持以下几种复位类型：

1. **上电复位 (Power-on Reset, POR)**：当电源电压达到一定阈值时，系统会自动复位。
2. **外部复位 (External Reset)**：通过外部引脚（如NRST引脚）触发的复位。
3. **看门狗复位 (Watchdog Reset)**：当看门狗定时器超时且未被刷新时，系统会复位。
4. **软件复位 (Software Reset)**：通过软件指令触发的复位。
5. **低功耗模式复位 (Low-power Mode Reset)**：在低功耗模式下，某些复位源可能会被禁用或启用。

## 复位源

STM32的复位源可以分为以下几类：

- **电源复位**：包括上电复位和掉电复位。
- **外部复位**：通过NRST引脚触发的复位。
- **看门狗复位**：独立看门狗（IWDG）和窗口看门狗（WWDG）触发的复位。
- **软件复位**：通过设置控制寄存器中的复位位触发的复位。
- **低功耗模式复位**：在低功耗模式下触发的复位。

## 复位系统的工作原理

当复位发生时，STM32微控制器会执行以下操作：

1. **复位向量表**：处理器从复位向量表中读取初始堆栈指针（SP）和程序计数器（PC）的值。
2. **初始化**：处理器初始化寄存器、外设和时钟系统。
3. **执行主程序**：处理器开始执行主程序。

## 代码示例

以下是一个简单的代码示例，展示如何在STM32中使用软件复位：

```c
#include "stm32f4xx.h"

void software_reset(void) {
    // 设置控制寄存器中的复位位
    SCB->AIRCR = 0x05FA0004;
}

int main(void) {
    // 主程序逻辑
    while (1) {
        // 某些条件触发软件复位
        if (/* 某些条件 */) {
            software_reset();
        }
    }
}
```

在这个示例中，当满足某些条件时，程序会调用 `software_reset()` 函数，触发软件复位。

## 实际应用场景

### 1. 系统异常恢复

在嵌入式系统中，可能会遇到各种异常情况，如死循环、内存溢出等。通过配置看门狗定时器，可以在系统异常时自动复位，恢复系统正常运行。

### 2. 低功耗模式下的复位

在低功耗模式下，某些复位源可能会被禁用。通过合理配置复位源，可以确保系统在低功耗模式下仍然能够响应外部事件并恢复正常运行。

## 总结

STM32的复位系统是确保系统稳定运行的关键机制。通过了解不同的复位类型和复位源，开发者可以更好地设计和调试嵌入式系统。本文介绍了STM32的复位系统，并提供了代码示例和实际应用场景，帮助初学者更好地理解和应用这一概念。

## 附加资源与练习

- **练习1**：尝试在STM32开发板上实现一个看门狗复位机制，并观察系统在异常情况下的行为。
- **练习2**：研究STM32的低功耗模式，并尝试配置复位源以确保系统在低功耗模式下能够正常复位。

:::tip
建议初学者在开发过程中多使用调试工具，如ST-Link或J-Link，以便更好地观察和分析复位行为。
:::