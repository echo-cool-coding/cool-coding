---
title: STM32 电源模式
description: 了解STM32微控制器的电源模式，掌握如何在不同场景下优化功耗。
---

# STM32 电源模式

STM32微控制器提供了多种电源模式，以帮助开发者在不同应用场景下优化功耗。理解这些模式及其适用场景，对于设计低功耗嵌入式系统至关重要。

## 介绍

STM32的电源模式主要分为以下几种：

1. **运行模式（Run Mode）**
2. **睡眠模式（Sleep Mode）**
3. **停止模式（Stop Mode）**
4. **待机模式（Standby Mode）**
5. **关机模式（Shutdown Mode）**

每种模式都有不同的功耗特性和唤醒机制，适用于不同的应用场景。

## 运行模式（Run Mode）

在运行模式下，STM32的所有外设和内核都处于工作状态，功耗最高。这是最常见的模式，适用于需要高性能的场景。

```c
// 示例：进入运行模式
void enterRunMode() {
    // 默认情况下，STM32启动后即进入运行模式
}
```

## 睡眠模式（Sleep Mode）

睡眠模式下，CPU停止运行，但外设和内存仍然保持供电。可以通过中断或事件唤醒。

```c
// 示例：进入睡眠模式
void enterSleepMode() {
    __WFI(); // 等待中断
}
```

:::note
**注意**：在睡眠模式下，外设仍然可以工作，因此需要确保外设的配置不会导致不必要的功耗。
:::

## 停止模式（Stop Mode）

停止模式下，CPU和大部分外设都停止运行，只有少数低功耗外设保持工作状态。可以通过外部中断或RTC唤醒。

```c
// 示例：进入停止模式
void enterStopMode() {
    HAL_PWR_EnterSTOPMode(PWR_LOWPOWERREGULATOR_ON, PWR_STOPENTRY_WFI);
}
```

:::tip
**提示**：在停止模式下，可以通过配置低功耗稳压器进一步降低功耗。
:::

## 待机模式（Standby Mode）

待机模式下，CPU、外设和大部分内存都停止供电，只有备份域（如RTC和备份寄存器）保持供电。可以通过外部复位、RTC闹钟或WKUP引脚唤醒。

```c
// 示例：进入待机模式
void enterStandbyMode() {
    HAL_PWR_EnterSTANDBYMode();
}
```

:::caution
**警告**：在待机模式下，所有RAM和寄存器内容都会丢失，因此需要提前保存重要数据。
:::

## 关机模式（Shutdown Mode）

关机模式下，除了备份域外，所有电源都被切断，功耗最低。可以通过外部复位或WKUP引脚唤醒。

```c
// 示例：进入关机模式
void enterShutdownMode() {
    HAL_PWREx_EnterSHUTDOWNMode();
}
```

## 实际应用案例

### 案例1：低功耗传感器节点

在一个低功耗传感器节点中，STM32可以大部分时间处于停止模式，只有在传感器数据采集时短暂进入运行模式。这样可以显著降低整体功耗。

```c
void sensorNode() {
    while (1) {
        // 采集传感器数据
        collectSensorData();
        
        // 进入停止模式
        enterStopMode();
        
        // 等待唤醒
        __WFI();
    }
}
```

### 案例2：电池供电的远程控制器

在一个电池供电的远程控制器中，STM32可以大部分时间处于待机模式，只有在用户按下按钮时唤醒。这样可以延长电池寿命。

```c
void remoteController() {
    while (1) {
        // 进入待机模式
        enterStandbyMode();
        
        // 等待唤醒
        __WFI();
        
        // 处理按钮事件
        handleButtonPress();
    }
}
```

## 总结

STM32的电源模式为开发者提供了灵活的功耗管理选项。通过合理选择和使用这些模式，可以显著降低嵌入式系统的功耗，延长电池寿命，并提高系统的可靠性。

## 附加资源

- [STM32参考手册](https://www.st.com/resource/en/reference_manual/dm00031020-stm32f405-415-stm32f407-417-stm32f427-437-and-stm32f429-439-advanced-arm-based-32-bit-mcus-stmicroelectronics.pdf)
- [STM32低功耗模式应用笔记](https://www.st.com/resource/en/application_note/dm00105879-ultralowpower-mode-overview-for-stm32l4-series-stmicroelectronics.pdf)

## 练习

1. 编写一个程序，使STM32在采集温度传感器数据后进入停止模式，并通过RTC定时器每10秒唤醒一次。
2. 设计一个低功耗系统，使用待机模式并在按下按钮时唤醒，然后执行特定任务。

通过以上练习，你将更深入地理解STM32的电源模式及其应用。