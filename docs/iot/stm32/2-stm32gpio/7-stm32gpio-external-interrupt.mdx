---
title: STM32 GPIO外部中断
description: 学习如何在STM32微控制器中使用GPIO外部中断，掌握其基本原理、配置方法以及实际应用场景。
---

# STM32 GPIO外部中断

## 介绍

在嵌入式系统中，外部中断是一种非常重要的机制，它允许微控制器对外部事件（如按键按下、传感器触发等）做出快速响应。STM32微控制器提供了强大的GPIO外部中断功能，可以通过配置GPIO引脚来捕获外部信号的变化，并触发中断服务程序（ISR）来处理这些事件。

本文将详细介绍如何在STM32中使用GPIO外部中断，包括配置步骤、代码示例以及实际应用场景。

## GPIO外部中断的基本原理

STM32的GPIO引脚可以配置为输入模式，并且可以启用外部中断功能。当引脚的电平发生变化（如从高电平变为低电平，或从低电平变为高电平）时，微控制器会检测到这一变化，并触发相应的中断。

STM32的外部中断控制器（EXTI）负责管理这些中断。每个GPIO引脚都可以映射到EXTI线，EXTI线可以配置为上升沿触发、下降沿触发或双边沿触发。

## 配置GPIO外部中断

### 1. 配置GPIO引脚为输入模式

首先，需要将GPIO引脚配置为输入模式。以下是一个配置GPIO引脚为输入模式的示例代码：

```c
GPIO_InitTypeDef GPIO_InitStruct = {0};

// 使能GPIO时钟
__HAL_RCC_GPIOA_CLK_ENABLE();

// 配置GPIO引脚为输入模式
GPIO_InitStruct.Pin = GPIO_PIN_0;
GPIO_InitStruct.Mode = GPIO_MODE_INPUT;
GPIO_InitStruct.Pull = GPIO_NOPULL;
HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
```

### 2. 配置EXTI线

接下来，需要配置EXTI线，使其与GPIO引脚关联，并设置触发条件。以下是一个配置EXTI线的示例代码：

```c
// 配置EXTI线
__HAL_RCC_SYSCFG_CLK_ENABLE();
SYSCFG->EXTICR[0] |= SYSCFG_EXTICR1_EXTI0_PA;  // 将PA0映射到EXTI0

// 配置EXTI触发条件
EXTI->IMR |= EXTI_IMR_MR0;  // 使能EXTI0中断
EXTI->RTSR |= EXTI_RTSR_TR0;  // 设置上升沿触发
EXTI->FTSR |= EXTI_FTSR_TR0;  // 设置下降沿触发
```

### 3. 配置NVIC（嵌套向量中断控制器）

最后，需要配置NVIC，使能EXTI中断，并设置中断优先级。以下是一个配置NVIC的示例代码：

```c
// 配置NVIC
HAL_NVIC_SetPriority(EXTI0_IRQn, 0, 0);
HAL_NVIC_EnableIRQ(EXTI0_IRQn);
```

### 4. 编写中断服务程序（ISR）

当中断触发时，微控制器会跳转到中断服务程序（ISR）中执行相应的代码。以下是一个简单的中断服务程序示例：

```c
void EXTI0_IRQHandler(void) {
    // 清除中断标志
    EXTI->PR |= EXTI_PR_PR0;

    // 处理中断事件
    HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_5);  // 切换PA5引脚状态
}
```

## 实际应用场景

### 按键检测

一个常见的应用场景是使用外部中断来检测按键的按下和释放。通过配置GPIO引脚为输入模式，并启用外部中断，可以在按键按下或释放时触发中断，从而执行相应的操作。

### 传感器触发

另一个应用场景是使用外部中断来检测传感器的触发信号。例如，当传感器检测到某种条件时，会输出一个脉冲信号，通过配置外部中断，可以在信号到来时立即响应。

## 总结

通过本文的学习，你应该已经掌握了如何在STM32微控制器中使用GPIO外部中断。我们介绍了GPIO外部中断的基本原理、配置步骤，并提供了代码示例和实际应用场景。

外部中断是嵌入式系统中非常重要的功能，它可以帮助我们快速响应外部事件，提高系统的实时性和可靠性。

## 附加资源与练习

- **练习1**：尝试配置另一个GPIO引脚（如PA1）为外部中断输入，并在中断服务程序中点亮一个LED。
- **练习2**：修改代码，使外部中断仅在上升沿触发，并观察LED的行为变化。
- **参考文档**：STM32参考手册中的GPIO和EXTI章节，了解更多关于GPIO外部中断的详细信息。

:::tip
在实际项目中，建议使用HAL库或LL库来简化GPIO和EXTI的配置过程，这些库提供了更高层次的抽象，可以减少代码量并提高开发效率。
:::