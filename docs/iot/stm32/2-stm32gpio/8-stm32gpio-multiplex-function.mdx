---
title: STM32 GPIO复用功能
description: 了解STM32微控制器中GPIO的复用功能，掌握如何配置和使用复用功能以实现多种外设的灵活控制。
---

# STM32 GPIO复用功能

## 介绍

在STM32微控制器中，GPIO（通用输入输出）引脚不仅可以用于简单的数字输入输出，还可以通过**复用功能**（Alternate Function）连接到内部外设，如串口、SPI、I2C、定时器等。复用功能允许一个GPIO引脚在不同的时间或模式下执行不同的任务，从而提高了引脚的使用效率。

本文将详细介绍STM32GPIO的复用功能，包括其工作原理、配置方法以及实际应用案例。

---

## GPIO复用功能的工作原理

STM32的每个GPIO引脚都可以配置为以下几种模式之一：
- 输入模式
- 输出模式
- 复用功能模式
- 模拟模式

当GPIO引脚配置为**复用功能模式**时，引脚的行为将由内部外设控制，而不是直接由用户代码控制。例如，如果你将某个引脚配置为USART的TX引脚，那么该引脚将自动传输USART数据，而不需要手动设置引脚的高低电平。

### 复用功能的选择

每个GPIO引脚可以映射到多个复用功能，具体取决于芯片的型号和引脚布局。STM32的参考手册中通常会提供一个**复用功能映射表**，用于查看每个引脚支持的复用功能。

---

## 配置GPIO复用功能的步骤

以下是配置GPIO复用功能的基本步骤：

1. **启用GPIO时钟**：在使用GPIO之前，需要启用GPIO端口的时钟。
2. **配置GPIO模式**：将GPIO引脚配置为复用功能模式。
3. **选择复用功能**：通过AFR（Alternate Function Register）选择具体的复用功能。
4. **启用外设时钟**：启用与复用功能相关的外设时钟。
5. **配置外设**：根据外设的需求进行配置。

### 代码示例

以下是一个将PA9引脚配置为USART1_TX的示例代码：

```c
#include "stm32f4xx.h"

void GPIO_Config(void) {
    // 1. 启用GPIOA时钟
    RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);

    // 2. 配置PA9为复用功能模式
    GPIO_InitTypeDef GPIO_InitStruct;
    GPIO_InitStruct.GPIO_Pin = GPIO_Pin_9;
    GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF; // 复用功能模式
    GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;
    GPIO_InitStruct.GPIO_OType = GPIO_OType_PP; // 推挽输出
    GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_UP; // 上拉
    GPIO_Init(GPIOA, &GPIO_InitStruct);

    // 3. 选择USART1作为复用功能
    GPIO_PinAFConfig(GPIOA, GPIO_PinSource9, GPIO_AF_USART1);

    // 4. 启用USART1时钟
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1, ENABLE);

    // 5. 配置USART1
    USART_InitTypeDef USART_InitStruct;
    USART_InitStruct.USART_BaudRate = 9600;
    USART_InitStruct.USART_WordLength = USART_WordLength_8b;
    USART_InitStruct.USART_StopBits = USART_StopBits_1;
    USART_InitStruct.USART_Parity = USART_Parity_No;
    USART_InitStruct.USART_HardwareFlowControl = USART_HardwareFlowControl_None;
    USART_InitStruct.USART_Mode = USART_Mode_Tx;
    USART_Init(USART1, &USART_InitStruct);

    // 启用USART1
    USART_Cmd(USART1, ENABLE);
}
```

:::note
在代码中，`GPIO_PinAFConfig`函数用于选择具体的复用功能。`GPIO_AF_USART1`表示将引脚映射到USART1的复用功能。
:::

---

## 实际应用案例

### 案例1：使用USART进行串口通信

假设你需要通过USART1与PC进行串口通信。你可以将PA9配置为USART1_TX，PA10配置为USART1_RX。通过复用功能，这两个引脚将自动处理串口数据的发送和接收。

### 案例2：使用SPI连接外部设备

如果你需要连接一个SPI设备（如SD卡或传感器），可以将GPIO引脚配置为SPI的SCK、MISO、MOSI和NSS信号。通过复用功能，这些引脚将自动处理SPI通信。

---

## 总结

STM32的GPIO复用功能为开发者提供了极大的灵活性，使得单个引脚可以支持多种外设功能。通过合理配置复用功能，你可以充分利用STM32微控制器的资源，实现复杂的功能。

---

## 附加资源与练习

### 资源
- [STM32参考手册](https://www.st.com)：查找复用功能映射表和详细配置说明。
- [STM32CubeMX](https://www.st.com/en/development-tools/stm32cubemx.html)：使用图形化工具快速生成复用功能配置代码。

### 练习
1. 将PA5引脚配置为SPI1的SCK信号，并尝试与SPI设备通信。
2. 将PB6和PB7引脚配置为I2C1的SCL和SDA信号，并尝试与I2C设备通信。

通过实践，你将更深入地理解STM32GPIO复用功能的强大之处！