---
title: STM32 GPIO中断配置
description: 本教程将详细介绍如何在STM32微控制器中配置GPIO中断，适合初学者学习。内容包括中断的基本概念、配置步骤、代码示例以及实际应用场景。
---

# STM32 GPIO中断配置

## 介绍

在嵌入式系统中，中断是一种非常重要的机制，它允许微控制器在特定事件发生时立即响应，而不需要持续轮询。STM32微控制器的GPIO（通用输入输出）模块支持中断功能，可以在引脚状态发生变化时触发中断，从而执行相应的处理程序。

本文将逐步讲解如何在STM32中配置GPIO中断，并通过代码示例和实际应用场景帮助你理解这一概念。

## GPIO中断的基本概念

GPIO中断是指当GPIO引脚的电平状态发生变化时（例如从高电平变为低电平，或从低电平变为高电平），微控制器会立即暂停当前的任务，转而执行一个特定的中断服务程序（ISR）。这种机制非常适合用于处理实时性要求较高的任务，例如按键检测、传感器信号采集等。

STM32的GPIO中断可以分为两种模式：
- **上升沿触发**：当引脚电平从低变高时触发中断。
- **下降沿触发**：当引脚电平从高变低时触发中断。

## 配置GPIO中断的步骤

### 1. 启用GPIO时钟
首先，需要启用GPIO端口的时钟。STM32的每个外设都需要通过RCC（复位和时钟控制）模块来启用时钟。

```c
RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);
```

### 2. 配置GPIO引脚为输入模式
接下来，需要将GPIO引脚配置为输入模式，并选择中断触发方式（上升沿或下降沿）。

```c
GPIO_InitTypeDef GPIO_InitStruct;
GPIO_InitStruct.GPIO_Pin = GPIO_Pin_0;
GPIO_InitStruct.GPIO_Mode = GPIO_Mode_IPU;  // 上拉输入
GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;
GPIO_Init(GPIOA, &GPIO_InitStruct);
```

### 3. 配置中断线
STM32的GPIO中断通过EXTI（外部中断）模块实现。需要将GPIO引脚与EXTI线关联，并配置中断触发条件。

```c
GPIO_EXTILineConfig(GPIO_PortSourceGPIOA, GPIO_PinSource0);
EXTI_InitTypeDef EXTI_InitStruct;
EXTI_InitStruct.EXTI_Line = EXTI_Line0;
EXTI_InitStruct.EXTI_Mode = EXTI_Mode_Interrupt;
EXTI_InitStruct.EXTI_Trigger = EXTI_Trigger_Rising;  // 上升沿触发
EXTI_InitStruct.EXTI_LineCmd = ENABLE;
EXTI_Init(&EXTI_InitStruct);
```

### 4. 配置NVIC（嵌套向量中断控制器）
NVIC负责管理中断优先级和使能中断。需要配置NVIC以使能EXTI中断。

```c
NVIC_InitTypeDef NVIC_InitStruct;
NVIC_InitStruct.NVIC_IRQChannel = EXTI0_IRQn;
NVIC_InitStruct.NVIC_IRQChannelPreemptionPriority = 0;
NVIC_InitStruct.NVIC_IRQChannelSubPriority = 0;
NVIC_InitStruct.NVIC_IRQChannelCmd = ENABLE;
NVIC_Init(&NVIC_InitStruct);
```

### 5. 编写中断服务程序（ISR）
最后，需要编写中断服务程序来处理中断事件。中断服务程序的名称是固定的，可以在STM32的启动文件中找到。

```c
void EXTI0_IRQHandler(void) {
    if (EXTI_GetITStatus(EXTI_Line0) != RESET) {
        // 处理中断事件
        EXTI_ClearITPendingBit(EXTI_Line0);  // 清除中断标志
    }
}
```

## 实际应用场景

### 按键检测
假设你有一个按键连接到GPIOA的引脚0，并且希望在按键按下时（引脚电平从高变低）触发中断。你可以按照上述步骤配置GPIO中断，并在中断服务程序中执行相应的操作，例如点亮LED或发送消息。

```c
void EXTI0_IRQHandler(void) {
    if (EXTI_GetITStatus(EXTI_Line0) != RESET) {
        GPIO_WriteBit(GPIOB, GPIO_Pin_5, (BitAction)(1 - GPIO_ReadOutputDataBit(GPIOB, GPIO_Pin_5)));  // 切换LED状态
        EXTI_ClearITPendingBit(EXTI_Line0);  // 清除中断标志
    }
}
```

### 传感器信号采集
如果你有一个传感器输出信号连接到GPIO引脚，并且希望在信号变化时立即采集数据，GPIO中断也是一个很好的选择。你可以在中断服务程序中读取传感器数据，并进行进一步的处理。

## 总结

通过本文，你应该已经掌握了如何在STM32中配置GPIO中断。GPIO中断是嵌入式系统中非常常用的功能，能够有效提高系统的实时性和响应速度。希望你能通过本文的学习，在实际项目中灵活运用这一技术。

## 附加资源与练习

- **练习1**：尝试配置一个下降沿触发的中断，并在中断服务程序中打印一条消息。
- **练习2**：将两个按键分别连接到不同的GPIO引脚，并配置不同的中断优先级，观察中断的执行顺序。
- **参考文档**：STM32参考手册中的GPIO和EXTI章节。

:::tip
如果你在配置过程中遇到问题，可以参考STM32的官方文档或社区论坛，那里有丰富的资源和经验分享。
:::