---
title: STM32 WiFi基础
description: 学习如何在STM32微控制器上实现WiFi通信的基础知识，包括硬件连接、软件配置和实际应用案例。
---

# STM32 WiFi基础

## 介绍

WiFi通信是现代嵌入式系统中非常重要的一部分，它允许设备通过无线网络连接到互联网或其他设备。STM32微控制器系列提供了多种支持WiFi通信的模块和库，使得开发者可以轻松实现无线连接功能。本文将介绍如何在STM32上实现WiFi通信的基础知识，包括硬件连接、软件配置以及实际应用案例。

## 硬件准备

在开始之前，你需要准备以下硬件：

- STM32开发板（如STM32F4 Discovery或STM32H7 Nucleo）
- WiFi模块（如ESP8266或ESP32）
- 杜邦线若干
- 电源适配器

### 连接WiFi模块

将WiFi模块与STM32开发板连接。以ESP8266为例，连接方式如下：

- ESP8266的`VCC`引脚连接到STM32的`3.3V`引脚
- ESP8266的`GND`引脚连接到STM32的`GND`引脚
- ESP8266的`TX`引脚连接到STM32的`RX`引脚
- ESP8266的`RX`引脚连接到STM32的`TX`引脚

:::note
确保WiFi模块的电压与STM32开发板的电压匹配，通常为3.3V。
:::

## 软件配置

### 安装必要的库

在STM32CubeIDE中，你需要安装支持WiFi通信的库。以HAL库为例，你可以通过STM32CubeMX来配置和生成初始化代码。

1. 打开STM32CubeMX，选择你的STM32开发板型号。
2. 在`Pinout & Configuration`选项卡中，启用USART或UART接口，用于与WiFi模块通信。
3. 在`Middleware`选项卡中，启用`FreeRTOS`（可选）和`LWIP`（用于TCP/IP协议栈）。
4. 生成代码并导入到STM32CubeIDE中。

### 初始化WiFi模块

在生成的代码中，找到`main.c`文件，并在`main`函数中添加WiFi模块的初始化代码。

```c
#include "stm32f4xx_hal.h"
#include "esp8266.h"

int main(void) {
  HAL_Init();
  SystemClock_Config();
  MX_USART2_UART_Init();  // 初始化USART2

  ESP8266_Init();  // 初始化ESP8266模块

  while (1) {
    // 主循环
  }
}
```

### 配置WiFi连接

在`esp8266.c`文件中，编写代码以配置WiFi连接。

```c
void ESP8266_Init(void) {
  ESP8266_SendCommand("AT\r\n");  // 测试AT指令
  HAL_Delay(1000);

  ESP8266_SendCommand("AT+CWMODE=1\r\n");  // 设置WiFi模式为Station模式
  HAL_Delay(1000);

  ESP8266_SendCommand("AT+CWJAP=\"Your_SSID\",\"Your_PASSWORD\"\r\n");  // 连接WiFi网络
  HAL_Delay(5000);

  ESP8266_SendCommand("AT+CIFSR\r\n");  // 获取IP地址
  HAL_Delay(1000);
}
```

:::tip
确保将`Your_SSID`和`Your_PASSWORD`替换为你的WiFi网络的SSID和密码。
:::

## 实际应用案例

### 远程控制LED

假设你想通过WiFi远程控制STM32开发板上的LED灯。你可以使用TCP服务器来实现这一功能。

1. 在STM32上创建一个TCP服务器，监听来自客户端的连接。
2. 当客户端发送`ON`命令时，点亮LED；发送`OFF`命令时，关闭LED。

```c
void TCP_Server_Init(void) {
  ESP8266_SendCommand("AT+CIPMUX=1\r\n");  // 启用多连接模式
  HAL_Delay(1000);

  ESP8266_SendCommand("AT+CIPSERVER=1,80\r\n");  // 创建TCP服务器，端口80
  HAL_Delay(1000);
}

void Process_Client_Command(char* command) {
  if (strcmp(command, "ON") == 0) {
    HAL_GPIO_WritePin(GPIOA, GPIO_PIN_5, GPIO_PIN_SET);  // 点亮LED
  } else if (strcmp(command, "OFF") == 0) {
    HAL_GPIO_WritePin(GPIOA, GPIO_PIN_5, GPIO_PIN_RESET);  // 关闭LED
  }
}
```

:::caution
在实际应用中，确保处理网络连接中的异常情况，如断开连接或命令错误。
:::

## 总结

通过本文，你学习了如何在STM32微控制器上实现WiFi通信的基础知识。我们介绍了硬件连接、软件配置以及一个简单的远程控制LED的实际应用案例。希望这些内容能帮助你更好地理解STM32WiFi通信的实现过程。

## 附加资源与练习

- **练习1**：尝试使用ESP32模块替代ESP8266，并比较两者的性能差异。
- **练习2**：扩展远程控制LED的案例，实现更多功能，如读取传感器数据并通过WiFi发送到服务器。
- **资源**：参考[STM32官方文档](https://www.st.com)和[ESP8266 AT指令集](https://www.espressif.com)以获取更多详细信息。

祝你学习愉快！