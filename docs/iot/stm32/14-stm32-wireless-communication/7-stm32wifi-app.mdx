---
title: STM32 WiFi 应用
description: 本教程将介绍如何在 STM32 微控制器上实现 WiFi 通信，涵盖基础概念、代码示例和实际应用场景，适合初学者学习。
---

# STM32 WiFi 应用

## 介绍

WiFi 是一种广泛使用的无线通信技术，允许设备通过无线网络连接到互联网或局域网。STM32 微控制器通过集成 WiFi 模块或外部 WiFi 模块（如 ESP8266 或 ESP32）可以实现 WiFi 通信。本教程将引导你了解如何在 STM32 上实现 WiFi 连接，并展示一些实际应用场景。

:::note
STM32 本身通常不直接集成 WiFi 模块，因此需要使用外部 WiFi 模块或带有 WiFi 功能的 STM32 系列（如 STM32WB 系列）。
:::

## 基础概念

### 1. WiFi 通信的基本原理
WiFi 通信基于 IEEE 802.11 标准，工作在 2.4GHz 或 5GHz 频段。设备通过接入点（AP）连接到网络，并与其他设备进行数据交换。

### 2. STM32 与 WiFi 模块的通信方式
STM32 通常通过 UART、SPI 或 I2C 接口与外部 WiFi 模块通信。常见的 WiFi 模块包括 ESP8266 和 ESP32，它们支持 AT 指令或更高级的协议栈（如 LWIP）。

## 硬件准备

- STM32 开发板（如 STM32F4 Discovery）
- WiFi 模块（如 ESP8266）
- 连接线（UART 或 SPI）
- 电源和必要的电阻/电容

## 软件准备

- STM32CubeMX：用于配置 STM32 的外设。
- STM32 HAL 库：提供硬件抽象层，简化开发。
- WiFi 模块的固件或 AT 指令集。

## 代码示例：使用 ESP8266 实现 WiFi 连接

以下是一个简单的示例，展示如何使用 STM32 通过 UART 与 ESP8266 通信，连接到 WiFi 网络并发送 HTTP 请求。

### 1. 配置 UART
使用 STM32CubeMX 配置 UART 外设，并生成初始化代码。

```c
UART_HandleTypeDef huart2;

void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_USART2_UART_Init(void);

int main(void) {
  HAL_Init();
  SystemClock_Config();
  MX_GPIO_Init();
  MX_USART2_UART_Init();

  // 发送 AT 指令测试 ESP8266
  const char* atCommand = "AT\r\n";
  HAL_UART_Transmit(&huart2, (uint8_t*)atCommand, strlen(atCommand), HAL_MAX_DELAY);

  // 等待响应
  uint8_t response[100];
  HAL_UART_Receive(&huart2, response, sizeof(response), HAL_MAX_DELAY);
  printf("Response: %s\n", response);

  while (1) {
    // 主循环
  }
}
```

### 2. 连接到 WiFi 网络
发送 AT 指令连接到 WiFi 网络。

```c
const char* wifiConnectCommand = "AT+CWJAP=\"YourSSID\",\"YourPassword\"\r\n";
HAL_UART_Transmit(&huart2, (uint8_t*)wifiConnectCommand, strlen(wifiConnectCommand), HAL_MAX_DELAY);

// 等待连接成功响应
HAL_UART_Receive(&huart2, response, sizeof(response), HAL_MAX_DELAY);
printf("WiFi Connection Response: %s\n", response);
```

### 3. 发送 HTTP 请求
连接到服务器并发送 HTTP GET 请求。

```c
const char* httpGetCommand = "AT+CIPSTART=\"TCP\",\"example.com\",80\r\n";
HAL_UART_Transmit(&huart2, (uint8_t*)httpGetCommand, strlen(httpGetCommand), HAL_MAX_DELAY);

// 等待连接成功
HAL_UART_Receive(&huart2, response, sizeof(response), HAL_MAX_DELAY);
printf("TCP Connection Response: %s\n", response);

// 发送 HTTP GET 请求
const char* httpRequest = "GET / HTTP/1.1\r\nHost: example.com\r\n\r\n";
HAL_UART_Transmit(&huart2, (uint8_t*)httpRequest, strlen(httpRequest), HAL_MAX_DELAY);

// 接收服务器响应
HAL_UART_Receive(&huart2, response, sizeof(response), HAL_MAX_DELAY);
printf("HTTP Response: %s\n", response);
```

## 实际应用场景

### 1. 智能家居控制
通过 WiFi，STM32 可以连接到家庭网络，并控制智能设备（如灯光、温度传感器等）。例如，STM32 可以通过 HTTP 请求向服务器发送数据，或接收来自手机 App 的控制指令。

### 2. 远程数据采集
STM32 可以连接到云平台，定期上传传感器数据（如温度、湿度等）。例如，使用 MQTT 协议将数据发送到 AWS IoT 或 Azure IoT Hub。

### 3. 无线固件更新
通过 WiFi，STM32 可以连接到服务器并下载最新的固件，实现远程更新功能。

## 总结

本教程介绍了如何在 STM32 上实现 WiFi 通信，包括硬件配置、代码示例和实际应用场景。通过学习这些内容，你可以将 STM32 与 WiFi 模块结合，开发出功能丰富的物联网设备。

:::tip
如果你对 WiFi 通信感兴趣，可以进一步学习 TCP/IP 协议栈、MQTT 协议或 WebSocket 通信。
:::

## 附加资源

- [ESP8266 AT 指令集文档](https://www.espressif.com/sites/default/files/documentation/4a-esp8266_at_instruction_set_en.pdf)
- [STM32CubeMX 用户手册](https://www.st.com/resource/en/user_manual/dm00104712-stm32cubemx-for-stm32-configuration-and-initialization-c-code-generation-stmicroelectronics.pdf)
- [MQTT 协议入门指南](https://mqtt.org/documentation)

## 练习

1. 修改代码，使其能够连接到你的家庭 WiFi 网络。
2. 尝试使用 MQTT 协议将 STM32 连接到云平台，并发送传感器数据。
3. 实现一个简单的 Web 服务器，通过 WiFi 控制 STM32 上的 LED。

祝你学习愉快！