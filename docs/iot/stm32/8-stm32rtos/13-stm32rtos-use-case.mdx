---
title: STM32 RTOS应用案例
description: 本文介绍了STM32RTOS的基本概念及其在实际应用中的案例，帮助初学者理解如何使用RTOS进行嵌入式开发。
---

# STM32 RTOS应用案例

## 介绍

实时操作系统（RTOS）是一种专门为实时应用设计的操作系统，能够在严格的时间限制内完成任务。STM32RTOS是基于STM32微控制器的RTOS实现，广泛应用于嵌入式系统中。本文将介绍STM32RTOS的基本概念，并通过实际案例展示其应用。

## STM32 RTOS基本概念

### 任务（Task）

任务是RTOS中的基本执行单元。每个任务都有自己的堆栈和优先级，RTOS调度器根据任务的优先级来决定哪个任务应该运行。

```c
void vTaskFunction(void *pvParameters) {
    for (;;) {
        // 任务代码
    }
}
```

### 信号量（Semaphore）

信号量用于任务间的同步和互斥。常见的信号量类型包括二进制信号量和计数信号量。

```c
SemaphoreHandle_t xSemaphore = xSemaphoreCreateBinary();
```

### 队列（Queue）

队列用于任务间的数据传输。任务可以将数据发送到队列，其他任务可以从队列中接收数据。

```c
QueueHandle_t xQueue = xQueueCreate(10, sizeof(int));
```

### 定时器（Timer）

定时器用于在指定时间后执行某个任务或函数。

```c
TimerHandle_t xTimer = xTimerCreate("Timer", pdMS_TO_TICKS(1000), pdTRUE, 0, vTimerCallback);
```

## 实际应用案例

### 案例1：多任务LED控制

在这个案例中，我们将使用STM32RTOS控制两个LED灯，每个LED灯由一个独立的任务控制。

```c
void vTaskLED1(void *pvParameters) {
    for (;;) {
        HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_5);
        vTaskDelay(pdMS_TO_TICKS(500));
    }
}

void vTaskLED2(void *pvParameters) {
    for (;;) {
        HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_6);
        vTaskDelay(pdMS_TO_TICKS(1000));
    }
}

int main(void) {
    HAL_Init();
    SystemClock_Config();
    MX_GPIO_Init();

    xTaskCreate(vTaskLED1, "LED1", configMINIMAL_STACK_SIZE, NULL, 1, NULL);
    xTaskCreate(vTaskLED2, "LED2", configMINIMAL_STACK_SIZE, NULL, 1, NULL);

    vTaskStartScheduler();

    for (;;);
}
```

### 案例2：任务间通信

在这个案例中，我们将使用队列在两个任务之间传递数据。

```c
QueueHandle_t xQueue;

void vTaskSender(void *pvParameters) {
    int iValueToSend = 0;
    for (;;) {
        iValueToSend++;
        xQueueSend(xQueue, &iValueToSend, portMAX_DELAY);
        vTaskDelay(pdMS_TO_TICKS(1000));
    }
}

void vTaskReceiver(void *pvParameters) {
    int iReceivedValue;
    for (;;) {
        if (xQueueReceive(xQueue, &iReceivedValue, portMAX_DELAY) == pdPASS) {
            // 处理接收到的数据
        }
    }
}

int main(void) {
    HAL_Init();
    SystemClock_Config();

    xQueue = xQueueCreate(10, sizeof(int));

    xTaskCreate(vTaskSender, "Sender", configMINIMAL_STACK_SIZE, NULL, 1, NULL);
    xTaskCreate(vTaskReceiver, "Receiver", configMINIMAL_STACK_SIZE, NULL, 1, NULL);

    vTaskStartScheduler();

    for (;;);
}
```

## 总结

STM32RTOS为嵌入式系统提供了强大的任务管理、同步和通信机制。通过本文的介绍和案例，初学者可以理解如何使用STM32RTOS进行多任务编程和任务间通信。希望这些内容能够帮助你在嵌入式开发中更好地应用RTOS。

## 附加资源

- [FreeRTOS官方文档](https://www.freertos.org/Documentation)
- [STM32CubeMX配置RTOS教程](https://www.st.com/en/development-tools/stm32cubemx.html)

## 练习

1. 修改案例1中的代码，使LED1和LED2以不同的频率闪烁。
2. 在案例2中，增加一个任务，将接收到的数据通过串口发送出去。
