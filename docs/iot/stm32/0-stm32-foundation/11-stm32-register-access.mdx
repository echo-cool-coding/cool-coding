---
title: STM32 寄存器访问
description: 了解如何在STM32微控制器中直接访问寄存器，掌握底层硬件控制的基础知识。
---

## 介绍

在STM32微控制器编程中，寄存器是直接与硬件交互的关键。寄存器是位于微控制器内存中的特殊存储单元，用于控制和配置外设（如GPIO、定时器、UART等）。通过直接访问寄存器，开发者可以精确控制硬件的每一个细节，从而实现高效、灵活的嵌入式系统设计。

本文将逐步介绍如何访问STM32的寄存器，并通过实际案例展示其应用场景。

## 寄存器基础

### 什么是寄存器？

寄存器是微控制器内部的一种特殊存储单元，用于存储配置、状态和控制信息。每个寄存器通常由多个位组成，每个位对应一个特定的功能。例如，GPIO端口的数据寄存器（GPIOx_ODR）用于控制输出引脚的状态。

### 寄存器的地址

每个寄存器都有一个唯一的地址，开发者可以通过这个地址访问寄存器。STM32的寄存器地址通常定义在芯片的数据手册中。例如，GPIOA的ODR寄存器的地址可能是 `0x40020014`。

### 访问寄存器的方式

在C语言中，可以通过指针来访问寄存器。例如，要访问GPIOA的ODR寄存器，可以使用以下代码：

```c
#define GPIOA_ODR (*(volatile unsigned int*)0x40020014)
```

这里，`volatile` 关键字告诉编译器不要优化这个变量，因为它可能会被硬件改变。

## 代码示例

### 示例1：点亮LED

假设我们有一个LED连接到GPIOA的第5引脚。我们可以通过设置GPIOA的ODR寄存器来点亮LED。

```c
#define GPIOA_ODR (*(volatile unsigned int*)0x40020014)

void main(void) {
    // 设置GPIOA的第5位为1，点亮LED
    GPIOA_ODR |= (1 << 5);
}
```

### 示例2：读取按钮状态

假设我们有一个按钮连接到GPIOA的第0引脚。我们可以通过读取GPIOA的IDR寄存器来获取按钮的状态。

```c
#define GPIOA_IDR (*(volatile unsigned int*)0x40020010)

void main(void) {
    // 读取GPIOA的第0位，判断按钮是否按下
    if (GPIOA_IDR & (1 << 0)) {
        // 按钮按下
    } else {
        // 按钮未按下
    }
}
```

## 实际应用场景

### 场景1：配置定时器

在STM32中，定时器的配置通常涉及多个寄存器。例如，配置TIM2定时器的预分频器和自动重装载寄存器：

```c
#define TIM2_PSC (*(volatile unsigned int*)0x40000028)
#define TIM2_ARR (*(volatile unsigned int*)0x4000002C)

void configure_timer(void) {
    // 设置预分频器为1000
    TIM2_PSC = 1000;
    // 设置自动重装载寄存器为50000
    TIM2_ARR = 50000;
}
```

### 场景2：配置UART

配置UART的波特率寄存器（BRR）和数据寄存器（DR）：

```c
#define USART1_BRR (*(volatile unsigned int*)0x40013808)
#define USART1_DR (*(volatile unsigned int*)0x40013804)

void configure_uart(void) {
    // 设置波特率为9600
    USART1_BRR = 0x341;
    // 发送字符 'A'
    USART1_DR = 'A';
}
```

## 总结

通过直接访问STM32的寄存器，开发者可以实现对硬件的精确控制。本文介绍了寄存器的基础知识、访问方法以及实际应用场景。掌握寄存器访问是嵌入式系统开发的重要技能，希望本文能帮助你更好地理解这一概念。

## 附加资源

- [STM32参考手册](https://www.st.com/resource/en/reference_manual/dm00031020-stm32f405-415-stm32f407-417-stm32f427-437-and-stm32f429-439-advanced-arm-based-32-bit-mcus-stmicroelectronics.pdf)
- [STM32 HAL库文档](https://www.st.com/en/embedded-software/stm32cube-mcu-packages.html)

## 练习

1. 编写代码，配置GPIOB的第3引脚为输出，并交替点亮和熄灭LED。
2. 编写代码，读取GPIOC的第7引脚状态，并根据状态控制GPIOB的第3引脚。

:::tip
在编写寄存器访问代码时，务必参考芯片的数据手册，确保寄存器的地址和位定义正确。
:::