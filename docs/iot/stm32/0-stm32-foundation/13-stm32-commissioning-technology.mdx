---
title: STM32 调试技术
description: 学习如何使用调试工具和技术来调试STM32微控制器，包括断点、单步执行、变量监视等基本调试方法。
---

# STM32 调试技术

调试是嵌入式开发中不可或缺的一部分，尤其是在使用STM32这样的微控制器时。调试技术可以帮助开发者快速定位和修复代码中的错误，优化程序性能。本文将介绍STM32调试的基础知识，包括常用的调试工具和技术，并通过实际案例展示如何应用这些技术。

## 什么是调试？

调试是指在程序运行过程中，通过工具和技术手段来检测、定位和修复代码中的错误。对于STM32微控制器，调试通常涉及使用硬件调试器（如ST-Link）和软件工具（如STM32CubeIDE）来监控程序的执行状态。

## 调试工具

### 1. ST-Link调试器

ST-Link是STMicroelectronics官方提供的调试工具，支持STM32系列微控制器的调试和编程。它可以通过SWD（Serial Wire Debug）接口与STM32微控制器通信。

### 2. STM32CubeIDE

STM32CubeIDE是STMicroelectronics提供的集成开发环境（IDE），集成了调试功能。它支持断点设置、单步执行、变量监视等调试功能。

## 基本调试技术

### 1. 断点（Breakpoints）

断点是调试中最常用的技术之一。通过在代码中设置断点，程序会在执行到该处时暂停，开发者可以检查当前的程序状态。

```c
int main(void) {
    int a = 10;
    int b = 20;
    int c = a + b;  // 在此处设置断点
    return 0;
}
```

在STM32CubeIDE中，你可以通过点击代码行号左侧的空白区域来设置断点。当程序运行到断点时，程序会暂停，你可以查看变量的值、寄存器的状态等信息。

### 2. 单步执行（Step Over/Step Into）

单步执行允许你逐行执行代码，观察每一步的执行结果。`Step Over`会执行当前行并跳到下一行，而`Step Into`会进入函数内部执行。

```c
void add(int x, int y) {
    int result = x + y;
}

int main(void) {
    int a = 10;
    int b = 20;
    add(a, b);  // 使用Step Into进入add函数
    return 0;
}
```

### 3. 变量监视（Watch）

变量监视功能允许你在程序运行时实时查看变量的值。这对于跟踪变量的变化非常有用。

```c
int main(void) {
    int a = 10;
    int b = 20;
    int c = a + b;  // 在此处监视变量c的值
    return 0;
}
```

在STM32CubeIDE中，你可以通过`Expressions`窗口添加需要监视的变量。

## 实际案例

### 案例：调试LED闪烁程序

假设我们有一个简单的LED闪烁程序，但LED没有按预期闪烁。我们可以通过调试技术来定位问题。

```c
#include "stm32f4xx.h"

void delay(volatile uint32_t count) {
    while(count--);
}

int main(void) {
    RCC->AHB1ENR |= RCC_AHB1ENR_GPIODEN;  // 使能GPIOD时钟
    GPIOD->MODER |= GPIO_MODER_MODER12_0;  // 设置PD12为输出模式

    while(1) {
        GPIOD->ODR ^= GPIO_ODR_OD12;  // 切换PD12状态
        delay(1000000);  // 延时
    }
}
```

1. **设置断点**：在`GPIOD->ODR ^= GPIO_ODR_OD12;`这一行设置断点。
2. **单步执行**：使用`Step Over`逐行执行代码，观察`GPIOD->ODR`的值是否按预期变化。
3. **变量监视**：监视`GPIOD->ODR`的值，确保LED状态正确切换。

通过调试，我们发现`delay`函数的延时时间可能不够，导致LED闪烁过快。我们可以调整`delay`函数的参数来解决问题。

## 总结

调试是嵌入式开发中不可或缺的技能。通过使用断点、单步执行和变量监视等调试技术，开发者可以快速定位和修复代码中的错误。STM32CubeIDE和ST-Link调试器为STM32微控制器的调试提供了强大的支持。

## 附加资源

- [STM32CubeIDE用户手册](https://www.st.com/en/development-tools/stm32cubeide.html)
- [ST-Link调试器文档](https://www.st.com/en/development-tools/st-link-v2.html)

## 练习

1. 编写一个简单的STM32程序，使用调试技术检查变量的值。
2. 尝试在STM32CubeIDE中设置断点并单步执行代码，观察程序的执行流程。
3. 修改一个现有的STM32程序，使用调试技术定位并修复一个错误。
