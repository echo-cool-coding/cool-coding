---
title: STM32 随机数生成器
description: 了解STM32微控制器中的随机数生成器（RNG）功能，学习如何使用它生成随机数，并探索其在实际应用中的使用场景。
---

# STM32 随机数生成器

## 介绍

随机数在嵌入式系统中有着广泛的应用，例如加密、安全认证、随机化算法等。STM32微控制器内置了一个硬件随机数生成器（RNG），能够生成高质量的随机数。本文将详细介绍STM32的RNG功能，并通过代码示例展示如何使用它。

## STM32 随机数生成器的工作原理

STM32的RNG基于模拟噪声源生成随机数。它通过采样模拟噪声信号并将其转换为数字值来生成随机数。由于噪声源是物理现象，因此生成的随机数具有较高的熵值，适合用于加密和安全相关的应用。

:::note
STM32的RNG符合NIST SP 800-90A标准，确保了生成的随机数具有较高的质量。
:::

## 启用和配置RNG

在使用RNG之前，需要先启用并配置它。以下是启用RNG的步骤：

1. **启用RNG时钟**：RNG外设的时钟需要通过RCC（复位和时钟控制）寄存器来启用。
2. **配置RNG**：RNG的配置相对简单，通常只需要启用它即可。
3. **读取随机数**：一旦RNG启用，就可以通过读取数据寄存器来获取随机数。

### 代码示例

以下是一个简单的代码示例，展示了如何在STM32中启用RNG并生成随机数。

```c
#include "stm32f4xx.h"  // 根据你的STM32系列选择合适的头文件

void RNG_Init(void) {
    // 启用RNG时钟
    RCC_AHB2PeriphClockCmd(RCC_AHB2Periph_RNG, ENABLE);

    // 启用RNG
    RNG_Cmd(ENABLE);
}

uint32_t RNG_GetRandomNumber(void) {
    // 等待随机数就绪
    while (RNG_GetFlagStatus(RNG_FLAG_DRDY) == RESET);

    // 返回随机数
    return RNG_GetRandomNumber();
}

int main(void) {
    RNG_Init();

    while (1) {
        uint32_t randomNumber = RNG_GetRandomNumber();
        // 使用随机数
    }
}
```

### 输入和输出

- **输入**：无
- **输出**：一个32位的随机数

## 实际应用场景

### 1. 加密和安全

随机数在加密算法中扮演着重要角色。例如，在生成加密密钥或初始化向量（IV）时，需要使用高质量的随机数。STM32的RNG可以用于这些场景，确保密钥的不可预测性。

### 2. 随机化算法

在某些算法中，随机化是提高性能或避免冲突的关键。例如，在无线通信中，随机化信道选择可以减少干扰。STM32的RNG可以用于生成这些随机化参数。

### 3. 游戏和模拟

在嵌入式游戏中，随机数可以用于生成随机事件或随机化游戏元素。STM32的RNG可以用于这些场景，提供真实的随机体验。

## 总结

STM32的随机数生成器（RNG）是一个强大的硬件功能，能够生成高质量的随机数。通过简单的配置和使用，开发者可以在各种应用场景中利用RNG，如加密、安全认证、随机化算法等。本文介绍了RNG的工作原理、配置方法，并提供了代码示例和实际应用场景。

## 附加资源

- [STM32参考手册](https://www.st.com/resource/en/reference_manual/dm00031020-stm32f405-415-stm32f407-417-stm32f427-437-and-stm32f429-439-advanced-arm-based-32-bit-mcus-stmicroelectronics.pdf) - 详细了解STM32的RNG功能。
- [NIST SP 800-90A](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-90Ar1.pdf) - 随机数生成器的标准文档。

## 练习

1. 修改代码示例，使其生成多个随机数并打印出来。
2. 尝试在加密算法中使用STM32的RNG生成密钥。
3. 探索如何在无线通信中使用RNG进行信道随机化。

通过本文的学习，你应该能够理解并应用STM32的随机数生成器功能。继续探索和实践，你将能够更好地掌握这一强大的工具。