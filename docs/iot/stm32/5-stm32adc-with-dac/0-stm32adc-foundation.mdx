---
title: STM32 ADC基础
description: 本教程将详细介绍STM32微控制器中的ADC（模数转换器）基础知识，包括工作原理、配置方法以及实际应用案例，适合初学者学习。
---

## 介绍

ADC（Analog-to-Digital Converter，模数转换器）是嵌入式系统中非常重要的外设之一，用于将模拟信号（如电压）转换为数字信号，以便微控制器能够处理和分析。STM32微控制器内置了高性能的ADC模块，支持多通道、高分辨率和多种采样模式。

在本教程中，我们将从基础概念入手，逐步讲解STM32 ADC的工作原理、配置方法，并通过实际案例展示其应用场景。

## ADC 的工作原理

ADC的核心任务是将连续的模拟信号转换为离散的数字信号。STM32的ADC模块通常采用逐次逼近寄存器（SAR）技术，其工作流程如下：

1. **采样**：ADC对输入信号进行采样，获取某一时刻的电压值。
2. **量化**：将采样到的电压值转换为数字值，分辨率由ADC的位数决定（如12位ADC的分辨率为4096）。
3. **转换**：将量化后的数字值存储到寄存器中，供程序读取。

:::note
STM32的ADC模块通常支持12位分辨率，即可以将0到3.3V的电压转换为0到4095的数字值。
:::

## STM32 ADC 的配置

以下是一个简单的STM32 ADC配置示例，使用HAL库进行初始化：

```c
#include "stm32f4xx_hal.h"

ADC_HandleTypeDef hadc1;

void ADC_Init(void) {
    // 配置ADC外设
    hadc1.Instance = ADC1;
    hadc1.Init.ClockPrescaler = ADC_CLOCK_SYNC_PCLK_DIV2;
    hadc1.Init.Resolution = ADC_RESOLUTION_12B;
    hadc1.Init.ScanConvMode = DISABLE;
    hadc1.Init.ContinuousConvMode = ENABLE;
    hadc1.Init.DiscontinuousConvMode = DISABLE;
    hadc1.Init.ExternalTrigConv = ADC_SOFTWARE_START;
    hadc1.Init.DataAlign = ADC_DATAALIGN_RIGHT;
    hadc1.Init.NbrOfConversion = 1;
    HAL_ADC_Init(&hadc1);

    // 配置ADC通道
    ADC_ChannelConfTypeDef sConfig = {0};
    sConfig.Channel = ADC_CHANNEL_0;
    sConfig.Rank = 1;
    sConfig.SamplingTime = ADC_SAMPLETIME_3CYCLES;
    HAL_ADC_ConfigChannel(&hadc1, &sConfig);
}

uint32_t ADC_Read(void) {
    HAL_ADC_Start(&hadc1); // 启动ADC转换
    HAL_ADC_PollForConversion(&hadc1, HAL_MAX_DELAY); // 等待转换完成
    return HAL_ADC_GetValue(&hadc1); // 读取转换结果
}
```

### 代码说明
- **ADC_Init**：初始化ADC外设，设置时钟分频、分辨率、转换模式等参数。
- **ADC_Read**：启动ADC转换并读取结果。

:::tip
在实际应用中，建议使用DMA（直接内存访问）来处理多通道或高速ADC采样，以减少CPU的负担。
:::

## 实际应用案例

### 案例：温度传感器数据采集

假设我们使用一个模拟温度传感器（如LM35），其输出电压与温度成正比（10mV/°C）。我们可以通过STM32的ADC模块读取传感器的输出电压，并计算出当前温度。

```c
float Get_Temperature(void) {
    uint32_t adc_value = ADC_Read(); // 读取ADC值
    float voltage = (adc_value * 3.3) / 4095; // 将ADC值转换为电压
    return voltage * 100; // 转换为温度值（LM35的输出为10mV/°C）
}
```

### 代码说明
- **adc_value**：ADC转换后的数字值。
- **voltage**：将数字值转换为实际电压。
- **return voltage * 100**：根据LM35的特性计算温度。

:::caution
在实际应用中，需要注意传感器的输出电压范围是否在ADC的输入范围内（通常为0到3.3V）。
:::

## 总结

通过本教程，我们学习了STM32 ADC的基础知识，包括其工作原理、配置方法以及实际应用案例。ADC是嵌入式系统中不可或缺的模块，掌握其使用方法对于开发复杂的嵌入式应用至关重要。

### 附加资源
- [STM32官方参考手册](https://www.st.com/)
- [HAL库用户指南](https://www.st.com/en/embedded-software/stm32cube-mcu-mpu-packages.html)

### 练习
1. 尝试配置STM32的ADC模块，读取多个通道的模拟信号。
2. 使用DMA实现多通道ADC采样，并将结果存储到数组中。
3. 结合PWM模块，设计一个简单的闭环控制系统，使用ADC读取反馈信号。

希望本教程对你理解STM32 ADC有所帮助！继续深入学习，你将能够开发出更复杂的嵌入式应用。