---
title: STM32 ADC中断处理
description: 本教程将详细介绍如何在STM32微控制器中使用ADC中断处理，包括配置、代码示例和实际应用场景。
---

# STM32 ADC中断处理

## 介绍

在STM32微控制器中，ADC（模数转换器）是一个非常重要的外设，用于将模拟信号转换为数字信号。为了高效地处理ADC转换结果，中断机制是一个常用的方法。通过使用中断，可以在ADC转换完成后立即处理数据，而不需要轮询状态寄存器。

本教程将逐步讲解如何配置STM32的ADC中断，并提供代码示例和实际应用场景。

## ADC中断的基本概念

ADC中断是指在ADC转换完成后，触发一个中断请求，通知CPU处理转换结果。通过使用中断，可以避免CPU不断轮询ADC状态寄存器，从而提高系统效率。

### 主要步骤
1. **配置ADC**：设置ADC的工作模式、采样时间、通道等。
2. **使能ADC中断**：在NVIC（嵌套向量中断控制器）中使能ADC中断。
3. **编写中断服务例程（ISR）**：在ISR中处理ADC转换结果。

## 配置ADC中断

### 1. 配置ADC

首先，我们需要配置ADC的基本参数。以下是一个简单的配置示例：

```c
#include "stm32f4xx.h"

void ADC_Config(void) {
    // 使能ADC时钟
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE);

    // 配置ADC
    ADC_InitTypeDef ADC_InitStruct;
    ADC_InitStruct.ADC_Resolution = ADC_Resolution_12b;
    ADC_InitStruct.ADC_ScanConvMode = DISABLE;
    ADC_InitStruct.ADC_ContinuousConvMode = ENABLE;
    ADC_InitStruct.ADC_ExternalTrigConvEdge = ADC_ExternalTrigConvEdge_None;
    ADC_InitStruct.ADC_DataAlign = ADC_DataAlign_Right;
    ADC_InitStruct.ADC_NbrOfConversion = 1;
    ADC_Init(ADC1, &ADC_InitStruct);

    // 配置ADC通道
    ADC_RegularChannelConfig(ADC1, ADC_Channel_0, 1, ADC_SampleTime_3Cycles);

    // 使能ADC
    ADC_Cmd(ADC1, ENABLE);
}
```

### 2. 使能ADC中断

接下来，我们需要在NVIC中使能ADC中断：

```c
void ADC_Interrupt_Config(void) {
    // 使能ADC中断
    ADC_ITConfig(ADC1, ADC_IT_EOC, ENABLE);

    // 配置NVIC
    NVIC_InitTypeDef NVIC_InitStruct;
    NVIC_InitStruct.NVIC_IRQChannel = ADC_IRQn;
    NVIC_InitStruct.NVIC_IRQChannelPreemptionPriority = 0;
    NVIC_InitStruct.NVIC_IRQChannelSubPriority = 0;
    NVIC_InitStruct.NVIC_IRQChannelCmd = ENABLE;
    NVIC_Init(&NVIC_InitStruct);
}
```

### 3. 编写中断服务例程（ISR）

最后，我们需要编写中断服务例程来处理ADC转换结果：

```c
void ADC_IRQHandler(void) {
    if (ADC_GetITStatus(ADC1, ADC_IT_EOC) != RESET) {
        // 读取ADC转换结果
        uint16_t adc_value = ADC_GetConversionValue(ADC1);

        // 处理ADC转换结果
        // 例如：将结果发送到串口或进行进一步处理

        // 清除中断标志
        ADC_ClearITPendingBit(ADC1, ADC_IT_EOC);
    }
}
```

## 实际应用场景

### 温度传感器读取

假设我们有一个连接到STM32的温度传感器，我们可以使用ADC中断来实时读取温度值。以下是一个简单的示例：

```c
void Temperature_Sensor_Read(void) {
    // 配置ADC和中断
    ADC_Config();
    ADC_Interrupt_Config();

    // 启动ADC转换
    ADC_SoftwareStartConv(ADC1);
}
```

在中断服务例程中，我们可以将读取的温度值发送到串口或进行进一步处理。

## 总结

通过使用ADC中断，我们可以高效地处理ADC转换结果，而不需要轮询状态寄存器。本教程详细介绍了如何配置STM32的ADC中断，并提供了代码示例和实际应用场景。

## 附加资源

- [STM32 ADC文档](https://www.st.com/resource/en/reference_manual/dm00031020-stm32f405-415-stm32f407-417-stm32f427-437-and-stm32f429-439-advanced-arm-based-32-bit-mcus-stmicroelectronics.pdf)
- [STM32 NVIC文档](https://www.st.com/resource/en/programming_manual/pm0056-stm32f4xx-cortexm4-programming-manual-stmicroelectronics.pdf)

## 练习

1. 修改代码，使其能够读取多个ADC通道的数据。
2. 尝试使用DMA（直接内存访问）来处理ADC转换结果，并比较与中断处理的优缺点。
