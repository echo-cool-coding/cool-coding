---
title: STM32 内部参考电压
description: 了解STM32微控制器中的内部参考电压，学习如何配置和使用它来校准ADC测量。
---

## 介绍

在STM32微控制器中，**内部参考电压**（Internal Voltage Reference, VREFINT）是一个非常重要的功能，尤其是在使用模数转换器（ADC）时。内部参考电压是一个稳定的电压源，通常用于校准ADC测量，以确保测量结果的准确性。

STM32的内部参考电压通常为1.2V左右（具体值请参考芯片的数据手册），并且它不受外部电源电压波动的影响。这使得它成为校准ADC的理想选择，尤其是在电源电压不稳定的情况下。

## 内部参考电压的作用

内部参考电压的主要作用是为ADC提供一个稳定的参考点。通过测量内部参考电压，可以计算出实际电源电压的波动情况，从而对ADC的测量结果进行校准。

### 为什么需要内部参考电压？

1. **电源电压波动**：在实际应用中，电源电压可能会因为负载变化或其他因素而波动。这种波动会影响ADC的测量精度。
2. **校准ADC**：通过测量内部参考电压，可以计算出实际电源电压的变化，从而对ADC的测量结果进行校准。
3. **提高测量精度**：使用内部参考电压可以显著提高ADC的测量精度，尤其是在需要高精度测量的应用中。

## 配置和使用内部参考电压

### 1. 启用内部参考电压

在STM32中，内部参考电压通常是通过配置ADC通道来启用的。具体步骤如下：

1. **配置ADC**：首先，需要配置ADC以启用内部参考电压通道。
2. **读取内部参考电压**：通过ADC读取内部参考电压的值。
3. **校准ADC**：根据读取的内部参考电压值，校准ADC的测量结果。

### 2. 代码示例

以下是一个简单的代码示例，展示了如何在STM32中启用内部参考电压并读取其值。

```c
#include "stm32f4xx_hal.h"

ADC_HandleTypeDef hadc;

void SystemClock_Config(void);
static void MX_ADC_Init(void);

int main(void)
{
    HAL_Init();
    SystemClock_Config();
    MX_ADC_Init();

    uint32_t vrefint_value = 0;
    HAL_ADC_Start(&hadc);
    HAL_ADC_PollForConversion(&hadc, HAL_MAX_DELAY);
    vrefint_value = HAL_ADC_GetValue(&hadc);
    HAL_ADC_Stop(&hadc);

    // 计算实际电压
    float vrefint_voltage = (vrefint_value * 3.3) / 4095; // 假设VREF+为3.3V
    printf("Internal Reference Voltage: %.2f V\n", vrefint_voltage);

    while (1)
    {
    }
}

static void MX_ADC_Init(void)
{
    ADC_ChannelConfTypeDef sConfig = {0};

    hadc.Instance = ADC1;
    hadc.Init.ClockPrescaler = ADC_CLOCK_SYNC_PCLK_DIV2;
    hadc.Init.Resolution = ADC_RESOLUTION_12B;
    hadc.Init.ScanConvMode = DISABLE;
    hadc.Init.ContinuousConvMode = DISABLE;
    hadc.Init.DiscontinuousConvMode = DISABLE;
    hadc.Init.ExternalTrigConvEdge = ADC_EXTERNALTRIGCONVEDGE_NONE;
    hadc.Init.ExternalTrigConv = ADC_SOFTWARE_START;
    hadc.Init.DataAlign = ADC_DATAALIGN_RIGHT;
    hadc.Init.NbrOfConversion = 1;
    hadc.Init.DMAContinuousRequests = DISABLE;
    hadc.Init.EOCSelection = ADC_EOC_SINGLE_CONV;
    HAL_ADC_Init(&hadc);

    sConfig.Channel = ADC_CHANNEL_VREFINT;
    sConfig.Rank = 1;
    sConfig.SamplingTime = ADC_SAMPLETIME_3CYCLES;
    HAL_ADC_ConfigChannel(&hadc, &sConfig);
}

void SystemClock_Config(void)
{
    // 系统时钟配置代码
}
```

### 3. 代码解释

- **ADC配置**：在 `MX_ADC_Init` 函数中，我们配置了ADC1，并启用了内部参考电压通道（`ADC_CHANNEL_VREFINT`）。
- **读取内部参考电压**：在 `main` 函数中，我们启动了ADC转换，并读取了内部参考电压的值。
- **计算实际电压**：通过读取的ADC值，我们可以计算出实际的内部参考电压。

:::tip
在实际应用中，内部参考电压的值可能会因芯片型号和温度等因素而有所不同。因此，建议在使用前查阅芯片的数据手册以获取准确的参考电压值。
:::

## 实际应用案例

### 案例：校准ADC测量

假设我们正在使用STM32测量一个传感器的输出电压，但由于电源电压波动，ADC的测量结果可能会不准确。我们可以使用内部参考电压来校准ADC的测量结果。

1. **读取内部参考电压**：首先，读取内部参考电压的值。
2. **计算实际电源电压**：根据内部参考电压的值，计算出实际的电源电压。
3. **校准传感器测量**：使用计算出的实际电源电压，校准传感器的测量结果。

通过这种方式，我们可以显著提高ADC的测量精度，尤其是在电源电压不稳定的情况下。

## 总结

STM32的内部参考电压是一个非常有用的功能，尤其是在需要高精度ADC测量的应用中。通过使用内部参考电压，我们可以校准ADC的测量结果，从而提高测量的准确性。

:::note
在实际应用中，建议定期读取内部参考电压并进行校准，以确保测量结果的准确性。
:::

## 附加资源与练习

- **练习1**：尝试在不同的电源电压下读取内部参考电压，并观察其变化。
- **练习2**：使用内部参考电压校准一个外部传感器的测量结果，并比较校准前后的测量精度。

通过以上练习，您将更好地理解内部参考电压的作用，并能够在实际项目中应用它。