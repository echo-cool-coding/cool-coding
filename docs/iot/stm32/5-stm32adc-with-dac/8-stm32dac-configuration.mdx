---
title: STM32 DAC配置
description: 本教程将详细介绍如何在STM32微控制器中配置和使用DAC（数模转换器），帮助初学者理解DAC的工作原理及其实际应用。
---

## 介绍

DAC（数模转换器）是一种将数字信号转换为模拟信号的设备。在STM32微控制器中，DAC模块可以将数字值转换为相应的模拟电压输出。这对于需要生成精确模拟信号的应用程序（如音频生成、波形生成等）非常有用。

在本教程中，我们将逐步讲解如何在STM32中配置DAC，并通过一个简单的示例展示如何使用DAC生成模拟信号。

## STM32 DAC 概述

STM32微控制器中的DAC模块通常具有以下特性：

- **分辨率**：通常为12位，这意味着DAC可以将0到4095的数字值转换为0到参考电压（Vref）之间的模拟电压。
- **通道**：大多数STM32微控制器具有两个独立的DAC通道。
- **触发源**：DAC可以通过软件触发或外部事件（如定时器）触发转换。

## 配置STM32 DAC

### 1. 启用DAC时钟

首先，我们需要启用DAC的时钟。DAC通常连接到APB1总线，因此我们需要启用APB1总线上的DAC时钟。

```c
RCC_APB1PeriphClockCmd(RCC_APB1Periph_DAC, ENABLE);
```

### 2. 配置GPIO引脚

DAC输出通常连接到特定的GPIO引脚。我们需要将这些引脚配置为模拟模式。

```c
GPIO_InitTypeDef GPIO_InitStruct;
GPIO_InitStruct.GPIO_Pin = GPIO_Pin_4; // 假设使用DAC通道1，连接到PA4
GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AN;
GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_NOPULL;
GPIO_Init(GPIOA, &GPIO_InitStruct);
```

### 3. 配置DAC

接下来，我们需要配置DAC模块。我们可以选择DAC的触发源、输出缓冲等参数。

```c
DAC_InitTypeDef DAC_InitStruct;
DAC_InitStruct.DAC_Trigger = DAC_Trigger_None; // 不使用外部触发
DAC_InitStruct.DAC_WaveGeneration = DAC_WaveGeneration_None; // 不使用波形生成
DAC_InitStruct.DAC_OutputBuffer = DAC_OutputBuffer_Enable; // 启用输出缓冲
DAC_Init(DAC_Channel_1, &DAC_InitStruct);
```

### 4. 启用DAC通道

配置完成后，我们需要启用DAC通道。

```c
DAC_Cmd(DAC_Channel_1, ENABLE);
```

### 5. 设置DAC输出值

最后，我们可以通过设置DAC的数据寄存器来输出模拟电压。

```c
DAC_SetChannel1Data(DAC_Align_12b_R, 2048); // 输出中间值，即Vref/2
```

## 实际应用案例

假设我们需要生成一个1kHz的正弦波信号。我们可以使用DAC和定时器来实现这一目标。

### 1. 配置定时器

首先，我们需要配置一个定时器来定期更新DAC的输出值。

```c
TIM_TimeBaseInitTypeDef TIM_InitStruct;
TIM_InitStruct.TIM_Period = 8399; // 定时器周期
TIM_InitStruct.TIM_Prescaler = 0;
TIM_InitStruct.TIM_ClockDivision = 0;
TIM_InitStruct.TIM_CounterMode = TIM_CounterMode_Up;
TIM_TimeBaseInit(TIM2, &TIM_InitStruct);

TIM_SelectOutputTrigger(TIM2, TIM_TRGOSource_Update); // 选择更新事件作为触发源
TIM_Cmd(TIM2, ENABLE);
```

### 2. 配置DAC触发

接下来，我们需要配置DAC以使用定时器触发。

```c
DAC_InitStruct.DAC_Trigger = DAC_Trigger_T2_TRGO; // 使用TIM2触发
DAC_Init(DAC_Channel_1, &DAC_InitStruct);
```

### 3. 生成正弦波数据

我们可以预先生成一个正弦波的数据表，并在定时器中断中更新DAC的输出值。

```c
uint16_t sineWave[100] = { /* 正弦波数据 */ };

void TIM2_IRQHandler(void) {
    static uint8_t index = 0;
    DAC_SetChannel1Data(DAC_Align_12b_R, sineWave[index]);
    index = (index + 1) % 100;
    TIM_ClearITPendingBit(TIM2, TIM_IT_Update);
}
```

## 总结

在本教程中，我们详细介绍了如何在STM32微控制器中配置和使用DAC模块。我们从启用DAC时钟、配置GPIO引脚、配置DAC模块，到实际应用案例中的正弦波生成，逐步讲解了DAC的使用方法。

通过本教程，你应该能够理解DAC的基本工作原理，并能够在自己的项目中配置和使用DAC。

## 附加资源与练习

- **练习1**：尝试修改DAC的输出值，观察模拟电压的变化。
- **练习2**：使用DAC生成其他波形（如方波、三角波）。
- **参考文档**：STM32参考手册中的DAC章节。

:::tip
如果你在配置过程中遇到问题，可以参考STM32的官方文档或社区论坛，那里有许多有用的资源和讨论。
:::