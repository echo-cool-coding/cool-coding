---
title: STM32 ADC配置
description: 本教程将详细介绍如何在STM32微控制器中配置和使用ADC（模数转换器），适合初学者学习。
---

## 介绍

ADC（Analog-to-Digital Converter，模数转换器）是STM32微控制器中非常重要的外设之一，用于将模拟信号（如电压）转换为数字信号，以便微控制器能够处理和分析。STM32的ADC模块具有高精度和灵活性，适用于各种应用场景，如传感器数据采集、音频处理等。

在本教程中，我们将逐步讲解如何配置STM32的ADC模块，并通过一个实际案例展示其应用。

## STM32 ADC 的基本概念

STM32的ADC模块通常具有以下特性：
- **分辨率**：ADC的分辨率决定了它能够将模拟信号转换为数字信号的精度。常见的分辨率有12位、10位和8位。
- **采样时间**：采样时间是指ADC对输入信号进行采样的时间长度。较长的采样时间可以提高精度，但会降低转换速度。
- **通道**：STM32的ADC模块通常支持多个输入通道，可以同时或依次对多个模拟信号进行采样。
- **触发源**：ADC可以通过多种方式触发转换，如定时器、外部信号或软件触发。

## 配置STM32 ADC的步骤

### 1. 启用ADC时钟

首先，我们需要启用ADC模块的时钟。STM32的ADC模块通常挂载在APB2总线上，因此我们需要启用APB2总线上的ADC时钟。

```c
RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE);
```

### 2. 配置ADC引脚

接下来，我们需要配置用于ADC输入的GPIO引脚。通常，这些引脚需要配置为模拟输入模式。

```c
GPIO_InitTypeDef GPIO_InitStruct;
GPIO_InitStruct.GPIO_Pin = GPIO_Pin_0; // 假设使用PA0作为ADC输入
GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AIN;
GPIO_Init(GPIOA, &GPIO_InitStruct);
```

### 3. 初始化ADC

在初始化ADC之前，我们需要配置ADC的参数，如分辨率、采样时间等。

```c
ADC_InitTypeDef ADC_InitStruct;
ADC_InitStruct.ADC_Resolution = ADC_Resolution_12b; // 12位分辨率
ADC_InitStruct.ADC_ScanConvMode = DISABLE; // 单通道模式
ADC_InitStruct.ADC_ContinuousConvMode = DISABLE; // 单次转换模式
ADC_InitStruct.ADC_ExternalTrigConv = ADC_ExternalTrigConv_None; // 软件触发
ADC_InitStruct.ADC_DataAlign = ADC_DataAlign_Right; // 数据右对齐
ADC_InitStruct.ADC_NbrOfConversion = 1; // 1个转换
ADC_Init(ADC1, &ADC_InitStruct);
```

### 4. 配置ADC通道

我们需要配置ADC的输入通道和采样时间。

```c
ADC_RegularChannelConfig(ADC1, ADC_Channel_0, 1, ADC_SampleTime_3Cycles); // 使用通道0，采样时间为3个时钟周期
```

### 5. 启用ADC

配置完成后，我们可以启用ADC。

```c
ADC_Cmd(ADC1, ENABLE);
```

### 6. 校准ADC

为了提高ADC的精度，建议在启用ADC后进行校准。

```c
ADC_ResetCalibration(ADC1);
while(ADC_GetResetCalibrationStatus(ADC1));
ADC_StartCalibration(ADC1);
while(ADC_GetCalibrationStatus(ADC1));
```

### 7. 启动ADC转换

最后，我们可以启动ADC转换并读取转换结果。

```c
ADC_SoftwareStartConvCmd(ADC1, ENABLE);
while(!ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC)); // 等待转换完成
uint16_t adc_value = ADC_GetConversionValue(ADC1); // 读取转换结果
```

## 实际案例：读取电位器电压

假设我们有一个电位器连接到STM32的PA0引脚，我们希望读取电位器的电压并将其转换为数字值。

```c
#include "stm32f10x.h"

int main(void) {
    // 启用ADC时钟
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE);

    // 配置ADC引脚
    GPIO_InitTypeDef GPIO_InitStruct;
    GPIO_InitStruct.GPIO_Pin = GPIO_Pin_0;
    GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AIN;
    GPIO_Init(GPIOA, &GPIO_InitStruct);

    // 初始化ADC
    ADC_InitTypeDef ADC_InitStruct;
    ADC_InitStruct.ADC_Resolution = ADC_Resolution_12b;
    ADC_InitStruct.ADC_ScanConvMode = DISABLE;
    ADC_InitStruct.ADC_ContinuousConvMode = DISABLE;
    ADC_InitStruct.ADC_ExternalTrigConv = ADC_ExternalTrigConv_None;
    ADC_InitStruct.ADC_DataAlign = ADC_DataAlign_Right;
    ADC_InitStruct.ADC_NbrOfConversion = 1;
    ADC_Init(ADC1, &ADC_InitStruct);

    // 配置ADC通道
    ADC_RegularChannelConfig(ADC1, ADC_Channel_0, 1, ADC_SampleTime_3Cycles);

    // 启用ADC
    ADC_Cmd(ADC1, ENABLE);

    // 校准ADC
    ADC_ResetCalibration(ADC1);
    while(ADC_GetResetCalibrationStatus(ADC1));
    ADC_StartCalibration(ADC1);
    while(ADC_GetCalibrationStatus(ADC1));

    while(1) {
        // 启动ADC转换
        ADC_SoftwareStartConvCmd(ADC1, ENABLE);
        while(!ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC));
        uint16_t adc_value = ADC_GetConversionValue(ADC1);

        // 将ADC值转换为电压（假设参考电压为3.3V）
        float voltage = (float)adc_value * 3.3 / 4095;
        // 在这里可以对电压值进行处理或显示
    }
}
```

## 总结

在本教程中，我们详细介绍了如何在STM32微控制器中配置和使用ADC模块。通过逐步讲解和实际案例，你应该能够理解ADC的基本概念，并能够在自己的项目中应用这些知识。

## 附加资源与练习

- **练习1**：尝试修改代码，使用不同的ADC通道和采样时间，观察转换结果的变化。
- **练习2**：将ADC与定时器结合，实现定时采样，并将采样结果通过串口发送到PC。
- **资源**：STM32官方参考手册和库函数指南是学习ADC配置的宝贵资源，建议仔细阅读。

:::tip
如果你在配置过程中遇到问题，可以参考STM32的官方文档或社区论坛，那里有许多有用的资源和讨论。
:::