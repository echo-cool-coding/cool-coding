---
title: STM32 DAC 波形生成
description: 学习如何使用 STM32 的 DAC（数模转换器）生成波形，包括正弦波、三角波和方波。本文适合初学者，包含代码示例和实际应用场景。
---

# STM32 DAC 波形生成

## 介绍

STM32 微控制器中的 DAC（数模转换器）是一种将数字信号转换为模拟信号的硬件模块。通过 DAC，我们可以生成各种波形，如正弦波、三角波和方波。这些波形在音频处理、信号生成和控制系统中有广泛的应用。

本文将逐步讲解如何使用 STM32 的 DAC 生成波形，并提供代码示例和实际应用场景。

## DAC 基础

DAC 的主要功能是将数字信号转换为模拟信号。STM32 的 DAC 通常具有 12 位分辨率，这意味着它可以输出 4096 个不同的电压级别。

### DAC 的主要特性

- **分辨率**：12 位
- **输出范围**：0V 到参考电压（通常为 3.3V）
- **通道**：STM32 通常有 1 或 2 个 DAC 通道

## 波形生成

### 正弦波生成

正弦波是最常见的波形之一。要生成正弦波，我们需要计算正弦函数的值，并将其转换为 DAC 的输出值。

#### 代码示例

```c
#include "stm32f4xx.h"
#include "math.h"

#define PI 3.14159265358979323846
#define SAMPLE_COUNT 100

uint16_t sine_wave[SAMPLE_COUNT];

void generate_sine_wave() {
    for (int i = 0; i < SAMPLE_COUNT; i++) {
        sine_wave[i] = (uint16_t)(2048 * (1 + sin(2 * PI * i / SAMPLE_COUNT)));
    }
}

void DAC_Init() {
    RCC->APB1ENR |= RCC_APB1ENR_DACEN;
    DAC->CR |= DAC_CR_EN1;
}

void DAC_Output(uint16_t value) {
    DAC->DHR12R1 = value;
}

int main() {
    generate_sine_wave();
    DAC_Init();

    while (1) {
        for (int i = 0; i < SAMPLE_COUNT; i++) {
            DAC_Output(sine_wave[i]);
            for (int j = 0; j < 1000; j++); // 简单的延时
        }
    }
}
```

#### 解释

1. **generate_sine_wave**：生成一个周期的正弦波样本。
2. **DAC_Init**：初始化 DAC 通道 1。
3. **DAC_Output**：将生成的样本输出到 DAC。
4. **main**：在主循环中不断输出正弦波样本。

### 三角波生成

三角波是另一种常见的波形，其特点是电压线性上升和下降。

#### 代码示例

```c
void generate_triangle_wave() {
    for (int i = 0; i < SAMPLE_COUNT; i++) {
        if (i < SAMPLE_COUNT / 2) {
            sine_wave[i] = (uint16_t)(4095 * i / (SAMPLE_COUNT / 2));
        } else {
            sine_wave[i] = (uint16_t)(4095 * (SAMPLE_COUNT - i) / (SAMPLE_COUNT / 2));
        }
    }
}
```

#### 解释

1. **generate_triangle_wave**：生成一个周期的三角波样本。
2. 其余部分与正弦波生成类似。

### 方波生成

方波的特点是电压在高电平和低电平之间快速切换。

#### 代码示例

```c
void generate_square_wave() {
    for (int i = 0; i < SAMPLE_COUNT; i++) {
        if (i < SAMPLE_COUNT / 2) {
            sine_wave[i] = 4095;
        } else {
            sine_wave[i] = 0;
        }
    }
}
```

#### 解释

1. **generate_square_wave**：生成一个周期的方波样本。
2. 其余部分与正弦波生成类似。

## 实际应用场景

### 音频信号生成

DAC 可以用于生成音频信号，如音乐或语音。通过生成不同频率的正弦波，可以合成出复杂的音频信号。

### 信号发生器

DAC 可以用于构建简单的信号发生器，用于测试和测量设备。

### 控制系统

在控制系统中，DAC 可以用于生成控制信号，如 PWM 信号的模拟版本。

## 总结

通过 STM32 的 DAC，我们可以生成各种波形，如正弦波、三角波和方波。这些波形在音频处理、信号生成和控制系统中有着广泛的应用。本文提供了生成这些波形的代码示例，并解释了其工作原理。

## 附加资源

- [STM32 DAC 官方文档](https://www.st.com/resource/en/reference_manual/dm00031020-stm32f405-415-stm32f407-417-stm32f427-437-and-stm32f429-439-advanced-arm-based-32-bit-mcus-stmicroelectronics.pdf)
- [STM32 HAL 库 DAC 示例](https://github.com/STMicroelectronics/STM32CubeF4/tree/master/Projects/STM32F4-Discovery/Examples/DAC)

## 练习

1. 修改代码，生成一个频率为 1kHz 的正弦波。
2. 尝试生成一个锯齿波，并观察其输出。
3. 使用两个 DAC 通道同时生成正弦波和方波。

:::tip
在实际应用中，确保 DAC 的输出电压范围符合你的需求，并注意 DAC 的分辨率和参考电压。
:::