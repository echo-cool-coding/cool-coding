---
title: STM32 ADC单次转换
description: 本教程将详细介绍STM32微控制器中的ADC单次转换模式，包括其工作原理、配置方法以及实际应用示例。
---

## 介绍

STM32微控制器中的ADC（模数转换器）是一种将模拟信号转换为数字信号的外设。ADC单次转换模式是ADC的一种工作模式，它允许微控制器在需要时执行一次转换，并在转换完成后停止。这种模式非常适合在不需要连续采样的情况下使用，例如读取传感器数据或检测特定事件。

在本教程中，我们将逐步讲解如何配置和使用STM32的ADC单次转换模式，并通过一个实际案例来展示其应用。

## ADC单次转换的工作原理

在单次转换模式下，ADC会在接收到启动信号后执行一次转换，并在转换完成后自动停止。转换结果将存储在ADC数据寄存器中，供后续处理使用。

### 配置步骤

1. **使能ADC时钟**：首先需要使能ADC外设的时钟。
2. **配置ADC引脚**：将需要使用的GPIO引脚配置为模拟输入模式。
3. **配置ADC参数**：设置ADC的分辨率、采样时间等参数。
4. **启动单次转换**：通过软件触发或外部事件触发启动单次转换。
5. **读取转换结果**：等待转换完成后，从ADC数据寄存器中读取转换结果。

### 代码示例

以下是一个简单的代码示例，展示了如何配置STM32的ADC单次转换模式：

```c
#include "stm32f4xx.h"

void ADC_Init(void) {
    // 使能GPIOA时钟
    RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);

    // 配置PA1为模拟输入
    GPIO_InitTypeDef GPIO_InitStruct;
    GPIO_InitStruct.GPIO_Pin = GPIO_Pin_1;
    GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AN;
    GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_NOPULL;
    GPIO_Init(GPIOA, &GPIO_InitStruct);

    // 使能ADC1时钟
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE);

    // 配置ADC1
    ADC_InitTypeDef ADC_InitStruct;
    ADC_InitStruct.ADC_Resolution = ADC_Resolution_12b;
    ADC_InitStruct.ADC_ScanConvMode = DISABLE;
    ADC_InitStruct.ADC_ContinuousConvMode = DISABLE;
    ADC_InitStruct.ADC_ExternalTrigConvEdge = ADC_ExternalTrigConvEdge_None;
    ADC_InitStruct.ADC_DataAlign = ADC_DataAlign_Right;
    ADC_InitStruct.ADC_NbrOfConversion = 1;
    ADC_Init(ADC1, &ADC_InitStruct);

    // 配置ADC1的通道1
    ADC_RegularChannelConfig(ADC1, ADC_Channel_1, 1, ADC_SampleTime_84Cycles);

    // 使能ADC1
    ADC_Cmd(ADC1, ENABLE);
}

uint16_t ADC_Read(void) {
    // 启动单次转换
    ADC_SoftwareStartConv(ADC1);

    // 等待转换完成
    while(ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC) == RESET);

    // 读取转换结果
    return ADC_GetConversionValue(ADC1);
}

int main(void) {
    ADC_Init();

    while(1) {
        uint16_t adc_value = ADC_Read();
        // 处理ADC值
    }
}
```

### 输入与输出

- **输入**：模拟信号（例如，来自传感器的电压信号）。
- **输出**：12位数字值（范围：0到4095）。

## 实际应用案例

假设我们有一个温度传感器，其输出电压与温度成正比。我们可以使用STM32的ADC单次转换模式来读取传感器的输出电压，并将其转换为温度值。

```c
float Read_Temperature(void) {
    uint16_t adc_value = ADC_Read();
    float voltage = (adc_value / 4095.0) * 3.3; // 假设参考电压为3.3V
    float temperature = (voltage - 0.5) * 100; // 假设传感器输出电压与温度的关系为：V = 0.5 + 0.01 * T
    return temperature;
}
```

在这个案例中，我们通过ADC单次转换模式读取传感器的输出电压，并将其转换为温度值。这种方法非常适合在需要定期读取传感器数据的应用中使用。

## 总结

STM32的ADC单次转换模式是一种简单且高效的方式，用于在需要时执行一次模数转换。通过本教程，您已经了解了如何配置和使用这种模式，并通过一个实际案例展示了其应用。

## 附加资源与练习

- **练习**：尝试修改代码，使其能够读取多个ADC通道的数据。
- **资源**：参考STM32参考手册，了解更多关于ADC的配置选项和高级功能。

:::tip
在实际应用中，确保ADC的参考电压稳定，以获得准确的转换结果。
:::