---
title: STM32 ADC连续转换
description: 了解STM32微控制器中的ADC连续转换模式，掌握其工作原理、配置方法以及实际应用场景。
---

## 介绍

在STM32微控制器中，ADC（模数转换器）是一个非常重要的外设，用于将模拟信号转换为数字信号。ADC连续转换模式是一种高效的转换方式，它允许ADC在无需软件干预的情况下连续进行多次转换。这种模式特别适用于需要实时采集数据的应用场景，例如传感器数据采集、音频信号处理等。

本文将详细介绍STM32ADC连续转换的工作原理、配置方法，并通过实际案例展示其应用。

## ADC连续转换的工作原理

在连续转换模式下，ADC会不断地进行转换，并将结果存储在数据寄存器中。每次转换完成后，ADC会自动开始下一次转换，直到被软件或硬件停止。这种模式可以显著减少CPU的干预，提高系统的实时性。

### 配置步骤

1. **初始化ADC外设**：首先需要配置ADC的时钟、分辨率和采样时间等参数。
2. **配置连续转换模式**：通过设置ADC控制寄存器中的相关位，使ADC进入连续转换模式。
3. **启动转换**：通过软件或硬件触发启动ADC转换。
4. **读取转换结果**：在转换完成后，从数据寄存器中读取转换结果。

### 代码示例

以下是一个简单的代码示例，展示了如何配置STM32的ADC进行连续转换：

```c
#include "stm32f4xx.h"

void ADC_Continuous_Conversion_Init(void) {
    // 1. 使能ADC时钟
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE);

    // 2. 配置ADC引脚
    GPIO_InitTypeDef GPIO_InitStruct;
    GPIO_InitStruct.GPIO_Pin = GPIO_Pin_0;
    GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AN;
    GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_NOPULL;
    GPIO_Init(GPIOA, &GPIO_InitStruct);

    // 3. 配置ADC
    ADC_InitTypeDef ADC_InitStruct;
    ADC_InitStruct.ADC_Resolution = ADC_Resolution_12b;
    ADC_InitStruct.ADC_ContinuousConvMode = ENABLE;
    ADC_InitStruct.ADC_ExternalTrigConv = ADC_ExternalTrigConv_T1_CC1;
    ADC_InitStruct.ADC_DataAlign = ADC_DataAlign_Right;
    ADC_InitStruct.ADC_ScanConvMode = DISABLE;
    ADC_Init(ADC1, &ADC_InitStruct);

    // 4. 配置ADC通道
    ADC_RegularChannelConfig(ADC1, ADC_Channel_0, 1, ADC_SampleTime_3Cycles);

    // 5. 使能ADC
    ADC_Cmd(ADC1, ENABLE);

    // 6. 启动ADC转换
    ADC_SoftwareStartConv(ADC1);
}

uint16_t ADC_Read(void) {
    while (!ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC));
    return ADC_GetConversionValue(ADC1);
}
```

### 输入与输出

- **输入**：模拟信号（例如传感器输出的电压信号）。
- **输出**：数字信号（12位分辨率，范围为0到4095）。

## 实际应用案例

### 案例：温度传感器数据采集

假设我们使用STM32微控制器和一个温度传感器（如LM35）来实时采集环境温度。温度传感器输出的模拟电压与温度成正比，我们可以通过ADC连续转换模式实时采集这些数据。

1. **硬件连接**：将LM35的输出引脚连接到STM32的ADC输入引脚（例如PA0）。
2. **软件配置**：使用上述代码初始化ADC，并配置为连续转换模式。
3. **数据处理**：在每次转换完成后，读取ADC的值，并将其转换为实际的温度值。

```c
float ADC_To_Temperature(uint16_t adc_value) {
    // 假设ADC参考电压为3.3V，12位分辨率
    float voltage = (adc_value / 4095.0) * 3.3;
    // LM35的输出电压与温度成正比，10mV/°C
    return voltage * 100;
}
```

## 总结

STM32的ADC连续转换模式是一种高效的转换方式，适用于需要实时采集数据的应用场景。通过本文的介绍和代码示例，你应该能够理解并配置STM32的ADC连续转换模式，并将其应用于实际项目中。

## 附加资源与练习

- **资源**：
  - [STM32参考手册](https://www.st.com/resource/en/reference_manual/dm00031020-stm32f405-415-stm32f407-417-stm32f427-437-and-stm32f429-439-advanced-arm-based-32-bit-mcus-stmicroelectronics.pdf)
  - [STM32CubeMX](https://www.st.com/en/development-tools/stm32cubemx.html)

- **练习**：
  1. 修改代码示例，使其能够同时采集多个通道的模拟信号。
  2. 使用DMA（直接内存访问）来进一步提高ADC连续转换的效率。
