---
title: STM32 DAC输出模式
description: 了解STM32微控制器的DAC（数模转换器）输出模式，包括基本概念、配置方法、代码示例和实际应用场景。
---

## 介绍

STM32微控制器中的DAC（数模转换器）模块用于将数字信号转换为模拟信号。DAC的输出模式决定了模拟信号的生成方式，这对于控制外部设备（如音频设备、电机驱动器等）至关重要。本文将详细介绍STM32 DAC的输出模式，包括其工作原理、配置方法以及实际应用。

## DAC输出模式概述

STM32的DAC模块支持多种输出模式，主要包括以下几种：

1. **正常模式（Normal Mode）**：DAC输出直接由数据寄存器（DHR）控制。
2. **噪声生成模式（Noise Generation Mode）**：DAC输出由伪随机噪声生成器控制。
3. **三角波生成模式（Triangle Wave Generation Mode）**：DAC输出由三角波生成器控制。

### 正常模式

在正常模式下，DAC的输出直接由数据寄存器（DHR）的值决定。这是最简单的DAC输出模式，适用于需要精确控制模拟输出的场景。

#### 配置步骤

1. 启用DAC时钟。
2. 配置DAC引脚为模拟模式。
3. 配置DAC通道。
4. 写入数据到DHR寄存器。

#### 代码示例

```c
#include "stm32f4xx.h"

void DAC_Init(void) {
    // 启用DAC时钟
    RCC->APB1ENR |= RCC_APB1ENR_DACEN;

    // 配置DAC引脚为模拟模式
    GPIOA->MODER |= GPIO_MODER_MODER4_0 | GPIO_MODER_MODER4_1;

    // 配置DAC通道1
    DAC->CR |= DAC_CR_EN1;

    // 写入数据到DHR寄存器
    DAC->DHR12R1 = 2048; // 12位数据，2048对应1.65V（假设参考电压为3.3V）
}

int main(void) {
    DAC_Init();
    while (1) {
        // 主循环
    }
}
```

### 噪声生成模式

在噪声生成模式下，DAC的输出由伪随机噪声生成器控制。这种模式适用于需要生成随机信号的场景，如噪声测试或随机信号生成。

#### 配置步骤

1. 启用DAC时钟。
2. 配置DAC引脚为模拟模式。
3. 配置DAC通道为噪声生成模式。
4. 写入初始值到DHR寄存器。

#### 代码示例

```c
#include "stm32f4xx.h"

void DAC_Noise_Init(void) {
    // 启用DAC时钟
    RCC->APB1ENR |= RCC_APB1ENR_DACEN;

    // 配置DAC引脚为模拟模式
    GPIOA->MODER |= GPIO_MODER_MODER4_0 | GPIO_MODER_MODER4_1;

    // 配置DAC通道1为噪声生成模式
    DAC->CR |= DAC_CR_EN1 | DAC_CR_WAVE1_0;

    // 写入初始值到DHR寄存器
    DAC->DHR12R1 = 2048; // 12位数据，2048对应1.65V（假设参考电压为3.3V）
}

int main(void) {
    DAC_Noise_Init();
    while (1) {
        // 主循环
    }
}
```

### 三角波生成模式

在三角波生成模式下，DAC的输出由三角波生成器控制。这种模式适用于需要生成周期性波形的场景，如信号发生器。

#### 配置步骤

1. 启用DAC时钟。
2. 配置DAC引脚为模拟模式。
3. 配置DAC通道为三角波生成模式。
4. 写入初始值到DHR寄存器。

#### 代码示例

```c
#include "stm32f4xx.h"

void DAC_Triangle_Init(void) {
    // 启用DAC时钟
    RCC->APB1ENR |= RCC_APB1ENR_DACEN;

    // 配置DAC引脚为模拟模式
    GPIOA->MODER |= GPIO_MODER_MODER4_0 | GPIO_MODER_MODER4_1;

    // 配置DAC通道1为三角波生成模式
    DAC->CR |= DAC_CR_EN1 | DAC_CR_WAVE1_1;

    // 写入初始值到DHR寄存器
    DAC->DHR12R1 = 2048; // 12位数据，2048对应1.65V（假设参考电压为3.3V）
}

int main(void) {
    DAC_Triangle_Init();
    while (1) {
        // 主循环
    }
}
```

## 实际应用场景

### 音频信号生成

在音频信号生成中，DAC可以用于生成模拟音频信号。通过配置DAC为正常模式，可以精确控制音频信号的幅度和频率。

### 电机控制

在电机控制中，DAC可以用于生成控制信号，如PWM信号的参考电压。通过配置DAC为三角波生成模式，可以生成周期性的控制信号。

### 随机信号测试

在随机信号测试中，DAC可以用于生成随机信号。通过配置DAC为噪声生成模式，可以生成伪随机信号，用于测试系统的抗噪声能力。

## 总结

STM32的DAC模块提供了多种输出模式，适用于不同的应用场景。通过合理配置DAC的输出模式，可以实现精确的模拟信号控制。本文介绍了DAC的三种主要输出模式，并提供了相应的代码示例和实际应用场景。

## 附加资源与练习

- **练习1**：尝试配置DAC为噪声生成模式，并观察输出信号的变化。
- **练习2**：使用DAC生成一个三角波，并通过示波器观察波形。
- **附加资源**：参考STM32官方文档，了解更多关于DAC的配置和使用方法。

:::tip
在实际应用中，确保DAC的参考电压稳定，以获得准确的模拟输出。
:::