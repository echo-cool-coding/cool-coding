---
title: STM32 HAL UART
description: 本教程将详细介绍如何使用 STM32 HAL 库配置和使用 UART 通信。适合初学者学习 STM32 的串口通信功能。
---

## 介绍

UART（Universal Asynchronous Receiver/Transmitter，通用异步收发传输器）是一种常见的串行通信协议，广泛应用于嵌入式系统中。STM32 微控制器通过 HAL 库提供了简单易用的 UART API，使得开发者可以轻松实现串口通信。

在本教程中，我们将学习如何使用 STM32 HAL 库配置 UART，并通过实际案例展示其应用。

## UART 的基本概念

UART 是一种异步通信协议，意味着它不需要时钟信号来同步数据传输。UART 通信通常包括以下参数：

- **波特率（Baud Rate）**：数据传输速率，单位为 bps（bits per second）。
- **数据位（Data Bits）**：每个数据帧中的数据位数，通常为 8 位。
- **停止位（Stop Bits）**：表示数据帧结束的位数，通常为 1 位。
- **校验位（Parity Bit）**：用于错误检测的位，可以是无校验、奇校验或偶校验。

## 配置 UART

在 STM32 中，UART 的配置通常包括以下几个步骤：

1. **初始化 UART 外设**：配置波特率、数据位、停止位和校验位等参数。
2. **启用 UART 中断**（可选）：如果需要通过中断方式接收数据，可以启用 UART 接收中断。
3. **发送和接收数据**：使用 HAL 库提供的 API 发送和接收数据。

### 代码示例：配置 UART

以下是一个简单的 UART 配置示例，假设我们使用 USART2 进行通信：

```c
#include "stm32f4xx_hal.h"

UART_HandleTypeDef huart2;

void SystemClock_Config(void);
static void MX_USART2_UART_Init(void);

int main(void) {
    HAL_Init();
    SystemClock_Config();
    MX_USART2_UART_Init();

    char msg[] = "Hello, UART!\r\n";
    HAL_UART_Transmit(&huart2, (uint8_t*)msg, sizeof(msg), HAL_MAX_DELAY);

    while (1) {
        // 主循环
    }
}

static void MX_USART2_UART_Init(void) {
    huart2.Instance = USART2;
    huart2.Init.BaudRate = 115200;
    huart2.Init.WordLength = UART_WORDLENGTH_8B;
    huart2.Init.StopBits = UART_STOPBITS_1;
    huart2.Init.Parity = UART_PARITY_NONE;
    huart2.Init.Mode = UART_MODE_TX_RX;
    huart2.Init.HwFlowCtl = UART_HWCONTROL_NONE;
    huart2.Init.OverSampling = UART_OVERSAMPLING_16;
    if (HAL_UART_Init(&huart2) != HAL_OK) {
        // 初始化错误处理
    }
}

void SystemClock_Config(void) {
    // 系统时钟配置
}
```

### 代码解释

- `huart2` 是一个 `UART_HandleTypeDef` 类型的结构体，用于存储 UART 的配置和状态信息。
- `MX_USART2_UART_Init` 函数用于初始化 USART2，配置波特率、数据位、停止位和校验位等参数。
- `HAL_UART_Transmit` 函数用于发送数据，`HAL_UART_Receive` 函数用于接收数据。

## 实际案例：通过 UART 接收数据并回显

在实际应用中，我们通常需要通过 UART 接收数据并对其进行处理。以下是一个简单的回显程序示例：

```c
char rx_data;
while (1) {
    if (HAL_UART_Receive(&huart2, (uint8_t*)&rx_data, 1, HAL_MAX_DELAY) == HAL_OK) {
        HAL_UART_Transmit(&huart2, (uint8_t*)&rx_data, 1, HAL_MAX_DELAY);
    }
}
```

在这个示例中，程序会不断等待接收一个字符，然后将接收到的字符发送回去，实现回显功能。

## 总结

通过本教程，我们学习了如何使用 STM32 HAL 库配置和使用 UART 通信。UART 是一种简单且常用的通信协议，掌握其使用方法对于嵌入式开发非常重要。

:::tip
在实际项目中，UART 常用于与传感器、GPS 模块、蓝牙模块等外设进行通信。建议读者尝试将 UART 与其他外设结合使用，以加深理解。
:::

## 附加资源与练习

- **练习 1**：修改波特率，观察通信是否正常。
- **练习 2**：使用 UART 中断方式接收数据，并实现一个简单的命令解析器。
- **参考文档**：[STM32 HAL 库用户手册](https://www.st.com/resource/en/user_manual/dm00105879.pdf)

通过以上练习和资源，您将能够更好地掌握 STM32 HAL 库中的 UART 通信功能。