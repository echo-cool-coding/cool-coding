---
title: STM32 HAL DAC
description: 了解如何使用 STM32 HAL 库配置和使用 DAC（数模转换器），生成模拟信号输出。
---

## 介绍

STM32 微控制器中的 DAC（数模转换器）是一种将数字信号转换为模拟信号的硬件模块。DAC 在许多应用中非常有用，例如音频生成、波形生成、电机控制等。STM32 HAL 库提供了简单易用的 API 来配置和控制 DAC 模块。

在本教程中，我们将学习如何使用 STM32 HAL 库配置 DAC，并通过代码示例展示如何生成模拟信号。

## DAC 的基本概念

DAC 的主要功能是将数字值转换为相应的模拟电压。STM32 的 DAC 模块通常支持 12 位分辨率，这意味着它可以输出 0 到 4095 之间的数字值，对应 0V 到参考电压（通常为 3.3V）的模拟电压。

### DAC 的主要特性
- **分辨率**：12 位（0 到 4095）
- **参考电压**：通常为 3.3V
- **输出通道**：STM32 通常有 1 或 2 个 DAC 通道
- **触发方式**：可以通过软件触发或外部事件触发

## 配置 STM32 DAC

### 1. 初始化 DAC

首先，我们需要初始化 DAC 模块。以下是一个使用 HAL 库初始化 DAC 的示例代码：

```c
#include "stm32f4xx_hal.h"

DAC_HandleTypeDef hdac;

void DAC_Init(void) {
    __HAL_RCC_DAC_CLK_ENABLE();

    hdac.Instance = DAC;
    if (HAL_DAC_Init(&hdac) != HAL_OK) {
        // 初始化错误处理
        Error_Handler();
    }

    DAC_ChannelConfTypeDef sConfig = {0};
    sConfig.DAC_Trigger = DAC_TRIGGER_NONE;
    sConfig.DAC_OutputBuffer = DAC_OUTPUTBUFFER_ENABLE;

    if (HAL_DAC_ConfigChannel(&hdac, &sConfig, DAC_CHANNEL_1) != HAL_OK) {
        // 配置错误处理
        Error_Handler();
    }
}
```

### 2. 设置 DAC 输出

初始化完成后，我们可以通过 HAL 库提供的函数设置 DAC 的输出值。以下是一个设置 DAC 输出的示例：

```c
void DAC_SetValue(uint32_t value) {
    if (HAL_DAC_SetValue(&hdac, DAC_CHANNEL_1, DAC_ALIGN_12B_R, value) != HAL_OK) {
        // 设置错误处理
        Error_Handler();
    }
    HAL_DAC_Start(&hdac, DAC_CHANNEL_1);
}
```

### 3. 生成模拟信号

通过循环改变 DAC 的输出值，我们可以生成不同的模拟信号。以下是一个生成三角波的示例：

```c
void DAC_GenerateTriangleWave(void) {
    uint32_t value = 0;
    while (1) {
        for (value = 0; value < 4095; value++) {
            DAC_SetValue(value);
            HAL_Delay(1);
        }
        for (value = 4095; value > 0; value--) {
            DAC_SetValue(value);
            HAL_Delay(1);
        }
    }
}
```

## 实际应用案例

### 音频信号生成

DAC 可以用于生成音频信号。例如，我们可以通过 DAC 输出正弦波来生成简单的音频信号。以下是一个生成正弦波的示例：

```c
void DAC_GenerateSineWave(void) {
    uint32_t i;
    uint32_t sine_wave[100] = { /* 预计算的正弦波值 */ };
    while (1) {
        for (i = 0; i < 100; i++) {
            DAC_SetValue(sine_wave[i]);
            HAL_Delay(1);
        }
    }
}
```

### 电机控制

在电机控制中，DAC 可以用于生成控制信号，例如 PWM 信号的参考电压。通过调整 DAC 的输出值，可以精确控制电机的转速和方向。

## 总结

在本教程中，我们学习了如何使用 STM32 HAL 库配置和使用 DAC 模块。我们通过代码示例展示了如何初始化 DAC、设置输出值以及生成模拟信号。DAC 在许多应用中非常有用，例如音频生成、波形生成和电机控制。

## 附加资源与练习

- **练习 1**：尝试修改代码，生成方波信号。
- **练习 2**：使用外部触发源（如定时器）来触发 DAC 输出。
- **参考文档**：[STM32 HAL 库文档](https://www.st.com)

:::tip
在实际项目中，确保参考电压和输出负载的匹配，以获得最佳的 DAC 性能。
:::