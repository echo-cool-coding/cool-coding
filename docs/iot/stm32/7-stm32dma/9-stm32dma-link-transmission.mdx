---
title: STM32 DMA链接传输
description: 了解STM32DMA链接传输的基本概念、工作原理及其在实际应用中的使用方法。适合初学者学习。
---

# STM32 DMA链接传输

## 介绍

DMA（Direct Memory Access，直接内存访问）是STM32微控制器中一种高效的数据传输方式，它允许外设与内存之间直接进行数据传输，而无需CPU的干预。DMA链接传输是DMA的一种高级功能，它允许在完成一次DMA传输后，自动启动另一个DMA传输，从而实现多个数据传输任务的连续执行。

在STM32中，DMA链接传输通常用于需要连续传输多个数据块的场景，例如音频处理、图像采集等。通过链接传输，可以显著提高数据传输的效率，并减少CPU的负担。

## DMA链接传输的工作原理

DMA链接传输的核心思想是通过配置多个DMA通道，并在每个通道的传输完成后，自动启动下一个通道的传输。这种机制可以通过DMA的“链接模式”来实现。

在STM32中，每个DMA通道都有一个“链接寄存器”（Linked List Register），用于指定下一个要启动的DMA通道。当一个DMA通道完成传输后，DMA控制器会自动从链接寄存器中读取下一个通道的配置，并启动该通道的传输。

### 链接传输的配置步骤

1. **配置DMA通道**：首先，需要为每个DMA通道配置源地址、目标地址、传输长度等参数。
2. **设置链接寄存器**：在每个DMA通道的配置中，指定下一个要启动的DMA通道。
3. **启动第一个DMA通道**：启动第一个DMA通道后，DMA控制器会自动处理后续的链接传输。

## 代码示例

以下是一个简单的STM32 DMA链接传输的代码示例。假设我们需要将两个数组从内存传输到外设，并且希望在第一个传输完成后自动启动第二个传输。

```c
#include "stm32f4xx.h"

#define ARRAY_SIZE 10

uint32_t srcArray1[ARRAY_SIZE] = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9};
uint32_t srcArray2[ARRAY_SIZE] = {10, 11, 12, 13, 14, 15, 16, 17, 18, 19};
uint32_t dstArray1[ARRAY_SIZE];
uint32_t dstArray2[ARRAY_SIZE];

void DMA_Config(void) {
    // 配置DMA1 Stream1
    DMA1_Stream1->CR &= ~DMA_SxCR_EN; // 禁用DMA流
    DMA1_Stream1->PAR = (uint32_t)&srcArray1; // 源地址
    DMA1_Stream1->M0AR = (uint32_t)&dstArray1; // 目标地址
    DMA1_Stream1->NDTR = ARRAY_SIZE; // 传输长度
    DMA1_Stream1->CR = DMA_SxCR_CHSEL_0 | DMA_SxCR_MINC | DMA_SxCR_PINC | DMA_SxCR_DIR_0 | DMA_SxCR_TCIE;
    DMA1_Stream1->FCR = 0;

    // 配置DMA1 Stream2
    DMA1_Stream2->CR &= ~DMA_SxCR_EN; // 禁用DMA流
    DMA1_Stream2->PAR = (uint32_t)&srcArray2; // 源地址
    DMA1_Stream2->M0AR = (uint32_t)&dstArray2; // 目标地址
    DMA1_Stream2->NDTR = ARRAY_SIZE; // 传输长度
    DMA1_Stream2->CR = DMA_SxCR_CHSEL_1 | DMA_SxCR_MINC | DMA_SxCR_PINC | DMA_SxCR_DIR_0 | DMA_SxCR_TCIE;
    DMA1_Stream2->FCR = 0;

    // 设置DMA1 Stream1的链接寄存器指向DMA1 Stream2
    DMA1_Stream1->CR |= DMA_SxCR_LIS;

    // 启动DMA1 Stream1
    DMA1_Stream1->CR |= DMA_SxCR_EN;
}

int main(void) {
    DMA_Config();

    while (1) {
        // 主循环
    }
}
```

:::note
在上述代码中，`DMA1_Stream1`和`DMA1_Stream2`分别配置为两个DMA通道。`DMA1_Stream1`的链接寄存器指向`DMA1_Stream2`，因此在`DMA1_Stream1`完成传输后，`DMA1_Stream2`会自动启动。
:::

## 实际应用场景

### 音频处理

在音频处理中，通常需要连续传输多个音频数据块。通过DMA链接传输，可以在一个音频数据块传输完成后，自动启动下一个数据块的传输，从而实现连续的音频流处理。

### 图像采集

在图像采集系统中，摄像头通常会生成大量的图像数据。通过DMA链接传输，可以在一个图像帧传输完成后，自动启动下一个图像帧的传输，从而确保图像数据的连续性和实时性。

## 总结

DMA链接传输是STM32中一种强大的数据传输机制，它允许在多个DMA通道之间实现自动切换，从而显著提高数据传输的效率。通过合理配置DMA通道和链接寄存器，可以实现复杂的连续数据传输任务。

## 附加资源与练习

- **练习1**：尝试修改上述代码，使其能够处理三个数组的连续传输。
- **练习2**：研究STM32的DMA中断机制，并尝试在DMA传输完成后触发中断。

:::tip
更多关于STM32 DMA的详细信息，可以参考STM32官方参考手册中的DMA章节。
:::