---
title: STM32 目录操作
description: 学习如何在STM32中使用文件系统进行目录操作，包括创建、删除、遍历目录等基本操作。本文适合初学者，提供代码示例和实际应用场景。
---

# STM32 目录操作

在嵌入式系统中，文件系统是一个非常重要的组成部分，尤其是在需要存储和管理大量数据的应用中。STM32微控制器支持多种文件系统，如FATFS，这使得开发者可以轻松地进行文件和目录操作。本文将详细介绍如何在STM32中进行目录操作，包括创建、删除、遍历目录等基本操作。

## 目录操作的基本概念

目录（Directory）是文件系统中用于组织文件的一种结构。它可以包含文件和其他目录（子目录）。在STM32中，目录操作通常通过文件系统库（如FATFS）来实现。常见的目录操作包括：

- 创建目录
- 删除目录
- 遍历目录
- 获取目录信息

## 创建目录

在STM32中，使用FATFS库创建目录非常简单。以下是一个示例代码，展示如何创建一个名为`/mydir`的目录：

```c
#include "ff.h"

FRESULT create_directory(const char* path) {
    return f_mkdir(path);
}

int main(void) {
    FRESULT res;
    res = create_directory("/mydir");
    if (res == FR_OK) {
        printf("Directory created successfully.\n");
    } else {
        printf("Failed to create directory. Error: %d\n", res);
    }
    return 0;
}
```

### 代码解释

- `f_mkdir(path)`：FATFS库提供的函数，用于创建目录。`path`是目录的路径。
- `FRESULT`：FATFS库返回的结果类型，`FR_OK`表示操作成功。

### 输出示例

如果目录创建成功，程序将输出：

```
Directory created successfully.
```

如果目录创建失败，程序将输出错误代码。

## 删除目录

删除目录的操作与创建目录类似。以下是一个示例代码，展示如何删除名为`/mydir`的目录：

```c
#include "ff.h"

FRESULT delete_directory(const char* path) {
    return f_unlink(path);
}

int main(void) {
    FRESULT res;
    res = delete_directory("/mydir");
    if (res == FR_OK) {
        printf("Directory deleted successfully.\n");
    } else {
        printf("Failed to delete directory. Error: %d\n", res);
    }
    return 0;
}
```

### 代码解释

- `f_unlink(path)`：FATFS库提供的函数，用于删除目录或文件。`path`是目录的路径。

### 输出示例

如果目录删除成功，程序将输出：

```
Directory deleted successfully.
```

如果目录删除失败，程序将输出错误代码。

## 遍历目录

遍历目录是获取目录中所有文件和子目录的过程。以下是一个示例代码，展示如何遍历名为`/mydir`的目录：

```c
#include "ff.h"

void list_directory(const char* path) {
    DIR dir;
    FILINFO fno;
    FRESULT res;

    res = f_opendir(&dir, path);
    if (res == FR_OK) {
        for (;;) {
            res = f_readdir(&dir, &fno);
            if (res != FR_OK || fno.fname[0] == 0) break;
            printf("%s\n", fno.fname);
        }
        f_closedir(&dir);
    } else {
        printf("Failed to open directory. Error: %d\n", res);
    }
}

int main(void) {
    list_directory("/mydir");
    return 0;
}
```

### 代码解释

- `f_opendir(&dir, path)`：打开目录。
- `f_readdir(&dir, &fno)`：读取目录中的下一个文件或子目录。
- `f_closedir(&dir)`：关闭目录。

### 输出示例

如果目录中有文件`file1.txt`和子目录`subdir`，程序将输出：

```
file1.txt
subdir
```

## 实际应用场景

目录操作在嵌入式系统中有广泛的应用场景。例如：

- **数据日志系统**：在数据日志系统中，通常需要按日期或事件创建不同的目录来存储日志文件。
- **固件更新**：在固件更新过程中，可能需要创建临时目录来存储更新文件，并在更新完成后删除该目录。
- **配置文件管理**：在配置文件中，可能需要遍历目录来查找特定的配置文件。

## 总结

本文介绍了如何在STM32中进行目录操作，包括创建、删除和遍历目录。通过这些基本操作，开发者可以更好地管理嵌入式系统中的文件和目录。希望本文能帮助你更好地理解STM32文件系统中的目录操作。

## 附加资源与练习

- **练习1**：尝试在STM32开发板上创建一个目录，并在其中创建几个文件，然后遍历该目录并输出文件名。
- **练习2**：编写一个程序，删除指定目录及其所有子目录和文件。
- **参考文档**：[FATFS官方文档](http://elm-chan.org/fsw/ff/00index_e.html)

:::tip
在实际开发中，建议在使用文件系统操作时进行错误处理，以确保程序的健壮性。
:::