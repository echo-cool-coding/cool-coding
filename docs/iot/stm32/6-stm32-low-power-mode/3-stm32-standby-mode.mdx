---
title: STM32 待机模式
description: 了解STM32微控制器的待机模式，学习如何通过低功耗模式节省能源，并掌握其实际应用场景。
---

# STM32 待机模式

## 介绍

STM32微控制器提供了多种低功耗模式，以帮助开发者在需要时降低功耗，延长电池寿命。其中，**待机模式（Standby Mode）** 是功耗最低的模式之一。在该模式下，大部分电路被关闭，仅保留极少数关键功能，例如RTC（实时时钟）和备份寄存器。待机模式非常适合需要长时间休眠且偶尔唤醒的应用场景。

## 待机模式的工作原理

在待机模式下，STM32会关闭以下部分：
- 主电源（VDD）
- 内部电压调节器
- PLL、HSI和HSE振荡器
- SRAM和寄存器内容（除了备份寄存器）

只有以下部分仍然工作：
- 备份域（包括RTC和备份寄存器）
- 唤醒引脚（如WKUP引脚）

当STM32进入待机模式后，只能通过以下方式唤醒：
- 外部复位（NRST引脚）
- IWDG（独立看门狗）复位
- WKUP引脚的上升沿
- RTC闹钟事件

## 如何进入待机模式

要进入待机模式，需要配置相关的寄存器并调用特定的函数。以下是一个简单的代码示例，展示如何进入待机模式：

```c
#include "stm32f4xx.h" // 根据你的STM32系列选择合适的头文件

void enter_standby_mode(void) {
    // 使能电源控制时钟
    RCC_APB1PeriphClockCmd(RCC_APB1Periph_PWR, ENABLE);

    // 使能WKUP引脚
    PWR_WakeUpPinCmd(ENABLE);

    // 进入待机模式
    PWR_EnterSTANDBYMode();
}

int main(void) {
    // 初始化代码...

    // 进入待机模式
    enter_standby_mode();

    // 程序不会执行到这里
    while (1) {
        // 空循环
    }
}
```

### 代码解释
1. **RCC_APB1PeriphClockCmd(RCC_APB1Periph_PWR, ENABLE);**  
   使能电源控制时钟，以便配置电源控制寄存器。

2. **PWR_WakeUpPinCmd(ENABLE);**  
   使能WKUP引脚，以便通过该引脚唤醒微控制器。

3. **PWR_EnterSTANDBYMode();**  
   调用该函数后，STM32将进入待机模式。

:::note
进入待机模式后，程序将停止运行，直到通过唤醒事件重新启动。
:::

## 唤醒STM32

STM32可以从待机模式通过以下方式唤醒：
1. **WKUP引脚的上升沿**  
   配置WKUP引脚为唤醒源，当检测到上升沿时，STM32将退出待机模式并重新启动。

2. **RTC闹钟事件**  
   如果启用了RTC闹钟，当闹钟触发时，STM32将退出待机模式。

3. **外部复位（NRST引脚）**  
   按下复位按钮或通过外部电路触发复位。

4. **独立看门狗（IWDG）复位**  
   如果启用了独立看门狗，当看门狗超时时，STM32将复位并退出待机模式。

## 实际应用场景

### 案例：电池供电的温度传感器

假设你正在开发一个电池供电的温度传感器，需要每隔一小时采集一次温度数据并上传到服务器。为了节省电量，可以在采集数据后让STM32进入待机模式，并通过RTC闹钟设置一小时后唤醒。

```c
#include "stm32f4xx.h"

void configure_rtc_alarm(void) {
    // 配置RTC闹钟，设置一小时后唤醒
    // 具体代码略
}

void enter_standby_mode(void) {
    RCC_APB1PeriphClockCmd(RCC_APB1Periph_PWR, ENABLE);
    PWR_WakeUpPinCmd(ENABLE);
    PWR_EnterSTANDBYMode();
}

int main(void) {
    // 初始化RTC和传感器...

    while (1) {
        // 采集温度数据
        // 上传数据到服务器

        // 配置RTC闹钟
        configure_rtc_alarm();

        // 进入待机模式
        enter_standby_mode();
    }
}
```

:::tip
在实际应用中，确保在进入待机模式前保存必要的状态数据到备份寄存器或非易失性存储器中。
:::

## 总结

STM32的待机模式是一种极低功耗的模式，适合需要长时间休眠的应用场景。通过合理配置唤醒源（如WKUP引脚或RTC闹钟），可以在需要时唤醒微控制器并执行任务。待机模式在电池供电的设备中尤为有用，可以显著延长电池寿命。

## 附加资源与练习

### 练习
1. 修改上述代码，使用WKUP引脚作为唤醒源，并通过按键唤醒STM32。
2. 尝试在待机模式下使用备份寄存器保存数据，并在唤醒后读取该数据。

### 进一步学习
- 阅读STM32参考手册中的低功耗模式章节，了解其他低功耗模式（如停止模式和睡眠模式）。
- 探索如何使用RTC和备份域实现更复杂的低功耗应用。

通过以上内容，你应该已经掌握了STM32待机模式的基本原理和应用方法。继续实践和探索，你将能够设计出更高效的低功耗嵌入式系统！