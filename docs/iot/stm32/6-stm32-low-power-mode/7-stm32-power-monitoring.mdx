---
title: STM32 电源监控
description: 了解STM32微控制器的电源监控功能，掌握如何通过电源监控优化低功耗模式下的系统性能。
---

# STM32 电源监控

在嵌入式系统中，电源管理是一个至关重要的主题，尤其是在低功耗应用中。STM32微控制器提供了多种低功耗模式，而电源监控则是确保系统在这些模式下稳定运行的关键功能之一。本文将详细介绍STM32的电源监控功能，帮助初学者理解其工作原理和应用场景。

## 什么是电源监控？

电源监控是指通过硬件或软件手段，实时监测系统电源的状态，以确保电源电压在允许范围内。STM32微控制器内置了多种电源监控功能，例如电源电压检测（PVD）和低功耗电压检测（LVD）。这些功能可以帮助开发者在电源电压异常时采取相应的措施，避免系统崩溃或数据丢失。

## STM32 的电源监控功能

### 1. 电源电压检测（PVD）

电源电压检测（PVD）是STM32中一个重要的硬件功能，用于监测VDD电源电压。当VDD电压低于或高于设定的阈值时，PVD会触发中断，开发者可以在中断服务程序中进行相应的处理。

#### 配置PVD

以下是一个配置PVD的示例代码：

```c
#include "stm32f4xx.h"

void PVD_Config(void) {
    // 使能PWR时钟
    RCC_APB1PeriphClockCmd(RCC_APB1Periph_PWR, ENABLE);

    // 配置PVD阈值
    PWR_PVDLevelConfig(PWR_PVDLevel_2V9);

    // 使能PVD
    PWR_PVDCmd(ENABLE);

    // 配置PVD中断
    EXTI_InitTypeDef EXTI_InitStructure;
    NVIC_InitTypeDef NVIC_InitStructure;

    EXTI_InitStructure.EXTI_Line = EXTI_Line16;
    EXTI_InitStructure.EXTI_Mode = EXTI_Mode_Interrupt;
    EXTI_InitStructure.EXTI_Trigger = EXTI_Trigger_Rising_Falling;
    EXTI_InitStructure.EXTI_LineCmd = ENABLE;
    EXTI_Init(&EXTI_InitStructure);

    NVIC_InitStructure.NVIC_IRQChannel = PVD_IRQn;
    NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;
    NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
    NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
    NVIC_Init(&NVIC_InitStructure);
}

void PVD_IRQHandler(void) {
    if (EXTI_GetITStatus(EXTI_Line16) != RESET) {
        // 处理PVD中断
        if (PWR_GetFlagStatus(PWR_FLAG_PVDO) != RESET) {
            // 电压低于阈值
        } else {
            // 电压恢复正常
        }
        EXTI_ClearITPendingBit(EXTI_Line16);
    }
}
```

:::note
**注意**：PVD的阈值可以根据具体需求进行配置，STM32提供了多个阈值选项，例如2.2V、2.3V、2.5V等。
:::

### 2. 低功耗电压检测（LVD）

低功耗电压检测（LVD）是STM32在低功耗模式下的一种电源监控功能。当系统进入低功耗模式时，LVD可以监测电源电压，确保系统在电压不足时能够及时唤醒或采取其他措施。

#### 配置LVD

以下是一个配置LVD的示例代码：

```c
#include "stm32f4xx.h"

void LVD_Config(void) {
    // 使能PWR时钟
    RCC_APB1PeriphClockCmd(RCC_APB1Periph_PWR, ENABLE);

    // 配置LVD阈值
    PWR_LVDLevelConfig(PWR_LVDLevel_2V2);

    // 使能LVD
    PWR_LVDCmd(ENABLE);
}
```

:::tip
**提示**：LVD功能在低功耗模式下非常有用，可以确保系统在电压不足时及时唤醒，避免数据丢失或系统崩溃。
:::

## 实际应用场景

### 电池供电设备

在电池供电的设备中，电源电压会随着电池电量的消耗而逐渐降低。通过使用STM32的PVD和LVD功能，开发者可以在电池电压低于设定阈值时及时采取措施，例如保存数据、进入低功耗模式或发出低电量警告。

### 工业控制系统

在工业控制系统中，电源稳定性至关重要。通过使用STM32的电源监控功能，开发者可以实时监测系统电源状态，确保在电源异常时及时采取措施，避免系统崩溃或数据丢失。

## 总结

STM32的电源监控功能是确保系统稳定运行的重要工具，尤其是在低功耗应用中。通过合理配置PVD和LVD，开发者可以有效监测电源电压，确保系统在电源异常时能够及时响应。

## 附加资源

- [STM32参考手册](https://www.st.com/resource/en/reference_manual/dm00031020-stm32f405-415-stm32f407-417-stm32f427-437-and-stm32f429-439-advanced-arm-based-32-bit-mcus-stmicroelectronics.pdf)
- [STM32低功耗模式指南](https://www.st.com/resource/en/application_note/dm00105879-ultralowpower-stm32l4-series-power-consumption-optimization-stmicroelectronics.pdf)

## 练习

1. 尝试在STM32开发板上配置PVD功能，并编写一个简单的程序，在电压低于阈值时点亮LED。
2. 研究STM32的低功耗模式，并结合LVD功能，设计一个电池供电设备的低功耗方案。
