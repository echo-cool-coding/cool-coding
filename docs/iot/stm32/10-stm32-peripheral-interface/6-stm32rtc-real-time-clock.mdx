---
title: STM32 RTC 实时时钟
description: 了解 STM32 微控制器中的 RTC（实时时钟）外设，学习如何配置和使用它来跟踪时间、日期和闹钟功能。
---

# STM32 RTC 实时时钟

## 介绍

实时时钟（RTC，Real-Time Clock）是 STM32 微控制器中的一个重要外设，用于跟踪时间、日期以及实现闹钟功能。RTC 通常由一个独立的电源供电（例如备用电池），以确保在主电源关闭时仍能继续运行。这使得 RTC 非常适合用于需要长时间记录时间戳的应用场景，例如数据记录、事件调度和低功耗设备。

在本教程中，我们将逐步介绍如何配置和使用 STM32 的 RTC 外设，并通过代码示例展示其基本功能。

---

## RTC 的基本概念

### RTC 的工作原理

RTC 的核心是一个 32 位计数器，通常以秒为单位递增。它还可以配置为支持日历功能，包括年、月、日、时、分和秒。RTC 通常由一个低频外部晶体振荡器（例如 32.768 kHz）驱动，以确保高精度和低功耗。

:::note
RTC 的电源通常由主电源和备用电池（VBAT）共同提供。当主电源关闭时，备用电池会维持 RTC 的运行。
:::

### RTC 的主要功能

1. **时间跟踪**：以秒、分钟、小时为单位记录时间。
2. **日期跟踪**：支持年、月、日的日历功能。
3. **闹钟功能**：可以在特定时间触发中断。
4. **周期性唤醒**：用于低功耗模式下的定时唤醒。

---

## 配置 STM32 的 RTC

### 硬件配置

在使用 RTC 之前，需要确保硬件电路正确连接。通常需要以下组件：

- 一个 32.768 kHz 的外部晶体振荡器。
- 备用电池（VBAT）以在主电源关闭时维持 RTC 运行。

### 软件配置

以下是使用 STM32 HAL 库配置 RTC 的基本步骤：

1. **启用 RTC 时钟**：通过 RCC 外设启用 RTC 时钟。
2. **初始化 RTC**：配置 RTC 的预分频器和时钟源。
3. **设置时间和日期**：通过 HAL 库函数设置初始时间和日期。
4. **启用闹钟功能**（可选）：配置闹钟并启用中断。

以下是一个简单的代码示例：

```c
#include "stm32f1xx_hal.h"

RTC_HandleTypeDef hrtc;

void SystemClock_Config(void);
static void MX_RTC_Init(void);

int main(void) {
    HAL_Init();
    SystemClock_Config();
    MX_RTC_Init();

    // 设置初始时间和日期
    RTC_TimeTypeDef sTime = {0};
    RTC_DateTypeDef sDate = {0};

    sTime.Hours = 12;
    sTime.Minutes = 0;
    sTime.Seconds = 0;
    sTime.DayLightSaving = RTC_DAYLIGHTSAVING_NONE;
    sTime.StoreOperation = RTC_STOREOPERATION_RESET;

    sDate.WeekDay = RTC_WEEKDAY_MONDAY;
    sDate.Month = RTC_MONTH_JANUARY;
    sDate.Date = 1;
    sDate.Year = 23; // 2023 年

    HAL_RTC_SetTime(&hrtc, &sTime, RTC_FORMAT_BIN);
    HAL_RTC_SetDate(&hrtc, &sDate, RTC_FORMAT_BIN);

    while (1) {
        // 主循环
    }
}

static void MX_RTC_Init(void) {
    hrtc.Instance = RTC;
    hrtc.Init.AsynchPrediv = RTC_AUTO_1_SECOND;
    hrtc.Init.OutPut = RTC_OUTPUTSOURCE_NONE;
    if (HAL_RTC_Init(&hrtc) != HAL_OK) {
        // 初始化错误处理
    }
}
```

---

## 实际应用场景

### 数据记录

在数据记录应用中，RTC 可以用于为每个数据点添加时间戳。例如，在环境监测系统中，RTC 可以记录温度、湿度和气压的测量时间。

### 低功耗设备

在电池供电的设备中，RTC 可以用于周期性唤醒系统以执行任务。例如，智能手表可以使用 RTC 每隔一秒唤醒一次以更新显示。

---

## 总结

STM32 的 RTC 外设是一个强大的工具，适用于需要精确时间跟踪和低功耗操作的应用。通过本教程，您已经学习了如何配置和使用 RTC 来跟踪时间、日期以及实现闹钟功能。

:::tip
如果您想进一步学习，可以尝试以下练习：
1. 修改代码以支持闹钟功能。
2. 使用 RTC 的周期性唤醒功能实现低功耗模式。
:::

---

## 附加资源

- [STM32 HAL 库文档](https://www.st.com)
- [STM32 RTC 参考手册](https://www.st.com)