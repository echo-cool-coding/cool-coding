---
title: STM32 DCMI 相机接口
description: 了解 STM32 微控制器中的数字摄像头接口（DCMI），掌握其工作原理、配置方法以及实际应用场景。
---

## 介绍

STM32 微控制器系列中的数字摄像头接口（Digital Camera Interface, DCMI）是一种用于连接外部图像传感器的硬件接口。它支持多种图像格式，如 YCbCr、RGB 和 JPEG，并能够高效地传输图像数据到内存中。DCMI 接口广泛应用于嵌入式视觉系统，如智能摄像头、机器视觉和物联网设备。

本教程将逐步介绍 DCMI 的工作原理、配置方法以及如何在实际项目中使用它。

---

## DCMI 的工作原理

DCMI 接口通过一组信号线与外部图像传感器通信，主要信号包括：

- **PIXCLK**：像素时钟信号，用于同步数据传输。
- **HSYNC**：水平同步信号，表示一行的开始和结束。
- **VSYNC**：垂直同步信号，表示一帧的开始和结束。
- **DATA[7:0]**：8 位数据总线，用于传输像素数据。

DCMI 支持以下工作模式：
1. **连续模式**：连续捕获图像帧。
2. **快照模式**：捕获单帧图像。

---

## 配置 DCMI 接口

以下是一个简单的 DCMI 配置示例，使用 STM32 HAL 库：

```c
#include "stm32f4xx_hal.h"

DCMI_HandleTypeDef hdcmi;

void DCMI_Init(void) {
    hdcmi.Instance = DCMI;
    hdcmi.Init.SynchroMode = DCMI_SYNCHRO_HARDWARE;
    hdcmi.Init.PCKPolarity = DCMI_PCKPOLARITY_RISING;
    hdcmi.Init.VSPolarity = DCMI_VSPOLARITY_HIGH;
    hdcmi.Init.HSPolarity = DCMI_HSPOLARITY_HIGH;
    hdcmi.Init.CaptureRate = DCMI_CR_ALL_FRAME;
    hdcmi.Init.ExtendedDataMode = DCMI_EXTEND_DATA_8B;
    hdcmi.Init.JPEGMode = DCMI_JPEG_DISABLE;

    if (HAL_DCMI_Init(&hdcmi) != HAL_OK) {
        // 初始化错误处理
    }
}
```

:::note
确保在 `stm32f4xx_hal_conf.h` 中启用了 DCMI 模块，并正确配置了时钟和外设引脚。
:::

---

## 捕获图像数据

配置完成后，可以使用以下代码启动图像捕获：

```c
uint32_t imageBuffer[320 * 240]; // 假设图像分辨率为 320x240

void Start_Capture(void) {
    if (HAL_DCMI_Start_DMA(&hdcmi, DCMI_MODE_CONTINUOUS, (uint32_t)imageBuffer, sizeof(imageBuffer)) != HAL_OK) {
        // 启动捕获失败处理
    }
}
```

捕获完成后，图像数据将存储在 `imageBuffer` 中。

---

## 实际应用案例

### 案例：智能门铃摄像头

在一个智能门铃项目中，DCMI 接口用于连接 OV2640 图像传感器。当有人按下门铃时，系统会捕获一张图像并通过 Wi-Fi 发送到用户的手机。

```c
void Doorbell_Event(void) {
    Start_Capture();
    while (!HAL_DCMI_GetState(&hdcmi)) {
        // 等待图像捕获完成
    }
    Send_Image_Over_WiFi(imageBuffer);
}
```

:::tip
在实际项目中，建议使用 DMA 传输以减少 CPU 负载，并优化图像处理算法以提高性能。
:::

---

## 总结

STM32 的 DCMI 接口为嵌入式视觉应用提供了强大的支持。通过本教程，您已经了解了 DCMI 的基本原理、配置方法以及如何在实际项目中使用它。希望这些知识能帮助您在未来的项目中实现更多创新功能。

---

## 附加资源与练习

### 资源
- [STM32 参考手册](https://www.st.com/resource/en/reference_manual/rm0090-stm32f4xx-reference-manual-stmicroelectronics.pdf)
- [STM32 HAL 库文档](https://www.st.com/en/embedded-software/stm32cubef4.html)

### 练习
1. 修改代码，使其支持 JPEG 格式的图像捕获。
2. 尝试使用 DCMI 的快照模式，捕获单帧图像并保存到 SD 卡中。
3. 结合 FreeRTOS，实现多任务环境下的图像捕获和处理。

祝您学习愉快！