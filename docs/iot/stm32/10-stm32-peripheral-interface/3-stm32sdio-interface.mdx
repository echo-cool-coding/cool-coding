---
title: STM32 SDIO 接口
description: 了解 STM32 微控制器中的 SDIO 接口，掌握其工作原理、配置方法以及实际应用场景。
---

## 介绍

SDIO（Secure Digital Input Output）接口是 STM32 微控制器中用于与 SD 卡或 SDIO 设备通信的硬件接口。它基于 SD 卡协议，支持高速数据传输，广泛应用于存储扩展、无线通信模块（如 Wi-Fi 模块）等场景。本文将详细介绍 STM32 的 SDIO 接口，包括其工作原理、配置步骤以及实际应用案例。

---

## SDIO 接口概述

SDIO 接口是 STM32 微控制器中的一个外设模块，支持以下功能：
- 与 SD 卡通信（SD 存储卡）。
- 与 SDIO 设备通信（如 Wi-Fi 模块、蓝牙模块等）。
- 支持多种数据传输模式：单线模式、4 线模式和 8 线模式。
- 支持高时钟频率（最高可达 48 MHz）。

SDIO 接口通过以下信号线与外部设备通信：
- `CLK`：时钟信号，由 STM32 提供。
- `CMD`：命令信号，用于发送命令和接收响应。
- `DAT0-DAT3`：数据信号，用于数据传输（4 线模式）。
- `DAT4-DAT7`：扩展数据信号（8 线模式）。

---

## SDIO 接口的工作原理

SDIO 接口的通信基于命令-响应机制。STM32 通过发送命令（CMD）来控制 SD 卡或 SDIO 设备，设备通过响应（RESP）返回状态或数据。数据传输通过数据线（DAT）完成。

### 通信流程
1. **初始化**：STM32 发送初始化命令（如 `CMD0`）以复位设备。
2. **识别设备**：发送 `CMD8` 和 `CMD55` 等命令，获取设备的类型和支持的功能。
3. **设置工作模式**：通过 `ACMD41` 命令设置设备的工作模式（如高容量模式）。
4. **数据传输**：使用读写命令（如 `CMD17` 和 `CMD24`）进行数据传输。

---

## 配置 STM32 的 SDIO 接口

以下是配置 STM32 SDIO 接口的基本步骤：

### 1. 启用时钟
首先，启用 SDIO 外设和 GPIO 端口的时钟。

```c
RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC, ENABLE); // 启用 GPIO 时钟
RCC_AHB3PeriphClockCmd(RCC_AHB3Periph_SDIO, ENABLE);  // 启用 SDIO 时钟
```

### 2. 配置 GPIO 引脚
将 GPIO 引脚配置为复用功能模式，以支持 SDIO 信号。

```c
GPIO_InitTypeDef GPIO_InitStruct;
GPIO_InitStruct.GPIO_Pin = GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10 | GPIO_Pin_11 | GPIO_Pin_12;
GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF_PP;
GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;
GPIO_Init(GPIOC, &GPIO_InitStruct);
```

### 3. 配置 SDIO 外设
设置 SDIO 的时钟频率、总线宽度等参数。

```c
SDIO_InitTypeDef SDIO_InitStruct;
SDIO_InitStruct.SDIO_ClockDiv = SDIO_ClockDiv_4; // 设置时钟分频
SDIO_InitStruct.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
SDIO_InitStruct.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
SDIO_InitStruct.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
SDIO_InitStruct.SDIO_BusWide = SDIO_BusWide_4b; // 4 线模式
SDIO_InitStruct.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
SDIO_Init(&SDIO_InitStruct);
```

### 4. 初始化 SD 卡
发送初始化命令并等待 SD 卡响应。

```c
SDIO_CmdInitTypeDef SDIO_CmdInitStruct;
SDIO_CmdInitStruct.SDIO_Argument = 0x00000000;
SDIO_CmdInitStruct.SDIO_CmdIndex = SDIO_CMD_0; // CMD0: 复位 SD 卡
SDIO_CmdInitStruct.SDIO_Response = SDIO_Response_No;
SDIO_CmdInitStruct.SDIO_Wait = SDIO_Wait_No;
SDIO_CmdInitStruct.SDIO_CPSM = SDIO_CPSM_Enable;
SDIO_SendCommand(&SDIO_CmdInitStruct);
```

---

## 实际应用案例

### 案例：读取 SD 卡文件
以下是一个简单的示例，展示如何使用 STM32 的 SDIO 接口读取 SD 卡中的文件。

```c
// 初始化 SD 卡
if (SD_Init() == SD_OK) {
    // 打开文件
    FIL file;
    if (f_open(&file, "example.txt", FA_READ) == FR_OK) {
        char buffer[100];
        UINT bytesRead;
        // 读取文件内容
        f_read(&file, buffer, sizeof(buffer), &bytesRead);
        // 打印文件内容
        printf("File content: %s\n", buffer);
        // 关闭文件
        f_close(&file);
    }
}
```

:::tip
在实际项目中，建议使用 FATFS 文件系统库来管理 SD 卡中的文件。
:::

---

## 总结

STM32 的 SDIO 接口是一个强大的外设模块，支持与 SD 卡和 SDIO 设备的高效通信。通过本文的介绍，您已经了解了 SDIO 接口的工作原理、配置方法以及实际应用场景。希望这些内容能帮助您在项目中更好地使用 SDIO 接口。

---

## 附加资源与练习

### 资源
- [STM32 参考手册](https://www.st.com/resource/en/reference_manual/rm0008-stm32f101xx-stm32f102xx-stm32f103xx-stm32f105xx-and-stm32f107xx-advanced-armbased-32bit-mcus-stmicroelectronics.pdf)
- [FATFS 文件系统库](http://elm-chan.org/fsw/ff/00index_e.html)

### 练习
1. 尝试修改代码，使用 8 线模式进行数据传输。
2. 使用 SDIO 接口连接 Wi-Fi 模块，并实现简单的网络通信功能。
3. 编写一个程序，将传感器数据存储到 SD 卡中。