---
title: Arduino 断电恢复
description: 了解如何在Arduino设备断电后恢复其状态，确保项目在电源恢复后继续正常运行。本文适合初学者，包含代码示例和实际应用场景。
---

## 介绍

在Arduino项目中，电源管理是一个重要的主题。断电恢复是指当Arduino设备因电源中断而关闭后，如何在电源恢复时继续执行之前的任务或恢复到特定的状态。这对于需要长时间运行的项目尤为重要，例如环境监测、自动化控制系统等。

本文将逐步讲解如何实现Arduino断电恢复，并提供代码示例和实际应用场景。

## 断电恢复的基本概念

Arduino断电恢复的核心思想是在断电前保存关键数据，以便在电源恢复后能够读取这些数据并恢复到之前的状态。通常，我们可以使用EEPROM（电可擦可编程只读存储器）或外部存储设备（如SD卡）来保存数据。

### EEPROM简介

EEPROM是Arduino板上的一种非易失性存储器，即使在断电后，数据也不会丢失。Arduino的EEPROM库提供了简单的接口来读写数据。

## 实现断电恢复的步骤

### 1. 保存数据到EEPROM

在Arduino断电前，我们需要将关键数据保存到EEPROM中。以下是一个简单的示例，展示如何将数据保存到EEPROM：

```cpp
#include <EEPROM.h>

void setup() {
  int value = 123; // 要保存的数据
  EEPROM.write(0, value); // 将数据保存到EEPROM的地址0
}

void loop() {
  // 主循环
}
```

### 2. 从EEPROM读取数据

在电源恢复后，Arduino可以从EEPROM中读取之前保存的数据，并恢复到之前的状态。以下是一个示例：

```cpp
#include <EEPROM.h>

void setup() {
  int value = EEPROM.read(0); // 从EEPROM的地址0读取数据
  Serial.begin(9600);
  Serial.print("恢复的值: ");
  Serial.println(value);
}

void loop() {
  // 主循环
}
```

### 3. 实际应用场景

假设我们正在开发一个环境监测系统，该系统需要记录温度数据。如果电源中断，我们希望系统能够在电源恢复后继续记录温度数据，而不是从头开始。

以下是一个完整的示例：

```cpp
#include <EEPROM.h>

int temperatureAddress = 0; // EEPROM地址
int lastTemperature = 0;

void setup() {
  Serial.begin(9600);
  lastTemperature = EEPROM.read(temperatureAddress); // 读取上次保存的温度
  Serial.print("上次记录的温度: ");
  Serial.println(lastTemperature);
}

void loop() {
  int currentTemperature = readTemperature(); // 假设这是一个读取温度的函数
  if (currentTemperature != lastTemperature) {
    EEPROM.write(temperatureAddress, currentTemperature); // 保存当前温度
    lastTemperature = currentTemperature;
    Serial.print("新温度已保存: ");
    Serial.println(currentTemperature);
  }
  delay(1000); // 每秒检查一次温度
}

int readTemperature() {
  // 模拟读取温度
  return analogRead(A0) / 10;
}
```

:::note
在实际应用中，`readTemperature()`函数应根据具体的传感器实现。
:::

## 总结

通过使用EEPROM，我们可以轻松实现Arduino断电恢复功能。这对于需要长时间运行的项目尤为重要，可以确保数据不会因电源中断而丢失。

## 附加资源与练习

- **练习1**: 修改上述代码，使其能够保存多个温度值到EEPROM的不同地址。
- **练习2**: 尝试使用外部存储设备（如SD卡）来实现断电恢复功能。

:::tip
了解更多关于EEPROM的使用，可以参考Arduino官方文档：[EEPROM Library](https://www.arduino.cc/en/Reference/EEPROM)
:::

通过本文的学习，你应该已经掌握了Arduino断电恢复的基本概念和实现方法。希望你能将这些知识应用到自己的项目中，提升项目的稳定性和可靠性。