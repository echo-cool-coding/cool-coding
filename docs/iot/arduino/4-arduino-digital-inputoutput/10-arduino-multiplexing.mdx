---
title: Arduino 多路复用
description: 了解如何使用Arduino实现多路复用，扩展输入输出引脚的功能，并学习其实际应用场景。
---

# Arduino 多路复用

## 介绍

在Arduino项目中，我们经常会遇到需要控制多个设备或读取多个传感器的情况。然而，Arduino的引脚数量有限，尤其是像Arduino Uno这样的开发板，只有14个数字引脚和6个模拟引脚。为了扩展这些引脚的功能，我们可以使用**多路复用**技术。

多路复用（Multiplexing）是一种通过共享资源来扩展输入输出能力的技术。它允许我们使用较少的引脚来控制或读取更多的设备或传感器。在Arduino中，多路复用通常通过使用**多路复用器（Multiplexer）**来实现。

## 多路复用器的工作原理

多路复用器是一种电子设备，它可以将多个输入信号通过一个输出通道传输，或者将一个输入信号分配到多个输出通道。常见的多路复用器有**模拟多路复用器**和**数字多路复用器**。

### 模拟多路复用器

模拟多路复用器通常用于扩展模拟输入引脚。例如，CD4051是一个8通道的模拟多路复用器，它可以将8个模拟信号通过一个输出引脚传输到Arduino的模拟输入引脚。

### 数字多路复用器

数字多路复用器通常用于扩展数字输入输出引脚。例如，74HC595是一个8位串行输入、并行输出的移位寄存器，它可以通过3个数字引脚控制8个输出设备。

## 使用多路复用器的步骤

### 1. 连接多路复用器

首先，我们需要将多路复用器连接到Arduino。以CD4051为例，我们需要将多路复用器的输入引脚连接到Arduino的模拟输入引脚，并将多路复用器的控制引脚连接到Arduino的数字引脚。

```arduino
// CD4051引脚连接
const int controlPinA = 2;  // 控制引脚A
const int controlPinB = 3;  // 控制引脚B
const int controlPinC = 4;  // 控制引脚C
const int analogInputPin = A0;  // 模拟输入引脚
```

### 2. 选择通道

通过设置控制引脚的高低电平，我们可以选择多路复用器的通道。例如，要选择通道0，我们可以将控制引脚A、B、C都设置为低电平。

```arduino
void selectChannel(int channel) {
  digitalWrite(controlPinA, bitRead(channel, 0));
  digitalWrite(controlPinB, bitRead(channel, 1));
  digitalWrite(controlPinC, bitRead(channel, 2));
}
```

### 3. 读取或写入数据

在选择通道后，我们可以通过Arduino的模拟输入引脚读取数据，或者通过数字输出引脚写入数据。

```arduino
int readAnalogInput(int channel) {
  selectChannel(channel);
  return analogRead(analogInputPin);
}
```

## 实际应用案例

### 案例1：多路传感器读取

假设我们有一个项目需要读取8个温度传感器的数据。我们可以使用CD4051多路复用器将8个传感器的信号通过一个模拟输入引脚传输到Arduino。

```arduino
void setup() {
  pinMode(controlPinA, OUTPUT);
  pinMode(controlPinB, OUTPUT);
  pinMode(controlPinC, OUTPUT);
  Serial.begin(9600);
}

void loop() {
  for (int i = 0; i < 8; i++) {
    int sensorValue = readAnalogInput(i);
    Serial.print("Sensor ");
    Serial.print(i);
    Serial.print(": ");
    Serial.println(sensorValue);
    delay(1000);
  }
}
```

### 案例2：多路LED控制

假设我们有一个项目需要控制8个LED灯。我们可以使用74HC595多路复用器通过3个数字引脚控制8个LED灯。

```arduino
const int dataPin = 8;  // 数据引脚
const int latchPin = 9;  // 锁存引脚
const int clockPin = 10;  // 时钟引脚

void setup() {
  pinMode(dataPin, OUTPUT);
  pinMode(latchPin, OUTPUT);
  pinMode(clockPin, OUTPUT);
}

void loop() {
  for (int i = 0; i < 8; i++) {
    digitalWrite(latchPin, LOW);
    shiftOut(dataPin, clockPin, LSBFIRST, 1 << i);
    digitalWrite(latchPin, HIGH);
    delay(500);
  }
}
```

## 总结

多路复用是一种非常实用的技术，它可以帮助我们在Arduino项目中扩展输入输出引脚的功能。通过使用多路复用器，我们可以控制更多的设备或读取更多的传感器，从而节省宝贵的引脚资源。

:::tip
在实际项目中，选择合适的多路复用器非常重要。根据项目的需求，选择模拟多路复用器或数字多路复用器，并确保正确连接和控制。
:::

## 附加资源与练习

- **练习1**：尝试使用CD4051多路复用器读取8个光敏电阻的值，并将结果显示在串口监视器中。
- **练习2**：使用74HC595多路复用器控制16个LED灯，并实现流水灯效果。
- **资源**：[Arduino官方文档](https://www.arduino.cc/) 和 [多路复用器数据手册](https://www.ti.com/lit/ds/symlink/cd4051b.pdf) 是学习更多关于多路复用的好资源。

通过以上内容，你应该已经掌握了Arduino多路复用的基本概念和应用方法。继续实践和探索，你会发现多路复用技术在Arduino项目中的无限潜力！