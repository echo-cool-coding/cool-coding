---
title: Arduino 库创建
description: 学习如何创建自己的Arduino库，以便在项目中重用代码并提高开发效率。
---

# Arduino 库创建

在Arduino开发中，库（Library）是一个非常重要的概念。它允许你将常用的代码封装起来，以便在不同的项目中重复使用。通过创建自己的Arduino库，你可以提高代码的可维护性和可重用性。本文将详细介绍如何创建Arduino库，并通过实际案例帮助你理解这一过程。

## 什么是Arduino库？

Arduino库是一组相关的函数和类的集合，通常用于实现特定的功能。例如，Arduino自带的`Servo`库用于控制伺服电机，`Wire`库用于I2C通信。通过使用库，你可以避免重复编写相同的代码，从而专注于项目的核心逻辑。

## 创建Arduino库的基本步骤

### 1. 创建库的文件夹结构

首先，你需要为你的库创建一个文件夹结构。通常，一个Arduino库包含以下文件：

- `库名.h`：头文件，包含类的声明和函数的原型。
- `库名.cpp`：源文件，包含类的实现和函数的定义。
- `keywords.txt`（可选）：用于定义库中的关键字，以便在Arduino IDE中高亮显示。
- `examples`文件夹（可选）：包含使用该库的示例代码。

### 2. 编写头文件（.h）

头文件通常包含类的声明和函数的原型。以下是一个简单的头文件示例：

```cpp
#ifndef MyLibrary_h
#define MyLibrary_h

#include "Arduino.h"

class MyLibrary {
  public:
    MyLibrary(int pin);
    void begin();
    void doSomething();
  private:
    int _pin;
};

#endif
```

在这个示例中，我们定义了一个名为`MyLibrary`的类，它包含一个构造函数、一个`begin()`函数和一个`doSomething()`函数。

### 3. 编写源文件（.cpp）

源文件包含类的实现和函数的定义。以下是一个简单的源文件示例：

```cpp
#include "MyLibrary.h"

MyLibrary::MyLibrary(int pin) {
  _pin = pin;
}

void MyLibrary::begin() {
  pinMode(_pin, OUTPUT);
}

void MyLibrary::doSomething() {
  digitalWrite(_pin, HIGH);
  delay(1000);
  digitalWrite(_pin, LOW);
}
```

在这个示例中，我们实现了`MyLibrary`类的构造函数、`begin()`函数和`doSomething()`函数。

### 4. 添加示例代码（可选）

为了帮助其他开发者使用你的库，你可以添加一些示例代码。将示例代码放在`examples`文件夹中。以下是一个简单的示例代码：

```cpp
#include <MyLibrary.h>

MyLibrary myLib(13);

void setup() {
  myLib.begin();
}

void loop() {
  myLib.doSomething();
  delay(1000);
}
```

在这个示例中，我们创建了一个`MyLibrary`对象，并在`setup()`函数中调用`begin()`函数，在`loop()`函数中调用`doSomething()`函数。

### 5. 添加`keywords.txt`文件（可选）

`keywords.txt`文件用于定义库中的关键字，以便在Arduino IDE中高亮显示。以下是一个简单的`keywords.txt`文件示例：

```
MyLibrary KEYWORD1
begin KEYWORD2
doSomething KEYWORD2
```

在这个示例中，我们将`MyLibrary`定义为`KEYWORD1`，将`begin`和`doSomething`定义为`KEYWORD2`。

## 实际案例：创建一个LED控制库

让我们通过一个实际案例来展示如何创建一个简单的LED控制库。这个库将允许你轻松地控制一个LED的开关。

### 1. 创建文件夹结构

首先，创建一个名为`LEDControl`的文件夹，并在其中创建以下文件：

- `LEDControl.h`
- `LEDControl.cpp`
- `examples/LEDBlink/LEDBlink.ino`

### 2. 编写头文件

在`LEDControl.h`文件中，添加以下代码：

```cpp
#ifndef LEDControl_h
#define LEDControl_h

#include "Arduino.h"

class LEDControl {
  public:
    LEDControl(int pin);
    void begin();
    void on();
    void off();
  private:
    int _pin;
};

#endif
```

### 3. 编写源文件

在`LEDControl.cpp`文件中，添加以下代码：

```cpp
#include "LEDControl.h"

LEDControl::LEDControl(int pin) {
  _pin = pin;
}

void LEDControl::begin() {
  pinMode(_pin, OUTPUT);
}

void LEDControl::on() {
  digitalWrite(_pin, HIGH);
}

void LEDControl::off() {
  digitalWrite(_pin, LOW);
}
```

### 4. 添加示例代码

在`examples/LEDBlink/LEDBlink.ino`文件中，添加以下代码：

```cpp
#include <LEDControl.h>

LEDControl led(13);

void setup() {
  led.begin();
}

void loop() {
  led.on();
  delay(1000);
  led.off();
  delay(1000);
}
```

### 5. 测试库

将`LEDControl`文件夹放入Arduino的`libraries`文件夹中，然后打开Arduino IDE。你应该能够在示例菜单中找到`LEDBlink`示例。上传代码到Arduino板，LED应该会以1秒的间隔闪烁。

## 总结

通过创建自己的Arduino库，你可以将常用的代码封装起来，以便在不同的项目中重复使用。本文介绍了创建Arduino库的基本步骤，并通过一个实际案例展示了如何创建一个简单的LED控制库。希望本文能帮助你更好地理解Arduino库的创建过程，并在你的项目中应用这一技能。

## 附加资源

- [Arduino官方库创建指南](https://www.arduino.cc/en/Hacking/LibraryTutorial)
- [Arduino库开发最佳实践](https://www.arduino.cc/en/Guide/Libraries)

## 练习

1. 尝试创建一个库，用于控制多个LED的开关。
2. 扩展`LEDControl`库，添加一个`blink()`函数，用于控制LED的闪烁频率。
3. 创建一个库，用于读取模拟传感器的值，并将其转换为实际物理量（如温度或湿度）。
