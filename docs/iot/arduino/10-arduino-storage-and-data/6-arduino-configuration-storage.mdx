---
title: Arduino 配置存储
description: 了解如何在Arduino中存储和读取配置数据，包括EEPROM的使用方法和实际应用场景。
---

# Arduino 配置存储

在Arduino项目中，配置存储是一个非常重要的概念。它允许你在设备断电后仍然保留关键数据，例如用户设置、校准值或其他需要持久化的信息。Arduino提供了多种存储方式，其中最常用的是**EEPROM**（Electrically Erasable Programmable Read-Only Memory）。本文将详细介绍如何使用EEPROM来存储和读取配置数据。

## 什么是EEPROM？

EEPROM是一种非易失性存储器，即使在断电后也能保留数据。Arduino的微控制器（如ATmega328P）通常内置了一定大小的EEPROM（例如1KB）。与RAM不同，EEPROM的数据不会在断电后丢失，因此非常适合存储配置信息。

:::note
EEPROM的写入次数有限（通常为100,000次），因此应避免频繁写入数据。
:::

## 使用EEPROM存储数据

Arduino IDE提供了一个内置的`EEPROM`库，可以方便地读写EEPROM中的数据。以下是一个简单的示例，展示如何将数据写入EEPROM并读取出来。

### 示例代码

```cpp
#include <EEPROM.h>

void setup() {
  Serial.begin(9600);

  // 写入数据到EEPROM
  int address = 0; // 存储地址
  int value = 123; // 要存储的值
  EEPROM.write(address, value);

  // 从EEPROM读取数据
  int readValue = EEPROM.read(address);
  Serial.print("读取的值: ");
  Serial.println(readValue);
}

void loop() {
  // 主循环中不需要执行任何操作
}
```

### 代码解释

1. **`EEPROM.write(address, value)`**: 将`value`写入指定的`address`位置。
2. **`EEPROM.read(address)`**: 从指定的`address`位置读取数据。

### 输入与输出

- **输入**: 将值`123`写入EEPROM的地址`0`。
- **输出**: 从地址`0`读取值并打印到串口监视器，输出为`123`。

## 存储复杂数据

有时我们需要存储更复杂的数据类型，例如结构体或字符串。以下是一个存储和读取结构体的示例。

### 示例代码

```cpp
#include <EEPROM.h>

struct Settings {
  int brightness;
  int volume;
};

void setup() {
  Serial.begin(9600);

  // 创建并初始化结构体
  Settings mySettings = {100, 50};

  // 将结构体写入EEPROM
  int address = 0;
  EEPROM.put(address, mySettings);

  // 从EEPROM读取结构体
  Settings readSettings;
  EEPROM.get(address, readSettings);

  Serial.print("亮度: ");
  Serial.println(readSettings.brightness);
  Serial.print("音量: ");
  Serial.println(readSettings.volume);
}

void loop() {
  // 主循环中不需要执行任何操作
}
```

### 代码解释

1. **`EEPROM.put(address, data)`**: 将`data`写入指定的`address`位置。
2. **`EEPROM.get(address, data)`**: 从指定的`address`位置读取数据并存储到`data`中。

### 输入与输出

- **输入**: 将结构体`mySettings`写入EEPROM。
- **输出**: 从EEPROM读取结构体并打印亮度`100`和音量`50`。

## 实际应用场景

### 场景1：保存用户设置

假设你正在开发一个智能灯控系统，用户可以通过手机应用调整灯的亮度和颜色。为了在断电后恢复用户设置，你可以将这些设置存储在EEPROM中。

### 场景2：保存校准值

在传感器校准过程中，可能需要存储校准值。例如，温度传感器的偏移量可以存储在EEPROM中，以便在每次启动时自动应用。

## 总结

EEPROM是Arduino中用于持久化存储数据的强大工具。通过`EEPROM`库，你可以轻松地存储和读取配置数据，确保设备在断电后仍能保留关键信息。虽然EEPROM的写入次数有限，但在大多数应用中，合理使用它可以满足需求。

## 附加资源与练习

- **练习1**: 尝试将多个配置值存储到EEPROM中，并在启动时读取它们。
- **练习2**: 编写一个程序，允许用户通过串口输入配置值，并将其存储到EEPROM中。

:::tip
如果你需要存储大量数据或频繁写入数据，可以考虑使用外部存储设备，如SD卡或外部EEPROM芯片。
:::

希望本文能帮助你更好地理解Arduino中的配置存储。如果你有任何问题或需要进一步的帮助，请参考Arduino官方文档或社区论坛。