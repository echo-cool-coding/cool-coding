---
title: Arduino Flash存储
description: "了解如何在Arduino中使用Flash存储来保存数据，包括基本概念、代码示例和实际应用场景。"
---

# Arduino Flash存储

## 介绍

在Arduino开发中，Flash存储是一种非易失性存储器，用于存储程序代码和常量数据。与RAM（随机存取存储器）不同，Flash存储即使在断电后也能保留数据。这使得它非常适合存储不会频繁更改的数据，例如配置参数、查找表或固件代码。

在本教程中，我们将探讨如何在Arduino中使用Flash存储来保存数据，并通过代码示例和实际案例帮助你理解这一概念。

## Flash存储的基本概念

Arduino的Flash存储通常用于存储程序代码和常量数据。与RAM不同，Flash存储的写入次数有限，因此不适合频繁写入数据。然而，它非常适合存储不会频繁更改的数据。

### Flash存储的特点

- **非易失性**：数据在断电后不会丢失。
- **写入次数有限**：Flash存储的写入次数通常在10,000到100,000次之间。
- **读取速度快**：读取Flash存储中的数据非常快。

### Flash存储的使用场景

- 存储程序代码
- 存储常量数据（如查找表、配置参数）
- 存储固件更新

## 在Arduino中使用Flash存储

在Arduino中，Flash存储通常用于存储常量数据。我们可以使用`PROGMEM`关键字将数据存储在Flash中，而不是RAM中。

### 使用`PROGMEM`存储数据

`PROGMEM`是Arduino提供的一个关键字，用于将数据存储在Flash中。以下是一个简单的示例，展示如何使用`PROGMEM`存储一个字符串数组：

```cpp
#include <avr/pgmspace.h>

const char myStrings[][20] PROGMEM = {
  "Hello, World!",
  "Arduino Flash Storage",
  "PROGMEM Example"
};

void setup() {
  Serial.begin(9600);

  for (int i = 0; i < 3; i++) {
    char buffer[20];
    strcpy_P(buffer, (char*)pgm_read_word(&(myStrings[i])));
    Serial.println(buffer);
  }
}

void loop() {
  // 空循环
}
```

### 代码解释

1. **`PROGMEM`关键字**：将`myStrings`数组存储在Flash中。
2. **`pgm_read_word`函数**：从Flash中读取数据。
3. **`strcpy_P`函数**：将Flash中的字符串复制到RAM中的缓冲区。

### 输出

```
Hello, World!
Arduino Flash Storage
PROGMEM Example
```

## 实际应用案例

### 案例1：存储查找表

假设你正在开发一个需要快速访问大量数据的项目，例如LED灯的颜色值。将这些数据存储在Flash中可以节省RAM空间。

```cpp
#include <avr/pgmspace.h>

const uint16_t colorTable[][3] PROGMEM = {
  {255, 0, 0},   // 红色
  {0, 255, 0},   // 绿色
  {0, 0, 255},   // 蓝色
  {255, 255, 0}, // 黄色
  {255, 0, 255}, // 品红
  {0, 255, 255}  // 青色
};

void setup() {
  Serial.begin(9600);

  for (int i = 0; i < 6; i++) {
    uint16_t red = pgm_read_word(&(colorTable[i][0]));
    uint16_t green = pgm_read_word(&(colorTable[i][1]));
    uint16_t blue = pgm_read_word(&(colorTable[i][2]));

    Serial.print("Color ");
    Serial.print(i);
    Serial.print(": R=");
    Serial.print(red);
    Serial.print(", G=");
    Serial.print(green);
    Serial.print(", B=");
    Serial.println(blue);
  }
}

void loop() {
  // 空循环
}
```

### 输出

```
Color 0: R=255, G=0, B=0
Color 1: R=0, G=255, B=0
Color 2: R=0, G=0, B=255
Color 3: R=255, G=255, B=0
Color 4: R=255, G=0, B=255
Color 5: R=0, G=255, B=255
```

### 案例2：存储配置参数

假设你有一个需要存储配置参数的项目，例如Wi-Fi的SSID和密码。将这些参数存储在Flash中可以确保它们在断电后不会丢失。

```cpp
#include <avr/pgmspace.h>

const char wifiSSID[] PROGMEM = "MyWiFiNetwork";
const char wifiPassword[] PROGMEM = "MySecurePassword";

void setup() {
  Serial.begin(9600);

  char ssidBuffer[20];
  char passwordBuffer[20];

  strcpy_P(ssidBuffer, wifiSSID);
  strcpy_P(passwordBuffer, wifiPassword);

  Serial.print("SSID: ");
  Serial.println(ssidBuffer);
  Serial.print("Password: ");
  Serial.println(passwordBuffer);
}

void loop() {
  // 空循环
}
```

### 输出

```
SSID: MyWiFiNetwork
Password: MySecurePassword
```

## 总结

在本教程中，我们探讨了如何在Arduino中使用Flash存储来保存数据。我们介绍了`PROGMEM`关键字的使用方法，并通过代码示例展示了如何存储和读取Flash中的数据。我们还通过实际案例展示了Flash存储的应用场景。

:::tip
Flash存储非常适合存储不会频繁更改的数据，例如配置参数、查找表或固件代码。使用`PROGMEM`可以有效地节省RAM空间。
:::

## 附加资源与练习

### 附加资源

- [Arduino PROGMEM文档](https://www.arduino.cc/reference/en/language/variables/utilities/progmem/)
- [AVR Libc文档](https://www.nongnu.org/avr-libc/user-manual/group__avr__pgmspace.html)

### 练习

1. 修改案例1中的代码，添加更多的颜色值并打印出来。
2. 尝试将你的项目中的某些常量数据存储在Flash中，并观察RAM使用情况的变化。
3. 研究如何在Arduino中使用EEPROM存储数据，并与Flash存储进行比较。

通过完成这些练习，你将更深入地理解Arduino中的Flash存储及其应用。