---
title: Arduino 定时器基础
description: 学习Arduino定时器的基本概念、工作原理以及如何在实际项目中应用定时器功能。
---

# Arduino 定时器基础

## 介绍

在Arduino编程中，定时器是一个非常重要的工具，它允许你在特定的时间间隔内执行某些任务，而无需依赖`delay()`函数。定时器可以帮助你实现精确的时间控制，例如定时读取传感器数据、控制LED闪烁频率或生成PWM信号。

Arduino Uno等基于ATmega328P的微控制器内置了多个硬件定时器，这些定时器可以用于各种时间相关的任务。本文将介绍Arduino定时器的基本概念、工作原理以及如何在实际项目中使用它们。

## 定时器的工作原理

Arduino的定时器是基于计数器的硬件模块。它们通过计数时钟脉冲来测量时间。每个定时器都有一个计数器寄存器，当计数器达到某个特定值时，会触发一个中断或执行其他操作。

Arduino Uno有三个定时器：
- **Timer0**：8位定时器，通常用于`delay()`和`millis()`函数。
- **Timer1**：16位定时器，功能更强大，适用于更复杂的任务。
- **Timer2**：8位定时器，类似于Timer0，但可以用于其他用途。

### 定时器的基本概念

- **预分频器（Prescaler）**：用于降低时钟频率，从而延长定时器的计数时间。预分频器可以将系统时钟分频为更低的频率，例如1/8、1/64等。
- **计数器寄存器（TCNTn）**：存储当前计数值的寄存器。
- **比较匹配寄存器（OCRnA/B/C）**：用于设置比较值，当计数器达到该值时，会触发中断或其他操作。
- **溢出（Overflow）**：当计数器达到最大值并回滚到0时，称为溢出。

## 使用定时器的基本步骤

1. **选择定时器**：根据任务需求选择合适的定时器。
2. **配置预分频器**：设置预分频器以调整定时器的计数速度。
3. **设置比较匹配值**：根据所需的时间间隔设置比较匹配寄存器。
4. **启用中断**：如果需要，启用定时器中断以在特定时间执行代码。
5. **编写中断服务例程（ISR）**：在中断发生时执行的代码。

## 代码示例：使用Timer1实现LED闪烁

以下是一个简单的示例，展示如何使用Timer1定时器来控制LED的闪烁频率。

```cpp
#include <avr/io.h>
#include <avr/interrupt.h>

void setup() {
  // 设置LED引脚为输出
  pinMode(LED_BUILTIN, OUTPUT);

  // 配置Timer1
  TCCR1A = 0; // 清零TCCR1A寄存器
  TCCR1B = 0; // 清零TCCR1B寄存器
  TCNT1 = 0;  // 初始化计数器值为0

  // 设置比较匹配值为15624（1秒间隔，16MHz时钟，1024预分频）
  OCR1A = 15624;

  // 开启CTC模式（比较匹配时清零计数器）
  TCCR1B |= (1 << WGM12);

  // 设置预分频器为1024
  TCCR1B |= (1 << CS12) | (1 << CS10);

  // 启用比较匹配中断
  TIMSK1 |= (1 << OCIE1A);

  // 启用全局中断
  sei();
}

void loop() {
  // 主循环中无需任何操作
}

// 中断服务例程
ISR(TIMER1_COMPA_vect) {
  // 切换LED状态
  digitalWrite(LED_BUILTIN, !digitalRead(LED_BUILTIN));
}
```

### 代码解释

- **TCCR1A** 和 **TCCR1B**：定时器控制寄存器，用于配置定时器的工作模式。
- **TCNT1**：定时器计数器寄存器，存储当前计数值。
- **OCR1A**：比较匹配寄存器，当计数器达到该值时触发中断。
- **TIMSK1**：定时器中断屏蔽寄存器，用于启用或禁用中断。

### 输出

该代码将使Arduino板上的内置LED每隔1秒闪烁一次。

## 实际应用案例

### 案例1：精确控制步进电机

在控制步进电机时，定时器可以用于生成精确的脉冲信号，从而控制电机的转速和步进角度。通过调整定时器的比较匹配值，可以实现不同的转速。

### 案例2：多任务处理

在需要同时执行多个任务的系统中，定时器可以用于调度任务。例如，使用定时器中断来定期读取传感器数据，同时在主循环中处理其他任务。

## 总结

Arduino定时器是一个强大的工具，可以帮助你实现精确的时间控制。通过理解定时器的工作原理和配置方法，你可以在项目中实现各种时间相关的功能。本文介绍了定时器的基本概念、配置步骤以及一个简单的LED闪烁示例。希望这些内容能帮助你更好地理解和使用Arduino定时器。

## 附加资源与练习

- **练习1**：修改上述代码，使LED的闪烁频率变为0.5秒一次。
- **练习2**：尝试使用Timer2实现PWM信号输出，控制LED的亮度。
- **资源**：阅读Arduino官方文档，了解更多关于定时器的详细信息。

:::tip
定时器的配置可能因Arduino型号不同而有所差异，建议在使用前查阅相关文档。
:::