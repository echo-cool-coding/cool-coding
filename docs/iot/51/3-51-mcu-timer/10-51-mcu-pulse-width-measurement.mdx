---
title: 51单片机脉冲宽度测量
description: 学习如何使用51单片机的定时器功能测量脉冲宽度。本文将从基础概念讲起，逐步引导你完成代码实现，并提供实际应用案例。
---

## 介绍

在嵌入式系统中，脉冲宽度测量是一个常见的任务。脉冲宽度是指信号从高电平到低电平或从低电平到高电平的时间长度。通过测量脉冲宽度，我们可以获取传感器数据、控制电机速度或解码通信信号等。

51单片机（如STC89C52）内置了定时器/计数器模块，可以用来精确测量脉冲宽度。本文将详细介绍如何使用51单片机的定时器功能来实现脉冲宽度测量。

---

## 脉冲宽度测量的基本原理

脉冲宽度测量的核心是利用定时器记录信号的高电平或低电平持续时间。以下是实现步骤：

1. **配置定时器**：设置定时器的工作模式（如模式1，16位定时器）和时钟源。
2. **检测信号边沿**：通过外部中断或输入捕获功能检测信号的上升沿或下降沿。
3. **记录时间**：在信号边沿触发时，读取定时器的计数值，并计算时间差。
4. **计算脉冲宽度**：根据定时器的时钟频率和计数值，计算出脉冲宽度。

---

## 代码实现

以下是一个使用51单片机定时器测量脉冲宽度的示例代码。假设我们使用定时器0和外部中断0来检测信号的上升沿和下降沿。

```c
#include <reg52.h>

#define FOSC 11059200L  // 晶振频率
#define T1MS (65536 - FOSC / 12 / 1000)  // 1ms定时器初值

unsigned long pulse_width = 0;  // 存储脉冲宽度
bit edge_flag = 0;  // 边沿检测标志

void Timer0_Init() {
    TMOD |= 0x01;  // 定时器0模式1（16位定时器）
    TH0 = T1MS >> 8;  // 定时器初值高8位
    TL0 = T1MS & 0xFF;  // 定时器初值低8位
    ET0 = 1;  // 使能定时器0中断
    EA = 1;  // 使能总中断
    TR0 = 1;  // 启动定时器0
}

void External0_Init() {
    IT0 = 1;  // 设置外部中断0为下降沿触发
    EX0 = 1;  // 使能外部中断0
    EA = 1;  // 使能总中断
}

void Timer0_ISR() interrupt 1 {
    TH0 = T1MS >> 8;  // 重装定时器初值
    TL0 = T1MS & 0xFF;
    pulse_width++;  // 每1ms增加脉冲宽度
}

void External0_ISR() interrupt 0 {
    if (edge_flag == 0) {
        TR0 = 1;  // 启动定时器
        edge_flag = 1;
    } else {
        TR0 = 0;  // 停止定时器
        edge_flag = 0;
        // 输出脉冲宽度（单位：ms）
        printf("Pulse Width: %lu ms\n", pulse_width);
        pulse_width = 0;  // 重置脉冲宽度
    }
}

void main() {
    Timer0_Init();
    External0_Init();
    while (1);
}
```

### 代码说明
- **Timer0_Init()**：初始化定时器0为1ms定时器。
- **External0_Init()**：初始化外部中断0，用于检测信号边沿。
- **Timer0_ISR()**：定时器0中断服务程序，每1ms增加脉冲宽度。
- **External0_ISR()**：外部中断0服务程序，检测信号边沿并计算脉冲宽度。

---

## 实际应用案例

### 案例：测量红外遥控信号的脉冲宽度
红外遥控器通常使用脉冲编码调制（PWM）来传输数据。通过测量红外接收模块输出的脉冲宽度，我们可以解码遥控器的按键信息。

1. 将红外接收模块的输出引脚连接到单片机的外部中断引脚。
2. 使用上述代码测量每个脉冲的宽度。
3. 根据脉冲宽度解码遥控器的按键信息。

---

## 总结

本文介绍了如何使用51单片机的定时器和外部中断功能测量脉冲宽度。通过配置定时器、检测信号边沿并计算时间差，我们可以精确测量脉冲宽度。这一技术在传感器数据采集、通信信号解码等领域有广泛应用。

---

## 附加资源与练习

### 练习
1. 修改代码，使其能够测量高电平脉冲宽度和低电平脉冲宽度。
2. 尝试使用定时器1实现脉冲宽度测量，并比较与定时器0的差异。

### 进一步学习
- 阅读51单片机数据手册，了解更多定时器模式和应用场景。
- 尝试实现更复杂的脉冲宽度测量功能，如多通道测量或自动校准。

:::tip
如果你对定时器的配置有疑问，可以参考51单片机的官方文档或相关教程。
:::