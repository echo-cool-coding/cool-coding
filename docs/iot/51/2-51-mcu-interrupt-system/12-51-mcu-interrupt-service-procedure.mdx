---
title: 51单片机中断服务程序
description: 了解51单片机中断服务程序的基本概念、实现方法以及实际应用场景，适合初学者学习。
---

# 51单片机中断服务程序

## 介绍

在51单片机中，中断是一种非常重要的机制，它允许单片机在执行主程序的过程中，响应外部或内部事件，并立即执行特定的代码段（称为中断服务程序）。中断服务程序（ISR）是处理中断事件的核心部分，它能够快速响应事件并执行相应的操作。

中断服务程序的设计和使用是51单片机编程中的关键技能之一。通过合理使用中断，可以提高程序的响应速度和效率，同时减少主程序的复杂性。

## 中断服务程序的基本概念

### 什么是中断服务程序？

中断服务程序（Interrupt Service Routine, ISR）是一段特殊的代码，当中断事件发生时，单片机会暂停当前的主程序，跳转到ISR执行相应的操作。执行完ISR后，单片机会返回到主程序继续执行。

### 中断的触发条件

51单片机的中断可以由多种事件触发，例如：
- 外部中断（如按键按下）
- 定时器溢出
- 串口接收到数据

### 中断服务程序的执行流程

当中断事件发生时，单片机会执行以下步骤：
1. 保存当前程序计数器（PC）的值，以便中断结束后能够返回到正确的位置。
2. 跳转到中断服务程序的入口地址。
3. 执行中断服务程序中的代码。
4. 恢复保存的程序计数器值，返回到主程序继续执行。

## 编写中断服务程序

### 中断服务程序的声明

在C语言中，中断服务程序通常使用特定的关键字来声明。对于51单片机，常用的关键字是 `interrupt`。以下是一个简单的中断服务程序示例：

```c
#include <reg51.h>

void Timer0_ISR(void) interrupt 1 {
    // 中断服务程序代码
    TF0 = 0; // 清除定时器0溢出标志
    P1 = ~P1; // 翻转P1口的状态
}
```

在这个示例中，`Timer0_ISR` 是定时器0的中断服务程序。`interrupt 1` 表示这是一个定时器0的中断服务程序。

### 中断服务程序的注册

在51单片机中，中断服务程序的入口地址是固定的。例如，定时器0的中断服务程序入口地址是 `0x000B`。为了确保单片机能够正确跳转到中断服务程序，我们需要在程序中注册中断服务程序。

```c
void main() {
    TMOD = 0x02; // 设置定时器0为模式2
    TH0 = 0x00;  // 设置定时器0的初始值
    TL0 = 0x00;
    ET0 = 1;     // 使能定时器0中断
    EA = 1;      // 使能全局中断
    TR0 = 1;     // 启动定时器0

    while (1) {
        // 主程序代码
    }
}
```

在这个示例中，我们通过设置 `ET0` 和 `EA` 寄存器来使能定时器0中断和全局中断。

## 实际应用案例

### 案例：使用中断实现按键去抖

在实际应用中，按键抖动是一个常见的问题。通过使用中断，我们可以有效地解决这个问题。以下是一个使用外部中断实现按键去抖的示例：

```c
#include <reg51.h>

sbit LED = P1^0; // 定义LED连接到P1.0

void External0_ISR(void) interrupt 0 {
    // 延时去抖
    unsigned int i;
    for (i = 0; i < 1000; i++);
    if (P3^2 == 0) { // 检查按键是否仍然按下
        LED = ~LED; // 翻转LED状态
    }
}

void main() {
    IT0 = 1; // 设置外部中断0为下降沿触发
    EX0 = 1; // 使能外部中断0
    EA = 1;  // 使能全局中断

    while (1) {
        // 主程序代码
    }
}
```

在这个示例中，当按键按下时，外部中断0被触发，单片机跳转到 `External0_ISR` 执行去抖操作并翻转LED的状态。

## 总结

中断服务程序是51单片机编程中的重要组成部分。通过合理使用中断，可以提高程序的响应速度和效率。本文介绍了中断服务程序的基本概念、编写方法以及实际应用案例，希望能够帮助初学者更好地理解和掌握这一重要概念。

## 附加资源与练习

- **练习1**：尝试编写一个使用定时器1中断的程序，每隔1秒翻转一次LED的状态。
- **练习2**：修改按键去抖案例，使其在按键按下时点亮LED，按键松开时熄灭LED。

:::tip
提示：在编写中断服务程序时，务必注意中断的优先级和中断标志的清除，以避免程序出现意外行为。
:::