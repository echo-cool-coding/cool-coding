---
title: 51单片机1-Wire总线
description: 了解51单片机中的1-Wire总线技术，掌握其工作原理、通信协议及实际应用。
---

## 介绍

1-Wire总线是一种由Dallas Semiconductor（现为Maxim Integrated）开发的单线通信协议。它仅使用一根数据线（和地线）即可实现设备之间的通信，具有简单、低成本的特点。1-Wire总线广泛应用于温度传感器、EEPROM、身份识别设备等场景。

在51单片机中，1-Wire总线可以通过软件模拟实现，无需额外的硬件支持。这使得它成为初学者学习单片机通信协议的理想选择。

## 1-Wire总线的工作原理

1-Wire总线通过一根数据线实现双向通信。通信过程中，主设备（如51单片机）控制总线的时序，从设备（如DS18B20温度传感器）响应主设备的指令。

### 通信时序

1-Wire总线的通信基于严格的时序。以下是1-Wire总线的基本操作：

1. **复位脉冲（Reset Pulse）**：主设备发送一个低电平脉冲（至少480µs），从设备响应一个低电平脉冲（60-240µs）。
2. **写时序（Write Timing）**：主设备通过控制低电平的持续时间来发送“0”或“1”。
3. **读时序（Read Timing）**：主设备发送一个低电平脉冲，从设备在特定时间内拉低或保持高电平以发送数据。

### 数据格式

1-Wire总线使用8位数据帧，每个字节从最低有效位（LSB）开始传输。

## 代码示例

以下是一个简单的51单片机与DS18B20温度传感器通信的代码示例：

```c
#include <reg51.h>

sbit DQ = P3^7; // 定义1-Wire总线引脚

void delay_us(unsigned int us) {
    while (us--);
}

void delay_ms(unsigned int ms) {
    unsigned int i, j;
    for (i = 0; i < ms; i++)
        for (j = 0; j < 123; j++);
}

bit reset_pulse() {
    bit presence;
    DQ = 0; // 拉低总线
    delay_us(480); // 保持480µs
    DQ = 1; // 释放总线
    delay_us(60); // 等待60µs
    presence = DQ; // 读取从设备的响应
    delay_us(420); // 等待剩余时间
    return presence;
}

void write_byte(unsigned char byte) {
    unsigned char i;
    for (i = 0; i < 8; i++) {
        DQ = 0; // 拉低总线
        delay_us(2); // 保持2µs
        DQ = byte & 0x01; // 发送最低位
        delay_us(60); // 保持60µs
        DQ = 1; // 释放总线
        byte >>= 1; // 准备发送下一位
    }
}

unsigned char read_byte() {
    unsigned char i, byte = 0;
    for (i = 0; i < 8; i++) {
        DQ = 0; // 拉低总线
        delay_us(2); // 保持2µs
        DQ = 1; // 释放总线
        delay_us(8); // 等待8µs
        byte |= (DQ << i); // 读取数据位
        delay_us(50); // 等待剩余时间
    }
    return byte;
}

void main() {
    unsigned char temp_l, temp_h;
    float temp;
    while (1) {
        if (!reset_pulse()) {
            write_byte(0xCC); // 跳过ROM命令
            write_byte(0x44); // 启动温度转换
            delay_ms(750); // 等待转换完成
            reset_pulse();
            write_byte(0xCC); // 跳过ROM命令
            write_byte(0xBE); // 读取温度命令
            temp_l = read_byte(); // 读取温度低字节
            temp_h = read_byte(); // 读取温度高字节
            temp = (temp_h << 8) | temp_l;
            temp = temp * 0.0625; // 转换为实际温度
        }
    }
}
```

:::note
**注意**：以上代码仅为示例，实际应用中可能需要根据具体硬件和需求进行调整。
:::

## 实际应用案例

1-Wire总线广泛应用于以下场景：

1. **温度监测**：DS18B20温度传感器通过1-Wire总线与单片机通信，实时监测环境温度。
2. **身份识别**：iButton设备使用1-Wire总线进行身份验证和数据存储。
3. **数据存储**：1-Wire EEPROM用于存储少量数据，如配置信息或校准数据。

## 总结

1-Wire总线是一种简单、低成本的通信协议，适用于多种应用场景。通过软件模拟，51单片机可以轻松实现1-Wire总线的通信。掌握1-Wire总线的工作原理和编程技巧，将为你的单片机项目提供更多可能性。

## 附加资源与练习

- **练习1**：尝试修改代码，使其能够读取多个DS18B20传感器的温度数据。
- **练习2**：研究1-Wire总线的CRC校验机制，并在代码中实现错误检测功能。
- **资源**：参考Maxim Integrated的官方文档，深入了解1-Wire总线的更多细节和应用。

:::tip
**提示**：在实际项目中，建议使用硬件定时器来精确控制1-Wire总线的时序，以提高通信的可靠性。
:::