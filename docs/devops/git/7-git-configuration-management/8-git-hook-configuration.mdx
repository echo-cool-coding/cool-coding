---
title: Git 钩子配置
description: 了解如何配置和使用Git钩子来自动化开发工作流，提升代码质量和团队协作效率。
---

# Git 钩子配置

Git钩子（Git Hooks）是Git提供的一种机制，允许你在特定的Git事件发生时自动执行脚本。这些事件包括提交代码、合并分支、推送代码等。通过配置Git钩子，你可以自动化许多开发任务，例如代码格式化、测试运行、提交信息验证等。

## 什么是Git钩子？

Git钩子是存储在Git仓库中的脚本文件，位于 `.git/hooks` 目录下。每个钩子对应一个特定的Git事件，例如 `pre-commit`、`post-commit`、`pre-push` 等。当这些事件发生时，Git会自动执行相应的钩子脚本。

:::note
Git钩子默认是禁用的。你需要将钩子脚本重命名为去掉 `.sample` 后缀的文件名，才能启用它。
:::

## 常见的Git钩子

以下是一些常见的Git钩子及其用途：

- **pre-commit**：在提交代码之前运行。常用于代码格式化、静态分析或运行测试。
- **commit-msg**：在提交信息被保存之前运行。可用于验证提交信息的格式。
- **post-commit**：在提交完成后运行。通常用于通知或日志记录。
- **pre-push**：在推送代码之前运行。常用于运行完整的测试套件。

## 如何配置Git钩子

### 1. 找到钩子脚本

Git钩子脚本位于 `.git/hooks` 目录下。你可以通过以下命令查看现有的钩子脚本：

```bash
ls .git/hooks
```

你会看到一些以 `.sample` 结尾的文件，例如 `pre-commit.sample`。这些是Git提供的示例钩子脚本。

### 2. 启用钩子脚本

要启用一个钩子脚本，只需将 `.sample` 后缀去掉。例如，启用 `pre-commit` 钩子：

```bash
mv .git/hooks/pre-commit.sample .git/hooks/pre-commit
```

### 3. 编写自定义钩子脚本

你可以使用任何脚本语言（如Bash、Python、Node.js等）编写自定义钩子脚本。以下是一个简单的 `pre-commit` 钩子示例，用于在提交前运行代码格式化工具：

```bash
#!/bin/bash

# 运行代码格式化工具
npm run format

# 如果格式化失败，阻止提交
if [ $? -ne 0 ]; then
  echo "代码格式化失败，请修复后再提交。"
  exit 1
fi
```

:::caution
确保钩子脚本具有可执行权限。你可以使用以下命令为脚本添加执行权限：

```bash
chmod +x .git/hooks/pre-commit
```
:::

## 实际应用场景

### 1. 提交信息验证

在团队协作中，统一的提交信息格式有助于提高代码库的可读性。你可以使用 `commit-msg` 钩子来验证提交信息的格式。以下是一个简单的 `commit-msg` 钩子示例：

```bash
#!/bin/bash

# 获取提交信息文件路径
commit_msg_file=$1

# 读取提交信息
commit_msg=$(cat $commit_msg_file)

# 验证提交信息格式
if ! echo "$commit_msg" | grep -qE "^(feat|fix|docs|style|refactor|test|chore): .{10,}"; then
  echo "提交信息格式不正确，请遵循 'type: description' 格式。"
  exit 1
fi
```

### 2. 自动运行测试

在推送代码之前运行测试可以确保代码库的稳定性。你可以使用 `pre-push` 钩子来自动运行测试套件：

```bash
#!/bin/bash

# 运行测试
npm test

# 如果测试失败，阻止推送
if [ $? -ne 0 ]; then
  echo "测试失败，请修复后再推送。"
  exit 1
fi
```

## 总结

Git钩子是一个强大的工具，可以帮助你自动化开发工作流中的许多任务。通过配置和使用Git钩子，你可以提高代码质量、减少错误，并提升团队协作效率。

:::tip
如果你希望在团队中共享Git钩子配置，可以考虑使用工具如 [Husky](https://typicode.github.io/husky/) 来管理钩子脚本。
:::

## 附加资源

- [Git官方文档 - Git Hooks](https://git-scm.com/docs/githooks)
- [Husky - Git Hooks made easy](https://typicode.github.io/husky/)
- [Git钩子实战指南](https://www.atlassian.com/git/tutorials/git-hooks)

## 练习

1. 创建一个 `pre-commit` 钩子，用于在提交前运行代码格式化工具。
2. 编写一个 `commit-msg` 钩子，验证提交信息是否符合团队规范。
3. 配置一个 `pre-push` 钩子，在推送代码前运行完整的测试套件。
