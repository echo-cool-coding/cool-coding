---
title: Kubernetes 配置最佳实践
description: 了解如何在Kubernetes中管理配置的最佳实践，包括ConfigMap、Secret、环境变量和资源限制等关键概念。
---

# Kubernetes 配置最佳实践

Kubernetes 是一个强大的容器编排工具，能够帮助开发者高效地管理容器化应用。然而，随着应用规模的扩大，配置管理变得尤为重要。本文将介绍 Kubernetes 配置管理的最佳实践，帮助你更好地管理应用配置。

## 什么是 Kubernetes 配置管理？

在 Kubernetes 中，配置管理是指如何定义、存储和应用应用程序的配置信息。这些配置信息可以包括环境变量、配置文件、密钥、资源限制等。Kubernetes 提供了多种工具来管理这些配置，例如 ConfigMap、Secret 和环境变量。

## 1. 使用 ConfigMap 管理配置

ConfigMap 是 Kubernetes 中用于存储非敏感配置数据的资源对象。它可以将配置数据与应用程序代码分离，从而使应用程序更易于维护和扩展。

### 创建 ConfigMap

以下是一个简单的 ConfigMap 示例：

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  APP_COLOR: blue
  APP_MODE: production
```

### 在 Pod 中使用 ConfigMap

你可以通过环境变量或挂载卷的方式将 ConfigMap 中的数据注入到 Pod 中。以下是通过环境变量注入的示例：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: my-app-container
    image: my-app-image
    env:
    - name: APP_COLOR
      valueFrom:
        configMapKeyRef:
          name: app-config
          key: APP_COLOR
    - name: APP_MODE
      valueFrom:
        configMapKeyRef:
          name: app-config
          key: APP_MODE
```

:::tip
**提示**：使用 ConfigMap 时，建议将配置数据按功能或环境进行分类，以便更好地管理和维护。
:::

## 2. 使用 Secret 管理敏感信息

Secret 是 Kubernetes 中用于存储敏感信息的资源对象，例如密码、API 密钥等。与 ConfigMap 类似，Secret 也可以通过环境变量或挂载卷的方式注入到 Pod 中。

### 创建 Secret

以下是一个简单的 Secret 示例：

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: app-secret
type: Opaque
data:
  DB_PASSWORD: cGFzc3dvcmQ=  # base64 编码的 "password"
```

### 在 Pod 中使用 Secret

你可以通过环境变量或挂载卷的方式将 Secret 中的数据注入到 Pod 中。以下是通过环境变量注入的示例：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: my-app-container
    image: my-app-image
    env:
    - name: DB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: app-secret
          key: DB_PASSWORD
```

:::caution
**注意**：虽然 Secret 中的数据是 base64 编码的，但它并不是加密的。因此，建议在生产环境中使用加密工具对 Secret 进行加密。
:::

## 3. 使用环境变量管理动态配置

环境变量是 Kubernetes 中管理动态配置的常用方式。你可以通过环境变量将配置数据传递给容器，从而使应用程序能够根据环境的不同进行调整。

### 在 Pod 中定义环境变量

以下是一个在 Pod 中定义环境变量的示例：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: my-app-container
    image: my-app-image
    env:
    - name: APP_ENV
      value: "production"
    - name: APP_LOG_LEVEL
      value: "info"
```

:::note
**注意**：环境变量适用于简单的配置场景。对于复杂的配置，建议使用 ConfigMap 或 Secret。
:::

## 4. 设置资源限制

在 Kubernetes 中，资源限制是确保应用程序稳定运行的关键。你可以通过设置资源请求和限制来控制容器的 CPU 和内存使用。

### 设置资源请求和限制

以下是一个设置资源请求和限制的示例：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: my-app-container
    image: my-app-image
    resources:
      requests:
        memory: "64Mi"
        cpu: "250m"
      limits:
        memory: "128Mi"
        cpu: "500m"
```

:::warning
**警告**：未设置资源限制可能导致容器占用过多资源，从而影响其他容器的正常运行。
:::

## 5. 实际案例：配置管理在微服务架构中的应用

假设你正在开发一个微服务架构的应用，其中包含多个服务。每个服务都需要不同的配置，例如数据库连接字符串、日志级别等。你可以使用 ConfigMap 和 Secret 来管理这些配置，并通过环境变量或挂载卷的方式将配置注入到每个服务的 Pod 中。

### 案例示例

以下是一个微服务架构中配置管理的示例：

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: service-config
data:
  SERVICE_A_LOG_LEVEL: "info"
  SERVICE_B_LOG_LEVEL: "debug"

---

apiVersion: v1
kind: Secret
metadata:
  name: service-secret
type: Opaque
data:
  DB_CONNECTION_STRING: "base64-encoded-connection-string"

---

apiVersion: v1
kind: Pod
metadata:
  name: service-a
spec:
  containers:
  - name: service-a-container
    image: service-a-image
    env:
    - name: LOG_LEVEL
      valueFrom:
        configMapKeyRef:
          name: service-config
          key: SERVICE_A_LOG_LEVEL
    - name: DB_CONNECTION_STRING
      valueFrom:
        secretKeyRef:
          name: service-secret
          key: DB_CONNECTION_STRING

---

apiVersion: v1
kind: Pod
metadata:
  name: service-b
spec:
  containers:
  - name: service-b-container
    image: service-b-image
    env:
    - name: LOG_LEVEL
      valueFrom:
        configMapKeyRef:
          name: service-config
          key: SERVICE_B_LOG_LEVEL
    - name: DB_CONNECTION_STRING
      valueFrom:
        secretKeyRef:
          name: service-secret
          key: DB_CONNECTION_STRING
```

## 总结

Kubernetes 配置管理是确保应用程序稳定运行的关键。通过使用 ConfigMap、Secret、环境变量和资源限制，你可以更好地管理应用程序的配置，并确保其在不同环境中的一致性。希望本文的内容能够帮助你掌握 Kubernetes 配置管理的最佳实践。

## 附加资源

- [Kubernetes 官方文档 - ConfigMap](https://kubernetes.io/docs/concepts/configuration/configmap/)
- [Kubernetes 官方文档 - Secret](https://kubernetes.io/docs/concepts/configuration/secret/)
- [Kubernetes 官方文档 - 资源管理](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/)

## 练习

1. 创建一个 ConfigMap，并将其注入到一个 Pod 中。
2. 创建一个 Secret，并将其注入到一个 Pod 中。
3. 为一个 Pod 设置资源请求和限制，并观察其行为。