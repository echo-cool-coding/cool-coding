---
title: Kubernetes 环境变量
description: 了解如何在Kubernetes中使用环境变量来配置和管理容器化应用程序。本文将从基础概念入手，逐步讲解环境变量的定义、使用方法以及实际应用场景。
---

# Kubernetes 环境变量

在Kubernetes中，环境变量（Environment Variables）是配置容器化应用程序的一种常见方式。它们允许你将配置信息传递给容器内部的应用程序，而无需修改应用程序的代码。环境变量可以用于设置数据库连接字符串、API密钥、调试标志等。

## 什么是环境变量？

环境变量是操作系统或容器运行时提供给应用程序的一组键值对。在Kubernetes中，环境变量可以在Pod的配置文件中定义，并在容器启动时注入到容器中。应用程序可以通过读取这些环境变量来获取所需的配置信息。

## 如何在Kubernetes中定义环境变量？

在Kubernetes中，环境变量可以通过Pod或Deployment的YAML文件中的`env`字段来定义。以下是一个简单的示例：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: my-container
    image: my-image
    env:
    - name: DATABASE_URL
      value: "postgres://user:password@db:5432/mydb"
    - name: DEBUG_MODE
      value: "true"
```

在这个示例中，我们定义了两个环境变量：`DATABASE_URL`和`DEBUG_MODE`。这些变量将在容器启动时注入到`my-container`中。

### 使用ConfigMap和Secret作为环境变量

除了直接在Pod定义中设置环境变量外，你还可以使用ConfigMap和Secret来管理环境变量。ConfigMap用于存储非敏感的配置数据，而Secret用于存储敏感信息，如密码或API密钥。

以下是一个使用ConfigMap的示例：

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-config
data:
  DATABASE_URL: "postgres://user:password@db:5432/mydb"
  DEBUG_MODE: "true"
```

然后，你可以在Pod定义中引用这个ConfigMap：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: my-container
    image: my-image
    envFrom:
    - configMapRef:
        name: my-config
```

类似地，你可以使用Secret来存储敏感信息：

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-secret
type: Opaque
data:
  API_KEY: "base64-encoded-api-key"
```

然后在Pod定义中引用这个Secret：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: my-container
    image: my-image
    env:
    - name: API_KEY
      valueFrom:
        secretKeyRef:
          name: my-secret
          key: API_KEY
```

## 实际应用场景

### 场景1：数据库连接配置

假设你有一个需要连接到PostgreSQL数据库的应用程序。你可以使用环境变量来传递数据库的连接字符串，而不需要将连接字符串硬编码到应用程序中。

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: my-container
    image: my-image
    env:
    - name: DATABASE_URL
      value: "postgres://user:password@db:5432/mydb"
```

### 场景2：调试模式

在开发环境中，你可能希望启用调试模式以获取更多的日志信息。你可以通过环境变量来控制调试模式的开关。

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: my-container
    image: my-image
    env:
    - name: DEBUG_MODE
      value: "true"
```

### 场景3：API密钥管理

对于需要访问外部API的应用程序，API密钥通常需要保密。你可以使用Kubernetes Secret来存储API密钥，并通过环境变量将其传递给应用程序。

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-secret
type: Opaque
data:
  API_KEY: "base64-encoded-api-key"
```

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: my-container
    image: my-image
    env:
    - name: API_KEY
      valueFrom:
        secretKeyRef:
          name: my-secret
          key: API_KEY
```

## 总结

Kubernetes环境变量是配置容器化应用程序的强大工具。通过环境变量，你可以轻松地将配置信息传递给应用程序，而无需修改代码。你可以在Pod定义中直接设置环境变量，或者使用ConfigMap和Secret来管理更复杂的配置。

:::tip
**提示**：对于敏感信息，如密码或API密钥，始终使用Kubernetes Secret来存储和管理。
:::

## 附加资源

- [Kubernetes官方文档：环境变量](https://kubernetes.io/docs/tasks/inject-data-application/environment-variable-expose-pod-information/)
- [Kubernetes ConfigMap和Secret详解](https://kubernetes.io/docs/concepts/configuration/configmap/)
- [Kubernetes Secret管理最佳实践](https://kubernetes.io/docs/concepts/configuration/secret/)

## 练习

1. 创建一个包含环境变量的Pod，并使用`kubectl exec`命令验证环境变量是否正确注入。
2. 使用ConfigMap和Secret来管理环境变量，并部署一个简单的应用程序。
3. 尝试在多个Pod之间共享相同的ConfigMap和Secret，并观察它们的行为。

通过完成这些练习，你将更深入地理解Kubernetes环境变量的使用和管理。