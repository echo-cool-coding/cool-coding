---
title: Kubernetes 资源请求
description: 了解 Kubernetes 中的资源请求（Resource Requests），如何为容器分配 CPU 和内存资源，以及如何优化工作负载的性能和稳定性。
---

# Kubernetes 资源请求

在 Kubernetes 中，资源请求（Resource Requests）是一个关键概念，它决定了容器在集群中运行时所需的最小资源量。通过合理配置资源请求，您可以确保应用程序在 Kubernetes 集群中稳定运行，同时避免资源浪费。

## 什么是资源请求？

资源请求是 Kubernetes 中用于定义容器所需的最小资源量的机制。这些资源通常包括 CPU 和内存。Kubernetes 调度器会根据资源请求来决定将 Pod 调度到哪个节点上运行。如果节点无法满足 Pod 的资源请求，调度器将不会将 Pod 调度到该节点。

:::note
资源请求并不限制容器的最大资源使用量。它只是告诉 Kubernetes 调度器，容器至少需要多少资源才能正常运行。
:::

## 资源请求的配置

在 Kubernetes 中，资源请求通过 `resources.requests` 字段来配置。以下是一个简单的 Pod 配置示例，展示了如何为容器设置 CPU 和内存的资源请求：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  containers:
  - name: my-container
    image: nginx
    resources:
      requests:
        memory: "64Mi"
        cpu: "250m"
```

在这个示例中，`my-container` 容器请求了 64 MiB 的内存和 250 毫核（millicores）的 CPU。Kubernetes 调度器将确保 Pod 被调度到一个至少有这些资源的节点上。

:::tip
- `memory` 的单位可以是 `Mi`（MiB）或 `Gi`（GiB）。
- `cpu` 的单位可以是 `m`（millicores），其中 1000m 等于 1 个 CPU 核心。
:::

## 资源请求的作用

### 1. 调度决策

Kubernetes 调度器使用资源请求来决定将 Pod 调度到哪个节点。如果节点的可用资源不足以满足 Pod 的资源请求，调度器将不会将 Pod 调度到该节点。

### 2. 资源保障

资源请求确保了容器在运行时能够获得所需的最小资源量。这有助于防止应用程序因资源不足而崩溃或性能下降。

### 3. 资源配额管理

在 Kubernetes 中，资源请求还用于资源配额（Resource Quota）的管理。资源配额可以限制命名空间中的资源使用量，而资源请求是计算这些配额的基础。

## 实际案例

假设您有一个运行 Web 应用程序的 Pod，该应用程序需要至少 512 MiB 的内存和 500m 的 CPU 才能正常运行。您可以通过以下配置来定义资源请求：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: web-app
spec:
  containers:
  - name: web-container
    image: my-web-app:latest
    resources:
      requests:
        memory: "512Mi"
        cpu: "500m"
```

在这个案例中，Kubernetes 调度器将确保 `web-app` Pod 被调度到一个至少有 512 MiB 内存和 500m CPU 的节点上。

## 资源请求与资源限制的区别

资源请求和资源限制（Resource Limits）是两个不同的概念：

- **资源请求**：定义了容器所需的最小资源量。
- **资源限制**：定义了容器可以使用的最大资源量。

以下是一个同时配置资源请求和资源限制的示例：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  containers:
  - name: my-container
    image: nginx
    resources:
      requests:
        memory: "64Mi"
        cpu: "250m"
      limits:
        memory: "128Mi"
        cpu: "500m"
```

在这个示例中，`my-container` 容器请求了 64 MiB 内存和 250m CPU，但它的内存使用量不能超过 128 MiB，CPU 使用量不能超过 500m。

:::caution
如果没有设置资源限制，容器可能会消耗过多的资源，导致节点上的其他 Pod 受到影响。
:::

## 总结

Kubernetes 资源请求是确保应用程序稳定运行的关键配置。通过合理设置资源请求，您可以确保 Pod 被调度到合适的节点，并获得所需的最小资源量。同时，结合资源限制，您可以进一步控制容器的资源使用，避免资源浪费和节点过载。

## 附加资源

- [Kubernetes 官方文档 - 资源管理](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/)
- [Kubernetes 资源请求与限制的最佳实践](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#resource-requests-and-limits)

## 练习

1. 创建一个 Pod，配置其资源请求为 128 MiB 内存和 500m CPU。
2. 尝试将 Pod 的资源请求设置为高于节点可用资源的值，观察调度器的行为。
3. 配置资源限制，并观察容器在资源使用超过限制时的行为。
