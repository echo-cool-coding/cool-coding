---
title: Kubernetes 注解
description: 了解 Kubernetes 注解（Annotations）的核心概念、用途以及如何在 Kubernetes 资源中使用它们。
---

# Kubernetes 注解

Kubernetes 注解（Annotations）是一种用于向 Kubernetes 资源添加元数据的机制。与标签（Labels）不同，注解不会用于标识或选择资源，而是用于存储非标识性的信息，例如构建、发布或监控工具的元数据。注解通常用于记录额外的信息，供工具或系统使用。

## 什么是 Kubernetes 注解？

注解是键值对（key-value pairs），可以附加到 Kubernetes 资源（如 Pod、Service、Deployment 等）上。它们的主要目的是存储与资源相关的非结构化数据。注解的键和值都是字符串类型，且可以包含任意长度的数据。

:::note
注解与标签的区别：
- **标签**：用于标识和选择资源，通常用于查询和分组。
- **注解**：用于存储非标识性的元数据，通常用于工具或系统的内部使用。
:::

## 注解的语法

注解的语法非常简单，由键和值组成，格式如下：

```yaml
metadata:
  annotations:
    key1: value1
    key2: value2
```

- **key**：注解的键，通常采用反向域名表示法（如 `example.com/key`）。
- **value**：注解的值，可以是任意字符串。

## 如何使用注解

注解可以在创建或更新 Kubernetes 资源时添加。以下是一个在 Pod 资源中使用注解的示例：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
  annotations:
    example.com/build-version: "1.2.3"
    example.com/release-notes: "Initial release with basic features."
spec:
  containers:
  - name: my-container
    image: nginx
```

在这个示例中，我们为 Pod 添加了两个注解：
- `example.com/build-version`：记录构建版本。
- `example.com/release-notes`：记录发布说明。

## 注解的实际应用场景

### 1. 记录构建和发布信息

注解常用于记录与构建和发布相关的信息。例如，CI/CD 工具可以在部署时自动添加构建版本、提交哈希等信息。

```yaml
metadata:
  annotations:
    ci.example.com/build-id: "12345"
    ci.example.com/git-commit: "a1b2c3d4"
```

### 2. 配置监控和日志工具

监控和日志工具可以使用注解来配置资源的行为。例如，Prometheus 可以通过注解来配置如何抓取指标。

```yaml
metadata:
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8080"
```

### 3. 自定义调度策略

某些调度器或控制器可能会使用注解来实现自定义的调度策略。例如，注解可以用于指定 Pod 的优先级或资源需求。

```yaml
metadata:
  annotations:
    scheduler.example.com/priority: "high"
```

## 注解的查询和更新

虽然注解不用于资源选择，但你仍然可以通过 `kubectl` 命令查看和更新注解。

### 查看注解

使用以下命令查看资源的注解：

```bash
kubectl describe pod my-pod
```

输出将包含注解部分：

```plaintext
Annotations:  example.com/build-version: 1.2.3
              example.com/release-notes: Initial release with basic features.
```

### 更新注解

使用以下命令更新资源的注解：

```bash
kubectl annotate pod my-pod example.com/build-version="1.2.4"
```

## 总结

Kubernetes 注解是一种强大的工具，用于存储与资源相关的非标识性元数据。它们可以用于记录构建信息、配置监控工具、实现自定义调度策略等场景。与标签不同，注解不会影响资源的选择或分组，但它们为工具和系统提供了额外的灵活性。

:::tip
在实际使用中，注解的键应尽量使用反向域名表示法（如 `example.com/key`），以避免命名冲突。
:::

## 附加资源

- [Kubernetes 官方文档 - 注解](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)
- [Kubernetes 最佳实践 - 使用注解](https://kubernetes.io/docs/concepts/configuration/overview/#using-annotations)

## 练习

1. 创建一个 Deployment，并为其添加以下注解：
   - `example.com/owner: "dev-team"`
   - `example.com/description: "This is a test deployment."`

2. 使用 `kubectl` 命令查看你创建的 Deployment 的注解。

3. 尝试更新 Deployment 的注解，将 `example.com/description` 的值改为 `"Updated description."`。