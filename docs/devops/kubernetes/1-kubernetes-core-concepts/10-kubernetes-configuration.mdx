---
title: Kubernetes 配置
description: 了解Kubernetes配置的核心概念，包括ConfigMap、Secret以及如何通过配置文件管理应用程序的配置。
---

# Kubernetes 配置

Kubernetes配置是管理容器化应用程序的关键部分。通过配置，您可以将应用程序的配置数据与容器镜像分离，从而实现更灵活、可维护的部署。本文将介绍Kubernetes中的主要配置工具：**ConfigMap** 和 **Secret**，并展示如何在实际场景中使用它们。

---

## 什么是Kubernetes配置？

在Kubernetes中，配置是指将应用程序的配置数据（如环境变量、配置文件等）与容器镜像分离的过程。这样做的好处是，您可以在不重新构建镜像的情况下更改应用程序的行为。Kubernetes提供了两种主要的配置资源：

1. **ConfigMap**：用于存储非敏感的配置数据。
2. **Secret**：用于存储敏感的配置数据，如密码、API密钥等。

---

## ConfigMap

### 什么是ConfigMap？

ConfigMap是Kubernetes中用于存储非敏感配置数据的资源。它可以将配置数据以键值对的形式存储，并在Pod中作为环境变量或挂载的文件使用。

### 创建ConfigMap

以下是一个简单的ConfigMap示例，存储了一个应用程序的配置数据：

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  APP_COLOR: blue
  APP_MODE: production
```

### 在Pod中使用ConfigMap

您可以通过环境变量或挂载文件的方式将ConfigMap中的数据注入到Pod中。以下是一个使用环境变量的示例：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
    - name: my-app-container
      image: my-app-image
      env:
        - name: APP_COLOR
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: APP_COLOR
        - name: APP_MODE
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: APP_MODE
```

---

## Secret

### 什么是Secret？

Secret是Kubernetes中用于存储敏感数据的资源。与ConfigMap类似，Secret也可以存储键值对，但其内容会被Base64编码以增加安全性。

### 创建Secret

以下是一个简单的Secret示例，存储了一个数据库密码：

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: db-secret
type: Opaque
data:
  DB_PASSWORD: cGFzc3dvcmQxMjM=  # Base64编码的"password123"
```

### 在Pod中使用Secret

您可以通过环境变量或挂载文件的方式将Secret中的数据注入到Pod中。以下是一个使用环境变量的示例：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-db-app
spec:
  containers:
    - name: my-db-container
      image: my-db-image
      env:
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: DB_PASSWORD
```

---

## 实际应用场景

### 场景1：动态配置更新

假设您有一个Web应用程序，其主题颜色存储在ConfigMap中。通过更新ConfigMap，您可以动态更改应用程序的主题颜色，而无需重新部署Pod。

### 场景2：安全存储数据库凭据

在部署数据库应用程序时，您可以使用Secret安全地存储数据库的用户名和密码，避免将这些敏感信息硬编码到容器镜像中。

---

## 总结

Kubernetes配置是管理容器化应用程序的重要工具。通过ConfigMap和Secret，您可以将配置数据与容器镜像分离，从而实现更灵活、安全的部署。以下是本文的主要内容回顾：

- **ConfigMap**：用于存储非敏感的配置数据。
- **Secret**：用于存储敏感的配置数据。
- 配置数据可以通过环境变量或挂载文件的方式注入到Pod中。

---

## 附加资源与练习

### 练习1：创建并使用ConfigMap
1. 创建一个ConfigMap，存储应用程序的日志级别（`LOG_LEVEL=debug`）。
2. 在Pod中使用该ConfigMap作为环境变量。

### 练习2：创建并使用Secret
1. 创建一个Secret，存储API密钥（`API_KEY=my-secret-key`）。
2. 在Pod中使用该Secret作为环境变量。

### 进一步学习
- [Kubernetes官方文档 - ConfigMap](https://kubernetes.io/docs/concepts/configuration/configmap/)
- [Kubernetes官方文档 - Secret](https://kubernetes.io/docs/concepts/configuration/secret/)
