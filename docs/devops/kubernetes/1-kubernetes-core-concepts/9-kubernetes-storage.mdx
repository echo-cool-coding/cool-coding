---
title: Kubernetes 存储
description: 了解Kubernetes中的存储概念，包括持久卷、持久卷声明、存储类等核心组件，以及如何在实际场景中使用它们。
---

# Kubernetes 存储

在Kubernetes中，存储是一个关键概念，用于管理容器化应用程序的数据持久性。与容器本身的生命周期不同，存储需要独立于容器的生命周期，以确保数据在容器重启或迁移时不会丢失。Kubernetes提供了多种存储解决方案，帮助用户管理持久化数据。

## 1. 存储的核心概念

Kubernetes中的存储主要围绕以下几个核心组件展开：

- **持久卷（Persistent Volume, PV）**：集群中的一块存储资源，由管理员预先配置或动态分配。
- **持久卷声明（Persistent Volume Claim, PVC）**：用户对存储资源的请求，类似于Pod对计算资源的需求。
- **存储类（StorageClass）**：定义存储的类型和属性，允许动态创建PV。

### 1.1 持久卷（PV）

持久卷是集群中的一块存储资源，可以由管理员手动创建，也可以通过存储类动态分配。PV独立于Pod的生命周期，即使Pod被删除，PV中的数据仍然存在。

```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: example-pv
spec:
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: /mnt/data
```

### 1.2 持久卷声明（PVC）

持久卷声明是用户对存储资源的请求。Pod通过PVC来使用PV。PVC会根据请求的存储大小和访问模式，自动绑定到合适的PV。

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: example-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
```

### 1.3 存储类（StorageClass）

存储类定义了存储的类型和属性，允许动态创建PV。不同的存储类可以对应不同的存储后端，例如本地存储、云存储等。

```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: fast
provisioner: kubernetes.io/gce-pd
parameters:
  type: pd-ssd
```

## 2. 存储的生命周期

Kubernetes中的存储生命周期包括以下几个阶段：

1. **创建PV**：管理员手动创建PV，或者通过存储类动态创建。
2. **创建PVC**：用户创建PVC，请求存储资源。
3. **绑定PV和PVC**：Kubernetes根据PVC的请求，自动绑定到合适的PV。
4. **使用存储**：Pod通过PVC使用PV中的存储。
5. **释放存储**：当PVC被删除时，PV可以被回收或保留。

## 3. 实际案例

假设我们有一个需要持久化存储的应用程序，例如一个数据库。我们可以通过以下步骤来配置存储：

1. **创建存储类**：定义一个存储类，用于动态创建PV。

```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: fast
provisioner: kubernetes.io/gce-pd
parameters:
  type: pd-ssd
```

2. **创建PVC**：为数据库Pod创建一个PVC。

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: db-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
  storageClassName: fast
```

3. **在Pod中使用PVC**：将PVC挂载到数据库Pod中。

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: db-pod
spec:
  containers:
    - name: db-container
      image: mysql:5.7
      volumeMounts:
        - mountPath: /var/lib/mysql
          name: db-storage
  volumes:
    - name: db-storage
      persistentVolumeClaim:
        claimName: db-pvc
```

## 4. 总结

Kubernetes存储是管理容器化应用程序数据持久性的关键组件。通过持久卷、持久卷声明和存储类，用户可以灵活地管理存储资源，确保数据在容器重启或迁移时不会丢失。在实际应用中，存储类可以帮助动态创建PV，简化存储管理。

## 5. 附加资源与练习

- **官方文档**：[Kubernetes存储文档](https://kubernetes.io/docs/concepts/storage/)
- **练习**：尝试在本地Kubernetes集群中创建一个存储类，并使用它动态创建一个PV和PVC，最后将其挂载到一个Pod中。

:::tip
在测试环境中，可以使用`hostPath`类型的PV来模拟本地存储，方便快速验证存储配置。
:::