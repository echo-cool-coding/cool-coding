---
title: Kubernetes ConfigMap
description: 了解 Kubernetes ConfigMap 的基本概念、使用方法以及实际应用场景。本文适合初学者，包含代码示例和实际案例。
---

# Kubernetes ConfigMap

## 介绍

在 Kubernetes 中，ConfigMap 是一种用于存储非敏感配置数据的 API 对象。它允许你将配置数据与应用程序代码分离，从而使应用程序更加灵活和可移植。ConfigMap 通常用于存储环境变量、命令行参数或配置文件等内容。

:::tip
ConfigMap 是 Kubernetes 中管理配置的推荐方式之一，特别适用于需要在不同环境（如开发、测试、生产）中使用不同配置的场景。
:::

## 创建 ConfigMap

你可以通过多种方式创建 ConfigMap，包括从文件、目录或直接定义键值对。以下是一些常见的创建方法。

### 从键值对创建

你可以直接在命令行中使用 `kubectl create configmap` 命令创建 ConfigMap：

```bash
kubectl create configmap my-config --from-literal=key1=value1 --from-literal=key2=value2
```

### 从文件创建

如果你有一个配置文件，可以将其内容导入到 ConfigMap 中：

```bash
kubectl create configmap my-config --from-file=path/to/config-file
```

### 从目录创建

你也可以从一个目录中导入多个文件：

```bash
kubectl create configmap my-config --from-file=path/to/config-dir
```

## 使用 ConfigMap

创建 ConfigMap 后，你可以将其挂载到 Pod 中，或者将其内容作为环境变量注入到容器中。

### 作为环境变量使用

以下是一个将 ConfigMap 中的键值对作为环境变量注入到 Pod 中的示例：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  containers:
    - name: my-container
      image: busybox
      command: [ "sh", "-c", "echo $(MY_ENV_VAR)" ]
      env:
        - name: MY_ENV_VAR
          valueFrom:
            configMapKeyRef:
              name: my-config
              key: key1
```

### 挂载为文件

你也可以将 ConfigMap 挂载为文件，供容器内的应用程序读取：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  containers:
    - name: my-container
      image: busybox
      command: [ "sh", "-c", "cat /etc/config/key1" ]
      volumeMounts:
        - name: config-volume
          mountPath: /etc/config
  volumes:
    - name: config-volume
      configMap:
        name: my-config
```

## 实际案例

假设你有一个 Web 应用程序，需要在不同环境中使用不同的数据库连接字符串。你可以将这些连接字符串存储在 ConfigMap 中，并在部署时根据环境选择相应的配置。

### 开发环境 ConfigMap

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: dev-db-config
data:
  DB_HOST: "dev-db.example.com"
  DB_PORT: "3306"
```

### 生产环境 ConfigMap

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: prod-db-config
data:
  DB_HOST: "prod-db.example.com"
  DB_PORT: "3306"
```

### 在 Pod 中使用

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: web-app
spec:
  containers:
    - name: web-app
      image: my-web-app
      env:
        - name: DB_HOST
          valueFrom:
            configMapKeyRef:
              name: dev-db-config
              key: DB_HOST
        - name: DB_PORT
          valueFrom:
            configMapKeyRef:
              name: dev-db-config
              key: DB_PORT
```

## 总结

ConfigMap 是 Kubernetes 中管理配置数据的强大工具。通过将配置数据与应用程序代码分离，你可以轻松地在不同环境中部署应用程序，而无需修改代码。本文介绍了如何创建和使用 ConfigMap，并通过实际案例展示了其应用场景。

## 附加资源

- [Kubernetes 官方文档 - ConfigMap](https://kubernetes.io/docs/concepts/configuration/configmap/)
- [Kubernetes ConfigMap 最佳实践](https://kubernetes.io/docs/concepts/configuration/configmap/#best-practices)

## 练习

1. 创建一个 ConfigMap，包含以下键值对：
   - `APP_NAME=MyApp`
   - `APP_VERSION=1.0.0`
2. 编写一个 Pod 配置，将上述 ConfigMap 中的键值对作为环境变量注入到容器中。
3. 将 ConfigMap 挂载为文件，并在容器中读取文件内容。

通过完成这些练习，你将更好地理解 ConfigMap 的使用方法。