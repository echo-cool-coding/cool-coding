---
title: Kubernetes 资源预留
description: 了解 Kubernetes 中的资源预留机制，如何为 Pod 和节点预留 CPU 和内存资源，以确保集群的稳定性和性能。
---

# Kubernetes 资源预留

在 Kubernetes 集群中，资源管理是一个关键任务。为了确保集群的稳定性和性能，Kubernetes 提供了资源预留（Resource Reservation）机制。资源预留允许管理员为系统组件或关键工作负载预留一定的 CPU 和内存资源，从而避免资源竞争和潜在的集群故障。

## 什么是资源预留？

资源预留是指在 Kubernetes 中为特定组件或 Pod 预留一定量的 CPU 和内存资源。这些资源不会被其他 Pod 或系统进程占用，从而确保关键任务能够正常运行。资源预留通常用于以下场景：

- 为 Kubernetes 系统组件（如 kubelet、kube-proxy）预留资源。
- 为关键业务应用预留资源，确保其在高负载下仍能正常运行。
- 防止节点资源耗尽，导致节点不可用。

## 资源预留的类型

Kubernetes 中的资源预留主要分为两类：

1. **节点级别的资源预留**：在节点上为系统进程（如操作系统、kubelet 等）预留资源。
2. **Pod 级别的资源预留**：为特定的 Pod 预留资源，确保其能够获得所需的计算资源。

### 节点级别的资源预留

节点级别的资源预留是通过配置 kubelet 的 `--system-reserved` 和 `--kube-reserved` 参数来实现的。这些参数允许管理员为系统进程和 Kubernetes 组件预留资源。

- `--system-reserved`：为操作系统和系统进程预留资源。
- `--kube-reserved`：为 Kubernetes 系统组件（如 kubelet、kube-proxy）预留资源。

例如，以下配置为系统进程预留了 500m CPU 和 1Gi 内存，为 Kubernetes 组件预留了 200m CPU 和 512Mi 内存：

```bash
--system-reserved=cpu=500m,memory=1Gi
--kube-reserved=cpu=200m,memory=512Mi
```

### Pod 级别的资源预留

Pod 级别的资源预留是通过在 Pod 的资源配置中设置 `requests` 和 `limits` 来实现的。`requests` 指定了 Pod 运行所需的最小资源量，而 `limits` 指定了 Pod 可以使用的最大资源量。

以下是一个 Pod 的资源配置示例：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  containers:
  - name: my-container
    image: nginx
    resources:
      requests:
        memory: "64Mi"
        cpu: "250m"
      limits:
        memory: "128Mi"
        cpu: "500m"
```

在这个示例中，`my-container` 容器请求了 64Mi 内存和 250m CPU，并且其资源使用量被限制在 128Mi 内存和 500m CPU 以内。

## 实际应用场景

### 场景 1：为 Kubernetes 系统组件预留资源

在一个生产环境中，Kubernetes 集群的节点上运行着多个系统组件（如 kubelet、kube-proxy）。为了确保这些组件在高负载下仍能正常运行，管理员可以为它们预留一定的资源。

例如，以下配置为 Kubernetes 系统组件预留了 200m CPU 和 512Mi 内存：

```bash
--kube-reserved=cpu=200m,memory=512Mi
```

### 场景 2：为关键业务应用预留资源

假设你有一个关键的业务应用，需要确保其在高负载下仍能正常运行。你可以为该应用的 Pod 设置资源请求和限制，以确保其能够获得所需的资源。

以下是一个关键业务应用的 Pod 配置示例：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: critical-app
spec:
  containers:
  - name: app-container
    image: my-critical-app
    resources:
      requests:
        memory: "1Gi"
        cpu: "500m"
      limits:
        memory: "2Gi"
        cpu: "1"
```

在这个示例中，`app-container` 容器请求了 1Gi 内存和 500m CPU，并且其资源使用量被限制在 2Gi 内存和 1 CPU 以内。

## 总结

Kubernetes 资源预留是确保集群稳定性和性能的重要机制。通过节点级别的资源预留，管理员可以为系统进程和 Kubernetes 组件预留资源；通过 Pod 级别的资源预留，管理员可以为关键业务应用预留资源，确保其在高负载下仍能正常运行。

:::tip
在实际使用中，建议根据集群的负载情况和业务需求，合理配置资源预留，以避免资源浪费和性能瓶颈。
:::

## 附加资源

- [Kubernetes 官方文档：资源管理](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/)
- [Kubernetes 资源请求和限制的最佳实践](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#resource-requests-and-limits)

## 练习

1. 在一个 Kubernetes 集群中，尝试为 kubelet 和 kube-proxy 配置资源预留，并观察集群的行为。
2. 创建一个 Pod，为其设置资源请求和限制，并观察 Pod 在不同负载下的资源使用情况。