---
title: Docker API 使用
description: 学习如何使用 Docker API 来管理和操作 Docker 容器、镜像、网络等资源。本文适合初学者，包含详细的代码示例和实际应用场景。
---

## 介绍

Docker API 是 Docker 提供的一组 RESTful API，允许开发者通过编程方式与 Docker 守护进程进行交互。通过 Docker API，你可以管理容器、镜像、网络、卷等资源，而无需直接使用 Docker CLI。这对于自动化任务、集成到 CI/CD 管道或构建自定义工具非常有用。

Docker API 支持多种编程语言，包括 Python、Go、JavaScript 等。本文将重点介绍如何使用 Python 与 Docker API 进行交互。

## 安装 Docker SDK for Python

要使用 Docker API，首先需要安装 Docker SDK for Python。你可以通过以下命令安装：

```bash
pip install docker
```

## 连接到 Docker 守护进程

在开始使用 Docker API 之前，你需要连接到 Docker 守护进程。默认情况下，Docker SDK for Python 会尝试连接到本地的 Docker 守护进程。你可以通过以下代码连接到 Docker 守护进程：

```python
import docker

client = docker.from_env()
```

## 管理容器

### 列出所有容器

你可以使用 `client.containers.list()` 方法列出所有正在运行的容器：

```python
containers = client.containers.list()
for container in containers:
    print(container.id, container.name)
```

### 启动和停止容器

要启动一个容器，你可以使用 `container.start()` 方法。要停止一个容器，可以使用 `container.stop()` 方法：

```python
container = client.containers.get('container_id')
container.start()
container.stop()
```

### 创建容器

你可以使用 `client.containers.run()` 方法创建一个新的容器。以下是一个简单的示例，创建一个运行 `hello-world` 镜像的容器：

```python
container = client.containers.run('hello-world', detach=True)
print(container.id)
```

## 管理镜像

### 列出所有镜像

你可以使用 `client.images.list()` 方法列出所有本地镜像：

```python
images = client.images.list()
for image in images:
    print(image.id, image.tags)
```

### 拉取镜像

要拉取一个远程镜像，你可以使用 `client.images.pull()` 方法：

```python
image = client.images.pull('nginx')
print(image.id)
```

### 删除镜像

要删除一个本地镜像，你可以使用 `client.images.remove()` 方法：

```python
client.images.remove('nginx')
```

## 管理网络

### 列出所有网络

你可以使用 `client.networks.list()` 方法列出所有 Docker 网络：

```python
networks = client.networks.list()
for network in networks:
    print(network.id, network.name)
```

### 创建网络

要创建一个新的 Docker 网络，你可以使用 `client.networks.create()` 方法：

```python
network = client.networks.create('my_network')
print(network.id)
```

### 删除网络

要删除一个 Docker 网络，你可以使用 `client.networks.remove()` 方法：

```python
client.networks.remove('my_network')
```

## 实际应用场景

### 自动化部署

假设你正在开发一个 Web 应用，并希望自动化部署过程。你可以使用 Docker API 来拉取最新的镜像、停止旧的容器、启动新的容器，并清理旧的镜像。以下是一个简单的示例：

```python
import docker

client = docker.from_env()

# 拉取最新镜像
image = client.images.pull('my_web_app:latest')

# 停止并删除旧的容器
old_containers = client.containers.list(filters={'name': 'my_web_app'})
for container in old_containers:
    container.stop()
    container.remove()

# 启动新的容器
container = client.containers.run('my_web_app:latest', name='my_web_app', detach=True)
print(f"New container started: {container.id}")
```

### 监控容器状态

你可以使用 Docker API 来监控容器的状态，并在容器出现问题时自动重启。以下是一个简单的示例：

```python
import docker
import time

client = docker.from_env()

while True:
    containers = client.containers.list()
    for container in containers:
        if container.status == 'exited':
            print(f"Container {container.id} has exited. Restarting...")
            container.start()
    time.sleep(60)
```

## 总结

通过本文，你已经学习了如何使用 Docker API 来管理和操作 Docker 容器、镜像、网络等资源。Docker API 提供了强大的功能，可以帮助你自动化 Docker 相关的任务，并集成到你的开发流程中。

## 附加资源

- [Docker SDK for Python 官方文档](https://docker-py.readthedocs.io/en/stable/)
- [Docker API 官方文档](https://docs.docker.com/engine/api/)

## 练习

1. 使用 Docker API 创建一个新的容器，并配置其网络设置。
2. 编写一个脚本，自动拉取最新的镜像并更新运行中的容器。
3. 使用 Docker API 监控容器的资源使用情况（如 CPU、内存），并在资源使用过高时发出警告。

希望本文能帮助你更好地理解和使用 Docker API。如果你有任何问题或需要进一步的帮助，请参考官方文档或在社区中寻求帮助。