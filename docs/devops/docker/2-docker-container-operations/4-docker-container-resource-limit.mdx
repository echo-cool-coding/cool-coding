---
title: Docker 容器资源限制
description: 了解如何在Docker中限制容器的资源使用，包括CPU、内存等，以确保容器的高效运行和系统资源的合理分配。
---

## 介绍

在Docker中运行容器时，默认情况下，容器可以无限制地使用宿主机的资源。然而，这可能会导致某些容器占用过多的资源，从而影响其他容器或宿主机的性能。为了避免这种情况，Docker允许我们对容器的资源使用进行限制，包括CPU、内存、磁盘I/O等。

本文将详细介绍如何在Docker中设置容器的资源限制，并通过实际案例展示这些限制的应用场景。

## CPU资源限制

### 限制CPU使用率

Docker允许我们通过`--cpus`参数来限制容器可以使用的CPU资源。例如，如果我们希望一个容器最多使用1个CPU核心的50%资源，可以这样设置：

```bash
docker run -it --cpus="0.5" ubuntu
```

在这个例子中，`--cpus="0.5"`表示容器最多可以使用0.5个CPU核心的资源。

### 限制CPU份额

除了限制CPU使用率，我们还可以通过`--cpu-shares`参数来设置容器的CPU份额。CPU份额是一个相对值，默认情况下，所有容器的CPU份额都是1024。如果我们希望某个容器获得更多的CPU资源，可以增加它的CPU份额。

```bash
docker run -it --cpu-shares="512" ubuntu
```

在这个例子中，`--cpu-shares="512"`表示该容器的CPU份额为512，这意味着它获得的CPU资源将少于默认的1024份额的容器。

## 内存资源限制

### 限制内存使用

我们可以通过`--memory`参数来限制容器可以使用的内存大小。例如，如果我们希望一个容器最多使用512MB的内存，可以这样设置：

```bash
docker run -it --memory="512m" ubuntu
```

在这个例子中，`--memory="512m"`表示容器最多可以使用512MB的内存。

### 设置内存交换限制

除了限制内存使用，我们还可以通过`--memory-swap`参数来设置容器的内存交换限制。内存交换限制是指容器可以使用的主机内存和交换空间的总和。

```bash
docker run -it --memory="512m" --memory-swap="1g" ubuntu
```

在这个例子中，`--memory-swap="1g"`表示容器可以使用512MB的内存和512MB的交换空间，总共1GB。

## 磁盘I/O限制

### 限制磁盘I/O

Docker允许我们通过`--device-read-bps`和`--device-write-bps`参数来限制容器的磁盘I/O。例如，如果我们希望一个容器的磁盘读取速度不超过1MB/s，可以这样设置：

```bash
docker run -it --device-read-bps="/dev/sda:1mb" ubuntu
```

在这个例子中，`--device-read-bps="/dev/sda:1mb"`表示容器对`/dev/sda`设备的读取速度不超过1MB/s。

## 实际案例

### 案例1：限制Web服务器的资源使用

假设我们有一个Web服务器容器，我们希望限制它的CPU使用率为1个核心的50%，内存使用为1GB，并且磁盘读取速度不超过2MB/s。我们可以这样启动容器：

```bash
docker run -d --name webserver --cpus="0.5" --memory="1g" --device-read-bps="/dev/sda:2mb" nginx
```

在这个案例中，Web服务器容器将受到CPU、内存和磁盘I/O的限制，确保它不会占用过多的系统资源。

### 案例2：限制数据库容器的资源使用

假设我们有一个数据库容器，我们希望限制它的CPU份额为2048，内存使用为2GB，并且磁盘写入速度不超过5MB/s。我们可以这样启动容器：

```bash
docker run -d --name database --cpu-shares="2048" --memory="2g" --device-write-bps="/dev/sda:5mb" mysql
```

在这个案例中，数据库容器将获得更多的CPU资源，同时受到内存和磁盘I/O的限制，确保它不会影响其他容器的性能。

## 总结

通过设置Docker容器的资源限制，我们可以有效地控制容器对系统资源的使用，避免资源争用和性能问题。本文介绍了如何限制容器的CPU、内存和磁盘I/O资源，并通过实际案例展示了这些限制的应用场景。

## 附加资源

- [Docker官方文档：资源限制](https://docs.docker.com/config/containers/resource_constraints/)
- [Docker资源管理最佳实践](https://docs.docker.com/config/containers/resource_constraints/#best-practices)

## 练习

1. 启动一个容器，限制其CPU使用率为0.25个核心，内存使用为256MB。
2. 启动一个容器，限制其磁盘读取速度不超过1MB/s，并观察其性能。
3. 尝试为多个容器设置不同的CPU份额，观察它们之间的资源分配情况。
