---
title: Docker 容器重启策略
description: 了解Docker容器的重启策略，掌握如何配置容器在异常退出时自动重启，确保服务的稳定性和可靠性。
---

# Docker 容器重启策略

在Docker中，容器的重启策略是一个非常重要的概念。它决定了当容器因某种原因退出时，Docker是否以及如何自动重启该容器。这对于确保服务的稳定性和可靠性至关重要，尤其是在生产环境中。

## 什么是Docker容器重启策略？

Docker容器重启策略定义了当容器退出时，Docker引擎如何处理该容器的行为。容器可能会因为多种原因退出，例如应用程序崩溃、系统资源不足或手动停止。通过配置重启策略，您可以确保容器在退出后能够自动重启，从而减少服务中断的时间。

Docker提供了四种重启策略：

1. **no**：默认策略，容器退出后不会自动重启。
2. **on-failure**：仅在容器以非零状态退出时重启。
3. **always**：无论退出状态如何，容器退出后都会自动重启。
4. **unless-stopped**：与`always`类似，但如果容器被手动停止，则不会自动重启。

## 配置重启策略

您可以在运行容器时通过`--restart`选项来指定重启策略。以下是一些示例：

### 1. 使用`no`策略

```bash
docker run --restart no my-container
```

在这种情况下，如果容器退出，Docker不会尝试重启它。

### 2. 使用`on-failure`策略

```bash
docker run --restart on-failure:5 my-container
```

在这个例子中，如果容器以非零状态退出，Docker将尝试重启它，最多重启5次。

### 3. 使用`always`策略

```bash
docker run --restart always my-container
```

无论容器以何种状态退出，Docker都会自动重启它。

### 4. 使用`unless-stopped`策略

```bash
docker run --restart unless-stopped my-container
```

在这种情况下，容器会在退出后自动重启，除非它被手动停止。

## 实际应用场景

### 场景1：Web服务器

假设您正在运行一个Web服务器容器，您希望确保即使服务器崩溃，它也能自动重启。在这种情况下，您可以使用`always`策略：

```bash
docker run --restart always my-web-server
```

### 场景2：批处理任务

如果您正在运行一个批处理任务容器，并且希望在任务失败时重试，您可以使用`on-failure`策略：

```bash
docker run --restart on-failure:3 my-batch-job
```

在这个例子中，如果任务失败，Docker将尝试重启容器最多3次。

## 总结

Docker容器重启策略是一个强大的工具，可以帮助您确保服务的稳定性和可靠性。通过合理配置重启策略，您可以减少服务中断的时间，并确保容器在异常退出时能够自动恢复。

:::tip
在生产环境中，建议使用`always`或`unless-stopped`策略，以确保服务的高可用性。
:::

## 附加资源

- [Docker官方文档：重启策略](https://docs.docker.com/config/containers/start-containers-automatically/)
- [Docker容器生命周期管理](https://docs.docker.com/engine/reference/run/)

## 练习

1. 创建一个简单的Web服务器容器，并使用`always`重启策略运行它。观察容器在崩溃后是否会自动重启。
2. 尝试使用`on-failure`策略运行一个批处理任务容器，并设置最大重启次数为5。观察容器在任务失败时的行为。

通过以上练习，您将更好地理解Docker容器重启策略的工作原理及其在实际应用中的重要性。