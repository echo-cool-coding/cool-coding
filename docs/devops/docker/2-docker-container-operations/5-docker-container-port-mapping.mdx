---
title: Docker 容器端口映射
description: 了解如何在Docker容器中配置端口映射，以便将容器内的服务暴露给外部网络。本文适合初学者，包含详细的解释、代码示例和实际应用场景。
---

## 介绍

在Docker中，容器是独立运行的应用程序环境。默认情况下，容器内的服务只能在容器内部访问。为了让外部网络能够访问容器内的服务，我们需要进行**端口映射**。端口映射将容器内的端口与主机（即运行Docker的机器）的端口绑定，使得外部请求可以通过主机的端口访问容器内的服务。

本文将详细介绍Docker容器端口映射的概念、配置方法以及实际应用场景。

---

## 什么是端口映射？

端口映射是一种网络配置技术，允许将容器内的端口与主机上的端口进行绑定。通过这种方式，外部网络可以通过主机的IP地址和映射的端口访问容器内的服务。

例如，假设你在容器内运行了一个Web服务器，监听端口`80`。为了让外部用户访问这个Web服务器，你可以将容器内的`80`端口映射到主机的`8080`端口。这样，用户只需访问`http://主机IP:8080`即可访问容器内的Web服务。

---

## 如何配置端口映射？

在Docker中，端口映射可以通过以下两种方式配置：

1. **使用`docker run`命令**：在启动容器时指定端口映射。
2. **使用Docker Compose**：在`docker-compose.yml`文件中定义端口映射。

### 1. 使用`docker run`命令

`docker run`命令的`-p`选项用于配置端口映射。其语法如下：

```bash
docker run -p 主机端口:容器端口 镜像名称
```

例如，将容器内的`80`端口映射到主机的`8080`端口：

```bash
docker run -p 8080:80 nginx
```

运行上述命令后，访问`http://localhost:8080`即可看到Nginx的欢迎页面。

:::note
如果主机端口未指定（例如`-p 80`），Docker会自动选择一个可用的主机端口。
:::

### 2. 使用Docker Compose

在`docker-compose.yml`文件中，可以通过`ports`字段定义端口映射。例如：

```yaml
version: '3'
services:
  web:
    image: nginx
    ports:
      - "8080:80"
```

运行以下命令启动服务：

```bash
docker-compose up
```

此时，访问`http://localhost:8080`即可访问Nginx服务。

---

## 实际应用场景

### 场景1：运行Web服务器

假设你正在开发一个Web应用，并使用Docker容器运行Nginx服务器。为了让团队成员能够访问你的开发环境，你可以将容器内的`80`端口映射到主机的`8080`端口。

```bash
docker run -p 8080:80 nginx
```

团队成员只需访问`http://你的IP地址:8080`即可查看你的Web应用。

### 场景2：运行数据库服务

如果你在容器内运行了一个MySQL数据库，监听端口`3306`，你可以将其映射到主机的`3306`端口，以便本地应用程序能够连接到数据库。

```bash
docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=my-secret-pw mysql
```

本地应用程序可以通过`localhost:3306`连接到容器内的MySQL数据库。

---

## 端口映射的工作原理

为了更好地理解端口映射，我们可以通过以下Mermaid图表展示其工作原理：

```mermaid
graph LR
    A[外部用户] --> B[主机IP:8080]
    B --> C[容器IP:80]
    C --> D[Nginx服务]
```

1. 外部用户访问主机的`8080`端口。
2. Docker将请求转发到容器的`80`端口。
3. 容器内的Nginx服务处理请求并返回响应。

---

## 总结

端口映射是Docker中非常重要的功能，它使得容器内的服务能够被外部网络访问。通过`docker run`命令或Docker Compose文件，我们可以轻松配置端口映射。本文通过实际案例和图表详细解释了端口映射的概念和配置方法。

---

## 附加资源与练习

### 附加资源
- [Docker官方文档 - 端口映射](https://docs.docker.com/config/containers/container-networking/)
- [Docker Compose官方文档](https://docs.docker.com/compose/)

### 练习
1. 使用`docker run`命令运行一个Apache HTTP服务器，并将容器内的`80`端口映射到主机的`8888`端口。
2. 使用Docker Compose配置一个包含Nginx和MySQL的多容器应用，并确保Nginx的`80`端口和MySQL的`3306`端口都正确映射到主机。

通过实践这些练习，你将更深入地理解Docker端口映射的概念和应用。