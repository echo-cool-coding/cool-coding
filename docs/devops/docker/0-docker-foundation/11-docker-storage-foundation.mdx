---
title: Docker 存储基础
description: 了解Docker存储的基本概念，包括卷、绑定挂载和临时文件系统，以及如何在实际场景中使用它们。
---

# Docker 存储基础

Docker 是一个强大的容器化工具，它允许开发者将应用程序及其依赖项打包到一个轻量级的容器中。然而，容器本身是临时的，这意味着当容器停止或删除时，其中的数据也会丢失。为了解决这个问题，Docker 提供了多种存储选项，包括卷（Volumes）、绑定挂载（Bind Mounts）和临时文件系统（tmpfs）。本文将详细介绍这些存储选项，并展示如何在实际场景中使用它们。

## 1. Docker 存储概述

Docker 存储的主要目的是在容器生命周期之外持久化数据。Docker 提供了三种主要的存储方式：

1. **卷（Volumes）**：由 Docker 管理的数据存储，通常存储在宿主机的文件系统中。
2. **绑定挂载（Bind Mounts）**：将宿主机的文件或目录直接挂载到容器中。
3. **临时文件系统（tmpfs）**：将数据存储在内存中，适用于临时数据。

## 2. 卷（Volumes）

卷是 Docker 推荐的持久化数据的方式。卷由 Docker 管理，存储在宿主机的文件系统中，但与容器的生命周期无关。这意味着即使容器被删除，卷中的数据仍然存在。

### 2.1 创建和使用卷

要创建一个卷，可以使用以下命令：

```bash
docker volume create my_volume
```

然后，可以将这个卷挂载到容器中：

```bash
docker run -d --name my_container -v my_volume:/app/data my_image
```

在这个例子中，`my_volume` 卷被挂载到容器的 `/app/data` 目录中。任何写入 `/app/data` 的数据都会持久化到 `my_volume` 卷中。

### 2.2 查看和管理卷

要查看所有卷，可以使用以下命令：

```bash
docker volume ls
```

要删除一个卷，可以使用以下命令：

```bash
docker volume rm my_volume
```

:::note
删除卷时，卷中的数据也会被永久删除。请谨慎操作。
:::

## 3. 绑定挂载（Bind Mounts）

绑定挂载允许你将宿主机的文件或目录直接挂载到容器中。这种方式非常适合在开发环境中使用，因为它允许你在宿主机上编辑代码，并立即在容器中看到更改。

### 3.1 使用绑定挂载

要将宿主机的目录挂载到容器中，可以使用以下命令：

```bash
docker run -d --name my_container -v /path/on/host:/app/data my_image
```

在这个例子中，宿主机的 `/path/on/host` 目录被挂载到容器的 `/app/data` 目录中。任何在 `/app/data` 目录中的更改都会反映在宿主机的 `/path/on/host` 目录中。

:::caution
绑定挂载会直接访问宿主机的文件系统，因此需要谨慎操作，以避免意外修改或删除重要文件。
:::

## 4. 临时文件系统（tmpfs）

临时文件系统（tmpfs）将数据存储在内存中，适用于临时数据。当容器停止时，tmpfs 中的数据会被删除。

### 4.1 使用 tmpfs

要将 tmpfs 挂载到容器中，可以使用以下命令：

```bash
docker run -d --name my_container --tmpfs /app/cache my_image
```

在这个例子中，容器的 `/app/cache` 目录将使用 tmpfs 存储数据。任何写入 `/app/cache` 的数据都会存储在内存中，并在容器停止时被删除。

:::tip
tmpfs 适用于存储临时数据，如缓存或会话数据，因为它不会占用磁盘空间。
:::

## 5. 实际案例

### 5.1 使用卷持久化数据库数据

假设你正在运行一个 MySQL 数据库容器，并希望持久化数据库数据。你可以使用卷来实现这一点：

```bash
docker run -d --name mysql_db -v mysql_data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=mysecretpassword mysql
```

在这个例子中，`mysql_data` 卷被挂载到 MySQL 容器的 `/var/lib/mysql` 目录中，确保数据库数据在容器重启或删除后仍然存在。

### 5.2 使用绑定挂载进行开发

假设你正在开发一个 Node.js 应用程序，并希望在宿主机上编辑代码时，容器中的应用程序能够实时更新。你可以使用绑定挂载来实现这一点：

```bash
docker run -d --name my_app -v /path/to/your/code:/app -p 3000:3000 node
```

在这个例子中，宿主机的 `/path/to/your/code` 目录被挂载到容器的 `/app` 目录中。任何在宿主机上对代码的更改都会立即反映在容器中。

## 6. 总结

Docker 提供了多种存储选项，以满足不同的需求。卷适用于持久化数据，绑定挂载适用于开发环境，而 tmpfs 适用于临时数据。通过合理使用这些存储选项，你可以确保容器中的数据在容器生命周期之外得到妥善管理。

## 7. 附加资源与练习

- **练习 1**：创建一个 MySQL 容器，并使用卷持久化数据库数据。尝试删除容器并重新创建，验证数据是否仍然存在。
- **练习 2**：使用绑定挂载将一个简单的 Node.js 应用程序挂载到容器中，并在宿主机上编辑代码，观察容器中的应用程序是否实时更新。

:::warning
在进行任何操作之前，请确保备份重要数据，以避免意外数据丢失。
:::