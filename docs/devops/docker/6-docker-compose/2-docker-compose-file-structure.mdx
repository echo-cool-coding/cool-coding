---
title: Docker Compose 文件结构
description: 了解 Docker Compose 文件的基本结构，学习如何编写和管理多容器应用程序的配置文件。
---

## 介绍

Docker Compose 是一个用于定义和运行多容器 Docker 应用程序的工具。通过一个名为 `docker-compose.yml` 的 YAML 文件，你可以轻松地配置、启动和管理多个容器。本文将详细介绍 Docker Compose 文件的结构，帮助你理解如何编写和优化你的配置文件。

## Docker Compose 文件的基本结构

Docker Compose 文件通常命名为 `docker-compose.yml`，它是一个 YAML 格式的文件。YAML 是一种人类可读的数据序列化标准，常用于配置文件。Docker Compose 文件的基本结构包括以下几个部分：

1. **版本声明**：指定 Docker Compose 文件的版本。
2. **服务定义**：定义每个容器的配置。
3. **网络配置**：定义容器之间的网络连接。
4. **卷配置**：定义容器使用的持久化存储。

### 版本声明

Docker Compose 文件的第一个部分是版本声明。它指定了 Docker Compose 文件的版本，以确保与 Docker Compose 工具的兼容性。例如：

```yaml
version: '3.8'
```

:::note
不同的 Docker Compose 版本支持不同的功能和语法。建议使用最新的稳定版本。
:::

### 服务定义

服务定义是 Docker Compose 文件的核心部分。每个服务对应一个容器，你可以在这里定义容器的镜像、端口映射、环境变量、依赖关系等。以下是一个简单的服务定义示例：

```yaml
services:
  web:
    image: nginx:latest
    ports:
      - "80:80"
    environment:
      - NGINX_HOST=example.com
    depends_on:
      - db
  db:
    image: postgres:13
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
```

在这个示例中，我们定义了两个服务：`web` 和 `db`。`web` 服务使用最新的 Nginx 镜像，并将主机的 80 端口映射到容器的 80 端口。`db` 服务使用 PostgreSQL 13 镜像，并设置了环境变量。

:::tip
`depends_on` 关键字用于指定服务之间的依赖关系。在这个例子中，`web` 服务依赖于 `db` 服务，因此 `db` 服务会先启动。
:::

### 网络配置

Docker Compose 允许你定义自定义网络，以便容器之间可以相互通信。默认情况下，Docker Compose 会为每个项目创建一个默认网络，但你也可以定义自己的网络。以下是一个网络配置的示例：

```yaml
networks:
  app-network:
    driver: bridge
```

你可以在服务定义中引用这个网络：

```yaml
services:
  web:
    networks:
      - app-network
  db:
    networks:
      - app-network
```

### 卷配置

卷用于持久化存储数据。Docker Compose 允许你定义卷，并将其挂载到容器中。以下是一个卷配置的示例：

```yaml
volumes:
  db-data:
```

你可以在服务定义中引用这个卷：

```yaml
services:
  db:
    volumes:
      - db-data:/var/lib/postgresql/data
```

## 实际案例

假设你正在开发一个简单的 Web 应用程序，该应用程序由一个 Nginx 前端和一个 PostgreSQL 数据库组成。以下是一个完整的 `docker-compose.yml` 文件示例：

```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "80:80"
    environment:
      - NGINX_HOST=example.com
    depends_on:
      - db
    networks:
      - app-network

  db:
    image: postgres:13
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    volumes:
      - db-data:/var/lib/postgresql/data
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

volumes:
  db-data:
```

在这个示例中，我们定义了两个服务：`web` 和 `db`。`web` 服务使用 Nginx 镜像，并将主机的 80 端口映射到容器的 80 端口。`db` 服务使用 PostgreSQL 镜像，并设置了环境变量和卷。两个服务都连接到一个名为 `app-network` 的自定义网络。

## 总结

Docker Compose 文件是管理多容器应用程序的强大工具。通过理解其基本结构，你可以轻松地定义和运行复杂的容器化应用程序。本文介绍了 Docker Compose 文件的版本声明、服务定义、网络配置和卷配置，并通过一个实际案例展示了如何编写一个完整的 `docker-compose.yml` 文件。

## 附加资源

- [Docker Compose 官方文档](https://docs.docker.com/compose/)
- [YAML 语法指南](https://yaml.org/)
- [Docker 网络配置指南](https://docs.docker.com/network/)

## 练习

1. 尝试编写一个 `docker-compose.yml` 文件，定义一个包含 Redis 和 Node.js 应用程序的多容器环境。
2. 修改上面的示例，将 Nginx 服务的端口映射改为 `8080:80`，并观察变化。
3. 为你的应用程序添加一个自定义网络，并确保所有服务都连接到该网络。

通过练习，你将更好地掌握 Docker Compose 文件的结构和编写技巧。