---
title: Docker Compose 版本差异
description: 了解 Docker Compose 不同版本之间的差异，掌握如何在不同版本中编写和管理容器化应用。
---

## 介绍

Docker Compose 是一个用于定义和运行多容器 Docker 应用程序的工具。通过一个简单的 YAML 文件，你可以配置应用程序的服务、网络和卷。随着 Docker Compose 的发展，不同版本之间引入了一些重要的变化和改进。本文将详细介绍 Docker Compose 的版本差异，帮助你更好地理解和使用这个工具。

## Docker Compose 版本概述

Docker Compose 有两个主要版本：**v1** 和 **v2**。v1 是早期的版本，而 v2 是当前推荐使用的版本。v2 版本在性能和功能上都有显著提升，并且与 Docker CLI 更好地集成。

### Docker Compose v1

Docker Compose v1 是一个独立的 Python 脚本，通过 `docker-compose` 命令来运行。它的配置文件通常命名为 `docker-compose.yml`。

```yaml
version: '2'
services:
  web:
    image: nginx
    ports:
      - "80:80"
```

### Docker Compose v2

Docker Compose v2 是 Docker CLI 的一部分，通过 `docker compose` 命令来运行（注意没有连字符）。它的配置文件与 v1 兼容，但推荐使用 `docker-compose.yml` 或 `compose.yaml`。

```yaml
version: '3'
services:
  web:
    image: nginx
    ports:
      - "80:80"
```

## 主要版本差异

### 1. 命令语法

在 v1 中，使用 `docker-compose` 命令：

```bash
docker-compose up
```

在 v2 中，使用 `docker compose` 命令：

```bash
docker compose up
```

### 2. 配置文件版本

Docker Compose 的配置文件有一个 `version` 字段，用于指定配置文件的版本。v1 和 v2 支持不同的配置文件版本。

- **v1** 支持 `version: '1'` 到 `version: '2.4'`。
- **v2** 支持 `version: '1'` 到 `version: '3.8'`。

:::tip
建议使用 `version: '3'` 或更高版本，以获得最新的功能和改进。
:::

### 3. 性能改进

Docker Compose v2 在性能上有显著提升，尤其是在启动和停止多个容器时。v2 使用了更高效的内部机制来管理容器生命周期。

### 4. 与 Docker CLI 的集成

Docker Compose v2 与 Docker CLI 更好地集成，这意味着你可以使用 `docker` 命令来管理 Compose 项目，而不需要单独安装 `docker-compose`。

## 实际案例

假设你有一个简单的 web 应用程序，使用 Nginx 作为 web 服务器，Redis 作为缓存。以下是一个使用 Docker Compose v2 的配置文件示例：

```yaml
version: '3'
services:
  web:
    image: nginx
    ports:
      - "80:80"
  redis:
    image: redis
```

在 v1 中，你可以使用相同的配置文件，但需要使用 `docker-compose` 命令来运行：

```bash
docker-compose up
```

在 v2 中，你可以使用 `docker compose` 命令：

```bash
docker compose up
```

## 总结

Docker Compose 是一个强大的工具，可以帮助你轻松管理多容器应用程序。v2 版本在性能和功能上都有显著提升，并且与 Docker CLI 更好地集成。建议使用 v2 版本，并尽量使用最新的配置文件版本（如 `version: '3'` 或更高）。

## 附加资源

- [Docker Compose 官方文档](https://docs.docker.com/compose/)
- [Docker Compose v2 发布说明](https://docs.docker.com/compose/cli-command/)

## 练习

1. 尝试将现有的 Docker Compose v1 项目迁移到 v2，并比较两者的性能差异。
2. 创建一个新的 Docker Compose 项目，使用 `version: '3.8'` 配置文件，并运行它。

:::caution
在迁移项目时，请确保备份现有的配置文件，以防止意外丢失数据。
:::