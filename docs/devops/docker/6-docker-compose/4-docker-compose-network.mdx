---
title: Docker Compose 网络
description: 了解 Docker Compose 网络的基本概念、配置方法以及实际应用场景，帮助初学者掌握容器间的通信和网络管理。
---

# Docker Compose 网络

Docker Compose 是一个用于定义和运行多容器 Docker 应用程序的工具。它通过一个 YAML 文件来配置应用程序的服务、网络和卷等资源。在 Docker Compose 中，网络（Networks）是一个非常重要的概念，它决定了容器之间如何通信以及如何与外部世界交互。

## 什么是 Docker Compose 网络？

Docker Compose 网络是 Docker 网络的一个抽象层，它允许你在多个容器之间创建和管理网络连接。通过定义网络，你可以控制哪些容器可以相互通信，以及它们如何访问外部资源。

默认情况下，Docker Compose 会为你的应用程序创建一个默认网络，所有服务都会自动加入这个网络。你也可以自定义网络，以满足更复杂的应用场景。

## 基本网络配置

在 Docker Compose 文件中，你可以通过 `networks` 关键字来定义网络。以下是一个简单的示例：

```yaml
version: '3.8'

services:
  web:
    image: nginx
    ports:
      - "80:80"
    networks:
      - frontend

  db:
    image: postgres
    environment:
      POSTGRES_PASSWORD: example
    networks:
      - backend

networks:
  frontend:
  backend:
```

在这个示例中，我们定义了两个网络：`frontend` 和 `backend`。`web` 服务加入了 `frontend` 网络，而 `db` 服务加入了 `backend` 网络。这样，`web` 和 `db` 服务将分别在不同的网络中运行，彼此之间无法直接通信。

## 容器间通信

默认情况下，Docker Compose 会为每个服务创建一个 DNS 记录，使得容器可以通过服务名称进行通信。例如，在上面的示例中，`web` 服务可以通过 `db` 这个名称来访问 `db` 服务。

```yaml
version: '3.8'

services:
  web:
    image: nginx
    networks:
      - app-network

  db:
    image: postgres
    environment:
      POSTGRES_PASSWORD: example
    networks:
      - app-network

networks:
  app-network:
```

在这个示例中，`web` 和 `db` 服务都加入了 `app-network` 网络。因此，`web` 服务可以通过 `db` 这个名称来访问 `db` 服务，反之亦然。

## 自定义网络配置

你可以通过 `networks` 关键字来定义自定义网络，并指定网络驱动、IP 地址范围等参数。以下是一个自定义网络的示例：

```yaml
version: '3.8'

services:
  web:
    image: nginx
    networks:
      app-network:
        ipv4_address: 172.20.0.2

  db:
    image: postgres
    environment:
      POSTGRES_PASSWORD: example
    networks:
      app-network:
        ipv4_address: 172.20.0.3

networks:
  app-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
```

在这个示例中，我们定义了一个名为 `app-network` 的自定义网络，并指定了 `bridge` 驱动和 IP 地址范围。`web` 和 `db` 服务分别分配了固定的 IP 地址。

## 实际应用场景

### 微服务架构

在微服务架构中，通常会有多个服务需要相互通信。通过 Docker Compose 网络，你可以轻松地将这些服务连接在一起，并控制它们之间的通信方式。

```yaml
version: '3.8'

services:
  frontend:
    image: my-frontend-app
    ports:
      - "3000:3000"
    networks:
      - app-network

  backend:
    image: my-backend-app
    networks:
      - app-network

  database:
    image: postgres
    environment:
      POSTGRES_PASSWORD: example
    networks:
      - app-network

networks:
  app-network:
```

在这个示例中，`frontend`、`backend` 和 `database` 服务都加入了 `app-network` 网络。`frontend` 服务可以通过 `backend` 和 `database` 这两个名称来访问相应的服务。

### 多环境部署

在不同的环境中（如开发、测试、生产），你可能需要不同的网络配置。通过 Docker Compose 网络，你可以轻松地为每个环境定义不同的网络配置。

```yaml
version: '3.8'

services:
  web:
    image: nginx
    networks:
      - ${ENVIRONMENT}-network

networks:
  dev-network:
  test-network:
  prod-network:
```

在这个示例中，我们通过环境变量 `${ENVIRONMENT}` 来动态选择网络配置。例如，在开发环境中，`web` 服务将加入 `dev-network` 网络。

## 总结

Docker Compose 网络是管理多容器应用程序通信的关键工具。通过定义网络，你可以控制容器之间的通信方式，并满足复杂的应用场景需求。无论是微服务架构还是多环境部署，Docker Compose 网络都能帮助你轻松实现。

## 附加资源

- [Docker 官方文档 - 网络](https://docs.docker.com/network/)
- [Docker Compose 官方文档](https://docs.docker.com/compose/)
- [Docker 网络驱动详解](https://docs.docker.com/network/drivers/)

## 练习

1. 创建一个包含两个服务的 Docker Compose 文件，并定义一个自定义网络，使这两个服务能够相互通信。
2. 修改上述 Docker Compose 文件，为每个服务分配固定的 IP 地址。
3. 尝试在不同的环境中使用不同的网络配置，并验证其效果。

通过以上练习，你将更深入地理解 Docker Compose 网络的概念和应用。