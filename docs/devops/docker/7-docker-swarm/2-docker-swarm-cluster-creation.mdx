---
title: Docker Swarm集群创建
description: 学习如何创建和管理Docker Swarm集群，掌握容器编排的基础知识。
---

# Docker Swarm集群创建

Docker Swarm 是 Docker 官方提供的容器编排工具，用于管理和调度多个 Docker 容器。它允许你将多个 Docker 主机组成一个集群，并在集群中部署和管理容器化应用。Swarm 提供了高可用性、负载均衡和自动扩展等功能，是构建分布式系统的理想选择。

## 什么是 Docker Swarm？

Docker Swarm 是 Docker 的原生集群管理工具，它允许你将多个 Docker 主机（节点）组成一个集群，并在集群中运行和管理容器化应用。Swarm 使用标准的 Docker API，因此你可以使用熟悉的 Docker 命令来管理集群。

Swarm 集群由两种类型的节点组成：
- **Manager 节点**：负责管理集群的状态、调度任务和处理 API 请求。
- **Worker 节点**：负责运行容器任务。

## 创建 Docker Swarm 集群

### 1. 初始化 Swarm 集群

首先，你需要在 Manager 节点上初始化 Swarm 集群。假设你已经在一台机器上安装了 Docker，并且这台机器将成为 Manager 节点。

```bash
docker swarm init --advertise-addr <MANAGER-IP>
```

- `<MANAGER-IP>` 是 Manager 节点的 IP 地址。

执行上述命令后，Docker 会生成一个加入集群的命令，用于将其他节点加入到 Swarm 集群中。

```bash
Swarm initialized: current node (xyz123) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-abc123 192.168.1.100:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.
```

### 2. 添加 Worker 节点

在 Worker 节点上，使用上一步生成的命令将节点加入到 Swarm 集群中。

```bash
docker swarm join --token SWMTKN-1-abc123 192.168.1.100:2377
```

执行成功后，Worker 节点将加入到 Swarm 集群中。

### 3. 查看集群节点

在 Manager 节点上，你可以使用以下命令查看集群中的所有节点：

```bash
docker node ls
```

输出示例：

```bash
ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
xyz123 *                      manager-node        Ready               Active              Leader              20.10.7
abc456                        worker-node-1       Ready               Active                                  20.10.7
def789                        worker-node-2       Ready               Active                                  20.10.7
```

## 部署服务到 Swarm 集群

### 1. 创建服务

在 Swarm 集群中，你可以使用 `docker service create` 命令来部署服务。以下是一个简单的示例，部署一个 Nginx 服务：

```bash
docker service create --name nginx --replicas 3 -p 80:80 nginx
```

- `--name nginx`：指定服务名称为 `nginx`。
- `--replicas 3`：指定服务的副本数为 3。
- `-p 80:80`：将容器的 80 端口映射到主机的 80 端口。

### 2. 查看服务状态

你可以使用以下命令查看服务的状态：

```bash
docker service ls
```

输出示例：

```bash
ID                  NAME                MODE                REPLICAS            IMAGE               PORTS
abc123              nginx               replicated          3/3                 nginx:latest        *:80->80/tcp
```

### 3. 扩展服务

你可以使用 `docker service scale` 命令来扩展服务的副本数。例如，将 Nginx 服务的副本数扩展到 5 个：

```bash
docker service scale nginx=5
```

## 实际应用场景

### 高可用 Web 服务

假设你正在运行一个高可用的 Web 服务，你可以在 Swarm 集群中部署多个 Nginx 实例，并通过负载均衡器将流量分发到这些实例上。这样，即使某个节点出现故障，服务仍然可以正常运行。

### 微服务架构

在微服务架构中，你可以使用 Swarm 来部署和管理多个微服务。每个微服务可以独立扩展和更新，Swarm 会自动处理服务发现和负载均衡。

## 总结

Docker Swarm 是一个强大的容器编排工具，适合初学者快速上手。通过 Swarm，你可以轻松地将多个 Docker 主机组成一个集群，并在集群中部署和管理容器化应用。Swarm 提供了高可用性、负载均衡和自动扩展等功能，是构建分布式系统的理想选择。

## 附加资源

- [Docker 官方文档](https://docs.docker.com/engine/swarm/)
- [Docker Swarm 教程](https://www.docker.com/blog/docker-swarm-tutorial/)
- [Docker Swarm 实战](https://www.youtube.com/watch?v=Qw9zlE3t8Ko)

## 练习

1. 创建一个包含 1 个 Manager 节点和 2 个 Worker 节点的 Swarm 集群。
2. 在集群中部署一个 Redis 服务，并将其扩展到 3 个副本。
3. 使用 `docker service logs` 命令查看 Redis 服务的日志。

通过完成这些练习，你将更好地理解 Docker Swarm 的工作原理和使用方法。