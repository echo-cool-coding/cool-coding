---
title: Docker Swarm 服务部署
description: 学习如何在 Docker Swarm 中部署和管理服务。本文将从基础概念入手，逐步讲解如何创建、扩展和管理服务，并提供实际案例帮助理解。
---

# Docker Swarm 服务部署

Docker Swarm 是 Docker 的原生集群管理工具，它允许你将多个 Docker 主机组成一个集群，并在集群中部署和管理服务。通过 Docker Swarm，你可以轻松地扩展应用程序、实现高可用性，并简化容器化应用的部署流程。

## 什么是 Docker Swarm 服务？

在 Docker Swarm 中，**服务**是一个定义任务（tasks）的抽象概念。每个任务是一个运行的容器实例，而服务则定义了这些容器的行为，例如要运行的镜像、副本数量、网络配置等。Swarm 会自动管理这些任务，确保它们按照定义的状态运行。

## 创建 Docker Swarm 集群

在部署服务之前，你需要先初始化一个 Docker Swarm 集群。以下是初始化集群的步骤：

1. 在管理节点上运行以下命令：
   ```bash
   docker swarm init
   ```
   这将初始化一个 Swarm 集群，并将当前节点设置为管理节点。

2. 输出中会包含一个加入集群的命令，例如：
   ```bash
   docker swarm join --token SWMTKN-1-xxxxx 192.168.1.100:2377
   ```
   在其他节点上运行此命令，将它们加入集群。

:::tip
你可以通过 `docker node ls` 命令查看集群中的所有节点。
:::

## 部署服务

一旦集群准备就绪，你就可以开始部署服务了。以下是一个简单的服务部署示例：

```bash
docker service create --name web --replicas 3 -p 80:80 nginx
```

- `--name web`：为服务命名为 `web`。
- `--replicas 3`：指定运行 3 个副本（即 3 个容器实例）。
- `-p 80:80`：将主机的 80 端口映射到容器的 80 端口。
- `nginx`：指定要运行的镜像。

运行此命令后，Swarm 会在集群中启动 3 个 Nginx 容器，并将它们分布在可用的节点上。

## 查看服务状态

你可以使用以下命令查看服务的状态：

```bash
docker service ls
```

输出示例：
```
ID             NAME      MODE         REPLICAS   IMAGE          PORTS
abc123xyz456   web       replicated   3/3        nginx:latest   *:80->80/tcp
```

要查看服务的详细信息，可以使用：
```bash
docker service ps web
```

## 扩展服务

在 Swarm 中，你可以轻松地扩展服务的副本数量。例如，将 `web` 服务的副本数量扩展到 5 个：

```bash
docker service scale web=5
```

Swarm 会自动启动额外的容器实例，并将它们分配到集群中的节点上。

## 更新服务

Swarm 支持滚动更新服务。例如，更新 `web` 服务的镜像版本：

```bash
docker service update --image nginx:1.21 web
```

Swarm 会逐步替换旧的容器实例，确保服务不会中断。

## 实际案例：部署一个高可用 Web 应用

假设你需要部署一个高可用的 Web 应用，以下是具体步骤：

1. 创建一个包含 5 个副本的 Nginx 服务：
   ```bash
   docker service create --name web --replicas 5 -p 80:80 nginx
   ```

2. 确保服务正常运行：
   ```bash
   docker service ps web
   ```

3. 如果需要更新镜像版本，执行滚动更新：
   ```bash
   docker service update --image nginx:1.21 web
   ```

4. 如果需要扩展服务，增加副本数量：
   ```bash
   docker service scale web=10
   ```

通过以上步骤，你可以轻松地在 Swarm 中部署和管理一个高可用的 Web 应用。

## 总结

Docker Swarm 提供了一种简单而强大的方式来部署和管理容器化应用。通过服务抽象，你可以轻松地扩展、更新和维护应用程序，同时确保高可用性和负载均衡。

:::note
如果你希望深入学习 Docker Swarm，可以参考以下资源：
- [Docker 官方文档](https://docs.docker.com/engine/swarm/)
- 《Docker 实战》书籍
:::

现在，你可以尝试在自己的集群中部署一个服务，并探索更多高级功能！