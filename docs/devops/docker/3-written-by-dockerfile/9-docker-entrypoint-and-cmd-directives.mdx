---
title: Docker ENTRYPOINT与CMD指令
description: 了解Dockerfile中的ENTRYPOINT和CMD指令，掌握它们在容器启动时的作用与区别，并通过实际案例加深理解。
---

## 介绍

在Docker中，`ENTRYPOINT`和`CMD`是两个非常重要的指令，它们用于定义容器启动时执行的命令。虽然它们的功能相似，但在实际使用中有一些关键区别。理解它们的用法和区别，可以帮助你更好地控制容器的行为。

:::note
`ENTRYPOINT`和`CMD`都可以用于指定容器启动时运行的命令，但它们的作用范围和优先级不同。
:::

## ENTRYPOINT 指令

`ENTRYPOINT`指令用于设置容器启动时执行的主命令。它的主要特点是：

1. **不可覆盖**：如果在Dockerfile中定义了`ENTRYPOINT`，那么在运行容器时，用户无法通过命令行参数覆盖它。
2. **参数传递**：`ENTRYPOINT`可以接受`CMD`或命令行传递的参数。

### 示例

```dockerfile
FROM ubuntu:latest
ENTRYPOINT ["echo", "Hello"]
```

构建并运行该镜像：

```bash
docker build -t myimage .
docker run myimage
```

输出：

```
Hello
```

如果你尝试传递参数：

```bash
docker run myimage World
```

输出仍然是：

```
Hello
```

因为`ENTRYPOINT`不会被覆盖。

## CMD 指令

`CMD`指令用于设置容器启动时的默认命令。它的主要特点是：

1. **可覆盖**：如果在Dockerfile中定义了`CMD`，用户可以在运行容器时通过命令行参数覆盖它。
2. **默认行为**：`CMD`通常用于定义容器的默认行为，但允许用户在运行时自定义。

### 示例

```dockerfile
FROM ubuntu:latest
CMD ["echo", "Hello"]
```

构建并运行该镜像：

```bash
docker build -t myimage .
docker run myimage
```

输出：

```
Hello
```

如果你尝试传递参数：

```bash
docker run myimage echo World
```

输出将是：

```
World
```

因为`CMD`被命令行参数覆盖。

## ENTRYPOINT 与 CMD 的结合使用

`ENTRYPOINT`和`CMD`可以结合使用，`ENTRYPOINT`定义主命令，`CMD`提供默认参数。这样可以在不覆盖主命令的情况下，允许用户传递参数。

### 示例

```dockerfile
FROM ubuntu:latest
ENTRYPOINT ["echo"]
CMD ["Hello"]
```

构建并运行该镜像：

```bash
docker build -t myimage .
docker run myimage
```

输出：

```
Hello
```

如果你尝试传递参数：

```bash
docker run myimage World
```

输出将是：

```
World
```

因为`ENTRYPOINT`保持不变，而`CMD`的参数被覆盖。

## 实际应用场景

### 场景1：Web服务器

假设你正在构建一个Web服务器镜像，你可能希望`ENTRYPOINT`设置为启动服务器的命令，而`CMD`设置为默认的配置文件路径。

```dockerfile
FROM nginx:latest
ENTRYPOINT ["nginx", "-c"]
CMD ["/etc/nginx/nginx.conf"]
```

这样，用户可以在运行时指定不同的配置文件：

```bash
docker run mynginx -c /path/to/custom.conf
```

### 场景2：数据处理脚本

如果你有一个数据处理脚本，你可能希望`ENTRYPOINT`设置为执行脚本的命令，而`CMD`设置为默认的输入文件。

```dockerfile
FROM python:3.9
ENTRYPOINT ["python", "process_data.py"]
CMD ["input.csv"]
```

用户可以在运行时指定不同的输入文件：

```bash
docker run mydata input2.csv
```

## 总结

`ENTRYPOINT`和`CMD`是Dockerfile中非常重要的指令，它们用于定义容器启动时执行的命令。`ENTRYPOINT`通常用于设置主命令，而`CMD`用于提供默认参数。理解它们的区别和结合使用方式，可以帮助你更好地控制容器的行为。

## 附加资源

- [Docker官方文档 - ENTRYPOINT](https://docs.docker.com/engine/reference/builder/#entrypoint)
- [Docker官方文档 - CMD](https://docs.docker.com/engine/reference/builder/#cmd)

## 练习

1. 创建一个Dockerfile，使用`ENTRYPOINT`和`CMD`结合的方式，启动一个Python脚本，并允许用户传递参数。
2. 尝试在运行容器时覆盖`CMD`的默认参数，观察输出结果。

通过练习，你将更深入地理解`ENTRYPOINT`和`CMD`的用法和区别。