---
title: Docker Dockerfile基础
description: 了解 Dockerfile 的基础知识，学习如何编写 Dockerfile 来构建 Docker 镜像，并通过实际案例掌握其应用场景。
---

## 什么是 Dockerfile？

Dockerfile 是一个文本文件，包含了一系列指令，用于自动化构建 Docker 镜像。通过 Dockerfile，你可以定义镜像的构建过程，包括安装软件、配置环境、复制文件等操作。Docker 会根据 Dockerfile 中的指令逐步构建镜像，最终生成一个可运行的容器环境。

## Docker file 的基本结构

一个典型的 Dockerfile 由多个指令组成，每个指令对应一个镜像构建步骤。以下是一个简单的 Dockerfile 示例：

```dockerfile
# 使用基础镜像
FROM ubuntu:20.04

# 设置工作目录
WORKDIR /app

# 复制当前目录下的文件到容器中
COPY . .

# 安装依赖
RUN apt-get update && apt-get install -y python3

# 设置环境变量
ENV PYTHONUNBUFFERED=1

# 暴露端口
EXPOSE 80

# 运行命令
CMD ["python3", "app.py"]
```

### 指令详解

1. **FROM**: 指定基础镜像。Docker 镜像通常是基于其他镜像构建的，`FROM` 指令用于指定基础镜像。例如，`FROM ubuntu:20.04` 表示基于 Ubuntu 20.04 镜像构建。

2. **WORKDIR**: 设置工作目录。`WORKDIR` 指令用于设置容器内的当前工作目录，后续的指令（如 `COPY`、`RUN` 等）都会在这个目录下执行。

3. **COPY**: 复制文件。`COPY` 指令用于将主机上的文件或目录复制到容器中。例如，`COPY . .` 表示将当前目录下的所有文件复制到容器的 `/app` 目录下。

4. **RUN**: 执行命令。`RUN` 指令用于在容器中执行命令，通常用于安装软件包或配置环境。例如，`RUN apt-get update && apt-get install -y python3` 表示更新包管理器并安装 Python3。

5. **ENV**: 设置环境变量。`ENV` 指令用于设置容器内的环境变量。例如，`ENV PYTHONUNBUFFERED=1` 表示设置 Python 的 `PYTHONUNBUFFERED` 环境变量为 1。

6. **EXPOSE**: 暴露端口。`EXPOSE` 指令用于声明容器运行时监听的端口。例如，`EXPOSE 80` 表示容器将监听 80 端口。

7. **CMD**: 设置默认命令。`CMD` 指令用于设置容器启动时执行的默认命令。例如，`CMD ["python3", "app.py"]` 表示容器启动时运行 `python3 app.py`。

## 实际案例：构建一个 Python Web 应用镜像

假设我们有一个简单的 Python Web 应用，目录结构如下：

```
myapp/
├── app.py
├── requirements.txt
└── Dockerfile
```

`app.py` 是一个简单的 Flask 应用：

```python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello():
    return "Hello, Docker!"

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=80)
```

`requirements.txt` 包含应用所需的依赖：

```
Flask==2.0.1
```

我们可以编写如下的 Dockerfile 来构建镜像：

```dockerfile
# 使用 Python 3.9 作为基础镜像
FROM python:3.9-slim

# 设置工作目录
WORKDIR /app

# 复制 requirements.txt 并安装依赖
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 复制应用代码
COPY . .

# 暴露端口
EXPOSE 80

# 运行应用
CMD ["python", "app.py"]
```

### 构建镜像

在 `myapp` 目录下运行以下命令来构建镜像：

```bash
docker build -t myapp .
```

### 运行容器

构建完成后，可以使用以下命令运行容器：

```bash
docker run -p 80:80 myapp
```

此时，你可以在浏览器中访问 `http://localhost`，看到 "Hello, Docker!" 的输出。

## 总结

通过本文，你学习了 Dockerfile 的基础知识，包括常用指令的含义和使用方法。我们还通过一个实际的 Python Web 应用案例，展示了如何编写 Dockerfile 并构建镜像。

:::tip 提示
- 在编写 Dockerfile 时，尽量保持指令的顺序合理，以减少镜像层的大小。
- 使用 `.dockerignore` 文件来忽略不需要复制到容器中的文件，类似于 `.gitignore`。
:::

## 附加资源与练习

1. **练习**: 尝试为你的项目编写一个 Dockerfile，并构建镜像运行容器。
2. **深入学习**: 阅读 [Docker 官方文档](https://docs.docker.com/engine/reference/builder/) 了解更多高级指令和最佳实践。
3. **扩展**: 学习如何使用 Docker Compose 来管理多个容器的应用。

通过不断实践和学习，你将能够熟练使用 Dockerfile 来构建和管理 Docker 镜像。