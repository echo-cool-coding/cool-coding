---
title: Docker ENV与ARG指令
description: "了解 Dockerfile 中的 ENV 和 ARG 指令，掌握如何通过环境变量和构建参数定制化容器镜像。"
---

在 Dockerfile 中，`ENV` 和 `ARG` 是两个非常重要的指令，它们分别用于定义环境变量和构建参数。理解它们的区别和使用场景，可以帮助你更灵活地构建和管理 Docker 镜像。

## 1. 什么是 ENV 和 ARG？

### ENV 指令
`ENV` 指令用于在 Docker 镜像中设置环境变量。这些变量可以在容器运行时使用，也可以在 Dockerfile 的其他指令中引用。环境变量通常用于配置应用程序的行为，例如数据库连接字符串、API 密钥等。

### ARG 指令
`ARG` 指令用于定义构建时的参数。这些参数只在构建镜像时有效，不会在容器运行时保留。`ARG` 通常用于在构建过程中传递一些临时值，例如版本号、构建路径等。

## 2. ENV 和 ARG 的基本用法

### ENV 的基本用法
```dockerfile
ENV MY_NAME="John Doe"
ENV MY_AGE=30
```

在上面的例子中，我们定义了两个环境变量 `MY_NAME` 和 `MY_AGE`。这些变量可以在容器运行时通过 `echo $MY_NAME` 或 `echo $MY_AGE` 来访问。

### ARG 的基本用法
```dockerfile
ARG VERSION=1.0
ARG BUILD_PATH=/app
```

在这个例子中，我们定义了两个构建参数 `VERSION` 和 `BUILD_PATH`。这些参数可以在构建过程中使用，例如：

```dockerfile
FROM ubuntu:${VERSION}
COPY . ${BUILD_PATH}
```

## 3. ENV 和 ARG 的区别

| 特性          | ENV                          | ARG                          |
|---------------|------------------------------|------------------------------|
| 作用范围      | 容器运行时和构建时           | 仅在构建时有效               |
| 持久性        | 持久化到容器中               | 不持久化，仅在构建时有效     |
| 默认值        | 可以设置默认值               | 可以设置默认值               |
| 覆盖方式      | 可以在运行时覆盖             | 只能在构建时通过 `--build-arg` 覆盖 |

:::note
`ARG` 的值不会在最终的镜像中保留，而 `ENV` 的值会保留在镜像中，并在容器运行时可用。
:::

## 4. 实际应用场景

### 场景 1：使用 ARG 传递构建版本
假设你正在构建一个应用程序镜像，并且希望在构建时指定版本号。你可以使用 `ARG` 来实现：

```dockerfile
ARG APP_VERSION=1.0
FROM ubuntu:${APP_VERSION}
```

在构建镜像时，你可以通过 `--build-arg` 参数覆盖默认值：

```bash
docker build --build-arg APP_VERSION=2.0 -t myapp .
```

### 场景 2：使用 ENV 配置应用程序
假设你的应用程序需要一个数据库连接字符串，你可以使用 `ENV` 来设置：

```dockerfile
ENV DB_URL="postgres://user:password@db:5432/mydb"
```

在容器运行时，应用程序可以通过 `process.env.DB_URL`（Node.js）或 `os.getenv("DB_URL")`（Python）来访问这个环境变量。

## 5. 总结

- `ENV` 用于设置环境变量，这些变量在容器运行时可用。
- `ARG` 用于定义构建参数，这些参数仅在构建时有效。
- `ENV` 的值会持久化到镜像中，而 `ARG` 的值不会。
- 你可以通过 `--build-arg` 在构建时覆盖 `ARG` 的默认值。

## 6. 附加资源与练习

### 练习 1
尝试编写一个 Dockerfile，使用 `ARG` 传递一个构建路径，并使用 `ENV` 设置一个环境变量。然后构建镜像并运行容器，验证环境变量是否生效。

### 练习 2
在 Dockerfile 中使用 `ARG` 和 `ENV` 结合，构建一个可以根据不同环境（开发、测试、生产）配置的应用程序镜像。

### 附加资源
- [Docker 官方文档 - ENV](https://docs.docker.com/engine/reference/builder/#env)
- [Docker 官方文档 - ARG](https://docs.docker.com/engine/reference/builder/#arg)
