---
title: Jenkins Helm 集成
description: 了解如何使用 Helm 在 Kubernetes 中部署和管理 Jenkins，实现容器化与云原生的无缝集成。
---

## 介绍

在现代云原生环境中，Jenkins 作为持续集成和持续交付（CI/CD）的核心工具，通常需要与 Kubernetes 等容器编排平台集成。Helm 是 Kubernetes 的包管理工具，能够简化应用程序的部署和管理。通过 Helm，我们可以轻松地将 Jenkins 部署到 Kubernetes 集群中，并实现自动化管理。

本文将逐步介绍如何使用 Helm 在 Kubernetes 中部署 Jenkins，并展示如何通过 Helm Chart 自定义 Jenkins 配置。

---

## 什么是 Helm？

Helm 是 Kubernetes 的包管理工具，类似于 Linux 中的 apt 或 yum。它通过 Helm Chart（一种预定义的 Kubernetes 资源模板）来简化应用程序的部署和管理。Helm Chart 包含了应用程序的所有 Kubernetes 资源定义（如 Deployment、Service、ConfigMap 等），并允许用户通过 `values.yaml` 文件自定义配置。

---

## 安装 Helm

在开始之前，请确保你已经安装了 Helm。如果没有，可以按照以下步骤安装：

1. 下载 Helm 安装脚本：
   ```bash
   curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
   ```

2. 运行安装脚本：
   ```bash
   chmod 700 get_helm.sh
   ./get_helm.sh
   ```

3. 验证安装：
   ```bash
   helm version
   ```

---

## 使用 Helm 部署 Jenkins

### 1. 添加 Jenkins Helm Chart 仓库

首先，我们需要添加 Jenkins 的官方 Helm Chart 仓库：

```bash
helm repo add jenkins https://charts.jenkins.io
helm repo update
```

### 2. 安装 Jenkins

使用以下命令安装 Jenkins：

```bash
helm install my-jenkins jenkins/jenkins
```

这将使用默认配置在 Kubernetes 集群中部署 Jenkins。

### 3. 自定义 Jenkins 配置

通过 `values.yaml` 文件，我们可以自定义 Jenkins 的配置。例如，修改 Jenkins 的管理员用户名和密码：

```yaml
controller:
  adminUser: "admin"
  adminPassword: "my-secure-password"
```

然后使用以下命令安装 Jenkins：

```bash
helm install my-jenkins jenkins/jenkins -f values.yaml
```

---

## 实际案例：在 Kubernetes 中部署 Jenkins 并配置持久化存储

在实际生产环境中，Jenkins 的数据（如作业配置和构建日志）需要持久化存储。以下是一个完整的示例：

### 1. 创建 `values.yaml` 文件

```yaml
controller:
  adminUser: "admin"
  adminPassword: "my-secure-password"
  persistence:
    enabled: true
    size: 10Gi
    storageClass: "standard"
```

### 2. 安装 Jenkins

```bash
helm install my-jenkins jenkins/jenkins -f values.yaml
```

### 3. 验证部署

使用以下命令查看 Jenkins 的 Service 信息：

```bash
kubectl get svc my-jenkins
```

访问 Jenkins 的 Web 界面，并使用配置的用户名和密码登录。

---

## 总结

通过 Helm，我们可以轻松地在 Kubernetes 中部署和管理 Jenkins，并实现配置的灵活定制。Helm Chart 提供了一种标准化的方式来管理 Jenkins 的 Kubernetes 资源，极大地简化了部署和维护流程。

---

## 附加资源与练习

### 附加资源
- [Helm 官方文档](https://helm.sh/docs/)
- [Jenkins Helm Chart 官方文档](https://github.com/jenkinsci/helm-charts)

### 练习
1. 尝试使用 Helm 部署 Jenkins，并配置自定义的持久化存储。
2. 探索 Jenkins Helm Chart 的其他配置选项，例如插件管理和资源限制。
3. 将 Jenkins 与其他 Kubernetes 工具（如 Prometheus 或 Grafana）集成，实现监控和告警功能。

:::tip
如果你在部署过程中遇到问题，可以查看 Kubernetes 集群的日志（`kubectl logs <pod-name>`）或 Helm 的调试信息（`helm install --debug`）。
:::