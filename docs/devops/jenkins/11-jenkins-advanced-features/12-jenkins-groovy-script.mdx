---
title: Jenkins Groovy 脚本
description: 了解如何使用 Jenkins Groovy 脚本来自动化和扩展 Jenkins 的功能。本文将从基础概念讲起，逐步深入，并提供实际案例和代码示例。
---

# Jenkins Groovy 脚本

Jenkins 是一个广泛使用的持续集成和持续交付（CI/CD）工具，而 Groovy 是一种强大的动态编程语言，与 Java 兼容。通过 Jenkins Groovy 脚本，您可以自动化 Jenkins 的配置、管理和扩展其功能。本文将带您从基础概念开始，逐步掌握 Jenkins Groovy 脚本的使用。

## 什么是 Jenkins Groovy 脚本？

Jenkins Groovy 脚本是一种基于 Groovy 语言的脚本，用于与 Jenkins 进行交互。它可以在 Jenkins 的多个场景中使用，例如：

- **Pipeline 脚本**：定义 CI/CD 流水线。
- **系统配置**：自动化 Jenkins 的全局配置。
- **插件管理**：安装、更新或卸载插件。
- **作业管理**：创建、修改或删除 Jenkins 作业。

Groovy 脚本的强大之处在于它可以直接访问 Jenkins 的 Java API，从而实现对 Jenkins 的深度控制和定制。

## 为什么使用 Groovy 脚本？

- **灵活性**：Groovy 脚本允许您以编程方式控制 Jenkins，而不仅仅是通过 UI 或配置文件。
- **自动化**：通过脚本，您可以自动化重复性任务，减少人为错误。
- **扩展性**：Groovy 脚本可以与 Jenkins 插件和 API 无缝集成，扩展 Jenkins 的功能。

## 基础语法

Groovy 是一种动态语言，语法与 Java 类似，但更加简洁。以下是一个简单的 Groovy 脚本示例：

```groovy
def greeting = "Hello, Jenkins!"
println greeting
```

**输出：**
```
Hello, Jenkins!
```

## 在 Jenkins 中使用 Groovy 脚本

### 1. 在 Pipeline 中使用 Groovy 脚本

Jenkins Pipeline 是一种定义 CI/CD 流程的方式，通常使用 Groovy 脚本编写。以下是一个简单的 Pipeline 示例：

```groovy
pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                echo 'Building the project...'
            }
        }
        stage('Test') {
            steps {
                echo 'Running tests...'
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying the project...'
            }
        }
    }
}
```

**解释：**
- `pipeline`：定义了一个流水线。
- `agent any`：指定在任何可用的代理上运行。
- `stages`：定义了流水线的各个阶段。
- `steps`：每个阶段的具体步骤。

### 2. 在 Jenkins 控制台中使用 Groovy 脚本

Jenkins 提供了一个 **Script Console**，允许您直接运行 Groovy 脚本。这对于调试和快速测试非常有用。

**示例：列出所有 Jenkins 作业**

```groovy
Jenkins.instance.getAllItems(Job.class).each { job ->
    println job.fullName
}
```

**输出：**
```
job1
job2
job3
```

### 3. 自动化 Jenkins 配置

您可以使用 Groovy 脚本自动化 Jenkins 的全局配置。例如，以下脚本用于设置 Jenkins 的默认执行者数量：

```groovy
Jenkins.instance.setNumExecutors(4)
println "Number of executors set to 4"
```

## 实际案例

### 案例 1：批量创建 Jenkins 作业

假设您需要为多个项目创建 Jenkins 作业，可以使用以下脚本：

```groovy
def jobNames = ['project1', 'project2', 'project3']
jobNames.each { name ->
    def job = Jenkins.instance.createProject(FreeStyleProject, name)
    job.description = "Automatically created job for ${name}"
    job.save()
    println "Created job: ${name}"
}
```

**输出：**
```
Created job: project1
Created job: project2
Created job: project3
```

### 案例 2：批量更新 Jenkins 作业配置

以下脚本用于为所有作业添加一个构建步骤：

```groovy
Jenkins.instance.getAllItems(Job.class).each { job ->
    if (job instanceof FreeStyleProject) {
        job.buildersList.add(new Shell('echo "Running a custom build step"'))
        job.save()
        println "Updated job: ${job.fullName}"
    }
}
```

## 总结

Jenkins Groovy 脚本是一种强大的工具，可以帮助您自动化 Jenkins 的配置和管理任务。通过本文的学习，您已经掌握了 Groovy 脚本的基础语法、在 Jenkins 中的应用场景以及实际案例。希望这些内容能够帮助您更好地利用 Jenkins 的强大功能。

## 附加资源

- [Groovy 官方文档](https://groovy-lang.org/documentation.html)
- [Jenkins Pipeline 文档](https://www.jenkins.io/doc/book/pipeline/)
- [Jenkins Script Console 指南](https://www.jenkins.io/doc/book/managing/script-console/)

## 练习

1. 使用 Groovy 脚本创建一个 Jenkins Pipeline，包含构建、测试和部署阶段。
2. 编写一个脚本，列出所有 Jenkins 作业并打印它们的描述。
3. 尝试使用 Groovy 脚本安装一个 Jenkins 插件。

:::tip
如果您在编写脚本时遇到问题，可以随时在 Jenkins 的 Script Console 中进行测试和调试。
:::