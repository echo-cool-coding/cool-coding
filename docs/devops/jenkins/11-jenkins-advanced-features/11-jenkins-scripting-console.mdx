---
title: Jenkins 脚本控制台
description: 了解如何使用Jenkins脚本控制台执行Groovy脚本，管理Jenkins实例并自动化任务。
---

# Jenkins 脚本控制台

Jenkins脚本控制台是一个强大的工具，允许用户通过编写和执行Groovy脚本来与Jenkins实例进行交互。它特别适合用于调试、自动化任务和管理Jenkins的配置。对于初学者来说，掌握脚本控制台的使用可以极大地提高工作效率。

## 什么是Jenkins脚本控制台？

Jenkins脚本控制台是一个基于Web的界面，允许用户直接输入和执行Groovy脚本。Groovy是一种动态语言，与Java兼容，因此可以轻松地与Jenkins的Java API进行交互。通过脚本控制台，用户可以执行各种操作，例如：

- 查询和修改Jenkins的配置
- 管理作业和构建
- 自动化重复性任务
- 调试Jenkins实例

## 如何访问脚本控制台

要访问Jenkins脚本控制台，请按照以下步骤操作：

1. 登录到Jenkins实例。
2. 在左侧导航栏中，点击“Manage Jenkins”（管理Jenkins）。
3. 在管理页面中，找到并点击“Script Console”（脚本控制台）。

现在，您将看到一个文本输入框，可以在其中输入Groovy脚本。

## 基本用法

### 示例1：打印Jenkins版本

让我们从一个简单的示例开始，打印Jenkins的版本号。

```groovy
println(Jenkins.instance.version)
```

**输入：**

```groovy
println(Jenkins.instance.version)
```

**输出：**

```
2.346.3
```

### 示例2：列出所有作业

以下脚本将列出Jenkins实例中的所有作业。

```groovy
Jenkins.instance.getAllItems(Job.class).each { job ->
    println(job.fullName)
}
```

**输入：**

```groovy
Jenkins.instance.getAllItems(Job.class).each { job ->
    println(job.fullName)
}
```

**输出：**

```
my-job-1
my-job-2
my-job-3
```

## 实际应用场景

### 场景1：批量禁用所有作业

假设您需要暂时禁用所有作业以进行维护。以下脚本可以帮助您实现这一目标。

```groovy
Jenkins.instance.getAllItems(Job.class).each { job ->
    job.disabled = true
    job.save()
    println("Disabled: ${job.fullName}")
}
```

**输入：**

```groovy
Jenkins.instance.getAllItems(Job.class).each { job ->
    job.disabled = true
    job.save()
    println("Disabled: ${job.fullName}")
}
```

**输出：**

```
Disabled: my-job-1
Disabled: my-job-2
Disabled: my-job-3
```

### 场景2：清理旧构建

随着时间的推移，Jenkins可能会积累大量旧的构建记录。以下脚本可以帮助您删除超过30天的构建记录。

```groovy
import hudson.model.Job
import hudson.model.Run

Jenkins.instance.getAllItems(Job.class).each { job ->
    job.builds.each { build ->
        if (build.timestamp.time < System.currentTimeMillis() - 30 * 24 * 60 * 60 * 1000) {
            build.delete()
            println("Deleted build: ${build}")
        }
    }
}
```

**输入：**

```groovy
import hudson.model.Job
import hudson.model.Run

Jenkins.instance.getAllItems(Job.class).each { job ->
    job.builds.each { build ->
        if (build.timestamp.time < System.currentTimeMillis() - 30 * 24 * 60 * 60 * 1000) {
            build.delete()
            println("Deleted build: ${build}")
        }
    }
}
```

**输出：**

```
Deleted build: my-job-1 #123
Deleted build: my-job-2 #456
Deleted build: my-job-3 #789
```

## 总结

Jenkins脚本控制台是一个功能强大的工具，可以帮助您管理和自动化Jenkins实例。通过编写和执行Groovy脚本，您可以轻松地完成各种任务，从简单的查询到复杂的自动化操作。希望本文能帮助您更好地理解和使用Jenkins脚本控制台。

## 附加资源

- [Jenkins官方文档](https://www.jenkins.io/doc/)
- [Groovy编程语言](https://groovy-lang.org/)
- [Jenkins脚本控制台示例](https://wiki.jenkins.io/display/JENKINS/Jenkins+Script+Console)

## 练习

1. 编写一个脚本，列出所有失败的构建。
2. 编写一个脚本，将所有作业的描述设置为“这是一个示例作业”。
3. 编写一个脚本，删除所有已完成的构建。

通过完成这些练习，您将更深入地理解Jenkins脚本控制台的使用。