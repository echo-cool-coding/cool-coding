---
title: Jenkins 磁盘空间管理
description: 学习如何有效管理Jenkins服务器的磁盘空间，避免因磁盘空间不足导致的构建失败或系统崩溃。
---

# Jenkins 磁盘空间管理

Jenkins是一个广泛使用的持续集成和持续交付（CI/CD）工具，但随着构建任务的增加，Jenkins服务器可能会积累大量的构建日志、工件和其他数据，导致磁盘空间迅速耗尽。本文将详细介绍如何有效管理Jenkins的磁盘空间，确保系统的稳定运行。

## 1. 为什么需要管理磁盘空间？

Jenkins服务器在运行过程中会生成大量的数据，包括构建日志、工件、插件缓存等。如果不加以管理，这些数据会迅速占用磁盘空间，导致以下问题：

- **构建失败**：磁盘空间不足可能导致构建任务无法完成。
- **系统崩溃**：极端情况下，磁盘空间耗尽可能导致整个Jenkins服务器崩溃。
- **性能下降**：磁盘空间不足会影响服务器的读写性能，进而影响构建速度。

## 2. Jenkins磁盘空间管理策略

### 2.1 定期清理构建历史

Jenkins默认会保留所有构建的历史记录，这可能会占用大量磁盘空间。可以通过以下步骤定期清理构建历史：

1. **配置构建保留策略**：在Jenkins作业配置中，可以设置保留的构建数量。例如，只保留最近的10次构建。

   ```groovy
   properties([
       buildDiscarder(logRotator(numToKeepStr: '10'))
   ])
   ```

2. **手动删除旧构建**：在Jenkins的作业页面，可以手动删除旧的构建记录。

### 2.2 清理工作空间

每次构建都会在工作空间中生成临时文件，这些文件在构建完成后通常不再需要。可以通过以下方式清理工作空间：

1. **使用`Workspace Cleanup`插件**：安装并配置`Workspace Cleanup`插件，可以在构建完成后自动清理工作空间。

   ```groovy
   post {
       always {
           cleanWs()
       }
   }
   ```

2. **手动清理工作空间**：在Jenkins的作业页面，可以手动清理工作空间。

### 2.3 管理插件缓存

Jenkins插件可能会缓存大量数据，尤其是那些频繁使用的插件。可以通过以下方式管理插件缓存：

1. **定期清理插件缓存**：在Jenkins的系统管理页面，可以手动清理插件缓存。

2. **限制插件缓存大小**：某些插件允许配置缓存大小，可以通过插件配置页面进行设置。

### 2.4 使用外部存储

对于大型构建工件，可以考虑使用外部存储（如Amazon S3、NFS等）来存储构建工件，从而减轻Jenkins服务器的磁盘压力。

## 3. 实际案例

假设你有一个Jenkins作业，每天运行多次，每次生成约500MB的构建日志和工件。如果不进行磁盘空间管理，一个月后，该作业将占用约15GB的磁盘空间。

通过配置构建保留策略和自动清理工作空间，可以将磁盘空间占用减少到约5GB，显著延长磁盘空间的使用寿命。

## 4. 总结

有效的磁盘空间管理是确保Jenkins服务器稳定运行的关键。通过定期清理构建历史、工作空间和插件缓存，以及使用外部存储，可以显著减少磁盘空间的占用，避免因磁盘空间不足导致的构建失败或系统崩溃。

## 5. 附加资源与练习

- **练习**：在你的Jenkins服务器上配置构建保留策略，并观察磁盘空间的变化。
- **资源**：阅读Jenkins官方文档中的[磁盘空间管理指南](https://www.jenkins.io/doc/book/managing/disk-space/)。

:::tip
定期监控磁盘空间使用情况，并设置磁盘空间告警，以便在磁盘空间不足时及时采取措施。
:::