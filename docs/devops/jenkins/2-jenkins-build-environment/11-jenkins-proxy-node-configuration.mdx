---
title: Jenkins 代理节点配置
description: 学习如何配置Jenkins代理节点，以扩展构建能力并优化资源分配。本文适合初学者，包含详细步骤、代码示例和实际案例。
---

# Jenkins 代理节点配置

Jenkins是一个强大的自动化服务器，广泛用于持续集成和持续交付（CI/CD）。随着项目规模的扩大，单台Jenkins服务器可能无法满足所有构建需求。这时，**Jenkins代理节点**（也称为Jenkins从节点）就显得尤为重要。代理节点可以帮助分担主节点的负载，提高构建效率。

本文将详细介绍如何配置Jenkins代理节点，并通过实际案例展示其应用场景。

---

## 什么是Jenkins代理节点？

Jenkins代理节点是连接到Jenkins主节点的远程机器，用于执行构建任务。主节点负责调度任务，而代理节点负责实际执行任务。通过使用代理节点，可以将构建任务分发到多台机器上，从而加快构建速度并优化资源利用。

:::note
代理节点可以是物理机、虚拟机，甚至是容器（如Docker）。
:::

---

## 配置Jenkins代理节点的步骤

### 1. 准备代理节点机器
首先，确保代理节点机器满足以下条件：
- 安装了Java运行时环境（JRE）。
- 能够通过网络访问Jenkins主节点。
- 具有足够的资源（CPU、内存、磁盘空间）来执行构建任务。

### 2. 在Jenkins主节点上添加代理节点
1. 登录Jenkins主节点，进入**Manage Jenkins** > **Manage Nodes and Clouds**。
2. 点击**New Node**，输入节点名称并选择**Permanent Agent**。
3. 配置节点属性：
   - **Remote root directory**：代理节点的工作目录。
   - **Labels**：为节点添加标签，便于任务调度。
   - **Usage**：选择**Only build jobs with label expressions matching this node**，以确保任务仅在此节点上运行。
4. 点击**Save**。

### 3. 启动代理节点
1. 在节点配置页面，点击**Launch agent**按钮。
2. 选择启动方式（如通过Java Web Start或SSH）。
3. 按照提示在代理节点机器上执行命令，启动代理节点。

:::tip
如果使用SSH方式启动代理节点，请确保主节点和代理节点之间已配置SSH免密登录。
:::

---

## 代码示例：通过SSH启动代理节点

以下是通过SSH启动代理节点的命令示例：

```bash
ssh -i /path/to/private_key user@agent-node-ip 'java -jar agent.jar -jnlpUrl http://jenkins-master-url/computer/agent-name/slave-agent.jnlp -secret your-secret-key -workDir "/path/to/agent/workdir"'
```

- `-i /path/to/private_key`：指定SSH私钥路径。
- `user@agent-node-ip`：代理节点的用户名和IP地址。
- `-jnlpUrl`：Jenkins主节点提供的JNLP URL。
- `-secret`：代理节点的密钥。
- `-workDir`：代理节点的工作目录。

---

## 实际案例：分布式构建

假设你有一个大型项目，包含多个模块，每个模块都需要独立构建。为了提高构建效率，你可以配置多个代理节点，并将不同模块的构建任务分配到不同的节点上。

1. 在Jenkins中创建多个代理节点，并为每个节点添加标签（如`module1`、`module2`）。
2. 在Jenkins任务配置中，使用`Label Expression`将任务绑定到特定节点。例如：

```groovy
pipeline {
    agent {
        label 'module1'
    }
    stages {
        stage('Build') {
            steps {
                sh 'mvn clean install'
            }
        }
    }
}
```

3. 运行任务时，Jenkins会自动将任务分配到带有`module1`标签的代理节点上执行。

---

## 总结

通过配置Jenkins代理节点，你可以显著提高构建效率，并优化资源利用。本文介绍了代理节点的基本概念、配置步骤以及实际应用场景。希望这些内容能帮助你更好地理解和使用Jenkins代理节点。

---

## 附加资源与练习

- **练习**：尝试在你的Jenkins环境中配置一个代理节点，并运行一个简单的构建任务。
- **资源**：
  - [Jenkins官方文档 - 代理节点配置](https://www.jenkins.io/doc/book/managing/nodes/)
  - [Jenkins Pipeline语法指南](https://www.jenkins.io/doc/book/pipeline/syntax/)

:::caution
在配置代理节点时，请确保网络连接稳定，并定期检查代理节点的运行状态。
:::