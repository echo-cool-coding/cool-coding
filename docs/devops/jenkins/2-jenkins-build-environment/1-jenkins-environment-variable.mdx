---
title: Jenkins 环境变量
description: 了解Jenkins环境变量的基本概念、使用方法以及实际应用场景，帮助初学者掌握如何在Jenkins构建过程中使用环境变量。
---

# Jenkins 环境变量

Jenkins环境变量是Jenkins构建过程中非常重要的组成部分。它们允许你在构建脚本、插件和工具中动态地传递和使用信息。无论是访问系统信息、自定义构建参数，还是与其他工具集成，环境变量都能为你提供极大的灵活性。

本文将详细介绍Jenkins环境变量的基本概念、使用方法以及实际应用场景，帮助你更好地理解和运用它们。

## 什么是Jenkins环境变量？

Jenkins环境变量是Jenkins在构建过程中自动设置或由用户定义的变量。它们可以包含系统信息、构建参数、插件提供的值等。环境变量可以在构建脚本（如Shell脚本、Groovy脚本）中直接使用，帮助你动态地控制构建流程。

Jenkins环境变量分为两类：
1. **系统环境变量**：由Jenkins自动设置，包含系统信息（如`JENKINS_HOME`、`WORKSPACE`等）。
2. **自定义环境变量**：由用户通过Jenkinsfile、插件或构建参数定义。

## 如何查看Jenkins环境变量？

在Jenkins中，你可以通过以下方式查看当前可用的环境变量：

1. **通过Jenkins界面**：
   - 进入构建页面，点击左侧的“构建环境”或“构建日志”。
   - 在构建日志中，查找类似`[EnvInject] - Injecting environment variables`的日志条目。

2. **通过脚本**：
   - 在构建脚本中运行以下命令（以Shell脚本为例）：
     ```bash
     env
     ```
   - 这将列出所有可用的环境变量及其值。

## 常用的Jenkins环境变量

以下是一些常用的Jenkins环境变量：

| 变量名               | 描述                                                                 |
|----------------------|--------------------------------------------------------------------|
| `JENKINS_HOME`       | Jenkins的主目录路径。                                               |
| `WORKSPACE`          | 当前作业的工作目录路径。                                             |
| `BUILD_NUMBER`       | 当前构建的编号。                                                     |
| `JOB_NAME`           | 当前作业的名称。                                                     |
| `BUILD_URL`          | 当前构建的URL地址。                                                  |
| `NODE_NAME`          | 当前构建运行的节点名称（如`master`）。                                |
| `EXECUTOR_NUMBER`    | 当前构建的执行器编号。                                               |

:::tip
你可以通过`echo $VARIABLE_NAME`（Shell脚本）或`println env.VARIABLE_NAME`（Groovy脚本）来查看某个环境变量的值。
:::

## 如何在Jenkins中定义自定义环境变量？

除了系统环境变量，你还可以在Jenkinsfile或通过插件定义自定义环境变量。以下是几种常见的方式：

### 1. 在Jenkinsfile中使用`environment`块

在Jenkinsfile中，你可以使用`environment`块定义自定义环境变量。例如：

```groovy
pipeline {
    agent any
    environment {
        MY_CUSTOM_VAR = "Hello, Jenkins!"
    }
    stages {
        stage('Example') {
            steps {
                echo "My custom variable is: ${env.MY_CUSTOM_VAR}"
            }
        }
    }
}
```

运行此流水线时，`MY_CUSTOM_VAR`将被设置为`"Hello, Jenkins!"`，并在构建步骤中输出。

### 2. 使用`withEnv`动态设置环境变量

`withEnv`允许你在特定的步骤中临时设置环境变量。例如：

```groovy
pipeline {
    agent any
    stages {
        stage('Example') {
            steps {
                withEnv(['MY_TEMP_VAR=TempValue']) {
                    echo "My temporary variable is: ${env.MY_TEMP_VAR}"
                }
            }
        }
    }
}
```

在此示例中，`MY_TEMP_VAR`仅在`withEnv`块内有效。

### 3. 使用“EnvInject”插件

如果你需要更灵活的环境变量注入方式，可以安装“EnvInject”插件。该插件允许你通过配置文件或构建参数注入环境变量。

## 实际应用场景

### 场景1：动态设置构建参数

假设你需要根据当前构建的编号动态生成一个文件名。你可以使用`BUILD_NUMBER`环境变量来实现：

```groovy
pipeline {
    agent any
    stages {
        stage('Generate File') {
            steps {
                script {
                    def fileName = "build_${env.BUILD_NUMBER}.zip"
                    echo "Generated file name: ${fileName}"
                }
            }
        }
    }
}
```

### 场景2：跨平台构建

如果你需要在不同的操作系统上运行构建脚本，可以使用`NODE_NAME`环境变量来判断当前节点：

```groovy
pipeline {
    agent any
    stages {
        stage('Check OS') {
            steps {
                script {
                    if (env.NODE_NAME.contains('windows')) {
                        echo "Running on Windows"
                    } else {
                        echo "Running on Unix-like system"
                    }
                }
            }
        }
    }
}
```

### 场景3：集成外部工具

假设你需要将构建日志上传到一个外部存储服务，并使用`BUILD_URL`环境变量生成日志链接：

```groovy
pipeline {
    agent any
    stages {
        stage('Upload Logs') {
            steps {
                script {
                    def logUrl = "${env.BUILD_URL}console"
                    echo "Log URL: ${logUrl}"
                    // 调用外部工具上传日志
                }
            }
        }
    }
}
```

## 总结

Jenkins环境变量是构建过程中不可或缺的工具。它们不仅提供了对系统信息和构建参数的访问，还允许你动态地控制构建流程。通过本文的学习，你应该已经掌握了Jenkins环境变量的基本概念、使用方法以及实际应用场景。

:::note
**附加资源**：
- [Jenkins官方文档 - 环境变量](https://www.jenkins.io/doc/book/pipeline/jenkinsfile/#environment)
- [EnvInject插件文档](https://plugins.jenkins.io/envinject/)
:::

**练习**：
1. 在Jenkinsfile中定义一个自定义环境变量，并在构建步骤中输出它的值。
2. 使用`withEnv`块临时设置一个环境变量，并验证其作用范围。
3. 尝试使用`BUILD_NUMBER`和`JOB_NAME`环境变量生成一个唯一的构建标识符。

希望本文能帮助你更好地理解和使用Jenkins环境变量！如果你有任何问题，欢迎在评论区留言讨论。