---
title: Jenkins 与Jaeger集成
description: 了解如何将Jenkins与Jaeger集成，以实现分布式追踪和CI/CD管道的可观测性。
---

# Jenkins 与Jaeger集成

在现代云原生应用开发中，持续集成和持续交付（CI/CD）是至关重要的。Jenkins作为最流行的CI/CD工具之一，能够帮助开发团队自动化构建、测试和部署流程。然而，随着微服务架构的普及，分布式系统的复杂性也在增加。为了确保CI/CD管道的可观测性和故障排查能力，集成分布式追踪工具如Jaeger变得尤为重要。

本文将介绍如何将Jenkins与Jaeger集成，以实现对CI/CD管道的分布式追踪，帮助开发者更好地理解和优化构建流程。

## 什么是Jaeger？

Jaeger是一个开源的分布式追踪系统，最初由Uber开发并开源。它能够帮助开发者在复杂的微服务架构中追踪请求的路径，分析性能瓶颈，并诊断问题。Jaeger支持多种编程语言和框架，并且可以与多种监控工具集成。

## 为什么需要将Jenkins与Jaeger集成？

在CI/CD管道中，多个任务和步骤可能会在不同的环境中执行。例如，构建、测试和部署任务可能会在不同的服务器或容器中运行。当某个步骤失败或性能下降时，追踪问题的根源可能会变得非常困难。

通过将Jenkins与Jaeger集成，您可以：

- **追踪CI/CD管道的执行路径**：了解每个任务和步骤的执行时间和依赖关系。
- **诊断性能瓶颈**：识别哪些步骤耗时最长，优化构建流程。
- **提高可观测性**：通过可视化工具查看管道的执行情况，快速定位问题。

## 如何将Jenkins与Jaeger集成

### 1. 安装和配置Jaeger

首先，您需要在您的环境中安装和配置Jaeger。您可以选择使用Docker容器来快速启动Jaeger：

```bash
docker run -d --name jaeger \
  -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 \
  -p 5775:5775/udp \
  -p 6831:6831/udp \
  -p 6832:6832/udp \
  -p 5778:5778 \
  -p 16686:16686 \
  -p 14268:14268 \
  -p 9411:9411 \
  jaegertracing/all-in-one:1.30
```

启动后，您可以通过访问 `http://localhost:16686` 来打开Jaeger的Web UI。

### 2. 在Jenkins中配置Jaeger

接下来，您需要在Jenkins中配置Jaeger。Jenkins本身并不直接支持Jaeger，但您可以通过使用OpenTelemetry插件来实现集成。

#### 安装OpenTelemetry插件

1. 打开Jenkins的管理界面。
2. 导航到“插件管理”。
3. 搜索并安装“OpenTelemetry”插件。

#### 配置OpenTelemetry插件

1. 在Jenkins的管理界面中，导航到“系统配置”。
2. 找到“OpenTelemetry”部分。
3. 配置Jaeger的端点，例如 `http://localhost:14268/api/traces`。
4. 保存配置。

### 3. 在Jenkins Pipeline中使用OpenTelemetry

现在，您可以在Jenkins Pipeline中使用OpenTelemetry来发送追踪数据到Jaeger。以下是一个简单的Pipeline示例：

```groovy
pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo 'Building...'
                // 模拟构建步骤
                sleep 5
            }
        }
        stage('Test') {
            steps {
                echo 'Testing...'
                // 模拟测试步骤
                sleep 3
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying...'
                // 模拟部署步骤
                sleep 2
            }
        }
    }
}
```

当您运行这个Pipeline时，OpenTelemetry插件会自动将每个步骤的追踪信息发送到Jaeger。您可以在Jaeger的Web UI中查看这些追踪信息。

### 4. 查看追踪信息

打开Jaeger的Web UI（`http://localhost:16686`），您将看到Jenkins Pipeline的执行追踪信息。每个阶段（如Build、Test、Deploy）都会显示为一个独立的Span，您可以点击每个Span查看详细信息，包括执行时间和日志。

## 实际案例

假设您有一个复杂的微服务应用，每个服务都有自己的构建和测试流程。通过将Jenkins与Jaeger集成，您可以追踪整个CI/CD管道的执行情况，识别哪些服务的构建或测试步骤耗时最长，并优化这些步骤。

例如，您可能会发现某个服务的测试步骤比其他服务耗时更长。通过查看Jaeger中的追踪信息，您可以进一步分析该步骤的日志，找出性能瓶颈，并采取相应的优化措施。

## 总结

通过将Jenkins与Jaeger集成，您可以显著提高CI/CD管道的可观测性，帮助团队更好地理解和优化构建流程。本文介绍了如何安装和配置Jaeger，如何在Jenkins中配置OpenTelemetry插件，以及如何在Pipeline中使用OpenTelemetry发送追踪数据。

## 附加资源

- [Jaeger官方文档](https://www.jaegertracing.io/docs/)
- [OpenTelemetry官方文档](https://opentelemetry.io/docs/)
- [Jenkins官方文档](https://www.jenkins.io/doc/)

## 练习

1. 尝试在您的本地环境中安装Jaeger，并配置Jenkins与Jaeger集成。
2. 创建一个包含多个阶段的Jenkins Pipeline，并使用OpenTelemetry插件发送追踪数据到Jaeger。
3. 在Jaeger的Web UI中查看Pipeline的执行追踪信息，并分析每个阶段的执行时间。

通过完成这些练习，您将更好地理解Jenkins与Jaeger集成的实际应用场景，并能够将其应用到您的CI/CD流程中。