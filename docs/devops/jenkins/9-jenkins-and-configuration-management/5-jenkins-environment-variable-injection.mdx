---
title: Jenkins 环境变量注入
description: 了解如何在Jenkins中注入和使用环境变量，以优化构建和部署流程。
---

# Jenkins 环境变量注入

在持续集成和持续交付（CI/CD）流程中，环境变量是一个非常重要的概念。它们允许我们在不同的环境中动态配置应用程序的行为，而无需修改代码。Jenkins 作为一个流行的自动化服务器，提供了多种方式来注入和使用环境变量。本文将详细介绍如何在 Jenkins 中注入环境变量，并通过实际案例展示其应用。

## 什么是环境变量？

环境变量是操作系统或应用程序中存储的键值对，用于配置系统或应用程序的行为。在 Jenkins 中，环境变量可以用于存储诸如构建路径、版本号、API 密钥等信息。这些变量可以在构建过程中被访问和使用。

## Jenkins 中的环境变量

Jenkins 提供了多种方式来注入环境变量，包括：

1. **全局环境变量**：在整个 Jenkins 实例中可用的变量。
2. **节点环境变量**：在特定节点上可用的变量。
3. **作业环境变量**：在特定作业中可用的变量。
4. **构建环境变量**：在构建过程中动态生成的变量。

### 全局环境变量

全局环境变量可以在 Jenkins 的系统配置中设置。这些变量对所有作业和节点都可用。

1. 进入 Jenkins 管理界面。
2. 选择“系统配置”。
3. 在“全局属性”部分，勾选“环境变量”。
4. 添加所需的键值对。

例如，设置一个全局变量 `GLOBAL_VAR`：

```plaintext
GLOBAL_VAR=global_value
```

### 节点环境变量

节点环境变量可以在特定节点的配置中设置。这些变量仅在该节点上可用。

1. 进入 Jenkins 管理界面。
2. 选择“节点管理”。
3. 选择要配置的节点。
4. 在“节点属性”部分，勾选“环境变量”。
5. 添加所需的键值对。

例如，设置一个节点变量 `NODE_VAR`：

```plaintext
NODE_VAR=node_value
```

### 作业环境变量

作业环境变量可以在特定作业的配置中设置。这些变量仅在该作业中可用。

1. 进入 Jenkins 作业配置界面。
2. 在“构建环境”部分，勾选“注入环境变量”。
3. 添加所需的键值对。

例如，设置一个作业变量 `JOB_VAR`：

```plaintext
JOB_VAR=job_value
```

### 构建环境变量

构建环境变量是在构建过程中动态生成的变量。Jenkins 提供了许多内置的环境变量，例如 `BUILD_NUMBER`、`JOB_NAME` 等。

你可以在 Jenkins 的“构建环境”部分查看所有可用的环境变量。

## 实际案例

假设我们有一个简单的 Jenkins 作业，用于构建和部署一个应用程序。我们需要在构建过程中使用环境变量来配置应用程序的版本号和部署路径。

1. 在 Jenkins 作业配置中，设置以下环境变量：

```plaintext
APP_VERSION=1.0.0
DEPLOY_PATH=/var/www/myapp
```

2. 在构建脚本中使用这些变量：

```bash
echo "Building version $APP_VERSION"
echo "Deploying to $DEPLOY_PATH"
```

3. 运行作业后，输出将显示：

```plaintext
Building version 1.0.0
Deploying to /var/www/myapp
```

## 总结

环境变量是 Jenkins 中一个强大的工具，可以帮助我们动态配置构建和部署流程。通过全局、节点、作业和构建环境变量，我们可以灵活地管理不同环境中的配置。

:::tip
在实际使用中，建议将敏感信息（如 API 密钥）存储在 Jenkins 的凭据管理中，而不是直接作为环境变量。
:::

## 附加资源

- [Jenkins 官方文档](https://www.jenkins.io/doc/)
- [Jenkins 环境变量列表](https://wiki.jenkins.io/display/JENKINS/Building+a+software+project#Buildingasoftwareproject-JenkinsSetEnvironmentVariables)

## 练习

1. 在 Jenkins 中创建一个新的作业，并尝试设置和使用作业环境变量。
2. 修改作业的构建脚本，使用 `BUILD_NUMBER` 环境变量来动态生成版本号。
3. 尝试在 Jenkins 的全局配置中设置一个全局环境变量，并在作业中使用它。
