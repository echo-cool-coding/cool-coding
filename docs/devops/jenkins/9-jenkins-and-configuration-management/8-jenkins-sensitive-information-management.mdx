---
title: Jenkins 敏感信息管理
description: 了解如何在Jenkins中安全地管理敏感信息，例如API密钥、密码和证书。本文适合初学者，将逐步讲解Jenkins的凭据管理功能，并提供实际案例和代码示例。
---

# Jenkins 敏感信息管理

在现代软件开发中，敏感信息（如API密钥、密码、证书等）的管理至关重要。Jenkins作为一款流行的持续集成和持续交付（CI/CD）工具，提供了强大的凭据管理功能，帮助开发者安全地存储和使用这些敏感信息。本文将详细介绍如何在Jenkins中管理敏感信息，并通过实际案例展示其应用场景。

## 什么是Jenkins敏感信息管理？

Jenkins敏感信息管理是指通过Jenkins的凭据管理功能，安全地存储和使用敏感信息。这些信息可能包括：

- API密钥
- 用户名和密码
- SSH私钥
- 证书
- 其他机密数据

Jenkins的凭据管理功能允许你将敏感信息存储在Jenkins的凭据库中，并在构建过程中安全地使用这些信息，而无需将它们硬编码在脚本或配置文件中。

## Jenkins 凭据管理的基本概念

### 凭据类型

Jenkins支持多种类型的凭据，包括：

1. **用户名和密码**：用于存储用户名和密码的组合。
2. **SSH用户名和私钥**：用于存储SSH用户名和私钥的组合。
3. **Secret文本**：用于存储任意文本，如API密钥。
4. **证书**：用于存储证书文件。

### 凭据作用域

Jenkins凭据可以具有不同的作用域：

- **全局作用域**：凭据可以在整个Jenkins实例中使用。
- **系统作用域**：凭据只能在Jenkins系统配置中使用。
- **项目作用域**：凭据只能在特定的项目中使用。

### 凭据ID

每个凭据都有一个唯一的ID，用于在Jenkins中引用该凭据。凭据ID可以是自动生成的，也可以是手动指定的。

## 如何在Jenkins中管理敏感信息

### 1. 添加凭据

要添加凭据，请按照以下步骤操作：

1. 登录Jenkins并导航到“Manage Jenkins” > “Manage Credentials”。
2. 在“Stores scoped to Jenkins”下，点击“System” > “Global credentials (unrestricted)”。
3. 点击“Add Credentials”。
4. 选择凭据类型并填写相关信息。
5. 点击“OK”保存凭据。

### 2. 在Pipeline中使用凭据

在Jenkins Pipeline中，可以使用`withCredentials`步骤来安全地使用凭据。以下是一个使用用户名和密码凭据的示例：

```groovy
pipeline {
    agent any
    stages {
        stage('Example') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'my-credentials-id', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')]) {
                    sh '''
                        echo "Username is $USERNAME"
                        echo "Password is $PASSWORD"
                    '''
                }
            }
        }
    }
}
```

在这个示例中，`my-credentials-id`是凭据的ID，`USERNAME`和`PASSWORD`是环境变量，用于存储凭据中的用户名和密码。

### 3. 在Freestyle项目中使用凭据

在Freestyle项目中，可以通过“Build Environment”配置来使用凭据。以下是一个使用Secret文本凭据的示例：

1. 在项目配置中，勾选“Use secret text(s) or file(s)”。
2. 点击“Add”并选择“Secret text”。
3. 选择凭据ID并指定环境变量名称。
4. 在构建步骤中，可以通过环境变量访问凭据。

## 实际案例

### 案例1：使用API密钥访问外部服务

假设你有一个需要API密钥才能访问的外部服务。你可以将API密钥存储在Jenkins的凭据库中，并在Pipeline中使用它：

```groovy
pipeline {
    agent any
    stages {
        stage('Call External Service') {
            steps {
                withCredentials([string(credentialsId: 'api-key-id', variable: 'API_KEY')]) {
                    sh '''
                        curl -H "Authorization: Bearer $API_KEY" https://api.example.com/data
                    '''
                }
            }
        }
    }
}
```

在这个案例中，API密钥被安全地存储在Jenkins中，并在构建过程中通过环境变量`API_KEY`使用。

### 案例2：使用SSH私钥部署代码

假设你需要使用SSH私钥将代码部署到远程服务器。你可以将SSH私钥存储在Jenkins的凭据库中，并在Pipeline中使用它：

```groovy
pipeline {
    agent any
    stages {
        stage('Deploy Code') {
            steps {
                withCredentials([sshUserPrivateKey(credentialsId: 'ssh-key-id', keyFileVariable: 'SSH_KEY')]) {
                    sh '''
                        chmod 600 $SSH_KEY
                        scp -i $SSH_KEY -o StrictHostKeyChecking=no target/myapp.jar user@example.com:/opt/myapp/
                    '''
                }
            }
        }
    }
}
```

在这个案例中，SSH私钥被安全地存储在Jenkins中，并在构建过程中通过环境变量`SSH_KEY`使用。

## 总结

Jenkins的敏感信息管理功能为开发者提供了一种安全、便捷的方式来存储和使用敏感信息。通过使用凭据管理功能，你可以避免将敏感信息硬编码在脚本或配置文件中，从而提高代码的安全性和可维护性。

## 附加资源

- [Jenkins官方文档：凭据管理](https://www.jenkins.io/doc/book/using/using-credentials/)
- [Jenkins Pipeline语法参考](https://www.jenkins.io/doc/book/pipeline/syntax/)

## 练习

1. 在Jenkins中创建一个新的凭据，并在Pipeline中使用它。
2. 修改现有的Pipeline脚本，使用`withCredentials`步骤来安全地使用凭据。
3. 尝试在Freestyle项目中使用凭据，并验证其功能。

通过完成这些练习，你将更好地理解Jenkins的敏感信息管理功能，并能够在实际项目中应用这些知识。