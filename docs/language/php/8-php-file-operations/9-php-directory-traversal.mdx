---
title: PHP 目录遍历
description: 学习如何使用 PHP 遍历目录，掌握读取和处理目录中文件的基本方法。本文适合初学者，包含代码示例和实际应用场景。
---

## 介绍

在 PHP 中，目录遍历是指通过编程方式访问和读取目录中的文件和子目录。这在处理文件系统时非常有用，例如批量处理文件、生成文件列表或执行文件操作。PHP 提供了多种函数来实现目录遍历，本文将逐步介绍这些方法。

## 基本概念

### 什么是目录遍历？

目录遍历是指通过代码访问目录中的所有文件和子目录。PHP 提供了多种函数来实现这一功能，例如 `scandir()`、`opendir()` 和 `readdir()`。这些函数可以帮助你获取目录中的内容，并对它们进行操作。

### 为什么需要目录遍历？

目录遍历在许多实际场景中非常有用，例如：

- 批量处理文件（如重命名、移动或删除）。
- 生成文件列表或目录树。
- 检查目录中的文件类型或大小。
- 自动化文件管理任务。

## 使用 `scandir()` 遍历目录

`scandir()` 是 PHP 中最简单的目录遍历函数之一。它会返回一个包含指定目录中所有文件和子目录的数组。

### 示例代码

```php
<?php
$directory = 'path/to/your/directory';
$files = scandir($directory);

foreach ($files as $file) {
    if ($file !== '.' && $file !== '..') {
        echo $file . "<br />";
    }
}
?>
```

### 输入和输出

假设目录结构如下：

```
/path/to/your/directory
    ├── file1.txt
    ├── file2.txt
    └── subdir
```

输出将是：

```
file1.txt
file2.txt
subdir
```

:::note
`scandir()` 返回的数组中包含 `.` 和 `..`，分别表示当前目录和父目录。通常我们会过滤掉这些条目。
:::

## 使用 `opendir()` 和 `readdir()` 遍历目录

`opendir()` 和 `readdir()` 是另一种遍历目录的方法。`opendir()` 打开一个目录句柄，`readdir()` 从目录句柄中读取条目。

### 示例代码

```php
<?php
$directory = 'path/to/your/directory';
if ($handle = opendir($directory)) {
    while (false !== ($file = readdir($handle))) {
        if ($file !== '.' && $file !== '..') {
            echo $file . "<br />";
        }
    }
    closedir($handle);
}
?>
```

### 输入和输出

假设目录结构与之前相同，输出也将是：

```
file1.txt
file2.txt
subdir
```

:::tip
`readdir()` 在读取完所有条目后会返回 `false`，因此我们可以使用 `while` 循环来遍历所有文件。
:::

## 递归遍历目录

有时我们需要递归地遍历目录及其子目录。这可以通过递归函数来实现。

### 示例代码

```php
<?php
function listFiles($directory) {
    $files = scandir($directory);
    foreach ($files as $file) {
        if ($file !== '.' && $file !== '..') {
            $path = $directory . '/' . $file;
            if (is_dir($path)) {
                echo "Directory: $path<br />";
                listFiles($path); // 递归调用
            } else {
                echo "File: $path<br />";
            }
        }
    }
}

listFiles('path/to/your/directory');
?>
```

### 输入和输出

假设目录结构如下：

```
/path/to/your/directory
    ├── file1.txt
    ├── file2.txt
    └── subdir
        └── file3.txt
```

输出将是：

```
File: /path/to/your/directory/file1.txt
File: /path/to/your/directory/file2.txt
Directory: /path/to/your/directory/subdir
File: /path/to/your/directory/subdir/file3.txt
```

:::caution
递归遍历时要注意目录深度，避免无限递归或内存耗尽。
:::

## 实际应用场景

### 批量重命名文件

假设你需要将某个目录中的所有 `.txt` 文件重命名为 `.bak` 文件。

```php
<?php
$directory = 'path/to/your/directory';
$files = scandir($directory);

foreach ($files as $file) {
    if (pathinfo($file, PATHINFO_EXTENSION) === 'txt') {
        $newName = pathinfo($file, PATHINFO_FILENAME) . '.bak';
        rename($directory . '/' . $file, $directory . '/' . $newName);
    }
}
?>
```

### 生成文件列表

你可以生成一个包含目录中所有文件的 HTML 列表。

```php
<?php
$directory = 'path/to/your/directory';
$files = scandir($directory);

echo "<ul>";
foreach ($files as $file) {
    if ($file !== '.' && $file !== '..') {
        echo "<li>$file</li>";
    }
}
echo "</ul>";
?>
```

## 总结

PHP 提供了多种方法来遍历目录，包括 `scandir()`、`opendir()` 和 `readdir()`。你可以根据需求选择合适的方法，甚至可以通过递归遍历来处理嵌套目录。目录遍历在文件管理、批量处理和自动化任务中非常有用。

## 附加资源与练习

- **练习 1**：编写一个 PHP 脚本，统计某个目录中所有文件的总大小。
- **练习 2**：修改递归遍历的代码，使其只列出 `.jpg` 文件。
- **参考文档**：[PHP 官方文档 - 目录函数](https://www.php.net/manual/en/ref.dir.php)

通过本文的学习，你应该已经掌握了 PHP 目录遍历的基本方法。继续练习和探索，你将能够更熟练地处理文件系统中的各种任务。