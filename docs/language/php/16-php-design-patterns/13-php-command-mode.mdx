---
title: PHP 命令模式
description: 了解PHP命令模式的基本概念、实现方式及其在实际开发中的应用场景。本文适合初学者，包含代码示例和实际案例。
---

# PHP 命令模式

命令模式（Command Pattern）是一种行为设计模式，它将请求封装为对象，从而使你可以用不同的请求对客户进行参数化。这种模式的主要目的是将“请求”与“执行请求”的操作解耦，使得请求可以被存储、传递和调用。

## 命令模式的基本概念

命令模式的核心思想是将一个请求封装为一个对象，从而使你可以用不同的请求对客户进行参数化。命令模式通常包含以下几个角色：

1. **命令接口（Command Interface）**：定义了执行操作的接口。
2. **具体命令（Concrete Command）**：实现了命令接口，包含了实际的操作逻辑。
3. **接收者（Receiver）**：知道如何执行与请求相关的操作。
4. **调用者（Invoker）**：持有命令对象，并在某个时间点调用命令对象的执行方法。
5. **客户端（Client）**：创建命令对象并设置其接收者。

## 命令模式的实现

让我们通过一个简单的例子来理解命令模式的实现。假设我们有一个简单的文本编辑器，用户可以执行“复制”和“粘贴”操作。我们将使用命令模式来实现这些操作。

### 1. 定义命令接口

首先，我们定义一个命令接口 `Command`，它包含一个 `execute` 方法：

```php
interface Command {
    public function execute();
}
```

### 2. 创建具体命令

接下来，我们创建两个具体命令类 `CopyCommand` 和 `PasteCommand`，它们分别实现了 `Command` 接口：

```php
class CopyCommand implements Command {
    private $receiver;

    public function __construct(Receiver $receiver) {
        $this->receiver = $receiver;
    }

    public function execute() {
        $this->receiver->copy();
    }
}

class PasteCommand implements Command {
    private $receiver;

    public function __construct(Receiver $receiver) {
        $this->receiver = $receiver;
    }

    public function execute() {
        $this->receiver->paste();
    }
}
```

### 3. 创建接收者

接收者 `Receiver` 类包含了实际的操作逻辑：

```php
class Receiver {
    public function copy() {
        echo "Copying text...\n";
    }

    public function paste() {
        echo "Pasting text...\n";
    }
}
```

### 4. 创建调用者

调用者 `Invoker` 类持有一个命令对象，并在需要时调用其 `execute` 方法：

```php
class Invoker {
    private $command;

    public function setCommand(Command $command) {
        $this->command = $command;
    }

    public function executeCommand() {
        $this->command->execute();
    }
}
```

### 5. 客户端代码

最后，客户端代码创建命令对象并设置其接收者，然后通过调用者执行命令：

```php
$receiver = new Receiver();
$copyCommand = new CopyCommand($receiver);
$pasteCommand = new PasteCommand($receiver);

$invoker = new Invoker();

$invoker->setCommand($copyCommand);
$invoker->executeCommand(); // 输出: Copying text...

$invoker->setCommand($pasteCommand);
$invoker->executeCommand(); // 输出: Pasting text...
```

## 实际应用场景

命令模式在实际开发中有许多应用场景，例如：

1. **撤销/重做功能**：命令模式可以轻松实现撤销和重做功能。每个命令对象都可以存储其执行前的状态，并在需要时恢复。
2. **任务队列**：命令模式可以用于实现任务队列，将多个命令对象存储在队列中，并按顺序执行。
3. **GUI 操作**：在图形用户界面中，命令模式可以用于将用户操作（如点击按钮）封装为命令对象，从而实现操作的解耦。

## 总结

命令模式是一种强大的设计模式，它通过将请求封装为对象，使得请求可以被存储、传递和调用。这种模式的主要优点是将“请求”与“执行请求”的操作解耦，从而提高了代码的灵活性和可扩展性。

:::tip
在实际开发中，命令模式可以与其他设计模式（如组合模式、备忘录模式）结合使用，以实现更复杂的功能。
:::

## 附加资源与练习

- **练习**：尝试在现有的项目中实现命令模式，例如为一个简单的计算器应用添加撤销功能。
- **进一步阅读**：了解更多关于命令模式的高级应用，如宏命令（Macro Command）和命令队列（Command Queue）。

通过本文的学习，你应该对PHP命令模式有了初步的了解。希望你能在实际项目中灵活运用这一模式，提升代码的可维护性和扩展性。