---
title: PHP 命令行参数
description: 了解如何使用PHP命令行参数，掌握如何通过命令行传递参数并处理它们，提升PHP脚本的灵活性。
---

# PHP 命令行参数

PHP不仅可以在Web服务器上运行，还可以通过命令行（CLI）执行脚本。命令行参数是传递给PHP脚本的额外信息，它们可以帮助脚本动态地调整行为。本文将详细介绍如何在PHP中使用命令行参数，并通过示例展示其实际应用。

## 什么是命令行参数？

命令行参数是在执行PHP脚本时通过命令行传递的额外信息。这些参数可以是文件名、选项、标志或其他数据，脚本可以通过这些参数来决定其行为。

例如，以下命令中，`script.php` 是PHP脚本，`arg1` 和 `arg2` 是传递给脚本的命令行参数：

```bash
php script.php arg1 arg2
```

## 如何访问命令行参数？

PHP提供了两个全局变量来访问命令行参数：

1. `$argv`：一个包含所有命令行参数的数组。
2. `$argc`：命令行参数的数量。

### 示例：访问命令行参数

以下是一个简单的PHP脚本，它打印出所有传递的命令行参数：

```php
<?php
// script.php
echo "Number of arguments: $argc\n";
echo "Arguments:\n";
foreach ($argv as $index => $arg) {
    echo "$index: $arg\n";
}
?>
```

假设我们通过以下命令运行脚本：

```bash
php script.php arg1 arg2 arg3
```

输出将是：

```
Number of arguments: 4
Arguments:
0: script.php
1: arg1
2: arg2
3: arg3
```

:::note
注意：`$argv[0]` 通常是脚本的名称，而不是传递的参数。
:::

## 处理命令行参数

在实际应用中，我们通常需要解析命令行参数并根据参数执行不同的操作。PHP提供了多种方法来处理命令行参数，包括手动解析和使用库（如 `getopt`）。

### 使用 `getopt` 解析选项

`getopt` 是一个PHP内置函数，用于解析命令行选项。它支持短选项（如 `-h`）和长选项（如 `--help`）。

#### 示例：使用 `getopt` 解析选项

以下脚本演示了如何使用 `getopt` 解析命令行选项：

```php
<?php
// script.php
$options = getopt("f:h", ["file:", "help"]);

if (isset($options['h']) || isset($options['help'])) {
    echo "Usage: php script.php -f <file> --help\n";
    exit;
}

if (isset($options['f']) || isset($options['file'])) {
    $file = $options['f'] ?? $options['file'];
    echo "Processing file: $file\n";
} else {
    echo "No file specified.\n";
}
?>
```

假设我们通过以下命令运行脚本：

```bash
php script.php -f myfile.txt
```

输出将是：

```
Processing file: myfile.txt
```

如果运行：

```bash
php script.php --help
```

输出将是：

```
Usage: php script.php -f <file> --help
```

:::tip
`getopt` 支持复杂的选项解析，包括带值的选项和布尔标志。
:::

## 实际应用场景

命令行参数在实际开发中有广泛的应用，以下是一些常见的场景：

1. **批量处理文件**：通过命令行参数指定要处理的文件列表。
2. **配置脚本行为**：通过选项启用或禁用某些功能。
3. **自动化任务**：在定时任务或脚本中动态传递参数。

### 示例：批量处理文件

以下脚本演示了如何使用命令行参数批量处理文件：

```php
<?php
// batch_process.php
$options = getopt("d:", ["directory:"]);

if (isset($options['d']) || isset($options['directory'])) {
    $directory = $options['d'] ?? $options['directory'];
    $files = scandir($directory);
    foreach ($files as $file) {
        if ($file !== "." && $file !== "..") {
            echo "Processing file: $file\n";
            // 在这里添加文件处理逻辑
        }
    }
} else {
    echo "No directory specified.\n";
}
?>
```

假设我们通过以下命令运行脚本：

```bash
php batch_process.php -d /path/to/files
```

脚本将遍历指定目录中的所有文件并处理它们。

## 总结

命令行参数是PHP脚本灵活性的重要组成部分。通过使用 `$argv`、`$argc` 和 `getopt`，您可以轻松地解析和处理命令行参数，从而创建更强大和可配置的PHP脚本。

## 附加资源与练习

- **练习**：编写一个PHP脚本，接受一个目录路径和一个文件扩展名作为参数，并列出该目录中所有具有指定扩展名的文件。
- **进一步阅读**：查阅PHP官方文档中关于[命令行模式](https://www.php.net/manual/en/features.commandline.php)的更多信息。

通过掌握命令行参数的使用，您将能够编写更加灵活和强大的PHP脚本，适用于各种场景。