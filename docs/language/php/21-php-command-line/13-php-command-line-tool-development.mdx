---
title: PHP 命令行工具开发
description: 学习如何使用PHP开发命令行工具，掌握从基础到高级的概念，并通过实际案例理解其应用场景。
---

# PHP 命令行工具开发

PHP不仅是一种用于Web开发的脚本语言，还可以用于开发命令行工具。命令行工具可以帮助你自动化任务、处理数据、执行系统操作等。本文将带你从基础开始，逐步学习如何使用PHP开发命令行工具。

## 什么是PHP命令行工具？

PHP命令行工具是通过命令行界面（CLI）运行的PHP脚本。与Web应用程序不同，命令行工具不依赖于Web服务器，而是直接在终端中运行。这使得它们非常适合用于自动化任务、批处理操作和系统管理。

## 开始之前

在开始开发PHP命令行工具之前，确保你已经安装了PHP，并且可以通过命令行运行PHP脚本。你可以通过以下命令检查PHP是否已安装：

```bash
php -v
```

如果显示了PHP版本信息，说明PHP已正确安装。

## 创建一个简单的PHP命令行工具

让我们从一个简单的例子开始。我们将创建一个PHP脚本，它可以在命令行中输出“Hello, World!”。

1. 创建一个名为 `hello.php` 的文件，并添加以下代码：

```php
<?php
echo "Hello, World!\n";
```

2. 在终端中运行这个脚本：

```bash
php hello.php
```

输出将是：

```
Hello, World!
```

恭喜！你已经创建了第一个PHP命令行工具。

## 处理命令行参数

在实际应用中，命令行工具通常需要处理用户输入的参数。PHP提供了 `$argv` 和 `$argc` 两个全局变量来处理命令行参数。

- `$argv` 是一个包含所有命令行参数的数组。
- `$argc` 是命令行参数的数量。

让我们修改 `hello.php`，使其能够接受用户输入的名字并输出问候语。

```php
<?php
if ($argc < 2) {
    echo "Usage: php hello.php <name>\n";
    exit(1);
}

$name = $argv[1];
echo "Hello, $name!\n";
```

现在，你可以这样运行脚本：

```bash
php hello.php Alice
```

输出将是：

```
Hello, Alice!
```

如果未提供参数，脚本将显示用法信息并退出。

## 使用 `getopt` 处理复杂参数

对于更复杂的命令行工具，你可能需要处理选项和标志。PHP提供了 `getopt` 函数来解析命令行选项。

让我们创建一个脚本，它可以接受一个 `--greeting` 选项来定制问候语。

```php
<?php
$options = getopt("g:", ["greeting:"]);

$greeting = "Hello";
if (isset($options['g'])) {
    $greeting = $options['g'];
} elseif (isset($options['greeting'])) {
    $greeting = $options['greeting'];
}

if ($argc < 2) {
    echo "Usage: php hello.php <name> [--greeting=<greeting>]\n";
    exit(1);
}

$name = $argv[$argc - 1];
echo "$greeting, $name!\n";
```

现在，你可以这样运行脚本：

```bash
php hello.php --greeting=Hi Alice
```

输出将是：

```
Hi, Alice!
```

## 实际案例：文件批量重命名工具

让我们通过一个实际案例来展示PHP命令行工具的强大功能。我们将创建一个脚本，它可以批量重命名指定目录下的所有文件。

```php
<?php
if ($argc < 3) {
    echo "Usage: php rename.php <directory> <prefix>\n";
    exit(1);
}

$directory = $argv[1];
$prefix = $argv[2];

if (!is_dir($directory)) {
    echo "Error: $directory is not a valid directory.\n";
    exit(1);
}

$files = scandir($directory);
foreach ($files as $file) {
    if ($file !== '.' && $file !== '..') {
        $newName = $prefix . '_' . $file;
        rename("$directory/$file", "$directory/$newName");
        echo "Renamed $file to $newName\n";
    }
}
```

你可以这样运行脚本：

```bash
php rename.php /path/to/directory myprefix
```

这将把 `/path/to/directory` 目录下的所有文件重命名为 `myprefix_<original_name>`。

## 总结

通过本文，你已经学习了如何使用PHP开发命令行工具。我们从简单的“Hello, World!”脚本开始，逐步介绍了如何处理命令行参数、使用 `getopt` 解析选项，并通过一个实际案例展示了如何批量重命名文件。

PHP命令行工具开发是一个强大的技能，可以帮助你自动化任务、提高工作效率。希望你能继续探索更多高级功能，如与数据库交互、调用外部API等。

## 附加资源与练习

- **练习1**：创建一个PHP命令行工具，它可以统计指定目录下的文件数量，并按文件类型分类。
- **练习2**：扩展文件批量重命名工具，使其支持递归处理子目录。
- **资源**：[PHP官方文档 - 命令行使用](https://www.php.net/manual/en/features.commandline.php)

继续练习和探索，你将很快掌握PHP命令行工具开发的精髓！