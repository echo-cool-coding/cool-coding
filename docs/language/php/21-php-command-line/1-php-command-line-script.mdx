---
title: PHP 命令行脚本
description: 学习如何使用PHP编写和运行命令行脚本，掌握PHP在命令行环境中的基本用法和实际应用场景。
---

# PHP 命令行脚本

PHP不仅是一种强大的服务器端脚本语言，还可以用于编写命令行脚本。通过命令行脚本，你可以自动化任务、处理数据、执行系统操作等。本文将带你从零开始学习如何编写和运行PHP命令行脚本。

## 什么是PHP命令行脚本？

PHP命令行脚本是指在命令行环境中运行的PHP脚本。与在Web服务器上运行的PHP脚本不同，命令行脚本不依赖于HTTP请求，而是直接在终端或命令提示符中执行。这使得PHP命令行脚本非常适合用于自动化任务、批处理操作、系统管理等场景。

## 如何运行PHP命令行脚本

要运行PHP命令行脚本，你需要确保已经安装了PHP，并且可以通过命令行访问PHP解释器。你可以通过以下命令检查PHP是否已安装：

```bash
php -v
```

如果PHP已安装，你将看到PHP的版本信息。接下来，你可以创建一个简单的PHP脚本并运行它。

### 示例：Hello World

创建一个名为 `hello.php` 的文件，内容如下：

```php
<?php
echo "Hello, World!\n";
?>
```

保存文件后，在命令行中运行以下命令：

```bash
php hello.php
```

你将看到输出：

```
Hello, World!
```

## 命令行参数

PHP命令行脚本可以接受命令行参数。这些参数可以通过 `$argv` 数组访问，`$argc` 变量则存储了传递给脚本的参数数量。

### 示例：处理命令行参数

创建一个名为 `greet.php` 的文件，内容如下：

```php
<?php
if ($argc < 2) {
    echo "Usage: php greet.php <name>\n";
    exit(1);
}

$name = $argv[1];
echo "Hello, $name!\n";
?>
```

在命令行中运行以下命令：

```bash
php greet.php Alice
```

你将看到输出：

```
Hello, Alice!
```

如果未提供参数，脚本将显示用法信息：

```bash
php greet.php
```

输出：

```
Usage: php greet.php <name>
```

## 实际应用场景

PHP命令行脚本可以用于多种实际场景，例如：

1. **自动化任务**：定期备份数据库、清理日志文件等。
2. **数据处理**：批量处理CSV文件、生成报告等。
3. **系统管理**：监控服务器状态、执行系统命令等。

### 示例：批量处理CSV文件

假设你有一个包含用户信息的CSV文件 `users.csv`，你需要读取该文件并生成一个包含用户名的文本文件。

创建一个名为 `process_csv.php` 的文件，内容如下：

```php
<?php
if ($argc < 2) {
    echo "Usage: php process_csv.php <input_csv>\n";
    exit(1);
}

$inputFile = $argv[1];
$outputFile = 'usernames.txt';

if (!file_exists($inputFile)) {
    echo "Error: Input file not found.\n";
    exit(1);
}

$inputHandle = fopen($inputFile, 'r');
$outputHandle = fopen($outputFile, 'w');

while (($data = fgetcsv($inputHandle)) !== false) {
    $username = $data[0]; // 假设用户名在第一列
    fwrite($outputHandle, $username . "\n");
}

fclose($inputHandle);
fclose($outputHandle);

echo "Usernames have been written to $outputFile.\n";
?>
```

在命令行中运行以下命令：

```bash
php process_csv.php users.csv
```

如果 `users.csv` 文件存在且格式正确，脚本将生成一个 `usernames.txt` 文件，其中包含所有用户名。

## 总结

通过本文，你学习了如何编写和运行PHP命令行脚本，了解了如何处理命令行参数，并探索了PHP命令行脚本的实际应用场景。PHP命令行脚本是一个强大的工具，可以帮助你自动化任务、处理数据和执行系统操作。

## 附加资源

- [PHP官方文档：命令行使用](https://www.php.net/manual/en/features.commandline.php)
- [PHP命令行脚本最佳实践](https://www.sitepoint.com/php-command-line-interface-cli/)

## 练习

1. 编写一个PHP命令行脚本，接受一个数字参数并输出该数字的平方。
2. 编写一个PHP命令行脚本，读取一个文本文件并统计其中的行数。
3. 编写一个PHP命令行脚本，将当前目录下的所有文件名输出到一个文本文件中。

通过完成这些练习，你将进一步巩固对PHP命令行脚本的理解和应用能力。