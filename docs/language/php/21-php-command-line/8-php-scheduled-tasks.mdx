---
title: PHP 计划任务
description: 学习如何使用PHP命令行工具创建和管理计划任务，自动化重复性任务并提高开发效率。
---

# PHP 计划任务

在开发过程中，许多任务需要定期执行，例如数据备份、日志清理或发送定时邮件。手动执行这些任务不仅耗时，还容易出错。PHP计划任务（Cron Jobs）是一种自动化工具，可以帮助你在特定时间或间隔执行PHP脚本。本文将详细介绍如何使用PHP命令行工具创建和管理计划任务。

## 什么是计划任务？

计划任务（Cron Jobs）是一种基于时间的任务调度工具，通常用于Unix和Linux系统。它允许你在指定的时间或间隔自动执行脚本或命令。PHP计划任务通常用于执行PHP脚本，例如清理数据库、生成报告或发送通知。

## 如何创建PHP计划任务？

要创建PHP计划任务，你需要使用Cron表达式来定义任务的执行时间，并将PHP脚本与Cron任务关联。以下是创建PHP计划任务的步骤：

### 1. 编写PHP脚本

首先，编写一个PHP脚本，用于执行你希望自动化的任务。例如，以下脚本会生成一个包含当前日期和时间的日志文件：

```php
<?php
// log_generator.php
$logMessage = "Log generated at: " . date('Y-m-d H:i:s') . "\n";
file_put_contents('log.txt', $logMessage, FILE_APPEND);
echo "Log generated successfully!\n";
?>
```

将此脚本保存为 `log_generator.php`。

### 2. 使用Cron表达式定义计划任务

Cron表达式由五个字段组成，分别表示分钟、小时、日期、月份和星期几。以下是一些常见的Cron表达式示例：

- `* * * * *`：每分钟执行一次
- `0 * * * *`：每小时执行一次
- `0 0 * * *`：每天午夜执行一次
- `0 0 * * 1`：每周一午夜执行一次

### 3. 将PHP脚本与Cron任务关联

在Linux或Unix系统中，你可以使用 `crontab` 命令来管理计划任务。以下是添加PHP计划任务的步骤：

1. 打开终端并输入以下命令以编辑Cron任务列表：

   ```bash
   crontab -e
   ```

2. 在打开的编辑器中，添加一行Cron表达式和PHP脚本的路径。例如，以下任务每天午夜执行 `log_generator.php` 脚本：

   ```bash
   0 0 * * * /usr/bin/php /path/to/log_generator.php
   ```

   确保将 `/usr/bin/php` 替换为你的PHP解释器路径，并将 `/path/to/log_generator.php` 替换为脚本的实际路径。

3. 保存并退出编辑器。Cron任务将自动生效。

:::tip
你可以使用 `crontab -l` 命令查看当前用户的Cron任务列表。
:::

## 实际案例：自动备份数据库

假设你需要每天自动备份MySQL数据库。以下是如何使用PHP计划任务实现这一目标的示例：

1. 编写一个PHP脚本 `backup_database.php`，用于导出数据库：

   ```php
   <?php
   // backup_database.php
   $backupFile = 'backup_' . date('Y-m-d') . '.sql';
   $command = "mysqldump -u username -p'password' database_name > $backupFile";
   exec($command);
   echo "Database backup created: $backupFile\n";
   ?>
   ```

   将 `username`、`password` 和 `database_name` 替换为你的数据库凭据。

2. 添加Cron任务以每天凌晨2点执行备份脚本：

   ```bash
   0 2 * * * /usr/bin/php /path/to/backup_database.php
   ```

## 总结

PHP计划任务是一种强大的工具，可以帮助你自动化重复性任务，从而提高开发效率。通过编写PHP脚本并使用Cron表达式，你可以轻松创建和管理计划任务。无论是生成日志、备份数据库还是发送通知，PHP计划任务都能为你节省大量时间和精力。

## 附加资源

- [Cron表达式生成器](https://crontab.guru/)：帮助你生成和测试Cron表达式。
- [PHP官方文档](https://www.php.net/manual/en/)：了解更多关于PHP脚本编写的知识。
- [Linux Crontab指南](https://linux.die.net/man/5/crontab)：深入了解Cron任务的管理。

## 练习

1. 编写一个PHP脚本，用于清理超过30天的日志文件，并创建一个Cron任务以每周执行一次。
2. 尝试使用Cron表达式 `*/5 * * * *`，并解释其含义。
