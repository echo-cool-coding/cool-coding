---
title: PHP 类型声明系统
description: 了解PHP类型声明系统的基础知识，包括标量类型、返回类型声明以及严格类型模式的使用。本文将通过代码示例和实际案例帮助初学者掌握这一现代PHP特性。
---

## 介绍

PHP类型声明系统是PHP 7及以上版本引入的一项重要特性，它允许开发者在函数参数和返回值中明确指定数据类型。通过类型声明，PHP代码变得更加健壮、可读性更高，并且能够在运行时捕获潜在的类型错误。

在本文中，我们将逐步讲解PHP类型声明系统的核心概念，并通过代码示例和实际案例帮助你理解如何在实际开发中使用这一特性。

---

## 标量类型声明

PHP支持四种标量类型的声明：`int`、`float`、`string` 和 `bool`。这些类型声明可以用于函数参数和返回值。

### 示例：函数参数类型声明

```php
function addNumbers(int $a, int $b): int {
    return $a + $b;
}

echo addNumbers(5, 10); // 输出: 15
echo addNumbers(5, "10"); // 输出: 15（PHP会自动将字符串"10"转换为整数10）
```

:::note
在默认模式下，PHP会尝试将不符合类型声明的值转换为指定类型。例如，字符串 `"10"` 会被转换为整数 `10`。
:::

### 示例：返回值类型声明

```php
function divide(float $a, float $b): float {
    return $a / $b;
}

echo divide(10.0, 2.0); // 输出: 5.0
```

---

## 严格类型模式

PHP允许通过 `declare(strict_types=1)` 启用严格类型模式。在这种模式下，PHP不会自动转换类型，任何类型不匹配都会导致 `TypeError`。

### 示例：启用严格类型模式

```php
declare(strict_types=1);

function multiply(int $a, int $b): int {
    return $a * $b;
}

echo multiply(5, 10); // 输出: 50
echo multiply(5, "10"); // 报错: TypeError
```

:::caution
在严格类型模式下，传递不符合类型声明的值会导致致命错误。因此，确保在启用严格类型模式时，所有输入都符合预期类型。
:::

---

## 复合类型声明

除了标量类型，PHP还支持复合类型声明，例如 `array`、`callable` 和自定义类。

### 示例：数组类型声明

```php
function sumArray(array $numbers): int {
    return array_sum($numbers);
}

echo sumArray([1, 2, 3, 4]); // 输出: 10
```

### 示例：自定义类类型声明

```php
class User {
    public string $name;
    public int $age;
}

function greetUser(User $user): string {
    return "Hello, " . $user->name;
}

$user = new User();
$user->name = "Alice";
$user->age = 25;

echo greetUser($user); // 输出: Hello, Alice
```

---

## 实际应用场景

### 场景1：表单数据验证

在Web开发中，表单数据通常以字符串形式提交。通过类型声明，可以确保数据在进入业务逻辑之前被正确转换和验证。

```php
declare(strict_types=1);

function validateAge(string $age): int {
    $age = (int)$age;
    if ($age < 18) {
        throw new InvalidArgumentException("Age must be at least 18.");
    }
    return $age;
}

try {
    echo validateAge("20"); // 输出: 20
    echo validateAge("15"); // 报错: InvalidArgumentException
} catch (InvalidArgumentException $e) {
    echo $e->getMessage();
}
```

### 场景2：API响应格式化

在API开发中，类型声明可以确保返回的数据格式一致，避免意外错误。

```php
declare(strict_types=1);

function formatResponse(array $data): string {
    return json_encode($data);
}

$response = formatResponse(["status" => "success", "data" => [1, 2, 3]]);
echo $response; // 输出: {"status":"success","data":[1,2,3]}
```

---

## 总结

PHP类型声明系统是现代PHP开发中的重要工具，它通过明确指定数据类型，提高了代码的可靠性和可维护性。通过本文的学习，你应该已经掌握了以下内容：

- 标量类型声明（`int`、`float`、`string`、`bool`）
- 严格类型模式的使用
- 复合类型声明（`array`、`callable`、自定义类）
- 实际应用场景中的类型声明

---

## 附加资源与练习

### 练习1
编写一个函数 `calculateArea`，接受两个 `float` 类型的参数（长和宽），并返回一个 `float` 类型的面积值。确保启用严格类型模式。

### 练习2
创建一个 `Product` 类，包含 `name`（字符串）和 `price`（浮点数）属性。编写一个函数 `displayProduct`，接受一个 `Product` 对象并返回格式化后的产品信息。

### 附加资源
- [PHP官方文档：类型声明](https://www.php.net/manual/en/language.types.declarations.php)
- [PHP官方文档：严格类型模式](https://www.php.net/manual/en/language.types.declarations.php#language.types.declarations.strict)