---
title: PHP JWT令牌
description: 了解如何在PHP中使用JWT（JSON Web Token）进行身份验证和授权，适合初学者。
---

# PHP JWT令牌

在现代Web开发中，身份验证和授权是至关重要的部分。JWT（JSON Web Token）是一种流行的标准，用于在客户端和服务器之间安全地传输信息。本文将介绍如何在PHP中使用JWT进行身份验证和授权。

## 什么是JWT？

JWT是一种开放标准（RFC 7519），它定义了一种紧凑且自包含的方式，用于在各方之间作为JSON对象安全地传输信息。JWT通常用于身份验证和授权，因为它可以包含用户信息，并且可以通过签名进行验证。

JWT由三部分组成：
1. **Header**：包含令牌的类型和使用的签名算法。
2. **Payload**：包含声明（claims），通常是用户信息和其他数据。
3. **Signature**：用于验证令牌的完整性和真实性。

JWT的结构通常如下所示：
```
header.payload.signature
```

## 在PHP中使用JWT

要在PHP中使用JWT，我们可以使用`firebase/php-jwt`库。这是一个流行的PHP库，用于生成和验证JWT。

### 安装库

首先，使用Composer安装`firebase/php-jwt`库：

```bash
composer require firebase/php-jwt
```

### 生成JWT

以下是一个生成JWT的示例代码：

```php
<?php
require 'vendor/autoload.php';

use Firebase\JWT\JWT;
use Firebase\JWT\Key;

$key = 'your-secret-key';
$payload = [
    'iss' => 'your-issuer',
    'aud' => 'your-audience',
    'iat' => time(),
    'exp' => time() + 3600, // 1小时过期
    'user_id' => 123
];

$jwt = JWT::encode($payload, $key, 'HS256');
echo "Generated JWT: " . $jwt;
?>
```

在这个示例中，我们定义了一个包含用户信息的`payload`，并使用`HS256`算法生成了一个JWT。

### 验证JWT

以下是一个验证JWT的示例代码：

```php
<?php
require 'vendor/autoload.php';

use Firebase\JWT\JWT;
use Firebase\JWT\Key;

$key = 'your-secret-key';
$jwt = 'your-generated-jwt';

try {
    $decoded = JWT::decode($jwt, new Key($key, 'HS256'));
    print_r($decoded);
} catch (Exception $e) {
    echo 'JWT验证失败: ' . $e->getMessage();
}
?>
```

在这个示例中，我们使用相同的密钥和算法来验证JWT。如果JWT有效，我们将解码后的内容打印出来。

## 实际应用场景

JWT通常用于以下场景：
1. **用户身份验证**：用户登录后，服务器生成一个JWT并返回给客户端。客户端在后续请求中携带该JWT，服务器验证JWT以确认用户身份。
2. **API授权**：在微服务架构中，JWT可以用于在不同服务之间传递用户信息，确保只有授权的服务可以访问特定资源。

### 示例：用户登录和API访问

以下是一个简单的用户登录和API访问的示例：

```php
<?php
require 'vendor/autoload.php';

use Firebase\JWT\JWT;
use Firebase\JWT\Key;

$key = 'your-secret-key';

// 用户登录
function login($username, $password) {
    // 验证用户名和密码
    if ($username === 'admin' && $password === 'password') {
        $payload = [
            'iss' => 'your-issuer',
            'aud' => 'your-audience',
            'iat' => time(),
            'exp' => time() + 3600, // 1小时过期
            'user_id' => 123
        ];
        return JWT::encode($payload, $key, 'HS256');
    }
    return null;
}

// API访问
function accessAPI($jwt) {
    try {
        $decoded = JWT::decode($jwt, new Key($key, 'HS256'));
        return "欢迎用户 " . $decoded->user_id;
    } catch (Exception $e) {
        return 'JWT验证失败: ' . $e->getMessage();
    }
}

// 模拟用户登录
$jwt = login('admin', 'password');
if ($jwt) {
    echo "登录成功，JWT: " . $jwt . "<br />";
    echo accessAPI($jwt);
} else {
    echo "登录失败";
}
?>
```

在这个示例中，用户登录成功后生成一个JWT，并在访问API时使用该JWT进行验证。

## 总结

JWT是一种强大的工具，用于在Web应用程序中实现身份验证和授权。通过使用`firebase/php-jwt`库，我们可以轻松地在PHP中生成和验证JWT。希望本文能帮助你理解JWT的基本概念，并在你的PHP项目中应用它。

## 附加资源

- [JWT官方网站](https://jwt.io/)
- [firebase/php-jwt GitHub仓库](https://github.com/firebase/php-jwt)
- [RFC 7519: JSON Web Token (JWT)](https://tools.ietf.org/html/rfc7519)

## 练习

1. 修改示例代码，使JWT的过期时间为30分钟。
2. 尝试在JWT的`payload`中添加更多用户信息，并在验证时打印出来。
3. 创建一个简单的API，要求客户端在请求头中携带JWT，并在服务器端验证JWT。
