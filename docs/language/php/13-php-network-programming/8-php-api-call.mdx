---
title: PHP API 调用
description: 学习如何使用 PHP 调用 API，掌握从发送请求到处理响应的完整流程。本文适合初学者，包含代码示例和实际应用场景。
---

# PHP API 调用

在现代 Web 开发中，API（应用程序编程接口）是不可或缺的一部分。API 允许不同的应用程序之间进行数据交换和功能调用。PHP 作为一种广泛使用的服务器端脚本语言，提供了多种方式来调用 API。本文将详细介绍如何使用 PHP 调用 API，并通过实际案例帮助你理解这一过程。

## 什么是 API 调用？

API 调用是指通过 HTTP 请求与远程服务器进行通信，以获取或发送数据。常见的 API 调用方式包括 GET、POST、PUT 和 DELETE 请求。PHP 提供了多种工具和函数来发送这些请求，例如 `file_get_contents()`、`cURL` 等。

## 使用 `file_get_contents()` 调用 API

`file_get_contents()` 是 PHP 中一个简单且常用的函数，可以用来发送 GET 请求并获取 API 的响应。

### 示例：获取天气数据

假设我们有一个天气 API，可以通过城市名称获取当前天气信息。以下是一个简单的示例：

```php
<?php
$city = "Beijing";
$apiKey = "your_api_key_here";
$url = "https://api.weatherapi.com/v1/current.json?key={$apiKey}&q={$city}";

$response = file_get_contents($url);
$data = json_decode($response, true);

if ($data) {
    echo "当前温度: " . $data['current']['temp_c'] . "°C<br />";
    echo "天气状况: " . $data['current']['condition']['text'] . "<br />";
} else {
    echo "无法获取天气数据。<br />";
}
?>
```

### 输入与输出

- **输入**: 城市名称（如 "Beijing"）和 API 密钥。
- **输出**: 当前温度和天气状况。

:::note
`file_get_contents()` 适用于简单的 GET 请求，但对于更复杂的请求（如 POST 请求或需要设置请求头的情况），建议使用 `cURL`。
:::

## 使用 `cURL` 调用 API

`cURL` 是一个功能强大的库，支持多种协议和请求类型。它比 `file_get_contents()` 更灵活，适合处理复杂的 API 调用。

### 示例：发送 POST 请求

假设我们需要向一个 API 发送 JSON 数据并获取响应。以下是一个使用 `cURL` 的示例：

```php
<?php
$url = "https://api.example.com/submit";
$data = json_encode([
    'name' => 'John Doe',
    'email' => 'john.doe@example.com'
]);

$ch = curl_init($url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'Content-Type: application/json'
]);

$response = curl_exec($ch);
curl_close($ch);

$result = json_decode($response, true);
if ($result) {
    echo "提交成功: " . $result['message'] . "<br />";
} else {
    echo "提交失败。<br />";
}
?>
```

### 输入与输出

- **输入**: JSON 格式的用户数据。
- **输出**: API 返回的响应消息。

:::tip
`cURL` 提供了丰富的选项，可以设置请求头、超时时间、代理等。查阅 [PHP 官方文档](https://www.php.net/manual/en/book.curl.php) 以了解更多高级用法。
:::

## 实际应用场景

### 案例：集成支付网关

假设你正在开发一个电子商务网站，需要集成第三方支付网关。支付网关通常提供 API 来处理支付请求。以下是一个简化的示例：

```php
<?php
$paymentData = json_encode([
    'amount' => 100.00,
    'currency' => 'USD',
    'card_number' => '4111111111111111',
    'expiry_date' => '12/25',
    'cvv' => '123'
]);

$ch = curl_init("https://api.paymentgateway.com/process");
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, $paymentData);
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'Content-Type: application/json',
    'Authorization: Bearer your_access_token_here'
]);

$response = curl_exec($ch);
curl_close($ch);

$result = json_decode($response, true);
if ($result && $result['status'] === 'success') {
    echo "支付成功！<br />";
} else {
    echo "支付失败: " . $result['message'] . "<br />";
}
?>
```

### 输入与输出

- **输入**: 支付信息（金额、货币、卡号等）。
- **输出**: 支付结果（成功或失败）。

:::caution
在实际应用中，务必确保敏感信息（如卡号、CVV）通过 HTTPS 加密传输，并遵守相关安全规范。
:::

## 总结

通过本文，你学习了如何使用 PHP 调用 API，包括使用 `file_get_contents()` 和 `cURL` 发送 GET 和 POST 请求。我们还通过实际案例展示了 API 调用在 Web 开发中的应用场景。

## 附加资源与练习

- **练习**: 尝试使用 `cURL` 调用一个公开的 API（如 [OpenWeatherMap](https://openweathermap.org/api)），并处理返回的 JSON 数据。
- **资源**: 
  - [PHP 官方文档 - cURL](https://www.php.net/manual/en/book.curl.php)
  - [JSON 编码与解码](https://www.php.net/manual/en/ref.json.php)
  - [HTTP 请求方法](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods)

继续练习并探索更多 API 调用的可能性，你将能够构建更强大和灵活的 Web 应用程序！