---
title: PHP 自定义错误处理
description: 学习如何在PHP中自定义错误处理，掌握如何捕获和处理错误，提升代码的健壮性和可维护性。
---

在PHP开发中，错误处理是一个非常重要的环节。默认情况下，PHP会以标准方式处理错误，但在实际开发中，我们可能需要更灵活的方式来处理错误，例如记录日志、发送通知或自定义错误页面。PHP提供了自定义错误处理的功能，允许开发者定义自己的错误处理函数。

## 什么是自定义错误处理？

自定义错误处理是指开发者可以定义一个函数来处理PHP运行时发生的错误。通过这种方式，你可以完全控制错误的处理方式，而不是依赖PHP的默认行为。

## 如何设置自定义错误处理函数

PHP提供了 `set_error_handler()` 函数，允许你定义一个自定义的错误处理函数。这个函数会在PHP发生错误时被调用。

### 基本语法

```php
set_error_handler(callable $error_handler, int $error_types = E_ALL | E_STRICT): mixed
```

- `$error_handler`：自定义的错误处理函数。
- `$error_types`：指定要处理的错误类型，默认为所有错误类型。

### 示例代码

```php
<?php
// 自定义错误处理函数
function customErrorHandler($errno, $errstr, $errfile, $errline) {
    echo "<b>Error:</b> [$errno] $errstr<br />";
    echo "Error on line $errline in $errfile<br />";
    echo "Ending Script";
    die();
}

// 设置自定义错误处理函数
set_error_handler("customErrorHandler");

// 触发一个错误
echo $undefinedVariable;
?>
```

### 输出

```
Error: [8] Undefined variable: undefinedVariable
Error on line 13 in /path/to/your/script.php
Ending Script
```

在这个示例中，我们定义了一个 `customErrorHandler` 函数来处理错误。当尝试访问一个未定义的变量时，PHP会调用这个函数，并输出错误信息。

## 错误处理函数的参数

自定义错误处理函数可以接收以下参数：

- `$errno`：错误的级别，例如 `E_WARNING`、`E_NOTICE` 等。
- `$errstr`：错误的描述信息。
- `$errfile`：发生错误的文件名。
- `$errline`：发生错误的行号。

## 实际应用场景

### 记录错误日志

在实际开发中，记录错误日志是非常常见的需求。你可以通过自定义错误处理函数将错误信息写入日志文件。

```php
<?php
function customErrorHandler($errno, $errstr, $errfile, $errline) {
    $logMessage = "Error: [$errno] $errstr - $errfile:$errline";
    error_log($logMessage, 3, "error.log");
    echo "An error occurred. Please try again later.";
}

set_error_handler("customErrorHandler");

// 触发一个错误
echo $undefinedVariable;
?>
```

在这个示例中，错误信息会被记录到 `error.log` 文件中，而不是直接输出到浏览器。

### 发送错误通知

在某些情况下，你可能希望在发生错误时发送通知，例如通过邮件或短信。

```php
<?php
function customErrorHandler($errno, $errstr, $errfile, $errline) {
    $message = "Error: [$errno] $errstr - $errfile:$errline";
    mail("admin@example.com", "Error Occurred", $message);
    echo "An error occurred. The admin has been notified.";
}

set_error_handler("customErrorHandler");

// 触发一个错误
echo $undefinedVariable;
?>
```

在这个示例中，错误信息会被发送到管理员的邮箱。

## 总结

自定义错误处理是PHP中一个强大的功能，它允许开发者灵活地处理运行时错误。通过定义自己的错误处理函数，你可以记录日志、发送通知、自定义错误页面等，从而提升代码的健壮性和可维护性。

## 附加资源

- [PHP官方文档 - 错误处理](https://www.php.net/manual/en/book.errorfunc.php)
- [PHP错误处理最佳实践](https://www.php.net/manual/en/errorfunc.examples.php)

## 练习

1. 尝试编写一个自定义错误处理函数，将错误信息写入日志文件。
2. 修改错误处理函数，使其在发生错误时发送邮件通知。
3. 研究 `set_exception_handler()` 函数，并尝试自定义异常处理。

通过以上练习，你将更深入地理解PHP中的错误处理机制。