---
title: PHP 异常基础
description: 了解PHP中的异常处理机制，掌握如何抛出、捕获和处理异常，提升代码的健壮性和可维护性。
---

## 什么是异常？

在PHP中，**异常（Exception）** 是一种用于处理程序运行时错误的机制。当程序执行过程中遇到无法继续执行的错误时，可以通过抛出异常来中断当前的执行流程，并将控制权交给异常处理程序。异常处理机制使得开发者能够以结构化的方式处理错误，而不是让程序直接崩溃。

:::tip
异常与错误的区别：错误通常是语法错误或运行时错误，而异常是由开发者主动抛出的，用于处理预期的异常情况。
:::

## 异常的基本结构

PHP中的异常是通过 `Exception` 类及其子类来表示的。`Exception` 类是PHP内置的异常基类，提供了以下常用方法：

- `getMessage()`：获取异常消息。
- `getCode()`：获取异常代码。
- `getFile()`：获取抛出异常的文件名。
- `getLine()`：获取抛出异常的行号。
- `getTrace()`：获取异常的调用栈。
- `getTraceAsString()`：以字符串形式返回异常的调用栈。

### 抛出异常

使用 `throw` 关键字可以抛出一个异常。以下是一个简单的例子：

```php
<?php
function divide($numerator, $denominator) {
    if ($denominator == 0) {
        throw new Exception("Division by zero is not allowed.");
    }
    return $numerator / $denominator;
}

try {
    echo divide(10, 0);
} catch (Exception $e) {
    echo "Caught exception: " . $e->getMessage();
}
?>
```

**输出：**
```
Caught exception: Division by zero is not allowed.
```

在这个例子中，当除数为0时，`divide` 函数会抛出一个异常，并在 `catch` 块中被捕获和处理。

### 捕获异常

使用 `try...catch` 结构可以捕获并处理异常。`try` 块中包含可能抛出异常的代码，而 `catch` 块则用于捕获并处理异常。

```php
<?php
try {
    // 可能抛出异常的代码
    throw new Exception("An error occurred.");
} catch (Exception $e) {
    // 处理异常
    echo "Caught exception: " . $e->getMessage();
}
?>
```

**输出：**
```
Caught exception: An error occurred.
```

### 多个 `catch` 块

如果代码可能抛出多种类型的异常，可以使用多个 `catch` 块来分别处理不同类型的异常。

```php
<?php
class CustomException extends Exception {}

try {
    throw new CustomException("This is a custom exception.");
} catch (CustomException $e) {
    echo "Caught custom exception: " . $e->getMessage();
} catch (Exception $e) {
    echo "Caught generic exception: " . $e->getMessage();
}
?>
```

**输出：**
```
Caught custom exception: This is a custom exception.
```

## 实际应用场景

### 文件操作中的异常处理

在处理文件操作时，可能会遇到文件不存在、权限不足等问题。使用异常处理机制可以优雅地处理这些错误。

```php
<?php
function readFileContent($filePath) {
    if (!file_exists($filePath)) {
        throw new Exception("File does not exist.");
    }
    if (!is_readable($filePath)) {
        throw new Exception("File is not readable.");
    }
    return file_get_contents($filePath);
}

try {
    echo readFileContent("nonexistent.txt");
} catch (Exception $e) {
    echo "Error: " . $e->getMessage();
}
?>
```

**输出：**
```
Error: File does not exist.
```

### 数据库操作中的异常处理

在数据库操作中，可能会遇到连接失败、查询错误等问题。使用异常处理机制可以确保在出现问题时能够及时捕获并处理。

```php
<?php
try {
    $pdo = new PDO("mysql:host=localhost;dbname=test", "user", "password");
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    $stmt = $pdo->query("SELECT * FROM non_existent_table");
} catch (PDOException $e) {
    echo "Database error: " . $e->getMessage();
}
?>
```

**输出：**
```
Database error: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'test.non_existent_table' doesn't exist
```

## 总结

PHP中的异常处理机制为开发者提供了一种结构化的方式来处理程序运行时的错误。通过 `try...catch` 结构，开发者可以捕获并处理异常，从而提升代码的健壮性和可维护性。在实际开发中，异常处理广泛应用于文件操作、数据库操作等场景。

:::caution
注意：异常处理不应被滥用。只有在遇到无法继续执行的错误时，才应抛出异常。对于可以预期的错误，应使用条件语句进行处理。
:::

## 附加资源与练习

- **练习1**：编写一个函数，接受一个数组和一个索引作为参数，返回数组中指定索引的元素。如果索引超出范围，抛出异常并捕获处理。
- **练习2**：修改上面的数据库操作示例，使其在连接失败时抛出并捕获异常。

通过练习，你将更好地掌握PHP异常处理的基础知识，并能够在实际项目中灵活运用。