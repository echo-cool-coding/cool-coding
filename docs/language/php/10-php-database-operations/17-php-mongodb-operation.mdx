---
title: PHP MongoDB 操作
description: "学习如何使用 PHP 操作 MongoDB 数据库。本教程将带你从基础概念到实际应用，掌握 MongoDB 的增删改查操作。"
---

# PHP MongoDB 操作

MongoDB 是一个基于文档的 NoSQL 数据库，它以灵活的 JSON 格式存储数据。PHP 提供了 MongoDB 扩展，使得开发者可以轻松地与 MongoDB 进行交互。本文将带你了解如何使用 PHP 操作 MongoDB 数据库。

## 1. 安装 MongoDB 扩展

在开始之前，你需要确保 PHP 已经安装了 MongoDB 扩展。你可以通过以下命令来安装：

```bash
pecl install mongodb
```

安装完成后，在 `php.ini` 文件中添加以下行以启用扩展：

```ini
extension=mongodb.so
```

## 2. 连接到 MongoDB

首先，我们需要连接到 MongoDB 数据库。以下是一个简单的连接示例：

```php
<?php
$client = new MongoDB\Client("mongodb://localhost:27017");
$db = $client->testdb;
?>
```

在这个例子中，我们使用 `MongoDB\Client` 类连接到本地 MongoDB 服务器，并选择了一个名为 `testdb` 的数据库。

## 3. 插入文档

插入文档是 MongoDB 中最常见的操作之一。以下是一个插入文档的示例：

```php
<?php
$collection = $db->users;
$insertResult = $collection->insertOne([
    'name' => 'John Doe',
    'email' => 'john@example.com',
    'age' => 30
]);

echo "Inserted document ID: " . $insertResult->getInsertedId();
?>
```

在这个例子中，我们向 `users` 集合中插入了一个包含 `name`、`email` 和 `age` 字段的文档。插入成功后，`insertOne` 方法会返回一个 `MongoDB\InsertOneResult` 对象，我们可以通过 `getInsertedId` 方法获取插入文档的 ID。

## 4. 查询文档

查询文档是 MongoDB 中的另一个常见操作。以下是一个查询文档的示例：

```php
<?php
$collection = $db->users;
$user = $collection->findOne(['name' => 'John Doe']);

echo "User email: " . $user['email'];
?>
```

在这个例子中，我们使用 `findOne` 方法查询 `users` 集合中 `name` 为 `John Doe` 的文档。如果找到匹配的文档，`findOne` 方法会返回一个关联数组。

## 5. 更新文档

更新文档是 MongoDB 中的另一个重要操作。以下是一个更新文档的示例：

```php
<?php
$collection = $db->users;
$updateResult = $collection->updateOne(
    ['name' => 'John Doe'],
    ['$set' => ['age' => 31]]
);

echo "Matched " . $updateResult->getMatchedCount() . " document(s)";
echo "Modified " . $updateResult->getModifiedCount() . " document(s)";
?>
```

在这个例子中，我们使用 `updateOne` 方法更新 `users` 集合中 `name` 为 `John Doe` 的文档，将其 `age` 字段更新为 `31`。`updateOne` 方法会返回一个 `MongoDB\UpdateResult` 对象，我们可以通过 `getMatchedCount` 和 `getModifiedCount` 方法获取匹配和修改的文档数量。

## 6. 删除文档

删除文档是 MongoDB 中的另一个常见操作。以下是一个删除文档的示例：

```php
<?php
$collection = $db->users;
$deleteResult = $collection->deleteOne(['name' => 'John Doe']);

echo "Deleted " . $deleteResult->getDeletedCount() . " document(s)";
?>
```

在这个例子中，我们使用 `deleteOne` 方法删除 `users` 集合中 `name` 为 `John Doe` 的文档。`deleteOne` 方法会返回一个 `MongoDB\DeleteResult` 对象，我们可以通过 `getDeletedCount` 方法获取删除的文档数量。

## 7. 实际应用场景

假设你正在开发一个博客系统，你需要存储用户的评论。以下是一个使用 MongoDB 存储评论的示例：

```php
<?php
$collection = $db->comments;
$insertResult = $collection->insertOne([
    'post_id' => 123,
    'user_id' => 456,
    'comment' => 'This is a great post!',
    'timestamp' => new MongoDB\BSON\UTCDateTime()
]);

echo "Inserted comment ID: " . $insertResult->getInsertedId();
?>
```

在这个例子中，我们向 `comments` 集合中插入了一条评论，包含 `post_id`、`user_id`、`comment` 和 `timestamp` 字段。`timestamp` 字段使用了 MongoDB 的 `UTCDateTime` 类型来存储当前时间。

## 8. 总结

通过本文，你已经学习了如何使用 PHP 操作 MongoDB 数据库。我们介绍了如何连接到 MongoDB、插入文档、查询文档、更新文档和删除文档。这些操作是 MongoDB 中最基本的操作，掌握它们将为你进一步学习 MongoDB 打下坚实的基础。

## 9. 附加资源

- [MongoDB 官方文档](https://docs.mongodb.com/)
- [PHP MongoDB 扩展文档](https://www.php.net/manual/en/book.mongodb.php)
- [MongoDB University](https://university.mongodb.com/)

## 10. 练习

1. 创建一个名为 `products` 的集合，并插入一些产品文档。
2. 查询 `products` 集合中价格大于 100 的产品。
3. 更新 `products` 集合中某个产品的库存数量。
4. 删除 `products` 集合中某个产品。

通过完成这些练习，你将进一步巩固所学的知识。