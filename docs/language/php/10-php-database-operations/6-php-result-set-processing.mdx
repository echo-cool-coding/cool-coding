---
title: PHP 结果集处理
description: 学习如何在PHP中处理数据库查询的结果集，包括获取数据、遍历结果集以及处理常见问题。
---

# PHP 结果集处理

在PHP中，与数据库交互时，执行查询后会返回一个结果集（Result Set）。结果集是数据库查询返回的数据集合，通常以行的形式呈现。处理结果集是PHP数据库操作中的关键步骤之一。本文将详细介绍如何获取、遍历和处理结果集，并通过实际案例帮助你更好地理解这一概念。

## 什么是结果集？

结果集是数据库查询返回的数据集合。当你执行一个SQL查询（如`SELECT`语句）时，数据库会返回一组符合条件的数据行。这些数据行可以通过PHP的数据库扩展（如`mysqli`或`PDO`）进行处理。

### 结果集的基本结构

结果集通常是一个二维数组，其中每一行代表数据库中的一条记录，每一列代表记录中的一个字段。例如，如果你查询了一个用户表，结果集可能如下所示：

```php
[
    ["id" => 1, "name" => "Alice", "email" => "alice@example.com"],
    ["id" => 2, "name" => "Bob", "email" => "bob@example.com"],
    ["id" => 3, "name" => "Charlie", "email" => "charlie@example.com"]
]
```

## 获取结果集

在PHP中，获取结果集的方式取决于你使用的数据库扩展。以下是两种常见的方式：

### 使用 `mysqli` 获取结果集

```php
<?php
$mysqli = new mysqli("localhost", "username", "password", "database");

// 检查连接
if ($mysqli->connect_error) {
    die("连接失败: " . $mysqli->connect_error);
}

// 执行查询
$result = $mysqli->query("SELECT id, name, email FROM users");

// 检查查询是否成功
if ($result) {
    // 处理结果集
    while ($row = $result->fetch_assoc()) {
        echo "ID: " . $row["id"] . " - Name: " . $row["name"] . " - Email: " . $row["email"] . "<br />";
    }
} else {
    echo "查询失败: " . $mysqli->error;
}

// 关闭连接
$mysqli->close();
?>
```

### 使用 `PDO` 获取结果集

```php
<?php
try {
    $pdo = new PDO("mysql:host=localhost;dbname=database", "username", "password");
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // 执行查询
    $stmt = $pdo->query("SELECT id, name, email FROM users");

    // 处理结果集
    while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
        echo "ID: " . $row["id"] . " - Name: " . $row["name"] . " - Email: " . $row["email"] . "<br />";
    }
} catch (PDOException $e) {
    echo "查询失败: " . $e->getMessage();
}

// 关闭连接
$pdo = null;
?>
```

## 遍历结果集

遍历结果集是处理数据库查询结果的核心操作。你可以使用循环结构（如`while`循环）逐行获取数据，并对每一行进行处理。

### 使用 `mysqli` 遍历结果集

```php
while ($row = $result->fetch_assoc()) {
    echo "ID: " . $row["id"] . " - Name: " . $row["name"] . " - Email: " . $row["email"] . "<br />";
}
```

### 使用 `PDO` 遍历结果集

```php
while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
    echo "ID: " . $row["id"] . " - Name: " . $row["name"] . " - Email: " . $row["email"] . "<br />";
}
```

## 处理结果集的常见问题

在处理结果集时，可能会遇到一些常见问题，例如空结果集、数据类型转换等。以下是一些常见问题及其解决方法：

### 1. 空结果集

如果查询没有返回任何数据，结果集将为空。你可以通过检查结果集的行数来判断是否为空。

```php
if ($result->num_rows > 0) {
    // 处理结果集
} else {
    echo "没有找到任何记录。";
}
```

### 2. 数据类型转换

数据库中的数据类型可能与PHP中的数据类型不完全一致。例如，数据库中的整数在PHP中可能以字符串形式返回。你可以使用类型转换来确保数据类型一致。

```php
$id = (int)$row["id"];
```

## 实际案例：用户列表展示

假设你正在开发一个用户管理系统，需要从数据库中获取用户列表并展示在网页上。以下是一个完整的示例：

```php
<?php
$mysqli = new mysqli("localhost", "username", "password", "database");

if ($mysqli->connect_error) {
    die("连接失败: " . $mysqli->connect_error);
}

$result = $mysqli->query("SELECT id, name, email FROM users");

if ($result->num_rows > 0) {
    echo "<table border='1'>";
    echo "<tr><th>ID</th><th>Name</th><th>Email</th></tr>";
    while ($row = $result->fetch_assoc()) {
        echo "<tr>";
        echo "<td>" . $row["id"] . "</td>";
        echo "<td>" . $row["name"] . "</td>";
        echo "<td>" . $row["email"] . "</td>";
        echo "</tr>";
    }
    echo "</table>";
} else {
    echo "没有找到任何用户。";
}

$mysqli->close();
?>
```

## 总结

处理结果集是PHP数据库操作中的重要环节。通过本文，你学习了如何获取、遍历和处理结果集，并了解了如何处理常见问题。掌握这些技能将帮助你在实际开发中更高效地与数据库交互。

## 附加资源与练习

- **练习**：尝试修改上述用户列表展示的代码，添加分页功能，每页显示10条记录。
- **资源**：阅读PHP官方文档中关于[`mysqli`](https://www.php.net/manual/en/book.mysqli.php)和[`PDO`](https://www.php.net/manual/en/book.pdo.php)的部分，深入了解这两种扩展的更多功能。

:::tip
在实际开发中，建议使用预处理语句（Prepared Statements）来防止SQL注入攻击，并提高代码的安全性。
:::