---
title: PHP 数据库查询
description: 学习如何在PHP中执行数据库查询操作，包括基本查询、条件查询、排序和分页等。本文适合初学者，提供代码示例和实际案例。
---

# PHP 数据库查询

在Web开发中，数据库操作是不可或缺的一部分。PHP作为一种广泛使用的服务器端脚本语言，提供了多种方式来与数据库进行交互。本文将详细介绍如何在PHP中执行数据库查询操作，包括基本查询、条件查询、排序和分页等。

## 1. 基本查询

### 1.1 连接数据库

在执行任何数据库操作之前，首先需要连接到数据库。PHP提供了多种扩展来连接数据库，如`mysqli`和`PDO`。以下是一个使用`mysqli`扩展连接MySQL数据库的示例：

```php
<?php
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "myDB";

// 创建连接
$conn = new mysqli($servername, $username, $password, $dbname);

// 检查连接
if ($conn->connect_error) {
    die("连接失败: " . $conn->connect_error);
}
echo "连接成功";
?>
```

### 1.2 执行简单查询

连接数据库后，可以使用`mysqli_query()`函数执行SQL查询。以下是一个简单的查询示例，从`users`表中获取所有用户：

```php
<?php
$sql = "SELECT id, firstname, lastname FROM users";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    // 输出每行数据
    while($row = $result->fetch_assoc()) {
        echo "id: " . $row["id"]. " - Name: " . $row["firstname"]. " " . $row["lastname"]. "<br />";
    }
} else {
    echo "0 结果";
}
$conn->close();
?>
```

:::note
`fetch_assoc()`函数将结果集中的每一行作为关联数组返回。
:::

## 2. 条件查询

在实际应用中，我们通常需要根据特定条件来查询数据。可以使用`WHERE`子句来实现条件查询。

### 2.1 使用WHERE子句

以下示例展示了如何查询`users`表中`lastname`为`Doe`的用户：

```php
<?php
$sql = "SELECT id, firstname, lastname FROM users WHERE lastname='Doe'";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    while($row = $result->fetch_assoc()) {
        echo "id: " . $row["id"]. " - Name: " . $row["firstname"]. " " . $row["lastname"]. "<br />";
    }
} else {
    echo "0 结果";
}
$conn->close();
?>
```

### 2.2 使用预处理语句

为了防止SQL注入攻击，建议使用预处理语句。以下是一个使用`mysqli`预处理语句的示例：

```php
<?php
$stmt = $conn->prepare("SELECT id, firstname, lastname FROM users WHERE lastname=?");
$stmt->bind_param("s", $lastname);

$lastname = "Doe";
$stmt->execute();

$result = $stmt->get_result();
while ($row = $result->fetch_assoc()) {
    echo "id: " . $row["id"]. " - Name: " . $row["firstname"]. " " . $row["lastname"]. "<br />";
}

$stmt->close();
$conn->close();
?>
```

:::tip
预处理语句不仅可以防止SQL注入，还可以提高查询性能。
:::

## 3. 排序和分页

### 3.1 排序查询结果

可以使用`ORDER BY`子句对查询结果进行排序。以下示例按`lastname`升序排列：

```php
<?php
$sql = "SELECT id, firstname, lastname FROM users ORDER BY lastname ASC";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    while($row = $result->fetch_assoc()) {
        echo "id: " . $row["id"]. " - Name: " . $row["firstname"]. " " . $row["lastname"]. "<br />";
    }
} else {
    echo "0 结果";
}
$conn->close();
?>
```

### 3.2 分页查询

在处理大量数据时，分页是必不可少的。可以使用`LIMIT`和`OFFSET`子句来实现分页。以下示例展示了如何获取第2页的数据，每页显示5条记录：

```php
<?php
$page = 2;
$limit = 5;
$offset = ($page - 1) * $limit;

$sql = "SELECT id, firstname, lastname FROM users LIMIT $limit OFFSET $offset";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    while($row = $result->fetch_assoc()) {
        echo "id: " . $row["id"]. " - Name: " . $row["firstname"]. " " . $row["lastname"]. "<br />";
    }
} else {
    echo "0 结果";
}
$conn->close();
?>
```

## 4. 实际案例

假设我们正在开发一个博客系统，需要从数据库中获取所有已发布的文章，并按发布日期降序排列。以下是一个实际案例：

```php
<?php
$sql = "SELECT id, title, content, published_at FROM posts WHERE status='published' ORDER BY published_at DESC";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    while($row = $result->fetch_assoc()) {
        echo "<h2>" . $row["title"]. "</h2>";
        echo "<p>" . $row["content"]. "</p>";
        echo "<small>发布时间: " . $row["published_at"]. "</small><br />";
    }
} else {
    echo "没有已发布的文章";
}
$conn->close();
?>
```

## 5. 总结

本文介绍了如何在PHP中执行数据库查询操作，包括基本查询、条件查询、排序和分页等。通过实际案例，我们展示了这些概念在真实应用场景中的使用。希望本文能帮助你更好地理解和掌握PHP数据库查询。

## 6. 附加资源

- [PHP官方文档](https://www.php.net/manual/en/)
- [MySQL官方文档](https://dev.mysql.com/doc/)
- [PHP MySQLi扩展](https://www.php.net/manual/en/book.mysqli.php)

## 7. 练习

1. 编写一个PHP脚本，从`products`表中查询所有价格大于100的产品，并按价格升序排列。
2. 修改上述脚本，使用预处理语句来防止SQL注入。
3. 实现一个分页功能，每页显示10条记录，并允许用户通过URL参数指定页码。

通过完成这些练习，你将进一步巩固所学的知识。