---
title: PHP Docker部署
description: 学习如何使用 Docker 部署 PHP 应用程序，从基础概念到实际应用场景的全面指南。
---

# PHP Docker部署

在现代软件开发中，Docker 已经成为一种流行的容器化技术，它可以帮助开发者快速构建、部署和运行应用程序。对于 PHP 开发者来说，使用 Docker 可以简化环境配置、提高开发效率，并确保应用程序在不同环境中的一致性。本文将带你从零开始学习如何使用 Docker 部署 PHP 应用程序。

## 什么是 Docker？

Docker 是一个开源的容器化平台，允许开发者将应用程序及其依赖项打包到一个轻量级的容器中。容器可以在任何支持 Docker 的环境中运行，确保应用程序在不同环境中的一致性。与虚拟机相比，Docker 容器更加轻量级，启动速度更快，资源占用更少。

## 为什么使用 Docker 部署 PHP？

使用 Docker 部署 PHP 应用程序有以下几个优点：

1. **环境一致性**：Docker 容器可以在任何支持 Docker 的环境中运行，确保开发、测试和生产环境的一致性。
2. **简化配置**：通过 Dockerfile 和 Docker Compose 文件，可以轻松定义和配置 PHP 应用程序的运行环境。
3. **快速部署**：Docker 容器可以快速启动和停止，大大缩短了部署时间。
4. **资源隔离**：每个容器都是独立的，避免了不同应用程序之间的依赖冲突。

## 准备工作

在开始之前，你需要确保已经安装了 Docker 和 Docker Compose。如果你还没有安装，可以参考 [Docker 官方文档](https://docs.docker.com/get-docker/) 进行安装。

## 创建 PHP Docker 容器

### 1. 创建 Dockerfile

Dockerfile 是一个文本文件，包含了一系列指令，用于定义如何构建 Docker 镜像。以下是一个简单的 PHP Dockerfile 示例：

```dockerfile
# 使用官方的 PHP 镜像作为基础镜像
FROM php:8.1-apache

# 将当前目录下的所有文件复制到容器的 /var/www/html 目录中
COPY . /var/www/html

# 暴露 80 端口
EXPOSE 80

# 启动 Apache 服务
CMD ["apache2-foreground"]
```

### 2. 构建 Docker 镜像

在 Dockerfile 所在的目录中，运行以下命令来构建 Docker 镜像：

```bash
docker build -t my-php-app .
```

### 3. 运行 Docker 容器

构建完成后，你可以使用以下命令来运行 Docker 容器：

```bash
docker run -d -p 8080:80 my-php-app
```

这将会启动一个容器，并将容器的 80 端口映射到本地的 8080 端口。你可以在浏览器中访问 `http://localhost:8080` 来查看你的 PHP 应用程序。

## 使用 Docker Compose 部署 PHP 应用程序

在实际开发中，PHP 应用程序通常需要与数据库、缓存等其他服务一起运行。Docker Compose 可以帮助你定义和运行多个容器的应用程序。

### 1. 创建 docker-compose.yml 文件

以下是一个简单的 `docker-compose.yml` 文件示例，用于部署 PHP 应用程序和 MySQL 数据库：

```yaml
version: '3.8'

services:
  web:
    image: my-php-app
    build: .
    ports:
      - "8080:80"
    depends_on:
      - db

  db:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: mydb
      MYSQL_USER: user
      MYSQL_PASSWORD: password
    volumes:
      - db_data:/var/lib/mysql

volumes:
  db_data:
```

### 2. 启动 Docker Compose

在 `docker-compose.yml` 文件所在的目录中，运行以下命令来启动所有服务：

```bash
docker-compose up -d
```

这将会启动 PHP 应用程序和 MySQL 数据库，并将 PHP 应用程序的 80 端口映射到本地的 8080 端口。

## 实际案例：部署一个简单的 PHP 应用程序

假设你有一个简单的 PHP 应用程序，它连接到 MySQL 数据库并显示一些数据。以下是如何使用 Docker 和 Docker Compose 部署这个应用程序的步骤。

### 1. 创建 PHP 应用程序

创建一个简单的 PHP 文件 `index.php`，内容如下：

```php
<?php
$host = 'db';
$dbname = 'mydb';
$user = 'user';
$password = 'password';

try {
    $conn = new PDO("mysql:host=$host;dbname=$dbname", $user, $password);
    echo "Connected to database successfully!";
} catch (PDOException $e) {
    echo "Connection failed: " . $e->getMessage();
}
?>
```

### 2. 创建 Dockerfile 和 docker-compose.yml

按照前面的步骤创建 `Dockerfile` 和 `docker-compose.yml` 文件。

### 3. 启动应用程序

运行以下命令启动应用程序：

```bash
docker-compose up -d
```

### 4. 访问应用程序

在浏览器中访问 `http://localhost:8080`，你应该会看到 "Connected to database successfully!" 的消息。

## 总结

通过本文，你已经学习了如何使用 Docker 和 Docker Compose 部署 PHP 应用程序。Docker 提供了一种简单、高效的方式来管理 PHP 应用程序的运行环境，确保开发、测试和生产环境的一致性。希望本文能帮助你更好地理解和使用 Docker 来部署 PHP 应用程序。

## 附加资源

- [Docker 官方文档](https://docs.docker.com/)
- [Docker Compose 官方文档](https://docs.docker.com/compose/)
- [PHP 官方 Docker 镜像](https://hub.docker.com/_/php)

## 练习

1. 尝试修改 `docker-compose.yml` 文件，添加 Redis 服务，并在 PHP 应用程序中连接到 Redis。
2. 创建一个更复杂的 PHP 应用程序，并使用 Docker Compose 部署多个服务（如 PHP、MySQL、Redis 等）。

:::tip
如果你在练习中遇到问题，可以参考 Docker 和 Docker Compose 的官方文档，或者在社区中寻求帮助。
:::