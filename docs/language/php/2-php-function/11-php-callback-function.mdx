---
title: PHP 回调函数
description: 了解PHP回调函数的概念、用法以及实际应用场景，适合初学者学习。
---

## 什么是PHP回调函数？

在PHP中，**回调函数**是指可以作为参数传递给其他函数的函数。回调函数允许你在某个特定事件发生时执行自定义的逻辑。这种机制在PHP中非常常见，尤其是在处理数组操作、事件驱动编程以及异步任务时。

回调函数可以是普通函数、匿名函数（闭包），甚至是对象的方法。PHP提供了多种方式来定义和使用回调函数，例如通过 `call_user_func()`、`array_map()` 等函数。

## 回调函数的基本用法

### 1. 使用普通函数作为回调

假设我们有一个简单的函数 `greet()`，它接受一个名字并返回问候语：

```php
function greet($name) {
    return "Hello, $name!";
}
```

我们可以将这个函数作为回调传递给另一个函数，例如 `call_user_func()`：

```php
$result = call_user_func('greet', 'Alice');
echo $result; // 输出: Hello, Alice!
```

在这个例子中，`call_user_func()` 调用了 `greet()` 函数，并将 `'Alice'` 作为参数传递给它。

### 2. 使用匿名函数作为回调

PHP 支持匿名函数（也称为闭包），它们可以在运行时动态定义。以下是一个使用匿名函数作为回调的示例：

```php
$greet = function($name) {
    return "Hello, $name!";
};

$result = call_user_func($greet, 'Bob');
echo $result; // 输出: Hello, Bob!
```

在这个例子中，我们定义了一个匿名函数并将其赋值给变量 `$greet`，然后将其作为回调传递给 `call_user_func()`。

### 3. 使用对象方法作为回调

回调函数也可以是对象的方法。假设我们有一个类 `Greeter`，其中包含一个方法 `sayHello()`：

```php
class Greeter {
    public function sayHello($name) {
        return "Hello, $name!";
    }
}

$greeter = new Greeter();
$result = call_user_func([$greeter, 'sayHello'], 'Charlie');
echo $result; // 输出: Hello, Charlie!
```

在这个例子中，我们将 `$greeter` 对象的 `sayHello()` 方法作为回调传递给 `call_user_func()`。

## 回调函数的实际应用场景

### 1. 数组操作

PHP 提供了许多数组函数，如 `array_map()`、`array_filter()` 和 `array_reduce()`，它们都接受回调函数作为参数。以下是一个使用 `array_map()` 的示例：

```php
$numbers = [1, 2, 3, 4, 5];

$squared = array_map(function($n) {
    return $n * $n;
}, $numbers);

print_r($squared); // 输出: Array ( [0] => 1 [1] => 4 [2] => 9 [3] => 16 [4] => 25 )
```

在这个例子中，我们使用匿名函数作为回调，将数组中的每个元素平方。

### 2. 事件驱动编程

在事件驱动编程中，回调函数常用于处理事件。例如，假设我们有一个简单的 `EventDispatcher` 类：

```php
class EventDispatcher {
    private $listeners = [];

    public function addListener($event, $callback) {
        $this->listeners[$event][] = $callback;
    }

    public function dispatch($event, $data) {
        if (isset($this->listeners[$event])) {
            foreach ($this->listeners[$event] as $callback) {
                call_user_func($callback, $data);
            }
        }
    }
}

$dispatcher = new EventDispatcher();

$dispatcher->addListener('user.login', function($username) {
    echo "User $username logged in!";
});

$dispatcher->dispatch('user.login', 'Alice'); // 输出: User Alice logged in!
```

在这个例子中，我们使用回调函数来处理 `user.login` 事件。

## 总结

回调函数是PHP中非常强大的工具，它们允许你将函数作为参数传递，并在特定事件发生时执行自定义逻辑。通过回调函数，你可以编写更加灵活和可重用的代码。

### 附加资源

- [PHP官方文档：回调函数](https://www.php.net/manual/en/language.types.callable.php)
- [PHP官方文档：匿名函数](https://www.php.net/manual/en/functions.anonymous.php)

### 练习

1. 编写一个PHP脚本，使用 `array_filter()` 函数过滤出一个数组中的所有偶数。
2. 创建一个简单的 `EventDispatcher` 类，并添加多个事件监听器，然后触发这些事件。

通过练习，你将更好地理解回调函数的概念及其在实际编程中的应用。