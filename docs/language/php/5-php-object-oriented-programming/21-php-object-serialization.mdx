---
title: PHP 对象序列化
description: 了解PHP中的对象序列化，掌握如何将对象转换为可存储或传输的格式，以及如何反序列化恢复对象。
---

## 介绍

在PHP中，对象序列化是指将对象转换为字符串的过程，以便可以将其存储在文件、数据库或通过网络传输。反序列化则是将字符串重新转换为对象的过程。序列化在需要保存对象状态或在不同系统之间传递对象时非常有用。

## 基本概念

### 什么是序列化？

序列化是将对象的状态转换为字符串的过程。这个字符串包含了对象的所有属性及其值，以及对象的类名。通过序列化，我们可以将对象保存到文件或数据库中，或者通过网络发送到其他系统。

### 什么是反序列化？

反序列化是将序列化后的字符串重新转换为对象的过程。通过反序列化，我们可以恢复对象的状态，并继续使用它。

## 序列化与反序列化的基本用法

### 序列化对象

在PHP中，可以使用 `serialize()` 函数将对象序列化为字符串。以下是一个简单的示例：

```php
<?php
class User {
    public $name;
    public $email;

    public function __construct($name, $email) {
        $this->name = $name;
        $this->email = $email;
    }
}

$user = new User("John Doe", "john@example.com");
$serializedUser = serialize($user);

echo $serializedUser;
?>
```

**输出：**
```
O:4:"User":2:{s:4:"name";s:8:"John Doe";s:5:"email";s:16:"john@example.com";}
```

### 反序列化对象

使用 `unserialize()` 函数可以将序列化后的字符串重新转换为对象：

```php
<?php
$serializedUser = 'O:4:"User":2:{s:4:"name";s:8:"John Doe";s:5:"email";s:16:"john@example.com";}';
$user = unserialize($serializedUser);

echo $user->name; // 输出: John Doe
echo $user->email; // 输出: john@example.com
?>
```

## 序列化的实际应用

### 保存对象到文件

序列化可以用于将对象保存到文件中，以便在需要时恢复对象状态。以下是一个将对象保存到文件并从中读取的示例：

```php
<?php
class User {
    public $name;
    public $email;

    public function __construct($name, $email) {
        $this->name = $name;
        $this->email = $email;
    }
}

$user = new User("Jane Doe", "jane@example.com");

// 序列化并保存到文件
file_put_contents('user.txt', serialize($user));

// 从文件中读取并反序列化
$user = unserialize(file_get_contents('user.txt'));

echo $user->name; // 输出: Jane Doe
echo $user->email; // 输出: jane@example.com
?>
```

### 通过网络传输对象

序列化还可以用于在不同系统之间传输对象。例如，可以将对象序列化为JSON格式并通过HTTP请求发送：

```php
<?php
class User {
    public $name;
    public $email;

    public function __construct($name, $email) {
        $this->name = $name;
        $this->email = $email;
    }
}

$user = new User("Alice", "alice@example.com");

// 序列化为JSON
$jsonUser = json_encode($user);

// 发送JSON数据（假设使用cURL）
$ch = curl_init('http://example.com/api/user');
curl_setopt($ch, CURLOPT_POSTFIELDS, $jsonUser);
curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type:application/json'));
curl_exec($ch);
curl_close($ch);
?>
```

## 注意事项

:::caution
1. **安全性**：反序列化不受信任的数据可能会导致安全问题，如代码注入。确保只反序列化来自可信来源的数据。
2. **类定义**：反序列化时，PHP需要能够访问原始类的定义。如果类定义不存在，PHP将无法正确反序列化对象。
3. **对象状态**：序列化只保存对象的属性，不保存方法。反序列化后，对象的方法将保持不变。
:::

## 总结

PHP对象序列化是一个强大的工具，允许我们将对象的状态保存为字符串，并在需要时恢复对象。它在保存对象状态、传输对象数据等场景中非常有用。然而，使用序列化时需要注意安全性问题，确保只反序列化可信的数据。

## 附加资源与练习

- **练习**：尝试创建一个包含多个对象的数组，并将其序列化保存到文件中。然后从文件中读取并反序列化数组，验证对象是否恢复正确。
- **进一步学习**：了解PHP中的魔术方法 `__sleep()` 和 `__wakeup()`，它们可以在序列化和反序列化过程中执行自定义逻辑。

通过掌握PHP对象序列化，你将能够更灵活地处理对象数据，并在实际开发中应用这一技术。