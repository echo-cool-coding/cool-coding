---
title: C++ 格式化输入输出
description: 学习如何在C++中使用格式化输入输出功能，控制数据的表示方式，以及提高程序的可读性和用户体验。
---

# C++ 格式化输入输出

在C++编程中，格式化输入输出是一项非常重要的技能，它允许我们控制数据的显示方式和读取方式，使程序更加用户友好，同时也提高了代码的可读性和可维护性。通过格式化，我们可以控制数字的精度、对齐方式、进制表示等多种显示特性。

## 什么是格式化输入输出？

格式化输入输出是指按照特定的格式规则来读取或显示数据。在C++中，我们主要通过`iostream`库中的流操纵算子(stream manipulators)和格式标志(format flags)来实现这一功能。

## 输出格式化

### 基本输出格式化

C++提供了多种方式来格式化输出数据：

#### 1. 使用`<iomanip>`头文件中的流操纵算子

```cpp
#include <iostream>
#include <iomanip> // 必须包含这个头文件

int main() {
    double value = 123.456789;
    
    std::cout << std::fixed;                   // 固定点表示法
    std::cout << std::setprecision(2);         // 设置精度为2位小数
    std::cout << "固定精度: " << value << std::endl;     // 输出: 123.46
    
    std::cout << std::scientific;              // 科学计数法
    std::cout << "科学计数法: " << value << std::endl;   // 输出: 1.23e+02
    
    return 0;
}
```

输出：
```
固定精度: 123.46
科学计数法: 1.23e+02
```

#### 2. 设置字段宽度和填充字符

```cpp
#include <iostream>
#include <iomanip>

int main() {
    int number = 42;
    
    // 设置字段宽度为10，默认右对齐
    std::cout << "右对齐: [" << std::setw(10) << number << "]\n";
    
    // 设置左对齐
    std::cout << "左对齐: [" << std::left << std::setw(10) << number << "]\n";
    
    // 设置填充字符
    std::cout << "填充星号: [" << std::right << std::setfill('*') << std::setw(10) << number << "]\n";
    
    return 0;
}
```

输出：
```
右对齐: [        42]
左对齐: [42        ]
填充星号: [********42]
```

#### 3. 数字进制表示

```cpp
#include <iostream>
#include <iomanip>

int main() {
    int number = 255;
    
    std::cout << "十进制: " << number << std::endl;
    std::cout << "十六进制: " << std::hex << number << std::endl;
    std::cout << "八进制: " << std::oct << number << std::endl;
    
    // 恢复十进制表示
    std::cout << std::dec << "恢复十进制: " << number << std::endl;
    
    // 显示基数前缀
    std::cout << "带前缀的十六进制: " << std::showbase << std::hex << number << std::endl;
    
    return 0;
}
```

输出：
```
十进制: 255
十六进制: ff
八进制: 377
恢复十进制: 255
带前缀的十六进制: 0xff
```

### 布尔值格式化

```cpp
#include <iostream>

int main() {
    bool value = true;
    
    std::cout << "默认布尔值: " << value << std::endl;
    std::cout << std::boolalpha << "字母形式: " << value << std::endl;
    std::cout << std::noboolalpha << "恢复数字形式: " << value << std::endl;
    
    return 0;
}
```

输出：
```
默认布尔值: 1
字母形式: true
恢复数字形式: 1
```

## 输入格式化

C++也允许我们格式化输入，使程序能够以特定方式解析用户提供的数据。

### 基本输入格式化

```cpp
#include <iostream>
#include <iomanip>

int main() {
    int hex_value;
    
    std::cout << "请输入一个十六进制数 (例如 FF): ";
    std::cin >> std::hex >> hex_value;
    
    std::cout << "您输入的十六进制数转换为十进制是: " << std::dec << hex_value << std::endl;
    
    return 0;
}
```

如果用户输入 `FF`，输出将是：
```
请输入一个十六进制数 (例如 FF): FF
您输入的十六进制数转换为十进制是: 255
```

### 忽略输入

有时我们需要忽略特定字符或一定数量的字符：

```cpp
#include <iostream>
#include <limits>

int main() {
    int number;
    char character;
    
    std::cout << "请输入一个数字和一个字符，用空格分隔: ";
    std::cin >> number;
    
    // 忽略缓冲区中直到下一个换行符的所有字符
    std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
    
    std::cout << "请输入另一个字符: ";
    std::cin >> character;
    
    std::cout << "您输入的数字是: " << number << std::endl;
    std::cout << "您输入的字符是: " << character << std::endl;
    
    return 0;
}
```

## 格式化输入输出的常用方法总结

### 常用流操纵算子

| 操纵算子 | 功能描述 |
|---------|----------|
| `setw(n)` | 设置字段宽度为n个字符 |
| `setfill(c)` | 设置填充字符为c |
| `setprecision(n)` | 设置浮点数精度为n位 |
| `fixed` | 使用固定点表示法 |
| `scientific` | 使用科学计数法 |
| `left` | 左对齐输出 |
| `right` | 右对齐输出 |
| `hex` | 以十六进制格式表示整数 |
| `oct` | 以八进制格式表示整数 |
| `dec` | 以十进制格式表示整数 |
| `showbase` | 显示整数的基数前缀 |
| `noshowbase` | 不显示整数的基数前缀 |
| `showpoint` | 总是显示小数点 |
| `noshowpoint` | 只在必要时显示小数点 |
| `boolalpha` | 以字母形式(true/false)表示布尔值 |
| `noboolalpha` | 以数字形式(1/0)表示布尔值 |

## 实际应用案例

### 案例1：财务报表生成器

在这个案例中，我们将创建一个简单的财务报表生成器，展示如何使用格式化输出来排版数据：

```cpp
#include <iostream>
#include <iomanip>
#include <vector>
#include <string>

struct Expense {
    std::string description;
    double amount;
};

void printFinancialReport(const std::vector<Expense>& expenses) {
    double total = 0.0;
    
    // 打印表头
    std::cout << std::setfill('-') << std::setw(50) << "-" << std::endl;
    std::cout << std::setfill(' ');
    std::cout << std::left << std::setw(30) << "描述" << std::right << std::setw(20) << "金额 (元)" << std::endl;
    std::cout << std::setfill('-') << std::setw(50) << "-" << std::endl;
    std::cout << std::setfill(' ');
    
    // 打印每一项
    for (const auto& expense : expenses) {
        std::cout << std::left << std::setw(30) << expense.description;
        std::cout << std::right << std::setw(20) << std::fixed << std::setprecision(2) << expense.amount << std::endl;
        total += expense.amount;
    }
    
    // 打印总计
    std::cout << std::setfill('-') << std::setw(50) << "-" << std::endl;
    std::cout << std::setfill(' ');
    std::cout << std::left << std::setw(30) << "总计";
    std::cout << std::right << std::setw(20) << std::fixed << std::setprecision(2) << total << std::endl;
}

int main() {
    std::vector<Expense> expenses = {
        {"办公用品", 458.75},
        {"水电费", 120.50},
        {"租金", 2500.00},
        {"交通费", 350.25},
        {"餐饮费", 632.10}
    };
    
    printFinancialReport(expenses);
    return 0;
}
```

输出：
```
--------------------------------------------------
描述                              金额 (元)
--------------------------------------------------
办公用品                             458.75
水电费                               120.50
租金                               2500.00
交通费                               350.25
餐饮费                               632.10
--------------------------------------------------
总计                               4061.60
```

### 案例2：数据分析工具

这个案例展示如何使用格式化输入来解析不同格式的数据：

```cpp
#include <iostream>
#include <iomanip>
#include <string>
#include <sstream>

struct DataPoint {
    std::string timestamp;
    double value;
};

DataPoint parseDatapoint(const std::string& line) {
    DataPoint point;
    std::istringstream iss(line);
    
    // 解析时间戳 (格式: YYYY-MM-DD)
    std::string year, month, day;
    getline(iss, year, '-');
    getline(iss, month, '-');
    getline(iss, day, ' ');
    point.timestamp = year + "-" + month + "-" + day;
    
    // 解析值
    iss >> point.value;
    
    return point;
}

int main() {
    std::string data_lines[] = {
        "2023-01-15 23.45",
        "2023-02-20 34.56",
        "2023-03-25 45.67"
    };
    
    std::cout << std::left << std::setw(15) << "日期" << std::right << std::setw(10) << "数值" << std::endl;
    std::cout << std::setfill('-') << std::setw(25) << "-" << std::endl;
    std::cout << std::setfill(' ');
    
    for (const auto& line : data_lines) {
        DataPoint point = parseDatapoint(line);
        std::cout << std::left << std::setw(15) << point.timestamp;
        std::cout << std::right << std::setw(10) << std::fixed << std::setprecision(2) << point.value << std::endl;
    }
    
    return 0;
}
```

输出：
```
日期                  数值
-------------------------
2023-01-15          23.45
2023-02-20          34.56
2023-03-25          45.67
```

## 最佳实践

:::tip 提示
在使用格式化输入输出时，请记住以下几点：
1. 总是包含必要的头文件：`<iomanip>` 和 `<iostream>`。
2. 设置的格式状态会持续到下一次更改或程序结束。
3. 在多线程环境中，注意流的共享访问可能导致格式混乱。
4. 不要忘记恢复默认格式，特别是在库函数中。
:::

## 总结

格式化输入输出是C++中非常强大的功能，掌握它可以让你的程序数据表示更加清晰、专业。通过本文的学习，你应该能够：

- 使用各种流操纵算子控制数据的显示格式
- 格式化数值数据，包括精度、对齐方式和进制表示
- 自定义输入解析方式
- 在实际应用场景中灵活运用这些技术

在实际编程中，良好的格式化不仅能提高程序的可用性，还能增强代码的可读性和可维护性。

## 练习

1. 编写一个程序，要求用户输入一个十进制数，然后以十进制、十六进制和八进制三种形式显示这个数。
2. 创建一个简单的表格显示程序，显示学生的姓名、成绩和等级，要求对齐整齐。
3. 扩展财务报表生成器，添加日期列，并按日期排序显示支出。
4. 实现一个温度转换器，接受不同格式的输入（如"32F"或"0C"），并转换为另一种温度单位。

## 附加资源

- C++ 标准库中的 `<iomanip>` 头文件文档
- 《C++ Primer》第17章：用于输入输出的特殊工具
- 《Effective C++》中关于IO流的章节

通过持续练习和应用，你将能够更加熟练地使用C++格式化输入输出功能，使你的程序更加专业和用户友好。