---
title: C++ 参数默认值
description: 本文全面讲解C++函数中参数默认值的使用方法、注意事项及实际应用场景，适合初学者学习。
---

# C++ 参数默认值

## 引言

在C++编程中，函数参数默认值是一个非常实用的特性。它允许我们在定义函数时为某些参数指定默认值，这样在调用函数时，如果没有提供这些参数的值，程序会自动使用预先设定的默认值。这种机制不仅使函数调用更加灵活，还能简化代码并提高可读性。

## 什么是参数默认值

参数默认值是指在函数声明或定义时为形参提供的预设值，当调用函数时如果没有为对应的参数提供实际值，则使用这个预设的默认值。

### 基本语法

```cpp
返回类型 函数名(参数类型 参数名 = 默认值, ...);
```

## 参数默认值的基本用法

让我们通过一个简单的例子来理解参数默认值的概念：

```cpp
#include <iostream>
using namespace std;

// 定义一个具有默认参数值的函数
void printMessage(string message = "Hello World!") {
    cout << message << endl;
}

int main() {
    // 不提供参数，使用默认值
    printMessage();       // 输出: Hello World!
    
    // 提供参数，覆盖默认值
    printMessage("Hello C++!");  // 输出: Hello C++!
    
    return 0;
}
```

上面的代码中，`printMessage`函数有一个默认参数值为"Hello World!"的参数`message`。当我们不传递任何参数调用`printMessage()`时，会使用默认值；而当我们提供一个参数时，默认值被覆盖。

## 多个参数的默认值

C++允许为多个参数设置默认值。在这种情况下，有一个重要规则：**如果一个参数有默认值，那么它右边的所有参数也必须有默认值**。

```cpp
#include <iostream>
using namespace std;

// 正确的多参数默认值设置
void displayInfo(string name, int age = 20, string country = "Unknown") {
    cout << "Name: " << name << ", Age: " << age << ", Country: " << country << endl;
}

int main() {
    displayInfo("Alice");                  // 输出: Name: Alice, Age: 20, Country: Unknown
    displayInfo("Bob", 25);                // 输出: Name: Bob, Age: 25, Country: Unknown
    displayInfo("Charlie", 30, "USA");     // 输出: Name: Charlie, Age: 30, Country: USA
    
    return 0;
}
```

:::warning
以下代码是错误的，因为有默认值的参数`age`右边的参数`name`没有默认值：

```cpp
void incorrect(int age = 20, string name); // 编译错误
```
:::

## 默认参数的声明与定义

默认参数的值可以在函数声明或函数定义中指定，但**不能在两处同时指定**。一般建议在函数声明中指定默认值，这样可以使函数的接口更加清晰。

```cpp
// 在函数声明中指定默认值
void setConfig(int timeout = 30, bool verbose = false);

// 函数定义不需要再次指定默认值
void setConfig(int timeout, bool verbose) {
    // 函数实现
}
```

## 参数默认值的作用域和生命周期

默认参数的值在函数被调用时确定，这意味着默认值可以是常量、变量甚至是函数调用的结果。

```cpp
#include <iostream>
using namespace std;

int getCurrentYear() {
    return 2023; // 假设当前是2023年
}

void printYear(int year = getCurrentYear()) {
    cout << "Year: " << year << endl;
}

int main() {
    printYear();      // 输出: Year: 2023
    printYear(2025);  // 输出: Year: 2025
    
    return 0;
}
```

需要注意的是，如果默认参数是一个变量，那么这个变量的值在函数**定义**时就已经确定，而不是在函数**调用**时确定。

## 参数默认值与函数重载

参数默认值与函数重载是两个不同的概念，但它们可以一起使用来提高代码的灵活性。

```cpp
#include <iostream>
using namespace std;

// 带有默认参数的函数
void print(int x = 10) {
    cout << "Integer: " << x << endl;
}

// 重载的函数
void print(double x) {
    cout << "Double: " << x << endl;
}

int main() {
    print();      // 调用 print(int)，输出: Integer: 10
    print(20);    // 调用 print(int)，输出: Integer: 20
    print(3.14);  // 调用 print(double)，输出: Double: 3.14
    
    return 0;
}
```

:::caution
在某些情况下，默认参数和函数重载结合使用可能会导致调用歧义。例如：

```cpp
void func(int x = 10);
void func(int x, int y = 20);

func(); // 错误：调用不明确
```

在这种情况下，编译器无法确定调用哪个函数，因为`func()`可能是调用`func(int x = 10)`或`func(int x, int y = 20)`，其中x也会使用默认值10。
:::

## 实际应用场景

### 1. 配置函数

默认参数在配置函数中非常有用，可以为不常修改的参数提供合理的默认值：

```cpp
void initializeDatabase(
    string host = "localhost", 
    int port = 3306, 
    string user = "admin", 
    string password = "", 
    bool useSSL = false
) {
    // 数据库初始化代码
}

// 使用
initializeDatabase();  // 使用所有默认值
initializeDatabase("db.example.com");  // 只修改主机名
initializeDatabase("db.example.com", 5432, "user", "pass", true);  // 修改所有参数
```

### 2. 构造函数

默认参数在类的构造函数中也非常常见：

```cpp
class Rectangle {
private:
    double width;
    double height;
    string color;
    
public:
    // 构造函数使用默认参数
    Rectangle(double w = 1.0, double h = 1.0, string c = "white") 
        : width(w), height(h), color(c) {}
    
    void display() {
        cout << "矩形: 宽度=" << width << ", 高度=" << height 
             << ", 颜色=" << color << endl;
    }
};

int main() {
    Rectangle r1;  // 使用所有默认值
    Rectangle r2(2.5);  // 自定义宽度，高度和颜色使用默认值
    Rectangle r3(3.0, 4.0);  // 自定义宽度和高度，颜色使用默认值
    Rectangle r4(5.0, 6.0, "blue");  // 自定义所有参数
    
    r1.display();
    r2.display();
    r3.display();
    r4.display();
    
    return 0;
}
```

输出：
```
矩形: 宽度=1, 高度=1, 颜色=white
矩形: 宽度=2.5, 高度=1, 颜色=white
矩形: 宽度=3, 高度=4, 颜色=white
矩形: 宽度=5, 高度=6, 颜色=blue
```

### 3. API 设计

在设计API时，默认参数可以帮助保持向后兼容性：

```cpp
// 原始API
void processData(vector<int> data, bool sortFirst);

// 使用默认参数扩展API，同时保持与旧代码的兼容性
void processData(vector<int> data, bool sortFirst, bool removeDuplicates = false);
```

## 参数默认值的注意事项

1. **右侧规则**：如果一个参数有默认值，其右侧的所有参数也必须有默认值。

2. **一次定义**：默认参数只能在函数声明或定义中指定一次，不能在两处同时指定。

3. **与函数重载的关系**：默认参数和函数重载结合使用时需要小心避免调用歧义。

4. **命名规范**：使用默认参数时，应该选择合理的默认值，并且考虑参数的命名，使代码更具自解释性。

```cpp
// 不好的命名
void setOptions(bool b1 = true, bool b2 = false, int i = 100);

// 好的命名
void setOptions(bool enableLogging = true, bool verboseMode = false, int timeout = 100);
```

## 总结

参数默认值是C++中一个强大的特性，它可以：
- 使函数调用更加灵活
- 减少函数重载的需要
- 提供合理的默认行为
- 简化客户端代码
- 使API更易于使用

正确使用参数默认值可以使你的代码更加整洁、灵活且易于维护。然而，过度使用默认参数也可能使函数接口变得复杂，因此需要在便利性和复杂性之间找到平衡。

## 练习

1. 编写一个函数`calculateArea`，计算不同形状的面积。函数接受三个参数：`shape`（形状类型，无默认值），`a`（第一个维度，默认为1.0），`b`（第二个维度，默认为1.0）。支持计算"circle"（圆，只使用a作为半径），"square"（正方形，只使用a作为边长），"rectangle"（矩形，使用a和b分别作为长和宽）。

2. 设计一个`User`类，其构造函数接受用户名（必需）、年龄（默认为0）、是否活跃（默认为true）和用户角色（默认为"guest"）。并添加一个`displayInfo`方法打印用户信息。

3. 修改以下代码，使其能够正确编译和运行：
```cpp
void func(int x, int y = 10, int z);

int main() {
    func(1);
    func(1, 2);
    func(1, 2, 3);
    return 0;
}
```

祝你在C++编程旅程中不断进步！

:::tip
记住：默认参数是提高代码灵活性和可读性的强大工具，但过度使用可能适得其反。始终追求代码的清晰性和简洁性。
:::