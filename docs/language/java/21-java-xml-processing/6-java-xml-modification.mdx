---
title: Java XML修改
description: 学习如何使用Java对XML文档进行修改、更新和保存操作
---

# Java XML修改

## 介绍

XML(可扩展标记语言)是一种用于存储和传输数据的灵活的文本格式。在实际应用中，我们经常需要不仅仅是读取XML文件，还需要对其进行修改，例如添加、更新或删除节点。Java提供了多种API来实现这些操作，本文将详细介绍如何使用Java对XML文档进行修改。

## XML修改的基本概念

在开始学习XML修改前，我们需要了解几个重要概念：

- **DOM (Document Object Model)**: 将XML文档加载到内存中，形成树状结构，可以对其进行查询和修改
- **Node**: XML树中的一个节点，可以是元素、属性、文本等
- **Element**: 一种特殊的节点，表示XML的元素标签
- **Document**: 代表整个XML文档的对象

## 使用DOM修改XML文件

DOM是最常用的XML操作方式，它允许我们加载整个XML文件到内存，然后进行各种修改操作。

### 第一步：加载XML文档

首先，我们需要将XML文档加载到内存中：

```java
import org.w3c.dom.*;
import javax.xml.parsers.*;
import javax.xml.transform.*;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;
import java.io.File;

public class XMLModifier {
    public static void main(String[] args) {
        try {
            // 创建DocumentBuilderFactory对象
            DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
            
            // 创建DocumentBuilder对象
            DocumentBuilder builder = factory.newDocumentBuilder();
            
            // 解析XML文件
            Document doc = builder.parse(new File("employees.xml"));
            
            // 标准化XML结构
            doc.getDocumentElement().normalize();
            
            System.out.println("已成功加载XML文档");
            
            // 在这里进行XML修改操作...
            
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

假设我们的`employees.xml`文件内容如下：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<company>
    <employee id="1">
        <name>张三</name>
        <title>软件工程师</title>
        <department>研发部</department>
    </employee>
    <employee id="2">
        <name>李四</name>
        <title>项目经理</title>
        <department>产品部</department>
    </employee>
</company>
```

### 第二步：修改元素内容

现在，让我们修改第一个员工的标题：

```java
// 获取所有employee元素
NodeList employees = doc.getElementsByTagName("employee");

// 修改第一个员工的title
Element firstEmployee = (Element) employees.item(0);
NodeList titles = firstEmployee.getElementsByTagName("title");
Element titleElement = (Element) titles.item(0);
titleElement.setTextContent("高级软件工程师");

System.out.println("已修改员工职位");
```

### 第三步：添加新元素

接下来，我们为第一个员工添加一个新的元素"salary"：

```java
// 为第一个员工添加salary元素
Element salary = doc.createElement("salary");
salary.appendChild(doc.createTextNode("15000"));
firstEmployee.appendChild(salary);

System.out.println("已添加薪资信息");
```

### 第四步：添加新的员工记录

现在，让我们添加一个全新的员工记录：

```java
// 创建新的employee元素
Element newEmployee = doc.createElement("employee");
newEmployee.setAttribute("id", "3");

// 创建name元素
Element nameElement = doc.createElement("name");
nameElement.appendChild(doc.createTextNode("王五"));
newEmployee.appendChild(nameElement);

// 创建title元素
Element titleElement2 = doc.createElement("title");
titleElement2.appendChild(doc.createTextNode("UI设计师"));
newEmployee.appendChild(titleElement2);

// 创建department元素
Element deptElement = doc.createElement("department");
deptElement.appendChild(doc.createTextNode("设计部"));
newEmployee.appendChild(deptElement);

// 将新员工添加到company根元素
doc.getDocumentElement().appendChild(newEmployee);

System.out.println("已添加新员工记录");
```

### 第五步：删除元素

假设我们需要删除第二个员工的记录：

```java
// 获取第二个员工元素
Element secondEmployee = (Element) employees.item(1);
// 获取父节点
Node parent = secondEmployee.getParentNode();
// 从父节点中删除该员工
parent.removeChild(secondEmployee);

System.out.println("已删除员工记录");
```

### 第六步：保存修改后的XML

最后，我们需要将修改后的DOM树保存回XML文件：

```java
// 创建TransformerFactory对象
TransformerFactory transformerFactory = TransformerFactory.newInstance();
Transformer transformer = transformerFactory.newTransformer();

// 设置输出属性（可选）
transformer.setOutputProperty(OutputKeys.INDENT, "yes");
transformer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "2");

// 创建DOMSource对象
DOMSource source = new DOMSource(doc);
// 创建StreamResult对象
StreamResult result = new StreamResult(new File("employees_modified.xml"));

// 将修改后的文档写入XML文件
transformer.transform(source, result);

System.out.println("XML文件已成功修改并保存");
```

修改后的XML文件`employees_modified.xml`内容如下：

```xml
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<company>
  <employee id="1">
    <name>张三</name>
    <title>高级软件工程师</title>
    <department>研发部</department>
    <salary>15000</salary>
  </employee>
  <employee id="3">
    <name>王五</name>
    <title>UI设计师</title>
    <department>设计部</department>
  </employee>
</company>
```

## 使用JDOM修改XML

除了DOM之外，JDOM是另一个可用于修改XML的Java库。与DOM相比，JDOM API更加Java化，更易于使用。

:::note
使用JDOM需要添加相应的依赖库到你的项目中。如果使用Maven，可以添加以下依赖：
```xml
<dependency>
    <groupId>org.jdom</groupId>
    <artifactId>jdom2</artifactId>
    <version>2.0.6</version>
</dependency>
```
:::

下面是使用JDOM修改XML的示例：

```java
import org.jdom2.*;
import org.jdom2.input.*;
import org.jdom2.output.*;
import java.io.*;

public class JDOMXMLModifier {
    public static void main(String[] args) {
        try {
            // 创建SAXBuilder对象
            SAXBuilder saxBuilder = new SAXBuilder();
            
            // 解析XML文件
            Document doc = saxBuilder.build(new File("employees.xml"));
            
            // 获取根元素
            Element rootElement = doc.getRootElement();
            
            // 获取第一个员工元素
            Element firstEmployee = rootElement.getChildren("employee").get(0);
            
            // 修改title元素内容
            firstEmployee.getChild("title").setText("高级软件工程师");
            
            // 添加salary元素
            Element salary = new Element("salary");
            salary.setText("15000");
            firstEmployee.addContent(salary);
            
            // 创建新员工
            Element newEmployee = new Element("employee");
            newEmployee.setAttribute("id", "3");
            newEmployee.addContent(new Element("name").setText("王五"));
            newEmployee.addContent(new Element("title").setText("UI设计师"));
            newEmployee.addContent(new Element("department").setText("设计部"));
            
            // 添加新员工到根元素
            rootElement.addContent(newEmployee);
            
            // 删除第二个员工
            rootElement.removeContent(rootElement.getChildren("employee").get(1));
            
            // 保存修改后的XML
            XMLOutputter xmlOutputter = new XMLOutputter();
            xmlOutputter.setFormat(Format.getPrettyFormat());
            xmlOutputter.output(doc, new FileOutputStream("employees_jdom_modified.xml"));
            
            System.out.println("JDOM：XML文件已成功修改并保存");
            
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

## 使用StAX修改XML

StAX (Streaming API for XML) 是一个事件驱动的API，它允许你按顺序处理XML文档。虽然主要用于读取，但也可以用于写入或修改XML。

下面是一个使用StAX复制并修改XML文件的简单示例：

```java
import javax.xml.stream.*;
import java.io.*;

public class StAXXMLModifier {
    public static void main(String[] args) {
        try {
            // 创建输入工厂
            XMLInputFactory inputFactory = XMLInputFactory.newInstance();
            // 创建输出工厂
            XMLOutputFactory outputFactory = XMLOutputFactory.newInstance();
            
            // 创建读取器
            XMLStreamReader reader = inputFactory.createXMLStreamReader(new FileInputStream("employees.xml"));
            // 创建写入器
            XMLStreamWriter writer = outputFactory.createXMLStreamWriter(new FileOutputStream("employees_stax_modified.xml"));
            
            // 开始文档
            writer.writeStartDocument();
            
            // 处理事件
            while(reader.hasNext()) {
                int event = reader.next();
                
                switch(event) {
                    case XMLStreamConstants.START_ELEMENT:
                        writer.writeStartElement(reader.getLocalName());
                        
                        // 复制所有属性
                        for(int i = 0; i < reader.getAttributeCount(); i++) {
                            writer.writeAttribute(
                                reader.getAttributeLocalName(i),
                                reader.getAttributeValue(i)
                            );
                        }
                        
                        // 修改特定元素
                        if(reader.getLocalName().equals("title") &&
                           reader.getElementText().equals("软件工程师")) {
                            writer.writeCharacters("高级软件工程师");
                            continue; // 跳过默认处理
                        }
                        break;
                        
                    case XMLStreamConstants.CHARACTERS:
                        writer.writeCharacters(reader.getText());
                        break;
                        
                    case XMLStreamConstants.END_ELEMENT:
                        writer.writeEndElement();
                        
                        // 在特定元素后添加新内容
                        if(reader.getLocalName().equals("department") &&
                           !reader.hasNext()) {
                            writer.writeStartElement("salary");
                            writer.writeCharacters("15000");
                            writer.writeEndElement();
                        }
                        break;
                        
                    case XMLStreamConstants.END_DOCUMENT:
                        writer.writeEndDocument();
                        break;
                }
            }
            
            // 关闭资源
            reader.close();
            writer.flush();
            writer.close();
            
            System.out.println("StAX：XML文件已成功修改并保存");
            
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

## 实际应用案例

### 案例1：配置文件更新

假设我们有一个Java应用，它使用XML文件存储配置信息。当用户修改设置时，我们需要更新XML配置文件：

```java
public class ConfigUpdater {
    private String configFile;
    private Document doc;
    
    public ConfigUpdater(String configFile) {
        this.configFile = configFile;
        try {
            DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
            DocumentBuilder builder = factory.newDocumentBuilder();
            doc = builder.parse(new File(configFile));
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    public void updateSetting(String settingName, String newValue) {
        try {
            // 查找设置元素
            NodeList settings = doc.getElementsByTagName("setting");
            for (int i = 0; i < settings.getLength(); i++) {
                Element setting = (Element) settings.item(i);
                if (setting.getAttribute("name").equals(settingName)) {
                    setting.setAttribute("value", newValue);
                    saveChanges();
                    System.out.println("设置 " + settingName + " 已更新为: " + newValue);
                    return;
                }
            }
            
            // 如果设置不存在，添加新设置
            Element root = doc.getDocumentElement();
            Element newSetting = doc.createElement("setting");
            newSetting.setAttribute("name", settingName);
            newSetting.setAttribute("value", newValue);
            root.appendChild(newSetting);
            saveChanges();
            System.out.println("新设置 " + settingName + " 已添加，值为: " + newValue);
            
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    private void saveChanges() throws Exception {
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        Transformer transformer = transformerFactory.newTransformer();
        transformer.setOutputProperty(OutputKeys.INDENT, "yes");
        DOMSource source = new DOMSource(doc);
        StreamResult result = new StreamResult(new File(configFile));
        transformer.transform(source, result);
    }
}
```

### 案例2：XML数据迁移工具

假设我们需要将旧格式的XML数据迁移到新格式：

```java
public class XMLMigrationTool {
    public static void migrateEmployeeData(String sourceFile, String targetFile) {
        try {
            // 加载源XML
            DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
            DocumentBuilder builder = factory.newDocumentBuilder();
            Document sourceDoc = builder.parse(new File(sourceFile));
            
            // 创建目标XML
            Document targetDoc = builder.newDocument();
            Element staff = targetDoc.createElement("staff");
            targetDoc.appendChild(staff);
            
            // 获取所有employee元素
            NodeList employees = sourceDoc.getElementsByTagName("employee");
            
            // 迁移数据
            for (int i = 0; i < employees.getLength(); i++) {
                Element oldEmployee = (Element) employees.item(i);
                
                // 创建新的person元素
                Element person = targetDoc.createElement("person");
                person.setAttribute("id", oldEmployee.getAttribute("id"));
                
                // 迁移姓名
                Element oldName = (Element) oldEmployee.getElementsByTagName("name").item(0);
                Element firstName = targetDoc.createElement("firstName");
                String[] nameParts = oldName.getTextContent().split(" ");
                firstName.setTextContent(nameParts[0]);
                person.appendChild(firstName);
                
                if (nameParts.length > 1) {
                    Element lastName = targetDoc.createElement("lastName");
                    lastName.setTextContent(nameParts[1]);
                    person.appendChild(lastName);
                }
                
                // 迁移职位
                Element oldTitle = (Element) oldEmployee.getElementsByTagName("title").item(0);
                Element position = targetDoc.createElement("position");
                position.setTextContent(oldTitle.getTextContent());
                person.appendChild(position);
                
                // 迁移部门
                Element oldDept = (Element) oldEmployee.getElementsByTagName("department").item(0);
                Element department = targetDoc.createElement("department");
                department.setTextContent(oldDept.getTextContent());
                person.appendChild(department);
                
                // 添加到staff根元素
                staff.appendChild(person);
            }
            
            // 保存目标XML
            TransformerFactory transformerFactory = TransformerFactory.newInstance();
            Transformer transformer = transformerFactory.newTransformer();
            transformer.setOutputProperty(OutputKeys.INDENT, "yes");
            DOMSource source = new DOMSource(targetDoc);
            StreamResult result = new StreamResult(new File(targetFile));
            transformer.transform(source, result);
            
            System.out.println("数据迁移完成！");
            
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

## XML修改的最佳实践

1. **使用正确的API**：根据你的需求选择合适的API。如果需要在内存中随机访问和修改XML，选择DOM或JDOM；如果处理大型文档且只需做少量修改，考虑StAX。

2. **保持XML结构的一致性**：确保修改后的XML仍然符合其预期的结构和格式。

3. **错误处理**：始终包含适当的异常处理代码，特别是在处理文件I/O操作时。

4. **格式化输出**：使用适当的缩进和换行使生成的XML文件更易读。

5. **备份原始文件**：在修改重要的XML文件前，先创建备份。

6. **验证修改后的XML**：确保修改后的XML文档仍然是有效的，可以使用验证器来检查。

7. **关闭资源**：确保正确关闭所有打开的流和资源。

## 总结

本文详细介绍了如何使用Java修改XML文档，包括使用DOM、JDOM和StAX等不同API进行元素的添加、修改和删除操作。我们还通过两个实际应用案例展示了XML修改在配置管理和数据迁移中的应用。

XML修改是Java开发中的一项基本技能，掌握这些技术可以帮助你更有效地处理各种数据交换和配置管理任务。

## 练习

1. 创建一个简单的XML文件，包含图书信息（标题、作者、出版年份等），然后编写一个Java程序来添加新的图书记录。

2. 修改上述程序，添加删除指定图书的功能。

3. 编写一个程序，将XML格式的学生成绩单转换为另一种格式的XML文件，同时添加平均分计算结果。

4. 创建一个简单的配置管理类，可以读取、修改和保存XML格式的应用配置文件。

5. 尝试使用不同的API（DOM、JDOM、StAX）实现相同的XML修改任务，比较它们的性能和易用性。

## 附加资源

- [Java DOM API文档](https://docs.oracle.com/javase/8/docs/api/org/w3c/dom/package-summary.html)
- [JDOM官方网站](http://www.jdom.org/)
- [Java StAX API教程](https://docs.oracle.com/javase/tutorial/jaxp/stax/index.html)
- [XML技术指南](https://www.w3schools.com/xml/)