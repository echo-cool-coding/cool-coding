---
title: Java 字符串格式化
description: 学习Java中字符串格式化的方法、语法和实际应用，包括printf、format方法和格式说明符的详细讲解
---

# Java 字符串格式化

在Java编程中，格式化字符串是一项非常实用的技能，它允许我们以特定的格式输出文本内容。无论是创建报表、生成日志还是构建用户界面，字符串格式化都能帮助我们以一种结构化且易读的方式呈现数据。

## 什么是字符串格式化？

字符串格式化是指按照预定义的格式模板，将各种数据类型（如整数、浮点数、字符串等）填充到模板中的过程。Java提供了多种方式来格式化字符串，其中最常用的是`printf`方法和`String.format`方法，它们的语法灵感来源于C语言的`printf`函数。

## 基本语法

Java字符串格式化主要使用格式说明符（format specifiers），格式说明符以百分号`%`开头，后跟一个或多个字符，用于指定如何格式化相应的参数。

### 常用的格式化方法

#### 1. String.format()

```java
String formattedString = String.format(formatString, args...);
```

#### 2. System.out.printf()

```java
System.out.printf(formatString, args...);
```

#### 3. Formatter类

```java
StringBuilder sb = new StringBuilder();
Formatter formatter = new Formatter(sb);
formatter.format(formatString, args...);
```

## 常用格式说明符

下面是一些常用的格式说明符：

- `%s` - 字符串
- `%d` - 整数
- `%f` - 浮点数
- `%c` - 字符
- `%b` - 布尔值
- `%%` - 百分号本身
- `%n` - 平台特定的行分隔符

### 基本示例

```java
String name = "John";
int age = 25;
double height = 1.85;

String formatted = String.format("Name: %s, Age: %d, Height: %.2f meters", name, age, height);
System.out.println(formatted);
```

**输出：**
```
Name: John, Age: 25, Height: 1.85 meters
```

## 格式说明符详解

格式说明符的完整语法是：

```
%[argument_index$][flags][width][.precision]conversion
```

让我们逐个解释这些元素：

### 1. argument_index（参数索引）

指定要格式化的参数的位置。索引从1开始。

```java
String formatted = String.format("%2$s %1$s", "World", "Hello");
System.out.println(formatted);  // 输出: Hello World
```

### 2. flags（标志）

修改输出格式的标志。

- `-`: 左对齐
- `+`: 总是显示符号（+或-）
- `0`: 用零填充
- `,`: 使用本地化的千位分隔符
- ` `: 正数前加空格，负数前加负号
- `(`: 将负数括在括号内

```java
System.out.printf("'%-10s'\n", "Left");    // 左对齐：'Left      '
System.out.printf("'%+d'\n", 123);         // 显示符号：'+123'
System.out.printf("'%05d'\n", 123);        // 零填充：'00123'
System.out.printf("'%,d'\n", 1234567);     // 千位分隔：'1,234,567'
System.out.printf("'% d'\n", 123);         // 空格前缀：' 123'
System.out.printf("'%(d'\n", -123);        // 括号负数：'(123)'
```

### 3. width（宽度）

指定输出的最小宽度。

```java
System.out.printf("'%10s'\n", "Hello");  // 输出: '     Hello'
```

### 4. precision（精度）

- 对于浮点数：指定小数点后的位数
- 对于字符串：指定最大字符数

```java
System.out.printf("'%.2f'\n", 3.14159);  // 输出: '3.14'
System.out.printf("'%.3s'\n", "Hello");   // 输出: 'Hel'
```

### 5. conversion（转换）

指定如何格式化参数。

```java
System.out.printf("整数：%d\n", 123);
System.out.printf("十六进制：%x\n", 255);
System.out.printf("八进制：%o\n", 8);
System.out.printf("科学计数法：%e\n", 1234.5678);
System.out.printf("百分比：%.1f%%\n", 75.5);
```

## 日期和时间格式化

Java也支持格式化日期和时间：

```java
import java.util.Date;

public class DateFormatExample {
    public static void main(String[] args) {
        Date now = new Date();
        
        System.out.printf("当前日期和时间：%tc%n", now);
        System.out.printf("日期：%tD%n", now);
        System.out.printf("时间：%tT%n", now);
        System.out.printf("年份：%tY%n", now);
        System.out.printf("月份：%tB%n", now);
        System.out.printf("星期：%tA%n", now);
    }
}
```

**输出示例：**
```
当前日期和时间：周三 10月 19 15:30:45 CST 2023
日期：10/19/23
时间：15:30:45
年份：2023
月份：十月
星期：星期三
```

:::tip
从Java 8开始，推荐使用`java.time`包中的类和`DateTimeFormatter`来处理日期和时间格式化，它提供了更强大和灵活的API。
:::

## 数字格式化

### 货币格式

```java
double price = 1234.56;
System.out.printf("价格：$%,.2f%n", price);  // 输出：价格：$1,234.56
```

### 百分比格式

```java
double percentage = 0.7568;
System.out.printf("完成度：%.1f%%%n", percentage * 100);  // 输出：完成度：75.7%
```

## 实际应用案例

### 案例1：生成报表

假设我们需要生成一个简单的销售报表：

```java
public class SalesReport {
    public static void main(String[] args) {
        String[] products = {"苹果手机", "安卓手机", "平板电脑"};
        int[] quantities = {120, 85, 50};
        double[] prices = {6999.99, 4999.99, 3299.99};
        
        // 打印表头
        System.out.printf("%-15s %10s %15s %15s%n", "产品名称", "销售数量", "单价(￥)", "总金额(￥)");
        System.out.println("--------------------------------------------------------");
        
        double total = 0;
        for (int i = 0; i < products.length; i++) {
            double amount = quantities[i] * prices[i];
            total += amount;
            System.out.printf("%-15s %10d %,15.2f %,15.2f%n", 
                             products[i], quantities[i], prices[i], amount);
        }
        
        System.out.println("--------------------------------------------------------");
        System.out.printf("%-15s %10s %15s %,15.2f%n", "合计", "", "", total);
    }
}
```

**输出：**
```
产品名称             销售数量            单价(￥)          总金额(￥)
--------------------------------------------------------
苹果手机                 120        6,999.99       839,998.80
安卓手机                  85        4,999.99       424,999.15
平板电脑                  50        3,299.99       164,999.50
--------------------------------------------------------
合计                                            1,429,997.45
```

### 案例2：日志记录器

```java
public class SimpleLogger {
    public enum Level {INFO, WARNING, ERROR}
    
    public static void log(Level level, String message, Object... args) {
        Date now = new Date();
        String formattedMessage = String.format(message, args);
        String output = String.format("%tF %tT [%s] %s", now, now, level, formattedMessage);
        System.out.println(output);
    }
    
    public static void main(String[] args) {
        log(Level.INFO, "用户 %s 已登录", "Alice");
        log(Level.WARNING, "检测到 %d 次登录失败尝试", 3);
        log(Level.ERROR, "数据库连接失败：%s", "Timeout");
    }
}
```

**输出：**
```
2023-10-19 15:45:20 [INFO] 用户 Alice 已登录
2023-10-19 15:45:20 [WARNING] 检测到 3 次登录失败尝试
2023-10-19 15:45:20 [ERROR] 数据库连接失败：Timeout
```

## 注意事项和最佳实践

1. **参数匹配**: 确保格式说明符的数量和类型与提供的参数匹配。
2. **国际化**: 使用`java.util.Formatter`的本地化特性处理不同语言环境。
3. **性能考虑**: 当需要重复使用同一格式模板时，考虑预编译格式化模板。
4. **安全性**: 处理用户输入时，避免直接将其作为格式字符串，以防止格式字符串攻击。

:::caution
如果格式说明符和提供的参数类型不匹配，将会抛出`java.util.IllegalFormatConversionException`异常。
:::

## 总结

Java字符串格式化是一项强大的功能，掌握它可以帮助你:

1. 以结构化且易读的方式呈现数据
2. 控制数字的显示格式（小数位数、千位分隔符等）
3. 轻松对齐文本输出
4. 格式化日期和时间
5. 创建专业的报表和日志

通过本文的学习，你应该已经掌握了Java字符串格式化的基础知识和常用技巧。随着编程经验的增长，你会发现字符串格式化在许多场景中都非常有用。

## 练习题

1. 编写一个程序，格式化输出一个包含姓名、年龄和成绩的学生信息表。
2. 创建一个简单的发票生成器，包括商品名称、数量、单价和总金额。
3. 编写一个方法，将给定的秒数格式化为"小时:分钟:秒"的格式。
4. 使用字符串格式化实现一个简单的进度条显示功能。

## 扩展资源

- [Java官方文档 - Formatter类](https://docs.oracle.com/javase/8/docs/api/java/util/Formatter.html)
- [Java官方文档 - String.format方法](https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#format-java.lang.String-java.lang.Object...-)
- [Java官方文档 - printf方法](https://docs.oracle.com/javase/8/docs/api/java/io/PrintStream.html#printf-java.lang.String-java.lang.Object...-)

通过实践和探索这些资源，你将能够更加熟练地使用Java字符串格式化功能，使你的程序输出更加专业和易读。