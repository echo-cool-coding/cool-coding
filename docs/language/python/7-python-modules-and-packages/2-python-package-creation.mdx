---
title: Python 包创建
description: 学习如何创建、组织和发布Python包，掌握模块化编程的关键技能
---

# Python 包创建

在Python开发过程中，随着项目的规模不断扩大，代码的管理和组织变得越来越重要。这时候，将相关功能组织成包(Package)就成为了一种必要的编程实践。本文将带你全面了解Python包的创建、组织和发布过程。

## 什么是Python包？

Python包是一种组织相关模块的方式，它实际上是一个包含特殊文件`__init__.py`的目录。通过创建包，我们可以：

- 将相关功能的模块组织在一起
- 避免命名冲突
- 提高代码的可重用性和可维护性
- 方便分发和安装

:::note
模块(Module)是单个Python文件，而包(Package)是包含多个模块的目录。
:::

## 创建基本的Python包

### 步骤1：创建包目录结构

一个最简单的Python包结构如下：

```
my_package/
├── __init__.py
├── module1.py
└── module2.py
```

### 步骤2：创建`__init__.py`文件

`__init__.py`文件是必须的，它告诉Python这个目录应该被视为一个包。最简单的情况下，这个文件可以是空的，但通常我们会在其中定义包级别的变量和导入语句。

```python
# my_package/__init__.py
"""我的第一个Python包."""

__version__ = '0.1.0'
```

### 步骤3：创建模块文件

接下来，创建包中的模块文件：

```python
# my_package/module1.py
def greet(name):
    """返回一个问候语"""
    return f"Hello, {name}!"

def farewell(name):
    """返回一个告别语"""
    return f"Goodbye, {name}!"
```

```python
# my_package/module2.py
def add(a, b):
    """返回两个数的和"""
    return a + b

def subtract(a, b):
    """返回两个数的差"""
    return a - b
```

### 步骤4：使用你的包

现在你可以导入和使用你的包了：

```python
# 使用示例
import my_package.module1

# 输出: Hello, World!
print(my_package.module1.greet("World"))

from my_package.module2 import add

# 输出: 8
print(add(3, 5))
```

## 进阶包结构

当你的包含有更多功能时，你可能需要一个更复杂的结构：

```
advanced_package/
├── __init__.py
├── subpackage1/
│   ├── __init__.py
│   ├── module1.py
│   └── module2.py
├── subpackage2/
│   ├── __init__.py
│   └── module3.py
└── module4.py
```

在`__init__.py`文件中，你可以控制包的导入行为：

```python
# advanced_package/__init__.py
from .module4 import *
from .subpackage1 import module1, module2

__all__ = ['module1', 'module2', 'function_from_module4']
```

`__all__`列表定义了当用户使用`from advanced_package import *`时导入的对象。

## 包的相对导入

在包的模块之间进行导入时，可以使用相对导入：

```python
# 绝对导入
from advanced_package.subpackage1 import module1

# 相对导入
from ..subpackage1 import module1  # 从父包的subpackage1导入module1
from . import module2              # 从当前包导入module2
```

:::caution
相对导入只能在包内部使用，不能在顶级脚本中使用。
:::

## 创建可分发的包

要创建一个可以分发给其他人使用的包，你需要：

### 步骤1：创建适当的目录结构

```
my_project/
├── LICENSE
├── README.md
├── setup.py
├── my_package/
│   ├── __init__.py
│   └── module1.py
└── tests/
    └── test_module1.py
```

### 步骤2：编写`setup.py`文件

`setup.py`文件是使用setuptools创建可分发包的关键：

```python
from setuptools import setup, find_packages

setup(
    name="my_package",
    version="0.1.0",
    author="Your Name",
    author_email="your.email@example.com",
    description="A small example package",
    long_description=open("README.md").read(),
    long_description_content_type="text/markdown",
    url="https://github.com/yourusername/my_package",
    packages=find_packages(),
    classifiers=[
        "Programming Language :: Python :: 3",
        "License :: OSI Approved :: MIT License",
        "Operating System :: OS Independent",
    ],
    python_requires=">=3.6",
)
```

### 步骤3：构建和分发包

使用以下命令构建和分发你的包：

```bash
# 安装构建工具
pip install build

# 构建包
python -m build

# 这将在dist/目录中创建两个文件：
# - wheel文件(.whl)：二进制分发格式
# - tarball文件(.tar.gz)：源代码分发格式
```

### 步骤4：上传到PyPI（Python包索引）

首先安装上传工具：

```bash
pip install twine
```

然后上传你的包：

```bash
twine upload dist/*
```

## 实际案例：创建一个简单的数学工具包

让我们创建一个名为`mathtools`的包，它提供基本的数学运算和统计功能。

### 目录结构

```
mathtools/
├── __init__.py
├── basic/
│   ├── __init__.py
│   └── operations.py
└── stats/
    ├── __init__.py
    └── descriptive.py
```

### 代码实现

```python
# mathtools/__init__.py
"""
MathTools: 一个简单的数学工具包
"""

__version__ = '0.1.0'

# 导入常用函数到包的顶层命名空间
from .basic.operations import add, subtract, multiply, divide
from .stats.descriptive import mean, median
```

```python
# mathtools/basic/__init__.py
"""基本数学运算模块"""
```

```python
# mathtools/basic/operations.py
"""提供基本的数学运算"""

def add(a, b):
    """返回两个数的和"""
    return a + b

def subtract(a, b):
    """返回两个数的差"""
    return a - b

def multiply(a, b):
    """返回两个数的乘积"""
    return a * b

def divide(a, b):
    """返回两个数的商"""
    if b == 0:
        raise ZeroDivisionError("除数不能为零")
    return a / b
```

```python
# mathtools/stats/__init__.py
"""统计相关模块"""
```

```python
# mathtools/stats/descriptive.py
"""提供描述性统计函数"""

def mean(numbers):
    """计算平均值"""
    if not numbers:
        raise ValueError("输入列表不能为空")
    return sum(numbers) / len(numbers)

def median(numbers):
    """计算中位数"""
    if not numbers:
        raise ValueError("输入列表不能为空")
    
    sorted_numbers = sorted(numbers)
    n = len(sorted_numbers)
    
    if n % 2 == 0:
        # 偶数个元素，取中间两个的平均值
        return (sorted_numbers[n//2 - 1] + sorted_numbers[n//2]) / 2
    else:
        # 奇数个元素，取中间的一个
        return sorted_numbers[n//2]
```

### 使用示例

```python
# 使用mathtools包
from mathtools import add, mean

print(add(10, 5))  # 输出: 15

data = [1, 2, 3, 4, 5]
print(mean(data))  # 输出: 3.0

# 也可以这样导入和使用
from mathtools.stats.descriptive import median
print(median(data))  # 输出: 3
```

## 包含数据文件

有时，你的包可能需要包含非Python文件（如配置文件、数据文件等）。要在你的包中包含这些文件，需要：

1. 创建`MANIFEST.in`文件，列出要包含的文件
2. 在`setup.py`中设置`include_package_data=True`
3. 或使用`package_data`参数显式列出文件

```
# MANIFEST.in
include my_package/data/*.json
include my_package/config/*.yaml
```

```python
# setup.py片段
setup(
    # ...其他参数...
    include_package_data=True,
    # 或者指定具体文件
    package_data={
        'my_package': ['data/*.json', 'config/*.yaml'],
    },
)
```

## 总结

创建Python包是组织代码、提高代码复用性和分享你的工作的重要方式。通过本文，你已经学习了：

1. 如何创建基本的Python包结构
2. 如何使用`__init__.py`文件控制包的行为
3. 如何在包内使用相对导入
4. 如何构建可分发的包并上传到PyPI
5. 如何在实际项目中应用包的创建

掌握这些技能后，你将能够更有效地组织你的Python代码，并在需要时与社区共享你的工作。

## 练习

1. 创建一个名为`string_utils`的包，包含处理字符串的各种实用函数，如大小写转换、字符统计等。
2. 为你的`string_utils`包添加测试，确保所有功能正常工作。
3. 为`string_utils`创建适当的文档，包括docstrings和README文件。
4. 尝试将你的包构建为wheel文件，并在本地安装测试。
5. 在一个真实项目中使用你创建的包，体验模块化编程的好处。

:::tip
开发包时，良好的文档和测试是非常重要的。确保为你的函数编写清晰的docstrings，并使用unittest或pytest创建测试用例。
:::