---
title: Python 字典推导式
description: 全面了解Python字典推导式的语法、使用方法及实际应用场景，通过丰富的示例帮助初学者掌握这一高效创建字典的技术。
---

# Python 字典推导式

## 什么是字典推导式？

字典推导式(Dictionary Comprehension)是Python提供的一种简洁、优雅的创建字典的方式。它允许你使用简短的语法从可迭代对象快速构建字典，同时可以应用条件过滤和转换。

字典推导式是列表推导式的延伸，于Python 2.7版本引入，成为Python编程中提高代码效率和可读性的重要工具。

:::tip
掌握字典推导式可以让你用一行代码替代多行循环语句，使代码更加简洁优雅！
:::

## 基本语法

字典推导式的基本语法如下：

```python
{key_expression: value_expression for item in iterable}
```

带条件过滤的字典推导式语法：

```python
{key_expression: value_expression for item in iterable if condition}
```

## 基础示例

### 示例1：创建简单字典

将一个数字列表转换为以数字为键，数字平方为值的字典：

```python
numbers = [1, 2, 3, 4, 5]
squared_dict = {num: num**2 for num in numbers}
print(squared_dict)
```

输出：
```
{1: 1, 2: 4, 3: 9, 4: 16, 5: 25}
```

### 示例2：条件过滤

创建只包含偶数及其平方的字典：

```python
numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
even_squares = {num: num**2 for num in numbers if num % 2 == 0}
print(even_squares)
```

输出：
```
{2: 4, 4: 16, 6: 36, 8: 64, 10: 100}
```

### 示例3：从两个列表创建字典

将两个列表合并为一个字典：

```python
fruits = ['apple', 'banana', 'orange', 'mango']
prices = [1.2, 0.9, 1.5, 2.0]

fruit_prices = {fruit: price for fruit, price in zip(fruits, prices)}
print(fruit_prices)
```

输出：
```
{'apple': 1.2, 'banana': 0.9, 'orange': 1.5, 'mango': 2.0}
```

## 进阶用法

### 嵌套字典推导式

你可以在字典推导式中使用嵌套循环：

```python
matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
flat_dict = {f"key_{row}_{col}": value for row, row_values in enumerate(matrix) 
                                      for col, value in enumerate(row_values)}
print(flat_dict)
```

输出：
```
{'key_0_0': 1, 'key_0_1': 2, 'key_0_2': 3, 'key_1_0': 4, 'key_1_1': 5, 'key_1_2': 6, 'key_2_0': 7, 'key_2_1': 8, 'key_2_2': 9}
```

### 使用现有字典创建新字典

可以基于现有字典创建新字典，例如转换键值对：

```python
original_dict = {'a': 1, 'b': 2, 'c': 3, 'd': 4}
swapped_dict = {value: key for key, value in original_dict.items()}
print(swapped_dict)
```

输出：
```
{1: 'a', 2: 'b', 3: 'c', 4: 'd'}
```

### 多条件过滤

在字典推导式中使用多个条件：

```python
numbers = range(1, 21)
filtered_dict = {num: num**2 for num in numbers if num % 2 == 0 if num % 3 != 0}
print(filtered_dict)
```

输出：
```
{2: 4, 4: 16, 8: 64, 10: 100, 14: 196, 16: 256, 20: 400}
```

## 字典推导式与传统方法对比

让我们比较使用字典推导式和传统循环方式创建字典的区别：

### 传统方法：

```python
numbers = [1, 2, 3, 4, 5]
squared_dict = {}
for num in numbers:
    squared_dict[num] = num**2
print(squared_dict)
```

### 字典推导式：

```python
numbers = [1, 2, 3, 4, 5]
squared_dict = {num: num**2 for num in numbers}
print(squared_dict)
```

:::note
两种方法产生相同的结果，但字典推导式更简洁，通常可读性更高，一行代码就能完成相同的任务。
:::

## 实际应用场景

### 场景1：数据转换

将CSV数据转换成字典格式：

```python
# 假设从CSV读取的数据
employee_data = [
    ('John', 'Developer', 5000),
    ('Alice', 'Designer', 4500),
    ('Bob', 'Manager', 6000),
    ('Emma', 'Developer', 5200)
]

# 使用字典推导式创建员工信息字典
employee_dict = {name: {'role': role, 'salary': salary} for name, role, salary in employee_data}
print(employee_dict)
```

输出：
```
{
    'John': {'role': 'Developer', 'salary': 5000},
    'Alice': {'role': 'Designer', 'salary': 4500},
    'Bob': {'role': 'Manager', 'salary': 6000},
    'Emma': {'role': 'Developer', 'salary': 5200}
}
```

### 场景2：数据清洗和过滤

从API获取的数据中筛选有用信息：

```python
# 假设这是从API获取的原始数据
raw_data = [
    {'id': 1, 'name': 'Product A', 'price': 100, 'in_stock': True},
    {'id': 2, 'name': 'Product B', 'price': 50, 'in_stock': False},
    {'id': 3, 'name': 'Product C', 'price': 75, 'in_stock': True},
    {'id': 4, 'name': 'Product D', 'price': 30, 'in_stock': True}
]

# 筛选在库商品并创建简化字典
available_products = {item['name']: item['price'] for item in raw_data if item['in_stock']}
print(available_products)
```

输出：
```
{'Product A': 100, 'Product C': 75, 'Product D': 30}
```

### 场景3：计数和频率分析

统计文本中单词出现的频率：

```python
text = "Python is amazing Python is powerful Python is versatile"
word_count = {word: text.split().count(word) for word in set(text.split())}
print(word_count)
```

输出：
```
{'Python': 3, 'is': 3, 'amazing': 1, 'powerful': 1, 'versatile': 1}
```

## 性能考虑

字典推导式不仅仅是语法糖，在大多数情况下，它的性能比等效的循环稍好。这是因为字典推导式是在Python解释器层面优化的。

但要注意，对于非常大的数据集，推导式会一次性在内存中创建整个字典，可能会导致内存问题。在这种情况下，考虑使用生成器表达式和`dict()`结合可能更合适。

## 最佳实践

1. **保持简洁**：字典推导式最好用于简单明了的转换，复杂逻辑应考虑使用传统循环。
2. **注意可读性**：虽然简洁好，但不要为了简洁而牺牲可读性。
3. **添加注释**：对于复杂的字典推导式，添加注释解释其功能。
4. **避免嵌套过多**：过多的嵌套会降低代码的可维护性。

## 总结

字典推导式是Python中一个强大的特性，可以让你用简洁的语法创建和转换字典。它特别适合：

- 从其他数据结构快速创建字典
- 对现有字典进行转换和过滤
- 数据清洗和预处理
- 频率统计和分析

通过掌握字典推导式，你可以编写更加简洁、易读的Python代码，提高编程效率。

## 练习题

为了帮助你巩固所学知识，尝试完成以下练习：

1. 创建一个字典，键为1到10的数字，值为数字的立方。
2. 从一个包含重复项的字符串中，创建一个字典，键为每个字符，值为该字符在字符串中出现的次数。
3. 给定一个字典，创建一个新字典，只包含原字典中值大于50的项。
4. 从两个列表创建一个字典，但是只包含第一个列表中长度大于3的字符串。

:::caution
记住，虽然字典推导式很强大，但并不是所有场景都适合使用它。当逻辑过于复杂时，可读性可能会受到影响。
:::

## 延伸阅读

- Python官方文档中关于[字典推导式](https://docs.python.org/3/tutorial/datastructures.html#dictionaries)的内容
- 学习其他Python推导式：列表推导式和集合推导式
- 了解生成器表达式及其与推导式的区别

通过掌握字典推导式，你已经迈出了成为Python高级开发者的重要一步！