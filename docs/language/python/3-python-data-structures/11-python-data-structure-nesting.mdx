---
title: Python 数据结构嵌套
description: 学习如何在Python中创建和操作嵌套数据结构，包括列表、字典、元组等的嵌套组合及其应用场景
---

# Python 数据结构嵌套

在Python编程中，数据结构嵌套是指将一种数据结构放置在另一种数据结构内部，形成复杂的数据组织方式。这种能力使Python能够表达和处理复杂的数据关系，对于处理实际编程问题尤其有用。

## 为什么需要嵌套数据结构？

在实际编程中，我们经常需要表示层次化或多维度的数据：

- 组织具有多级分类的信息
- 表示树状结构
- 存储多维数据（如表格、矩阵）
- 构建复杂的数据模型（如JSON数据）

## 常见的嵌套数据结构类型

### 嵌套列表

列表的嵌套是最常见的一种嵌套形式，通常用于表示二维或多维数据。

#### 二维列表（矩阵）

```python
# 创建一个3x3的矩阵
matrix = [
    [1, 2, 3],
    [4, 5, 6],
    [7, 8, 9]
]

# 访问矩阵中的元素
print(matrix[1][2])  # 输出: 6（第2行第3列的元素）

# 遍历矩阵
for row in matrix:
    for element in row:
        print(element, end=" ")
    print()  # 换行
```

输出：
```
6
1 2 3 
4 5 6 
7 8 9 
```

#### 多维列表

列表嵌套可以扩展到多个维度：

```python
# 三维列表
cube = [
    [[1, 2], [3, 4]],
    [[5, 6], [7, 8]]
]

# 访问三维列表的元素
print(cube[1][0][1])  # 输出: 6
```

输出：
```
6
```

### 嵌套字典

字典可以嵌套包含其他字典，用于表示层次化的键值数据。

```python
# 学生信息系统
students = {
    "alice": {
        "id": 12345,
        "age": 20,
        "courses": {
            "math": 95,
            "science": 88,
            "history": 92
        }
    },
    "bob": {
        "id": 67890,
        "age": 21,
        "courses": {
            "math": 85,
            "science": 94,
            "history": 78
        }
    }
}

# 访问嵌套字典中的数据
print(f"Alice的数学成绩: {students['alice']['courses']['math']}")
print(f"Bob的年龄: {students['bob']['age']}")
```

输出：
```
Alice的数学成绩: 95
Bob的年龄: 21
```

### 列表与字典的混合嵌套

最常见的复杂数据结构是列表和字典的混合嵌套，这也是JSON数据的常见形式。

```python
# 一个包含多个学生信息的列表
class_data = [
    {
        "name": "Alice",
        "grades": [95, 88, 92],
        "contact": {
            "email": "alice@example.com",
            "phone": "123-456-7890"
        }
    },
    {
        "name": "Bob",
        "grades": [85, 94, 78],
        "contact": {
            "email": "bob@example.com",
            "phone": "098-765-4321"
        }
    }
]

# 访问混合嵌套数据
print(f"第一个学生的名字: {class_data[0]['name']}")
print(f"Bob的第二个成绩: {class_data[1]['grades'][1]}")
print(f"Alice的邮箱: {class_data[0]['contact']['email']}")

# 遍历所有学生的成绩
for student in class_data:
    print(f"{student['name']}的成绩:")
    for grade in student['grades']:
        print(f"  - {grade}")
```

输出：
```
第一个学生的名字: Alice
Bob的第二个成绩: 94
Alice的邮箱: alice@example.com
Alice的成绩:
  - 95
  - 88
  - 92
Bob的成绩:
  - 85
  - 94
  - 78
```

### 元组的嵌套

元组也可以包含其他元组或其他数据结构：

```python
# 坐标点的集合（每个点是一个元组）
points = (
    (1, 2),
    (3, 4),
    (5, 6)
)

# 访问嵌套元组中的元素
print(f"第二个点的x坐标: {points[1][0]}")
```

输出：
```
第二个点的x坐标: 3
```

### 集合的嵌套

需要注意的是，Python的集合（set）不能直接嵌套，因为集合的元素必须是可哈希的，而集合本身是不可哈希的。但可以使用frozenset（不可变集合）作为另一个集合的元素。

```python
# 使用frozenset在集合中嵌套"集合"
set_of_frozensets = {
    frozenset({1, 2, 3}),
    frozenset({4, 5, 6})
}

print(set_of_frozensets)
```

输出类似（顺序可能不同）：
```
{frozenset({1, 2, 3}), frozenset({4, 5, 6})}
```

## 操作嵌套数据结构

### 修改嵌套数据

```python
# 修改嵌套列表的元素
matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
matrix[0][1] = 20
print(matrix)

# 修改嵌套字典的值
students["alice"]["courses"]["math"] = 97
print(f"Alice更新后的数学成绩: {students['alice']['courses']['math']}")
```

输出：
```
[[1, 20, 3], [4, 5, 6], [7, 8, 9]]
Alice更新后的数学成绩: 97
```

### 添加数据到嵌套结构

```python
# 向嵌套列表添加元素
matrix.append([10, 11, 12])
print(matrix)

# 向嵌套字典添加元素
students["alice"]["courses"]["programming"] = 98
print(students["alice"]["courses"])
```

输出：
```
[[1, 20, 3], [4, 5, 6], [7, 8, 9], [10, 11, 12]]
{'math': 97, 'science': 88, 'history': 92, 'programming': 98}
```

### 遍历嵌套数据结构

遍历嵌套数据结构通常需要嵌套循环：

```python
# 遍历嵌套字典
for student_name, student_info in students.items():
    print(f"学生: {student_name}")
    print(f"  ID: {student_info['id']}")
    print(f"  年龄: {student_info['age']}")
    print("  课程成绩:")
    for course, grade in student_info['courses'].items():
        print(f"    - {course}: {grade}")
```

输出：
```
学生: alice
  ID: 12345
  年龄: 20
  课程成绩:
    - math: 97
    - science: 88
    - history: 92
    - programming: 98
学生: bob
  ID: 67890
  年龄: 21
  课程成绩:
    - math: 85
    - science: 94
    - history: 78
```

## 嵌套数据结构的实际应用场景

### 1. 处理JSON数据

JSON是Web API中常用的数据格式，本质上就是嵌套的字典和列表：

```python
import json

# 从JSON字符串解析数据
json_data = '''
{
    "name": "Python课程",
    "instructor": {
        "name": "王教授",
        "office": "科技楼B-201"
    },
    "students": [
        {"name": "张三", "id": "001", "scores": [85, 90, 92]},
        {"name": "李四", "id": "002", "scores": [78, 88, 95]}
    ]
}
'''

course = json.loads(json_data)

# 访问嵌套JSON数据
print(f"课程名称: {course['name']}")
print(f"教师: {course['instructor']['name']}")
print(f"第一个学生的平均分: {sum(course['students'][0]['scores']) / len(course['students'][0]['scores'])}")
```

输出：
```
课程名称: Python课程
教师: 王教授
第一个学生的平均分: 89.0
```

### 2. 表示树状结构

嵌套字典可以用来表示树状结构，例如文件系统：

```python
# 模拟文件系统结构
file_system = {
    'root': {
        'documents': {
            'report.txt': {'size': 1024},
            'presentation.pptx': {'size': 2048}
        },
        'photos': {
            'vacation': {
                'beach.jpg': {'size': 3072},
                'mountain.jpg': {'size': 4096}
            }
        },
        'config.ini': {'size': 128}
    }
}

# 定义一个函数来计算文件夹大小
def calculate_size(folder):
    total_size = 0
    for name, content in folder.items():
        if 'size' in content:  # 这是一个文件
            total_size += content['size']
        else:  # 这是一个文件夹
            total_size += calculate_size(content)
    return total_size

# 计算照片文件夹的大小
photos_size = calculate_size(file_system['root']['photos'])
print(f"Photos文件夹的大小: {photos_size} bytes")
```

输出：
```
Photos文件夹的大小: 7168 bytes
```

### 3. 处理多维数据（矩阵计算）

使用嵌套列表处理矩阵运算：

```python
# 矩阵加法
def matrix_add(matrix_a, matrix_b):
    # 假设输入矩阵维度相同
    result = []
    for i in range(len(matrix_a)):
        row = []
        for j in range(len(matrix_a[0])):
            row.append(matrix_a[i][j] + matrix_b[i][j])
        result.append(row)
    return result

# 示例矩阵
matrix_a = [
    [1, 2, 3],
    [4, 5, 6]
]

matrix_b = [
    [7, 8, 9],
    [10, 11, 12]
]

# 计算矩阵加法
result = matrix_add(matrix_a, matrix_b)
print("矩阵加法结果:")
for row in result:
    print(row)
```

输出：
```
矩阵加法结果:
[8, 10, 12]
[14, 16, 18]
```

:::tip 数据可视化
嵌套的数据结构非常适合使用各种图表库（如matplotlib、seaborn）进行可视化处理，特别是对于多维数据和层次结构数据。
:::

## 嵌套数据结构的注意事项

### 1. 深拷贝和浅拷贝

当处理嵌套数据结构时，需要特别注意拷贝操作：

```python
import copy

# 原始嵌套列表
original = [[1, 2, 3], [4, 5, 6]]

# 浅拷贝
shallow_copy = original.copy()
shallow_copy[0][0] = 99  # 这会改变original中的值

# 深拷贝
deep_copy = copy.deepcopy(original)
deep_copy[0][0] = 100  # 这不会改变original中的值

print("原始列表:", original)
print("浅拷贝后:", shallow_copy)
print("深拷贝后:", deep_copy)
```

输出：
```
原始列表: [[99, 2, 3], [4, 5, 6]]
浅拷贝后: [[99, 2, 3], [4, 5, 6]]
深拷贝后: [[100, 2, 3], [4, 5, 6]]
```

### 2. 遍历时修改问题

在遍历嵌套结构时修改内容可能导致意外结果，应当小心：

```python
# 错误示例：遍历时修改
nested_list = [[1, 2], [3, 4], [5, 6]]
for sublist in nested_list[:]:  # 使用切片创建副本进行遍历
    if sublist[0] % 2 == 1:  # 对于首元素为奇数的子列表
        nested_list.remove(sublist)

print("修改后的列表:", nested_list)
```

### 3. 嵌套层次过深

嵌套过多层可能导致代码难以理解和维护，考虑重构数据结构或使用类来封装复杂数据。

```python
# 嵌套过深的例子（避免这样做）
deeply_nested = {'a': {'b': {'c': {'d': {'e': {'f': 1}}}}}}

# 更好的替代方式可能是使用类或扁平化数据结构
```

## 小结与实践

嵌套数据结构是Python处理复杂数据的强大工具。掌握嵌套数据结构能让你更有效地处理各种复杂数据问题，从Web API响应到多维数据分析。

关键点回顾：
- 嵌套数据结构允许你表示复杂的层次化数据
- 常见的嵌套包括：列表嵌套、字典嵌套、以及列表与字典的混合嵌套
- 访问嵌套数据使用连续的索引或键
- 遍历嵌套结构通常需要嵌套循环
- 处理嵌套结构时需注意深浅拷贝问题

### 实践练习

1. **学生成绩管理系统**：创建一个嵌套结构，表示多个班级的学生及其各科成绩。
2. **简易文件系统**：实现一个模拟文件系统的嵌套字典，并编写函数来"导航"和"操作"这个文件系统。
3. **购物车系统**：创建一个表示在线商店购物车的数据结构，包含多个用户及其购物车内容。

:::caution
处理复杂的嵌套数据结构时，代码可能会变得难以阅读。为了提高可维护性，考虑：
- 编写辅助函数来隐藏数据访问复杂性
- 使用有意义的变量名
- 添加清晰的注释
- 考虑使用类来封装复杂数据
:::

## 附加资源

- [Python官方文档 - 数据结构](https://docs.python.org/zh-cn/3/tutorial/datastructures.html)
- [Real Python - 数据结构教程](https://realpython.com/python-data-structures/)
- [Python数据结构与算法](https://www.programiz.com/dsa)

通过掌握Python数据结构的嵌套，你已经为处理各种复杂的实际编程问题打下了坚实的基础！