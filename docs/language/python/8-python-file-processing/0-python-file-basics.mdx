---
title: Python 文件基础
description: 学习Python文件操作的基础知识，包括文件的打开、读取、写入和关闭，以及文件路径处理和常见文件操作模式。
---

# Python 文件基础

在编程中，文件操作是非常重要的一部分。无论是读取配置文件、保存程序数据，还是处理日志信息，都需要与文件系统进行交互。Python提供了简单而强大的文件处理功能，让我们能够轻松地对文件进行各种操作。

## 什么是文件操作

文件操作主要包括以下几个步骤：
1. 打开文件
2. 读取或写入数据
3. 关闭文件

在Python中，这些操作都有对应的函数和方法。

## 文件的打开与关闭

### 使用 `open()` 函数打开文件

在Python中，我们使用内置的 `open()` 函数来打开文件。该函数返回一个文件对象，我们可以通过这个对象来读取或写入文件内容。

基本语法如下：

```python
file_object = open(file_name, mode)
```

参数说明：
- `file_name`: 要打开的文件名或路径
- `mode`: 文件打开模式，如读模式、写模式等

### 文件打开模式

Python支持多种文件打开模式：

| 模式 | 描述 |
|------|------|
| `'r'` | 读取模式（默认） |
| `'w'` | 写入模式（会覆盖已有内容） |
| `'a'` | 追加模式（在文件末尾添加内容） |
| `'x'` | 创建模式（如果文件已存在则失败） |
| `'b'` | 二进制模式（可与其他模式组合，如'rb', 'wb'） |
| `'t'` | 文本模式（默认，可与其他模式组合） |
| `'+'` | 读写模式（可与其他模式组合） |

### 使用 `close()` 方法关闭文件

打开文件后，我们需要在完成操作后关闭它，这是一个良好的编程习惯：

```python
file_object = open("example.txt", "r")
# 进行一些操作...
file_object.close()
```

### 使用 `with` 语句（推荐）

为了确保文件被正确关闭，即使发生异常，推荐使用 `with` 语句：

```python
with open("example.txt", "r") as file:
    # 文件操作代码
    content = file.read()
    print(content)
# 当代码块结束时，文件会自动关闭
```

:::tip
使用 `with` 语句是处理文件的最佳实践。它能确保文件被正确关闭，即使代码执行过程中出现了异常。
:::

## 文件读取操作

Python提供了多种读取文件内容的方法：

### 读取整个文件内容

```python
with open("example.txt", "r") as file:
    content = file.read()
    print(content)
```

### 按行读取

```python
with open("example.txt", "r") as file:
    for line in file:
        print(line, end='')  # 文件中已有换行符
```

### 读取所有行到列表

```python
with open("example.txt", "r") as file:
    lines = file.readlines()
    print(lines)  # 返回包含所有行的列表
```

### 读取特定数量的字符

```python
with open("example.txt", "r") as file:
    chunk = file.read(5)  # 读取前5个字符
    print(chunk)
```

## 文件写入操作

### 写入内容（覆盖原有内容）

```python
with open("example.txt", "w") as file:
    file.write("Hello, Python File Handling!\n")
    file.write("This is a new line.")
```

输出文件内容:
```
Hello, Python File Handling!
This is a new line.
```

### 追加内容

```python
with open("example.txt", "a") as file:
    file.write("\nThis line is appended.")
```

输出文件内容:
```
Hello, Python File Handling!
This is a new line.
This line is appended.
```

### 写入多行

```python
lines = ["First line\n", "Second line\n", "Third line\n"]
with open("example.txt", "w") as file:
    file.writelines(lines)
```

输出文件内容:
```
First line
Second line
Third line
```

## 文件路径处理

在处理文件路径时，Python的 `os` 和 `pathlib` 模块提供了很多有用的功能：

### 使用 `os` 模块

```python
import os

# 获取当前工作目录
current_dir = os.getcwd()
print(f"当前工作目录: {current_dir}")

# 拼接路径
file_path = os.path.join(current_dir, "data", "example.txt")
print(f"完整文件路径: {file_path}")

# 检查文件是否存在
if os.path.exists(file_path):
    print(f"文件 {file_path} 存在")
else:
    print(f"文件 {file_path} 不存在")
```

### 使用 `pathlib` 模块（Python 3.4+）

```python
from pathlib import Path

# 创建Path对象
data_dir = Path("data")
file_path = data_dir / "example.txt"

# 检查目录是否存在，不存在则创建
if not data_dir.exists():
    data_dir.mkdir()
    print(f"创建了目录: {data_dir}")

# 写入文件
file_path.write_text("Hello from pathlib!")
print(f"写入内容到: {file_path}")

# 读取文件
content = file_path.read_text()
print(f"文件内容: {content}")
```

:::note
`pathlib` 模块是Python 3.4引入的，它提供了一种更现代、更面向对象的文件路径处理方式。如果你使用的是较新版本的Python，推荐使用 `pathlib` 而非 `os.path`。
:::

## 文件操作的错误处理

文件操作可能会遇到各种错误，如文件不存在、权限问题等。我们可以使用异常处理来优雅地处理这些错误：

```python
try:
    with open("nonexistent_file.txt", "r") as file:
        content = file.read()
except FileNotFoundError:
    print("文件不存在！")
except PermissionError:
    print("没有权限访问该文件！")
except Exception as e:
    print(f"发生错误: {e}")
```

## 实际应用案例

### 案例1: 日志记录器

创建一个简单的日志记录器，将程序运行信息记录到文件中：

```python
import datetime

def log_message(message, log_file="app.log"):
    """记录消息到日志文件"""
    timestamp = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    log_entry = f"[{timestamp}] {message}\n"
    
    with open(log_file, "a") as file:
        file.write(log_entry)
    
    print(f"已记录: {message}")

# 使用日志记录器
log_message("程序启动")
log_message("执行任务A")
log_message("任务A完成")
log_message("程序结束")
```

### 案例2: 简单的文件备份工具

创建一个函数，用于备份文本文件：

```python
import os
import datetime

def backup_file(file_path):
    """创建文件的备份版本"""
    if not os.path.exists(file_path):
        print(f"错误: 文件 {file_path} 不存在")
        return False
    
    # 生成备份文件名
    timestamp = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
    base_name, extension = os.path.splitext(file_path)
    backup_path = f"{base_name}_{timestamp}{extension}"
    
    # 创建备份
    try:
        with open(file_path, 'r') as source_file:
            content = source_file.read()
            
        with open(backup_path, 'w') as backup_file:
            backup_file.write(content)
            
        print(f"成功备份 {file_path} 到 {backup_path}")
        return True
    except Exception as e:
        print(f"备份过程中出现错误: {e}")
        return False

# 使用备份工具
backup_file("important_data.txt")
```

### 案例3: CSV数据处理

读取和写入CSV文件的例子：

```python
import csv

# 写入CSV文件
def write_csv_example():
    data = [
        ['姓名', '年龄', '城市'],
        ['张三', 25, '北京'],
        ['李四', 30, '上海'],
        ['王五', 22, '广州']
    ]
    
    with open('users.csv', 'w', newline='') as file:
        writer = csv.writer(file)
        writer.writerows(data)
    
    print("CSV文件已创建并写入数据")

# 读取CSV文件
def read_csv_example():
    with open('users.csv', 'r') as file:
        reader = csv.reader(file)
        for row in reader:
            print(', '.join(row))

# 执行操作
write_csv_example()
print("\n读取CSV文件内容:")
read_csv_example()
```

## 文件操作的最佳实践

1. **始终使用 `with` 语句**：确保文件正确关闭
2. **使用相对路径或绝对路径**：明确指定文件位置
3. **添加错误处理**：优雅处理可能的异常
4. **使用适当的文件打开模式**：根据需要选择正确的模式
5. **处理大文件时分块读取**：避免一次性加载过大的文件内容
6. **检查文件是否存在**：在操作前验证文件状态
7. **使用合适的编码**：指定正确的文件编码，如 `open('file.txt', 'r', encoding='utf-8')`

## 总结

Python的文件操作功能强大而简洁。通过本教程，我们学习了：

- 如何打开和关闭文件
- 文件的读取方法
- 文件的写入方法
- 文件路径处理
- 错误处理机制
- 实际应用案例

掌握这些基础知识后，你可以更加自信地在Python程序中处理各种文件操作任务。无论是数据分析、配置管理还是日志处理，这些技能都将非常有用。

## 练习

1. 创建一个程序，读取一个文本文件并统计其中的行数、单词数和字符数。
2. 编写一个函数，将一个文件的内容复制到另一个文件中。
3. 创建一个简单的"待办事项"管理器，使用文件存储和读取待办事项列表。
4. 编写一个程序，读取一个CSV文件，并计算其中特定列的平均值。
5. 实现一个日记应用，允许用户添加日记条目，每个条目保存为单独的文件。

## 进一步学习资源

- Python官方文档中的[文件和目录访问](https://docs.python.org/3/library/filesys.html)章节
- Python的`pathlib`模块[官方文档](https://docs.python.org/3/library/pathlib.html)
- Python的`csv`模块[官方文档](https://docs.python.org/3/library/csv.html)，用于处理CSV文件
- Python的`json`模块[官方文档](https://docs.python.org/3/library/json.html)，用于处理JSON文件

通过不断练习和探索这些资源，你将能够掌握更多高级的文件处理技巧，处理各种复杂的文件操作需求。