---
title: Python 列表推导式
description: 学习Python列表推导式的概念、语法和应用，掌握这一强大的Python特性来简化代码并提高效率
---

# Python 列表推导式

列表推导式（List Comprehension）是Python中一种简洁而强大的创建列表的方式。它允许你用一行代码就能创建出复杂的列表，而不需要使用传统的循环结构。列表推导式不仅让代码更加简洁，还能在某些情况下提高程序的执行效率。

## 基本语法

列表推导式的基本语法如下：

```python
[表达式 for 变量 in 可迭代对象]
```

它等价于以下循环结构：

```python
result = []
for 变量 in 可迭代对象:
    result.append(表达式)
```

## 基本示例

让我们通过一些例子来理解列表推导式：

### 1. 创建平方数列表

使用传统的for循环：

```python
# 创建1到10的平方数列表
squares = []
for i in range(1, 11):
    squares.append(i * i)
    
print(squares)
```

输出：
```
[1, 4, 9, 16, 25, 36, 49, 64, 81, 100]
```

使用列表推导式：

```python
# 使用列表推导式创建同样的列表
squares = [i * i for i in range(1, 11)]
print(squares)
```

输出：
```
[1, 4, 9, 16, 25, 36, 49, 64, 81, 100]
```

:::tip
上面的列表推导式简单明了地表达了"对范围内的每个数字求平方并创建列表"的意图，使代码更加紧凑和可读。
:::

### 2. 从字符串列表提取字符长度

```python
# 获取每个单词的长度
words = ["Python", "is", "awesome", "and", "powerful"]
word_lengths = [len(word) for word in words]
print(word_lengths)
```

输出：
```
[6, 2, 7, 3, 8]
```

## 带条件的列表推导式

我们可以在列表推导式中添加条件过滤元素：

```python
[表达式 for 变量 in 可迭代对象 if 条件]
```

### 例子：获取偶数的平方

```python
# 只对1到10中的偶数进行平方
even_squares = [i * i for i in range(1, 11) if i % 2 == 0]
print(even_squares)
```

输出：
```
[4, 16, 36, 64, 100]
```

等价于：

```python
even_squares = []
for i in range(1, 11):
    if i % 2 == 0:
        even_squares.append(i * i)
```

## 多重循环的列表推导式

列表推导式也可以包含多个for循环：

```python
[表达式 for 变量1 in 可迭代对象1 for 变量2 in 可迭代对象2]
```

这等价于：

```python
result = []
for 变量1 in 可迭代对象1:
    for 变量2 in 可迭代对象2:
        result.append(表达式)
```

### 例子：笛卡尔积

```python
# 创建两个列表的所有可能组合
colors = ['红', '绿', '蓝']
sizes = ['小', '中', '大']

combinations = [(color, size) for color in colors for size in sizes]
print(combinations)
```

输出：
```
[('红', '小'), ('红', '中'), ('红', '大'), ('绿', '小'), ('绿', '中'), ('绿', '大'), ('蓝', '小'), ('蓝', '中'), ('蓝', '大')]
```

## 嵌套的列表推导式

列表推导式也可以嵌套使用，创建多维列表：

```python
# 创建3x3的单位矩阵
identity_matrix = [[1 if i == j else 0 for j in range(3)] for i in range(3)]
print(identity_matrix)
```

输出：
```
[[1, 0, 0], [0, 1, 0], [0, 0, 1]]
```

## 实际应用场景

### 1. 数据清洗和转换

```python
# 将字符串列表转换为整数列表，忽略非数字字符串
data = ["10", "20", "abc", "30", "40", "xyz"]
numbers = [int(item) for item in data if item.isdigit()]
print(numbers)
```

输出：
```
[10, 20, 30, 40]
```

### 2. 提取文件扩展名

```python
# 从文件路径列表中提取所有的.py文件
files = ["script.py", "document.docx", "image.jpg", "code.py", "notes.txt"]
python_files = [file for file in files if file.endswith(".py")]
print(python_files)
```

输出：
```
['script.py', 'code.py']
```

### 3. 数据分析和处理

```python
# 计算列表中所有大于0的数的平方和
data = [3, -2, 5, 0, -8, 4, -6]
sum_of_squares = sum(x**2 for x in data if x > 0)
print(sum_of_squares)
```

输出：
```
50
```

:::note
注意上面的例子使用了生成器表达式（没有使用方括号）。当我们只需要遍历一次结果时，这比列表推导式更高效。
:::

## 列表推导式的性能优势

列表推导式不仅使代码更简洁，在多数情况下还比等效的for循环更高效。这是因为：

1. 列表推导式在Python内部进行了优化
2. 避免了多次调用`append()`方法的开销
3. 减少了Python解释器的工作量

### 性能比较

```python
import time

# 使用for循环
start = time.time()
squares1 = []
for i in range(1000000):
    squares1.append(i * i)
end = time.time()
print(f"For循环耗时: {end - start:.6f}秒")

# 使用列表推导式
start = time.time()
squares2 = [i * i for i in range(1000000)]
end = time.time()
print(f"列表推导式耗时: {end - start:.6f}秒")
```

在大多数情况下，列表推导式的执行速度会略快于传统的循环方法。

## 使用建议和最佳实践

1. **简洁为主**: 列表推导式应该简洁明了。如果表达式变得过于复杂，考虑使用传统的for循环。

2. **避免副作用**: 列表推导式主要用于创建新列表，不应该执行有副作用的操作。

3. **适度使用**: 不是所有循环都适合转换为列表推导式。当逻辑复杂时，常规循环可能更清晰。

4. **注意可读性**: 如果列表推导式使代码难以理解，那就违背了它的初衷。

:::caution
过度使用列表推导式，特别是多层嵌套的情况，会降低代码的可读性。始终优先考虑代码的清晰度而不是简洁性。
:::

## 列表推导式与其他推导式

Python中还有其他类型的推导式：

1. **字典推导式**：使用`{key: value for item in iterable}`语法
2. **集合推导式**：使用`{expression for item in iterable}`语法
3. **生成器表达式**：使用`(expression for item in iterable)`语法

```python
# 字典推导式示例
word_length = {word: len(word) for word in ["Python", "is", "fun"]}
print(word_length)  # {'Python': 6, 'is': 2, 'fun': 3}

# 集合推导式示例
unique_lengths = {len(word) for word in ["hello", "world", "python", "code"]}
print(unique_lengths)  # {5, 4, 6}
```

## 总结

列表推导式是Python的一个强大特性，能够以简洁的方式创建列表。它的主要优点包括：

1. 代码更简洁、更易读
2. 执行效率通常更高
3. 表达意图更加清晰

掌握列表推导式对于编写高效、简洁的Python代码至关重要，是从初学者进阶到中级Python程序员的重要一步。

## 练习

为了巩固所学知识，尝试以下练习：

1. 使用列表推导式创建一个包含1到100之间所有3的倍数的列表。
2. 将一个字符串列表转换为包含每个字符串长度的列表，但只包括长度大于3的字符串。
3. 创建一个二维列表，表示5x5的乘法表。
4. 使用列表推导式从一个包含正负数的列表中筛选出所有正数，并计算它们的平方根。
5. 从一个句子中提取所有长度为4的单词，并将它们转换为大写。

## 额外资源

要深入学习列表推导式和Python其他高级特性，可以参考以下资源：

- Python官方文档中关于列表推导式的章节
- 《Python Cookbook》第1章：数据结构和算法
- 《Effective Python》中有关列表推导式的条目
- Python在线社区如Stack Overflow上的相关讨论

通过多练习和深入理解，你将能够熟练掌握这一强大的Python特性！