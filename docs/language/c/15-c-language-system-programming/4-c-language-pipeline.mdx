---
title: C 语言管道
description: 了解C语言中的管道（Pipe）概念及其在进程间通信中的应用。本文适合初学者，包含代码示例、实际案例和总结。
---

## 介绍

在C语言中，**管道（Pipe）**是一种用于进程间通信（IPC, Inter-Process Communication）的机制。它允许一个进程将数据发送给另一个进程，通常用于父子进程之间的通信。管道是一种单向通信方式，数据只能从一个方向流动：从写端到读端。

管道在Unix-like系统中非常常见，通常用于将一个进程的输出作为另一个进程的输入。例如，在命令行中，你可以使用管道将 `ls` 命令的输出传递给 `grep` 命令进行过滤。

## 管道的创建与使用

在C语言中，管道是通过 `pipe()` 系统调用创建的。`pipe()` 函数会创建一个管道，并返回两个文件描述符：一个用于读取数据，另一个用于写入数据。

### `pipe()` 函数原型

```c
#include <unistd.h>

int pipe(int pipefd[2]);
```

- `pipefd` 是一个包含两个整数的数组。
  - `pipefd[0]` 是管道的读端。
  - `pipefd[1]` 是管道的写端。

### 示例代码

以下是一个简单的示例，展示了如何使用管道在父子进程之间传递数据。

```c
#include <stdio.h>
#include <unistd.h>
#include <string.h>

int main() {
    int pipefd[2];
    char buffer[100];
    pid_t pid;

    // 创建管道
    if (pipe(pipefd) == -1) {
        perror("pipe");
        return 1;
    }

    // 创建子进程
    pid = fork();
    if (pid == -1) {
        perror("fork");
        return 1;
    }

    if (pid == 0) {  // 子进程
        close(pipefd[1]);  // 关闭写端
        read(pipefd[0], buffer, sizeof(buffer));
        printf("Child received: %s\n", buffer);
        close(pipefd[0]);
    } else {  // 父进程
        close(pipefd[0]);  // 关闭读端
        const char *message = "Hello from parent!";
        write(pipefd[1], message, strlen(message) + 1);
        close(pipefd[1]);
    }

    return 0;
}
```

### 代码解释

1. **创建管道**：`pipe(pipefd)` 创建了一个管道，并将文件描述符存储在 `pipefd` 数组中。
2. **创建子进程**：`fork()` 创建了一个子进程。子进程会继承父进程的文件描述符，包括管道的文件描述符。
3. **关闭不需要的文件描述符**：在子进程中，关闭了写端 `pipefd[1]`，因为子进程只需要读取数据。在父进程中，关闭了读端 `pipefd[0]`，因为父进程只需要写入数据。
4. **读写数据**：父进程通过 `write()` 将数据写入管道，子进程通过 `read()` 从管道中读取数据。

### 输出

运行上述代码后，输出将如下所示：

```
Child received: Hello from parent!
```

## 实际应用场景

管道在实际应用中有很多用途，特别是在需要将多个命令或进程串联起来时。以下是一些常见的应用场景：

1. **命令行管道**：在Unix-like系统中，命令行工具经常使用管道来传递数据。例如，`ls | grep .txt` 会将 `ls` 的输出传递给 `grep`，以过滤出包含 `.txt` 的文件。
2. **进程间通信**：在多进程程序中，管道可以用于父子进程之间的通信。例如，一个进程可以生成数据，而另一个进程可以处理这些数据。
3. **数据流处理**：在数据处理任务中，管道可以用于将数据从一个处理阶段传递到另一个处理阶段。

## 总结

管道是C语言中一种强大的进程间通信机制，特别适用于父子进程之间的单向数据传输。通过 `pipe()` 系统调用，我们可以轻松创建管道，并使用 `read()` 和 `write()` 函数在进程之间传递数据。

在实际应用中，管道常用于命令行工具和数据处理任务中。掌握管道的使用，可以帮助你编写更高效、更灵活的多进程程序。

## 附加资源与练习

- **练习**：尝试修改上面的代码，使子进程向父进程发送消息，父进程接收并打印消息。
- **进一步学习**：了解命名管道（FIFO）的概念，并尝试在C语言中使用它们。
- **参考文档**：查阅 `pipe()`、`fork()`、`read()` 和 `write()` 的官方文档，深入了解它们的用法和参数。

:::tip
如果你对进程间通信感兴趣，可以进一步学习信号（Signal）、共享内存（Shared Memory）和消息队列（Message Queue）等其他IPC机制。
:::