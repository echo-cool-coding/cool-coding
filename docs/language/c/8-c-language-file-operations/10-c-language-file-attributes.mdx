---
title: C 语言文件属性
description: 了解C语言中如何获取和操作文件属性，包括文件大小、权限、创建时间等信息。本文适合初学者，包含代码示例和实际应用场景。
---

# C 语言文件属性

在C语言中，文件操作不仅仅是读写文件内容，还包括获取和操作文件的属性。文件属性是指与文件相关的元数据，例如文件大小、权限、创建时间、修改时间等。了解如何获取和操作这些属性对于文件管理和系统编程非常重要。

## 文件属性的基本概念

文件属性是描述文件状态的信息，通常存储在操作系统的文件系统中。在C语言中，我们可以使用标准库函数来获取这些属性。常见的文件属性包括：

- **文件大小**：文件占用的字节数。
- **文件权限**：文件的读、写、执行权限。
- **文件类型**：文件是普通文件、目录还是符号链接等。
- **创建时间、修改时间、访问时间**：文件的时间戳信息。

## 获取文件属性

在C语言中，获取文件属性的常用方法是使用 `stat` 函数。`stat` 函数可以获取文件的详细信息，并将其存储在一个 `struct stat` 结构体中。

### `stat` 结构体

`struct stat` 结构体定义在 `<sys/stat.h>` 头文件中，包含以下主要成员：

- `st_size`：文件大小（字节数）。
- `st_mode`：文件类型和权限。
- `st_atime`：文件最后一次访问时间。
- `st_mtime`：文件最后一次修改时间。
- `st_ctime`：文件状态最后一次改变的时间。

### 使用 `stat` 函数

以下是一个简单的示例，展示如何使用 `stat` 函数获取文件属性：

```c
#include <stdio.h>
#include <sys/stat.h>
#include <time.h>

int main() {
    struct stat fileStat;

    if (stat("example.txt", &fileStat) < 0) {
        perror("stat");
        return 1;
    }

    printf("文件大小: %ld 字节\n", fileStat.st_size);
    printf("文件权限: %o\n", fileStat.st_mode & 0777);
    printf("最后访问时间: %s", ctime(&fileStat.st_atime));
    printf("最后修改时间: %s", ctime(&fileStat.st_mtime));
    printf("最后状态改变时间: %s", ctime(&fileStat.st_ctime));

    return 0;
}
```

### 代码解释

1. `stat("example.txt", &fileStat)`：获取 `example.txt` 文件的属性，并存储在 `fileStat` 结构体中。
2. `fileStat.st_size`：获取文件大小。
3. `fileStat.st_mode & 0777`：获取文件权限（八进制表示）。
4. `ctime(&fileStat.st_atime)`：将时间戳转换为可读的字符串格式。

### 输出示例

假设 `example.txt` 文件存在，程序可能输出如下内容：

```
文件大小: 1024 字节
文件权限: 644
最后访问时间: Mon Oct  2 12:34:56 2023
最后修改时间: Mon Oct  1 10:20:30 2023
最后状态改变时间: Mon Oct  1 10:20:30 2023
```

## 实际应用场景

### 1. 检查文件是否存在

在程序中，我们经常需要检查某个文件是否存在。可以使用 `stat` 函数来实现：

```c
#include <stdio.h>
#include <sys/stat.h>

int fileExists(const char *filename) {
    struct stat buffer;
    return (stat(filename, &buffer) == 0);
}

int main() {
    if (fileExists("example.txt")) {
        printf("文件存在\n");
    } else {
        printf("文件不存在\n");
    }
    return 0;
}
```

### 2. 检查文件权限

在某些情况下，我们需要检查文件是否具有特定的权限。例如，检查文件是否可读：

```c
#include <stdio.h>
#include <sys/stat.h>

int isReadable(const char *filename) {
    struct stat buffer;
    if (stat(filename, &buffer) < 0) {
        return 0;
    }
    return (buffer.st_mode & S_IRUSR);
}

int main() {
    if (isReadable("example.txt")) {
        printf("文件可读\n");
    } else {
        printf("文件不可读\n");
    }
    return 0;
}
```

## 总结

通过本文，我们学习了如何在C语言中获取和操作文件属性。我们使用了 `stat` 函数来获取文件的详细信息，并通过实际示例展示了如何检查文件是否存在以及文件权限。掌握这些知识对于文件管理和系统编程非常重要。

## 附加资源

- [GNU C Library: File Attributes](https://www.gnu.org/software/libc/manual/html_node/File-Attributes.html)
- [Linux man page for stat(2)](https://man7.org/linux/man-pages/man2/stat.2.html)

## 练习

1. 编写一个程序，列出当前目录下所有文件的大小和最后修改时间。
2. 修改上述程序，使其只列出大于1MB的文件。
3. 编写一个程序，检查当前用户是否有权限写入指定文件。

通过完成这些练习，你将更深入地理解C语言中的文件属性操作。