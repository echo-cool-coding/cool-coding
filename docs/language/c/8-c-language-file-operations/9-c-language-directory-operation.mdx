---
title: C 语言目录操作
description: 学习如何在C语言中进行目录操作，包括创建、删除、遍历目录等基本操作。本文适合初学者，包含代码示例和实际应用场景。
---

## 介绍

在C语言中，文件操作不仅仅局限于对单个文件的读写，还包括对目录的操作。目录操作是文件系统管理的重要组成部分，它允许我们创建、删除、遍历目录，以及获取目录中的文件列表。掌握这些操作对于编写文件管理工具或处理大量文件的程序至关重要。

本文将详细介绍如何在C语言中进行目录操作，并通过代码示例和实际案例帮助你理解这些概念。

## 目录操作的基本概念

在C语言中，目录操作主要通过标准库函数来实现。这些函数通常定义在 `<dirent.h>` 和 `<sys/stat.h>` 头文件中。以下是一些常用的目录操作函数：

- `mkdir()`：创建目录
- `rmdir()`：删除目录
- `opendir()`：打开目录
- `readdir()`：读取目录中的文件
- `closedir()`：关闭目录

## 创建目录

使用 `mkdir()` 函数可以创建一个新的目录。该函数的原型如下：

```c
int mkdir(const char *pathname, mode_t mode);
```

- `pathname`：要创建的目录的路径。
- `mode`：目录的权限模式，通常使用 `0777` 表示最大权限。

### 示例代码

```c
#include <sys/stat.h>
#include <stdio.h>

int main() {
    const char *dir_name = "new_directory";
    
    if (mkdir(dir_name, 0777) == 0) {
        printf("目录 '%s' 创建成功\n", dir_name);
    } else {
        perror("创建目录失败");
    }
    
    return 0;
}
```

### 输出

```
目录 'new_directory' 创建成功
```

:::note
在Windows系统上，`mkdir()` 函数的 `mode` 参数会被忽略，因此你可以直接传递 `0` 作为参数。
:::

## 删除目录

使用 `rmdir()` 函数可以删除一个空目录。该函数的原型如下：

```c
int rmdir(const char *pathname);
```

- `pathname`：要删除的目录的路径。

### 示例代码

```c
#include <unistd.h>
#include <stdio.h>

int main() {
    const char *dir_name = "new_directory";
    
    if (rmdir(dir_name) == 0) {
        printf("目录 '%s' 删除成功\n", dir_name);
    } else {
        perror("删除目录失败");
    }
    
    return 0;
}
```

### 输出

```
目录 'new_directory' 删除成功
```

:::caution
`rmdir()` 只能删除空目录。如果目录中包含文件或其他子目录，删除操作将失败。
:::

## 遍历目录

使用 `opendir()`、`readdir()` 和 `closedir()` 函数可以遍历目录中的文件。这些函数的原型如下：

```c
DIR *opendir(const char *name);
struct dirent *readdir(DIR *dirp);
int closedir(DIR *dirp);
```

- `opendir()`：打开一个目录，返回一个指向 `DIR` 结构的指针。
- `readdir()`：读取目录中的下一个文件，返回一个指向 `dirent` 结构的指针。
- `closedir()`：关闭目录。

### 示例代码

```c
#include <dirent.h>
#include <stdio.h>

int main() {
    const char *dir_name = ".";
    DIR *dir;
    struct dirent *entry;

    dir = opendir(dir_name);
    if (dir == NULL) {
        perror("无法打开目录");
        return 1;
    }

    while ((entry = readdir(dir)) != NULL) {
        printf("%s\n", entry->d_name);
    }

    closedir(dir);
    return 0;
}
```

### 输出

```
.
..
file1.txt
file2.txt
new_directory
```

:::tip
`readdir()` 返回的 `dirent` 结构中的 `d_name` 字段包含了文件的名称。你可以使用这个字段来获取目录中的文件列表。
:::

## 实际应用场景

### 场景：批量重命名目录中的文件

假设你有一个包含多个文件的目录，你需要将这些文件批量重命名为 `file1.txt`, `file2.txt`, `file3.txt` 等。你可以使用目录遍历和文件操作函数来实现这个功能。

```c
#include <dirent.h>
#include <stdio.h>
#include <string.h>
#include <sys/stat.h>
#include <unistd.h>

int main() {
    const char *dir_name = ".";
    DIR *dir;
    struct dirent *entry;
    int count = 1;

    dir = opendir(dir_name);
    if (dir == NULL) {
        perror("无法打开目录");
        return 1;
    }

    while ((entry = readdir(dir)) != NULL) {
        if (entry->d_type == DT_REG) { // 只处理普通文件
            char old_name[256];
            char new_name[256];
            snprintf(old_name, sizeof(old_name), "%s/%s", dir_name, entry->d_name);
            snprintf(new_name, sizeof(new_name), "%s/file%d.txt", dir_name, count++);
            
            if (rename(old_name, new_name) == 0) {
                printf("重命名 '%s' 为 '%s'\n", old_name, new_name);
            } else {
                perror("重命名失败");
            }
        }
    }

    closedir(dir);
    return 0;
}
```

### 输出

```
重命名 './old_file1.txt' 为 './file1.txt'
重命名 './old_file2.txt' 为 './file2.txt'
```

:::warning
在实际应用中，确保在重命名文件之前备份重要数据，以避免意外丢失。
:::

## 总结

本文介绍了C语言中的目录操作，包括创建、删除和遍历目录。通过这些操作，你可以编写出功能强大的文件管理工具。我们还通过一个实际应用场景展示了如何批量重命名目录中的文件。

## 附加资源与练习

- **练习1**：编写一个程序，统计指定目录中的文件数量。
- **练习2**：编写一个程序，递归遍历目录及其子目录，并列出所有文件的路径。
- **附加资源**：阅读 `man` 手册页，了解更多关于 `mkdir()`, `rmdir()`, `opendir()`, `readdir()`, 和 `closedir()` 的详细信息。

通过不断练习和探索，你将能够熟练掌握C语言中的目录操作，并应用于实际项目中。