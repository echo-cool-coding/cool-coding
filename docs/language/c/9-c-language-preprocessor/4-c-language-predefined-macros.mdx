---
title: C 语言预定义宏
description: 了解C语言中的预定义宏，掌握其用途和常见示例，帮助你在编程中更高效地使用这些宏。
---

# C 语言预定义宏

在C语言中，预处理器是一个强大的工具，它允许你在编译之前对代码进行一些操作。预定义宏是预处理器提供的一组特殊宏，它们在编译时自动定义，并且可以在代码中直接使用。这些宏通常用于获取编译环境的信息、调试代码或实现跨平台兼容性。

## 什么是预定义宏？

预定义宏是由C语言标准或编译器预先定义的宏。它们通常以双下划线开头和结尾（例如 `__FILE__`），并且不需要你在代码中显式定义。这些宏提供了关于编译环境、编译器、操作系统等信息，可以帮助你编写更具可移植性和可维护性的代码。

## 常见的预定义宏

以下是一些常见的预定义宏及其用途：

### 1. `__FILE__`
`__FILE__` 宏展开为当前源文件的文件名（字符串形式）。它通常用于调试，以确定代码在哪个文件中执行。

```c
#include <stdio.h>

int main() {
    printf("当前文件: %s\n", __FILE__);
    return 0;
}
```

**输出：**
```
当前文件: example.c
```

### 2. `__LINE__`
`__LINE__` 宏展开为当前代码行的行号（整数形式）。它常用于调试，以确定代码执行到哪一行。

```c
#include <stdio.h>

int main() {
    printf("当前行号: %d\n", __LINE__);
    return 0;
}
```

**输出：**
```
当前行号: 5
```

### 3. `__DATE__`
`__DATE__` 宏展开为编译日期（字符串形式），格式为 `"MMM DD YYYY"`。

```c
#include <stdio.h>

int main() {
    printf("编译日期: %s\n", __DATE__);
    return 0;
}
```

**输出：**
```
编译日期: Oct 10 2023
```

### 4. `__TIME__`
`__TIME__` 宏展开为编译时间（字符串形式），格式为 `"HH:MM:SS"`。

```c
#include <stdio.h>

int main() {
    printf("编译时间: %s\n", __TIME__);
    return 0;
}
```

**输出：**
```
编译时间: 14:30:00
```

### 5. `__STDC__`
`__STDC__` 宏用于检查编译器是否符合C标准。如果编译器符合标准，则 `__STDC__` 展开为 `1`，否则未定义。

```c
#include <stdio.h>

int main() {
    #ifdef __STDC__
        printf("编译器符合C标准\n");
    #else
        printf("编译器不符合C标准\n");
    #endif
    return 0;
}
```

**输出：**
```
编译器符合C标准
```

### 6. `__cplusplus`
`__cplusplus` 宏用于检查代码是否在C++编译器下编译。如果代码在C++编译器下编译，则 `__cplusplus` 展开为一个表示C++版本的值。

```c
#include <stdio.h>

int main() {
    #ifdef __cplusplus
        printf("正在使用C++编译器\n");
    #else
        printf("正在使用C编译器\n");
    #endif
    return 0;
}
```

**输出：**
```
正在使用C编译器
```

## 实际应用场景

### 调试信息
预定义宏在调试时非常有用。例如，你可以使用 `__FILE__` 和 `__LINE__` 来打印出错误发生的文件和行号。

```c
#include <stdio.h>

#define LOG_ERROR(message) \
    printf("错误: %s\n文件: %s\n行号: %d\n", message, __FILE__, __LINE__)

int main() {
    if (1 != 2) {
        LOG_ERROR("1不等于2");
    }
    return 0;
}
```

**输出：**
```
错误: 1不等于2
文件: example.c
行号: 8
```

### 跨平台兼容性
预定义宏还可以用于编写跨平台代码。例如，你可以使用 `__WIN32__` 或 `__linux__` 来检测操作系统，并根据不同的操作系统执行不同的代码。

```c
#include <stdio.h>

int main() {
    #ifdef __WIN32__
        printf("运行在Windows系统上\n");
    #elif __linux__
        printf("运行在Linux系统上\n");
    #else
        printf("运行在未知系统上\n");
    #endif
    return 0;
}
```

**输出：**
```
运行在Linux系统上
```

## 总结

C语言中的预定义宏提供了一种强大的方式来获取编译环境的信息、调试代码以及实现跨平台兼容性。通过使用这些宏，你可以编写更具可移植性和可维护性的代码。

:::tip
**小提示**：在使用预定义宏时，确保你了解它们的含义和用途，以避免在代码中引入不必要的复杂性。
:::

## 附加资源

- [C语言标准库文档](https://en.cppreference.com/w/c)
- [GCC预定义宏文档](https://gcc.gnu.org/onlinedocs/cpp/Predefined-Macros.html)

## 练习

1. 编写一个程序，使用 `__DATE__` 和 `__TIME__` 宏打印出编译日期和时间。
2. 修改上面的调试信息示例，使其在打印错误信息时同时打印出编译日期和时间。
3. 尝试在不同的操作系统上编译跨平台兼容性示例，并观察输出结果。

通过完成这些练习，你将更好地理解预定义宏的用途和应用场景。