---
title: C 语言复合字面量
description: 了解C语言中的复合字面量，掌握其语法、用法以及实际应用场景。适合初学者快速上手的高级特性。
---

## 介绍

在C语言中，**复合字面量**（Compound Literals）是一种允许你在代码中直接创建匿名数组、结构体或联合体的语法特性。它提供了一种简洁的方式来初始化复杂的数据结构，而无需显式地定义一个变量。

复合字面量的语法类似于类型转换，但它的结果是一个临时的、匿名的对象，可以直接用于表达式或函数参数中。这个特性在C99标准中被引入，是C语言中非常实用的高级特性之一。

## 基本语法

复合字面量的基本语法如下：

```c
(type) { initializer-list }
```

- `type`：表示你想要创建的数据类型，例如数组、结构体或联合体。
- `initializer-list`：用于初始化该类型的数据。

### 示例：数组的复合字面量

```c
int *arr = (int[]){1, 2, 3, 4, 5};
```

在这个例子中，`(int[]){1, 2, 3, 4, 5}` 创建了一个匿名的整数数组，并将其地址赋值给指针 `arr`。这个数组的生命周期与普通局部变量相同，会在当前作用域结束时被销毁。

### 示例：结构体的复合字面量

```c
struct Point {
    int x;
    int y;
};

struct Point p = (struct Point){10, 20};
```

这里，`(struct Point){10, 20}` 创建了一个匿名的 `Point` 结构体，并将其赋值给变量 `p`。结构体的成员 `x` 和 `y` 分别被初始化为 `10` 和 `20`。

## 复合字面量的生命周期

复合字面量的生命周期取决于它的使用场景：

1. **局部作用域**：如果复合字面量在函数内部使用，它的生命周期与局部变量相同，会在函数返回时被销毁。
2. **全局作用域**：如果复合字面量在全局作用域中使用，它的生命周期与程序的生命周期相同。

:::caution
注意：复合字面量创建的临时对象是匿名的，因此不能直接引用它。如果需要多次使用，建议将其赋值给一个变量。
:::

## 实际应用场景

### 1. 函数参数传递

复合字面量非常适合用于函数参数的传递，尤其是当函数需要一个复杂的结构体或数组时。

```c
void printPoint(struct Point p) {
    printf("Point: (%d, %d)\n", p.x, p.y);
}

int main() {
    printPoint((struct Point){5, 10});
    return 0;
}
```

在这个例子中，`printPoint` 函数接受一个 `Point` 结构体作为参数。通过使用复合字面量，我们可以直接在函数调用中创建一个临时的 `Point` 结构体。

### 2. 初始化复杂数据结构

复合字面量可以用于初始化复杂的数据结构，例如嵌套的结构体或数组。

```c
struct Rectangle {
    struct Point topLeft;
    struct Point bottomRight;
};

struct Rectangle rect = (struct Rectangle){
    {0, 10},
    {20, 0}
};
```

这里，我们使用复合字面量初始化了一个 `Rectangle` 结构体，其中包含了两个 `Point` 结构体。

### 3. 动态数组初始化

复合字面量还可以用于动态数组的初始化，尤其是在需要传递数组给函数时。

```c
void printArray(int *arr, int size) {
    for (int i = 0; i < size; i++) {
        printf("%d ", arr[i]);
    }
    printf("\n");
}

int main() {
    printArray((int[]){1, 2, 3, 4, 5}, 5);
    return 0;
}
```

在这个例子中，`printArray` 函数接受一个整数数组和数组的大小作为参数。通过使用复合字面量，我们可以直接在函数调用中创建一个临时的数组。

## 总结

复合字面量是C语言中一个非常强大的特性，它允许你在代码中直接创建匿名的数组、结构体或联合体。通过使用复合字面量，你可以简化代码，减少不必要的变量定义，并提高代码的可读性。

:::tip
建议在实际编程中多尝试使用复合字面量，尤其是在需要传递复杂数据结构或初始化数组时。它可以帮助你写出更简洁、更高效的代码。
:::

## 附加资源与练习

1. **练习**：尝试使用复合字面量初始化一个包含多个结构体的数组，并编写一个函数来打印这些结构体的内容。
2. **进一步阅读**：查阅C99标准文档，了解更多关于复合字面量的细节和限制。

通过掌握复合字面量，你将能够更好地利用C语言的高级特性，编写出更加灵活和高效的代码。