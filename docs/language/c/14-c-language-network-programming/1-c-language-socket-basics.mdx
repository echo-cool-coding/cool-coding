---
title: C 语言套接字基础
description: 学习C语言网络编程的基础知识，掌握套接字（Socket）的概念、使用方法以及实际应用场景。
---

## 介绍

在网络编程中，**套接字（Socket）** 是用于实现网络通信的核心工具。它允许不同计算机之间的进程通过网络进行数据交换。无论是构建简单的客户端-服务器应用程序，还是实现复杂的分布式系统，套接字都是不可或缺的。

在C语言中，套接字编程主要通过一组系统调用（如 `socket()`、`bind()`、`listen()`、`accept()`、`connect()` 等）来实现。本文将逐步介绍这些基础概念，并通过代码示例帮助你理解如何使用C语言进行网络编程。

---

## 什么是套接字？

套接字是网络通信的端点，可以看作是两个程序之间通信的桥梁。它支持多种协议，最常见的是 **TCP（传输控制协议）** 和 **UDP（用户数据报协议）**。

- **TCP**：提供可靠的、面向连接的通信，确保数据按顺序到达。
- **UDP**：提供无连接的通信，速度快但不保证可靠性。

套接字通常分为两种类型：
1. **流套接字（Stream Socket）**：用于TCP通信。
2. **数据报套接字（Datagram Socket）**：用于UDP通信。

---

## 套接字的基本操作

以下是套接字编程的基本步骤：

1. **创建套接字**：使用 `socket()` 函数创建一个套接字。
2. **绑定地址**：使用 `bind()` 函数将套接字与本地地址绑定。
3. **监听连接**（仅服务器端）：使用 `listen()` 函数监听客户端连接。
4. **接受连接**（仅服务器端）：使用 `accept()` 函数接受客户端连接。
5. **连接服务器**（仅客户端）：使用 `connect()` 函数连接到服务器。
6. **发送和接收数据**：使用 `send()` 和 `recv()` 函数进行数据传输。
7. **关闭套接字**：使用 `close()` 函数关闭套接字。

---

## 代码示例：简单的TCP服务器和客户端

### TCP服务器

以下是一个简单的TCP服务器代码示例：

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>

#define PORT 8080
#define BUFFER_SIZE 1024

int main() {
    int server_fd, new_socket;
    struct sockaddr_in address;
    int addrlen = sizeof(address);
    char buffer[BUFFER_SIZE] = {0};
    char *response = "Hello from server";

    // 创建套接字
    if ((server_fd = socket(AF_INET, SOCK_STREAM, 0)) == 0) {
        perror("Socket failed");
        exit(EXIT_FAILURE);
    }

    // 绑定地址
    address.sin_family = AF_INET;
    address.sin_addr.s_addr = INADDR_ANY;
    address.sin_port = htons(PORT);
    if (bind(server_fd, (struct sockaddr *)&address, sizeof(address)) < 0) {
        perror("Bind failed");
        close(server_fd);
        exit(EXIT_FAILURE);
    }

    // 监听连接
    if (listen(server_fd, 3) < 0) {
        perror("Listen failed");
        close(server_fd);
        exit(EXIT_FAILURE);
    }

    // 接受连接
    if ((new_socket = accept(server_fd, (struct sockaddr *)&address, (socklen_t*)&addrlen)) < 0) {
        perror("Accept failed");
        close(server_fd);
        exit(EXIT_FAILURE);
    }

    // 接收数据
    read(new_socket, buffer, BUFFER_SIZE);
    printf("Client says: %s\n", buffer);

    // 发送响应
    send(new_socket, response, strlen(response), 0);
    printf("Response sent\n");

    // 关闭套接字
    close(new_socket);
    close(server_fd);
    return 0;
}
```

### TCP客户端

以下是一个简单的TCP客户端代码示例：

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>

#define PORT 8080
#define BUFFER_SIZE 1024

int main() {
    int sock = 0;
    struct sockaddr_in serv_addr;
    char *message = "Hello from client";
    char buffer[BUFFER_SIZE] = {0};

    // 创建套接字
    if ((sock = socket(AF_INET, SOCK_STREAM, 0)) < 0) {
        printf("\n Socket creation error \n");
        return -1;
    }

    // 设置服务器地址
    serv_addr.sin_family = AF_INET;
    serv_addr.sin_port = htons(PORT);
    if (inet_pton(AF_INET, "127.0.0.1", &serv_addr.sin_addr) <= 0) {
        printf("\nInvalid address/ Address not supported \n");
        return -1;
    }

    // 连接服务器
    if (connect(sock, (struct sockaddr *)&serv_addr, sizeof(serv_addr)) < 0) {
        printf("\nConnection Failed \n");
        return -1;
    }

    // 发送数据
    send(sock, message, strlen(message), 0);
    printf("Message sent\n");

    // 接收响应
    read(sock, buffer, BUFFER_SIZE);
    printf("Server says: %s\n", buffer);

    // 关闭套接字
    close(sock);
    return 0;
}
```

---

## 实际应用场景

套接字编程广泛应用于以下场景：
1. **Web服务器**：处理HTTP请求和响应。
2. **聊天应用程序**：实现实时消息传递。
3. **文件传输**：通过FTP或自定义协议传输文件。
4. **在线游戏**：实现多玩家之间的实时通信。

---

## 总结

通过本文，你已经了解了C语言套接字编程的基础知识，包括套接字的概念、基本操作以及如何编写简单的TCP服务器和客户端程序。套接字是网络编程的核心工具，掌握它将为你打开网络开发的大门。

---

## 附加资源与练习

- **练习**：尝试修改上述代码，实现一个UDP服务器和客户端。
- **推荐阅读**：
  - 《UNIX网络编程》 by W. Richard Stevens
  - Beej's Guide to Network Programming（在线资源）

:::tip
如果你对套接字编程有任何疑问，欢迎在评论区留言，我们会尽快为你解答！
:::