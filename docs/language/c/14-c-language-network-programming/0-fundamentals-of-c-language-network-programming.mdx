---
title: C 语言网络编程基础
description: 本文介绍了C语言网络编程的基础知识，包括套接字、TCP/IP协议、客户端-服务器模型等内容，适合初学者学习。
---

# C 语言网络编程基础

## 介绍

网络编程是指通过计算机网络实现数据交换的编程技术。C语言作为一种高效、灵活的编程语言，广泛应用于网络编程领域。通过C语言，我们可以创建客户端和服务器程序，实现数据的传输和通信。

在本文中，我们将从基础概念开始，逐步讲解如何使用C语言进行网络编程。我们将涵盖套接字（Socket）、TCP/IP协议、客户端-服务器模型等核心内容，并通过代码示例和实际案例帮助你理解这些概念。

## 套接字（Socket）

套接字是网络编程的核心概念之一。它是网络通信的端点，允许程序通过网络发送和接收数据。在C语言中，套接字通过`<sys/socket.h>`头文件中的函数进行操作。

### 套接字类型

常见的套接字类型包括：

- **流套接字（SOCK_STREAM）**：基于TCP协议，提供可靠的、面向连接的通信。
- **数据报套接字（SOCK_DGRAM）**：基于UDP协议，提供无连接的、不可靠的通信。

### 创建套接字

在C语言中，可以使用`socket()`函数创建一个套接字：

```c
#include <sys/types.h>
#include <sys/socket.h>

int sockfd = socket(AF_INET, SOCK_STREAM, 0);
if (sockfd < 0) {
    perror("Socket creation failed");
    exit(EXIT_FAILURE);
}
```

- `AF_INET`：表示使用IPv4地址族。
- `SOCK_STREAM`：表示创建一个流套接字（TCP）。
- `0`：表示使用默认协议（TCP）。

## TCP/IP协议

TCP/IP协议是互联网通信的基础协议。它由两个主要协议组成：

- **TCP（传输控制协议）**：提供可靠的、面向连接的通信。
- **IP（互联网协议）**：负责数据包的路由和传输。

### 客户端-服务器模型

在网络编程中，客户端-服务器模型是最常见的通信模式。客户端向服务器发送请求，服务器处理请求并返回响应。

#### 服务器端代码示例

以下是一个简单的TCP服务器代码示例：

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <netinet/in.h>

#define PORT 8080

int main() {
    int server_fd, new_socket;
    struct sockaddr_in address;
    int addrlen = sizeof(address);
    char buffer[1024] = {0};
    char *hello = "Hello from server";

    // 创建套接字
    if ((server_fd = socket(AF_INET, SOCK_STREAM, 0)) == 0) {
        perror("Socket failed");
        exit(EXIT_FAILURE);
    }

    // 绑定套接字到端口
    address.sin_family = AF_INET;
    address.sin_addr.s_addr = INADDR_ANY;
    address.sin_port = htons(PORT);
    if (bind(server_fd, (struct sockaddr *)&address, sizeof(address)) < 0) {
        perror("Bind failed");
        exit(EXIT_FAILURE);
    }

    // 监听连接
    if (listen(server_fd, 3) < 0) {
        perror("Listen failed");
        exit(EXIT_FAILURE);
    }

    // 接受连接
    if ((new_socket = accept(server_fd, (struct sockaddr *)&address, (socklen_t*)&addrlen)) < 0) {
        perror("Accept failed");
        exit(EXIT_FAILURE);
    }

    // 读取客户端数据并发送响应
    read(new_socket, buffer, 1024);
    printf("Message from client: %s\n", buffer);
    send(new_socket, hello, strlen(hello), 0);
    printf("Hello message sent\n");

    // 关闭套接字
    close(new_socket);
    close(server_fd);
    return 0;
}
```

#### 客户端代码示例

以下是一个简单的TCP客户端代码示例：

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>

#define PORT 8080

int main() {
    int sock = 0;
    struct sockaddr_in serv_addr;
    char *hello = "Hello from client";
    char buffer[1024] = {0};

    // 创建套接字
    if ((sock = socket(AF_INET, SOCK_STREAM, 0)) < 0) {
        printf("\n Socket creation error \n");
        return -1;
    }

    // 设置服务器地址
    serv_addr.sin_family = AF_INET;
    serv_addr.sin_port = htons(PORT);
    if (inet_pton(AF_INET, "127.0.0.1", &serv_addr.sin_addr) <= 0) {
        printf("\nInvalid address/ Address not supported \n");
        return -1;
    }

    // 连接到服务器
    if (connect(sock, (struct sockaddr *)&serv_addr, sizeof(serv_addr)) < 0) {
        printf("\nConnection Failed \n");
        return -1;
    }

    // 发送数据并接收响应
    send(sock, hello, strlen(hello), 0);
    printf("Hello message sent\n");
    read(sock, buffer, 1024);
    printf("Message from server: %s\n", buffer);

    // 关闭套接字
    close(sock);
    return 0;
}
```

## 实际应用场景

网络编程在实际应用中有广泛的应用场景，例如：

- **Web服务器**：处理HTTP请求并返回网页内容。
- **聊天应用**：实现实时消息传输。
- **文件传输**：通过网络传输文件。

## 总结

本文介绍了C语言网络编程的基础知识，包括套接字、TCP/IP协议、客户端-服务器模型等内容。通过这些知识，你可以开始编写简单的网络应用程序。

## 附加资源与练习

- **练习**：尝试修改上述代码，使其支持多个客户端连接。
- **资源**：阅读《UNIX网络编程》一书，深入了解网络编程的更多细节。

:::tip
在学习过程中，建议多动手实践，通过编写和调试代码来加深理解。
:::