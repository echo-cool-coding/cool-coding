---
title: C 语言信号处理
description: 了解C语言中的信号处理机制，掌握如何使用信号处理函数来响应系统事件和异常情况。
---

# C 语言信号处理

信号处理是C语言中一个重要的概念，它允许程序在运行时响应系统事件或异常情况。信号是由操作系统或程序自身发送的异步通知，通常用于处理诸如用户中断、程序错误或其他系统事件。通过学习信号处理，你可以编写更加健壮和可靠的程序。

## 什么是信号？

信号是操作系统或程序发送给进程的通知，用于指示某些事件的发生。例如，当用户按下 `Ctrl+C` 时，操作系统会向当前运行的进程发送一个 `SIGINT` 信号，通常用于终止程序。C语言提供了一组标准库函数来处理这些信号。

### 常见的信号类型

以下是一些常见的信号类型：

- `SIGINT`：用户中断信号（通常由 `Ctrl+C` 触发）。
- `SIGTERM`：终止信号（通常由 `kill` 命令发送）。
- `SIGSEGV`：段错误信号（通常由非法内存访问触发）。
- `SIGALRM`：定时器信号（由 `alarm` 函数触发）。

## 信号处理函数

在C语言中，可以使用 `signal` 函数来捕获和处理信号。`signal` 函数的原型如下：

```c
#include <signal.h>

void (*signal(int sig, void (*func)(int)))(int);
```

- `sig`：要捕获的信号编号。
- `func`：信号处理函数，当信号发生时会被调用。

### 示例：捕获 `SIGINT` 信号

以下是一个简单的示例，展示了如何捕获 `SIGINT` 信号并执行自定义处理函数：

```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

void handle_sigint(int sig) {
    printf("Caught SIGINT! Exiting...\n");
    _exit(0);
}

int main() {
    signal(SIGINT, handle_sigint);
    while (1) {
        printf("Running...\n");
        sleep(1);
    }
    return 0;
}
```

**输入/输出示例：**

```
Running...
Running...
^CCaught SIGINT! Exiting...
```

在这个示例中，程序会一直运行，直到用户按下 `Ctrl+C`。此时，`handle_sigint` 函数会被调用，程序会输出一条消息并退出。

## 信号处理的注意事项

1. **信号处理函数的限制**：信号处理函数应尽量简单，避免调用不可重入函数（如 `printf`、`malloc` 等），因为信号可能在程序执行任何地方发生。
2. **信号屏蔽**：可以使用 `sigprocmask` 函数来屏蔽或解除屏蔽某些信号，以防止信号处理函数被中断。
3. **信号队列**：某些信号是不可靠的，可能会丢失。如果需要可靠地处理信号，可以考虑使用 `sigaction` 函数。

## 实际应用场景

### 案例：定时器信号

假设你正在编写一个程序，需要在特定时间间隔内执行某些操作。你可以使用 `SIGALRM` 信号来实现定时器功能。

```c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

void handle_alarm(int sig) {
    printf("Alarm triggered!\n");
    alarm(2); // 重新设置定时器
}

int main() {
    signal(SIGALRM, handle_alarm);
    alarm(2); // 设置2秒定时器
    while (1) {
        printf("Waiting...\n");
        sleep(1);
    }
    return 0;
}
```

**输入/输出示例：**

```
Waiting...
Waiting...
Alarm triggered!
Waiting...
Waiting...
Alarm triggered!
...
```

在这个示例中，程序每2秒触发一次 `SIGALRM` 信号，并输出 "Alarm triggered!"。

## 总结

信号处理是C语言中一个强大的工具，允许程序响应系统事件和异常情况。通过使用 `signal` 函数，你可以捕获和处理各种信号，从而编写更加健壮的程序。然而，信号处理函数应尽量简单，以避免潜在的问题。

## 附加资源与练习

- **练习1**：修改上面的 `SIGINT` 示例，使其在捕获信号后不退出程序，而是继续运行。
- **练习2**：编写一个程序，使用 `SIGTERM` 信号来优雅地关闭程序，释放所有资源。
- **进一步阅读**：查阅 `sigaction` 函数的文档，了解如何更可靠地处理信号。

希望这篇内容能帮助你更好地理解C语言中的信号处理机制！如果你有任何问题，欢迎在评论区留言。