---
title: Swift JSON 解析
description: 学习如何在 Swift 中解析 JSON 数据，掌握 Codable 协议的使用方法，并通过实际案例理解 JSON 解析的应用场景。
---

# Swift JSON 解析

在现代移动应用开发中，JSON（JavaScript Object Notation）是最常用的数据交换格式之一。无论是从服务器获取数据，还是将数据发送到服务器，JSON 都扮演着重要的角色。Swift 提供了强大的工具来解析和生成 JSON 数据，其中最常用的方式是使用 `Codable` 协议。

## 什么是 JSON？

JSON 是一种轻量级的数据交换格式，易于人类阅读和编写，同时也易于机器解析和生成。它基于键值对的形式存储数据，通常用于 Web 应用程序中的数据传输。

一个简单的 JSON 示例：

```json
{
  "name": "John Doe",
  "age": 30,
  "isStudent": false
}
```

## Swift 中的 JSON 解析

在 Swift 中，`Codable` 协议是解析和生成 JSON 数据的主要工具。`Codable` 是 `Encodable` 和 `Decodable` 的组合，分别用于将数据编码为 JSON 和从 JSON 解码数据。

### 1. 定义模型

首先，我们需要定义一个与 JSON 结构相匹配的 Swift 模型。假设我们有以下的 JSON 数据：

```json
{
  "name": "Alice",
  "age": 25,
  "email": "alice@example.com"
}
```

我们可以定义一个 `User` 结构体来表示这个 JSON 数据：

```swift
struct User: Codable {
    let name: String
    let age: Int
    let email: String
}
```

### 2. 解析 JSON

接下来，我们可以使用 `JSONDecoder` 来将 JSON 数据解析为 Swift 对象。假设我们有一个 JSON 字符串：

```swift
let jsonString = """
{
    "name": "Alice",
    "age": 25,
    "email": "alice@example.com"
}
"""
```

我们可以将其解析为 `User` 对象：

```swift
if let jsonData = jsonString.data(using: .utf8) {
    do {
        let user = try JSONDecoder().decode(User.self, from: jsonData)
        print("Name: \(user.name), Age: \(user.age), Email: \(user.email)")
    } catch {
        print("Failed to decode JSON: \(error)")
    }
}
```

输出结果将是：

```
Name: Alice, Age: 25, Email: alice@example.com
```

### 3. 生成 JSON

我们也可以将 Swift 对象编码为 JSON 数据。例如，我们可以将 `User` 对象转换为 JSON 字符串：

```swift
let user = User(name: "Bob", age: 30, email: "bob@example.com")
do {
    let jsonData = try JSONEncoder().encode(user)
    if let jsonString = String(data: jsonData, encoding: .utf8) {
        print(jsonString)
    }
} catch {
    print("Failed to encode JSON: \(error)")
}
```

输出结果将是：

```json
{"name":"Bob","age":30,"email":"bob@example.com"}
```

## 实际应用场景

### 从网络请求中解析 JSON

在实际应用中，我们通常从网络请求中获取 JSON 数据。假设我们使用 `URLSession` 从服务器获取用户数据：

```swift
let url = URL(string: "https://example.com/api/user/1")!
let task = URLSession.shared.dataTask(with: url) { data, response, error in
    if let data = data {
        do {
            let user = try JSONDecoder().decode(User.self, from: data)
            print("User: \(user)")
        } catch {
            print("Failed to decode JSON: \(error)")
        }
    } else if let error = error {
        print("Error: \(error)")
    }
}
task.resume()
```

### 处理嵌套 JSON

有时，JSON 数据可能包含嵌套结构。例如：

```json
{
  "user": {
    "name": "Charlie",
    "age": 28,
    "email": "charlie@example.com"
  },
  "status": "active"
}
```

我们可以定义嵌套的模型来解析这种结构：

```swift
struct UserResponse: Codable {
    let user: User
    let status: String
}

struct User: Codable {
    let name: String
    let age: Int
    let email: String
}
```

然后，我们可以像之前一样解析 JSON 数据：

```swift
let jsonString = """
{
    "user": {
        "name": "Charlie",
        "age": 28,
        "email": "charlie@example.com"
    },
    "status": "active"
}
"""

if let jsonData = jsonString.data(using: .utf8) {
    do {
        let userResponse = try JSONDecoder().decode(UserResponse.self, from: jsonData)
        print("User: \(userResponse.user), Status: \(userResponse.status)")
    } catch {
        print("Failed to decode JSON: \(error)")
    }
}
```

## 总结

在 Swift 中，`Codable` 协议使得 JSON 解析和生成变得非常简单。通过定义与 JSON 结构相匹配的模型，并使用 `JSONDecoder` 和 `JSONEncoder`，我们可以轻松地在 Swift 中处理 JSON 数据。

:::tip 提示
在实际开发中，确保你的模型与 JSON 结构完全匹配，否则可能会导致解析失败。如果 JSON 数据中包含可选字段，可以在模型中使用可选类型（如 `String?`）来表示。
:::

## 附加资源与练习

- **练习 1**: 尝试解析一个包含数组的 JSON 数据，例如用户列表。
- **练习 2**: 编写一个函数，将 Swift 对象转换为 JSON 字符串并保存到文件中。
- **资源**: 阅读 Apple 官方文档中关于 [Codable](https://developer.apple.com/documentation/swift/codable) 的更多内容。

通过不断练习和探索，你将能够熟练掌握 Swift 中的 JSON 解析技术，并在实际项目中灵活运用。