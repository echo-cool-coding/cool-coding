---
title: Swift HTTP 请求
description: 学习如何在 Swift 中进行 HTTP 请求，掌握网络编程的基础知识，并通过实际案例理解其应用场景。
---

# Swift HTTP 请求

在现代移动应用开发中，网络请求是不可或缺的一部分。无论是从服务器获取数据，还是将用户数据上传到服务器，HTTP 请求都是实现这些功能的核心技术。本文将带你了解如何在 Swift 中进行 HTTP 请求，并通过实际案例展示其应用。

## 什么是 HTTP 请求？

HTTP（超文本传输协议）是用于在客户端和服务器之间传输数据的协议。HTTP 请求是客户端向服务器发送的请求，通常用于获取或发送数据。常见的 HTTP 请求方法包括 `GET`、`POST`、`PUT`、`DELETE` 等。

在 Swift 中，我们可以使用 `URLSession` 来进行 HTTP 请求。`URLSession` 是 Apple 提供的一个强大的 API，用于处理网络请求和响应。

## 基本 HTTP 请求

### 1. 创建一个简单的 GET 请求

以下是一个简单的 GET 请求示例，用于从服务器获取数据：

```swift
import Foundation

// 定义 URL
let url = URL(string: "https://jsonplaceholder.typicode.com/posts")!

// 创建 URLSession 实例
let session = URLSession.shared

// 创建数据任务
let task = session.dataTask(with: url) { data, response, error in
    if let error = error {
        print("Error: \(error)")
        return
    }
    
    // 检查响应状态码
    if let httpResponse = response as? HTTPURLResponse, httpResponse.statusCode == 200 {
        if let data = data {
            // 解析数据
            if let json = try? JSONSerialization.jsonObject(with: data, options: []) {
                print("Response JSON: \(json)")
            }
        }
    }
}

// 启动任务
task.resume()
```

**输入：**  
- 请求 URL: `https://jsonplaceholder.typicode.com/posts`

**输出：**  
- 打印出从服务器获取的 JSON 数据。

### 2. 创建一个 POST 请求

POST 请求通常用于向服务器发送数据。以下是一个简单的 POST 请求示例：

```swift
import Foundation

// 定义 URL
let url = URL(string: "https://jsonplaceholder.typicode.com/posts")!

// 创建请求
var request = URLRequest(url: url)
request.httpMethod = "POST"
request.setValue("application/json", forHTTPHeaderField: "Content-Type")

// 定义请求体
let postData: [String: Any] = [
    "title": "foo",
    "body": "bar",
    "userId": 1
]

// 将请求体转换为 JSON 数据
if let jsonData = try? JSONSerialization.data(withJSONObject: postData, options: []) {
    request.httpBody = jsonData
}

// 创建 URLSession 实例
let session = URLSession.shared

// 创建数据任务
let task = session.dataTask(with: request) { data, response, error in
    if let error = error {
        print("Error: \(error)")
        return
    }
    
    // 检查响应状态码
    if let httpResponse = response as? HTTPURLResponse, httpResponse.statusCode == 201 {
        if let data = data {
            // 解析数据
            if let json = try? JSONSerialization.jsonObject(with: data, options: []) {
                print("Response JSON: \(json)")
            }
        }
    }
}

// 启动任务
task.resume()
```

**输入：**  
- 请求 URL: `https://jsonplaceholder.typicode.com/posts`  
- 请求体: `{"title": "foo", "body": "bar", "userId": 1}`

**输出：**  
- 打印出服务器返回的 JSON 数据，通常包含新创建的资源的 ID。

## 实际应用场景

### 1. 获取天气数据

假设你正在开发一个天气应用，需要从天气 API 获取当前天气数据。你可以使用 GET 请求来实现：

```swift
import Foundation

let apiKey = "your_api_key"
let city = "London"
let url = URL(string: "https://api.openweathermap.org/data/2.5/weather?q=\(city)&appid=\(apiKey)")!

let session = URLSession.shared
let task = session.dataTask(with: url) { data, response, error in
    if let error = error {
        print("Error: \(error)")
        return
    }
    
    if let httpResponse = response as? HTTPURLResponse, httpResponse.statusCode == 200 {
        if let data = data {
            if let json = try? JSONSerialization.jsonObject(with: data, options: []) {
                print("Weather Data: \(json)")
            }
        }
    }
}

task.resume()
```

### 2. 用户登录

在用户登录场景中，你可以使用 POST 请求将用户的登录信息发送到服务器：

```swift
import Foundation

let url = URL(string: "https://your-api.com/login")!
var request = URLRequest(url: url)
request.httpMethod = "POST"
request.setValue("application/json", forHTTPHeaderField: "Content-Type")

let loginData: [String: Any] = [
    "username": "user123",
    "password": "password123"
]

if let jsonData = try? JSONSerialization.data(withJSONObject: loginData, options: []) {
    request.httpBody = jsonData
}

let session = URLSession.shared
let task = session.dataTask(with: request) { data, response, error in
    if let error = error {
        print("Error: \(error)")
        return
    }
    
    if let httpResponse = response as? HTTPURLResponse, httpResponse.statusCode == 200 {
        if let data = data {
            if let json = try? JSONSerialization.jsonObject(with: data, options: []) {
                print("Login Response: \(json)")
            }
        }
    }
}

task.resume()
```

## 总结

通过本文，你已经学会了如何在 Swift 中进行基本的 HTTP 请求。我们介绍了如何使用 `URLSession` 来发送 GET 和 POST 请求，并通过实际案例展示了这些请求的应用场景。掌握这些基础知识后，你可以进一步探索更复杂的网络编程技术，如处理 JSON 数据、处理错误、使用第三方库等。

## 附加资源与练习

- **练习 1:** 尝试使用 `PUT` 和 `DELETE` 方法发送请求，并观察服务器的响应。
- **练习 2:** 使用 `Codable` 协议来解析 JSON 数据，而不是使用 `JSONSerialization`。
- **附加资源:**  
  - [Apple 官方文档 - URLSession](https://developer.apple.com/documentation/foundation/urlsession)  
  - [Swift 编程语言指南](https://docs.swift.org/swift-book/)

:::tip
在实际开发中，建议使用第三方库如 `Alamofire` 来简化网络请求的处理。它提供了更简洁的 API 和更强大的功能。
:::