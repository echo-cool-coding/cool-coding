---
title: Swift 自定义类型访问
description: 了解如何在Swift中通过访问控制机制管理自定义类型的可见性和可访问性，确保代码的安全性和模块化。
---

# Swift 自定义类型访问

在Swift中，访问控制（Access Control）是一种强大的机制，用于管理代码中各种实体（如类、结构体、枚举、属性和方法）的可见性和可访问性。通过访问控制，你可以限制哪些代码可以访问或修改特定的部分，从而提高代码的安全性和模块化。

本文将重点介绍如何在Swift中为自定义类型（如类、结构体和枚举）设置访问控制，并通过实际案例帮助你理解其应用场景。

## 什么是自定义类型访问控制？

自定义类型访问控制是指为类、结构体和枚举设置访问级别，以控制它们在模块内外的可见性。Swift提供了五种访问级别，从最开放到最严格依次为：

1. `open`：允许在模块内外被访问和继承。
2. `public`：允许在模块内外被访问，但不能在模块外被继承。
3. `internal`：默认级别，允许在模块内被访问，但在模块外不可见。
4. `fileprivate`：限制在当前文件内可见。
5. `private`：限制在当前作用域内可见。

通过合理设置这些访问级别，你可以确保代码的封装性和安全性。

---

## 自定义类型的访问级别

### 1. `open` 和 `public` 访问级别

`open` 和 `public` 访问级别允许自定义类型在模块内外被访问。它们的区别在于：

- `open`：允许在模块外被继承和重写。
- `public`：允许在模块外被访问，但不能被继承。

```swift
// 定义一个 open 类
open class OpenClass {
    open func greet() {
        print("Hello from OpenClass!")
    }
}

// 定义一个 public 类
public class PublicClass {
    public func greet() {
        print("Hello from PublicClass!")
    }
}
```

在上面的代码中，`OpenClass` 可以在模块外被继承，而 `PublicClass` 只能在模块外被访问。

---

### 2. `internal` 访问级别

`internal` 是默认的访问级别。如果你没有显式指定访问级别，Swift 会将其设置为 `internal`。这意味着该类型只能在模块内被访问。

```swift
// 定义一个 internal 类（默认）
class InternalClass {
    func greet() {
        print("Hello from InternalClass!")
    }
}
```

`InternalClass` 只能在定义它的模块内被访问。

---

### 3. `fileprivate` 访问级别

`fileprivate` 访问级别限制类型只能在当前文件内被访问。

```swift
// 定义一个 fileprivate 类
fileprivate class FilePrivateClass {
    func greet() {
        print("Hello from FilePrivateClass!")
    }
}
```

`FilePrivateClass` 只能在定义它的文件内被访问。

---

### 4. `private` 访问级别

`private` 访问级别限制类型只能在当前作用域内被访问。

```swift
// 定义一个 private 类
private class PrivateClass {
    func greet() {
        print("Hello from PrivateClass!")
    }
}
```

`PrivateClass` 只能在定义它的作用域内被访问。

---

## 实际案例

假设你正在开发一个框架，其中包含一个用于处理用户身份验证的模块。你希望某些类只能在模块内使用，而其他类可以被外部开发者访问。

```swift
// 定义一个 public 类，供外部开发者使用
public class AuthenticationManager {
    private let credentialStore = CredentialStore()

    public func login(username: String, password: String) -> Bool {
        return credentialStore.validate(username: username, password: password)
    }
}

// 定义一个 private 类，仅在模块内使用
private class CredentialStore {
    func validate(username: String, password: String) -> Bool {
        // 验证逻辑
        return username == "admin" && password == "password"
    }
}
```

在这个例子中，`AuthenticationManager` 是 `public` 的，可以被外部开发者使用，而 `CredentialStore` 是 `private` 的，只能在模块内使用。

---

## 总结

通过访问控制，你可以有效地管理自定义类型的可见性和可访问性，从而提高代码的安全性和模块化。以下是本文的关键点：

1. `open` 和 `public` 允许类型在模块内外被访问，但 `open` 还允许继承。
2. `internal` 是默认访问级别，限制类型在模块内可见。
3. `fileprivate` 和 `private` 分别限制类型在文件内和作用域内可见。

:::tip
在实际开发中，尽量使用最严格的访问级别来保护你的代码。只有在必要时才放宽访问级别。
:::

---

## 附加资源与练习

### 练习
1. 创建一个 `public` 结构体 `Person`，包含 `name` 和 `age` 属性。
2. 在同一个模块中定义一个 `private` 类 `Database`，用于存储 `Person` 对象。
3. 尝试在模块外访问 `Database`，看看会发生什么。

### 资源
- [Swift官方文档 - 访问控制](https://docs.swift.org/swift-book/LanguageGuide/AccessControl.html)
- [Swift编程语言指南](https://swift.org/documentation/)

通过练习和阅读官方文档，你将更深入地理解Swift中的访问控制机制。