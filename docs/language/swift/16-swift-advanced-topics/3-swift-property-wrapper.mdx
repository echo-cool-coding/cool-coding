---
title: Swift 属性包装器
description: 了解Swift中的属性包装器，掌握如何通过属性包装器简化代码并增强属性的功能。
---

## 介绍

在Swift中，属性包装器（Property Wrappers）是一种强大的工具，它允许你在属性上添加额外的逻辑，而无需修改属性本身的定义。通过属性包装器，你可以将通用的逻辑封装起来，并在多个属性中复用，从而提高代码的可读性和可维护性。

属性包装器本质上是一个结构体或类，它通过 `@propertyWrapper` 关键字进行标记，并实现 `wrappedValue` 属性。这个 `wrappedValue` 属性是属性包装器的核心，它定义了如何存储和访问被包装的值。

## 基本语法

让我们从一个简单的例子开始，了解属性包装器的基本语法。

```swift
@propertyWrapper
struct Capitalized {
    private var value: String = ""

    var wrappedValue: String {
        get { value }
        set { value = newValue.capitalized }
    }

    init(wrappedValue: String) {
        self.wrappedValue = wrappedValue
    }
}
```

在这个例子中，我们定义了一个名为 `Capitalized` 的属性包装器。它将字符串属性的值自动转换为首字母大写的形式。

### 使用属性包装器

现在，我们可以使用这个属性包装器来修饰一个字符串属性：

```swift
struct User {
    @Capitalized var name: String
}

var user = User(name: "john doe")
print(user.name) // 输出: "John Doe"
```

在这个例子中，`name` 属性的值被自动转换为首字母大写的形式，而不需要我们手动调用 `capitalized` 方法。

## 属性包装器的实际应用

属性包装器在实际开发中有许多应用场景。以下是一些常见的例子：

### 1. 数据验证

属性包装器可以用于验证属性的值是否符合特定的规则。例如，我们可以创建一个属性包装器来确保一个整数值始终为正数：

```swift
@propertyWrapper
struct Positive {
    private var value: Int = 0

    var wrappedValue: Int {
        get { value }
        set { value = max(0, newValue) }
    }

    init(wrappedValue: Int) {
        self.wrappedValue = wrappedValue
    }
}

struct Product {
    @Positive var stock: Int
}

var product = Product(stock: -10)
print(product.stock) // 输出: 0
```

在这个例子中，`stock` 属性的值被自动限制为非负数。

### 2. 数据格式化

属性包装器还可以用于格式化数据。例如，我们可以创建一个属性包装器来自动将日期格式化为字符串：

```swift
@propertyWrapper
struct DateFormatted {
    private var value: Date
    private let formatter: DateFormatter

    var wrappedValue: String {
        get { formatter.string(from: value) }
        set { value = formatter.date(from: newValue) ?? Date() }
    }

    init(wrappedValue: Date) {
        self.value = wrappedValue
        self.formatter = DateFormatter()
        formatter.dateStyle = .medium
    }
}

struct Event {
    @DateFormatted var date: Date
}

var event = Event(date: Date())
print(event.date) // 输出: "Oct 10, 2023"
```

在这个例子中，`date` 属性的值被自动格式化为中等长度的日期字符串。

## 总结

属性包装器是Swift中一个非常强大的特性，它允许你将通用的逻辑封装起来，并在多个属性中复用。通过属性包装器，你可以简化代码，增强属性的功能，并提高代码的可读性和可维护性。

在实际开发中，属性包装器可以用于数据验证、数据格式化、线程安全等多种场景。掌握属性包装器的使用，将使你的Swift代码更加优雅和高效。

## 附加资源

- [Swift官方文档 - 属性包装器](https://docs.swift.org/swift-book/LanguageGuide/Properties.html#ID617)
- [Swift属性包装器实战](https://www.hackingwithswift.com/articles/212/whats-new-in-swift-5-1)
- [Swift属性包装器高级用法](https://www.avanderlee.com/swift/property-wrappers/)

## 练习

1. 创建一个属性包装器，确保一个字符串属性的长度不超过指定的最大值。
2. 修改 `Capitalized` 属性包装器，使其支持可选字符串。
3. 创建一个属性包装器，自动将浮点数四舍五入到指定的小数位数。
