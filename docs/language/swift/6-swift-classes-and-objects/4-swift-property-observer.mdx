---
title: Swift 属性观察器
description: 了解Swift中的属性观察器，掌握如何使用willSet和didSet来观察和响应属性值的变化。
---

# Swift 属性观察器

在Swift中，属性观察器（Property Observers）是一种强大的工具，允许你在属性值发生变化时执行特定的代码。无论你是想在新值设置之前还是之后执行某些操作，属性观察器都能满足你的需求。本文将详细介绍Swift中的属性观察器，并通过示例代码和实际案例帮助你理解其用法。

## 什么是属性观察器？

属性观察器是Swift中用于观察和响应属性值变化的机制。它们允许你在属性值即将改变（`willSet`）或已经改变（`didSet`）时执行自定义代码。属性观察器适用于存储属性（Stored Properties），但不适用于计算属性（Computed Properties）。

### `willSet` 和 `didSet`

- **`willSet`**：在属性值即将被设置之前调用。你可以通过`newValue`访问即将设置的新值。
- **`didSet`**：在属性值已经被设置之后调用。你可以通过`oldValue`访问之前的值。

## 基本语法

以下是一个简单的示例，展示了如何使用`willSet`和`didSet`：

```swift
var score: Int = 0 {
    willSet {
        print("即将设置新值: \(newValue)")
    }
    didSet {
        print("旧值是: \(oldValue), 新值是: \(score)")
    }
}
```

### 示例输出

```swift
score = 10
// 输出:
// 即将设置新值: 10
// 旧值是: 0, 新值是: 10
```

在这个示例中，当`score`的值从`0`变为`10`时，`willSet`和`didSet`分别被调用，并输出了相应的信息。

## 实际应用场景

### 1. 数据验证

属性观察器可以用于在设置新值之前验证数据的有效性。例如，你可以确保某个属性值始终在特定范围内：

```swift
var age: Int = 0 {
    didSet {
        if age < 0 {
            print("年龄不能为负数，已重置为0")
            age = 0
        }
    }
}
```

### 2. 自动更新UI

在开发iOS应用时，属性观察器可以用于在数据变化时自动更新用户界面。例如，当某个模型数据发生变化时，你可以立即更新相关的UI组件：

```swift
class User {
    var name: String = "" {
        didSet {
            updateUI()
        }
    }

    func updateUI() {
        print("用户名称已更新为: \(name)")
    }
}

let user = User()
user.name = "Alice"
// 输出: 用户名称已更新为: Alice
```

### 3. 日志记录

属性观察器还可以用于记录属性值的变化，这在调试和监控应用程序时非常有用：

```swift
var temperature: Double = 0.0 {
    willSet {
        print("温度即将从 \(temperature) 变为 \(newValue)")
    }
    didSet {
        print("温度已从 \(oldValue) 变为 \(temperature)")
    }
}

temperature = 25.5
// 输出:
// 温度即将从 0.0 变为 25.5
// 温度已从 0.0 变为 25.5
```

## 总结

属性观察器是Swift中一个非常有用的特性，它允许你在属性值发生变化时执行自定义代码。通过`willSet`和`didSet`，你可以在新值设置之前或之后执行特定的操作，如数据验证、UI更新或日志记录。掌握属性观察器的使用，将使你的代码更加灵活和强大。

## 附加资源与练习

- **练习1**：创建一个`BankAccount`类，包含一个`balance`属性。使用属性观察器确保`balance`不会变为负数。
- **练习2**：在一个简单的购物车应用中，使用属性观察器在商品数量变化时自动更新总价。

:::tip
如果你对属性观察器还有疑问，建议阅读Swift官方文档中关于[属性](https://docs.swift.org/swift-book/LanguageGuide/Properties.html)的章节，以获取更深入的理解。
:::