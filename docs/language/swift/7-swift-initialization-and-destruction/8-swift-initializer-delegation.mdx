---
title: Swift 初始化器委托
description: 了解Swift中初始化器委托的概念，掌握如何通过委托简化初始化逻辑，并避免代码重复。
---

# Swift 初始化器委托

在Swift中，初始化器委托（Initializer Delegation）是一种让一个初始化器调用另一个初始化器的机制。它主要用于简化初始化逻辑，避免代码重复，并确保所有存储属性都被正确初始化。初始化器委托在类和结构体中都可以使用，但在类中需要额外考虑继承关系。

## 什么是初始化器委托？

初始化器委托是指在一个初始化器中调用另一个初始化器来完成部分或全部初始化工作。这种机制特别适用于以下场景：

1. **简化代码**：当多个初始化器有相似的初始化逻辑时，可以通过委托避免重复代码。
2. **确保一致性**：通过委托，可以确保所有初始化器都遵循相同的初始化逻辑，从而减少错误。
3. **支持继承**：在类中，子类可以通过委托调用父类的初始化器，确保父类的属性被正确初始化。

## 结构体中的初始化器委托

在结构体中，初始化器委托非常简单。你可以通过 `self.init` 调用其他初始化器。以下是一个示例：

```swift
struct Rectangle {
    var width: Double
    var height: Double

    // 默认初始化器
    init(width: Double, height: Double) {
        self.width = width
        self.height = height
    }

    // 委托初始化器
    init(side: Double) {
        self.init(width: side, height: side)
    }
}

let square = Rectangle(side: 5.0)
print("Width: \(square.width), Height: \(square.height)")
```

**输出：**
```
Width: 5.0, Height: 5.0
```

在这个例子中，`init(side:)` 初始化器委托给 `init(width:height:)` 初始化器，从而简化了代码。

## 类中的初始化器委托

在类中，初始化器委托稍微复杂一些，因为需要考虑继承关系。类有两种初始化器：**指定初始化器**（Designated Initializers）和**便利初始化器**（Convenience Initializers）。

- **指定初始化器**：负责初始化类的所有存储属性，并调用父类的指定初始化器（如果有）。
- **便利初始化器**：通过调用类中的其他初始化器来完成初始化工作，最终必须调用一个指定初始化器。

以下是一个类的示例：

```swift
class Vehicle {
    var numberOfWheels: Int

    // 指定初始化器
    init(numberOfWheels: Int) {
        self.numberOfWheels = numberOfWheels
    }

    // 便利初始化器
    convenience init() {
        self.init(numberOfWheels: 4)
    }
}

class Car: Vehicle {
    var brand: String

    // 指定初始化器
    init(brand: String) {
        self.brand = brand
        super.init(numberOfWheels: 4)
    }

    // 便利初始化器
    convenience init() {
        self.init(brand: "Unknown")
    }
}

let myCar = Car()
print("Brand: \(myCar.brand), Wheels: \(myCar.numberOfWheels)")
```

**输出：**
```
Brand: Unknown, Wheels: 4
```

在这个例子中，`Car` 类的便利初始化器 `init()` 委托给指定初始化器 `init(brand:)`，而 `init(brand:)` 又调用了父类的指定初始化器 `init(numberOfWheels:)`。

:::note
在类中，便利初始化器必须最终调用一个指定初始化器，而指定初始化器必须调用父类的指定初始化器（如果有父类）。
:::

## 实际应用场景

初始化器委托在实际开发中非常有用，尤其是在以下场景中：

1. **默认值初始化**：当你希望为某些属性提供默认值时，可以通过便利初始化器简化初始化过程。
2. **多参数初始化**：当初始化器有多个参数时，可以通过委托减少重复代码。
3. **继承链中的初始化**：在类的继承链中，初始化器委托确保所有父类的属性都被正确初始化。

## 总结

初始化器委托是Swift中一个强大的特性，它可以帮助你简化初始化逻辑，避免代码重复，并确保所有存储属性都被正确初始化。无论是在结构体还是类中，初始化器委托都能显著提高代码的可读性和可维护性。

:::tip
**练习**：尝试创建一个包含多个初始化器的结构体或类，并使用初始化器委托来简化代码。观察委托如何帮助你减少重复代码并提高代码的可读性。
:::

## 附加资源

- [Swift官方文档 - 初始化](https://docs.swift.org/swift-book/LanguageGuide/Initialization.html)
- [Swift编程语言指南](https://developer.apple.com/swift/resources/)