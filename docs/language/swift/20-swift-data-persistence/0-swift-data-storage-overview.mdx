---
title: Swift 数据存储概述
description: 了解 Swift 中的数据持久化技术，包括文件存储、UserDefaults、Core Data 和 SQLite 等，帮助初学者掌握数据存储的基本概念和实际应用。
---

在开发 iOS 或 macOS 应用程序时，数据持久化是一个至关重要的概念。无论是保存用户的偏好设置、缓存数据，还是存储复杂的结构化数据，Swift 提供了多种方式来实现数据的持久化。本文将为您介绍 Swift 中常见的数据存储技术，并通过实际案例帮助您理解它们的应用场景。

## 什么是数据持久化？

数据持久化是指将应用程序中的数据保存到设备的存储介质中，以便在应用程序关闭或设备重启后仍然可以访问这些数据。Swift 提供了多种数据持久化方式，每种方式都有其适用的场景和优缺点。

### 常见的数据持久化方式

1. **文件存储**：将数据保存到文件中，适用于存储简单的文本、图片或自定义二进制数据。
2. **UserDefaults**：用于存储轻量级的用户偏好设置或配置信息。
3. **Core Data**：苹果提供的对象图管理和持久化框架，适用于存储复杂的结构化数据。
4. **SQLite**：轻量级的关系型数据库，适合存储大量结构化数据。

接下来，我们将逐一介绍这些技术，并通过代码示例展示它们的使用方法。

---

## 1. 文件存储

文件存储是最基本的数据持久化方式之一。您可以将数据保存为文件，并在需要时读取这些文件。Swift 提供了 `FileManager` 类来管理文件和目录。

### 示例：保存和读取文本文件

```swift
import Foundation

// 获取文档目录路径
if let documentsDirectory = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask).first {
    let fileURL = documentsDirectory.appendingPathComponent("example.txt")
    
    // 写入数据
    let text = "Hello, Swift 数据持久化!"
    do {
        try text.write(to: fileURL, atomically: true, encoding: .utf8)
        print("文件保存成功")
    } catch {
        print("文件保存失败: \(error)")
    }
    
    // 读取数据
    do {
        let savedText = try String(contentsOf: fileURL, encoding: .utf8)
        print("读取的文件内容: \(savedText)")
    } catch {
        print("文件读取失败: \(error)")
    }
}
```

**输出：**
```
文件保存成功
读取的文件内容: Hello, Swift 数据持久化!
```

:::tip
文件存储适合保存简单的数据，例如文本、图片或自定义二进制文件。对于复杂的数据结构，建议使用 Core Data 或 SQLite。
:::

---

## 2. UserDefaults

`UserDefaults` 是一个轻量级的持久化工具，适合存储用户的偏好设置或配置信息。它本质上是一个键值存储系统。

### 示例：保存和读取用户偏好

```swift
import Foundation

// 保存数据
UserDefaults.standard.set("dark", forKey: "theme")
UserDefaults.standard.set(25, forKey: "fontSize")

// 读取数据
let theme = UserDefaults.standard.string(forKey: "theme") ?? "light"
let fontSize = UserDefaults.standard.integer(forKey: "fontSize")

print("当前主题: \(theme), 字体大小: \(fontSize)")
```

**输出：**
```
当前主题: dark, 字体大小: 25
```

:::caution
`UserDefaults` 不适合存储大量数据或敏感信息（如密码）。对于这些场景，请使用更安全的存储方式。
:::

---

## 3. Core Data

`Core Data` 是苹果提供的对象图管理和持久化框架。它不仅可以存储数据，还可以管理数据之间的关系。

### 示例：使用 Core Data 存储用户信息

```swift
import CoreData

// 定义 Core Data 模型
class User: NSManagedObject {
    @NSManaged var name: String
    @NSManaged var age: Int16
}

// 保存数据
let context = persistentContainer.viewContext
let user = User(context: context)
user.name = "Alice"
user.age = 30

do {
    try context.save()
    print("用户数据保存成功")
} catch {
    print("用户数据保存失败: \(error)")
}

// 读取数据
let fetchRequest: NSFetchRequest<User> = User.fetchRequest()
do {
    let users = try context.fetch(fetchRequest)
    for user in users {
        print("用户名: \(user.name), 年龄: \(user.age)")
    }
} catch {
    print("用户数据读取失败: \(error)")
}
```

**输出：**
```
用户数据保存成功
用户名: Alice, 年龄: 30
```

:::note
Core Data 适合存储复杂的结构化数据，并且可以轻松管理数据之间的关系。对于初学者来说，可能需要一些时间来熟悉其概念和 API。
:::

---

## 4. SQLite

SQLite 是一个轻量级的关系型数据库，适合存储大量结构化数据。Swift 中可以通过 `SQLite.swift` 等第三方库来操作 SQLite 数据库。

### 示例：使用 SQLite 存储和查询数据

```swift
import SQLite

// 创建数据库连接
let db = try Connection("path/to/db.sqlite3")

// 定义表结构
let users = Table("users")
let id = Expression<Int64>("id")
let name = Expression<String>("name")
let age = Expression<Int>("age")

// 创建表
try db.run(users.create { t in
    t.column(id, primaryKey: true)
    t.column(name)
    t.column(age)
})

// 插入数据
try db.run(users.insert(name <- "Bob", age <- 25))

// 查询数据
for user in try db.prepare(users) {
    print("用户ID: \(user[id]), 用户名: \(user[name]), 年龄: \(user[age])")
}
```

**输出：**
```
用户ID: 1, 用户名: Bob, 年龄: 25
```

:::warning
SQLite 适合存储大量结构化数据，但需要手动管理数据库模式和迁移。对于初学者来说，Core Data 可能是更简单的选择。
:::

---

## 实际应用场景

1. **文件存储**：保存用户生成的文档、图片或日志文件。
2. **UserDefaults**：存储用户的偏好设置，例如主题、语言或字体大小。
3. **Core Data**：管理应用程序的核心数据模型，例如用户信息、订单或库存。
4. **SQLite**：存储大量结构化数据，例如日志记录或分析数据。

---

## 总结

Swift 提供了多种数据持久化方式，每种方式都有其适用的场景。文件存储适合保存简单的数据，`UserDefaults` 适合存储轻量级的用户偏好，`Core Data` 和 `SQLite` 则适合存储复杂的结构化数据。选择合适的数据存储方式可以帮助您构建高效、可靠的应用程序。

---

## 附加资源与练习

1. **练习**：尝试使用 `UserDefaults` 保存和读取用户的主题偏好。
2. **练习**：使用 `Core Data` 创建一个简单的待办事项应用程序。
3. **资源**：阅读 [Apple 官方文档](https://developer.apple.com/documentation) 了解更多关于 `Core Data` 和 `FileManager` 的详细信息。

通过本文的学习，您应该对 Swift 中的数据持久化有了初步的了解。继续实践和探索，您将能够熟练运用这些技术来构建功能强大的应用程序！