---
title: C# 委托定义
description: 了解C#中的委托（Delegate），掌握如何定义和使用委托，以及委托在C#编程中的实际应用场景。
---

## 介绍

在C#中，**委托（Delegate）** 是一种类型安全的函数指针，它允许你将方法作为参数传递，或者将方法存储在变量中。委托是C#中实现事件驱动编程和回调机制的核心工具之一。通过委托，你可以动态地调用方法，而不需要在编译时知道具体的方法。

委托的主要特点包括：
- **类型安全**：委托是强类型的，确保方法签名与委托定义一致。
- **多播能力**：一个委托可以引用多个方法，并按顺序调用它们。
- **灵活性**：委托可以用于实现回调、事件处理等场景。

## 委托的定义

在C#中，委托的定义类似于方法的声明，但它没有方法体。委托的定义包括：
- 返回类型
- 委托名称
- 参数列表

### 基本语法

```csharp
delegate 返回类型 委托名称(参数列表);
```

例如，定义一个接受两个整数参数并返回整数的委托：

```csharp
delegate int MathOperation(int a, int b);
```

### 委托的使用

定义委托后，你可以将任何与委托签名匹配的方法赋值给该委托。例如：

```csharp
int Add(int a, int b) {
    return a + b;
}

int Subtract(int a, int b) {
    return a - b;
}

MathOperation operation = Add;
int result = operation(5, 3); // 输出: 8

operation = Subtract;
result = operation(5, 3); // 输出: 2
```

在上面的例子中，`MathOperation` 委托可以引用 `Add` 和 `Subtract` 方法，因为它们的方法签名与委托定义一致。

## 多播委托

委托的一个重要特性是**多播能力**，即一个委托可以引用多个方法。当调用多播委托时，所有引用的方法将按顺序执行。

```csharp
MathOperation operation = Add;
operation += Subtract;

int result = operation(5, 3); // 输出: 2
```

在上面的例子中，`operation` 委托首先调用 `Add` 方法，然后调用 `Subtract` 方法。最终的结果是 `Subtract` 方法的返回值。

:::note
多播委托的返回值通常是最后一个方法的返回值。如果委托有返回值，通常只对最后一个方法的返回值感兴趣。
:::

## 实际应用场景

### 事件处理

委托在C#中广泛用于事件处理。例如，按钮点击事件通常使用委托来处理。

```csharp
public class Button {
    public delegate void ClickHandler();
    public event ClickHandler OnClick;

    public void Click() {
        if (OnClick != null) {
            OnClick();
        }
    }
}

public class Program {
    public static void Main() {
        Button button = new Button();
        button.OnClick += () => Console.WriteLine("Button clicked!");
        button.Click(); // 输出: Button clicked!
    }
}
```

在上面的例子中，`ClickHandler` 委托用于处理按钮的点击事件。当按钮被点击时，所有注册到 `OnClick` 事件的方法都会被调用。

### 回调机制

委托还可以用于实现回调机制。例如，在异步编程中，你可以使用委托来指定操作完成后的回调方法。

```csharp
public class Calculator {
    public delegate void CalculationCompleteHandler(int result);
    public void CalculateAsync(int a, int b, CalculationCompleteHandler callback) {
        Task.Run(() => {
            int result = a + b;
            callback(result);
        });
    }
}

public class Program {
    public static void Main() {
        Calculator calculator = new Calculator();
        calculator.CalculateAsync(5, 3, result => {
            Console.WriteLine("Calculation complete: " + result); // 输出: Calculation complete: 8
        });
    }
}
```

在上面的例子中，`CalculateAsync` 方法在计算完成后调用 `callback` 委托，从而实现了异步回调。

## 总结

委托是C#中非常强大的工具，它允许你将方法作为参数传递，或者将方法存储在变量中。通过委托，你可以实现事件处理、回调机制等功能。理解委托的定义和使用是掌握C#编程的重要一步。

## 附加资源与练习

- **练习**：尝试定义一个委托，用于处理字符串操作（如拼接、反转等），并编写代码测试多播委托的功能。
- **进一步学习**：了解C#中的**Lambda表达式**，它与委托密切相关，可以简化委托的使用。

:::tip
委托是C#中实现事件驱动编程的核心工具之一。掌握委托的使用将帮助你更好地理解C#中的事件和回调机制。
:::