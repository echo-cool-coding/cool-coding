---
title: C# 委托调用
description: 了解C#中的委托调用，掌握如何定义、实例化和调用委托，并通过实际案例理解其应用场景。
---

# C# 委托调用

在C#中，**委托（Delegate）**是一种类型安全的函数指针，它允许你将方法作为参数传递或存储。委托是C#中实现事件驱动编程和回调机制的核心工具。本文将详细介绍如何定义、实例化和调用委托，并通过实际案例帮助你理解其应用场景。

## 什么是委托？

委托是一种引用类型，它可以指向一个或多个具有相同签名的方法。委托的签名由方法的返回类型和参数列表决定。通过委托，你可以将方法作为参数传递给其他方法，或者将方法存储在变量中。

### 委托的定义

在C#中，委托的定义类似于方法的声明，但使用 `delegate` 关键字。例如：

```csharp
delegate int MathOperation(int a, int b);
```

这里定义了一个名为 `MathOperation` 的委托，它可以指向任何接受两个 `int` 参数并返回 `int` 的方法。

### 委托的实例化

定义委托后，你可以创建委托的实例，并将其指向一个具体的方法。例如：

```csharp
int Add(int a, int b) {
    return a + b;
}

MathOperation operation = new MathOperation(Add);
```

在这个例子中，`operation` 委托实例指向了 `Add` 方法。

### 委托的调用

一旦委托实例化并指向了一个方法，你可以像调用普通方法一样调用委托：

```csharp
int result = operation(5, 3); // 调用委托，返回 8
```

## 委托的实际应用

委托在实际开发中有许多应用场景，例如事件处理、回调机制和多播委托。

### 事件处理

在C#中，事件是基于委托的。你可以定义一个事件，并使用委托来处理事件触发时的逻辑。例如：

```csharp
public class Button {
    public delegate void ClickHandler();
    public event ClickHandler OnClick;

    public void Click() {
        if (OnClick != null) {
            OnClick();
        }
    }
}

public class Program {
    public static void Main() {
        Button button = new Button();
        button.OnClick += () => Console.WriteLine("Button clicked!");
        button.Click(); // 输出: Button clicked!
    }
}
```

在这个例子中，`OnClick` 事件使用了一个无参数的委托 `ClickHandler`，并在按钮点击时触发。

### 回调机制

委托常用于实现回调机制，允许你在某个操作完成后执行特定的逻辑。例如：

```csharp
public class Calculator {
    public delegate void CalculationCompleteHandler(int result);
    public void Calculate(int a, int b, CalculationCompleteHandler callback) {
        int result = a + b;
        callback(result);
    }
}

public class Program {
    public static void Main() {
        Calculator calculator = new Calculator();
        calculator.Calculate(5, 3, result => Console.WriteLine($"Calculation complete: {result}"));
        // 输出: Calculation complete: 8
    }
}
```

在这个例子中，`Calculate` 方法接受一个委托作为回调函数，并在计算完成后调用它。

### 多播委托

C#中的委托支持多播，即一个委托可以指向多个方法。你可以使用 `+=` 运算符将多个方法添加到委托中：

```csharp
MathOperation operation = Add;
operation += (a, b) => a * b;

int result = operation(5, 3); // 调用所有方法，返回最后一个方法的结果 15
```

:::caution
多播委托调用时，所有方法都会被执行，但只有最后一个方法的返回值会被返回。
:::

## 总结

委托是C#中非常强大的工具，它允许你将方法作为参数传递或存储，从而实现灵活的回调机制和事件驱动编程。通过本文的学习，你应该已经掌握了如何定义、实例化和调用委托，并理解了其在实际开发中的应用场景。

### 附加资源

- [C# 官方文档 - 委托](https://learn.microsoft.com/zh-cn/dotnet/csharp/programming-guide/delegates/)
- [C# 委托与事件](https://learn.microsoft.com/zh-cn/dotnet/csharp/programming-guide/events/)

### 练习

1. 定义一个委托 `StringProcessor`，它可以指向一个接受 `string` 参数并返回 `string` 的方法。然后创建一个委托实例，指向一个将字符串转换为大写的方法，并调用它。
2. 创建一个多播委托，指向两个不同的方法，并观察调用时的行为。

通过练习，你将更深入地理解委托的使用方式和应用场景。