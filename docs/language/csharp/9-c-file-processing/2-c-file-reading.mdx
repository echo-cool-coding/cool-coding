---
title: C# 文件读取
description: "学习如何在 C# 中读取文件，掌握文件处理的基础知识，包括逐行读取、读取整个文件内容以及处理文件异常。"
---

## 介绍

在编程中，文件处理是一个非常重要的概念。无论是读取配置文件、处理日志文件，还是从文本文件中提取数据，文件读取都是必不可少的一部分。C# 提供了多种方法来读取文件内容，本文将详细介绍这些方法，并通过示例代码帮助你理解如何在实际项目中使用它们。

## 文件读取的基本方法

在 C# 中，文件读取通常使用 `System.IO` 命名空间中的类来实现。最常用的类是 `File` 和 `StreamReader`。我们将从简单的文件读取开始，逐步深入。

### 1. 使用 `File.ReadAllText` 读取整个文件

`File.ReadAllText` 是一个简单的方法，它可以将整个文件的内容读取为一个字符串。这种方法适用于文件较小的情况。

```csharp
using System;
using System.IO;

class Program
{
    static void Main()
    {
        string filePath = "example.txt";
        string content = File.ReadAllText(filePath);
        Console.WriteLine(content);
    }
}
```

**输入文件 (example.txt):**
```
Hello, World!
This is a sample text file.
```

**输出:**
```
Hello, World!
This is a sample text file.
```

:::note
`File.ReadAllText` 会一次性将整个文件加载到内存中，因此不适合处理非常大的文件。
:::

### 2. 使用 `File.ReadAllLines` 逐行读取文件

如果你需要逐行处理文件内容，可以使用 `File.ReadAllLines` 方法。它会将文件的每一行读取为一个字符串数组。

```csharp
using System;
using System.IO;

class Program
{
    static void Main()
    {
        string filePath = "example.txt";
        string[] lines = File.ReadAllLines(filePath);
        foreach (string line in lines)
        {
            Console.WriteLine(line);
        }
    }
}
```

**输出:**
```
Hello, World!
This is a sample text file.
```

:::tip
`File.ReadAllLines` 适合处理需要逐行分析的文件，例如日志文件或 CSV 文件。
:::

### 3. 使用 `StreamReader` 逐行读取文件

对于大文件，逐行读取文件内容时，使用 `StreamReader` 是更好的选择。`StreamReader` 不会一次性将整个文件加载到内存中，而是逐行读取。

```csharp
using System;
using System.IO;

class Program
{
    static void Main()
    {
        string filePath = "example.txt";
        using (StreamReader reader = new StreamReader(filePath))
        {
            string line;
            while ((line = reader.ReadLine()) != null)
            {
                Console.WriteLine(line);
            }
        }
    }
}
```

**输出:**
```
Hello, World!
This is a sample text file.
```

:::caution
使用 `StreamReader` 时，务必使用 `using` 语句来确保文件流在使用后被正确关闭。
:::

## 处理文件异常

在文件读取过程中，可能会遇到各种异常情况，例如文件不存在、文件被占用或权限不足。为了确保程序的健壮性，我们需要处理这些异常。

```csharp
using System;
using System.IO;

class Program
{
    static void Main()
    {
        string filePath = "nonexistent.txt";
        try
        {
            string content = File.ReadAllText(filePath);
            Console.WriteLine(content);
        }
        catch (FileNotFoundException)
        {
            Console.WriteLine("文件未找到。");
        }
        catch (UnauthorizedAccessException)
        {
            Console.WriteLine("没有访问文件的权限。");
        }
        catch (IOException ex)
        {
            Console.WriteLine($"发生IO错误: {ex.Message}");
        }
    }
}
```

**输出:**
```
文件未找到。
```

:::warning
在实际应用中，始终要处理可能的异常情况，以避免程序崩溃。
:::

## 实际应用案例

假设你正在开发一个日志分析工具，需要从日志文件中提取特定信息。以下是一个简单的示例，展示如何使用 `StreamReader` 逐行读取日志文件并提取包含 "ERROR" 的行。

```csharp
using System;
using System.IO;

class Program
{
    static void Main()
    {
        string logFilePath = "logfile.txt";
        using (StreamReader reader = new StreamReader(logFilePath))
        {
            string line;
            while ((line = reader.ReadLine()) != null)
            {
                if (line.Contains("ERROR"))
                {
                    Console.WriteLine(line);
                }
            }
        }
    }
}
```

**输入文件 (logfile.txt):**
```
INFO: Application started.
ERROR: Failed to connect to database.
INFO: User logged in.
ERROR: File not found.
```

**输出:**
```
ERROR: Failed to connect to database.
ERROR: File not found.
```

## 总结

在本文中，我们学习了如何在 C# 中读取文件。我们介绍了三种主要的文件读取方法：`File.ReadAllText`、`File.ReadAllLines` 和 `StreamReader`，并讨论了如何处理文件读取过程中可能出现的异常。通过这些方法，你可以轻松地处理各种文件读取任务。

## 附加资源与练习

- **练习 1**: 编写一个程序，读取一个 CSV 文件并计算每行的列数。
- **练习 2**: 修改日志分析工具，使其能够统计日志文件中 "ERROR" 出现的次数。
- **附加资源**: 查阅 [Microsoft 官方文档](https://docs.microsoft.com/en-us/dotnet/api/system.io.file?view=net-6.0) 以了解更多关于 `File` 类的详细信息。

通过不断练习和探索，你将能够熟练掌握 C# 中的文件处理技巧。