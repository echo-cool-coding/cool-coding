---
title: C# 设计模式
description: 了解C#中的设计模式，掌握如何通过设计模式解决常见软件设计问题，提升代码的可维护性和可扩展性。
---

## 介绍

设计模式是软件开发中用于解决常见问题的可重用解决方案。它们提供了一种标准化的方式来组织代码，使代码更易于理解、维护和扩展。C#作为一种面向对象的编程语言，非常适合使用设计模式来构建复杂的应用程序。

在本教程中，我们将探讨几种常见的设计模式，并通过实际案例展示它们在C#中的应用。

## 设计模式的分类

设计模式通常分为三大类：

1. **创建型模式**：处理对象创建的模式，例如单例模式、工厂模式。
2. **结构型模式**：处理类或对象组合的模式，例如适配器模式、装饰器模式。
3. **行为型模式**：处理对象之间的职责分配和通信的模式，例如观察者模式、策略模式。

## 创建型模式：单例模式

单例模式确保一个类只有一个实例，并提供一个全局访问点。这在需要全局状态或共享资源时非常有用。

### 代码示例

```csharp
public class Singleton
{
    private static Singleton _instance;

    // 私有构造函数防止外部实例化
    private Singleton() { }

    public static Singleton Instance
    {
        get
        {
            if (_instance == null)
            {
                _instance = new Singleton();
            }
            return _instance;
        }
    }
}
```

### 使用场景

单例模式常用于日志记录、配置管理、数据库连接池等场景。

:::note
单例模式在多线程环境下需要特别注意线程安全问题。
:::

## 结构型模式：适配器模式

适配器模式允许不兼容的接口之间进行协作。它通过将一个类的接口转换成客户端期望的另一个接口来实现。

### 代码示例

```csharp
public interface ITarget
{
    void Request();
}

public class Adaptee
{
    public void SpecificRequest()
    {
        Console.WriteLine("Specific Request");
    }
}

public class Adapter : ITarget
{
    private readonly Adaptee _adaptee;

    public Adapter(Adaptee adaptee)
    {
        _adaptee = adaptee;
    }

    public void Request()
    {
        _adaptee.SpecificRequest();
    }
}
```

### 使用场景

适配器模式常用于集成第三方库或遗留代码时，使它们能够与现有系统协同工作。

## 行为型模式：观察者模式

观察者模式定义了一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖它的对象都会收到通知并自动更新。

### 代码示例

```csharp
public interface IObserver
{
    void Update();
}

public class Subject
{
    private List<IObserver> _observers = new List<IObserver>();

    public void Attach(IObserver observer)
    {
        _observers.Add(observer);
    }

    public void Detach(IObserver observer)
    {
        _observers.Remove(observer);
    }

    public void Notify()
    {
        foreach (var observer in _observers)
        {
            observer.Update();
        }
    }
}

public class ConcreteObserver : IObserver
{
    public void Update()
    {
        Console.WriteLine("Observer notified!");
    }
}
```

### 使用场景

观察者模式常用于事件处理系统、消息队列等场景。

## 实际案例

假设我们正在开发一个电子商务网站，我们需要管理用户的购物车。我们可以使用观察者模式来通知用户购物车中的商品价格变化。

```csharp
public class ShoppingCart : Subject
{
    private decimal _totalPrice;

    public decimal TotalPrice
    {
        get => _totalPrice;
        set
        {
            _totalPrice = value;
            Notify();
        }
    }
}

public class User : IObserver
{
    public void Update()
    {
        Console.WriteLine("Shopping cart total price updated!");
    }
}
```

在这个例子中，当购物车的总价格发生变化时，所有观察者（用户）都会收到通知。

## 总结

设计模式是软件开发中的重要工具，它们帮助我们解决常见的设计问题，并提高代码的可维护性和可扩展性。通过本教程，我们学习了单例模式、适配器模式和观察者模式，并通过实际案例展示了它们在C#中的应用。

## 附加资源

- [设计模式：可复用面向对象软件的基础](https://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612)
- [C#设计模式教程](https://www.tutorialspoint.com/design_pattern/index.htm)

## 练习

1. 实现一个工厂模式，用于创建不同类型的日志记录器（如文件日志、控制台日志）。
2. 使用装饰器模式为现有的类添加新的功能，而不修改其原始代码。
3. 实现一个策略模式，用于在不同的排序算法之间切换。

:::tip
尝试在实际项目中应用这些设计模式，以加深对它们的理解。
:::