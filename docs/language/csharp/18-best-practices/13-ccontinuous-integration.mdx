---
title: C# 持续集成
description: 了解如何在 C# 项目中实现持续集成（CI），确保代码质量并加速开发流程。本文适合初学者，包含概念解释、代码示例和实际案例。
---

# C# 持续集成

持续集成（Continuous Integration，简称 CI）是一种软件开发实践，旨在通过频繁地将代码集成到共享仓库中，并自动运行测试和构建流程，来尽早发现和修复问题。对于 C# 开发者来说，持续集成可以帮助确保代码质量、减少集成问题，并加速交付流程。

## 什么是持续集成？

持续集成的核心思想是**频繁地将代码变更集成到主分支**，并通过自动化工具验证这些变更。每次代码提交后，CI 系统会自动执行以下操作：

1. **拉取最新代码**：从版本控制系统中获取最新的代码变更。
2. **运行构建**：编译项目并生成可执行文件或库。
3. **运行测试**：执行单元测试、集成测试等，确保代码功能正常。
4. **生成报告**：提供构建和测试结果的反馈，帮助开发者快速定位问题。

通过持续集成，团队可以更快地发现和修复问题，从而减少集成风险并提高代码质量。

---

## 如何为 C# 项目设置持续集成？

以下是实现 C# 持续集成的关键步骤：

### 1. 选择 CI 工具
常见的 CI 工具包括：
- **GitHub Actions**：与 GitHub 深度集成，适合开源项目。
- **Azure DevOps Pipelines**：适合企业级项目，支持多种平台。
- **Jenkins**：开源且高度可定制，适合复杂项目。

### 2. 配置 CI 流程
以 GitHub Actions 为例，以下是一个简单的 `.github/workflows/build.yml` 配置文件：

```yaml
name: C# CI Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '6.0.x'

    - name: Restore dependencies
      run: dotnet restore

    - name: Build the project
      run: dotnet build --no-restore

    - name: Run tests
      run: dotnet test --no-build --verbosity normal
```

### 3. 运行构建和测试
每次代码推送到 `main` 分支或创建拉取请求时，GitHub Actions 会自动执行以下操作：
1. 拉取代码。
2. 安装 .NET SDK。
3. 还原项目依赖。
4. 构建项目。
5. 运行测试。

:::tip
确保你的项目包含单元测试（例如使用 xUnit 或 NUnit），以便 CI 流程能够验证代码的正确性。
:::

---

## 实际案例：为 C# Web API 项目设置 CI

假设你有一个简单的 C# Web API 项目，以下是实现持续集成的步骤：

### 1. 创建项目
使用以下命令创建一个新的 Web API 项目：

```bash
dotnet new webapi -n MyWebApi
```

### 2. 添加单元测试
使用 xUnit 添加单元测试：

```bash
dotnet new xunit -n MyWebApi.Tests
dotnet add MyWebApi.Tests reference MyWebApi
```

### 3. 配置 GitHub Actions
在项目根目录下创建 `.github/workflows/build.yml` 文件，内容如下：

```yaml
name: C# Web API CI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '6.0.x'

    - name: Restore dependencies
      run: dotnet restore

    - name: Build the project
      run: dotnet build --no-restore

    - name: Run tests
      run: dotnet test --no-build --verbosity normal
```

### 4. 提交代码并观察 CI 运行
将代码推送到 GitHub 仓库后，GitHub Actions 会自动运行 CI 流程。你可以在 GitHub 的 "Actions" 选项卡中查看构建和测试结果。

---

## 持续集成的好处

1. **快速反馈**：每次提交后立即运行测试，帮助开发者快速发现问题。
2. **减少集成问题**：频繁集成代码可以减少合并冲突和集成错误。
3. **提高代码质量**：通过自动化测试确保代码功能正常。
4. **加速交付**：自动化构建和测试流程缩短了开发周期。

---

## 总结

持续集成是现代软件开发中不可或缺的一部分。通过为 C# 项目设置 CI，你可以确保代码质量、减少集成问题，并加速交付流程。本文介绍了如何使用 GitHub Actions 实现 C# 持续集成，并提供了一个实际案例供参考。

:::note
如果你对持续集成感兴趣，可以进一步探索以下主题：
- 持续交付（Continuous Delivery，CD）
- 自动化部署
- 代码覆盖率分析
:::

---

## 附加资源

1. [GitHub Actions 官方文档](https://docs.github.com/en/actions)
2. [.NET CLI 参考](https://learn.microsoft.com/en-us/dotnet/core/tools/)
3. [xUnit 测试框架](https://xunit.net/)

---

## 练习

1. 创建一个简单的 C# 控制台应用程序，并为其设置持续集成。
2. 尝试使用 Azure DevOps Pipelines 或 Jenkins 配置 CI 流程。
3. 为你的项目添加更多的单元测试，并观察 CI 流程如何验证代码质量。

祝你学习愉快！