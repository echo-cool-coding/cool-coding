---
title: C# 泛型方法
description: 了解 C# 中的泛型方法，掌握如何编写灵活且类型安全的代码。本文将从基础概念讲起，逐步深入，并通过实际案例展示泛型方法的应用场景。
---

## 介绍

在 C# 中，泛型方法是一种允许你在方法中使用类型参数的技术。通过泛型方法，你可以编写出更加灵活且类型安全的代码，而无需为每种类型编写重复的方法。泛型方法的核心思想是：**将类型作为参数传递**，从而让方法能够处理多种类型的数据。

泛型方法在集合类（如 `List<T>`、`Dictionary<TKey, TValue>`）中广泛使用，但你也可以在自己的代码中定义和使用泛型方法。

## 泛型方法的基本语法

在 C# 中，泛型方法的定义方式与普通方法类似，只是在方法名后面添加了类型参数。类型参数用尖括号 `<>` 包裹，通常使用 `T` 作为占位符（尽管你可以使用任何有效的标识符）。

以下是一个简单的泛型方法示例：

```csharp
public T GetMax<T>(T a, T b) where T : IComparable<T>
{
    return a.CompareTo(b) > 0 ? a : b;
}
```

在这个例子中，`T` 是类型参数，`where T : IComparable<T>` 是类型约束，确保 `T` 实现了 `IComparable<T>` 接口，从而可以使用 `CompareTo` 方法进行比较。

### 调用泛型方法

调用泛型方法时，你可以显式指定类型参数，也可以让编译器根据传入的参数类型自动推断类型：

```csharp
int maxInt = GetMax(3, 5); // 编译器推断 T 为 int
double maxDouble = GetMax(3.5, 5.2); // 编译器推断 T 为 double
```

## 类型约束

泛型方法可以包含类型约束，以限制类型参数的范围。类型约束可以确保类型参数具有某些特性，例如实现特定接口或继承特定类。常见的类型约束包括：

- `where T : struct`：`T` 必须是值类型。
- `where T : class`：`T` 必须是引用类型。
- `where T : new()`：`T` 必须具有无参构造函数。
- `where T : <基类名>`：`T` 必须继承自指定的基类。
- `where T : <接口名>`：`T` 必须实现指定的接口。

以下是一个带有多个类型约束的泛型方法示例：

```csharp
public T CreateInstance<T>() where T : class, new()
{
    return new T();
}
```

在这个例子中，`T` 必须是引用类型，并且必须具有无参构造函数。

## 实际案例：泛型方法在集合操作中的应用

假设你正在编写一个工具类，用于处理集合中的元素。你可以使用泛型方法来编写一个通用的 `Find` 方法，用于在集合中查找满足特定条件的元素：

```csharp
public T Find<T>(IEnumerable<T> collection, Func<T, bool> predicate)
{
    foreach (var item in collection)
    {
        if (predicate(item))
        {
            return item;
        }
    }
    throw new InvalidOperationException("No matching element found.");
}
```

这个方法可以用于任何类型的集合，只要传入的 `predicate` 函数能够处理该类型的元素。例如：

```csharp
List<int> numbers = new List<int> { 1, 2, 3, 4, 5 };
int firstEvenNumber = Find(numbers, n => n % 2 == 0); // 返回 2
```

## 总结

泛型方法是 C# 中非常强大的特性，它允许你编写灵活且类型安全的代码。通过使用类型参数和类型约束，你可以创建出能够处理多种类型数据的方法，而无需为每种类型编写重复的代码。

在实际开发中，泛型方法广泛应用于集合操作、数据转换、算法实现等场景。掌握泛型方法的使用，将帮助你编写出更加高效和可维护的代码。

## 附加资源与练习

- **练习 1**：编写一个泛型方法 `Swap<T>`，用于交换两个变量的值。
- **练习 2**：创建一个泛型方法 `Filter<T>`，用于过滤集合中满足特定条件的元素，并返回一个新的集合。
- **进一步学习**：阅读 [C# 泛型文档](https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/generics/) 以深入了解泛型的更多高级特性。

:::tip
如果你对泛型方法还有疑问，建议尝试编写一些简单的示例代码，并在调试器中逐步执行，观察类型参数的行为。
:::