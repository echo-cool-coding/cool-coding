---
title: C# 异常处理基础
description: 学习C#中的异常处理机制，掌握如何使用try-catch-finally语句捕获和处理异常，确保程序的健壮性。
---

## 介绍

在编写程序时，难免会遇到一些意外情况，例如文件不存在、网络连接失败或除以零等错误。这些意外情况被称为**异常**。如果不处理这些异常，程序可能会崩溃或产生不可预料的行为。C#提供了强大的异常处理机制，允许开发者捕获并处理这些异常，从而确保程序的稳定性和健壮性。

本文将介绍C#中的异常处理基础，包括如何使用`try-catch-finally`语句、常见的异常类型以及如何在实际应用中使用异常处理。

## 异常处理的基本结构

C#中的异常处理主要通过`try-catch-finally`语句来实现。其基本结构如下：

```csharp
try
{
    // 可能会抛出异常的代码
}
catch (ExceptionType ex)
{
    // 处理异常的代码
}
finally
{
    // 无论是否发生异常，都会执行的代码
}
```

- `try`块：包含可能会抛出异常的代码。
- `catch`块：捕获并处理特定类型的异常。
- `finally`块：无论是否发生异常，都会执行的代码，通常用于释放资源。

### 示例：捕获除以零异常

```csharp
try
{
    int a = 10;
    int b = 0;
    int result = a / b; // 这里会抛出 DivideByZeroException
}
catch (DivideByZeroException ex)
{
    Console.WriteLine("发生除以零异常: " + ex.Message);
}
finally
{
    Console.WriteLine("finally 块执行完毕。");
}
```

**输出：**
```
发生除以零异常: Attempted to divide by zero.
finally 块执行完毕。
```

:::note
`finally`块是可选的，但通常用于确保资源的释放，例如关闭文件或数据库连接。
:::

## 常见的异常类型

C#中有许多内置的异常类型，以下是一些常见的异常：

- `System.Exception`：所有异常的基类。
- `System.NullReferenceException`：尝试访问空引用时抛出。
- `System.ArgumentNullException`：当方法参数为`null`时抛出。
- `System.ArgumentOutOfRangeException`：当参数超出有效范围时抛出。
- `System.DivideByZeroException`：除以零时抛出。
- `System.IO.FileNotFoundException`：尝试访问不存在的文件时抛出。

### 示例：捕获多个异常

```csharp
try
{
    string filePath = "nonexistent.txt";
    string content = File.ReadAllText(filePath); // 这里会抛出 FileNotFoundException
}
catch (FileNotFoundException ex)
{
    Console.WriteLine("文件未找到: " + ex.Message);
}
catch (Exception ex)
{
    Console.WriteLine("发生未知异常: " + ex.Message);
}
finally
{
    Console.WriteLine("finally 块执行完毕。");
}
```

**输出：**
```
文件未找到: Could not find file 'nonexistent.txt'.
finally 块执行完毕。
```

:::tip
在捕获多个异常时，应该从最具体的异常类型开始捕获，最后捕获`System.Exception`，以确保所有异常都能被处理。
:::

## 实际应用场景

### 场景1：文件读取

在文件读取操作中，可能会遇到文件不存在或权限不足等问题。使用异常处理可以优雅地处理这些问题。

```csharp
try
{
    string filePath = "data.txt";
    string content = File.ReadAllText(filePath);
    Console.WriteLine("文件内容: " + content);
}
catch (FileNotFoundException)
{
    Console.WriteLine("文件未找到，请检查文件路径。");
}
catch (UnauthorizedAccessException)
{
    Console.WriteLine("没有权限访问该文件。");
}
catch (Exception ex)
{
    Console.WriteLine("发生未知错误: " + ex.Message);
}
```

### 场景2：用户输入验证

在处理用户输入时，可能会遇到格式错误或无效输入。使用异常处理可以确保程序不会因为无效输入而崩溃。

```csharp
try
{
    Console.Write("请输入一个整数: ");
    string input = Console.ReadLine();
    int number = int.Parse(input); // 这里可能会抛出 FormatException
    Console.WriteLine("你输入的整数是: " + number);
}
catch (FormatException)
{
    Console.WriteLine("输入的不是有效的整数。");
}
catch (Exception ex)
{
    Console.WriteLine("发生未知错误: " + ex.Message);
}
```

## 总结

异常处理是C#编程中非常重要的一部分，它可以帮助我们捕获和处理程序运行时的意外情况，从而提高程序的健壮性和稳定性。通过使用`try-catch-finally`语句，我们可以有效地处理各种异常，并确保资源的正确释放。

:::caution
虽然异常处理非常有用，但过度使用异常处理可能会导致性能问题。因此，应该尽量避免使用异常来控制程序的正常流程。
:::

## 附加资源与练习

- **练习1**：编写一个程序，要求用户输入两个整数并计算它们的商。使用异常处理来捕获除以零和无效输入的情况。
- **练习2**：编写一个程序，尝试打开一个文件并读取其内容。使用异常处理来捕获文件不存在和权限不足的情况。

通过练习这些例子，你将更好地理解C#中的异常处理机制，并能够在实际项目中应用这些知识。