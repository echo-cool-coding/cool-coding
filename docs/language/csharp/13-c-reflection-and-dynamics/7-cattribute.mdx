---
title: C# 特性(Attribute)
description: "了解C#中的特性(Attribute)，掌握如何使用它们为代码添加元数据，并通过实际案例展示其应用场景。"
---

## 介绍

在C#中，**特性(Attribute)**是一种用于为代码元素（如类、方法、属性等）添加元数据的机制。元数据是描述数据的数据，它不会直接影响程序的执行，但可以在运行时通过反射来访问。特性通常用于提供额外的信息，例如标记方法为过时、指定序列化行为或控制调试器的行为。

特性是C#中非常强大的工具，它们可以帮助开发者在代码中添加更多的上下文信息，从而使代码更具可读性和可维护性。

## 基本语法

在C#中，特性是通过在代码元素前使用方括号 `[ ]` 来声明的。例如：

```csharp
[Obsolete("This method is deprecated. Use NewMethod instead.")]
public void OldMethod()
{
    // Method implementation
}
```

在这个例子中，`[Obsolete]` 特性用于标记 `OldMethod` 为过时方法，并提供了一个消息，提示开发者应该使用 `NewMethod` 代替。

## 常用内置特性

C# 提供了许多内置特性，以下是一些常见的例子：

### 1. `[Obsolete]`

`[Obsolete]` 特性用于标记代码元素为过时。它可以接受一个可选的字符串参数，用于提供过时的原因或替代方案。

```csharp
[Obsolete("This method is deprecated. Use NewMethod instead.")]
public void OldMethod()
{
    Console.WriteLine("This is the old method.");
}

public void NewMethod()
{
    Console.WriteLine("This is the new method.");
}
```

当你尝试调用 `OldMethod` 时，编译器会发出警告：

```plaintext
warning CS0618: 'Program.OldMethod()' is obsolete: 'This method is deprecated. Use NewMethod instead.'
```

### 2. `[Serializable]`

`[Serializable]` 特性用于标记一个类可以被序列化。序列化是将对象转换为字节流的过程，通常用于存储或传输数据。

```csharp
[Serializable]
public class Person
{
    public string Name { get; set; }
    public int Age { get; set; }
}
```

### 3. `[Conditional]`

`[Conditional]` 特性用于条件编译。它允许你根据预定义的编译符号来决定是否调用某个方法。

```csharp
#define DEBUG

public class Program
{
    [Conditional("DEBUG")]
    public static void Log(string message)
    {
        Console.WriteLine(message);
    }

    public static void Main()
    {
        Log("This is a debug message.");
    }
}
```

如果 `DEBUG` 符号被定义，`Log` 方法会被调用；否则，它会被忽略。

## 自定义特性

除了使用内置特性，你还可以创建自定义特性。自定义特性是通过继承 `System.Attribute` 类来实现的。

```csharp
[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, AllowMultiple = true)]
public class AuthorAttribute : Attribute
{
    public string Name { get; }
    public double Version { get; set; }

    public AuthorAttribute(string name)
    {
        Name = name;
    }
}
```

在这个例子中，我们定义了一个 `AuthorAttribute` 特性，它可以应用于类或方法，并且允许多次使用。`AttributeUsage` 特性用于指定自定义特性的使用范围。

### 使用自定义特性

```csharp
[Author("John Doe", Version = 1.0)]
public class MyClass
{
    [Author("Jane Doe", Version = 1.1)]
    public void MyMethod()
    {
        // Method implementation
    }
}
```

## 通过反射访问特性

特性本身不会改变代码的行为，但你可以通过反射在运行时访问它们。

```csharp
Type type = typeof(MyClass);
var attributes = type.GetCustomAttributes(typeof(AuthorAttribute), false);

foreach (AuthorAttribute attr in attributes)
{
    Console.WriteLine($"Author: {attr.Name}, Version: {attr.Version}");
}
```

输出：

```plaintext
Author: John Doe, Version: 1
```

## 实际应用场景

### 1. 数据验证

特性可以用于数据验证。例如，你可以创建一个 `[Range]` 特性来验证属性的值是否在指定范围内。

```csharp
[AttributeUsage(AttributeTargets.Property)]
public class RangeAttribute : Attribute
{
    public int Min { get; }
    public int Max { get; }

    public RangeAttribute(int min, int max)
    {
        Min = min;
        Max = max;
    }
}

public class Product
{
    [Range(1, 100)]
    public int Quantity { get; set; }
}
```

### 2. Web API 路由

在ASP.NET Core中，特性广泛用于定义Web API的路由和行为。

```csharp
[ApiController]
[Route("api/[controller]")]
public class ProductsController : ControllerBase
{
    [HttpGet("{id}")]
    public IActionResult GetProduct(int id)
    {
        // Retrieve product by id
        return Ok(new Product { Id = id, Name = "Sample Product" });
    }
}
```

## 总结

C# 特性是一种强大的工具，它允许开发者为代码元素添加元数据。通过使用内置特性和自定义特性，你可以为代码添加更多的上下文信息，从而增强代码的可读性和可维护性。特性在数据验证、Web API 路由等场景中有着广泛的应用。

## 附加资源

- [C# Attributes - Microsoft Docs](https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/attributes/)
- [Creating Custom Attributes in C#](https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/attributes/creating-custom-attributes)

## 练习

1. 创建一个自定义特性 `[Description]`，用于为类或方法添加描述信息。
2. 使用反射访问 `[Description]` 特性，并输出描述信息。
3. 尝试在ASP.NET Core项目中使用 `[HttpGet]` 和 `[HttpPost]` 特性定义路由。

通过完成这些练习，你将更深入地理解C#特性的工作原理和应用场景。