---
title: C# 访问属性与字段
description: 了解如何在C#中使用反射访问类的属性和字段，掌握动态获取和操作对象成员的方法。
---

## 介绍

在C#中，反射（Reflection）是一种强大的机制，允许我们在运行时动态地获取和操作类型信息。通过反射，我们可以访问类的属性（Property）和字段（Field），即使这些成员在编译时是未知的。这对于编写通用代码、插件系统或动态加载程序集等场景非常有用。

本文将逐步讲解如何使用反射访问C#中的属性和字段，并通过实际案例展示其应用场景。

## 访问属性

### 获取属性信息

要访问类的属性，首先需要获取该类的 `Type` 对象。然后，可以使用 `GetProperty` 或 `GetProperties` 方法获取属性的信息。

```csharp
using System;
using System.Reflection;

public class Person
{
    public string Name { get; set; }
    public int Age { get; set; }
}

class Program
{
    static void Main()
    {
        Type personType = typeof(Person);
        PropertyInfo nameProperty = personType.GetProperty("Name");

        Console.WriteLine($"Property Name: {nameProperty.Name}");
        Console.WriteLine($"Property Type: {nameProperty.PropertyType}");
    }
}
```

**输出：**
```
Property Name: Name
Property Type: System.String
```

### 获取和设置属性值

通过 `GetValue` 和 `SetValue` 方法，可以动态地获取和设置属性的值。

```csharp
Person person = new Person { Name = "Alice", Age = 30 };

PropertyInfo ageProperty = personType.GetProperty("Age");
int age = (int)ageProperty.GetValue(person);
Console.WriteLine($"Current Age: {age}");

ageProperty.SetValue(person, 31);
Console.WriteLine($"Updated Age: {person.Age}");
```

**输出：**
```
Current Age: 30
Updated Age: 31
```

## 访问字段

### 获取字段信息

与属性类似，可以使用 `GetField` 或 `GetFields` 方法获取字段的信息。

```csharp
public class Employee
{
    public string Department;
    private double Salary;
}

class Program
{
    static void Main()
    {
        Type employeeType = typeof(Employee);
        FieldInfo departmentField = employeeType.GetField("Department");

        Console.WriteLine($"Field Name: {departmentField.Name}");
        Console.WriteLine($"Field Type: {departmentField.FieldType}");
    }
}
```

**输出：**
```
Field Name: Department
Field Type: System.String
```

### 获取和设置字段值

通过 `GetValue` 和 `SetValue` 方法，可以动态地获取和设置字段的值。

```csharp
Employee employee = new Employee { Department = "HR" };

FieldInfo departmentField = employeeType.GetField("Department");
string department = (string)departmentField.GetValue(employee);
Console.WriteLine($"Current Department: {department}");

departmentField.SetValue(employee, "Finance");
Console.WriteLine($"Updated Department: {employee.Department}");
```

**输出：**
```
Current Department: HR
Updated Department: Finance
```

:::note
注意：访问私有字段时，需要指定 `BindingFlags.NonPublic | BindingFlags.Instance` 标志。
:::

```csharp
FieldInfo salaryField = employeeType.GetField("Salary", BindingFlags.NonPublic | BindingFlags.Instance);
double salary = (double)salaryField.GetValue(employee);
Console.WriteLine($"Current Salary: {salary}");
```

## 实际案例

### 动态表单生成

假设我们有一个动态表单生成器，需要根据用户输入的类名和属性名生成表单字段。通过反射，我们可以动态地获取类的属性信息，并生成相应的表单控件。

```csharp
public class User
{
    public string Username { get; set; }
    public string Email { get; set; }
    public DateTime BirthDate { get; set; }
}

public static void GenerateForm(Type type)
{
    foreach (var property in type.GetProperties())
    {
        Console.WriteLine($"<input type='text' name='{property.Name}' placeholder='{property.Name}' />");
    }
}

class Program
{
    static void Main()
    {
        GenerateForm(typeof(User));
    }
}
```

**输出：**
```
<input type='text' name='Username' placeholder='Username' />
<input type='text' name='Email' placeholder='Email' />
<input type='text' name='BirthDate' placeholder='BirthDate' />
```

## 总结

通过反射，我们可以在运行时动态地访问和操作类的属性和字段。这在编写通用代码、插件系统或动态加载程序集等场景中非常有用。然而，反射的性能开销较大，因此在性能敏感的场景中应谨慎使用。

## 附加资源

- [C# 反射官方文档](https://learn.microsoft.com/zh-cn/dotnet/csharp/programming-guide/concepts/reflection)
- [C# 属性和字段的区别](https://learn.microsoft.com/zh-cn/dotnet/csharp/programming-guide/classes-and-structs/fields)

## 练习

1. 编写一个程序，使用反射获取一个类的所有属性，并打印它们的名称和类型。
2. 修改上述程序，使其能够动态地设置和获取私有字段的值。
3. 创建一个动态表单生成器，根据用户输入的类名生成相应的表单字段。

通过完成这些练习，您将更好地理解C#中的反射机制及其在实际开发中的应用。