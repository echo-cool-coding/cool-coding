---
title: C# ExpandoObject
description: "了解 C# 中的 ExpandoObject，掌握如何使用动态对象在运行时添加属性和方法。"
---

## 介绍

在 C# 中，`ExpandoObject` 是一个动态对象，允许你在运行时动态添加或删除属性和方法。与传统的静态类型对象不同，`ExpandoObject` 提供了极大的灵活性，特别适用于处理不确定结构的数据或需要在运行时动态扩展对象的场景。

`ExpandoObject` 实现了 `IDynamicMetaObjectProvider` 接口，这意味着它可以与 C# 的动态类型（`dynamic`）一起使用，从而实现动态绑定。

## 基本用法

### 创建 ExpandoObject

要创建一个 `ExpandoObject`，只需实例化它即可：

```csharp
dynamic person = new ExpandoObject();
```

### 添加属性

你可以像访问普通对象的属性一样，为 `ExpandoObject` 添加属性：

```csharp
person.Name = "John";
person.Age = 30;
```

### 访问属性

添加属性后，你可以像访问普通对象的属性一样访问它们：

```csharp
Console.WriteLine($"Name: {person.Name}, Age: {person.Age}");
```

**输出：**

```
Name: John, Age: 30
```

### 添加方法

你还可以为 `ExpandoObject` 添加方法。方法可以是匿名函数或 lambda 表达式：

```csharp
person.SayHello = new Action(() => Console.WriteLine("Hello!"));
person.SayHello();
```

**输出：**

```
Hello!
```

## 动态扩展对象

`ExpandoObject` 的强大之处在于它允许你在运行时动态扩展对象。例如，你可以根据某些条件动态添加属性：

```csharp
if (someCondition)
{
    person.Address = "123 Main St";
}
```

### 删除属性

你还可以在运行时删除属性：

```csharp
var personDict = (IDictionary<string, object>)person;
personDict.Remove("Address");
```

## 实际应用场景

### 动态数据绑定

`ExpandoObject` 常用于需要动态数据绑定的场景，例如处理 JSON 数据或与动态语言（如 JavaScript）交互时。假设你从 API 获取了一个 JSON 对象，但你不确定它的结构，你可以使用 `ExpandoObject` 来动态处理它：

```csharp
dynamic data = new ExpandoObject();
data.Name = "Alice";
data.Age = 25;
data.IsActive = true;

// 模拟从 API 获取的数据
var json = JsonConvert.SerializeObject(data);
var dynamicData = JsonConvert.DeserializeObject<ExpandoObject>(json);

Console.WriteLine($"Name: {dynamicData.Name}, Age: {dynamicData.Age}");
```

**输出：**

```
Name: Alice, Age: 25
```

### 动态配置

在某些情况下，你可能需要根据用户输入或配置文件动态创建对象。`ExpandoObject` 可以帮助你轻松实现这一点：

```csharp
dynamic config = new ExpandoObject();
config.Theme = "Dark";
config.FontSize = 14;
config.ShowNotifications = true;

// 根据配置动态调整应用程序行为
if (config.ShowNotifications)
{
    Console.WriteLine("Notifications are enabled.");
}
```

**输出：**

```
Notifications are enabled.
```

## 总结

`ExpandoObject` 是 C# 中一个非常有用的工具，特别适用于需要在运行时动态扩展对象的场景。它提供了极大的灵活性，允许你在运行时添加或删除属性和方法。虽然它的使用场景相对有限，但在处理动态数据或需要动态配置的情况下，`ExpandoObject` 可以大大简化代码。

## 附加资源与练习

- **练习 1**：创建一个 `ExpandoObject`，并动态添加多个属性和方法。尝试在运行时删除其中一个属性。
- **练习 2**：使用 `ExpandoObject` 处理一个模拟的 JSON 数据，并动态访问其中的属性。
- **进一步阅读**：查阅 [C# 动态编程指南](https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/types/using-type-dynamic) 以了解更多关于动态类型和 `ExpandoObject` 的高级用法。

:::tip
在使用 `ExpandoObject` 时，请注意性能问题。由于它是动态类型，编译器无法进行静态类型检查，因此在性能敏感的场景中应谨慎使用。
:::