---
title: C# LINQ to SQL
description: "了解如何使用 C# 中的 LINQ to SQL 进行数据库编程，适合初学者的全面指南。"
---

# C# LINQ to SQL

## 介绍

LINQ to SQL 是 C# 中一种强大的技术，它允许开发者使用 LINQ（Language Integrated Query）查询和操作关系数据库中的数据。通过 LINQ to SQL，你可以将数据库表映射到 C# 类，并使用 LINQ 查询语法来执行数据库操作，而无需编写复杂的 SQL 语句。

LINQ to SQL 的核心思想是将数据库表与 C# 类进行映射，使得开发者可以使用面向对象的方式来操作数据库。这种方式不仅简化了代码，还提高了代码的可读性和可维护性。

## LINQ to SQL 的基本概念

### 数据上下文（DataContext）

`DataContext` 是 LINQ to SQL 的核心类，它负责管理与数据库的连接，并跟踪对数据库的更改。你可以将 `DataContext` 看作是一个数据库的抽象，它提供了对数据库表的访问，并允许你执行查询、插入、更新和删除操作。

```csharp
using System.Data.Linq;

public class NorthwindDataContext : DataContext
{
    public Table<Customer> Customers;
    public Table<Order> Orders;

    public NorthwindDataContext(string connection) : base(connection) { }
}
```

### 实体类（Entity Classes）

实体类是数据库表的映射类。每个实体类对应数据库中的一张表，类的属性对应表中的列。通过实体类，你可以以面向对象的方式操作数据库中的数据。

```csharp
[Table(Name = "Customers")]
public class Customer
{
    [Column(IsPrimaryKey = true)]
    public string CustomerID { get; set; }

    [Column]
    public string CompanyName { get; set; }

    [Column]
    public string ContactName { get; set; }
}
```

### LINQ 查询

使用 LINQ to SQL，你可以使用 LINQ 查询语法来查询数据库中的数据。LINQ 查询语法类似于 SQL，但它是在 C# 中编写的。

```csharp
using (var db = new NorthwindDataContext("your_connection_string"))
{
    var query = from c in db.Customers
                where c.City == "London"
                select c;

    foreach (var customer in query)
    {
        Console.WriteLine(customer.ContactName);
    }
}
```

### 插入、更新和删除

除了查询，LINQ to SQL 还支持插入、更新和删除操作。你可以通过修改实体类的实例并调用 `SubmitChanges` 方法来将这些更改保存到数据库中。

```csharp
using (var db = new NorthwindDataContext("your_connection_string"))
{
    // 插入
    var newCustomer = new Customer
    {
        CustomerID = "NEW01",
        CompanyName = "New Company",
        ContactName = "John Doe"
    };
    db.Customers.InsertOnSubmit(newCustomer);

    // 更新
    var customer = db.Customers.First(c => c.CustomerID == "ALFKI");
    customer.ContactName = "Maria Anders";

    // 删除
    var customerToDelete = db.Customers.First(c => c.CustomerID == "OLD01");
    db.Customers.DeleteOnSubmit(customerToDelete);

    // 提交更改
    db.SubmitChanges();
}
```

## 实际案例

假设你正在开发一个简单的订单管理系统，你需要从数据库中查询所有来自伦敦的客户，并显示他们的联系信息。使用 LINQ to SQL，你可以轻松实现这一功能。

```csharp
using (var db = new NorthwindDataContext("your_connection_string"))
{
    var londonCustomers = from c in db.Customers
                          where c.City == "London"
                          select c;

    foreach (var customer in londonCustomers)
    {
        Console.WriteLine($"Customer: {customer.ContactName}, Company: {customer.CompanyName}");
    }
}
```

## 总结

LINQ to SQL 是 C# 中一种强大的数据库编程技术，它允许开发者使用 LINQ 查询语法来操作关系数据库。通过将数据库表映射到 C# 类，LINQ to SQL 提供了一种面向对象的方式来处理数据库操作，从而简化了代码并提高了可读性。

:::tip
如果你对 LINQ to SQL 感兴趣，可以尝试以下练习：
1. 创建一个新的数据库表，并使用 LINQ to SQL 进行查询和操作。
2. 尝试使用 LINQ to SQL 实现一个简单的 CRUD（创建、读取、更新、删除）应用程序。
:::

## 附加资源

- [LINQ to SQL 官方文档](https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql/linq/)
- [C# LINQ 入门指南](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/linq/)

通过学习和实践，你将能够掌握 LINQ to SQL 的基本概念，并将其应用到实际项目中。祝你编程愉快！