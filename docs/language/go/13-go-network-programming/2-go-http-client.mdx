---
title: Go HTTP客户端
description: "学习如何使用Go语言创建HTTP客户端，发送请求并处理响应。本文适合初学者，包含代码示例和实际应用场景。"
---

## 介绍

在现代Web开发中，HTTP客户端是与服务器进行通信的关键工具。Go语言提供了强大的标准库来创建HTTP客户端，使得发送HTTP请求和处理响应变得非常简单。本文将带你了解如何使用Go语言创建HTTP客户端，并通过实际案例展示其应用。

## 创建HTTP客户端

在Go语言中，`net/http`包提供了创建HTTP客户端的功能。你可以使用`http.Client`结构体来创建一个客户端实例，并通过它发送HTTP请求。

### 基本示例

以下是一个简单的示例，展示了如何使用Go发送一个GET请求并打印响应内容：

```go
package main

import (
    "fmt"
    "io/ioutil"
    "net/http"
)

func main() {
    // 创建一个HTTP客户端
    client := &http.Client{}

    // 发送GET请求
    resp, err := client.Get("https://jsonplaceholder.typicode.com/posts/1")
    if err != nil {
        fmt.Println("请求失败:", err)
        return
    }
    defer resp.Body.Close()

    // 读取响应内容
    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println("读取响应失败:", err)
        return
    }

    // 打印响应内容
    fmt.Println(string(body))
}
```

**输出示例：**

```json
{
  "userId": 1,
  "id": 1,
  "title": "sunt aut facere repellat provident occaecati excepturi optio reprehenderit",
  "body": "quia et suscipit\nsuscipit..."
}
```

:::note
在上面的示例中，我们使用了`http.Client`的`Get`方法来发送GET请求。`Get`方法返回一个`*http.Response`对象，我们可以通过它来访问响应的状态码、头部和主体内容。
:::

## 发送POST请求

除了GET请求，你还可以使用HTTP客户端发送POST请求。以下是一个发送POST请求的示例：

```go
package main

import (
    "bytes"
    "fmt"
    "io/ioutil"
    "net/http"
)

func main() {
    // 创建一个HTTP客户端
    client := &http.Client{}

    // 准备请求体
    jsonData := []byte(`{"title": "foo", "body": "bar", "userId": 1}`)
    reqBody := bytes.NewBuffer(jsonData)

    // 创建POST请求
    req, err := http.NewRequest("POST", "https://jsonplaceholder.typicode.com/posts", reqBody)
    if err != nil {
        fmt.Println("创建请求失败:", err)
        return
    }
    req.Header.Set("Content-Type", "application/json")

    // 发送请求
    resp, err := client.Do(req)
    if err != nil {
        fmt.Println("请求失败:", err)
        return
    }
    defer resp.Body.Close()

    // 读取响应内容
    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println("读取响应失败:", err)
        return
    }

    // 打印响应内容
    fmt.Println(string(body))
}
```

**输出示例：**

```json
{
  "id": 101,
  "title": "foo",
  "body": "bar",
  "userId": 1
}
```

:::tip
在发送POST请求时，我们使用了`http.NewRequest`方法来创建一个自定义的请求对象。通过这个方法，我们可以设置请求方法、URL、请求体和请求头。
:::

## 处理响应

在处理HTTP响应时，我们通常需要检查响应的状态码、读取响应体以及处理可能的错误。以下是一个更完整的示例，展示了如何处理这些情况：

```go
package main

import (
    "fmt"
    "io/ioutil"
    "net/http"
)

func main() {
    client := &http.Client{}

    resp, err := client.Get("https://jsonplaceholder.typicode.com/posts/1")
    if err != nil {
        fmt.Println("请求失败:", err)
        return
    }
    defer resp.Body.Close()

    // 检查状态码
    if resp.StatusCode != http.StatusOK {
        fmt.Printf("请求失败，状态码: %d\n", resp.StatusCode)
        return
    }

    // 读取响应体
    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println("读取响应失败:", err)
        return
    }

    // 打印响应内容
    fmt.Println(string(body))
}
```

:::caution
在处理HTTP响应时，务必检查状态码以确保请求成功。常见的状态码包括`200 OK`、`404 Not Found`和`500 Internal Server Error`等。
:::

## 实际应用场景

### 调用REST API

在实际开发中，HTTP客户端常用于调用REST API。例如，你可能需要从某个API获取数据并将其解析为Go结构体。以下是一个调用REST API并解析JSON响应的示例：

```go
package main

import (
    "encoding/json"
    "fmt"
    "io/ioutil"
    "net/http"
)

type Post struct {
    UserID int    `json:"userId"`
    ID     int    `json:"id"`
    Title  string `json:"title"`
    Body   string `json:"body"`
}

func main() {
    client := &http.Client{}

    resp, err := client.Get("https://jsonplaceholder.typicode.com/posts/1")
    if err != nil {
        fmt.Println("请求失败:", err)
        return
    }
    defer resp.Body.Close()

    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println("读取响应失败:", err)
        return
    }

    var post Post
    err = json.Unmarshal(body, &post)
    if err != nil {
        fmt.Println("解析JSON失败:", err)
        return
    }

    fmt.Printf("Post: %+v\n", post)
}
```

**输出示例：**

```text
Post: {UserID:1 ID:1 Title:sunt aut facere repellat provident occaecati excepturi optio reprehenderit Body:quia et suscipit\nsuscipit...}
```

:::warning
在解析JSON响应时，确保目标结构体的字段与JSON键名匹配，否则解析可能会失败。
:::

## 总结

通过本文，你已经学会了如何使用Go语言创建HTTP客户端，发送GET和POST请求，并处理响应。我们还通过实际案例展示了如何调用REST API并解析JSON响应。这些技能在Web开发中非常有用，尤其是在与外部服务进行通信时。

## 附加资源与练习

- **练习1**: 尝试使用`http.Client`发送一个PUT请求，并更新某个资源。
- **练习2**: 编写一个程序，调用一个天气API并解析返回的JSON数据。
- **附加资源**: 阅读Go官方文档中关于`net/http`包的更多内容：[Go net/http package](https://golang.org/pkg/net/http/)

继续练习和探索，你将能够熟练地使用Go语言进行网络编程！