---
title: Go API 交互
description: 学习如何使用 Go 语言与 API 进行交互，包括发送 HTTP 请求、处理响应以及解析 JSON 数据。
---

# Go API 交互

在现代软件开发中，与 API 进行交互是非常常见的任务。无论是获取数据、发送数据，还是与第三方服务集成，API 交互都是不可或缺的一部分。Go 语言以其简洁和高性能著称，非常适合用于构建网络应用程序和与 API 进行交互。

本文将带你了解如何使用 Go 语言与 API 进行交互，包括发送 HTTP 请求、处理响应以及解析 JSON 数据。我们将通过实际的代码示例和案例来帮助你掌握这些概念。

## 1. 发送 HTTP 请求

在 Go 中，`net/http` 包提供了发送 HTTP 请求的功能。我们可以使用 `http.Get`、`http.Post` 等函数来发送不同类型的 HTTP 请求。

### 示例：发送 GET 请求

以下是一个简单的示例，展示如何使用 Go 发送 GET 请求并获取响应：

```go
package main

import (
    "fmt"
    "io/ioutil"
    "net/http"
)

func main() {
    url := "https://jsonplaceholder.typicode.com/posts/1"
    resp, err := http.Get(url)
    if err != nil {
        fmt.Println("Error:", err)
        return
    }
    defer resp.Body.Close()

    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println("Error reading response body:", err)
        return
    }

    fmt.Println(string(body))
}
```

**输出：**

```json
{
  "userId": 1,
  "id": 1,
  "title": "sunt aut facere repellat provident occaecati excepturi optio reprehenderit",
  "body": "quia et suscipit\nsuscipit..."
}
```

在这个示例中，我们向 `https://jsonplaceholder.typicode.com/posts/1` 发送了一个 GET 请求，并打印了响应的内容。

:::note
`defer resp.Body.Close()` 用于确保在函数返回之前关闭响应体，以释放资源。
:::

## 2. 处理 HTTP 响应

在发送 HTTP 请求后，我们需要处理服务器的响应。通常，响应体是一个 JSON 格式的字符串，我们需要将其解析为 Go 中的结构体。

### 示例：解析 JSON 响应

以下示例展示了如何将 JSON 响应解析为 Go 结构体：

```go
package main

import (
    "encoding/json"
    "fmt"
    "net/http"
)

type Post struct {
    UserID int    `json:"userId"`
    ID     int    `json:"id"`
    Title  string `json:"title"`
    Body   string `json:"body"`
}

func main() {
    url := "https://jsonplaceholder.typicode.com/posts/1"
    resp, err := http.Get(url)
    if err != nil {
        fmt.Println("Error:", err)
        return
    }
    defer resp.Body.Close()

    var post Post
    if err := json.NewDecoder(resp.Body).Decode(&post); err != nil {
        fmt.Println("Error decoding JSON:", err)
        return
    }

    fmt.Printf("Post: %+v\n", post)
}
```

**输出：**

```text
Post: {UserID:1 ID:1 Title:sunt aut facere repellat provident occaecati excepturi optio reprehenderit Body:quia et suscipit\nsuscipit...}
```

在这个示例中，我们定义了一个 `Post` 结构体，并使用 `json.NewDecoder` 将 JSON 响应解析为该结构体。

:::tip
你可以使用 `json:"fieldName"` 标签来指定 JSON 字段与结构体字段的映射关系。
:::

## 3. 发送 POST 请求

除了 GET 请求，我们还可以使用 `http.Post` 发送 POST 请求。通常，POST 请求用于向服务器发送数据。

### 示例：发送 POST 请求

以下示例展示了如何发送一个包含 JSON 数据的 POST 请求：

```go
package main

import (
    "bytes"
    "encoding/json"
    "fmt"
    "net/http"
)

type Post struct {
    Title  string `json:"title"`
    Body   string `json:"body"`
    UserID int    `json:"userId"`
}

func main() {
    url := "https://jsonplaceholder.typicode.com/posts"
    post := Post{
        Title:  "New Post",
        Body:   "This is the body of the new post.",
        UserID: 1,
    }

    jsonData, err := json.Marshal(post)
    if err != nil {
        fmt.Println("Error marshalling JSON:", err)
        return
    }

    resp, err := http.Post(url, "application/json", bytes.NewBuffer(jsonData))
    if err != nil {
        fmt.Println("Error:", err)
        return
    }
    defer resp.Body.Close()

    var result map[string]interface{}
    if err := json.NewDecoder(resp.Body).Decode(&result); err != nil {
        fmt.Println("Error decoding JSON:", err)
        return
    }

    fmt.Println("Response:", result)
}
```

**输出：**

```text
Response: map[id:101 title:New Post body:This is the body of the new post. userId:1]
```

在这个示例中，我们创建了一个 `Post` 结构体，将其转换为 JSON 格式，并通过 POST 请求发送到服务器。服务器返回的响应被解析为一个 `map[string]interface{}`。

:::caution
确保在发送 POST 请求时，设置正确的 `Content-Type` 头（例如 `application/json`）。
:::

## 4. 实际应用场景

在实际开发中，API 交互可以用于多种场景，例如：

- **获取天气数据**：从天气 API 获取实时天气信息。
- **用户认证**：通过 OAuth 2.0 API 进行用户认证。
- **支付集成**：与支付网关 API 集成以处理支付请求。

### 示例：获取天气数据

以下是一个简单的示例，展示如何从 OpenWeatherMap API 获取天气数据：

```go
package main

import (
    "encoding/json"
    "fmt"
    "net/http"
)

type Weather struct {
    Main struct {
        Temp float64 `json:"temp"`
    } `json:"main"`
    Name string `json:"name"`
}

func main() {
    apiKey := "your_api_key"
    city := "London"
    url := fmt.Sprintf("http://api.openweathermap.org/data/2.5/weather?q=%s&appid=%s&units=metric", city, apiKey)

    resp, err := http.Get(url)
    if err != nil {
        fmt.Println("Error:", err)
        return
    }
    defer resp.Body.Close()

    var weather Weather
    if err := json.NewDecoder(resp.Body).Decode(&weather); err != nil {
        fmt.Println("Error decoding JSON:", err)
        return
    }

    fmt.Printf("Temperature in %s: %.2f°C\n", weather.Name, weather.Main.Temp)
}
```

**输出：**

```text
Temperature in London: 15.00°C
```

在这个示例中，我们使用 OpenWeatherMap API 获取了伦敦的当前温度。

:::warning
在实际应用中，请确保妥善保管 API 密钥，并避免将其硬编码在代码中。
:::

## 5. 总结

通过本文，你已经学会了如何使用 Go 语言与 API 进行交互。我们涵盖了发送 HTTP 请求、处理响应、解析 JSON 数据以及实际应用场景。这些技能对于构建现代网络应用程序至关重要。

## 6. 附加资源与练习

- **练习 1**：尝试使用不同的 API（例如 GitHub API）获取数据并解析响应。
- **练习 2**：编写一个程序，使用 POST 请求向 API 发送数据并处理响应。
- **资源**：[Go 官方文档 - net/http](https://golang.org/pkg/net/http/)

继续练习和探索，你将能够熟练地使用 Go 语言与各种 API 进行交互。祝你编程愉快！