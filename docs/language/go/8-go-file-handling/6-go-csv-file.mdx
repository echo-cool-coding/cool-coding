---
title: Go CSV 文件处理
description: "学习如何在 Go 中处理 CSV 文件，包括读取、写入和解析 CSV 数据。本文适合初学者，包含代码示例和实际应用场景。"
---

# Go CSV 文件处理

CSV（Comma-Separated Values）文件是一种常见的文件格式，用于存储表格数据。每行代表一条记录，字段之间用逗号分隔。Go 语言提供了强大的标准库支持，使得处理 CSV 文件变得非常简单。本文将带你了解如何在 Go 中读取、写入和解析 CSV 文件。

## 1. 读取 CSV 文件

在 Go 中，`encoding/csv` 包提供了读取和写入 CSV 文件的功能。首先，我们需要导入这个包：

```go
import (
    "encoding/csv"
    "os"
)
```

### 1.1 打开 CSV 文件

要读取 CSV 文件，首先需要打开文件并创建一个 `csv.Reader` 对象：

```go
file, err := os.Open("data.csv")
if err != nil {
    log.Fatal(err)
}
defer file.Close()

reader := csv.NewReader(file)
```

### 1.2 读取 CSV 数据

使用 `reader.ReadAll()` 方法可以一次性读取所有记录：

```go
records, err := reader.ReadAll()
if err != nil {
    log.Fatal(err)
}

for _, record := range records {
    fmt.Println(record)
}
```

### 1.3 逐行读取

如果你希望逐行读取 CSV 文件，可以使用 `reader.Read()` 方法：

```go
for {
    record, err := reader.Read()
    if err == io.EOF {
        break
    }
    if err != nil {
        log.Fatal(err)
    }
    fmt.Println(record)
}
```

## 2. 写入 CSV 文件

写入 CSV 文件同样简单。首先，我们需要创建一个 `csv.Writer` 对象：

```go
file, err := os.Create("output.csv")
if err != nil {
    log.Fatal(err)
}
defer file.Close()

writer := csv.NewWriter(file)
defer writer.Flush()
```

### 2.1 写入单行数据

使用 `writer.Write()` 方法可以写入单行数据：

```go
record := []string{"Name", "Age", "City"}
err = writer.Write(record)
if err != nil {
    log.Fatal(err)
}
```

### 2.2 写入多行数据

使用 `writer.WriteAll()` 方法可以一次性写入多行数据：

```go
records := [][]string{
    {"Alice", "23", "New York"},
    {"Bob", "30", "Los Angeles"},
    {"Charlie", "25", "Chicago"},
}

err = writer.WriteAll(records)
if err != nil {
    log.Fatal(err)
}
```

## 3. 解析 CSV 数据

在实际应用中，我们通常需要将 CSV 数据解析为结构体或其他数据类型。以下是一个简单的例子，展示如何将 CSV 数据解析为结构体：

```go
type Person struct {
    Name string
    Age  int
    City string
}

func main() {
    file, err := os.Open("data.csv")
    if err != nil {
        log.Fatal(err)
    }
    defer file.Close()

    reader := csv.NewReader(file)
    records, err := reader.ReadAll()
    if err != nil {
        log.Fatal(err)
    }

    var people []Person
    for _, record := range records {
        age, _ := strconv.Atoi(record[1])
        person := Person{
            Name: record[0],
            Age:  age,
            City: record[2],
        }
        people = append(people, person)
    }

    for _, person := range people {
        fmt.Printf("%s is %d years old and lives in %s\n", person.Name, person.Age, person.City)
    }
}
```

## 4. 实际应用场景

### 4.1 数据导入

CSV 文件常用于数据导入。例如，你可以从外部系统导出一个 CSV 文件，然后使用 Go 程序将其导入到数据库中。

### 4.2 数据导出

同样，CSV 文件也常用于数据导出。例如，你可以将数据库中的数据导出为 CSV 文件，以便在其他系统中使用。

### 4.3 数据分析

CSV 文件还可以用于数据分析。你可以使用 Go 程序读取 CSV 文件，然后对数据进行分析和处理。

## 5. 总结

在本文中，我们学习了如何在 Go 中处理 CSV 文件，包括读取、写入和解析 CSV 数据。Go 的 `encoding/csv` 包提供了强大的功能，使得处理 CSV 文件变得非常简单。通过实际应用场景，我们展示了 CSV 文件在数据导入、导出和分析中的重要性。

## 6. 附加资源与练习

- **练习 1**: 尝试编写一个 Go 程序，将一个 CSV 文件中的数据导入到 SQLite 数据库中。
- **练习 2**: 编写一个 Go 程序，将数据库中的数据导出为 CSV 文件。
- **练习 3**: 使用 Go 程序对 CSV 文件中的数据进行统计分析，例如计算平均值、最大值和最小值。

:::tip
如果你对 Go 的 `encoding/csv` 包感兴趣，可以查看官方文档以了解更多高级用法：[Go encoding/csv 文档](https://pkg.go.dev/encoding/csv)
:::