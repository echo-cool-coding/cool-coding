---
title: Go 目录操作
description: 学习如何在Go中处理目录操作，包括创建、读取、删除目录以及遍历目录内容。本文适合初学者，包含代码示例和实际应用场景。
---

# Go 目录操作

在Go语言中，目录操作是文件处理的重要组成部分。无论是创建新目录、读取目录内容，还是删除目录，Go的标准库都提供了简单而强大的工具。本文将逐步介绍如何在Go中进行目录操作，并通过实际案例帮助你理解这些概念。

## 目录操作的基本概念

在Go中，目录操作主要通过`os`和`filepath`包来实现。`os`包提供了与操作系统交互的功能，而`filepath`包则用于处理文件路径。通过这些包，你可以轻松地创建、读取、删除目录，以及遍历目录内容。

## 创建目录

在Go中，可以使用`os.Mkdir`或`os.MkdirAll`函数来创建目录。`os.Mkdir`用于创建单个目录，而`os.MkdirAll`则可以递归地创建多级目录。

### 示例：创建单个目录

```go
package main

import (
    "fmt"
    "os"
)

func main() {
    err := os.Mkdir("example_dir", 0755)
    if err != nil {
        fmt.Println("Error creating directory:", err)
        return
    }
    fmt.Println("Directory created successfully")
}
```

**输出：**
```
Directory created successfully
```

### 示例：递归创建多级目录

```go
package main

import (
    "fmt"
    "os"
)

func main() {
    err := os.MkdirAll("example_dir/sub_dir", 0755)
    if err != nil {
        fmt.Println("Error creating directory:", err)
        return
    }
    fmt.Println("Directory created successfully")
}
```

**输出：**
```
Directory created successfully
```

:::tip
`0755`是目录的权限模式，表示目录所有者有读、写、执行权限，而其他用户只有读和执行权限。
:::

## 读取目录内容

要读取目录内容，可以使用`os.ReadDir`函数。该函数返回一个`[]os.DirEntry`切片，其中包含目录中的所有文件和子目录。

### 示例：读取目录内容

```go
package main

import (
    "fmt"
    "os"
)

func main() {
    entries, err := os.ReadDir("example_dir")
    if err != nil {
        fmt.Println("Error reading directory:", err)
        return
    }

    for _, entry := range entries {
        fmt.Println(entry.Name())
    }
}
```

**输出：**
```
sub_dir
```

:::note
`entry.Name()`返回文件或目录的名称。你可以通过`entry.IsDir()`来判断它是否是一个目录。
:::

## 删除目录

删除目录可以使用`os.Remove`或`os.RemoveAll`函数。`os.Remove`用于删除空目录，而`os.RemoveAll`可以递归地删除目录及其内容。

### 示例：删除空目录

```go
package main

import (
    "fmt"
    "os"
)

func main() {
    err := os.Remove("example_dir/sub_dir")
    if err != nil {
        fmt.Println("Error removing directory:", err)
        return
    }
    fmt.Println("Directory removed successfully")
}
```

**输出：**
```
Directory removed successfully
```

### 示例：递归删除目录及其内容

```go
package main

import (
    "fmt"
    "os"
)

func main() {
    err := os.RemoveAll("example_dir")
    if err != nil {
        fmt.Println("Error removing directory:", err)
        return
    }
    fmt.Println("Directory removed successfully")
}
```

**输出：**
```
Directory removed successfully
```

## 遍历目录

遍历目录是处理文件系统中的常见任务。你可以使用`filepath.Walk`函数来递归地遍历目录及其子目录。

### 示例：遍历目录

```go
package main

import (
    "fmt"
    "os"
    "path/filepath"
)

func main() {
    err := filepath.Walk("example_dir", func(path string, info os.FileInfo, err error) error {
        if err != nil {
            return err
        }
        fmt.Println(path)
        return nil
    })
    if err != nil {
        fmt.Println("Error walking directory:", err)
    }
}
```

**输出：**
```
example_dir
example_dir/sub_dir
```

:::caution
`filepath.Walk`会递归地遍历目录中的所有文件和子目录。如果目录结构非常深，可能会导致性能问题。
:::

## 实际应用场景

### 场景：备份目录

假设你需要备份一个目录中的所有文件到另一个目录。你可以使用目录操作来实现这一功能。

```go
package main

import (
    "fmt"
    "io"
    "os"
    "path/filepath"
)

func main() {
    sourceDir := "example_dir"
    backupDir := "backup_dir"

    err := filepath.Walk(sourceDir, func(path string, info os.FileInfo, err error) error {
        if err != nil {
            return err
        }

        relPath, err := filepath.Rel(sourceDir, path)
        if err != nil {
            return err
        }

        backupPath := filepath.Join(backupDir, relPath)

        if info.IsDir() {
            return os.MkdirAll(backupPath, info.Mode())
        }

        srcFile, err := os.Open(path)
        if err != nil {
            return err
        }
        defer srcFile.Close()

        dstFile, err := os.Create(backupPath)
        if err != nil {
            return err
        }
        defer dstFile.Close()

        _, err = io.Copy(dstFile, srcFile)
        return err
    })

    if err != nil {
        fmt.Println("Error backing up directory:", err)
        return
    }

    fmt.Println("Backup completed successfully")
}
```

**输出：**
```
Backup completed successfully
```

## 总结

通过本文，你学习了如何在Go中进行目录操作，包括创建、读取、删除目录以及遍历目录内容。这些操作是文件处理的基础，掌握它们将帮助你更好地处理文件系统中的任务。

## 附加资源与练习

- **练习1**：编写一个程序，统计指定目录下的文件数量和目录数量。
- **练习2**：编写一个程序，将指定目录中的所有`.txt`文件移动到另一个目录。
- **附加资源**：阅读Go官方文档中关于`os`和`filepath`包的更多内容，深入了解文件处理的其他功能。

希望本文对你学习Go目录操作有所帮助！继续练习，你将很快掌握这些技能。