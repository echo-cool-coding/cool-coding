---
title: TypeScript 装饰器元数据
description: 了解TypeScript装饰器元数据的概念、用法以及实际应用场景。本文适合初学者，通过代码示例和逐步讲解，帮助你掌握这一重要特性。
---

# TypeScript 装饰器元数据

TypeScript装饰器是一种强大的工具，允许我们在类、方法、属性或参数上添加元数据或修改它们的行为。装饰器元数据是装饰器的一个重要特性，它允许我们在运行时访问和操作这些元数据。本文将详细介绍TypeScript装饰器元数据的概念、用法以及实际应用场景。

## 什么是装饰器元数据？

装饰器元数据是指在装饰器中附加的额外信息，这些信息可以在运行时被访问和使用。TypeScript通过`reflect-metadata`库提供了对装饰器元数据的支持。通过使用装饰器元数据，我们可以在类、方法、属性或参数上附加额外的信息，并在运行时读取这些信息。

## 安装 `reflect-metadata`

要使用装饰器元数据，首先需要安装`reflect-metadata`库。你可以通过以下命令安装它：

```bash
npm install reflect-metadata
```

安装完成后，你需要在TypeScript配置文件中启用`emitDecoratorMetadata`选项：

```json
{
  "compilerOptions": {
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true
  }
}
```

## 基本用法

### 1. 定义装饰器

首先，我们定义一个简单的装饰器，它将元数据附加到类、方法或属性上。

```typescript
import 'reflect-metadata';

function MyDecorator(metadata: any) {
  return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {
    Reflect.defineMetadata('myMetadata', metadata, target, propertyKey);
  };
}
```

### 2. 使用装饰器

接下来，我们使用这个装饰器来附加元数据。

```typescript
class MyClass {
  @MyDecorator({ key: 'value' })
  myMethod() {
    console.log('Hello, World!');
  }
}
```

### 3. 读取元数据

在运行时，我们可以读取附加的元数据。

```typescript
const metadata = Reflect.getMetadata('myMetadata', MyClass.prototype, 'myMethod');
console.log(metadata); // 输出: { key: 'value' }
```

## 实际应用场景

### 1. 依赖注入

装饰器元数据在依赖注入（DI）框架中非常有用。通过使用装饰器元数据，我们可以标记哪些类或方法需要注入依赖项。

```typescript
import 'reflect-metadata';

function Injectable() {
  return function (target: any) {
    Reflect.defineMetadata('injectable', true, target);
  };
}

function Inject(token: string) {
  return function (target: any, propertyKey: string, index: number) {
    Reflect.defineMetadata('inject', token, target, propertyKey);
  };
}

@Injectable()
class MyService {
  constructor(@Inject('MyDependency') private dependency: any) {}
}
```

### 2. 路由配置

在Web框架中，装饰器元数据可以用于定义路由和处理程序。

```typescript
import 'reflect-metadata';

function Route(path: string) {
  return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {
    Reflect.defineMetadata('route', path, target, propertyKey);
  };
}

class MyController {
  @Route('/hello')
  hello() {
    return 'Hello, World!';
  }
}
```

## 总结

TypeScript装饰器元数据是一个强大的工具，允许我们在运行时访问和操作附加到类、方法、属性或参数上的元数据。通过使用`reflect-metadata`库，我们可以轻松地定义和读取这些元数据。装饰器元数据在依赖注入、路由配置等场景中有着广泛的应用。

## 附加资源

- [TypeScript Decorators Documentation](https://www.typescriptlang.org/docs/handbook/decorators.html)
- [reflect-metadata GitHub Repository](https://github.com/rbuckton/reflect-metadata)

## 练习

1. 创建一个装饰器，将元数据附加到类的属性上，并在运行时读取该元数据。
2. 使用装饰器元数据实现一个简单的依赖注入框架。
3. 尝试在Web框架中使用装饰器元数据定义路由和处理程序。

通过完成这些练习，你将更好地理解TypeScript装饰器元数据的概念和用法。