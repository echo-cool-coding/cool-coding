---
title: TypeScript 属性装饰器
description: 了解 TypeScript 属性装饰器的基本概念、用法以及实际应用场景。本文适合初学者，包含代码示例和详细解释。
---

# TypeScript 属性装饰器

TypeScript 装饰器是一种特殊类型的声明，它可以附加到类声明、方法、访问器、属性或参数上，以修改它们的行为。属性装饰器是其中一种类型，专门用于修饰类的属性。通过属性装饰器，我们可以在属性定义时执行一些逻辑，例如添加元数据、验证属性值或修改属性的行为。

## 什么是属性装饰器？

属性装饰器是一个函数，它接受两个参数：

1. **target**：类的原型（如果是静态属性，则是类的构造函数）。
2. **propertyKey**：属性的名称。

属性装饰器在属性定义时被调用，而不是在属性被访问或修改时。因此，它通常用于在属性定义时执行一些初始化逻辑。

## 属性装饰器的基本语法

属性装饰器的语法如下：

```typescript
function propertyDecorator(target: any, propertyKey: string) {
    // 在这里添加装饰器的逻辑
}

class MyClass {
    @propertyDecorator
    myProperty: string;
}
```

在上面的例子中，`propertyDecorator` 是一个属性装饰器，它被应用到 `MyClass` 类的 `myProperty` 属性上。

## 属性装饰器的实际应用

### 1. 添加元数据

属性装饰器可以用于为属性添加元数据。例如，我们可以使用装饰器来标记某些属性为“只读”：

```typescript
function readonly(target: any, propertyKey: string) {
    Object.defineProperty(target, propertyKey, {
        writable: false
    });
}

class User {
    @readonly
    name: string;

    constructor(name: string) {
        this.name = name;
    }
}

const user = new User("Alice");
user.name = "Bob"; // 这里会报错，因为 name 是只读的
```

在这个例子中，`readonly` 装饰器将 `name` 属性设置为只读，因此在尝试修改 `name` 时会抛出错误。

### 2. 验证属性值

属性装饰器还可以用于验证属性的值。例如，我们可以确保某个属性的值始终为正数：

```typescript
function positiveNumber(target: any, propertyKey: string) {
    let value: number;

    const getter = () => value;
    const setter = (newValue: number) => {
        if (newValue <= 0) {
            throw new Error(`${propertyKey} must be a positive number`);
        }
        value = newValue;
    };

    Object.defineProperty(target, propertyKey, {
        get: getter,
        set: setter
    });
}

class Product {
    @positiveNumber
    price: number;

    constructor(price: number) {
        this.price = price;
    }
}

const product = new Product(100);
console.log(product.price); // 输出: 100
product.price = -50; // 这里会抛出错误
```

在这个例子中，`positiveNumber` 装饰器确保 `price` 属性的值始终为正数，否则会抛出错误。

### 3. 记录属性访问

属性装饰器还可以用于记录属性的访问情况。例如，我们可以记录每次访问某个属性的时间：

```typescript
function logAccess(target: any, propertyKey: string) {
    let value: any;

    const getter = () => {
        console.log(`Get ${propertyKey}: ${value}`);
        return value;
    };
    const setter = (newValue: any) => {
        console.log(`Set ${propertyKey}: ${newValue}`);
        value = newValue;
    };

    Object.defineProperty(target, propertyKey, {
        get: getter,
        set: setter
    });
}

class Person {
    @logAccess
    age: number;

    constructor(age: number) {
        this.age = age;
    }
}

const person = new Person(25);
person.age = 30; // 输出: Set age: 30
console.log(person.age); // 输出: Get age: 30
```

在这个例子中，`logAccess` 装饰器记录了每次访问 `age` 属性的情况。

## 总结

TypeScript 属性装饰器是一种强大的工具，它允许我们在属性定义时执行一些逻辑。通过属性装饰器，我们可以添加元数据、验证属性值、记录属性访问等。虽然属性装饰器的功能有限，但它们在特定场景下非常有用。

:::tip
属性装饰器通常与其他装饰器（如方法装饰器、类装饰器）结合使用，以实现更复杂的功能。
:::

## 附加资源

- [TypeScript 官方文档 - 装饰器](https://www.typescriptlang.org/docs/handbook/decorators.html)
- [深入理解 TypeScript 装饰器](https://www.digitalocean.com/community/tutorials/typescript-decorators)

## 练习

1. 创建一个属性装饰器，用于将属性值转换为大写。
2. 创建一个属性装饰器，用于限制字符串属性的最大长度。
3. 结合类装饰器和属性装饰器，实现一个简单的验证框架。

通过完成这些练习，你将更深入地理解 TypeScript 属性装饰器的用法和潜力。