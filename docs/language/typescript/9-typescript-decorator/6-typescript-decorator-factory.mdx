---
title: TypeScript 装饰器工厂
description: 了解 TypeScript 装饰器工厂的概念、用法以及实际应用场景，帮助初学者掌握这一强大的编程工具。
---

# TypeScript 装饰器工厂

TypeScript 装饰器是一种特殊类型的声明，它可以附加到类声明、方法、访问器、属性或参数上，以修改它们的行为。装饰器工厂则是一个返回装饰器函数的函数，它允许我们在运行时动态地配置装饰器的行为。

## 什么是装饰器工厂？

装饰器工厂是一个函数，它返回一个装饰器函数。通过使用装饰器工厂，我们可以在应用装饰器时传递参数，从而动态地定制装饰器的行为。这使得装饰器更加灵活和强大。

### 基本语法

装饰器工厂的基本语法如下：

```typescript
function decoratorFactory(config: any) {
  return function(target: any) {
    // 使用 config 来定制装饰器的行为
  };
}
```

在这个例子中，`decoratorFactory` 是一个装饰器工厂函数，它接受一个 `config` 参数，并返回一个装饰器函数。这个装饰器函数可以应用于类、方法、属性等。

## 装饰器工厂的使用

### 1. 类装饰器工厂

类装饰器工厂可以用来动态地修改类的行为。以下是一个简单的例子：

```typescript
function logClass(config: string) {
  return function(target: Function) {
    console.log(`${config}: ${target.name}`);
  };
}

@logClass('Logger')
class MyClass {
  // 类的内容
}

// 输出: Logger: MyClass
```

在这个例子中，`logClass` 是一个装饰器工厂，它接受一个字符串参数 `config`，并返回一个类装饰器。当 `MyClass` 被装饰时，控制台会输出 `Logger: MyClass`。

### 2. 方法装饰器工厂

方法装饰器工厂可以用来动态地修改方法的行为。以下是一个例子：

```typescript
function logMethod(config: string) {
  return function(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
    const originalMethod = descriptor.value;
    descriptor.value = function(...args: any[]) {
      console.log(`${config}: ${propertyKey} called with ${args}`);
      return originalMethod.apply(this, args);
    };
  };
}

class MyClass {
  @logMethod('Method Logger')
  myMethod(arg: string) {
    console.log(`Executing myMethod with ${arg}`);
  }
}

const instance = new MyClass();
instance.myMethod('test');

// 输出:
// Method Logger: myMethod called with test
// Executing myMethod with test
```

在这个例子中，`logMethod` 是一个方法装饰器工厂，它接受一个字符串参数 `config`，并返回一个方法装饰器。当 `myMethod` 被调用时，控制台会输出 `Method Logger: myMethod called with test`，然后执行原始的方法。

### 3. 属性装饰器工厂

属性装饰器工厂可以用来动态地修改属性的行为。以下是一个例子：

```typescript
function logProperty(config: string) {
  return function(target: any, propertyKey: string) {
    let value: any;
    const getter = function() {
      console.log(`${config}: Getting ${propertyKey}`);
      return value;
    };
    const setter = function(newVal: any) {
      console.log(`${config}: Setting ${propertyKey} to ${newVal}`);
      value = newVal;
    };
    Object.defineProperty(target, propertyKey, {
      get: getter,
      set: setter,
      enumerable: true,
      configurable: true,
    });
  };
}

class MyClass {
  @logProperty('Property Logger')
  myProperty: string;
}

const instance = new MyClass();
instance.myProperty = 'test';
console.log(instance.myProperty);

// 输出:
// Property Logger: Setting myProperty to test
// Property Logger: Getting myProperty
// test
```

在这个例子中，`logProperty` 是一个属性装饰器工厂，它接受一个字符串参数 `config`，并返回一个属性装饰器。当 `myProperty` 被设置或获取时，控制台会输出相应的日志信息。

## 实际应用场景

装饰器工厂在实际开发中有很多应用场景，例如：

- **日志记录**：通过装饰器工厂，我们可以轻松地为类、方法或属性添加日志记录功能。
- **权限控制**：我们可以使用装饰器工厂来检查用户权限，并根据权限动态地修改方法或属性的行为。
- **缓存**：装饰器工厂可以用来实现方法的缓存功能，从而提高性能。

## 总结

TypeScript 装饰器工厂是一种强大的工具，它允许我们在运行时动态地配置装饰器的行为。通过使用装饰器工厂，我们可以实现更加灵活和可复用的代码。希望本文能帮助你理解并掌握 TypeScript 装饰器工厂的概念和用法。

## 附加资源

- [TypeScript 官方文档 - 装饰器](https://www.typescriptlang.org/docs/handbook/decorators.html)
- [深入理解 TypeScript 装饰器](https://www.jianshu.com/p/5c2a5a3d5c5c)

## 练习

1. 创建一个类装饰器工厂，用于在类实例化时打印日志。
2. 创建一个方法装饰器工厂，用于在方法执行前后打印日志。
3. 创建一个属性装饰器工厂，用于在属性被访问或修改时打印日志。

通过完成这些练习，你将更深入地理解 TypeScript 装饰器工厂的用法和应用场景。