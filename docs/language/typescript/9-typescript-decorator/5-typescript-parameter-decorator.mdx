---
title: TypeScript 参数装饰器
description: 了解 TypeScript 参数装饰器的基本概念、用法以及实际应用场景，适合初学者快速掌握这一高级特性。
---

# TypeScript 参数装饰器

TypeScript 装饰器是一种特殊类型的声明，它可以附加到类、方法、访问器、属性或参数上，以修改它们的行为。参数装饰器是其中一种类型，它允许我们在方法或构造函数的参数上添加元数据或执行某些逻辑。本文将详细介绍 TypeScript 参数装饰器的概念、用法以及实际应用场景。

## 什么是参数装饰器？

参数装饰器是一个函数，它会在运行时被调用，并接收三个参数：

1. **target**：对于静态成员来说是类的构造函数，对于实例成员来说是类的原型。
2. **propertyKey**：成员的名字（方法名或构造函数名）。
3. **parameterIndex**：参数在函数参数列表中的索引。

参数装饰器的主要作用是为参数添加元数据或执行某些逻辑，但它不能直接修改参数的值。

## 参数装饰器的基本用法

下面是一个简单的参数装饰器示例，它会在控制台打印出参数的相关信息：

```typescript
function LogParameter(target: any, propertyKey: string, parameterIndex: number) {
    console.log(`Target: ${target}`);
    console.log(`Property Key: ${propertyKey}`);
    console.log(`Parameter Index: ${parameterIndex}`);
}

class Greeter {
    greet(@LogParameter name: string) {
        console.log(`Hello, ${name}!`);
    }
}

const greeter = new Greeter();
greeter.greet("Alice");
```

在这个例子中，`LogParameter` 是一个参数装饰器，它会在 `greet` 方法的 `name` 参数上被调用。运行这段代码时，控制台会输出以下内容：

```
Target: [object Object]
Property Key: greet
Parameter Index: 0
Hello, Alice!
```

:::note
参数装饰器不能直接修改参数的值，它只能用于添加元数据或执行某些逻辑。
:::

## 参数装饰器的实际应用

参数装饰器的一个常见应用场景是依赖注入（Dependency Injection）。通过参数装饰器，我们可以标记哪些参数需要注入依赖项，然后在运行时自动注入。

下面是一个简单的依赖注入示例：

```typescript
const dependencies: { [key: string]: any } = {};

function Inject(target: any, propertyKey: string, parameterIndex: number) {
    const dependencyKey = Reflect.getMetadata("design:paramtypes", target, propertyKey)[parameterIndex].name;
    target[propertyKey] = dependencies[dependencyKey];
}

class DatabaseService {
    connect() {
        console.log("Connected to the database");
    }
}

dependencies["DatabaseService"] = new DatabaseService();

class UserService {
    constructor(@Inject private db: DatabaseService) {}

    getUser() {
        this.db.connect();
        console.log("Fetching user...");
    }
}

const userService = new UserService();
userService.getUser();
```

在这个例子中，`Inject` 是一个参数装饰器，它会在 `UserService` 构造函数的 `db` 参数上被调用。`Inject` 装饰器会根据参数的类型自动从 `dependencies` 对象中获取相应的依赖项并注入。

运行这段代码时，控制台会输出以下内容：

```
Connected to the database
Fetching user...
```

:::tip
依赖注入是一种强大的设计模式，它可以帮助我们更好地管理类之间的依赖关系，并使代码更加模块化和可测试。
:::

## 总结

TypeScript 参数装饰器是一种强大的工具，它允许我们在方法或构造函数的参数上添加元数据或执行某些逻辑。虽然它不能直接修改参数的值，但它可以用于实现依赖注入等高级功能。

通过本文的学习，你应该已经掌握了参数装饰器的基本概念、用法以及实际应用场景。希望你能在自己的项目中灵活运用这一特性，编写出更加优雅和可维护的代码。

## 附加资源

- [TypeScript 官方文档 - 装饰器](https://www.typescriptlang.org/docs/handbook/decorators.html)
- [深入理解 TypeScript 装饰器](https://www.jianshu.com/p/5c2a5a3d5c3c)
- [TypeScript 装饰器实战](https://www.cnblogs.com/whitewolf/p/10785375.html)

## 练习

1. 尝试编写一个参数装饰器，用于记录方法的执行时间。
2. 修改上面的依赖注入示例，使其支持多个依赖项的注入。
3. 探索如何在参数装饰器中使用 `Reflect.metadata` API 来存储和检索元数据。
