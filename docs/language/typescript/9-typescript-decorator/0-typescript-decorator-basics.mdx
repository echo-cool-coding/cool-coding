---
title: TypeScript 装饰器基础
description: 了解TypeScript装饰器的基本概念、语法和实际应用场景，适合初学者入门。
---

## 什么是TypeScript装饰器？

TypeScript装饰器是一种特殊类型的声明，它可以附加到类、方法、属性或参数上，用于修改或扩展它们的行为。装饰器本质上是一个函数，它会在运行时被调用，并接收目标对象的相关信息作为参数。通过装饰器，我们可以在不修改原始代码的情况下，为类或方法添加额外的功能。

装饰器在TypeScript中是一个实验性功能，需要在`tsconfig.json`中启用`experimentalDecorators`选项：

```json
{
  "compilerOptions": {
    "experimentalDecorators": true
  }
}
```

## 装饰器的基本语法

装饰器的语法非常简单，它使用`@`符号后跟一个函数名来表示。装饰器可以应用于类、方法、属性或参数。以下是一个简单的装饰器示例：

```typescript
function simpleDecorator(target: any) {
  console.log("装饰器被调用，目标对象是：", target);
}

@simpleDecorator
class MyClass {
  // 类的内容
}
```

在这个例子中，`simpleDecorator`是一个装饰器函数，它会在`MyClass`类被定义时调用，并将`MyClass`作为参数传递给`target`。

## 装饰器的类型

TypeScript支持以下几种类型的装饰器：

1. **类装饰器**：应用于类的构造函数，用于修改或扩展类的行为。
2. **方法装饰器**：应用于类的方法，用于修改或扩展方法的行为。
3. **属性装饰器**：应用于类的属性，用于修改或扩展属性的行为。
4. **参数装饰器**：应用于方法的参数，用于修改或扩展参数的行为。

### 1. 类装饰器

类装饰器是最常见的装饰器类型，它接收类的构造函数作为参数。以下是一个类装饰器的示例：

```typescript
function classDecorator(constructor: Function) {
  console.log("类装饰器被调用，目标类是：", constructor);
}

@classDecorator
class MyClass {
  // 类的内容
}
```

### 2. 方法装饰器

方法装饰器应用于类的方法，它接收三个参数：目标类的原型、方法名和方法的属性描述符。以下是一个方法装饰器的示例：

```typescript
function methodDecorator(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  console.log("方法装饰器被调用，目标方法是：", propertyKey);
}

class MyClass {
  @methodDecorator
  myMethod() {
    console.log("方法被调用");
  }
}
```

### 3. 属性装饰器

属性装饰器应用于类的属性，它接收两个参数：目标类的原型和属性名。以下是一个属性装饰器的示例：

```typescript
function propertyDecorator(target: any, propertyKey: string) {
  console.log("属性装饰器被调用，目标属性是：", propertyKey);
}

class MyClass {
  @propertyDecorator
  myProperty: string;
}
```

### 4. 参数装饰器

参数装饰器应用于方法的参数，它接收三个参数：目标类的原型、方法名和参数在参数列表中的索引。以下是一个参数装饰器的示例：

```typescript
function parameterDecorator(target: any, propertyKey: string, parameterIndex: number) {
  console.log("参数装饰器被调用，目标参数索引是：", parameterIndex);
}

class MyClass {
  myMethod(@parameterDecorator param: string) {
    console.log("方法被调用，参数是：", param);
  }
}
```

## 装饰器的实际应用场景

装饰器在实际开发中有许多应用场景，以下是一些常见的例子：

### 1. 日志记录

通过方法装饰器，我们可以轻松地为方法添加日志记录功能：

```typescript
function logMethod(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const originalMethod = descriptor.value;
  descriptor.value = function (...args: any[]) {
    console.log(`调用方法：${propertyKey}，参数：${JSON.stringify(args)}`);
    const result = originalMethod.apply(this, args);
    console.log(`方法返回：${result}`);
    return result;
  };
}

class MyClass {
  @logMethod
  add(a: number, b: number): number {
    return a + b;
  }
}

const instance = new MyClass();
instance.add(2, 3); // 输出：调用方法：add，参数：[2,3] 方法返回：5
```

### 2. 权限控制

通过方法装饰器，我们可以实现简单的权限控制：

```typescript
function requireAdmin(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const originalMethod = descriptor.value;
  descriptor.value = function (...args: any[]) {
    const user = { role: "admin" }; // 假设这是当前用户
    if (user.role !== "admin") {
      throw new Error("无权访问此方法");
    }
    return originalMethod.apply(this, args);
  };
}

class MyClass {
  @requireAdmin
  deleteUser(userId: number) {
    console.log(`删除用户：${userId}`);
  }
}

const instance = new MyClass();
instance.deleteUser(1); // 如果用户角色不是admin，将抛出错误
```

## 总结

TypeScript装饰器是一种强大的工具，它允许我们在不修改原始代码的情况下，为类、方法、属性和参数添加额外的功能。通过装饰器，我们可以实现日志记录、权限控制、依赖注入等功能，从而提高代码的可维护性和可扩展性。

:::tip 提示
装饰器是一个实验性功能，因此在生产环境中使用时需要谨慎。建议在使用装饰器时，确保团队中的所有成员都熟悉其工作原理。
:::

## 附加资源

- [TypeScript官方文档 - 装饰器](https://www.typescriptlang.org/docs/handbook/decorators.html)
- [深入理解TypeScript装饰器](https://www.jianshu.com/p/5c2a5e3f5c3a)
- [TypeScript装饰器实战](https://www.cnblogs.com/whitewolf/p/13808186.html)

## 练习

1. 创建一个类装饰器，用于为类添加一个`createdAt`属性，记录类的创建时间。
2. 创建一个方法装饰器，用于缓存方法的返回值，避免重复计算。
3. 创建一个属性装饰器，用于将属性标记为只读。

通过完成这些练习，你将更深入地理解TypeScript装饰器的用法和潜力。