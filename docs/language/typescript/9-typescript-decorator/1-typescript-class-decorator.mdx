---
title: TypeScript 类装饰器
description: 了解TypeScript类装饰器的基本概念、语法和实际应用场景，帮助初学者掌握这一强大的元编程工具。
---

# TypeScript 类装饰器

TypeScript装饰器是一种特殊的声明，它可以附加到类、方法、属性或参数上，以修改或扩展它们的行为。类装饰器是其中最常用的一种，它允许我们在不修改类本身的情况下，动态地为类添加额外的功能或元数据。

## 什么是类装饰器？

类装饰器是一个函数，它接受一个类的构造函数作为参数，并返回一个新的构造函数或修改后的构造函数。通过类装饰器，我们可以在类定义时执行一些额外的逻辑，例如添加属性、方法，或者修改类的行为。

### 基本语法

类装饰器的语法非常简单，它使用 `@` 符号后跟一个函数名来定义。这个函数会在类定义时被调用。

```typescript
function classDecorator(constructor: Function) {
    console.log("类装饰器被调用");
}

@classDecorator
class MyClass {
    // 类的定义
}
```

在上面的例子中，`classDecorator` 是一个类装饰器函数，它会在 `MyClass` 类定义时被调用，并输出 "类装饰器被调用"。

## 类装饰器的实际应用

类装饰器在实际开发中有很多应用场景，例如：

1. **添加元数据**：我们可以使用类装饰器为类添加元数据，这些元数据可以在运行时被访问。
2. **修改类的行为**：通过类装饰器，我们可以动态地修改类的构造函数或原型链。
3. **依赖注入**：在大型应用中，类装饰器可以用于实现依赖注入，简化代码结构。

### 示例：添加元数据

假设我们想要为类添加一个 `version` 属性，我们可以使用类装饰器来实现：

```typescript
function addVersion(version: string) {
    return function (constructor: Function) {
        constructor.prototype.version = version;
    }
}

@addVersion("1.0.0")
class MyClass {
    // 类的定义
}

const instance = new MyClass();
console.log(instance.version); // 输出: 1.0.0
```

在这个例子中，`addVersion` 装饰器为 `MyClass` 类添加了一个 `version` 属性，并在实例化时输出该属性的值。

### 示例：修改类的行为

我们还可以使用类装饰器来修改类的行为。例如，我们可以为类添加一个日志功能：

```typescript
function logClass(constructor: Function) {
    const original = constructor;

    function newConstructor(...args: any[]) {
        console.log(`创建 ${original.name} 的实例`);
        return new original(...args);
    }

    newConstructor.prototype = original.prototype;
    return newConstructor as any;
}

@logClass
class MyClass {
    constructor(public name: string) {}
}

const instance = new MyClass("Test");
// 输出: 创建 MyClass 的实例
```

在这个例子中，`logClass` 装饰器修改了 `MyClass` 的构造函数，使其在实例化时输出日志信息。

## 类装饰器的执行顺序

当多个装饰器应用于同一个类时，它们的执行顺序是从上到下，从外到内。也就是说，最外层的装饰器会最先执行，最内层的装饰器会最后执行。

```typescript
function firstDecorator(constructor: Function) {
    console.log("第一个装饰器");
}

function secondDecorator(constructor: Function) {
    console.log("第二个装饰器");
}

@firstDecorator
@secondDecorator
class MyClass {
    // 类的定义
}

// 输出:
// 第二个装饰器
// 第一个装饰器
```

## 总结

TypeScript类装饰器是一种强大的工具，它允许我们在不修改类本身的情况下，动态地为类添加功能或元数据。通过类装饰器，我们可以实现诸如添加元数据、修改类的行为、依赖注入等功能。掌握类装饰器的使用，将有助于你编写更加灵活和可维护的代码。

### 附加资源

- [TypeScript官方文档 - 装饰器](https://www.typescriptlang.org/docs/handbook/decorators.html)
- [深入理解TypeScript装饰器](https://www.jianshu.com/p/5e1b1e9b0b5f)

### 练习

1. 创建一个类装饰器，为类添加一个 `createdAt` 属性，记录类的实例化时间。
2. 使用类装饰器实现一个简单的依赖注入机制，允许类在实例化时自动注入依赖项。
