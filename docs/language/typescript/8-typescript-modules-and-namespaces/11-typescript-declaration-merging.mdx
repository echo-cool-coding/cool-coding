---
title: TypeScript 声明合并
description: 了解TypeScript中的声明合并机制，掌握如何通过合并声明扩展类型、接口、命名空间和枚举。
---

# TypeScript 声明合并

TypeScript的声明合并（Declaration Merging）是一种强大的特性，它允许你将多个同名的声明合并为一个单一的声明。这种机制在扩展类型、接口、命名空间和枚举时非常有用。本文将详细介绍声明合并的概念、使用场景以及实际案例。

## 什么是声明合并？

声明合并是指TypeScript编译器将多个同名的声明合并为一个单一的声明。这些声明可以是接口、类、命名空间、函数或枚举。通过声明合并，你可以扩展已有的类型定义，而不需要修改原始代码。

:::tip
声明合并是TypeScript独有的特性，JavaScript并不支持。
:::

## 声明合并的类型

TypeScript中的声明合并主要分为以下几种类型：

1. **接口合并**
2. **命名空间合并**
3. **函数合并**
4. **枚举合并**

接下来，我们将逐一介绍这些类型。

### 1. 接口合并

接口合并是最常见的声明合并类型。当你定义多个同名的接口时，TypeScript会自动将它们合并为一个接口。

```typescript
interface User {
  name: string;
}

interface User {
  age: number;
}

const user: User = {
  name: "Alice",
  age: 25,
};
```

在上面的例子中，`User`接口被合并为一个包含`name`和`age`属性的接口。

:::caution
如果合并的接口中有同名但类型不同的属性，TypeScript会报错。
:::

### 2. 命名空间合并

命名空间合并允许你将多个同名的命名空间合并为一个。命名空间中的类型、函数和变量都会被合并。

```typescript
namespace MyNamespace {
  export const x = 10;
}

namespace MyNamespace {
  export const y = 20;
}

console.log(MyNamespace.x); // 输出: 10
console.log(MyNamespace.y); // 输出: 20
```

在这个例子中，`MyNamespace`被合并为一个包含`x`和`y`的命名空间。

### 3. 函数合并

函数合并允许你将多个同名的函数声明合并为一个。通常用于函数重载。

```typescript
function greet(name: string): string;
function greet(age: number): string;
function greet(value: string | number): string {
  if (typeof value === "string") {
    return `Hello, ${value}`;
  } else {
    return `You are ${value} years old`;
  }
}

console.log(greet("Alice")); // 输出: Hello, Alice
console.log(greet(25)); // 输出: You are 25 years old
```

在这个例子中，`greet`函数被合并为一个支持多种参数类型的函数。

### 4. 枚举合并

枚举合并允许你将多个同名的枚举合并为一个。合并后的枚举会包含所有枚举成员。

```typescript
enum Colors {
  Red = "RED",
}

enum Colors {
  Green = "GREEN",
}

console.log(Colors.Red); // 输出: RED
console.log(Colors.Green); // 输出: GREEN
```

在这个例子中，`Colors`枚举被合并为一个包含`Red`和`Green`成员的枚举。

## 实际应用场景

### 扩展第三方库的类型定义

当你使用第三方库时，可能会遇到类型定义不完整的情况。通过声明合并，你可以扩展这些类型定义。

```typescript
// 假设这是一个第三方库的类型定义
declare module "some-library" {
  interface Config {
    apiKey: string;
  }
}

// 扩展第三方库的类型定义
declare module "some-library" {
  interface Config {
    timeout: number;
  }
}

const config: Config = {
  apiKey: "12345",
  timeout: 5000,
};
```

在这个例子中，我们扩展了第三方库的`Config`接口，添加了`timeout`属性。

### 扩展全局变量

在开发过程中，你可能需要扩展全局变量的类型定义。通过声明合并，你可以轻松实现这一点。

```typescript
declare global {
  interface Window {
    myCustomProperty: string;
  }
}

window.myCustomProperty = "Hello, World!";
```

在这个例子中，我们扩展了`Window`接口，添加了`myCustomProperty`属性。

## 总结

TypeScript的声明合并是一种强大的特性，它允许你通过合并多个同名的声明来扩展类型、接口、命名空间和枚举。通过声明合并，你可以轻松扩展第三方库的类型定义、全局变量等，从而提高代码的可维护性和可扩展性。

:::note
声明合并虽然强大，但过度使用可能会导致代码难以理解和维护。建议在必要时使用，并保持代码的清晰和简洁。
:::

## 附加资源

- [TypeScript官方文档 - 声明合并](https://www.typescriptlang.org/docs/handbook/declaration-merging.html)
- [TypeScript Deep Dive - 声明合并](https://basarat.gitbook.io/typescript/type-system/declaration-merging)

## 练习

1. 创建一个接口`Person`，包含`name`和`age`属性。然后通过声明合并添加`email`属性。
2. 扩展一个第三方库的类型定义，添加一个新的配置项。
3. 使用命名空间合并，创建一个包含多个函数的命名空间。

通过完成这些练习，你将更好地掌握TypeScript的声明合并机制。