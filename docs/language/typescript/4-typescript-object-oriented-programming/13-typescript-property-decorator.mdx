---
title: TypeScript 属性装饰器
description: 了解如何在TypeScript中使用属性装饰器来增强类的属性功能。本文适合初学者，包含详细的解释、代码示例和实际应用场景。
---

# TypeScript 属性装饰器

TypeScript中的装饰器（Decorators）是一种特殊类型的声明，它可以附加到类、方法、属性或参数上，以修改或扩展它们的行为。本文将重点介绍**属性装饰器**，它允许你在类的属性上添加元数据或执行某些逻辑。

## 什么是属性装饰器？

属性装饰器是一个函数，它会在运行时被调用，并接收两个参数：

1. **target**：类的原型（如果是静态属性，则是类的构造函数）。
2. **propertyKey**：属性的名称。

属性装饰器通常用于以下场景：
- 添加元数据到属性上。
- 修改属性的行为。
- 在属性访问时执行某些逻辑。

## 基本语法

属性装饰器的基本语法如下：

```typescript
function propertyDecorator(target: any, propertyKey: string) {
    // 在这里添加你的逻辑
}
```

你可以在类的属性上使用装饰器：

```typescript
class MyClass {
    @propertyDecorator
    myProperty: string;
}
```

## 代码示例

让我们通过一个简单的例子来理解属性装饰器的工作原理。假设我们想要记录每个属性的访问日志。

```typescript
function logProperty(target: any, propertyKey: string) {
    let value = target[propertyKey];

    const getter = function () {
        console.log(`Getting value: ${value}`);
        return value;
    };

    const setter = function (newValue: any) {
        console.log(`Setting value: ${newValue}`);
        value = newValue;
    };

    Object.defineProperty(target, propertyKey, {
        get: getter,
        set: setter,
        enumerable: true,
        configurable: true,
    });
}

class User {
    @logProperty
    name: string;

    constructor(name: string) {
        this.name = name;
    }
}

const user = new User("Alice");
user.name = "Bob"; // 输出: Setting value: Bob
console.log(user.name); // 输出: Getting value: Bob
```

在这个例子中，`logProperty`装饰器会在每次访问或修改`name`属性时打印日志。

## 实际应用场景

属性装饰器在实际开发中有许多应用场景，以下是一些常见的例子：

### 1. 数据验证

你可以使用属性装饰器来验证属性的值是否符合某些规则。例如，确保一个字符串属性的长度不超过某个限制。

```typescript
function maxLength(max: number) {
    return function (target: any, propertyKey: string) {
        let value = target[propertyKey];

        const setter = function (newValue: string) {
            if (newValue.length > max) {
                throw new Error(`Value exceeds maximum length of ${max}`);
            }
            value = newValue;
        };

        Object.defineProperty(target, propertyKey, {
            get: function () {
                return value;
            },
            set: setter,
            enumerable: true,
            configurable: true,
        });
    };
}

class Product {
    @maxLength(10)
    name: string;

    constructor(name: string) {
        this.name = name;
    }
}

const product = new Product("ShortName");
product.name = "ThisNameIsTooLong"; // 抛出错误: Value exceeds maximum length of 10
```

### 2. 依赖注入

在依赖注入框架中，属性装饰器可以用于标记需要注入的依赖项。

```typescript
function inject(service: any) {
    return function (target: any, propertyKey: string) {
        target[propertyKey] = new service();
    };
}

class LoggerService {
    log(message: string) {
        console.log(message);
    }
}

class App {
    @inject(LoggerService)
    logger: LoggerService;

    run() {
        this.logger.log("App is running");
    }
}

const app = new App();
app.run(); // 输出: App is running
```

## 总结

属性装饰器是TypeScript中一个强大的工具，它允许你在类的属性上添加额外的逻辑或元数据。通过使用属性装饰器，你可以实现数据验证、日志记录、依赖注入等功能，从而增强代码的可维护性和可扩展性。

## 附加资源

- [TypeScript官方文档 - 装饰器](https://www.typescriptlang.org/docs/handbook/decorators.html)
- [深入理解TypeScript装饰器](https://medium.com/google-developers/exploring-es7-decorators-76ecb65fb841)

## 练习

1. 创建一个属性装饰器，用于将属性的值转换为大写。
2. 尝试使用属性装饰器实现一个简单的依赖注入框架。

通过实践这些练习，你将更深入地理解属性装饰器的用法和潜力。