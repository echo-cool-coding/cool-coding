---
title: TypeScript 异步错误处理
description: 学习如何在TypeScript中处理异步操作中的错误，掌握try-catch、Promise.catch和async/await的错误处理技巧。
---

# TypeScript 异步错误处理

在TypeScript中，异步编程是非常常见的场景，尤其是在处理网络请求、文件读写或数据库操作时。然而，异步操作可能会失败，因此正确处理错误是编写健壮代码的关键。本文将详细介绍如何在TypeScript中处理异步错误，并通过实际案例帮助你理解这些概念。

## 异步错误处理的重要性

在同步代码中，我们可以使用`try-catch`语句来捕获和处理错误。但在异步代码中，错误处理的方式有所不同。由于异步操作是非阻塞的，错误可能会在稍后的时间点发生，因此我们需要使用特定的方法来捕获和处理这些错误。

## 使用`try-catch`处理异步错误

在TypeScript中，`async/await`语法使得异步代码看起来更像同步代码。我们可以使用`try-catch`语句来捕获`async`函数中的错误。

```typescript
async function fetchData() {
  try {
    const response = await fetch('https://api.example.com/data');
    const data = await response.json();
    console.log(data);
  } catch (error) {
    console.error('Error fetching data:', error);
  }
}

fetchData();
```

在这个例子中，如果`fetch`或`response.json()`抛出错误，`catch`块将会捕获并处理这个错误。

## 使用`Promise.catch`处理错误

如果你使用的是`Promise`而不是`async/await`，你可以使用`.catch()`方法来处理错误。

```typescript
fetch('https://api.example.com/data')
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => console.error('Error fetching data:', error));
```

在这个例子中，如果`fetch`或`response.json()`抛出错误，`.catch()`方法将会捕获并处理这个错误。

## 实际案例：处理网络请求中的错误

假设你正在开发一个天气应用，需要从API获取天气数据。以下是一个处理网络请求错误的实际案例：

```typescript
async function getWeather(city: string) {
  try {
    const response = await fetch(`https://api.weatherapi.com/v1/current.json?key=YOUR_API_KEY&q=${city}`);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    const data = await response.json();
    console.log(`Current temperature in ${city}: ${data.current.temp_c}°C`);
  } catch (error) {
    console.error('Error fetching weather data:', error);
  }
}

getWeather('London');
```

在这个例子中，我们首先检查`response.ok`以确保请求成功。如果请求失败，我们抛出一个错误，并在`catch`块中处理它。

## 总结

在TypeScript中处理异步错误是编写健壮代码的重要部分。通过使用`try-catch`、`Promise.catch`和`async/await`，你可以有效地捕获和处理异步操作中的错误。在实际开发中，正确处理错误可以提高应用的稳定性和用户体验。

## 附加资源与练习

- **练习1**：修改上面的天气应用示例，使其能够处理API密钥无效的情况。
- **练习2**：尝试使用`Promise.all`处理多个异步操作，并确保所有错误都被捕获。

:::tip
在处理异步错误时，始终考虑用户友好的错误消息和日志记录，以便在出现问题时能够快速诊断和修复。
:::

:::caution
避免在`catch`块中忽略错误，即使你只是记录错误，也要确保错误不会被静默处理。
:::