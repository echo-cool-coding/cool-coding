---
title: TypeScript 作用域规则
description: 了解TypeScript中的作用域规则，掌握变量、函数和类的可见性和生命周期。本文将通过示例和实际案例帮助你理解作用域在TypeScript中的重要性。
---

## 介绍

在TypeScript中，**作用域**（Scope）决定了变量、函数和类的可见性和生命周期。理解作用域规则是编写可维护和高效代码的关键。TypeScript的作用域规则与JavaScript一致，主要分为**全局作用域**、**函数作用域**和**块级作用域**。本文将逐步讲解这些概念，并通过示例帮助你掌握它们。

---

## 全局作用域

在TypeScript中，任何在顶层（即不在任何函数或块内）声明的变量、函数或类都属于**全局作用域**。这意味着它们可以在代码的任何地方访问。

```typescript
let globalVar = "I am global";

function printGlobal() {
  console.log(globalVar); // 可以访问全局变量
}

printGlobal(); // 输出: I am global
```

:::caution
尽量避免使用全局变量，因为它们可能会导致命名冲突和意外的行为。
:::

---

## 函数作用域

在函数内部声明的变量属于**函数作用域**。这些变量只能在函数内部访问，函数外部无法访问。

```typescript
function myFunction() {
  let localVar = "I am local";
  console.log(localVar); // 可以访问局部变量
}

myFunction(); // 输出: I am local
console.log(localVar); // 报错: localVar未定义
```

:::tip
函数作用域有助于封装代码，避免变量污染全局命名空间。
:::

---

## 块级作用域

使用 `let` 和 `const` 声明的变量具有**块级作用域**。块级作用域是指变量仅在声明它的代码块（如 `{}`）内有效。

```typescript
if (true) {
  let blockVar = "I am block-scoped";
  console.log(blockVar); // 可以访问块级变量
}

console.log(blockVar); // 报错: blockVar未定义
```

:::note
与 `var` 不同，`let` 和 `const` 不会将变量提升到函数或全局作用域。
:::

---

## 作用域链

当访问一个变量时，TypeScript会从当前作用域开始查找，如果找不到，则会逐级向上查找，直到全局作用域。这个过程称为**作用域链**。

```typescript
let outerVar = "I am outer";

function outerFunction() {
  let innerVar = "I am inner";

  function innerFunction() {
    console.log(innerVar); // 输出: I am inner
    console.log(outerVar); // 输出: I am outer
  }

  innerFunction();
}

outerFunction();
```

:::tip
理解作用域链有助于调试变量访问问题。
:::

---

## 实际案例

### 案例1：避免变量污染

在开发中，我们经常需要避免变量污染全局作用域。使用块级作用域可以有效解决这个问题。

```typescript
{
  let temp = "Temporary value";
  console.log(temp); // 输出: Temporary value
}

console.log(temp); // 报错: temp未定义
```

### 案例2：闭包和作用域

闭包是JavaScript和TypeScript中一个强大的特性，它允许函数访问其词法作用域中的变量，即使函数在其作用域外执行。

```typescript
function createCounter() {
  let count = 0;

  return function() {
    count++;
    return count;
  };
}

const counter = createCounter();
console.log(counter()); // 输出: 1
console.log(counter()); // 输出: 2
```

:::note
闭包利用了作用域链的特性，使得内部函数可以访问外部函数的变量。
:::

---

## 总结

TypeScript的作用域规则是编写清晰、可维护代码的基础。通过理解全局作用域、函数作用域和块级作用域，你可以更好地控制变量的可见性和生命周期。此外，作用域链和闭包是TypeScript中强大的工具，能够帮助你实现更复杂的逻辑。

---

## 附加资源

- [TypeScript官方文档](https://www.typescriptlang.org/docs/)
- [JavaScript作用域详解](https://developer.mozilla.org/en-US/docs/Glossary/Scope)

## 练习

1. 修改以下代码，使其输出 `10` 而不是 `undefined`：
   ```typescript
   let x = 10;

   function printX() {
     console.log(x);
     let x = 20;
   }

   printX();
   ```

2. 编写一个函数，使用闭包实现一个简单的缓存机制。

---