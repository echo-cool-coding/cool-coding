---
title: TypeScript 声明文件使用
description: 了解如何在TypeScript中使用声明文件，以便与JavaScript代码无缝互操作。本文适合初学者，包含代码示例和实际案例。
---

# TypeScript 声明文件使用

TypeScript 是一种强类型的 JavaScript 超集，它允许开发者在编写 JavaScript 代码时使用类型检查。然而，在实际开发中，我们经常会使用到第三方 JavaScript 库或遗留的 JavaScript 代码。为了让 TypeScript 能够理解这些 JavaScript 代码，我们需要使用 **声明文件**。

## 什么是声明文件？

声明文件（`.d.ts` 文件）是 TypeScript 用来描述 JavaScript 库或模块的类型信息的文件。它们不包含实际的实现代码，而是提供了类型定义，使得 TypeScript 能够对这些 JavaScript 代码进行类型检查。

:::note
声明文件通常以 `.d.ts` 为扩展名，并且可以通过 `declare` 关键字来定义类型。
:::

## 为什么需要声明文件？

当你在 TypeScript 项目中使用 JavaScript 库时，TypeScript 编译器并不知道这些库的类型信息。如果没有声明文件，TypeScript 会将这些库视为 `any` 类型，从而失去类型检查的优势。通过使用声明文件，你可以为这些库提供类型信息，从而获得更好的开发体验。

## 如何使用声明文件？

### 1. 安装现有的声明文件

许多流行的 JavaScript 库已经提供了官方的 TypeScript 声明文件，这些文件通常可以通过 npm 安装。例如，如果你想使用 `lodash` 库，你可以通过以下命令安装其声明文件：

```bash
npm install --save @types/lodash
```

安装完成后，TypeScript 会自动识别这些声明文件，并在编译时使用它们。

### 2. 自定义声明文件

如果你使用的库没有提供声明文件，或者你需要为自定义的 JavaScript 代码添加类型信息，你可以自己编写声明文件。

#### 示例：为 JavaScript 函数编写声明文件

假设你有一个 JavaScript 文件 `mathUtils.js`，其中包含一个简单的加法函数：

```javascript
function add(a, b) {
    return a + b;
}
```

为了让 TypeScript 能够理解这个函数，你可以创建一个 `mathUtils.d.ts` 文件，并为其添加类型定义：

```typescript
declare function add(a: number, b: number): number;
```

现在，当你在 TypeScript 中使用 `add` 函数时，TypeScript 会进行类型检查：

```typescript
import { add } from './mathUtils';

const result = add(1, 2); // 正确
const errorResult = add(1, '2'); // 错误：类型不匹配
```

### 3. 全局声明

有时，你可能需要在全局范围内声明类型。例如，如果你在 HTML 文件中引入了一个全局的 JavaScript 库，你可以使用 `declare` 关键字在全局范围内声明它的类型。

#### 示例：全局声明

假设你有一个全局的 JavaScript 变量 `MY_APP`，你可以在 `global.d.ts` 文件中声明它的类型：

```typescript
declare var MY_APP: {
    version: string;
    init: () => void;
};
```

现在，你可以在 TypeScript 中直接使用 `MY_APP`，并且 TypeScript 会进行类型检查：

```typescript
console.log(MY_APP.version); // 正确
MY_APP.init(); // 正确
MY_APP.unknownMethod(); // 错误：未知方法
```

## 实际案例

### 案例：使用第三方库 `moment.js`

`moment.js` 是一个流行的日期处理库。虽然它本身是用 JavaScript 编写的，但你可以通过安装其声明文件来在 TypeScript 中使用它。

首先，安装 `moment.js` 及其声明文件：

```bash
npm install moment
npm install --save @types/moment
```

然后，你可以在 TypeScript 中使用 `moment`，并获得类型检查：

```typescript
import moment from 'moment';

const now = moment();
console.log(now.format('YYYY-MM-DD')); // 正确
console.log(now.format(123)); // 错误：参数类型不匹配
```

## 总结

声明文件是 TypeScript 与 JavaScript 互操作的关键。通过使用声明文件，你可以为 JavaScript 代码提供类型信息，从而在 TypeScript 中获得更好的开发体验。无论是使用现有的声明文件，还是自己编写自定义的声明文件，TypeScript 都能帮助你更安全、更高效地编写代码。

## 附加资源与练习

- **练习**：尝试为一个简单的 JavaScript 库编写声明文件，并在 TypeScript 项目中使用它。
- **资源**：
  - [TypeScript 官方文档 - 声明文件](https://www.typescriptlang.org/docs/handbook/declaration-files/introduction.html)
  - [DefinitelyTyped](https://github.com/DefinitelyTyped/DefinitelyTyped) - 一个包含大量第三方库声明文件的仓库

通过掌握声明文件的使用，你将能够更好地在 TypeScript 项目中集成 JavaScript 代码，并充分利用 TypeScript 的类型系统。