---
title: TypeScript 与遗留代码
description: 了解如何在TypeScript项目中与遗留JavaScript代码进行互操作，逐步讲解概念并提供实际案例。
---

# TypeScript 与遗留代码

在现代Web开发中，TypeScript已经成为了许多开发者的首选语言。然而，许多项目仍然包含大量的遗留JavaScript代码。为了充分利用TypeScript的优势，同时保留现有的JavaScript代码，我们需要了解如何在TypeScript中与遗留代码进行互操作。

## 什么是遗留代码？

遗留代码通常指的是那些已经存在但未使用现代工具或语言特性编写的代码。这些代码可能是用旧版本的JavaScript编写的，或者没有使用模块化、类型检查等现代开发实践。

## 为什么需要与遗留代码互操作？

1. **逐步迁移**：将整个项目一次性迁移到TypeScript可能会非常耗时且风险较高。通过互操作，可以逐步迁移代码库。
2. **利用现有代码**：许多项目已经积累了大量的JavaScript代码，直接弃用这些代码是不现实的。
3. **团队协作**：在团队中，可能有些成员更熟悉JavaScript，而有些成员则更熟悉TypeScript。互操作可以让团队成员在同一个项目中协作。

## 如何在TypeScript中使用遗留JavaScript代码

### 1. 使用声明文件（.d.ts）

TypeScript通过声明文件来了解JavaScript代码的类型信息。声明文件通常以 `.d.ts` 为扩展名，并且不包含实际的实现代码。

```typescript
// legacyCode.js
function legacyFunction(a, b) {
    return a + b;
}

// legacyCode.d.ts
declare function legacyFunction(a: number, b: number): number;
```

在上面的例子中，`legacyFunction` 是一个遗留的JavaScript函数。我们通过声明文件告诉TypeScript这个函数的类型信息。

### 2. 使用 `any` 类型

在TypeScript中，`any` 类型可以用来表示任意类型的值。当你无法确定遗留代码的类型时，可以使用 `any` 类型。

```typescript
let legacyVariable: any = legacyFunction(1, 2);
```

:::caution
使用 `any` 类型会失去TypeScript的类型检查优势，应尽量避免过度使用。
:::

### 3. 使用 `@ts-ignore`

在某些情况下，TypeScript可能会对遗留代码发出警告或错误。你可以使用 `@ts-ignore` 注释来忽略这些警告。

```typescript
// @ts-ignore
legacyFunction("1", "2");
```

:::warning
`@ts-ignore` 应该谨慎使用，因为它会完全忽略TypeScript的类型检查。
:::

### 4. 逐步迁移

逐步迁移是将遗留代码逐步转换为TypeScript代码的过程。你可以从最关键的代码开始，逐步将JavaScript文件重写为TypeScript文件。

```typescript
// 旧代码
function oldFunction(a, b) {
    return a + b;
}

// 新代码
function newFunction(a: number, b: number): number {
    return a + b;
}
```

## 实际案例

假设我们有一个遗留的JavaScript库 `legacyLib.js`，它包含一个函数 `add`，用于将两个数字相加。

```javascript
// legacyLib.js
function add(a, b) {
    return a + b;
}
```

我们希望在TypeScript项目中使用这个函数。首先，我们创建一个声明文件 `legacyLib.d.ts`：

```typescript
// legacyLib.d.ts
declare function add(a: number, b: number): number;
```

然后，在TypeScript代码中，我们可以这样使用：

```typescript
import { add } from './legacyLib';

const result = add(1, 2);
console.log(result); // 输出: 3
```

## 总结

TypeScript与遗留代码的互操作是现代Web开发中的一个重要主题。通过使用声明文件、`any` 类型、`@ts-ignore` 注释以及逐步迁移策略，我们可以在保留现有代码的同时，逐步引入TypeScript的优势。

## 附加资源

- [TypeScript官方文档](https://www.typescriptlang.org/docs/)
- [TypeScript与JavaScript互操作指南](https://www.typescriptlang.org/docs/handbook/declaration-files/introduction.html)

## 练习

1. 尝试在一个现有的JavaScript项目中引入TypeScript，并使用声明文件来描述一个遗留函数。
2. 将一个简单的JavaScript函数逐步迁移到TypeScript，并确保类型安全。

通过以上步骤，你将能够更好地理解如何在TypeScript项目中与遗留代码进行互操作，并逐步将项目迁移到TypeScript。