---
title: TypeScript 单例模式
description: 了解如何在TypeScript中实现单例模式，确保一个类只有一个实例，并提供全局访问点。
---

# TypeScript 单例模式

单例模式是一种创建型设计模式，它确保一个类只有一个实例，并提供一个全局访问点来访问该实例。这种模式在需要控制资源访问、配置管理或日志记录等场景中非常有用。

## 什么是单例模式？

单例模式的核心思想是限制类的实例化次数，确保在整个应用程序中只有一个实例存在。这个实例通常通过一个静态方法或属性来访问。

### 为什么使用单例模式？

- **资源管理**：单例模式可以确保某些资源（如数据库连接、文件系统等）只被初始化一次，避免重复创建和销毁。
- **全局访问**：单例模式提供了一个全局访问点，使得其他对象可以方便地访问该实例。
- **一致性**：单例模式可以确保在整个应用程序中，某个类的行为和数据是一致的。

## TypeScript 中的单例模式实现

在TypeScript中，单例模式可以通过多种方式实现。下面我们将介绍一种常见的实现方式。

### 基本实现

```typescript
class Singleton {
    private static instance: Singleton;

    private constructor() {
        // 私有构造函数，防止外部实例化
    }

    public static getInstance(): Singleton {
        if (!Singleton.instance) {
            Singleton.instance = new Singleton();
        }
        return Singleton.instance;
    }

    public someMethod(): void {
        console.log("Executing some method in Singleton instance.");
    }
}

// 使用单例
const instance1 = Singleton.getInstance();
const instance2 = Singleton.getInstance();

console.log(instance1 === instance2); // 输出: true
```

### 代码解释

1. **私有构造函数**：`private constructor()` 确保类不能在外部被实例化。
2. **静态实例**：`private static instance: Singleton;` 保存类的唯一实例。
3. **静态方法**：`public static getInstance(): Singleton` 提供全局访问点，如果实例不存在则创建，否则返回现有实例。

### 实际应用场景

单例模式在实际开发中有许多应用场景，以下是一些常见的例子：

1. **日志记录器**：确保所有日志都通过同一个日志记录器实例进行记录，避免日志文件被多次打开或关闭。
2. **配置管理**：确保配置信息在整个应用程序中保持一致，避免重复读取配置文件。
3. **数据库连接池**：确保数据库连接池只有一个实例，避免资源浪费。

### 示例：日志记录器

```typescript
class Logger {
    private static instance: Logger;
    private logs: string[];

    private constructor() {
        this.logs = [];
    }

    public static getInstance(): Logger {
        if (!Logger.instance) {
            Logger.instance = new Logger();
        }
        return Logger.instance;
    }

    public log(message: string): void {
        this.logs.push(message);
        console.log(`Log: ${message}`);
    }

    public printLogs(): void {
        this.logs.forEach(log => console.log(log));
    }
}

// 使用日志记录器
const logger1 = Logger.getInstance();
logger1.log("First log message");

const logger2 = Logger.getInstance();
logger2.log("Second log message");

logger1.printLogs();
// 输出:
// Log: First log message
// Log: Second log message
// First log message
// Second log message
```

### 注意事项

- **线程安全**：在单线程环境中，TypeScript的单例模式实现是安全的。但在多线程环境中，可能需要额外的同步机制。
- **测试困难**：由于单例模式的全局性，可能会增加单元测试的复杂性。

## 总结

单例模式是一种强大的设计模式，适用于需要全局唯一实例的场景。通过私有构造函数和静态方法，我们可以确保一个类只有一个实例，并提供全局访问点。在实际开发中，单例模式可以用于日志记录、配置管理、数据库连接池等场景。

### 附加资源

- [TypeScript官方文档](https://www.typescriptlang.org/docs/)
- [设计模式：可复用面向对象软件的基础](https://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612)

### 练习

1. 尝试实现一个单例模式的配置管理器，用于读取和存储应用程序的配置信息。
2. 修改日志记录器示例，使其支持日志级别（如INFO、WARN、ERROR），并根据级别过滤日志输出。

:::tip
单例模式虽然强大，但也要谨慎使用。过度使用单例模式可能会导致代码难以测试和维护。确保在真正需要全局唯一实例的场景下使用单例模式。
:::