---
title: JavaScript 代码格式化
description: 学习如何使用不同工具和技术来格式化JavaScript代码，提高代码可读性和可维护性
---

# JavaScript 代码格式化

## 什么是代码格式化？

代码格式化是指按照一定的规则和风格对代码进行排版，使其保持一致性和可读性。在JavaScript开发中，良好的代码格式不仅让代码更加美观，还能提高团队协作效率，减少bug的发生率。

:::tip 为什么代码格式化很重要
- 提高代码可读性
- 统一团队代码风格
- 减少语法错误
- 便于代码审查和维护
:::

## 手动格式化与自动格式化

### 手动格式化

早期开发者主要依靠手动格式化代码，按照团队约定的规范编写。这种方式依赖于开发者的细心和经验，容易出现不一致的情况。

### 自动格式化

现代开发中，我们更倾向于使用自动化工具来统一代码格式，减少人为因素影响。

## 常用的JavaScript代码格式化工具

### 1. Prettier

Prettier是当前最流行的代码格式化工具之一，它支持多种语言，包括JavaScript、TypeScript、CSS等。

#### 安装Prettier

```bash
# 使用npm安装
npm install --save-dev prettier

# 使用yarn安装
yarn add --dev prettier
```

#### 基本使用

创建一个配置文件`.prettierrc`：

```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "printWidth": 80,
  "trailingComma": "es5"
}
```

命令行使用：

```bash
npx prettier --write "src/**/*.{js,jsx}"
```

#### 格式化前后对比

格式化前：

```javascript
function calculateTotal(items,tax)
{
    let total=0;
for(const item of items){
    total+=item.price*item.quantity;
}
    return total+(total*tax);
}
```

格式化后：

```javascript
function calculateTotal(items, tax) {
  let total = 0;
  for (const item of items) {
    total += item.price * item.quantity;
  }
  return total + (total * tax);
}
```

### 2. ESLint

ESLint主要是代码检查工具，但也可以配置自动修复一些格式问题。

#### 安装ESLint

```bash
npm install --save-dev eslint
```

#### 配置ESLint

创建`.eslintrc.json`文件：

```json
{
  "env": {
    "browser": true,
    "es2021": true
  },
  "extends": "eslint:recommended",
  "rules": {
    "indent": ["error", 2],
    "quotes": ["error", "single"],
    "semi": ["error", "always"]
  }
}
```

#### 运行ESLint自动修复

```bash
npx eslint --fix "src/**/*.js"
```

### 3. 编辑器内置格式化功能

大多数现代代码编辑器如VSCode、WebStorm等都内置了代码格式化功能。

#### VS Code示例

1. 安装Prettier扩展
2. 设置格式化快捷键（默认为`Alt+Shift+F`）
3. 配置保存时自动格式化：

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode"
}
```

## 常见的JavaScript代码格式化规则

### 缩进

缩进用于表示代码块的层级关系，主要有两种选择：

- 空格（常用2或4个空格）
- Tab键

```javascript
// 使用2个空格的缩进
function example() {
  if (condition) {
    doSomething();
  }
}
```

### 引号

JavaScript中可以使用单引号或双引号来包裹字符串：

```javascript
// 单引号风格
const name = 'JavaScript';

// 双引号风格
const name = "JavaScript";
```

### 分号

JavaScript中的分号是可选的，但建议始终使用或始终不使用，保持一致：

```javascript
// 使用分号
const num = 5;
console.log(num);

// 不使用分号
const num = 5
console.log(num)
```

### 行宽控制

为了提高可读性，通常会限制每行代码的最大长度（常见为80或120个字符）：

```javascript
// 超长的一行
const veryLongVariableName = someFunction(parameter1, parameter2, parameter3, parameter4, parameter5, parameter6);

// 格式化后
const veryLongVariableName = someFunction(
  parameter1,
  parameter2,
  parameter3,
  parameter4,
  parameter5,
  parameter6
);
```

## 实际应用场景

### 场景一：团队协作项目

在多人协作的项目中，统一的代码风格至关重要。

```mermaid
flowchart LR
    A[项目设置]-->B[创建配置文件]
    B-->C[安装格式化工具]
    C-->D[配置编辑器]
    D-->E[配置Git Hooks]
    E-->F[团队成员遵循统一风格]
```

一个典型的团队项目配置可能包括：

1. `.prettierrc` - Prettier配置文件
2. `.eslintrc.json` - ESLint配置文件
3. `.editorconfig` - 编辑器配置
4. 使用husky和lint-staged在提交代码前自动格式化

### 场景二：开源项目贡献

当你想要为开源项目贡献代码时，遵循项目的代码格式规范是基本礼仪：

1. 查看项目文档了解格式要求
2. 检查项目是否有格式化配置文件
3. 在提交PR前确保代码符合项目风格

### 场景三：自动化持续集成流程

在CI/CD流程中，可以添加代码格式检查步骤：

```yaml
# .github/workflows/format-check.yml示例
name: Format Check

on: [push, pull_request]

jobs:
  format:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install dependencies
        run: npm ci
      - name: Check formatting
        run: npx prettier --check "src/**/*.{js,jsx}"
```

## 代码格式化最佳实践

1. **项目开始时确定格式规范**：在项目开始时就确定代码格式规范，并创建配置文件

2. **使用.editorconfig**：创建`.editorconfig`文件统一不同编辑器的基本设置

3. **结合ESLint和Prettier**：ESLint用于代码质量检查，Prettier专注于格式化

4. **自动化格式检查**：使用Git Hooks或CI工具自动检查和修复代码格式问题

5. **在README中说明格式要求**：在项目文档中说明代码格式规范和相关工具配置

:::caution 注意事项
在大型项目中修改格式化规则时要谨慎！这可能会导致大量代码改动，影响代码审查和冲突解决。
:::

## 利用Git Hooks自动格式化

使用husky和lint-staged在代码提交前自动格式化：

安装依赖：

```bash
npm install --save-dev husky lint-staged
```

配置package.json：

```json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged"
    }
  },
  "lint-staged": {
    "*.{js,jsx,ts,tsx}": [
      "prettier --write",
      "eslint --fix"
    ]
  }
}
```

## 总结

JavaScript代码格式化是提高代码质量和可维护性的重要实践。通过使用现代工具如Prettier和ESLint，结合编辑器插件和Git Hooks，可以轻松实现代码风格的统一和自动化。

在团队项目中，统一的代码格式不仅提高了代码可读性，也减少了不必要的代码审查问题，让团队成员可以更专注于实际的业务逻辑。

## 练习

1. 安装并配置Prettier，尝试格式化一个混乱的JavaScript文件
2. 创建自己的ESLint配置，加入一些自定义规则
3. 在一个小项目中配置husky和lint-staged，体验自动格式化的工作流
4. 尝试在VS Code中设置保存时自动格式化

## 扩展阅读

- [Prettier官方文档](https://prettier.io/docs/en/)
- [ESLint官方文档](https://eslint.org/docs/user-guide/getting-started)
- [JavaScript风格指南](https://github.com/airbnb/javascript)
- [编写可维护的JavaScript代码](https://www.oreilly.com/library/view/maintainable-javascript/9781449328092/)

通过掌握代码格式化技术，你将能够写出更加专业、易读、易维护的JavaScript代码！