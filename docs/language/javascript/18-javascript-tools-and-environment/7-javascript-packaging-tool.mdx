---
title: JavaScript 打包工具
description: 了解JavaScript打包工具的概念、作用及主流工具的使用方法，帮助初学者选择适合自己项目的打包工具。
---

# JavaScript 打包工具

## 什么是JavaScript打包工具？

JavaScript打包工具是一种能够将多个JavaScript文件及其依赖项合并为一个或多个优化后的文件的工具。在现代Web开发中，我们通常会编写模块化的代码，将功能分散在不同的文件中，但这些文件最终需要以一种浏览器能够高效加载的方式部署到生产环境中。

打包工具的主要作用包括：

- **模块化管理** - 将分散的模块代码合并为一个或多个文件
- **资源优化** - 压缩代码，减少文件体积
- **代码转换** - 将现代JavaScript语法转换为兼容性更好的版本
- **依赖管理** - 处理项目内的依赖关系
- **开发体验提升** - 提供热重载等开发便利功能

:::note
打包工具不仅限于处理JavaScript文件，现代的打包工具通常还能处理CSS、图片等各种资源。
:::

## 为什么需要打包工具？

假设我们有一个简单的项目结构：

```
project/
├── src/
│   ├── index.js
│   ├── math.js
│   └── utils.js
└── index.html
```

在`math.js`中我们定义了一些数学运算函数：

```javascript
// math.js
export function add(a, b) {
  return a + b;
}

export function subtract(a, b) {
  return a - b;
}
```

在`utils.js`中定义了一些工具函数：

```javascript
// utils.js
export function formatNumber(num) {
  return num.toFixed(2);
}
```

在`index.js`中引用这些模块：

```javascript
// index.js
import { add } from './math.js';
import { formatNumber } from './utils.js';

const result = add(5, 3);
console.log(`The result is: ${formatNumber(result)}`);
```

不使用打包工具，在浏览器中直接引用这些模块会面临几个问题：

1. 不是所有浏览器都支持ES模块
2. 多个小文件会导致多次HTTP请求，影响加载性能
3. 没有经过压缩的代码体积较大，加载速度较慢

打包工具可以解决这些问题，将代码转换为浏览器兼容的格式，并优化加载性能。

## 主流JavaScript打包工具

### 1. Webpack

Webpack是目前最流行的JavaScript打包工具之一，它强大且灵活，能够处理几乎所有类型的资源。

#### 基本使用

安装Webpack：

```bash
npm install webpack webpack-cli --save-dev
```

创建一个基础的webpack配置文件（`webpack.config.js`）：

```javascript
const path = require('path');

module.exports = {
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
  },
};
```

运行Webpack：

```bash
npx webpack
```

Webpack会读取`src/index.js`文件及其导入的所有依赖，并生成一个`dist/bundle.js`文件，这个文件包含了所有必要的代码，可以直接在浏览器中运行。

#### Webpack的主要概念

1. **Entry（入口）**：打包的起始点，通常是应用的主文件
2. **Output（输出）**：生成的打包文件存放的位置
3. **Loaders（加载器）**：处理非JavaScript文件的转换器
4. **Plugins（插件）**：提供额外功能的插件系统
5. **Mode（模式）**：指定开发或生产环境模式

### 2. Rollup

Rollup专注于ES模块的打包，生成的代码更加清晰，特别适合库的开发。

#### 基本使用

安装Rollup：

```bash
npm install rollup --save-dev
```

创建一个基础的Rollup配置文件（`rollup.config.js`）：

```javascript
export default {
  input: 'src/index.js',
  output: {
    file: 'dist/bundle.js',
    format: 'iife'
  }
};
```

运行Rollup：

```bash
npx rollup -c
```

### 3. Parcel

Parcel是一个零配置的打包工具，适合快速开始新项目。

#### 基本使用

安装Parcel：

```bash
npm install parcel --save-dev
```

无需任何配置文件，直接运行：

```bash
npx parcel src/index.html
```

Parcel会自动处理HTML中引用的JavaScript、CSS等资源。

### 4. Vite

Vite是一个新兴的构建工具，利用了现代浏览器对ES模块的原生支持，提供了极快的开发服务器启动时间。

#### 基本使用

使用Vite创建项目：

```bash
npm create vite@latest my-project -- --template vanilla
cd my-project
npm install
npm run dev
```

## 打包工具的常见功能

### 代码分割

代码分割允许将应用拆分成多个小块，按需加载，提高应用加载速度。

Webpack配置示例：

```javascript
module.exports = {
  // ...
  optimization: {
    splitChunks: {
      chunks: 'all',
    },
  },
};
```

### 模块热替换（HMR）

在开发过程中，修改代码后无需完全刷新页面，只更新变更的部分。

Webpack配置示例：

```javascript
const webpack = require('webpack');

module.exports = {
  // ...
  devServer: {
    hot: true,
  },
  plugins: [
    new webpack.HotModuleReplacementPlugin(),
  ],
};
```

### 环境变量注入

根据不同的环境（开发、测试、生产）注入不同的配置变量。

Webpack配置示例：

```javascript
const webpack = require('webpack');

module.exports = {
  // ...
  plugins: [
    new webpack.DefinePlugin({
      'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV),
      'process.env.API_URL': JSON.stringify(process.env.API_URL),
    }),
  ],
};
```

## 实际案例：构建一个简单的计算器应用

假设我们要创建一个简单的计算器应用，使用Webpack进行打包。

### 项目结构

```
calculator/
├── src/
│   ├── index.js
│   ├── calculator.js
│   └── styles.css
├── index.html
├── package.json
└── webpack.config.js
```

### 代码实现

**index.html**:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>简单计算器</title>
</head>
<body>
  <div id="calculator">
    <input type="text" id="display" readonly>
    <div id="buttons">
      <button onclick="calculator.pressNumber(7)">7</button>
      <button onclick="calculator.pressNumber(8)">8</button>
      <button onclick="calculator.pressNumber(9)">9</button>
      <button onclick="calculator.pressOperation('+')">+</button>
      <button onclick="calculator.pressNumber(4)">4</button>
      <button onclick="calculator.pressNumber(5)">5</button>
      <button onclick="calculator.pressNumber(6)">6</button>
      <button onclick="calculator.pressOperation('-')">-</button>
      <button onclick="calculator.pressNumber(1)">1</button>
      <button onclick="calculator.pressNumber(2)">2</button>
      <button onclick="calculator.pressNumber(3)">3</button>
      <button onclick="calculator.pressOperation('*')">*</button>
      <button onclick="calculator.pressNumber(0)">0</button>
      <button onclick="calculator.clearDisplay()">C</button>
      <button onclick="calculator.calculate()">=</button>
      <button onclick="calculator.pressOperation('/')">/</button>
    </div>
  </div>
  <script src="dist/bundle.js"></script>
</body>
</html>
```

**calculator.js**:

```javascript
// calculator.js
export default class Calculator {
  constructor() {
    this.display = document.getElementById('display');
    this.firstOperand = null;
    this.operator = null;
    this.waitingForSecondOperand = false;
  }

  pressNumber(number) {
    if (this.waitingForSecondOperand) {
      this.display.value = number;
      this.waitingForSecondOperand = false;
    } else {
      this.display.value = this.display.value === '0' ? number : this.display.value + number;
    }
  }

  pressOperation(operator) {
    if (this.operator && !this.waitingForSecondOperand) {
      this.calculate();
    }
    
    this.firstOperand = parseFloat(this.display.value);
    this.operator = operator;
    this.waitingForSecondOperand = true;
  }

  calculate() {
    if (this.operator && this.firstOperand !== null) {
      const secondOperand = parseFloat(this.display.value);
      let result;

      switch (this.operator) {
        case '+':
          result = this.firstOperand + secondOperand;
          break;
        case '-':
          result = this.firstOperand - secondOperand;
          break;
        case '*':
          result = this.firstOperand * secondOperand;
          break;
        case '/':
          result = this.firstOperand / secondOperand;
          break;
      }

      this.display.value = result;
      this.firstOperand = result;
      this.operator = null;
    }
  }

  clearDisplay() {
    this.display.value = '0';
    this.firstOperand = null;
    this.operator = null;
    this.waitingForSecondOperand = false;
  }
}
```

**styles.css**:

```css
#calculator {
  width: 300px;
  margin: 0 auto;
  padding: 20px;
  border: 1px solid #ccc;
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

#display {
  width: 100%;
  margin-bottom: 10px;
  padding: 10px;
  font-size: 18px;
  text-align: right;
}

#buttons {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-gap: 5px;
}

button {
  padding: 15px;
  font-size: 18px;
  background-color: #f0f0f0;
  border: 1px solid #ccc;
  border-radius: 5px;
  cursor: pointer;
}

button:hover {
  background-color: #e0e0e0;
}
```

**index.js**:

```javascript
// index.js
import Calculator from './calculator.js';
import './styles.css';

window.calculator = new Calculator();
```

**webpack.config.js**:

```javascript
const path = require('path');

module.exports = {
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader'],
      },
    ],
  },
  mode: 'development',
  devServer: {
    static: {
      directory: path.join(__dirname, './'),
    },
    compress: true,
    port: 9000,
  },
};
```

**package.json**:

```json
{
  "name": "calculator",
  "version": "1.0.0",
  "description": "Simple calculator app",
  "main": "index.js",
  "scripts": {
    "build": "webpack",
    "start": "webpack serve"
  },
  "devDependencies": {
    "css-loader": "^6.8.1",
    "style-loader": "^3.3.3",
    "webpack": "^5.88.0",
    "webpack-cli": "^5.1.4",
    "webpack-dev-server": "^4.15.1"
  }
}
```

### 构建与运行

安装依赖：

```bash
npm install
```

构建项目：

```bash
npm run build
```

运行开发服务器：

```bash
npm start
```

访问`http://localhost:9000`即可看到计算器应用。

## 如何选择合适的打包工具

选择打包工具时可以考虑以下因素：

1. **项目类型**：
   - 开发库或工具：Rollup通常更适合
   - 开发应用：Webpack或Vite可能更合适

2. **配置复杂度**：
   - 零配置：Parcel
   - 高度可配置：Webpack

3. **开发体验**：
   - 快速启动：Vite
   - 成熟稳定：Webpack

4. **社区支持**：
   - Webpack有最广泛的社区支持和插件生态

5. **构建性能**：
   - Vite在开发模式下启动最快
   - Rollup通常生成较小的bundle

## 总结

JavaScript打包工具是现代Web开发流程中不可或缺的一部分。它们帮助我们:

1. 管理模块和依赖关系
2. 优化代码体积和加载性能
3. 提供开发便利功能如热重载
4. 处理资源转换和优化

作为初学者，建议从一个简单的配置开始，随着你对打包工具理解的加深，逐步扩展配置以满足项目需求。

## 练习

1. 使用Webpack构建一个简单的待办事项应用，包含添加、删除和标记完成功能
2. 尝试配置Rollup打包一个小型JavaScript工具库
3. 比较Vite和Webpack的开发体验差异
4. 为上面的计算器应用添加更多功能，如历史记录、科学计算等

## 学习资源

- [Webpack官方文档](https://webpack.js.org/concepts/)
- [Rollup官方指南](https://rollupjs.org/guide/en/)
- [Parcel官方文档](https://parceljs.org/docs/)
- [Vite官方指南](https://vitejs.dev/guide/)
- [JavaScript模块化编程](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules)

通过理解和掌握这些打包工具，你将能够更高效地构建和部署JavaScript应用程序，为用户提供更好的体验。