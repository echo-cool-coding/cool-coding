---
title: Kubernetes 部署
description: 了解如何在 Kubernetes 中部署应用程序，掌握从基础概念到实际操作的完整流程。
---

# Kubernetes 部署

Kubernetes 是一个开源的容器编排平台，用于自动化应用程序的部署、扩展和管理。通过 Kubernetes，您可以轻松地在集群中运行和管理容器化应用程序。本文将带您了解 Kubernetes 部署的基础知识，并通过实际案例展示如何在 Kubernetes 中部署应用程序。

## 什么是 Kubernetes 部署？

在 Kubernetes 中，**部署（Deployment）** 是一种资源对象，用于定义应用程序的期望状态。它允许您描述应用程序的副本数量、更新策略以及回滚机制。Kubernetes 会自动确保集群中的实际状态与您定义的期望状态一致。

### 部署的核心概念

- **Pod**：Kubernetes 中最小的部署单元，通常包含一个或多个容器。
- **ReplicaSet**：确保指定数量的 Pod 副本始终在运行。
- **Deployment**：管理 ReplicaSet 和 Pod 的声明式更新。

## 创建一个简单的 Kubernetes 部署

让我们从一个简单的示例开始，部署一个 Nginx Web 服务器。

### 1. 编写部署配置文件

创建一个名为 `nginx-deployment.yaml` 的文件，内容如下：

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
```

### 2. 应用部署配置文件

使用 `kubectl` 命令行工具将部署应用到 Kubernetes 集群：

```bash
kubectl apply -f nginx-deployment.yaml
```

### 3. 查看部署状态

运行以下命令查看部署状态：

```bash
kubectl get deployments
```

输出示例：

```plaintext
NAME               READY   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3/3     3            3           10s
```

### 4. 查看 Pod 状态

运行以下命令查看 Pod 状态：

```bash
kubectl get pods
```

输出示例：

```plaintext
NAME                                READY   STATUS    RESTARTS   AGE
nginx-deployment-75675f5897-6j9s5   1/1     Running   0          15s
nginx-deployment-75675f5897-8k9s7   1/1     Running   0          15s
nginx-deployment-75675f5897-9l0s8   1/1     Running   0          15s
```

## 更新部署

Kubernetes 部署支持滚动更新，这意味着您可以更新应用程序的镜像版本而不会导致服务中断。

### 1. 更新镜像版本

假设我们要将 Nginx 的镜像版本从 `1.14.2` 更新到 `1.16.1`，可以运行以下命令：

```bash
kubectl set image deployment/nginx-deployment nginx=nginx:1.16.1
```

### 2. 查看更新状态

运行以下命令查看更新状态：

```bash
kubectl rollout status deployment/nginx-deployment
```

输出示例：

```plaintext
deployment "nginx-deployment" successfully rolled out
```

## 回滚部署

如果更新后出现问题，您可以轻松回滚到之前的版本。

### 1. 查看部署历史

运行以下命令查看部署历史：

```bash
kubectl rollout history deployment/nginx-deployment
```

### 2. 回滚到上一个版本

运行以下命令回滚到上一个版本：

```bash
kubectl rollout undo deployment/nginx-deployment
```

## 实际案例：部署一个简单的 Web 应用程序

假设我们有一个简单的 Web 应用程序，使用 Node.js 编写，并且我们已经将其容器化。我们可以使用 Kubernetes 部署来管理这个应用程序。

### 1. 编写部署配置文件

创建一个名为 `web-app-deployment.yaml` 的文件，内容如下：

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-app-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: web-app
  template:
    metadata:
      labels:
        app: web-app
    spec:
      containers:
      - name: web-app
        image: your-dockerhub-username/web-app:1.0.0
        ports:
        - containerPort: 3000
```

### 2. 应用部署配置文件

使用 `kubectl` 命令行工具将部署应用到 Kubernetes 集群：

```bash
kubectl apply -f web-app-deployment.yaml
```

### 3. 暴露服务

为了让外部用户访问我们的 Web 应用程序，我们需要创建一个服务（Service）来暴露它。

创建一个名为 `web-app-service.yaml` 的文件，内容如下：

```yaml
apiVersion: v1
kind: Service
metadata:
  name: web-app-service
spec:
  selector:
    app: web-app
  ports:
    - protocol: TCP
      port: 80
      targetPort: 3000
  type: LoadBalancer
```

应用服务配置文件：

```bash
kubectl apply -f web-app-service.yaml
```

### 4. 访问应用程序

运行以下命令获取服务的外部 IP 地址：

```bash
kubectl get services
```

输出示例：

```plaintext
NAME              TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)        AGE
web-app-service   LoadBalancer   10.96.123.45    203.0.113.42     80:30000/TCP   10s
```

现在，您可以通过 `http://203.0.113.42` 访问您的 Web 应用程序。

## 总结

通过本文，您已经了解了 Kubernetes 部署的基础知识，并学会了如何在 Kubernetes 中部署和管理应用程序。Kubernetes 提供了强大的工具来自动化应用程序的部署、扩展和管理，使得在云原生环境中运行应用程序变得更加简单和高效。

## 附加资源

- [Kubernetes 官方文档](https://kubernetes.io/docs/home/)
- [Kubernetes 部署指南](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)
- [Kubernetes 入门教程](https://kubernetes.io/docs/tutorials/kubernetes-basics/)

## 练习

1. 尝试在 Kubernetes 中部署一个简单的 Python Flask 应用程序。
2. 使用 Kubernetes 部署的滚动更新功能，将应用程序的镜像版本更新到最新版本。
3. 尝试回滚到之前的版本，并观察 Kubernetes 如何处理回滚操作。

通过实践这些练习，您将更深入地理解 Kubernetes 部署的工作原理，并能够在实际项目中应用这些知识。