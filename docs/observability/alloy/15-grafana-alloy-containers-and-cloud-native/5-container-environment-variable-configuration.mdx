---
title: 容器环境变量配置
description: 了解如何在容器中配置和使用环境变量，以及它们在云原生应用中的重要性。
---

# 容器环境变量配置

在现代云原生应用开发中，容器技术（如 Docker 和 Kubernetes）已经成为不可或缺的一部分。环境变量是容器配置中的关键元素，它们允许开发者在不同环境中动态调整应用程序的行为，而无需修改代码。本文将详细介绍如何在容器中配置和使用环境变量，并通过实际案例展示其应用场景。

## 什么是环境变量？

环境变量是操作系统或容器运行时中存储的键值对，用于配置应用程序的行为。它们通常用于存储敏感信息（如 API 密钥、数据库连接字符串）或环境特定的配置（如开发、测试和生产环境的差异）。

在容器中，环境变量可以通过多种方式设置，包括 Dockerfile、Docker Compose 文件、Kubernetes 配置文件等。

## 在 Docker 中配置环境变量

### 1. 在 Dockerfile 中设置环境变量

在 Dockerfile 中，可以使用 `ENV` 指令来设置环境变量。这些变量将在容器启动时自动加载。

```dockerfile
FROM alpine:latest
ENV APP_ENV=production
ENV DB_HOST=db.example.com
```

在上面的例子中，`APP_ENV` 和 `DB_HOST` 是两个环境变量，它们将在容器启动时可用。

### 2. 在 `docker run` 命令中设置环境变量

除了在 Dockerfile 中设置环境变量外，还可以在运行容器时通过 `-e` 标志动态设置环境变量。

```bash
docker run -e APP_ENV=development -e DB_HOST=localhost my-app
```

在这个例子中，`APP_ENV` 和 `DB_HOST` 的值将被覆盖为 `development` 和 `localhost`。

### 3. 使用 `.env` 文件

对于复杂的配置，可以使用 `.env` 文件来管理环境变量。Docker Compose 和 `docker run` 都支持从 `.env` 文件中加载环境变量。

```env
APP_ENV=development
DB_HOST=localhost
```

然后，在 `docker-compose.yml` 文件中引用这些变量：

```yaml
version: '3'
services:
  app:
    image: my-app
    env_file: .env
```

## 在 Kubernetes 中配置环境变量

Kubernetes 提供了多种方式来配置环境变量，包括直接在 Pod 定义中设置、使用 ConfigMap 和 Secret。

### 1. 在 Pod 定义中设置环境变量

在 Kubernetes 的 Pod 定义中，可以通过 `env` 字段直接设置环境变量。

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: app-container
    image: my-app
    env:
    - name: APP_ENV
      value: "production"
    - name: DB_HOST
      value: "db.example.com"
```

### 2. 使用 ConfigMap 和 Secret

对于更复杂的配置，可以使用 ConfigMap 和 Secret 来管理环境变量。

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  APP_ENV: "production"
  DB_HOST: "db.example.com"
```

然后在 Pod 定义中引用 ConfigMap：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: app-container
    image: my-app
    envFrom:
    - configMapRef:
        name: app-config
```

## 实际案例

假设我们有一个简单的 Python Web 应用，它根据环境变量 `APP_ENV` 来决定是否启用调试模式。

```python
import os

app_env = os.getenv('APP_ENV', 'production')
debug = app_env == 'development'

if debug:
    print("Debug mode is enabled")
else:
    print("Debug mode is disabled")
```

在开发环境中，我们可以通过设置 `APP_ENV=development` 来启用调试模式：

```bash
docker run -e APP_ENV=development my-app
```

在生产环境中，我们可以保持默认值或显式设置为 `production`：

```bash
docker run -e APP_ENV=production my-app
```

## 总结

环境变量是容器配置中的重要组成部分，它们允许开发者在不同环境中动态调整应用程序的行为。通过 Dockerfile、Docker Compose、Kubernetes 等多种方式，我们可以灵活地管理和使用环境变量。

在实际应用中，环境变量通常用于存储敏感信息或环境特定的配置。通过合理使用环境变量，我们可以提高应用程序的可移植性和安全性。

## 附加资源与练习

- **练习 1**: 创建一个简单的 Docker 容器，使用环境变量来控制应用程序的行为。
- **练习 2**: 在 Kubernetes 中部署一个应用，使用 ConfigMap 来管理环境变量。
- **进一步阅读**: [Docker 官方文档](https://docs.docker.com/), [Kubernetes 官方文档](https://kubernetes.io/docs/).

:::tip
环境变量是配置容器化应用程序的强大工具，但请确保不要将敏感信息（如密码）直接硬编码在 Dockerfile 或 Kubernetes 配置文件中。使用 Secret 或其他安全机制来管理敏感数据。
:::