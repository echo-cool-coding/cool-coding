---
title: OpenTelemetry 日志级别
description: 学习OpenTelemetry中的日志级别及其在分布式系统中的实际应用。适合初学者的完整指南。
---

# OpenTelemetry 日志级别

## 介绍

日志级别是日志记录系统中用于分类日志消息严重程度的核心概念。在OpenTelemetry中，日志级别帮助开发者过滤和识别关键信息，尤其是在复杂的分布式系统中。本文将介绍OpenTelemetry支持的日志级别、如何设置它们，以及如何在实际场景中有效利用它们。

---

## 日志级别概述

OpenTelemetry遵循[OpenTelemetry日志数据模型](https://opentelemetry.io/docs/reference/specification/logs/data-model/)，定义了以下标准日志级别：

| 级别       | 数值 | 描述                                                                 |
|------------|------|--------------------------------------------------------------------|
| `TRACE`    | 1    | 最详细的调试信息，通常用于跟踪代码执行路径。                         |
| `DEBUG`    | 5    | 开发阶段的调试信息，有助于诊断问题。                                 |
| `INFO`     | 9    | 常规的系统运行状态信息（如服务启动）。                               |
| `WARN`     | 13   | 警告信息，表示潜在问题（如低磁盘空间）。                             |
| `ERROR`    | 17   | 错误信息，表示操作失败但系统仍可运行（如API请求失败）。               |
| `FATAL`    | 21   | 致命错误，导致系统无法继续运行（如数据库连接丢失）。                  |

:::tip
数值越大，日志级别越严重。大多数日志收集工具（如ELK或Grafana Loki）会基于这些数值进行过滤。
:::

---

## 代码示例

### 设置日志级别（Python示例）

以下示例展示如何在Python中使用OpenTelemetry设置日志级别：

```python
from opentelemetry import trace
from opentelemetry.sdk._logs import LogEmitterProvider
from opentelemetry.sdk._logs import set_log_emitter_provider
from opentelemetry.sdk._logs import LoggingHandler

# 初始化日志发射器
log_emitter_provider = LogEmitterProvider()
set_log_emitter_provider(log_emitter_provider)

# 将OpenTelemetry处理器绑定到Python标准库logging
import logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)
logger.addHandler(LoggingHandler())

# 记录不同级别的日志
logger.debug("Debug message (不会输出，因为全局级别为INFO)")
logger.info("Service started successfully")
logger.warning("Disk space below 20%")
logger.error("Failed to connect to database")
```

**输出结果**（假设日志收集器配置为`INFO`及以上级别）：
```
INFO:__main__:Service started successfully
WARNING:__main__:Disk space below 20%
ERROR:__main__:Failed to connect to database
```

---

## 实际应用场景

### 场景：微服务错误诊断
假设一个订单服务调用支付服务时失败：

1. **支付服务日志**（级别`ERROR`）：
   ```json
   {
     "timestamp": "2023-05-20T14:30:00Z",
     "severity": 17,
     "body": "Payment declined: insufficient funds",
     "attributes": {
       "service.name": "payment-service",
       "user.id": "12345"
     }
   }
   ```

2. **订单服务日志**（级别`WARN`）：
   ```json
   {
     "severity": 13,
     "body": "Retrying payment after failure",
     "trace_id": "abc123...",
     "span_id": "def456..."
   }
   ```

通过关联`trace_id`和日志级别，运维团队可以快速定位从`WARN`到`ERROR`的完整链路。

---

## 日志级别最佳实践

1. **生产环境推荐**：
   - 默认级别设为`INFO`或`WARN`
   - 通过动态配置临时启用`DEBUG`（如使用OpenTelemetry Collector的[处理器过滤](https://opentelemetry.io/docs/collector/configuration/#processors)）

2. **避免过度记录**：
   ```python
   # 反模式：在循环中记录DEBUG日志
   for item in large_list:
       logger.debug(f"Processing {item}")  # 可能产生百万级日志！
   ```

3. **跨服务一致性**：
   使用共享的日志级别定义（如通过Protobuf或环境变量）。

---

## 总结

OpenTelemetry的日志级别是分布式系统可观测性的基石。通过合理设置`TRACE`到`FATAL`级别，开发者可以平衡调试需求与系统性能。关键要点：
- 使用数值比较级别严重性
- 在生产环境中谨慎启用低级别日志
- 结合TraceID实现端到端诊断

---

## 扩展资源

1. [OpenTelemetry日志规范](https://opentelemetry.io/docs/reference/specification/logs/)
2. 练习：在本地环境中配置一个日志收集管道，仅接收`ERROR`及以上级别的日志。
3. 进阶阅读：[SRE实战：日志级别与告警策略](https://sre.google/sre-book/monitoring-distributed-systems/)