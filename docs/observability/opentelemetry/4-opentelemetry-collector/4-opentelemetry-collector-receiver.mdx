---
title: OpenTelemetry Collector接收器
description: 了解OpenTelemetry Collector接收器的核心概念、配置方法和实际应用场景，适合初学者的全面指南。
---

# OpenTelemetry Collector接收器

## 介绍

OpenTelemetry Collector是一个用于接收、处理和导出遥测数据（如指标、日志和跟踪）的中介组件。**接收器（Receiver）**是Collector的核心功能之一，负责从各种来源（如应用程序、基础设施或其他工具）接收数据。本文将详细介绍接收器的工作原理、配置方式以及实际应用。

---

## 接收器是什么？

接收器是OpenTelemetry Collector的输入组件，用于从不同来源收集数据。它支持多种协议和数据格式，例如：
- **OTLP**（OpenTelemetry Protocol）
- **Jaeger**
- **Prometheus**
- **Zipkin**
- **Syslog**（用于日志）

接收器将接收到的数据转换为Collector内部统一的格式，以便后续处理（Processor）和导出（Exporter）。

:::note
接收器不修改数据，仅负责接收和初步解码。
:::

---

## 接收器配置示例

以下是一个典型的接收器配置示例（YAML格式），展示了如何配置一个OTLP和Jaeger接收器：

```yaml
receivers:
  otlp:
    protocols:
      grpc:
      http:
  jaeger:
    protocols:
      grpc:
      thrift_http:
```

### 配置说明：
1. `otlp`：配置OTLP接收器，支持gRPC和HTTP协议。
2. `jaeger`：配置Jaeger接收器，支持gRPC和Thrift over HTTP协议。

---

## 接收器的工作原理

接收器通过以下步骤处理数据：
1. **监听端口**：接收器在指定端口上监听传入的数据（如OTLP默认使用4317端口）。
2. **解码数据**：将接收到的数据（如Protobuf、JSON）解码为Collector内部格式。
3. **传递数据**：将解码后的数据发送给处理管道（Pipeline）。

```mermaid
flowchart LR
    A[应用程序] -->|发送数据| B(接收器)
    B --> C[处理器]
    C --> D[导出器]
```

---

## 实际应用场景

### 场景1：从微服务收集跟踪数据
假设你有一个微服务架构，服务通过OTLP协议发送跟踪数据。配置OTLP接收器后，Collector可以集中接收这些数据并转发到后端（如Jaeger或Prometheus）。

```yaml
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
```

### 场景2：兼容旧版Jaeger客户端
如果你的系统仍在使用Jaeger客户端，可以通过Jaeger接收器兼容旧数据格式：

```yaml
receivers:
  jaeger:
    protocols:
      thrift_http:
        endpoint: 0.0.0.0:14268
```

---

## 常见问题

:::caution
1. **端口冲突**：确保接收器的端口未被其他服务占用。
2. **协议支持**：检查Collector的版本是否支持你需要的协议（如Zipkin需v0.40.0+）。
:::

---

## 总结

接收器是OpenTelemetry Collector的数据入口，支持多种协议和格式。通过合理配置，可以实现灵活的遥测数据收集。关键点：
1. 接收器负责接收和解码数据，不修改内容。
2. 支持OTLP、Jaeger等主流协议。
3. 配置简单，只需在YAML中定义协议和端口。

---

## 附加资源

1. [OpenTelemetry Collector官方文档](https://opentelemetry.io/docs/collector/)
2. 练习：尝试配置一个OTLP接收器，并通过`curl`发送测试数据。
3. 进阶：研究如何为自定义协议编写接收器插件。