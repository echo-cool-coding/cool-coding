---
title: PromQL运算符
description: 了解PromQL中的运算符，掌握如何使用它们进行数据查询和计算。
---

# PromQL运算符

PromQL（Prometheus Query Language）是Prometheus中用于查询和操作时间序列数据的强大语言。运算符是PromQL的核心组成部分，它们允许我们对时间序列数据进行各种计算和比较。本文将详细介绍PromQL中的运算符，并通过示例帮助初学者理解其用法。

## 介绍

PromQL支持多种运算符，包括算术运算符、比较运算符、逻辑运算符和聚合运算符。这些运算符可以用于对时间序列数据进行数学计算、条件判断和聚合操作。理解这些运算符的用法是掌握PromQL的关键。

## 算术运算符

PromQL支持以下算术运算符：

- `+`（加法）
- `-`（减法）
- `*`（乘法）
- `/`（除法）
- `%`（取模）
- `^`（幂运算）

### 示例

假设我们有两个时间序列 `http_requests_total{job="web"}` 和 `http_errors_total{job="web"}`，我们可以使用算术运算符来计算请求的成功率：

```promql
http_requests_total{job="web"} - http_errors_total{job="web"}
```

这个查询将返回每个时间点的成功请求数。

## 比较运算符

PromQL支持以下比较运算符：

- `==`（等于）
- `!=`（不等于）
- `>`（大于）
- `<`（小于）
- `>=`（大于等于）
- `<=`（小于等于）

### 示例

假设我们想要找出请求数超过1000的时间点，可以使用以下查询：

```promql
http_requests_total{job="web"} > 1000
```

这个查询将返回所有请求数大于1000的时间序列。

## 逻辑运算符

PromQL支持以下逻辑运算符：

- `and`（逻辑与）
- `or`（逻辑或）
- `unless`（逻辑非）

### 示例

假设我们想要找出请求数大于1000且错误数小于10的时间点，可以使用以下查询：

```promql
http_requests_total{job="web"} > 1000 and http_errors_total{job="web"} < 10
```

这个查询将返回所有满足条件的时间序列。

## 聚合运算符

PromQL支持多种聚合运算符，用于对时间序列数据进行聚合操作。常见的聚合运算符包括：

- `sum`（求和）
- `avg`（平均值）
- `min`（最小值）
- `max`（最大值）
- `count`（计数）
- `stddev`（标准差）
- `stdvar`（方差）
- `quantile`（分位数）

### 示例

假设我们想要计算所有实例的请求总数，可以使用以下查询：

```promql
sum(http_requests_total{job="web"})
```

这个查询将返回所有实例的请求总数。

## 实际案例

### 案例1：计算请求成功率

假设我们想要计算请求的成功率，可以使用以下查询：

```promql
(http_requests_total{job="web"} - http_errors_total{job="web"}) / http_requests_total{job="web"} * 100
```

这个查询将返回每个时间点的请求成功率。

### 案例2：找出高负载实例

假设我们想要找出CPU使用率超过80%的实例，可以使用以下查询：

```promql
instance_cpu_usage{job="web"} > 80
```

这个查询将返回所有CPU使用率超过80%的实例。

## 总结

PromQL的运算符是查询和操作时间序列数据的基础。通过掌握算术运算符、比较运算符、逻辑运算符和聚合运算符，您可以灵活地查询和分析Prometheus中的数据。希望本文的示例和解释能帮助您更好地理解PromQL运算符的用法。

## 附加资源

- [Prometheus官方文档](https://prometheus.io/docs/prometheus/latest/querying/basics/)
- [PromQL Cheat Sheet](https://prometheus.io/docs/prometheus/latest/querying/examples/)

## 练习

1. 使用算术运算符计算两个时间序列的差值。
2. 使用比较运算符找出某个指标超过阈值的时间点。
3. 使用聚合运算符计算某个指标的平均值。

通过练习这些操作，您将更加熟练地使用PromQL进行数据查询和分析。