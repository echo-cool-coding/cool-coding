---
title: 静态配置服务发现
description: 了解 Prometheus 中的静态配置服务发现，掌握如何手动配置目标以监控服务。
---

# 静态配置服务发现

在 Prometheus 中，服务发现是自动检测和监控目标的过程。然而，并非所有场景都需要动态服务发现。对于某些情况，手动配置目标（即静态配置服务发现）是更简单、更直接的选择。本文将详细介绍静态配置服务发现的概念、配置方法以及实际应用场景。

## 什么是静态配置服务发现？

静态配置服务发现是指通过手动定义目标列表来监控服务。与动态服务发现（如基于 DNS、Kubernetes 或 Consul 的发现机制）不同，静态配置不需要依赖外部系统或服务来动态更新目标列表。相反，目标列表直接在 Prometheus 的配置文件中定义。

静态配置适用于以下场景：
- 监控少量固定的目标。
- 目标不会频繁变化。
- 不需要复杂的动态发现机制。

## 静态配置的基本语法

在 Prometheus 的配置文件（通常是 `prometheus.yml`）中，静态配置通过 `static_configs` 字段定义。以下是一个简单的示例：

```yaml
scrape_configs:
  - job_name: 'example-job'
    static_configs:
      - targets: ['localhost:9090', 'localhost:9100']
```

在这个示例中：
- `job_name` 定义了任务的名称。
- `static_configs` 下的 `targets` 列出了要监控的目标地址和端口。

### 示例输出

假设 Prometheus 成功抓取了这些目标，你可以在 Prometheus 的 Web UI 中看到类似以下内容：

```
example-job{instance="localhost:9090", job="example-job"} 1
example-job{instance="localhost:9100", job="example-job"} 1
```

## 逐步讲解

### 1. 定义任务名称

每个 `scrape_configs` 条目都需要一个唯一的 `job_name`。这个名称用于标识任务，并在 Prometheus 的指标中作为标签（`job`）出现。

```yaml
job_name: 'example-job'
```

### 2. 配置目标列表

在 `static_configs` 下，使用 `targets` 字段列出要监控的目标。每个目标以 `host:port` 的形式表示。

```yaml
static_configs:
  - targets: ['localhost:9090', 'localhost:9100']
```

### 3. 添加标签（可选）

你可以为每个目标添加自定义标签，以便在 Prometheus 中更好地组织和查询数据。

```yaml
static_configs:
  - targets: ['localhost:9090', 'localhost:9100']
    labels:
      env: 'production'
      region: 'us-east'
```

### 4. 多个静态配置组

如果需要监控多个目标组，可以在 `static_configs` 中添加多个条目。

```yaml
static_configs:
  - targets: ['localhost:9090']
    labels:
      env: 'production'
  - targets: ['localhost:9100']
    labels:
      env: 'staging'
```

## 实际案例

### 案例 1：监控本地服务

假设你正在开发一个 Web 应用程序，并希望监控其性能。你可以在本地运行 Prometheus，并通过静态配置监控以下服务：
- 应用程序的 HTTP 服务（`localhost:8080`）。
- 数据库的监控端点（`localhost:9104`）。

```yaml
scrape_configs:
  - job_name: 'web-app'
    static_configs:
      - targets: ['localhost:8080']
        labels:
          service: 'web'
  - job_name: 'database'
    static_configs:
      - targets: ['localhost:9104']
        labels:
          service: 'db'
```

### 案例 2：监控多个环境的服务

如果你有多个环境（如生产环境和测试环境），可以通过静态配置为每个环境定义不同的目标。

```yaml
scrape_configs:
  - job_name: 'production'
    static_configs:
      - targets: ['prod-server-1:9090', 'prod-server-2:9090']
        labels:
          env: 'production'
  - job_name: 'staging'
    static_configs:
      - targets: ['staging-server-1:9090', 'staging-server-2:9090']
        labels:
          env: 'staging'
```

## 总结

静态配置服务发现是 Prometheus 中最简单、最直接的目标配置方式。它适用于目标数量较少且不频繁变化的场景。通过手动定义目标列表，你可以快速启动监控任务，而无需依赖复杂的动态发现机制。

:::tip
如果你需要监控的目标数量较多或频繁变化，建议使用动态服务发现机制（如基于 DNS 或 Kubernetes 的发现）。
:::

## 附加资源与练习

1. **练习**：尝试在本地配置 Prometheus，监控两个不同的服务（如 Nginx 和 Redis），并使用静态配置定义目标。
2. **资源**：
   - [Prometheus 官方文档](https://prometheus.io/docs/prometheus/latest/configuration/configuration/)
   - [Prometheus 静态配置示例](https://prometheus.io/docs/prometheus/latest/configuration/configuration/#static_config)

通过本文的学习，你应该已经掌握了静态配置服务发现的基本概念和配置方法。接下来，可以尝试在实际项目中应用这些知识，进一步提升你的监控能力！