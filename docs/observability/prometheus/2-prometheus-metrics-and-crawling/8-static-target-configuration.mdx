---
title: 静态目标配置
description: 了解如何在 Prometheus 中配置静态目标以抓取指标数据。本文适合初学者，包含详细的概念讲解、代码示例和实际案例。
---

# 静态目标配置

在 Prometheus 中，**静态目标配置**是一种简单且直接的方式来定义需要抓取的目标（targets）。目标是指 Prometheus 需要从中抓取指标数据的服务或应用程序。静态配置意味着目标列表是固定的，不会动态变化。这种方式适用于目标数量较少且不频繁变化的场景。

本文将详细介绍如何在 Prometheus 中配置静态目标，并通过示例和实际案例帮助你更好地理解这一概念。

---

## 什么是静态目标配置？

静态目标配置是指在 Prometheus 的配置文件（通常是 `prometheus.yml`）中手动列出需要抓取的目标。每个目标通常由一个 IP 地址或域名以及一个端口号组成。Prometheus 会定期向这些目标发送 HTTP 请求，抓取暴露的指标数据。

静态配置的优点是简单易用，适合初学者和小规模部署。然而，如果目标数量较多或需要动态调整，静态配置可能会变得难以管理。在这种情况下，可以考虑使用动态服务发现机制。

---

## 配置静态目标

在 Prometheus 中，静态目标通过 `static_configs` 字段进行配置。以下是一个简单的示例，展示了如何在 `prometheus.yml` 文件中定义静态目标：

```yaml
scrape_configs:
  - job_name: 'example-job'
    static_configs:
      - targets: ['localhost:9090', 'localhost:8080']
```

### 代码解释

- `job_name`: 定义了一个抓取任务的名称（例如 `example-job`）。每个任务可以包含多个目标。
- `static_configs`: 用于定义静态目标列表。
- `targets`: 列出了需要抓取的目标地址。每个目标以 `host:port` 的形式表示。

### 示例输出

假设 `localhost:9090` 和 `localhost:8080` 分别运行了两个服务，Prometheus 会定期向这两个地址发送 HTTP 请求，抓取指标数据。抓取到的数据将存储在 Prometheus 的时间序列数据库中。

---

## 实际案例

假设你正在监控一个由三个微服务组成的应用程序，这些微服务分别运行在以下地址：

- `service1.example.com:8080`
- `service2.example.com:8080`
- `service3.example.com:8080`

你可以通过以下配置将这些目标添加到 Prometheus 中：

```yaml
scrape_configs:
  - job_name: 'microservices'
    static_configs:
      - targets:
          - 'service1.example.com:8080'
          - 'service2.example.com:8080'
          - 'service3.example.com:8080'
```

### 运行效果

Prometheus 会定期抓取这三个服务的指标数据，并将其存储在数据库中。你可以通过 Prometheus 的 Web UI 或 Grafana 等工具查看这些数据。

---

## 高级配置

除了基本的目标地址，`static_configs` 还支持其他配置选项，例如标签（labels）。标签可以用于对目标进行分类或分组。以下是一个带有标签的示例：

```yaml
scrape_configs:
  - job_name: 'example-job'
    static_configs:
      - targets: ['localhost:9090', 'localhost:8080']
        labels:
          env: 'production'
          region: 'us-east'
```

在这个示例中，所有目标都会被附加 `env: production` 和 `region: us-east` 标签。这些标签可以帮助你在查询和可视化时更好地组织数据。

---

## 总结

静态目标配置是 Prometheus 中最简单的目标定义方式，适合初学者和小规模部署。通过 `static_configs`，你可以轻松地列出需要抓取的目标，并为其添加标签以增强数据的可读性。

然而，随着目标数量的增加或动态变化的需求，静态配置可能会变得不够灵活。在这种情况下，你可以探索 Prometheus 的动态服务发现机制，例如基于 Kubernetes、Consul 或 DNS 的服务发现。

---

## 附加资源与练习

### 资源
- [Prometheus 官方文档](https://prometheus.io/docs/introduction/overview/)
- [Prometheus 配置指南](https://prometheus.io/docs/prometheus/latest/configuration/configuration/)

### 练习
1. 在你的本地环境中配置一个 Prometheus 实例，并添加两个静态目标。
2. 尝试为目标添加自定义标签，并在 Prometheus Web UI 中查看效果。
3. 探索如何将静态配置与动态服务发现结合使用。

:::tip
如果你在配置过程中遇到问题，可以参考 Prometheus 的日志文件（通常位于 `/var/log/prometheus/`）以获取更多信息。
:::