---
title: 指标过滤配置
description: 学习如何在 Prometheus 中配置指标过滤，以便仅抓取和存储所需的指标数据。本文将从基础概念入手，逐步讲解如何通过配置实现指标过滤，并提供实际案例和代码示例。
---

# 指标过滤配置

在 Prometheus 中，指标过滤是一种重要的功能，它允许你仅抓取和存储你感兴趣的指标数据，从而减少存储空间的占用并提高查询效率。对于初学者来说，理解如何配置指标过滤是掌握 Prometheus 的关键一步。

## 什么是指标过滤？

指标过滤是指在 Prometheus 抓取目标时，通过配置规则来筛选出特定的指标数据。默认情况下，Prometheus 会抓取目标暴露的所有指标，但在实际应用中，我们可能只需要其中的一部分。通过指标过滤，我们可以减少不必要的数据抓取和存储，从而优化系统性能。

## 如何配置指标过滤？

Prometheus 提供了多种方式来配置指标过滤，其中最常用的是通过 `relabel_configs` 和 `metric_relabel_configs` 来实现。

### 1. 使用 `relabel_configs`

`relabel_configs` 用于在抓取目标之前对标签进行重新标记或过滤。通过这种方式，我们可以选择性地抓取特定的指标。

```yaml
scrape_configs:
  - job_name: 'example'
    static_configs:
      - targets: ['localhost:9090']
    relabel_configs:
      - source_labels: [__name__]
        regex: 'http_requests_total'
        action: keep
```

在这个示例中，Prometheus 只会抓取名为 `http_requests_total` 的指标，其他指标将被忽略。

### 2. 使用 `metric_relabel_configs`

`metric_relabel_configs` 用于在抓取目标之后对指标进行重新标记或过滤。这种方式适用于在抓取到指标后进一步筛选数据。

```yaml
scrape_configs:
  - job_name: 'example'
    static_configs:
      - targets: ['localhost:9090']
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'cpu_usage'
        action: drop
```

在这个示例中，Prometheus 会抓取所有指标，但在存储之前会丢弃名为 `cpu_usage` 的指标。

## 实际案例

假设你有一个应用程序，它暴露了多个指标，包括 `http_requests_total`、`cpu_usage` 和 `memory_usage`。你只对 `http_requests_total` 感兴趣，并且希望忽略其他指标。你可以通过以下配置实现：

```yaml
scrape_configs:
  - job_name: 'my_app'
    static_configs:
      - targets: ['localhost:8080']
    relabel_configs:
      - source_labels: [__name__]
        regex: 'http_requests_total'
        action: keep
```

在这个配置中，Prometheus 只会抓取 `http_requests_total` 指标，其他指标将被忽略。

## 总结

指标过滤是 Prometheus 中一个非常有用的功能，它可以帮助你优化数据抓取和存储。通过 `relabel_configs` 和 `metric_relabel_configs`，你可以灵活地配置指标过滤规则，从而只抓取和存储你感兴趣的指标数据。

## 附加资源与练习

- **练习**：尝试在你的 Prometheus 配置中添加 `relabel_configs` 和 `metric_relabel_configs`，并观察抓取结果的变化。
- **资源**：阅读 [Prometheus 官方文档](https://prometheus.io/docs/prometheus/latest/configuration/configuration/) 以了解更多关于指标过滤的配置选项。

通过本文的学习，你应该已经掌握了如何在 Prometheus 中配置指标过滤。继续实践和探索，你将能够更深入地理解 Prometheus 的强大功能。