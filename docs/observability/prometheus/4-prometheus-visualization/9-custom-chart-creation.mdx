---
title: 自定义图表创建
description: 学习如何在 Prometheus 中创建自定义图表，掌握 PromQL 查询语言的基础知识，并通过实际案例展示如何将数据可视化。
---

# 自定义图表创建

在 Prometheus 中，自定义图表是监控和可视化数据的关键工具。通过自定义图表，您可以根据自己的需求创建直观的图表，帮助您更好地理解系统的运行状态。本文将逐步介绍如何使用 Prometheus 和 Grafana 创建自定义图表，并通过实际案例展示其应用。

## 什么是自定义图表？

自定义图表是指根据特定的查询和需求，将 Prometheus 收集的指标数据以图表的形式展示出来。通过 PromQL（Prometheus 查询语言），您可以定义复杂的查询逻辑，并将结果可视化。Grafana 是一个常用的工具，用于将 Prometheus 数据以图表的形式展示。

## 创建自定义图表的步骤

### 1. 安装和配置 Prometheus 和 Grafana

在开始之前，请确保您已经安装并配置了 Prometheus 和 Grafana。如果您还没有安装，可以参考官方文档进行安装。

### 2. 编写 PromQL 查询

PromQL 是 Prometheus 的查询语言，用于从 Prometheus 中提取数据。以下是一个简单的 PromQL 查询示例，用于获取 CPU 使用率：

```promql
rate(node_cpu_seconds_total{mode="user"}[1m])
```

这个查询将返回过去一分钟内 CPU 用户模式的使用率。

### 3. 在 Grafana 中创建图表

在 Grafana 中，您可以通过以下步骤创建自定义图表：

1. 登录 Grafana 并创建一个新的仪表板。
2. 添加一个新的面板。
3. 在面板的查询编辑器中，输入您的 PromQL 查询。
4. 配置图表的显示选项，如图表类型、颜色、标签等。

以下是一个在 Grafana 中配置图表的示例：

```json
{
  "targets": [
    {
      "expr": "rate(node_cpu_seconds_total{mode=\"user\"}[1m])",
      "format": "time_series",
      "intervalFactor": 2,
      "refId": "A"
    }
  ],
  "title": "CPU 使用率",
  "type": "graph"
}
```

### 4. 调整图表样式

Grafana 提供了丰富的图表样式选项，您可以根据需要调整图表的颜色、线条样式、图例位置等。通过调整这些选项，您可以使图表更加直观和易于理解。

## 实际案例：监控 Web 服务器的请求速率

假设您需要监控一个 Web 服务器的请求速率，您可以使用以下 PromQL 查询：

```promql
rate(http_requests_total[1m])
```

在 Grafana 中，您可以创建一个折线图来展示请求速率的变化。通过观察图表，您可以快速识别出请求速率的异常波动，从而采取相应的措施。

## 总结

通过本文，您已经学习了如何在 Prometheus 中创建自定义图表。我们介绍了 PromQL 查询语言的基础知识，并通过实际案例展示了如何将数据可视化。自定义图表是监控系统状态的重要工具，掌握这些技能将帮助您更好地管理和优化您的系统。

## 附加资源

- [Prometheus 官方文档](https://prometheus.io/docs/)
- [Grafana 官方文档](https://grafana.com/docs/)
- [PromQL 查询语言指南](https://prometheus.io/docs/prometheus/latest/querying/basics/)

## 练习

1. 使用 PromQL 查询您的系统中某个指标的数据，并在 Grafana 中创建一个折线图。
2. 尝试调整图表的样式，使其更加直观和易于理解。
3. 创建一个仪表板，包含多个图表，展示系统的不同指标。

通过完成这些练习，您将更加熟练地掌握自定义图表的创建和使用。