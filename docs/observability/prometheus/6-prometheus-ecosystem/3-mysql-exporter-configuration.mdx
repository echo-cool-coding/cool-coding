---
title: MySQL Exporter 配置
description: 学习如何配置 MySQL Exporter，以便将 MySQL 数据库的监控数据导出到 Prometheus 中。本文适合初学者，包含详细的步骤和实际案例。
---

# MySQL Exporter 配置

MySQL Exporter 是 Prometheus 生态系统中的一个重要组件，用于从 MySQL 数据库中收集监控指标，并将其导出到 Prometheus 中。通过配置 MySQL Exporter，您可以轻松监控 MySQL 数据库的性能、健康状况和资源使用情况。

## 什么是 MySQL Exporter？

MySQL Exporter 是一个开源工具，专门用于从 MySQL 数据库中提取监控数据。它通过查询 MySQL 的系统表和状态变量，收集诸如查询性能、连接数、表锁等关键指标。这些指标随后被导出为 Prometheus 可识别的格式，供 Prometheus 抓取和存储。

## 安装 MySQL Exporter

在开始配置之前，您需要先安装 MySQL Exporter。以下是安装步骤：

1. **下载 MySQL Exporter**  
   您可以从 [Prometheus 官方 GitHub 仓库](https://github.com/prometheus/mysqld_exporter) 下载适用于您操作系统的二进制文件。

2. **解压并安装**  
   下载完成后，解压文件并将 `mysqld_exporter` 可执行文件放置到系统的可执行路径中。

   ```bash
   tar -xzf mysqld_exporter-*.tar.gz
   sudo mv mysqld_exporter-*/mysqld_exporter /usr/local/bin/
   ```

3. **验证安装**  
   运行以下命令，确保 MySQL Exporter 已正确安装：

   ```bash
   mysqld_exporter --version
   ```

## 配置 MySQL Exporter

MySQL Exporter 的配置主要包括两个部分：**MySQL 数据库连接配置** 和 **Prometheus 抓取配置**。

### 1. 配置 MySQL 数据库连接

MySQL Exporter 需要通过 MySQL 用户连接到数据库。为了安全起见，建议创建一个专用的监控用户，并授予其必要的权限。

#### 创建监控用户

在 MySQL 中执行以下 SQL 语句，创建一个名为 `exporter` 的用户，并授予其监控权限：

```sql
CREATE USER 'exporter'@'localhost' IDENTIFIED BY 'your_password' WITH MAX_USER_CONNECTIONS 3;
GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'exporter'@'localhost';
FLUSH PRIVILEGES;
```

:::caution
请确保将 `your_password` 替换为强密码，并根据需要调整 `localhost` 为允许连接的主机。
:::

#### 配置 MySQL Exporter

创建一个配置文件（例如 `my.cnf`），用于存储 MySQL 连接信息：

```ini
[client]
user=exporter
password=your_password
host=localhost
port=3306
```

然后，通过以下命令启动 MySQL Exporter，并指定配置文件路径：

```bash
mysqld_exporter --config.my-cnf=/path/to/my.cnf
```

### 2. 配置 Prometheus 抓取

在 Prometheus 的配置文件 `prometheus.yml` 中，添加一个新的抓取任务，指向 MySQL Exporter 的地址：

```yaml
scrape_configs:
  - job_name: 'mysql'
    static_configs:
      - targets: ['localhost:9104']
```

:::tip
默认情况下，MySQL Exporter 会在 `9104` 端口上暴露指标。您可以通过 `--web.listen-address` 参数更改监听地址。
:::

## 实际案例

假设您有一个运行在 `localhost` 上的 MySQL 数据库，并且希望通过 Prometheus 监控其性能。以下是完整的配置步骤：

1. **创建监控用户**  
   在 MySQL 中创建用户并授予权限。

2. **启动 MySQL Exporter**  
   使用配置文件启动 MySQL Exporter。

3. **配置 Prometheus**  
   在 `prometheus.yml` 中添加抓取任务。

4. **验证指标**  
   访问 Prometheus 的 Web UI，查询 `mysql_global_status_questions` 等指标，验证数据是否正常抓取。

## 总结

通过本文，您已经学会了如何配置 MySQL Exporter，以便将 MySQL 数据库的监控数据导出到 Prometheus 中。MySQL Exporter 是监控 MySQL 数据库的强大工具，能够帮助您及时发现性能瓶颈和潜在问题。

## 附加资源

- [MySQL Exporter 官方文档](https://github.com/prometheus/mysqld_exporter)
- [Prometheus 官方文档](https://prometheus.io/docs/)
- [MySQL 监控最佳实践](https://www.percona.com/blog/)

## 练习

1. 尝试在您的本地环境中配置 MySQL Exporter，并将其集成到 Prometheus 中。
2. 使用 Grafana 创建一个仪表板，可视化 MySQL 的关键指标。
3. 探索 MySQL Exporter 的其他配置选项，例如自定义查询和指标过滤。

希望本文对您的学习有所帮助！如果有任何问题，欢迎在评论区留言讨论。