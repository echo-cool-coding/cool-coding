---
title: 自定义视图设置
description: "学习如何在Zipkin UI中创建和使用自定义视图来优化分布式追踪数据的可视化分析"
---

# 自定义视图设置

## 介绍

在Zipkin的Web界面中，**自定义视图**允许你根据特定需求调整追踪数据的展示方式。通过灵活配置，你可以快速聚焦关键信息，提升排查分布式系统问题的效率。对于初学者而言，掌握这一功能能显著提升使用Zipkin的体验。

Zipkin默认提供的视图已经非常实用，但在复杂系统中，你可能需要：

- 过滤特定服务或端点的追踪数据
- 调整时间范围显示方式
- 自定义展示的标签和字段
- 保存常用查询条件以便快速复用

## 基础配置

### 访问视图设置

1. 打开Zipkin UI（通常为 `http://localhost:9411`）
2. 在顶部导航栏找到 **"Explore"** 或 **"查询"** 选项卡
3. 页面右侧会看到 **"Customize View"** 按钮

:::tip
如果找不到该按钮，请确认你的Zipkin版本是否支持此功能（建议v2.23+）
:::

### 基本过滤选项

```json
{
  "serviceName": "user-service",
  "spanName": "GET /user/{id}",
  "tags": {
    "http.status_code": "200"
  }
}
```

上述JSON展示了如何通过服务名、span名称和标签进行基础过滤。在UI中，这些条件可以通过表单交互式设置，无需手动输入JSON。

## 高级自定义功能

### 时间范围选择器

Zipkin提供多种时间范围预设，但你也可以：

1. 使用绝对时间选择器指定精确时间范围
2. 保存常用时间范围（如"最近15分钟"）
3. 通过URL参数共享时间范围设置

示例URL参数格式：
`?startTimestamp=1625097600000&endTimestamp=1625184000000`

### 标签显示配置

在追踪详情页面，你可以控制显示哪些标签：

1. 点击 **"Settings"** 图标（通常为齿轮形状）
2. 在 **"Display settings"** 中选择要显示的标签
3. 拖动标签调整显示顺序

```mermaid
graph TD
    A[进入追踪详情] --> B[点击设置图标]
    B --> C[选择"Display settings"]
    C --> D[勾选/取消勾选标签]
    D --> E[保存配置]
```

### 自定义查询保存

对于频繁使用的查询条件，可以点击 **"Save Query"** 按钮将其保存。保存后的查询会出现在侧边栏的 **"Saved Queries"** 部分。

:::caution
查询保存功能可能需要浏览器本地存储支持，清除缓存会导致保存的查询丢失
:::

## 实际应用案例

### 案例1：监控特定错误

假设你需要监控 `payment-service` 中所有失败的支付操作：

1. 设置服务名过滤为 `payment-service`
2. 添加标签过滤 `error=true`
3. 保存为 "Payment Errors" 查询

### 案例2：性能分析

分析 `GET /products` 端点的慢请求：

1. 设置span名称为 `GET /products`
2. 调整时间范围为业务高峰时段
3. 按持续时间降序排列
4. 添加 `duration>100ms` 条件

## 总结

通过Zipkin的自定义视图功能，你可以：

- 快速定位特定类型的追踪数据
- 创建个性化的监控视图
- 保存常用查询提升工作效率
- 与团队共享有用的查询配置

## 延伸学习

建议尝试以下练习巩固知识：

1. 创建一个显示所有耗时超过500ms的span的视图
2. 配置一个只显示错误响应的视图并保存
3. 尝试通过URL参数分享你的自定义视图

如需更深入了解，可参考：
- Zipkin官方文档中的UI自定义章节
- OpenTelemetry的追踪数据模型规范