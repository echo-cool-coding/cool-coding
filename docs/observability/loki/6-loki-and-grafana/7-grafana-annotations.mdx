---
title: Grafana注释
description: 学习如何在Grafana中使用注释功能增强日志和指标的可视化效果，实现关键事件的标记与上下文关联。
---

# Grafana注释

## 介绍

Grafana注释（Annotations）是一种强大的可视化工具，允许用户在仪表板图表上标记特定时间点的事件。这些注释可以来自：
- 手动输入
- Loki等日志系统的查询结果
- 外部API或数据库

注释通常用于标记关键事件（如部署、告警触发），帮助团队快速理解数据波动的原因。

## 基础用法

### 1. 手动添加注释
在Grafana仪表板界面：
1. 点击图表标题 → **"Annotations"** → **"Add Annotation"**
2. 填写时间范围、文本描述和标签（可选）

```plaintext
示例注释内容：
- 时间: 2023-05-01 14:00
- 文本: "生产环境v1.2部署"
- 标签: deployment, production
```

### 2. 通过Loki日志自动生成
在仪表板的 **"Dashboard Settings"** → **"Annotations"** 添加新数据源：

```yaml
Name: ErrorEvents
Data source: Loki
Query: {job="myapp"} |= "error"
Tags: error,alert  # 可选的标签
```

## 实际案例

### 场景：分析服务延迟峰值
1. **配置注释**：
   - 从Loki查询部署日志：`{app="backend"} |= "deployment"`
   - 从Prometheus查询告警：`ALERTS{alertname="HighLatency"}`

2. **结果展示**：
```mermaid
timeline
    title 服务延迟与事件关联
    section 延迟指标
    2023-05-01 13:58 : 150ms
    2023-05-01 14:00 : 1200ms
    2023-05-01 14:05 : 180ms
    section 注释事件
    2023-05-01 14:00 : 部署v1.2
    2023-05-01 14:01 : 触发HighLatency告警
```

## 高级功能

### 动态模板化注释
在注释文本中使用变量：
```go
{{ .__value }}  // 显示查询返回的原始值
{{ .time }}     // 事件时间戳
```

:::tip 最佳实践
- 为不同事件类型使用颜色区分（如部署=蓝色，告警=红色）
- 结合Grafana的 **"Annotation Query"** 实现自动刷新
- 限制注释数量避免视觉混乱
:::

## 总结

Grafana注释通过将事件与指标/日志关联，显著提升了以下场景的效率：
- 故障排查（快速定位事件影响）
- 变更管理（跟踪部署效果）
- 团队协作（共享上下文信息）

## 扩展练习
1. 创建一个显示最近5次部署的注释层
2. 配置Loki日志错误自动标注到CPU使用率图表
3. 尝试通过Grafana HTTP API批量导入注释

:::note 附加资源
- [官方文档：Annotations](https://grafana.com/docs/grafana/latest/dashboards/annotations/)
- [实战视频：Loki+Annotations](https://youtube.com/watch?v=example)
:::