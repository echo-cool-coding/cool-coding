---
title: SkyWalking 告警持续时间设置
description: 学习如何配置SkyWalking告警规则的持续时间条件，实现精准的异常检测与通知机制。
---

# SkyWalking 告警持续时间设置

## 介绍

在分布式系统的监控场景中，**告警持续时间**是避免误报的关键参数。SkyWalking的告警系统允许您设置触发规则前异常状态必须持续的最小时间窗口，确保只有真实问题才会触发通知。例如，短暂的服务抖动（持续10秒）可能无需告警，但持续5分钟的异常则需立即处理。

## 核心概念

告警持续时间通过以下两个参数定义：

1. **`period`**：检测周期（单位：分钟）
2. **`duration`**：异常必须持续的周期数

:::tip 工作流程
当指标在连续`duration`个`period`周期内满足条件时，才会触发告警
:::

## 配置示例

以下是一个完整的告警规则配置片段，重点关注持续时间部分：

```yaml
rules:
  service_resp_time_rule:
    metrics-name: service_resp_time
    op: ">"
    threshold: 1000
    period: 2       # 每个检测周期为2分钟
    duration: 3      # 需要持续3个周期（即6分钟）
    silence-period: 5
    message: 服务 {name} 响应时间超过1秒持续6分钟
```

## 实际案例解析

### 场景描述
假设我们需要监控订单服务的响应时间：

- 阈值：800毫秒
- 检测周期(`period`)：1分钟
- 持续时间(`duration`)：5个周期

```mermaid
timeline
    title 告警触发时间线示例
    section 监控周期
    00:00 : 650ms (正常)
    00:01 : 820ms (异常开始)
    00:02 : 850ms
    00:03 : 810ms
    00:04 : 830ms
    00:05 : 840ms (满足5周期条件，触发告警)
```

:::note 关键观察
即使从00:01开始出现异常，系统会在00:05（持续5分钟后）才触发告警，避免短暂波动造成的干扰
:::

## 高级配置技巧

### 组合持续时间条件
可以通过`composite-rules`实现多条件组合检测：

```yaml
composite-rules:
  service_health_rule:
    expression: service_resp_time_rule && service_sla_rule
    duration: 2  # 需要同时满足两个条件持续2个周期
```

### 动态调整建议
根据业务特点设置持续时间：
- 核心支付服务：`duration=1`（快速响应）
- 报表生成服务：`duration=10`（允许更长的恢复时间）

## 常见问题解答

:::warning 注意事项
1. `period`最小值取决于数据上报频率（通常≥1分钟）
2. 修改持续时间后需要重启OAP服务生效
3. 测试时建议先用`duration=1`验证基础规则
:::

## 总结

合理设置告警持续时间能显著降低运维噪音，您应该：
1. 根据业务关键性确定持续时间
2. 结合历史数据评估合适的周期长度
3. 使用`silence-period`避免重复告警

## 扩展练习
1. 为您的API服务创建一个规则：当错误率>5%持续10分钟时触发
2. 尝试在SkyWalking UI中实时修改`duration`参数并观察效果

## 后续学习
- 官方文档：[告警配置指南](https://skywalking.apache.org/docs/)