---
title: 查询过滤与排序
description: 学习如何在 Grafana 中使用查询过滤与排序功能，优化数据展示并提升分析效率。
---

# 查询过滤与排序

在 Grafana 中，查询过滤与排序是优化数据展示和分析的重要功能。通过过滤，您可以筛选出符合特定条件的数据；通过排序，您可以按照某种规则对数据进行排列。这些功能帮助您更高效地处理和分析数据，尤其是在处理大量数据时。

## 什么是查询过滤与排序？

查询过滤是指从数据集中筛选出符合特定条件的数据。例如，您可能只想查看某个时间段内的数据，或者只关注某个特定标签的数据。排序则是指按照某种规则（如时间、数值大小等）对数据进行排列，以便更直观地观察数据的趋势或分布。

在 Grafana 中，查询过滤与排序通常通过查询语言（如 PromQL、SQL 等）或内置的过滤和排序功能来实现。

## 查询过滤

### 基本过滤

在 Grafana 中，过滤通常通过查询语言中的条件语句来实现。以下是一个使用 PromQL 进行过滤的示例：

```promql
http_requests_total{status="200"}
```

在这个查询中，我们只筛选出状态码为 200 的 HTTP 请求数据。

### 时间范围过滤

Grafana 提供了时间范围选择器，您可以通过它来过滤出特定时间段内的数据。例如，如果您只想查看过去 24 小时内的数据，可以在时间范围选择器中选择 "Last 24 hours"。

### 标签过滤

在 Prometheus 等数据源中，您可以通过标签来过滤数据。例如：

```promql
http_requests_total{job="api-server", environment="production"}
```

这个查询只返回 `job` 为 `api-server` 且 `environment` 为 `production` 的 HTTP 请求数据。

## 查询排序

### 基本排序

在 Grafana 中，排序通常通过查询语言中的排序函数来实现。以下是一个使用 PromQL 进行排序的示例：

```promql
sort_desc(http_requests_total)
```

这个查询将返回按 HTTP 请求总数降序排列的数据。

### 多字段排序

在某些数据源中，您可以通过多个字段进行排序。例如，在 SQL 数据源中，您可以编写如下查询：

```sql
SELECT * FROM orders ORDER BY order_date DESC, total_amount DESC;
```

这个查询将首先按 `order_date` 降序排列，然后在相同 `order_date` 的情况下按 `total_amount` 降序排列。

## 实际案例

### 案例 1：监控系统性能

假设您正在监控一个系统的性能，并且想要查看过去 1 小时内 CPU 使用率最高的 5 个节点。您可以使用以下 PromQL 查询：

```promql
topk(5, rate(node_cpu_seconds_total{mode="system"}[1h]))
```

这个查询将返回过去 1 小时内系统模式下 CPU 使用率最高的 5 个节点。

### 案例 2：分析销售数据

假设您有一个销售数据表，并且想要查看过去 7 天内销售额最高的 10 个产品。您可以使用以下 SQL 查询：

```sql
SELECT product_name, SUM(sales_amount) AS total_sales
FROM sales
WHERE sale_date >= NOW() - INTERVAL '7 days'
GROUP BY product_name
ORDER BY total_sales DESC
LIMIT 10;
```

这个查询将返回过去 7 天内销售额最高的 10 个产品及其总销售额。

## 总结

查询过滤与排序是 Grafana 中非常强大的功能，能够帮助您更高效地处理和分析数据。通过合理使用过滤和排序，您可以快速找到所需的数据，并从中提取有价值的信息。

## 附加资源与练习

- **练习 1**：尝试在 Grafana 中创建一个仪表盘，使用 PromQL 查询过滤出某个特定服务的错误日志，并按时间排序。
- **练习 2**：使用 SQL 数据源，编写一个查询，过滤出过去 30 天内销售额最高的 5 个产品，并按销售额降序排列。

通过不断练习，您将更加熟练地掌握 Grafana 中的查询过滤与排序功能。