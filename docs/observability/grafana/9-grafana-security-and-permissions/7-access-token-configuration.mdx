---
title: 访问令牌配置
description: 了解如何在 Grafana 中配置访问令牌，以安全地管理 API 访问权限。本文适合初学者，包含详细的步骤、代码示例和实际应用场景。
---

# 访问令牌配置

在 Grafana 中，访问令牌（Access Tokens）是一种用于身份验证和授权的机制，允许用户或应用程序通过 API 与 Grafana 进行交互。通过配置访问令牌，您可以控制谁可以访问 Grafana 的哪些资源，从而确保系统的安全性。

## 什么是访问令牌？

访问令牌是一个字符串，通常由 Grafana 生成，用于验证 API 请求的合法性。它类似于密码，但通常具有更短的生存期和更细粒度的权限控制。访问令牌可以用于自动化脚本、CI/CD 管道或其他需要与 Grafana API 交互的场景。

## 创建访问令牌

要在 Grafana 中创建访问令牌，请按照以下步骤操作：

1. **登录 Grafana**：使用您的 Grafana 账户登录到 Grafana 仪表板。
2. **导航到 API 密钥页面**：在左侧导航栏中，点击“Configuration”（配置）图标，然后选择“API Keys”（API 密钥）。
3. **创建新的 API 密钥**：点击“Add API Key”（添加 API 密钥）按钮。
4. **配置 API 密钥**：
   - **Name**（名称）：为您的 API 密钥命名，例如“CI/CD Pipeline”。
   - **Role**（角色）：选择适当的角色（如“Viewer”、“Editor”或“Admin”）。
   - **Time to live**（生存时间）：设置令牌的有效期，例如“1h”或“30d”。
5. **生成令牌**：点击“Add”（添加）按钮，Grafana 将生成一个新的访问令牌。

:::caution
请务必在生成令牌后立即复制并保存它，因为您将无法再次查看该令牌。
:::

## 使用访问令牌

生成访问令牌后，您可以在 API 请求中使用它来进行身份验证。以下是一个使用 `curl` 命令通过访问令牌获取 Grafana 仪表板列表的示例：

```bash
curl -H "Authorization: Bearer YOUR_ACCESS_TOKEN" https://your-grafana-instance/api/dashboards
```

### 示例输出

```json
[
  {
    "id": 1,
    "title": "System Overview",
    "type": "dash-db"
  },
  {
    "id": 2,
    "title": "Network Traffic",
    "type": "dash-db"
  }
]
```

## 实际应用场景

### 自动化监控

假设您正在构建一个自动化监控系统，该系统需要定期从 Grafana 中提取数据并生成报告。通过使用访问令牌，您可以在脚本中安全地调用 Grafana API，而无需暴露您的 Grafana 账户密码。

```bash
#!/bin/bash

ACCESS_TOKEN="YOUR_ACCESS_TOKEN"
GRAFANA_URL="https://your-grafana-instance/api/dashboards"

# 获取仪表板列表
DASHBOARDS=$(curl -s -H "Authorization: Bearer $ACCESS_TOKEN" $GRAFANA_URL)

# 处理仪表板数据
echo $DASHBOARDS | jq '.[].title'
```

### CI/CD 集成

在 CI/CD 管道中，您可能需要将构建或部署的状态推送到 Grafana 仪表板。通过使用访问令牌，您可以在 CI/CD 脚本中安全地与 Grafana API 交互。

```yaml
steps:
  - name: Push Deployment Status to Grafana
    run: |
      curl -X POST -H "Authorization: Bearer $GRAFANA_TOKEN" \
      -H "Content-Type: application/json" \
      -d '{"dashboardId": 1, "status": "success"}' \
      https://your-grafana-instance/api/annotations
```

## 总结

访问令牌是 Grafana 中管理 API 访问权限的重要工具。通过正确配置和使用访问令牌，您可以确保系统的安全性，同时实现自动化操作和集成。请务必妥善保管您的访问令牌，并定期轮换以提高安全性。

## 附加资源

- [Grafana 官方文档：API 密钥](https://grafana.com/docs/grafana/latest/administration/api-keys/)
- [Grafana API 参考](https://grafana.com/docs/grafana/latest/http_api/)

## 练习

1. 在 Grafana 中创建一个新的访问令牌，并使用 `curl` 命令测试其有效性。
2. 编写一个简单的 Bash 脚本，使用访问令牌从 Grafana 中提取仪表板数据并输出到控制台。
3. 尝试在 CI/CD 管道中集成 Grafana API，将构建状态推送到 Grafana 仪表板。
