---
title: Azure Monitor 数据源配置
description: 学习如何在 Grafana 中配置 Azure Monitor 数据源，以便监控和分析 Azure 资源的数据。
---

# Azure Monitor 数据源配置

Azure Monitor 是 Microsoft Azure 提供的一项服务，用于收集、分析和可视化 Azure 资源的数据。通过将 Azure Monitor 配置为 Grafana 的数据源，您可以在 Grafana 中创建丰富的仪表盘，实时监控 Azure 资源的状态和性能。

## 什么是 Azure Monitor？

Azure Monitor 提供了全面的监控解决方案，能够收集来自 Azure 虚拟机、应用程序、网络和其他资源的数据。它支持多种数据类型，包括指标、日志和活动日志。通过 Azure Monitor，您可以设置警报、创建自定义查询，并将数据可视化。

## 配置 Azure Monitor 数据源

要在 Grafana 中使用 Azure Monitor 数据源，您需要完成以下步骤：

### 1. 创建 Azure 服务主体

首先，您需要在 Azure 中创建一个服务主体（Service Principal），以便 Grafana 能够访问 Azure Monitor 数据。

1. 登录到 [Azure 门户](https://portal.azure.com)。
2. 导航到 **Azure Active Directory** > **应用注册** > **新注册**。
3. 填写应用名称并点击 **注册**。
4. 记下 **应用程序（客户端）ID** 和 **目录（租户）ID**。
5. 导航到 **证书和密码** > **新客户端密码**，创建一个新的密码并记下它。

### 2. 在 Grafana 中添加 Azure Monitor 数据源

1. 登录到 Grafana。
2. 导航到 **Configuration** > **Data Sources** > **Add data source**。
3. 选择 **Azure Monitor**。
4. 填写以下字段：
   - **Name**: 数据源的名称（例如：Azure Monitor）。
   - **Directory (tenant) ID**: 您在 Azure 中创建的目录（租户）ID。
   - **Application (client) ID**: 您在 Azure 中创建的应用程序（客户端）ID。
   - **Client Secret**: 您在 Azure 中创建的客户端密码。
5. 点击 **Save & Test**，确保配置正确。

### 3. 使用 Azure Monitor 数据源

配置完成后，您可以在 Grafana 中使用 Azure Monitor 数据源创建仪表盘。以下是一个简单的示例，展示如何查询 Azure 虚拟机的 CPU 使用率：

1. 创建一个新的仪表盘。
2. 添加一个新的面板。
3. 在查询编辑器中，选择 **Azure Monitor** 数据源。
4. 选择 **Metric** 作为查询类型。
5. 选择 **Resource Group** 和 **Virtual Machine**。
6. 选择 **Percentage CPU** 作为指标。
7. 点击 **Run Query**，查看结果。

:::note
您可以根据需要调整时间范围和聚合方式，以获取更精确的数据。
:::

## 实际应用场景

假设您正在管理一个运行在 Azure 上的电子商务网站。您可以使用 Azure Monitor 数据源来监控以下内容：

- **虚拟机性能**: 监控 CPU、内存和磁盘使用率，确保网站运行顺畅。
- **应用程序性能**: 监控应用程序的响应时间和错误率，及时发现并解决问题。
- **网络流量**: 监控入站和出站流量，确保网络带宽充足。

通过将这些数据可视化在 Grafana 仪表盘中，您可以实时了解系统的健康状况，并在出现问题时迅速采取行动。

## 总结

通过配置 Azure Monitor 数据源，您可以在 Grafana 中轻松监控和分析 Azure 资源的数据。本文介绍了如何创建 Azure 服务主体、在 Grafana 中添加 Azure Monitor 数据源，并通过实际案例展示了其应用场景。

## 附加资源

- [Azure Monitor 官方文档](https://docs.microsoft.com/en-us/azure/azure-monitor/)
- [Grafana 官方文档](https://grafana.com/docs/)

## 练习

1. 在 Azure 中创建一个新的服务主体，并在 Grafana 中配置 Azure Monitor 数据源。
2. 使用 Azure Monitor 数据源创建一个仪表盘，监控 Azure 虚拟机的 CPU 使用率。
3. 尝试添加其他指标（如内存使用率、磁盘 I/O）到仪表盘中，并观察数据的变化。

通过完成这些练习，您将更深入地理解如何在 Grafana 中使用 Azure Monitor 数据源来监控 Azure 资源。