---
title: Debian 自动安装
description: 学习如何使用自动化工具在 Debian 系统上进行无人值守安装，简化系统部署流程。
---

# Debian 自动安装

在部署 Debian 系统时，手动安装可能会耗费大量时间和精力，尤其是在需要安装多台机器时。为了简化这一过程，Debian 提供了自动安装功能，允许用户通过预定义的配置文件实现无人值守安装。本文将详细介绍如何使用 Debian 的自动安装功能，帮助初学者快速掌握这一技能。

## 什么是 Debian 自动安装？

Debian 自动安装（Automated Installation）是一种通过配置文件（通常称为 `preseed` 文件）来定义安装过程中所有选项的方法。通过这种方式，用户可以在无需手动干预的情况下完成系统的安装和配置。这种方法特别适用于需要批量部署系统的场景，例如服务器集群或虚拟机环境。

## 准备工作

在开始之前，您需要准备以下内容：

1. **Debian 安装介质**：可以是 ISO 文件、USB 驱动器或网络引导（PXE）环境。
2. **`preseed` 文件**：这是一个包含安装选项的配置文件，通常以 `.cfg` 为扩展名。
3. **网络连接**：确保目标机器能够访问互联网，以便在安装过程中下载所需的软件包。

## 创建 `preseed` 文件

`preseed` 文件是自动安装的核心。它定义了安装过程中的所有选项，例如语言、时区、分区方案、用户设置等。以下是一个简单的 `preseed` 文件示例：

```plaintext
# 设置语言和地区
d-i debian-installer/locale string en_US
d-i debian-installer/language string en
d-i debian-installer/country string US

# 设置键盘布局
d-i keyboard-configuration/xkb-keymap select us

# 设置网络配置
d-i netcfg/choose_interface select auto
d-i netcfg/get_hostname string debian
d-i netcfg/get_domain string example.com

# 设置用户和密码
d-i passwd/user-fullname string Debian User
d-i passwd/username string debian
d-i passwd/user-password password insecure
d-i passwd/user-password-again password insecure

# 设置分区方案
d-i partman-auto/disk string /dev/sda
d-i partman-auto/method string regular
d-i partman-auto/choose_recipe select atomic
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true

# 安装基本系统
tasksel tasksel/first multiselect standard
d-i pkgsel/include string openssh-server vim

# 设置时区
d-i time/zone string UTC

# 设置引导加载程序
d-i grub-installer/only_debian boolean true
d-i grub-installer/with_other_os boolean true

# 完成安装
d-i finish-install/reboot_in_progress note
```

:::note
**注意**：在实际使用中，请确保密码的安全性，避免使用示例中的弱密码。
:::

## 使用 `preseed` 文件进行自动安装

### 方法一：通过引导参数加载 `preseed` 文件

在启动 Debian 安装介质时，您可以通过引导参数指定 `preseed` 文件的位置。假设您的 `preseed` 文件位于网络服务器上，您可以使用以下引导参数：

```plaintext
auto url=http://example.com/path/to/preseed.cfg
```

### 方法二：将 `preseed` 文件嵌入 ISO 文件

您还可以将 `preseed` 文件直接嵌入到 Debian 安装 ISO 文件中。这需要使用 `isohybrid` 工具和 `isolinux` 配置。以下是一个简单的步骤：

1. 下载 Debian ISO 文件。
2. 挂载 ISO 文件并提取内容：

   ```bash
   mkdir -p /mnt/iso
   mount -o loop debian.iso /mnt/iso
   cp -r /mnt/iso /path/to/custom_iso
   umount /mnt/iso
   ```

3. 将 `preseed` 文件复制到 `/path/to/custom_iso/preseed.cfg`。
4. 修改 `isolinux.cfg` 文件，添加引导参数：

   ```plaintext
   label auto
     menu label ^Automated Install
     kernel /install.amd/vmlinuz
     append auto=true file=/cdrom/preseed.cfg vga=788 initrd=/install.amd/initrd.gz ---
   ```

5. 重新生成 ISO 文件：

   ```bash
   mkisofs -o custom-debian.iso -r -J -V "Custom Debian" -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table /path/to/custom_iso
   ```

6. 使用新生成的 ISO 文件进行安装。

## 实际案例：批量部署虚拟机

假设您需要在 VMware 或 VirtualBox 上批量部署 Debian 虚拟机，您可以按照以下步骤操作：

1. 创建一个包含 `preseed` 文件的 ISO 文件，如上所述。
2. 在虚拟机管理软件中，使用该 ISO 文件作为启动介质。
3. 启动虚拟机并等待安装完成。

由于使用了 `preseed` 文件，安装过程将完全自动化，无需手动干预。

## 总结

Debian 自动安装是一种强大的工具，可以显著简化系统部署流程。通过使用 `preseed` 文件，您可以定义安装过程中的所有选项，从而实现无人值守安装。这种方法特别适用于需要批量部署系统的场景。

## 附加资源

- [Debian 官方文档 - 自动安装](https://www.debian.org/releases/stable/amd64/apb.html)
- [Debian Wiki - Preseed](https://wiki.debian.org/DebianInstaller/Preseed)

## 练习

1. 创建一个简单的 `preseed` 文件，用于安装 Debian 系统并配置一个用户。
2. 使用该 `preseed` 文件在虚拟机中进行自动安装，并验证安装结果是否符合预期。

通过以上步骤，您将能够掌握 Debian 自动安装的基本技能，并能够将其应用到实际场景中。