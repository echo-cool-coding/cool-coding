---
title: Ubuntu CPU 调度
description: 了解 Ubuntu 系统中的 CPU 调度机制，掌握如何优化 CPU 资源分配，提升系统性能。
---

# Ubuntu CPU 调度

## 介绍

在 Ubuntu 系统中，CPU 调度是操作系统管理 CPU 资源的核心机制之一。它决定了多个进程如何共享 CPU 时间，从而确保系统的高效运行。对于初学者来说，理解 CPU 调度的基本概念和工作原理是优化系统性能的重要一步。

本文将逐步介绍 Ubuntu 中的 CPU 调度机制，包括调度策略、优先级管理以及如何通过工具监控和调整 CPU 调度行为。

## 什么是 CPU 调度？

CPU 调度是操作系统内核的一部分，负责决定哪个进程在何时使用 CPU。由于 CPU 是计算机中最宝贵的资源之一，调度算法的设计直接影响系统的响应速度、吞吐量和公平性。

在 Ubuntu 中，CPU 调度器基于 Linux 内核的调度机制，支持多种调度策略，如 **完全公平调度（CFS）** 和 **实时调度（RT）**。

## CPU 调度策略

### 1. 完全公平调度（CFS）

CFS 是 Linux 内核默认的调度策略，旨在为所有进程提供公平的 CPU 时间分配。它通过虚拟运行时间（vruntime）来跟踪每个进程的 CPU 使用情况，确保每个进程都能获得公平的执行机会。

:::tip
CFS 适用于大多数桌面和服务器环境，因为它能够平衡系统的响应性和吞吐量。
:::

### 2. 实时调度（RT）

实时调度策略分为两种：
- **SCHED_FIFO**：先进先出调度，高优先级的进程会一直运行，直到它主动释放 CPU 或被更高优先级的进程抢占。
- **SCHED_RR**：轮转调度，与 SCHED_FIFO 类似，但每个进程会被分配一个时间片，时间片用完后会被放到队列末尾。

:::caution
实时调度策略适用于对响应时间要求极高的任务，如音视频处理或工业控制系统。但使用不当可能导致系统不稳定。
:::

## 查看和调整进程调度策略

在 Ubuntu 中，可以使用 `chrt` 命令查看和调整进程的调度策略和优先级。

### 示例：查看进程调度策略

```bash
chrt -p <PID>
```

输出示例：
```
pid 1234's current scheduling policy: SCHED_OTHER
pid 1234's current scheduling priority: 0
```

### 示例：设置进程为实时调度策略

```bash
chrt -f -p 99 <PID>
```

:::note
`-f` 表示使用 SCHED_FIFO 策略，`99` 是最高优先级（范围为 1-99）。
:::

## 监控 CPU 调度行为

使用 `top` 或 `htop` 工具可以实时监控系统的 CPU 使用情况和调度行为。

### 示例：使用 `htop` 监控

```bash
htop
```

在 `htop` 界面中，可以看到每个进程的 CPU 使用率、优先级和调度策略。

## 实际案例：优化视频编码任务

假设你正在运行一个视频编码任务，希望它能够尽快完成。你可以通过以下步骤优化 CPU 调度：

1. 使用 `ps` 命令找到视频编码任务的 PID：
   ```bash
   ps aux | grep ffmpeg
   ```

2. 将任务的调度策略设置为实时调度：
   ```bash
   chrt -f -p 99 <PID>
   ```

3. 使用 `htop` 监控任务的 CPU 使用情况，确保它获得了足够的 CPU 资源。

## 总结

CPU 调度是 Ubuntu 系统中优化性能的关键机制。通过理解不同的调度策略和工具，你可以更好地管理 CPU 资源，提升系统的响应速度和效率。

## 附加资源

- [Linux 内核调度器文档](https://www.kernel.org/doc/html/latest/scheduler/index.html)
- `man chrt`：查看 `chrt` 命令的详细用法
- `man htop`：学习如何使用 `htop` 监控系统性能

## 练习

1. 使用 `chrt` 命令将一个普通进程的调度策略改为 SCHED_FIFO，并观察其行为。
2. 在 `htop` 中查找实时调度的进程，并记录它们的优先级。
3. 尝试调整一个 CPU 密集型任务的优先级，观察其对系统性能的影响。

通过以上学习和实践，你将能够更好地理解和优化 Ubuntu 系统中的 CPU 调度机制。