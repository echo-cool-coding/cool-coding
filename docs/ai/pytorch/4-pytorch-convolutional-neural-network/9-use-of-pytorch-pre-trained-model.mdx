---
title: PyTorch 预训练模型使用
description: 学习如何在PyTorch中使用预训练模型，包括加载、修改和应用这些模型来解决实际问题。
---

# PyTorch 预训练模型使用

在深度学习中，预训练模型（Pre-trained Models）是已经在大规模数据集上训练好的模型。这些模型可以直接用于推理任务，或者通过微调（Fine-tuning）来适应特定的任务。PyTorch提供了丰富的预训练模型库，使得初学者能够快速上手并应用于实际问题。

## 什么是预训练模型？

预训练模型是指在大型数据集（如ImageNet）上训练好的神经网络模型。这些模型已经学习到了丰富的特征表示，可以直接用于图像分类、目标检测等任务。通过使用预训练模型，我们可以避免从头开始训练模型，从而节省时间和计算资源。

## 加载预训练模型

PyTorch的`torchvision.models`模块提供了许多经典的预训练模型，如ResNet、VGG、AlexNet等。我们可以通过简单的代码加载这些模型。

```python
import torchvision.models as models

# 加载预训练的ResNet-18模型
resnet18 = models.resnet18(pretrained=True)
```

在上面的代码中，`pretrained=True`表示加载预训练的权重。如果不指定`pretrained=True`，则只会加载模型结构，而不加载权重。

## 修改预训练模型

加载预训练模型后，我们通常需要根据具体任务对模型进行修改。例如，如果我们想将ResNet-18用于一个10分类任务，我们需要修改最后的全连接层。

```python
import torch.nn as nn

# 修改ResNet-18的最后一层
resnet18.fc = nn.Linear(resnet18.fc.in_features, 10)
```

在这个例子中，我们将ResNet-18的最后一层全连接层替换为一个新的全连接层，输出维度为10，以适应10分类任务。

## 微调预训练模型

微调是指在预训练模型的基础上，继续训练以适应特定任务。通常，我们会冻结模型的前几层，只训练最后几层。

```python
# 冻结除最后一层外的所有层
for param in resnet18.parameters():
    param.requires_grad = False

# 只训练最后一层
resnet18.fc.requires_grad = True
```

在这个例子中，我们冻结了ResNet-18的所有层，除了最后一层。这样，在训练过程中，只有最后一层的参数会被更新。

## 实际应用案例

假设我们有一个猫狗分类任务，我们可以使用预训练的ResNet-18模型，并通过微调来适应这个任务。

```python
import torch.optim as optim
import torch.nn.functional as F

# 定义损失函数和优化器
criterion = nn.CrossEntropyLoss()
optimizer = optim.SGD(resnet18.fc.parameters(), lr=0.001, momentum=0.9)

# 训练模型
for epoch in range(10):  # 假设我们训练10个epoch
    for inputs, labels in train_loader:  # train_loader是数据加载器
        optimizer.zero_grad()
        outputs = resnet18(inputs)
        loss = criterion(outputs, labels)
        loss.backward()
        optimizer.step()
```

在这个例子中，我们使用交叉熵损失函数和随机梯度下降（SGD）优化器来训练模型。我们只训练了最后一层，以适应猫狗分类任务。

## 总结

预训练模型是深度学习中非常有用的工具，尤其是在数据量有限的情况下。通过加载和微调预训练模型，我们可以快速构建高性能的模型，并应用于各种任务。

:::tip
在使用预训练模型时，务必注意模型的输入尺寸和预处理步骤。不同的预训练模型可能有不同的输入要求。
:::

## 附加资源

- [PyTorch官方文档](https://pytorch.org/docs/stable/torchvision/models.html)
- [深度学习中的迁移学习](https://cs231n.github.io/transfer-learning/)

## 练习

1. 尝试加载不同的预训练模型（如VGG、AlexNet），并修改最后一层以适应不同的分类任务。
2. 在微调过程中，尝试冻结不同的层，观察模型性能的变化。
3. 使用预训练模型进行图像分类任务，并记录模型的准确率。

通过以上步骤，你将能够熟练使用PyTorch中的预训练模型，并将其应用于实际问题中。