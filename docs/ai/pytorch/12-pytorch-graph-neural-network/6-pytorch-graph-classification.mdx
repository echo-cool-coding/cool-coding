---
title: PyTorch 图分类
description: 学习如何使用PyTorch进行图分类任务，掌握图神经网络的基本概念和实现方法。
---

# PyTorch 图分类

图分类是图神经网络（GNN）中的一个重要任务，它旨在为整个图结构分配一个类别标签。与节点分类不同，图分类的目标是对整个图进行分类，而不是对图中的单个节点进行分类。这在许多实际应用中非常有用，例如分子性质预测、社交网络分析等。

## 什么是图分类？

图分类是指为给定的图结构分配一个类别标签的任务。图结构由节点和边组成，节点表示实体，边表示实体之间的关系。图分类的目标是根据图的结构和节点特征，预测图的类别。

例如，在化学领域，分子可以被表示为图，其中原子是节点，化学键是边。图分类任务可以是预测分子是否具有某种生物活性。

## PyTorch 中的图分类

PyTorch是一个广泛使用的深度学习框架，它提供了丰富的工具和库来构建和训练神经网络。对于图分类任务，我们可以使用PyTorch Geometric（PyG）库，这是一个专门为图神经网络设计的库。

### 安装PyTorch Geometric

在开始之前，我们需要安装PyTorch Geometric。可以通过以下命令安装：

```bash
pip install torch-geometric
```

### 构建图分类模型

在PyTorch Geometric中，我们可以使用`torch_geometric.nn`模块来构建图神经网络模型。下面是一个简单的图分类模型的示例：

```python
import torch
import torch.nn.functional as F
from torch_geometric.nn import GCNConv, global_mean_pool

class GCN(torch.nn.Module):
    def __init__(self, num_node_features, num_classes):
        super(GCN, self).__init__()
        self.conv1 = GCNConv(num_node_features, 16)
        self.conv2 = GCNConv(16, 32)
        self.fc = torch.nn.Linear(32, num_classes)

    def forward(self, x, edge_index, batch):
        x = self.conv1(x, edge_index)
        x = F.relu(x)
        x = self.conv2(x, edge_index)
        x = F.relu(x)
        x = global_mean_pool(x, batch)  # 全局平均池化
        x = self.fc(x)
        return F.log_softmax(x, dim=1)
```

在这个模型中，我们使用了两个图卷积层（`GCNConv`）来提取图的特征，然后使用全局平均池化（`global_mean_pool`）将图的节点特征聚合为图的全局特征，最后通过一个全连接层（`fc`）进行分类。

### 训练图分类模型

接下来，我们需要定义损失函数和优化器，并编写训练循环。以下是一个简单的训练过程：

```python
from torch_geometric.data import DataLoader
from torch_geometric.datasets import TUDataset

# 加载数据集
dataset = TUDataset(root='data/TUDataset', name='MUTAG')
loader = DataLoader(dataset, batch_size=32, shuffle=True)

# 初始化模型、损失函数和优化器
model = GCN(num_node_features=dataset.num_node_features, num_classes=dataset.num_classes)
optimizer = torch.optim.Adam(model.parameters(), lr=0.01)
criterion = torch.nn.CrossEntropyLoss()

# 训练模型
def train():
    model.train()
    for data in loader:
        optimizer.zero_grad()
        out = model(data.x, data.edge_index, data.batch)
        loss = criterion(out, data.y)
        loss.backward()
        optimizer.step()

# 测试模型
def test():
    model.eval()
    correct = 0
    for data in loader:
        out = model(data.x, data.edge_index, data.batch)
        pred = out.argmax(dim=1)
        correct += int((pred == data.y).sum())
    return correct / len(loader.dataset)

# 训练和测试
for epoch in range(1, 201):
    train()
    test_acc = test()
    print(f'Epoch: {epoch:03d}, Test Acc: {test_acc:.4f}')
```

在这个示例中，我们使用了`TUDataset`中的`MUTAG`数据集，这是一个分子图分类数据集。我们通过`DataLoader`加载数据，并在每个epoch中训练模型，最后测试模型的准确率。

## 实际应用场景

图分类在许多领域都有广泛的应用，以下是一些实际应用场景：

- **分子性质预测**：在化学领域，分子可以被表示为图，图分类任务可以是预测分子是否具有某种生物活性。
- **社交网络分析**：在社交网络中，图分类可以用于识别社区或预测社交网络的类型。
- **推荐系统**：在推荐系统中，用户和物品可以被表示为图，图分类可以用于预测用户对物品的偏好。

## 总结

图分类是图神经网络中的一个重要任务，它旨在为整个图结构分配一个类别标签。通过使用PyTorch Geometric库，我们可以轻松地构建和训练图分类模型。本文介绍了图分类的基本概念，并提供了一个简单的图分类模型的实现示例。

## 附加资源

- [PyTorch Geometric官方文档](https://pytorch-geometric.readthedocs.io/)
- [图神经网络入门教程](https://distill.pub/2021/gnn-intro/)
- [图分类数据集](https://chrsmrrs.github.io/datasets/)

## 练习

1. 尝试使用不同的图卷积层（如`GATConv`或`GraphSAGE`）来改进模型性能。
2. 在`TUDataset`中选择其他数据集进行实验，并比较不同数据集的分类效果。
3. 探索其他图池化方法（如`global_max_pool`或`global_add_pool`）对模型性能的影响。
