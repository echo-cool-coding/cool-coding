---
title: PyTorch 节点分类
description: 学习如何使用PyTorch实现图神经网络中的节点分类任务。本文将从基础概念入手，逐步讲解节点分类的实现方法，并提供代码示例和实际应用场景。
---

# PyTorch 节点分类

节点分类是图神经网络（GNN）中的一项核心任务，旨在为图中的每个节点分配一个类别标签。例如，在社交网络中，我们可以通过节点分类来预测用户的兴趣或职业。本文将介绍如何使用PyTorch实现节点分类任务，适合初学者学习。

## 什么是节点分类？

在图结构中，节点分类是指为图中的每个节点分配一个类别标签。图由节点（顶点）和边（连接）组成，节点可以表示实体（如用户、商品等），边表示实体之间的关系。节点分类的目标是利用图的结构信息和节点特征，预测每个节点的类别。

### 示例场景
假设我们有一个社交网络图，其中节点代表用户，边代表用户之间的好友关系。每个用户都有一些特征（如年龄、性别、兴趣等），我们的任务是根据这些特征和图结构预测用户的职业类别。

## 图神经网络与节点分类

图神经网络（GNN）是一类专门用于处理图数据的深度学习模型。GNN通过聚合邻居节点的信息来更新每个节点的表示，从而捕捉图的结构信息。节点分类是GNN的典型应用之一。

### 基本步骤
1. **图数据表示**：将图数据表示为节点特征矩阵和邻接矩阵。
2. **信息传递**：通过GNN层聚合邻居节点的信息。
3. **分类**：使用全连接层对节点进行分类。

---

## 使用PyTorch实现节点分类

接下来，我们将使用PyTorch和PyTorch Geometric（一个用于图神经网络的库）来实现节点分类任务。

### 1. 安装依赖
首先，确保安装了PyTorch和PyTorch Geometric：
```bash
pip install torch torch-geometric
```

### 2. 准备图数据
我们使用Cora数据集，这是一个经典的图数据集，包含2708篇科学论文，节点表示论文，边表示引用关系。每篇论文有一个类别标签（共7类）。

```python
from torch_geometric.datasets import Planetoid

# 加载Cora数据集
dataset = Planetoid(root='data/Cora', name='Cora')
data = dataset[0]

print(f"Number of nodes: {data.num_nodes}")
print(f"Number of edges: {data.num_edges}")
print(f"Number of classes: {dataset.num_classes}")
print(f"Node feature dimension: {dataset.num_node_features}")
```

**输出**：
```
Number of nodes: 2708
Number of edges: 10556
Number of classes: 7
Node feature dimension: 1433
```

### 3. 定义图神经网络模型
我们使用一个简单的两层GCN（图卷积网络）模型：

```python
import torch
import torch.nn.functional as F
from torch_geometric.nn import GCNConv

class GCN(torch.nn.Module):
    def __init__(self, input_dim, hidden_dim, output_dim):
        super(GCN, self).__init__()
        self.conv1 = GCNConv(input_dim, hidden_dim)
        self.conv2 = GCNConv(hidden_dim, output_dim)

    def forward(self, x, edge_index):
        x = self.conv1(x, edge_index)
        x = F.relu(x)
        x = self.conv2(x, edge_index)
        return F.log_softmax(x, dim=1)
```

### 4. 训练模型
我们使用交叉熵损失函数和Adam优化器来训练模型：

```python
device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')
model = GCN(input_dim=dataset.num_node_features, hidden_dim=16, output_dim=dataset.num_classes).to(device)
data = data.to(device)
optimizer = torch.optim.Adam(model.parameters(), lr=0.01, weight_decay=5e-4)

def train():
    model.train()
    optimizer.zero_grad()
    out = model(data.x, data.edge_index)
    loss = F.nll_loss(out[data.train_mask], data.y[data.train_mask])
    loss.backward()
    optimizer.step()
    return loss.item()

def test():
    model.eval()
    out = model(data.x, data.edge_index)
    pred = out.argmax(dim=1)
    correct = pred[data.test_mask] == data.y[data.test_mask]
    accuracy = int(correct.sum()) / int(data.test_mask.sum())
    return accuracy

for epoch in range(200):
    loss = train()
    if epoch % 10 == 0:
        accuracy = test()
        print(f'Epoch: {epoch:03d}, Loss: {loss:.4f}, Accuracy: {accuracy:.4f}')
```

**输出**：
```
Epoch: 000, Loss: 1.9456, Accuracy: 0.2140
Epoch: 010, Loss: 1.2345, Accuracy: 0.7560
...
Epoch: 190, Loss: 0.0123, Accuracy: 0.8120
```

### 5. 结果分析
经过训练，模型在测试集上的准确率达到了81.2%。这表明我们的GCN模型能够有效地利用图结构和节点特征进行节点分类。

---

## 实际应用场景

节点分类在许多领域都有广泛应用，例如：
- **社交网络分析**：预测用户的兴趣或职业。
- **推荐系统**：根据用户行为预测商品类别。
- **生物信息学**：预测蛋白质的功能类别。

---

## 总结

本文介绍了如何使用PyTorch实现图神经网络中的节点分类任务。我们从基础概念入手，逐步讲解了图数据的表示、GNN模型的构建以及训练过程。通过Cora数据集的示例，我们展示了节点分类的实际应用。

:::tip 附加资源
- [PyTorch Geometric官方文档](https://pytorch-geometric.readthedocs.io/)
- [图神经网络入门教程](https://distill.pub/2021/gnn-intro/)
:::

:::note 练习
1. 尝试使用其他GNN模型（如GAT或GraphSAGE）进行节点分类。
2. 在Cora数据集上调整隐藏层维度，观察模型性能的变化。
3. 探索其他图数据集（如PubMed或Citeseer）并实现节点分类。
:::