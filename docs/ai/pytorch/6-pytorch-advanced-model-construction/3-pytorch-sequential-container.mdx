---
title: PyTorch Sequential 容器
description: 了解如何使用 PyTorch 的 Sequential 容器简化模型构建过程。本文将从基础概念讲起，逐步深入，并通过实际案例展示其应用场景。
---

# PyTorch Sequential 容器

在 PyTorch 中，构建神经网络模型通常需要定义多个层，并将它们按顺序组合在一起。为了简化这一过程，PyTorch 提供了 `torch.nn.Sequential` 容器。本文将详细介绍 `Sequential` 容器的使用方法，并通过代码示例和实际案例帮助你更好地理解其应用场景。

## 什么是 Sequential 容器？

`Sequential` 是 PyTorch 中的一个容器类，用于将多个神经网络层按顺序组合在一起。它允许你以简洁的方式定义模型，而无需手动编写前向传播函数。`Sequential` 容器特别适合用于构建简单的线性模型或层与层之间没有复杂交互的模型。

### 为什么使用 Sequential 容器？

- **简化代码**：`Sequential` 容器允许你在一行代码中定义整个模型，减少了代码量。
- **易于调试**：由于模型结构清晰，调试起来更加方便。
- **适合初学者**：对于初学者来说，`Sequential` 容器是理解神经网络模型构建的绝佳起点。

## 如何使用 Sequential 容器？

### 基本用法

首先，我们需要导入必要的库：

```python
import torch
import torch.nn as nn
```

接下来，我们可以使用 `Sequential` 容器来定义一个简单的全连接神经网络：

```python
model = nn.Sequential(
    nn.Linear(10, 50),  # 输入层到隐藏层
    nn.ReLU(),           # 激活函数
    nn.Linear(50, 1)     # 隐藏层到输出层
)
```

在这个例子中，我们定义了一个包含两个线性层和一个 ReLU 激活函数的简单神经网络。`Sequential` 容器会自动将这些层按顺序组合在一起。

### 前向传播

使用 `Sequential` 容器定义的模型，前向传播非常简单。你只需要将输入数据传递给模型即可：

```python
input_data = torch.randn(1, 10)  # 生成一个大小为 (1, 10) 的随机输入
output = model(input_data)
print(output)
```

输出将是一个大小为 `(1, 1)` 的张量，表示模型的预测结果。

### 添加更多层

你可以轻松地在 `Sequential` 容器中添加更多层。例如，我们可以添加一个 Dropout 层来防止过拟合：

```python
model = nn.Sequential(
    nn.Linear(10, 50),
    nn.ReLU(),
    nn.Dropout(0.5),  # Dropout 层
    nn.Linear(50, 1)
)
```

### 使用 OrderedDict

如果你希望为每一层命名，可以使用 `OrderedDict`：

```python
from collections import OrderedDict

model = nn.Sequential(OrderedDict([
    ('fc1', nn.Linear(10, 50)),
    ('relu', nn.ReLU()),
    ('fc2', nn.Linear(50, 1))
]))
```

这样，你可以通过名称访问每一层：

```python
print(model.fc1)
```

## 实际案例：构建一个简单的分类模型

让我们通过一个实际案例来展示 `Sequential` 容器的应用。假设我们要构建一个简单的分类模型，用于区分两类数据。

### 数据集

我们使用 `torchvision.datasets` 中的 MNIST 数据集：

```python
import torchvision.datasets as datasets
import torchvision.transforms as transforms

transform = transforms.Compose([transforms.ToTensor()])
train_dataset = datasets.MNIST(root='./data', train=True, download=True, transform=transform)
```

### 定义模型

我们定义一个包含两个隐藏层的全连接神经网络：

```python
model = nn.Sequential(
    nn.Linear(28*28, 128),
    nn.ReLU(),
    nn.Linear(128, 64),
    nn.ReLU(),
    nn.Linear(64, 10)
)
```

### 训练模型

接下来，我们定义损失函数和优化器，并开始训练模型：

```python
criterion = nn.CrossEntropyLoss()
optimizer = torch.optim.Adam(model.parameters(), lr=0.001)

for epoch in range(5):  # 训练 5 个 epoch
    for images, labels in train_dataset:
        images = images.view(-1, 28*28)
        outputs = model(images)
        loss = criterion(outputs, labels)
        
        optimizer.zero_grad()
        loss.backward()
        optimizer.step()
```

### 测试模型

训练完成后，我们可以测试模型的性能：

```python
test_dataset = datasets.MNIST(root='./data', train=False, download=True, transform=transform)
correct = 0
total = 0

with torch.no_grad():
    for images, labels in test_dataset:
        images = images.view(-1, 28*28)
        outputs = model(images)
        _, predicted = torch.max(outputs.data, 1)
        total += labels.size(0)
        correct += (predicted == labels).sum().item()

print(f'Accuracy: {100 * correct / total}%')
```

## 总结

`Sequential` 容器是 PyTorch 中一个非常实用的工具，特别适合用于构建简单的神经网络模型。通过本文的学习，你应该已经掌握了如何使用 `Sequential` 容器来定义模型、添加层以及进行前向传播。我们还通过一个实际案例展示了如何构建和训练一个简单的分类模型。

### 附加资源

- [PyTorch 官方文档 - Sequential](https://pytorch.org/docs/stable/generated/torch.nn.Sequential.html)
- [PyTorch 官方教程 - 神经网络](https://pytorch.org/tutorials/beginner/blitz/neural_networks_tutorial.html)

### 练习

1. 尝试使用 `Sequential` 容器构建一个包含三个隐藏层的神经网络，并在 MNIST 数据集上进行训练。
2. 修改模型中的激活函数，观察对模型性能的影响。
3. 使用 `OrderedDict` 为每一层命名，并通过名称访问特定层。

希望本文对你理解和使用 PyTorch 的 `Sequential` 容器有所帮助！继续探索 PyTorch 的世界，你会发现更多强大的工具和技巧。