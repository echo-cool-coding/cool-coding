---
title: Nacos安装与配置
description: 本文详细介绍了如何在本地环境中安装和配置Nacos，并提供了实际案例和代码示例，帮助初学者快速上手Nacos服务注册与发现。
---

# Nacos安装与配置

Nacos（Naming and Configuration Service）是一个动态服务发现、配置管理和服务管理平台。它可以帮助开发者轻松实现微服务架构中的服务注册与发现、配置管理等功能。本文将详细介绍如何在本地环境中安装和配置Nacos，并通过实际案例展示其应用场景。

## 1. 什么是Nacos？

Nacos是阿里巴巴开源的一个服务注册与发现、配置管理的平台。它支持多种服务发现方式（如DNS、HTTP等），并提供了强大的配置管理功能。Nacos的核心功能包括：

- **服务注册与发现**：服务提供者可以将自己的服务注册到Nacos，服务消费者可以从Nacos中获取服务列表。
- **配置管理**：Nacos可以集中管理应用的配置信息，并支持动态更新。
- **服务健康检查**：Nacos可以定期检查服务的健康状态，并自动剔除不健康的服务。

## 2. 安装Nacos

### 2.1 下载Nacos

首先，我们需要从Nacos的官方GitHub仓库下载最新的稳定版本。你可以通过以下命令下载：

```bash
wget https://github.com/alibaba/nacos/releases/download/2.0.3/nacos-server-2.0.3.tar.gz
```

### 2.2 解压Nacos

下载完成后，解压Nacos到指定目录：

```bash
tar -zxvf nacos-server-2.0.3.tar.gz -C /opt/nacos
```

### 2.3 启动Nacos

进入Nacos的安装目录，并启动Nacos服务器：

```bash
cd /opt/nacos/bin
sh startup.sh -m standalone
```

:::tip
`-m standalone` 参数表示以单机模式启动Nacos。如果你需要以集群模式启动，可以省略此参数。
:::

### 2.4 访问Nacos控制台

启动成功后，打开浏览器并访问 `http://localhost:8848/nacos`，你将看到Nacos的控制台界面。默认的用户名和密码都是 `nacos`。

## 3. 配置Nacos

### 3.1 配置数据源

Nacos默认使用嵌入式数据库Derby来存储数据。如果你希望使用MySQL作为数据源，可以按照以下步骤进行配置：

1. 在MySQL中创建一个名为 `nacos` 的数据库。
2. 执行Nacos提供的SQL脚本初始化数据库表结构：

```bash
mysql -u root -p nacos < /opt/nacos/conf/nacos-mysql.sql
```

3. 修改Nacos的配置文件 `application.properties`，配置MySQL连接信息：

```properties
spring.datasource.platform=mysql
db.num=1
db.url.0=jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true
db.user=root
db.password=your_password
```

### 3.2 配置集群模式

如果你需要以集群模式运行Nacos，可以按照以下步骤进行配置：

1. 修改 `cluster.conf` 文件，配置集群节点的IP地址和端口：

```plaintext
192.168.1.101:8848
192.168.1.102:8848
192.168.1.103:8848
```

2. 启动每个节点上的Nacos服务：

```bash
sh startup.sh
```

## 4. 实际案例：服务注册与发现

### 4.1 服务提供者

假设我们有一个简单的Spring Boot应用作为服务提供者。首先，我们需要在 `pom.xml` 中添加Nacos的依赖：

```xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
</dependency>
```

然后，在 `application.yml` 中配置Nacos的注册中心地址：

```yaml
spring:
  application:
    name: service-provider
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
```

最后，启动服务提供者应用，它将自动注册到Nacos中。

### 4.2 服务消费者

接下来，我们创建一个服务消费者应用。同样地，添加Nacos的依赖并配置注册中心地址：

```yaml
spring:
  application:
    name: service-consumer
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
```

在服务消费者中，我们可以通过 `RestTemplate` 或 `Feign` 调用服务提供者的接口：

```java
@RestController
public class ConsumerController {

    @Autowired
    private RestTemplate restTemplate;

    @GetMapping("/call-provider")
    public String callProvider() {
        return restTemplate.getForObject("http://service-provider/hello", String.class);
    }
}
```

## 5. 总结

通过本文的学习，你应该已经掌握了如何在本地环境中安装和配置Nacos，并通过实际案例了解了Nacos在服务注册与发现中的应用。Nacos作为一个强大的服务管理平台，可以帮助开发者轻松构建微服务架构。

## 6. 附加资源与练习

- **官方文档**：访问 [Nacos官方文档](https://nacos.io/zh-cn/docs/what-is-nacos.html) 获取更多详细信息。
- **练习**：尝试在Nacos中配置一个简单的Spring Cloud应用，并实现服务注册与发现功能。

:::caution
在配置Nacos时，请确保你的网络环境允许访问Nacos的默认端口（8848）。如果遇到问题，可以检查防火墙设置或使用代理。
:::