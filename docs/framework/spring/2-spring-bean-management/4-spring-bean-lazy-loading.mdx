---
title: Spring Bean 懒加载
description: 了解 Spring 框架中的 Bean 懒加载机制，掌握如何延迟初始化 Bean 以提高应用性能。
---

# Spring Bean 懒加载

在 Spring 框架中，Bean 的默认行为是在应用启动时立即初始化。然而，在某些情况下，我们可能希望延迟 Bean 的初始化，直到它第一次被使用时才进行。这种机制被称为 **懒加载（Lazy Loading）**。本文将详细介绍 Spring Bean 懒加载的概念、实现方式以及实际应用场景。

## 什么是懒加载？

懒加载是一种延迟初始化的策略，它允许 Bean 在第一次被请求时才进行初始化，而不是在应用启动时立即初始化。这种方式可以显著减少应用启动时间，尤其是在 Bean 数量较多或初始化成本较高的情况下。

### 默认行为 vs 懒加载

- **默认行为**：Spring 容器在启动时会初始化所有单例 Bean。
- **懒加载**：Bean 只有在第一次被使用时才会初始化。

## 如何实现懒加载？

在 Spring 中，可以通过以下几种方式实现 Bean 的懒加载：

### 1. 使用 `@Lazy` 注解

`@Lazy` 注解可以应用于类级别或方法级别，用于标记 Bean 为懒加载。

```java
import org.springframework.context.annotation.Lazy;
import org.springframework.stereotype.Component;

@Component
@Lazy
public class MyLazyBean {
    public MyLazyBean() {
        System.out.println("MyLazyBean initialized!");
    }
}
```

在上述代码中，`MyLazyBean` 只有在第一次被注入或使用时才会初始化。

### 2. 在 XML 配置中使用 `lazy-init` 属性

如果你使用 XML 配置文件来定义 Bean，可以通过 `lazy-init` 属性来实现懒加载。

```xml
<bean id="myLazyBean" class="com.example.MyLazyBean" lazy-init="true" />
```

### 3. 全局配置懒加载

你还可以在 Spring 配置类中全局启用懒加载。

```java
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Lazy;

@Configuration
@Lazy
public class AppConfig {
    // Bean definitions
}
```

## 实际应用场景

### 场景 1：减少启动时间

假设你的应用中有多个 Bean，其中一些 Bean 的初始化成本较高（例如，需要连接数据库或加载大量数据）。通过将这些 Bean 标记为懒加载，可以显著减少应用的启动时间。

### 场景 2：按需加载资源

在某些情况下，某些 Bean 可能只在特定条件下才会被使用。例如，一个处理特定类型请求的 Bean 可能只在接收到该类型请求时才需要初始化。通过懒加载，可以避免不必要的资源消耗。

## 代码示例

以下是一个简单的 Spring Boot 示例，展示了如何使用 `@Lazy` 注解实现懒加载。

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Lazy;
import org.springframework.stereotype.Component;

@SpringBootApplication
public class LazyLoadingExampleApplication {

    public static void main(String[] args) {
        SpringApplication.run(LazyLoadingExampleApplication.class, args);
    }

    @Component
    @Lazy
    static class MyLazyBean {
        MyLazyBean() {
            System.out.println("MyLazyBean initialized!");
        }
    }

    @Component
    static class MyRunner implements CommandLineRunner {

        @Autowired
        private MyLazyBean myLazyBean;

        @Override
        public void run(String... args) throws Exception {
            System.out.println("Application started!");
            // 第一次使用 MyLazyBean
            System.out.println(myLazyBean);
        }
    }
}
```

**输出：**

```
Application started!
MyLazyBean initialized!
com.example.LazyLoadingExampleApplication$MyLazyBean@12345678
```

从输出中可以看到，`MyLazyBean` 只有在 `run` 方法中第一次被使用时才会初始化。

## 总结

懒加载是 Spring 框架中一种非常有用的机制，它可以帮助我们优化应用的启动时间和资源使用。通过 `@Lazy` 注解或 XML 配置，我们可以轻松地实现 Bean 的懒加载。在实际应用中，懒加载特别适用于那些初始化成本较高或只在特定条件下才会被使用的 Bean。

## 附加资源

- [Spring Framework Documentation](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lazy-init)
- [Spring Boot Reference Guide](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/)

## 练习

1. 尝试在一个 Spring Boot 项目中创建一个懒加载的 Bean，并观察它的初始化时机。
2. 修改项目中的某个 Bean，使其在启动时立即初始化，然后将其改为懒加载，比较两者的启动时间差异。
3. 研究 Spring 中的 `@DependsOn` 注解，并尝试将其与 `@Lazy` 结合使用，观察 Bean 的初始化顺序。

通过以上练习，你将更深入地理解 Spring Bean 懒加载的机制及其在实际项目中的应用。