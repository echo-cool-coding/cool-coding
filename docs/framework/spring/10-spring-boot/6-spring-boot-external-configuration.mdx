---
title: Spring Boot 外部配置
description: 了解如何在 Spring Boot 中使用外部配置来管理应用程序的属性和环境设置。本文适合初学者，包含代码示例和实际应用场景。
---

# Spring Boot 外部配置

Spring Boot 提供了一种灵活的方式来管理应用程序的配置。通过外部配置，您可以在不修改代码的情况下调整应用程序的行为。本文将详细介绍 Spring Boot 的外部配置机制，并通过示例展示如何在实际项目中使用它。

## 什么是外部配置？

外部配置是指将应用程序的配置信息（如数据库连接、服务器端口等）从代码中分离出来，存储在外部文件或环境中。Spring Boot 支持多种外部配置源，包括：

- 配置文件（如 `application.properties` 或 `application.yml`）
- 环境变量
- 命令行参数
- 系统属性

通过外部配置，您可以在不同的环境（如开发、测试、生产）中使用不同的配置，而无需修改代码。

## 配置文件

Spring Boot 默认会加载 `application.properties` 或 `application.yml` 文件中的配置。这些文件通常位于 `src/main/resources` 目录下。

### 示例：使用 `application.properties`

假设我们有一个简单的 Spring Boot 应用程序，需要配置服务器端口和数据库连接信息。我们可以在 `application.properties` 文件中添加以下内容：

```properties
server.port=8081
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=root
spring.datasource.password=secret
```

### 示例：使用 `application.yml`

YAML 是一种更易读的配置文件格式。以下是与上述 `application.properties` 等效的 `application.yml` 配置：

```yaml
server:
  port: 8081
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mydb
    username: root
    password: secret
```

:::tip
YAML 文件使用缩进来表示层级关系，因此请确保缩进正确，否则可能会导致配置解析错误。
:::

## 环境变量

Spring Boot 还支持通过环境变量来覆盖配置文件中的属性。环境变量的命名规则是将属性名中的点（`.`）替换为下划线（`_`），并将所有字母转换为大写。

例如，要覆盖 `server.port` 属性，可以设置以下环境变量：

```bash
export SERVER_PORT=8082
```

## 命令行参数

您还可以通过命令行参数来传递配置。Spring Boot 会自动解析命令行参数并将其应用于应用程序配置。

例如，以下命令将服务器端口设置为 `8083`：

```bash
java -jar myapp.jar --server.port=8083
```

## 实际应用场景

### 场景 1：多环境配置

在实际开发中，通常需要为不同的环境（如开发、测试、生产）使用不同的配置。Spring Boot 支持通过配置文件命名约定来实现这一点。

例如，您可以创建以下配置文件：

- `application-dev.properties`：开发环境配置
- `application-test.properties`：测试环境配置
- `application-prod.properties`：生产环境配置

然后，通过设置 `spring.profiles.active` 属性来激活特定的配置文件：

```bash
java -jar myapp.jar --spring.profiles.active=prod
```

### 场景 2：动态配置

在某些情况下，您可能需要在运行时动态更改配置。Spring Boot 提供了 `@ConfigurationProperties` 注解，可以将配置文件中的属性绑定到 Java 对象中。

例如，假设我们有以下配置：

```yaml
app:
  name: MyApp
  version: 1.0.0
```

我们可以创建一个 Java 类来绑定这些属性：

```java
@ConfigurationProperties(prefix = "app")
public class AppConfig {
    private String name;
    private String version;

    // Getters and setters
}
```

然后，在 Spring Boot 应用程序中注入 `AppConfig` 对象：

```java
@SpringBootApplication
@EnableConfigurationProperties(AppConfig.class)
public class MyApp {
    public static void main(String[] args) {
        SpringApplication.run(MyApp.class, args);
    }
}
```

## 总结

Spring Boot 的外部配置机制为应用程序的配置管理提供了极大的灵活性。通过配置文件、环境变量和命令行参数，您可以轻松地在不同环境中调整应用程序的行为。此外，Spring Boot 还支持多环境配置和动态配置绑定，使得配置管理更加高效和便捷。

## 附加资源

- [Spring Boot 官方文档 - 外部配置](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config)
- [Spring Boot 配置文件详解](https://www.baeldung.com/spring-boot-configuration-properties)
- [Spring Boot 多环境配置](https://www.baeldung.com/spring-profiles)

## 练习

1. 创建一个 Spring Boot 应用程序，并使用 `application.yml` 文件配置服务器端口和数据库连接信息。
2. 尝试通过环境变量覆盖配置文件中的 `server.port` 属性。
3. 创建一个多环境配置，分别为开发、测试和生产环境设置不同的数据库连接信息。
