---
title: Spring 属性源
description: 了解Spring框架中的属性源（PropertySource）概念，学习如何管理和使用外部化配置。
---

## 介绍

在Spring框架中，**属性源（PropertySource）** 是一个用于管理外部化配置的核心概念。它允许开发者将配置信息从代码中分离出来，存储在不同的来源中，例如环境变量、配置文件、命令行参数等。通过属性源，Spring应用可以更灵活地适应不同的运行环境，而无需修改代码。

属性源的核心思想是将配置信息抽象为一个键值对的集合，Spring容器在启动时会加载这些属性，并在需要时注入到应用程序中。这种方式不仅提高了代码的可维护性，还使得应用程序更容易在不同环境中部署。

## 属性源的基本概念

### 什么是属性源？

属性源是Spring框架中用于表示配置数据的抽象。它可以是任何包含键值对的数据源，例如：

- 环境变量
- 属性文件（如 `application.properties` 或 `application.yml`）
- 命令行参数
- JVM系统属性

Spring通过 `PropertySource` 接口来表示这些数据源，并提供了多种内置的实现类来支持不同的配置来源。

### 属性源的优先级

当多个属性源中存在相同的键时，Spring会根据属性源的优先级来决定使用哪个值。默认情况下，Spring属性源的优先级顺序如下：

1. 命令行参数
2. JVM系统属性
3. 操作系统环境变量
4. 属性文件（如 `application.properties`）

:::tip
可以通过自定义属性源或调整属性源的顺序来覆盖默认行为。
:::

## 使用属性源

### 1. 加载属性文件

Spring Boot默认会加载 `application.properties` 或 `application.yml` 文件中的配置。例如，以下是一个简单的 `application.properties` 文件：

```properties
app.name=My Spring Application
app.version=1.0.0
```

在Spring中，可以通过 `@Value` 注解将这些属性注入到Bean中：

```java
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

@Component
public class AppConfig {

    @Value("${app.name}")
    private String appName;

    @Value("${app.version}")
    private String appVersion;

    public void printConfig() {
        System.out.println("App Name: " + appName);
        System.out.println("App Version: " + appVersion);
    }
}
```

### 2. 使用环境变量

Spring会自动将操作系统环境变量加载为属性源。例如，假设有一个环境变量 `DATABASE_URL`，可以通过以下方式访问：

```java
@Value("${DATABASE_URL}")
private String databaseUrl;
```

### 3. 自定义属性源

如果需要从自定义的数据源加载配置，可以实现 `PropertySource` 接口，并将其注册到Spring环境中。以下是一个简单的自定义属性源示例：

```java
import org.springframework.core.env.PropertySource;

public class CustomPropertySource extends PropertySource<String> {

    public CustomPropertySource(String name) {
        super(name);
    }

    @Override
    public Object getProperty(String name) {
        if ("custom.property".equals(name)) {
            return "Custom Value";
        }
        return null;
    }
}
```

然后，在Spring配置中注册该属性源：

```java
import org.springframework.context.annotation.Configuration;
import org.springframework.core.env.ConfigurableEnvironment;
import org.springframework.core.env.MutablePropertySources;

@Configuration
public class AppConfig {

    public AppConfig(ConfigurableEnvironment env) {
        MutablePropertySources propertySources = env.getPropertySources();
        propertySources.addFirst(new CustomPropertySource("customPropertySource"));
    }
}
```

## 实际应用场景

### 场景1：多环境配置

在实际开发中，通常需要为不同的环境（如开发、测试、生产）提供不同的配置。通过属性源，可以轻松实现这一点。例如，可以在 `application-dev.properties` 和 `application-prod.properties` 中分别定义开发和生产环境的配置，然后通过激活不同的Profile来加载对应的配置。

```properties
# application-dev.properties
app.name=Development App
app.version=1.0.0-DEV

# application-prod.properties
app.name=Production App
app.version=1.0.0-PROD
```

在启动应用时，可以通过命令行参数指定激活的Profile：

```bash
java -jar myapp.jar --spring.profiles.active=prod
```

### 场景2：动态配置更新

在某些场景下，可能需要在不重启应用的情况下更新配置。Spring Cloud Config 和 Spring Cloud Bus 提供了动态刷新配置的功能。通过结合属性源，可以实现配置的动态加载和更新。

## 总结

Spring属性源是管理外部化配置的强大工具，它使得应用程序的配置更加灵活和可维护。通过属性源，开发者可以轻松地从不同的数据源加载配置，并根据需要调整优先级。无论是多环境配置还是动态配置更新，属性源都能提供有效的支持。

## 附加资源与练习

- **官方文档**：阅读 [Spring官方文档](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-properties-detailed) 中关于属性源的详细说明。
- **练习**：尝试创建一个Spring Boot项目，并使用属性源加载不同的配置文件。然后，通过命令行参数激活不同的Profile，观察配置的变化。
- **扩展学习**：了解Spring Cloud Config，探索如何实现分布式配置管理。
