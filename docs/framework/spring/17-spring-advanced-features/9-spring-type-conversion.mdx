---
title: Spring 类型转换
description: 了解Spring框架中的类型转换机制，掌握如何通过Spring的类型转换功能实现数据类型的自动转换。
---

# Spring 类型转换

在Spring框架中，类型转换是一个非常重要的特性，它允许我们在不同的数据类型之间进行自动转换。无论是从字符串到数字，还是从自定义对象到其他类型，Spring的类型转换机制都能帮助我们简化开发过程。

## 什么是类型转换？

类型转换是指将一种数据类型转换为另一种数据类型的过程。在Spring中，类型转换通常用于将HTTP请求中的字符串参数转换为Java对象，或者将配置文件中的字符串值转换为特定的数据类型。

## Spring 类型转换的核心接口

Spring的类型转换机制主要依赖于以下几个核心接口：

- `Converter<S, T>`：将类型`S`转换为类型`T`。
- `ConverterFactory<S, R>`：将类型`S`转换为类型`R`的子类型。
- `GenericConverter`：支持多种源类型和目标类型的转换。

### 示例：自定义类型转换器

假设我们有一个`User`类，其中包含一个`id`字段和一个`name`字段。我们希望将字符串格式的`id`和`name`转换为`User`对象。

```java
public class User {
    private Long id;
    private String name;

    // 省略构造函数、getter和setter
}
```

我们可以通过实现`Converter<String, User>`接口来创建一个自定义的类型转换器：

```java
import org.springframework.core.convert.converter.Converter;

public class StringToUserConverter implements Converter<String, User> {
    @Override
    public User convert(String source) {
        String[] parts = source.split(",");
        Long id = Long.parseLong(parts[0]);
        String name = parts[1];
        return new User(id, name);
    }
}
```

### 注册自定义转换器

要将自定义转换器注册到Spring中，我们需要在配置类中使用`ConversionService`：

```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.convert.ConversionService;
import org.springframework.core.convert.support.DefaultConversionService;

@Configuration
public class AppConfig {
    @Bean
    public ConversionService conversionService() {
        DefaultConversionService service = new DefaultConversionService();
        service.addConverter(new StringToUserConverter());
        return service;
    }
}
```

### 使用类型转换器

在Spring MVC中，我们可以通过`@RequestParam`注解将HTTP请求参数自动转换为`User`对象：

```java
@RestController
public class UserController {
    @GetMapping("/user")
    public String getUser(@RequestParam("user") User user) {
        return "User ID: " + user.getId() + ", Name: " + user.getName();
    }
}
```

假设我们发送一个HTTP请求：`/user?user=1,John`，Spring会自动将`1,John`转换为`User`对象，并调用`getUser`方法。

## 实际应用场景

### 场景1：配置文件中的类型转换

在Spring Boot中，我们可以使用`@ConfigurationProperties`注解将配置文件中的属性绑定到Java对象中。Spring会自动将配置文件中的字符串值转换为相应的数据类型。

```java
@ConfigurationProperties(prefix = "app")
public class AppProperties {
    private int port;
    private String name;

    // 省略getter和setter
}
```

在`application.properties`中：

```properties
app.port=8080
app.name=MyApp
```

Spring会自动将`app.port`转换为`int`类型，并将`app.name`转换为`String`类型。

### 场景2：表单数据绑定

在Spring MVC中，表单数据通常以字符串形式提交。Spring的类型转换机制可以将这些字符串自动转换为Java对象。

```java
public class RegistrationForm {
    private String username;
    private String email;
    private int age;

    // 省略getter和setter
}
```

在控制器中：

```java
@PostMapping("/register")
public String register(@ModelAttribute RegistrationForm form) {
    // 处理表单数据
    return "success";
}
```

Spring会自动将表单中的`username`、`email`和`age`字段绑定到`RegistrationForm`对象中。

## 总结

Spring的类型转换机制为我们提供了一种灵活且强大的方式来处理不同数据类型之间的转换。通过自定义转换器，我们可以轻松地将字符串转换为复杂的Java对象，或者将配置文件中的属性绑定到Java对象中。

## 附加资源

- [Spring官方文档 - 类型转换](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#core-convert)
- [Spring Boot配置属性绑定](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config.typesafe-configuration-properties)

## 练习

1. 创建一个自定义的类型转换器，将字符串格式的日期（如`2023-10-01`）转换为`LocalDate`对象。
2. 在Spring Boot应用中，使用`@ConfigurationProperties`将配置文件中的属性绑定到一个自定义的Java对象中。
