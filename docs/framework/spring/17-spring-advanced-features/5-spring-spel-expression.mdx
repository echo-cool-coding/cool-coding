---
title: Spring SpEL 表达式
description: 了解 Spring 表达式语言（SpEL）的基本概念、语法和实际应用场景，帮助初学者掌握如何在 Spring 框架中使用 SpEL 进行动态表达式求值。
---

## 介绍

Spring 表达式语言（Spring Expression Language，简称 SpEL）是 Spring 框架提供的一种强大的表达式语言。它允许开发者在运行时动态地计算表达式，并将其应用于 Spring 应用程序的各个部分。SpEL 可以用于配置文件中、注解中，甚至是代码中，以实现灵活的配置和动态行为。

SpEL 的语法类似于 Java 表达式，但它提供了更多的功能，例如访问对象的属性、调用方法、进行数学运算、逻辑运算等。通过 SpEL，开发者可以在不修改代码的情况下，动态地调整应用程序的行为。

## SpEL 的基本语法

SpEL 表达式通常以 `#{...}` 的形式出现。在 Spring 配置文件中，你可以使用 SpEL 表达式来引用 bean 的属性、调用方法或执行其他操作。

### 示例 1：简单的数学运算

```java
ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression("10 + 20");
int result = (Integer) exp.getValue();
System.out.println(result); // 输出: 30
```

在这个示例中，我们使用 `SpelExpressionParser` 来解析一个简单的数学表达式 `10 + 20`，并计算其结果。

### 示例 2：访问对象的属性

假设我们有一个 `Person` 类：

```java
public class Person {
    private String name;
    private int age;

    // 构造函数、getter 和 setter 省略
}
```

我们可以使用 SpEL 来访问 `Person` 对象的属性：

```java
Person person = new Person("Alice", 25);
ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression("name");
String name = (String) exp.getValue(person);
System.out.println(name); // 输出: Alice
```

在这个示例中，我们使用 SpEL 表达式 `name` 来获取 `Person` 对象的 `name` 属性。

## SpEL 的高级特性

### 1. 方法调用

SpEL 允许你在表达式中调用对象的方法。例如：

```java
Expression exp = parser.parseExpression("name.toUpperCase()");
String result = (String) exp.getValue(person);
System.out.println(result); // 输出: ALICE
```

在这个示例中，我们调用了 `name` 属性的 `toUpperCase()` 方法，将名字转换为大写。

### 2. 集合操作

SpEL 还支持对集合进行操作。例如，你可以使用 SpEL 来过滤集合中的元素：

```java
List<Person> people = Arrays.asList(
    new Person("Alice", 25),
    new Person("Bob", 30),
    new Person("Charlie", 20)
);

Expression exp = parser.parseExpression("?[age > 25]");
List<Person> filteredPeople = (List<Person>) exp.getValue(people);
filteredPeople.forEach(p -> System.out.println(p.getName())); // 输出: Bob
```

在这个示例中，我们使用 SpEL 表达式 `?[age > 25]` 来过滤出年龄大于 25 岁的人。

### 3. 条件表达式

SpEL 支持条件表达式，类似于 Java 中的三元运算符。例如：

```java
Expression exp = parser.parseExpression("age > 25 ? 'Old' : 'Young'");
String result = (String) exp.getValue(person);
System.out.println(result); // 输出: Young
```

在这个示例中，我们根据 `age` 属性的值来决定返回 `'Old'` 还是 `'Young'`。

## 实际应用场景

### 1. 动态配置

在 Spring 配置文件中，你可以使用 SpEL 来动态地配置 bean 的属性。例如：

```xml
<bean id="person" class="com.example.Person">
    <property name="name" value="#{systemProperties['user.name']}" />
    <property name="age" value="#{T(java.lang.Math).random() * 100}" />
</bean>
```

在这个示例中，`name` 属性被设置为当前系统用户的名称，而 `age` 属性被设置为一个随机数。

### 2. 注解中的 SpEL

SpEL 也可以用于注解中。例如，在 Spring Security 中，你可以使用 SpEL 来定义访问控制规则：

```java
@PreAuthorize("hasRole('ADMIN') and #user.name == authentication.name")
public void updateUser(User user) {
    // 更新用户信息
}
```

在这个示例中，`@PreAuthorize` 注解中的 SpEL 表达式确保了只有管理员才能更新自己的用户信息。

## 总结

Spring 表达式语言（SpEL）是 Spring 框架中一个非常强大的工具，它允许开发者在运行时动态地计算表达式，并将其应用于各种场景中。通过 SpEL，你可以实现灵活的配置、动态的行为控制以及复杂的条件判断。

在本教程中，我们介绍了 SpEL 的基本语法、高级特性以及实际应用场景。希望这些内容能帮助你更好地理解和使用 SpEL。

## 附加资源

- [Spring 官方文档 - SpEL](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions)
- [Spring SpEL 教程](https://www.baeldung.com/spring-expression-language)

## 练习

1. 编写一个 SpEL 表达式，计算 `(10 + 20) * 2` 的结果。
2. 创建一个 `Person` 对象，并使用 SpEL 表达式获取其 `age` 属性。
3. 使用 SpEL 表达式过滤出一个包含多个 `Person` 对象的列表，只保留年龄大于 30 岁的人。

通过完成这些练习，你将更深入地理解 SpEL 的使用方法。