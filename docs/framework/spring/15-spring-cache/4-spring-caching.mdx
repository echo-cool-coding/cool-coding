---
title: Spring @Caching
description: "了解如何使用 Spring 的 @Caching 注解来简化缓存管理，提升应用性能。本文将从基础概念讲起，逐步深入，并提供实际案例和代码示例。"
---

## 介绍

在开发高性能应用时，缓存是提升性能的关键技术之一。Spring 框架提供了强大的缓存支持，通过 `@Caching` 注解，开发者可以更灵活地管理缓存操作。`@Caching` 是 Spring 缓存抽象的一部分，它允许你将多个缓存操作组合在一起，从而简化代码并提高可读性。

本文将带你逐步了解 `@Caching` 的使用方法，并通过实际案例展示其应用场景。

## 什么是 `@Caching`？

`@Caching` 是 Spring 框架中的一个组合注解，用于将多个缓存相关的注解（如 `@Cacheable`、`@CachePut` 和 `@CacheEvict`）组合在一起。通过 `@Caching`，你可以在一个方法上同时执行多个缓存操作，而不需要为每个操作单独编写方法。

### 基本语法

```java
@Caching(
    cacheable = {
        @Cacheable(value = "books", key = "#isbn")
    },
    put = {
        @CachePut(value = "books", key = "#result.id")
    },
    evict = {
        @CacheEvict(value = "books", key = "#isbn")
    }
)
public Book findBookByIsbn(String isbn) {
    // 业务逻辑
}
```

在上面的示例中，`@Caching` 注解将 `@Cacheable`、`@CachePut` 和 `@CacheEvict` 组合在一起，分别用于缓存查找、更新和删除操作。

## 逐步讲解

### 1. `@Cacheable`

`@Cacheable` 用于标记一个方法的返回值应该被缓存。如果缓存中已经存在该值，则直接返回缓存中的值，而不会执行方法体。

```java
@Cacheable(value = "books", key = "#isbn")
public Book findBookByIsbn(String isbn) {
    // 从数据库或其他数据源中查找书籍
    return bookRepository.findByIsbn(isbn);
}
```

在这个例子中，`findBookByIsbn` 方法的返回值会被缓存在名为 `books` 的缓存中，缓存的键是 `isbn`。

### 2. `@CachePut`

`@CachePut` 用于更新缓存中的值。与 `@Cacheable` 不同，`@CachePut` 总是会执行方法体，并将返回值更新到缓存中。

```java
@CachePut(value = "books", key = "#book.isbn")
public Book updateBook(Book book) {
    // 更新书籍信息
    return bookRepository.save(book);
}
```

在这个例子中，`updateBook` 方法会更新书籍信息，并将更新后的书籍对象缓存到 `books` 缓存中。

### 3. `@CacheEvict`

`@CacheEvict` 用于从缓存中删除一个或多个条目。你可以通过指定缓存的键来删除特定的缓存条目，或者通过 `allEntries = true` 来删除缓存中的所有条目。

```java
@CacheEvict(value = "books", key = "#isbn")
public void deleteBookByIsbn(String isbn) {
    // 删除书籍
    bookRepository.deleteByIsbn(isbn);
}
```

在这个例子中，`deleteBookByIsbn` 方法会删除指定 `isbn` 的书籍，并从 `books` 缓存中移除对应的缓存条目。

### 4. 组合使用 `@Caching`

`@Caching` 允许你将上述注解组合在一起，从而在一个方法上执行多个缓存操作。

```java
@Caching(
    cacheable = {
        @Cacheable(value = "books", key = "#isbn")
    },
    put = {
        @CachePut(value = "books", key = "#result.id")
    },
    evict = {
        @CacheEvict(value = "books", key = "#isbn")
    }
)
public Book findAndUpdateBook(String isbn) {
    // 查找并更新书籍信息
    Book book = bookRepository.findByIsbn(isbn);
    book.setTitle("New Title");
    return bookRepository.save(book);
}
```

在这个例子中，`findAndUpdateBook` 方法会先查找书籍信息并缓存，然后更新书籍信息并更新缓存，最后从缓存中移除旧的书籍信息。

## 实际案例

假设你正在开发一个在线书店应用，用户可以通过 ISBN 查找书籍信息。为了提高性能，你决定使用缓存来存储书籍信息。

### 场景描述

1. 用户通过 ISBN 查找书籍信息。
2. 如果书籍信息已经在缓存中，则直接返回缓存中的值。
3. 如果书籍信息不在缓存中，则从数据库中查找并缓存。
4. 当书籍信息更新时，更新缓存中的值。
5. 当书籍被删除时，从缓存中移除对应的书籍信息。

### 实现代码

```java
@Service
public class BookService {

    @Autowired
    private BookRepository bookRepository;

    @Caching(
        cacheable = {
            @Cacheable(value = "books", key = "#isbn")
        },
        put = {
            @CachePut(value = "books", key = "#result.isbn")
        }
    )
    public Book findBookByIsbn(String isbn) {
        return bookRepository.findByIsbn(isbn);
    }

    @CachePut(value = "books", key = "#book.isbn")
    public Book updateBook(Book book) {
        return bookRepository.save(book);
    }

    @CacheEvict(value = "books", key = "#isbn")
    public void deleteBookByIsbn(String isbn) {
        bookRepository.deleteByIsbn(isbn);
    }
}
```

在这个案例中，`BookService` 类通过 `@Caching` 注解实现了书籍信息的缓存管理。用户查找书籍信息时，如果缓存中已经存在，则直接返回缓存中的值；如果缓存中不存在，则从数据库中查找并缓存。当书籍信息更新或删除时，缓存也会相应更新或删除。

## 总结

通过 `@Caching` 注解，Spring 提供了一种灵活的方式来管理缓存操作。你可以将多个缓存操作组合在一起，从而简化代码并提高可读性。在实际开发中，合理使用缓存可以显著提升应用性能，尤其是在处理大量数据或高并发场景时。

## 附加资源与练习

- **练习 1**: 尝试在你的 Spring 项目中实现一个简单的缓存管理功能，使用 `@Caching` 注解组合多个缓存操作。
- **练习 2**: 扩展上述案例，添加更多的缓存操作，例如在更新书籍信息时同时更新多个缓存。
- **资源**: 阅读 [Spring 官方文档](https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache) 以了解更多关于 Spring 缓存的内容。

:::tip
在实际开发中，缓存策略的选择和配置非常重要。确保你根据应用的需求选择合适的缓存策略，并定期监控缓存的命中率和性能。
:::