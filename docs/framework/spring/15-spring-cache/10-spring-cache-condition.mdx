---
title: Spring 缓存条件
description: 了解如何在Spring中使用缓存条件来控制缓存的存储和检索行为。本文适合初学者，包含代码示例和实际应用场景。
---

# Spring 缓存条件

在Spring框架中，缓存是提高应用程序性能的重要手段之一。通过缓存，我们可以减少重复计算和数据库查询，从而加快响应速度。然而，并非所有情况下我们都希望缓存数据。Spring提供了缓存条件（Cache Conditions）机制，允许我们根据特定条件来决定是否缓存数据。

## 什么是缓存条件？

缓存条件是指在缓存操作中，根据某些条件来决定是否执行缓存。Spring通过`@Cacheable`、`@CachePut`和`@CacheEvict`等注解的`condition`和`unless`属性来实现这一功能。

- `condition`：在方法执行**之前**评估条件，如果条件为`true`，则执行缓存操作。
- `unless`：在方法执行**之后**评估条件，如果条件为`true`，则不缓存结果。

## 使用缓存条件

### 1. `condition`属性

`condition`属性允许我们在方法执行之前评估条件。如果条件为`true`，则执行缓存操作；否则，跳过缓存。

```java
@Cacheable(value = "books", condition = "#id > 10")
public Book findBookById(Long id) {
    // 模拟数据库查询
    return new Book(id, "Spring in Action");
}
```

在这个例子中，只有当`id`大于10时，才会将结果缓存到`books`缓存中。

### 2. `unless`属性

`unless`属性允许我们在方法执行之后评估条件。如果条件为`true`，则不缓存结果。

```java
@Cacheable(value = "books", unless = "#result.price > 100")
public Book findBookById(Long id) {
    // 模拟数据库查询
    return new Book(id, "Spring in Action", 150.0);
}
```

在这个例子中，如果查询到的书籍价格大于100，则不会将结果缓存到`books`缓存中。

## 实际应用场景

### 场景1：根据用户角色缓存数据

假设我们有一个根据用户角色返回数据的服务方法。我们希望只有管理员角色的用户数据才被缓存。

```java
@Cacheable(value = "userData", condition = "#role == 'ADMIN'")
public UserData getUserData(String userId, String role) {
    // 模拟数据库查询
    return new UserData(userId, role, "Some Data");
}
```

在这个例子中，只有当`role`为`ADMIN`时，才会将用户数据缓存到`userData`缓存中。

### 场景2：缓存高价值商品

假设我们有一个商品查询服务，我们希望只缓存价格高于100的商品。

```java
@Cacheable(value = "products", unless = "#result.price <= 100")
public Product getProductById(Long id) {
    // 模拟数据库查询
    return new Product(id, "High-End Laptop", 1200.0);
}
```

在这个例子中，如果查询到的商品价格小于或等于100，则不会将结果缓存到`products`缓存中。

## 总结

Spring缓存条件为我们提供了灵活的方式来控制缓存行为。通过`condition`和`unless`属性，我们可以根据方法参数或返回值来决定是否缓存数据。这种机制在需要根据特定条件缓存数据的场景中非常有用。

## 附加资源

- [Spring官方文档 - 缓存](https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache)
- [Spring缓存注解详解](https://www.baeldung.com/spring-cache-tutorial)

## 练习

1. 修改上面的`findBookById`方法，使其只在书籍名称包含"Spring"时才缓存结果。
2. 创建一个新的缓存方法，根据用户的年龄决定是否缓存用户信息。

通过以上练习，你将更深入地理解Spring缓存条件的应用。