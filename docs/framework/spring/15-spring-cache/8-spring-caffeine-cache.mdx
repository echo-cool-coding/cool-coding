---
title: Spring Caffeine 缓存
description: 了解如何使用 Spring Caffeine 缓存来提升应用程序的性能。本文适合初学者，涵盖基本概念、代码示例和实际应用场景。
---

# Spring Caffeine 缓存

在现代应用程序中，缓存是提升性能的关键技术之一。Spring 框架提供了多种缓存实现，而 **Caffeine** 是一个高性能的 Java 缓存库，被广泛用于 Spring 应用程序中。本文将详细介绍如何在 Spring 中使用 Caffeine 缓存，并通过示例代码帮助您快速上手。

## 什么是 Caffeine 缓存？

Caffeine 是一个基于 Java 的高性能缓存库，专为高并发场景设计。它提供了丰富的功能，例如自动加载、过期策略、缓存淘汰策略等。Spring 框架通过 `spring-boot-starter-cache` 模块与 Caffeine 集成，使得在 Spring 应用程序中使用 Caffeine 变得非常简单。

## 为什么使用 Caffeine 缓存？

- **高性能**：Caffeine 使用高效的算法和数据结构，能够处理高并发场景。
- **灵活的配置**：支持多种缓存策略，例如基于时间、大小和引用的缓存淘汰。
- **与 Spring 无缝集成**：通过简单的配置即可在 Spring 应用程序中使用。

## 在 Spring 中配置 Caffeine 缓存

要在 Spring 中使用 Caffeine 缓存，首先需要在项目中添加依赖。如果您使用的是 Maven，可以在 `pom.xml` 中添加以下依赖：

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-cache</artifactId>
</dependency>
<dependency>
    <groupId>com.github.ben-manes.caffeine</groupId>
    <artifactId>caffeine</artifactId>
</dependency>
```

接下来，您需要在 Spring 配置类中启用缓存并配置 Caffeine 缓存管理器。以下是一个简单的配置示例：

```java
import com.github.benmanes.caffeine.cache.Caffeine;
import org.springframework.cache.CacheManager;
import org.springframework.cache.annotation.EnableCaching;
import org.springframework.cache.caffeine.CaffeineCacheManager;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.concurrent.TimeUnit;

@Configuration
@EnableCaching
public class CacheConfig {

    @Bean
    public CacheManager cacheManager() {
        CaffeineCacheManager cacheManager = new CaffeineCacheManager("exampleCache");
        cacheManager.setCaffeine(Caffeine.newBuilder()
                .expireAfterWrite(10, TimeUnit.MINUTES)
                .maximumSize(100));
        return cacheManager;
    }
}
```

在上面的代码中，我们配置了一个名为 `exampleCache` 的缓存，并设置了缓存的过期时间为 10 分钟，最大缓存条目数为 100。

## 使用 Caffeine 缓存

配置完成后，您可以在 Spring 服务类中使用 `@Cacheable` 注解来启用缓存。以下是一个简单的示例：

```java
import org.springframework.cache.annotation.Cacheable;
import org.springframework.stereotype.Service;

@Service
public class ExampleService {

    @Cacheable("exampleCache")
    public String getData(String key) {
        // 模拟一个耗时的操作
        try {
            Thread.sleep(2000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        return "Data for " + key;
    }
}
```

在这个示例中，`getData` 方法的结果将被缓存。当相同的 `key` 被再次请求时，Spring 会直接从缓存中返回结果，而不会再次执行方法体中的代码。

## 实际应用场景

假设您正在开发一个电子商务网站，其中有一个商品详情页面。每次用户访问商品详情时，都需要从数据库中查询商品信息。为了提高性能，您可以使用 Caffeine 缓存来缓存商品信息，从而减少数据库查询的次数。

以下是一个简化的示例：

```java
@Service
public class ProductService {

    @Cacheable("productCache")
    public Product getProductById(Long productId) {
        // 模拟从数据库查询商品信息
        return database.getProductById(productId);
    }
}
```

在这个示例中，`getProductById` 方法的结果将被缓存。当相同的 `productId` 被再次请求时，Spring 会直接从缓存中返回商品信息，而不会再次查询数据库。

## 缓存策略

Caffeine 提供了多种缓存策略，您可以根据应用程序的需求进行配置。以下是一些常见的策略：

- **基于时间的过期**：例如 `expireAfterWrite` 和 `expireAfterAccess`。
- **基于大小的淘汰**：例如 `maximumSize`。
- **基于引用的淘汰**：例如 `weakKeys` 和 `weakValues`。

您可以在配置缓存管理器时使用这些策略。例如：

```java
cacheManager.setCaffeine(Caffeine.newBuilder()
        .expireAfterWrite(10, TimeUnit.MINUTES)
        .maximumSize(100)
        .weakKeys());
```

## 总结

通过本文，您已经了解了如何在 Spring 中使用 Caffeine 缓存来提升应用程序的性能。我们介绍了 Caffeine 缓存的基本概念、配置方法以及实际应用场景。希望这些内容能够帮助您在开发过程中更好地利用缓存技术。

## 附加资源

- [Caffeine GitHub 仓库](https://github.com/ben-manes/caffeine)
- [Spring 缓存文档](https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache)

## 练习

1. 在您的 Spring 项目中配置 Caffeine 缓存，并尝试使用 `@Cacheable` 注解缓存方法结果。
2. 修改缓存策略，观察不同策略对缓存行为的影响。
3. 尝试在缓存中存储复杂对象，并测试缓存的性能提升效果。

祝您学习愉快！