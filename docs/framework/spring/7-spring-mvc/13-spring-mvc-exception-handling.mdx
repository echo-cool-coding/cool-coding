---
title: Spring MVC 异常处理
description: 了解如何在 Spring MVC 中处理异常，确保应用程序的健壮性和用户体验。
---

# Spring MVC 异常处理

在开发 Web 应用程序时，异常处理是一个至关重要的部分。Spring MVC 提供了多种机制来处理异常，确保应用程序在出现错误时能够优雅地响应，而不是直接崩溃或暴露敏感信息。本文将详细介绍 Spring MVC 中的异常处理机制，并通过实际案例帮助你理解如何在实际项目中应用这些技术。

## 1. 什么是 Spring MVC 异常处理？

Spring MVC 异常处理是指在 Spring MVC 框架中捕获和处理应用程序中可能出现的异常。通过合理的异常处理，我们可以：

- 提供友好的错误页面或错误信息，提升用户体验。
- 记录异常信息，便于后续排查问题。
- 避免敏感信息泄露，增强应用程序的安全性。

Spring MVC 提供了多种异常处理方式，包括使用 `@ExceptionHandler` 注解、`@ControllerAdvice` 注解以及自定义异常处理器等。

## 2. 使用 `@ExceptionHandler` 处理异常

`@ExceptionHandler` 是 Spring MVC 中最常用的异常处理方式之一。它允许我们在控制器中定义方法来处理特定类型的异常。

### 示例代码

```java
@Controller
public class UserController {

    @GetMapping("/user/{id}")
    public String getUser(@PathVariable int id) {
        if (id < 1) {
            throw new IllegalArgumentException("Invalid user ID");
        }
        return "user";
    }

    @ExceptionHandler(IllegalArgumentException.class)
    public String handleIllegalArgumentException(IllegalArgumentException ex, Model model) {
        model.addAttribute("errorMessage", ex.getMessage());
        return "error";
    }
}
```

### 解释

- `@ExceptionHandler(IllegalArgumentException.class)`：该方法将处理 `IllegalArgumentException` 类型的异常。
- `handleIllegalArgumentException` 方法：当 `IllegalArgumentException` 被抛出时，Spring MVC 会调用该方法，并将异常信息传递给视图。

### 输入与输出

- **输入**：访问 `/user/0`。
- **输出**：返回 `error` 视图，并显示错误信息 "Invalid user ID"。

:::tip
`@ExceptionHandler` 注解的方法可以处理当前控制器中抛出的异常。如果你希望处理全局异常，可以使用 `@ControllerAdvice`。
:::

## 3. 使用 `@ControllerAdvice` 处理全局异常

`@ControllerAdvice` 是一个全局异常处理器，它可以处理整个应用程序中所有控制器抛出的异常。通过 `@ControllerAdvice`，我们可以集中管理异常处理逻辑。

### 示例代码

```java
@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(Exception.class)
    public String handleException(Exception ex, Model model) {
        model.addAttribute("errorMessage", "An unexpected error occurred: " + ex.getMessage());
        return "error";
    }
}
```

### 解释

- `@ControllerAdvice`：标记该类为全局异常处理器。
- `@ExceptionHandler(Exception.class)`：该方法将处理所有类型的异常。

### 输入与输出

- **输入**：访问 `/user/0`。
- **输出**：返回 `error` 视图，并显示错误信息 "An unexpected error occurred: Invalid user ID"。

:::caution
`@ControllerAdvice` 可以处理所有控制器的异常，但如果你只想处理特定控制器的异常，可以使用 `@ControllerAdvice(annotations = SpecificController.class)`。
:::

## 4. 自定义异常处理器

除了使用 `@ExceptionHandler` 和 `@ControllerAdvice`，我们还可以通过实现 `HandlerExceptionResolver` 接口来自定义异常处理器。

### 示例代码

```java
@Component
public class CustomExceptionResolver implements HandlerExceptionResolver {

    @Override
    public ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) {
        ModelAndView modelAndView = new ModelAndView("error");
        modelAndView.addObject("errorMessage", "Custom error: " + ex.getMessage());
        return modelAndView;
    }
}
```

### 解释

- `HandlerExceptionResolver`：实现该接口可以自定义异常处理逻辑。
- `resolveException` 方法：当异常发生时，Spring MVC 会调用该方法，并返回一个 `ModelAndView` 对象。

### 输入与输出

- **输入**：访问 `/user/0`。
- **输出**：返回 `error` 视图，并显示错误信息 "Custom error: Invalid user ID"。

:::note
自定义异常处理器可以更灵活地控制异常处理逻辑，但通常建议优先使用 `@ExceptionHandler` 和 `@ControllerAdvice`，因为它们更易于维护。
:::

## 5. 实际应用场景

假设我们正在开发一个电商网站，用户可以通过 ID 查询商品信息。如果用户输入了无效的商品 ID，我们希望返回一个友好的错误页面，而不是直接抛出异常。

### 实现步骤

1. 在控制器中定义查询商品的方法。
2. 使用 `@ExceptionHandler` 处理无效 ID 的异常。
3. 返回一个包含错误信息的视图。

### 示例代码

```java
@Controller
public class ProductController {

    @GetMapping("/product/{id}")
    public String getProduct(@PathVariable int id) {
        if (id < 1) {
            throw new IllegalArgumentException("Invalid product ID");
        }
        return "product";
    }

    @ExceptionHandler(IllegalArgumentException.class)
    public String handleIllegalArgumentException(IllegalArgumentException ex, Model model) {
        model.addAttribute("errorMessage", ex.getMessage());
        return "error";
    }
}
```

### 输入与输出

- **输入**：访问 `/product/0`。
- **输出**：返回 `error` 视图，并显示错误信息 "Invalid product ID"。

## 6. 总结

Spring MVC 提供了多种异常处理机制，包括 `@ExceptionHandler`、`@ControllerAdvice` 和自定义异常处理器。通过合理使用这些机制，我们可以确保应用程序在出现异常时能够优雅地处理，并提供友好的用户体验。

在实际开发中，建议优先使用 `@ExceptionHandler` 和 `@ControllerAdvice`，因为它们更易于维护和理解。对于复杂的异常处理需求，可以考虑实现自定义异常处理器。

## 7. 附加资源与练习

- **资源**：
  - [Spring MVC 官方文档](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-exceptionhandlers)
  - [Spring Boot 异常处理指南](https://spring.io/guides/gs/rest-service/)

- **练习**：
  1. 创建一个 Spring MVC 项目，并实现一个控制器，处理用户登录功能。
  2. 使用 `@ExceptionHandler` 处理登录失败时的异常。
  3. 使用 `@ControllerAdvice` 处理全局异常，例如数据库连接失败。

通过以上练习，你将更深入地理解 Spring MVC 异常处理的实际应用。