---
title: Spring @Repository
description: "了解 Spring 框架中的 @Repository 注解，掌握其在数据访问层中的应用，并通过实际案例加深理解。"
---

## 介绍

在 Spring 框架中，`@Repository` 是一个用于标识数据访问层（DAO 层）的注解。它是 Spring 提供的四大注解之一（`@Component`、`@Service`、`@Controller`、`@Repository`），专门用于标记与数据库交互的类。通过使用 `@Repository`，Spring 可以自动检测并管理这些类，同时提供异常转换等额外功能。

:::tip
`@Repository` 是 `@Component` 的一个特化版本，专门用于数据访问层。它不仅具有 `@Component` 的功能，还能将数据库相关的异常转换为 Spring 的统一数据访问异常。
:::

## 为什么使用 @Repository？

1. **自动扫描与注册**：Spring 会自动扫描带有 `@Repository` 注解的类，并将其注册为 Spring 容器中的 Bean。
2. **异常转换**：Spring 会将数据访问层抛出的异常（如 JDBC 的 `SQLException`）转换为 Spring 的统一数据访问异常（如 `DataAccessException`），从而简化异常处理。
3. **清晰的层次结构**：通过使用 `@Repository`，可以清晰地标识出数据访问层的类，使代码结构更加清晰。

## 基本用法

以下是一个简单的 `@Repository` 使用示例：

```java
import org.springframework.stereotype.Repository;

@Repository
public class UserRepository {

    public String findUserById(int id) {
        // 模拟数据库查询
        return "User" + id;
    }
}
```

在这个例子中，`UserRepository` 类被标记为 `@Repository`，Spring 会自动将其注册为一个 Bean。你可以在其他类中通过 `@Autowired` 注解注入这个 Bean。

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserService {

    @Autowired
    private UserRepository userRepository;

    public String getUserById(int id) {
        return userRepository.findUserById(id);
    }
}
```

## 实际案例

假设我们正在开发一个简单的用户管理系统，需要从数据库中查询用户信息。我们可以使用 `@Repository` 来定义数据访问层的逻辑。

### 1. 定义实体类

```java
public class User {
    private int id;
    private String name;

    // 省略构造函数、getter 和 setter
}
```

### 2. 定义 Repository 接口

```java
import java.util.List;

public interface UserRepository {
    User findById(int id);
    List<User> findAll();
}
```

### 3. 实现 Repository 接口

```java
import org.springframework.stereotype.Repository;

@Repository
public class UserRepositoryImpl implements UserRepository {

    @Override
    public User findById(int id) {
        // 模拟数据库查询
        return new User(id, "User" + id);
    }

    @Override
    public List<User> findAll() {
        // 模拟数据库查询
        return List.of(new User(1, "User1"), new User(2, "User2"));
    }
}
```

### 4. 在 Service 层使用 Repository

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class UserService {

    @Autowired
    private UserRepository userRepository;

    public User getUserById(int id) {
        return userRepository.findById(id);
    }

    public List<User> getAllUsers() {
        return userRepository.findAll();
    }
}
```

### 5. 测试代码

```java
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

public class Main {
    public static void main(String[] args) {
        ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);
        UserService userService = context.getBean(UserService.class);

        User user = userService.getUserById(1);
        System.out.println("User: " + user.getName());

        List<User> users = userService.getAllUsers();
        users.forEach(u -> System.out.println("User: " + u.getName()));
    }
}
```

## 总结

`@Repository` 是 Spring 框架中用于标识数据访问层的重要注解。它不仅简化了 Bean 的注册过程，还提供了异常转换等功能，使得数据访问层的开发更加高效和规范。通过本文的学习，你应该已经掌握了 `@Repository` 的基本用法，并能够在实际项目中应用它。

## 附加资源

- [Spring 官方文档 - @Repository](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-stereotype-annotations)
- [Spring Data Access Exception Handling](https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#dao-exceptions)

## 练习

1. 创建一个新的 Spring 项目，定义一个 `ProductRepository` 类，并使用 `@Repository` 注解标记它。
2. 在 `ProductRepository` 中实现一个方法，用于根据产品 ID 查询产品信息。
3. 在 `ProductService` 中注入 `ProductRepository`，并调用其方法进行测试。
