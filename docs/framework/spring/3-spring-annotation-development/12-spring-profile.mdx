---
title: Spring @Profile
description: "了解如何使用 Spring 的 @Profile 注解来根据不同的环境配置加载不同的 Bean。本教程适合初学者，包含代码示例和实际应用场景。"
---

# Spring @Profile

在开发 Spring 应用程序时，我们经常需要根据不同的环境（如开发、测试、生产）来加载不同的配置或 Bean。Spring 提供了 `@Profile` 注解，允许我们根据当前激活的配置文件来条件化地加载 Bean。本文将详细介绍 `@Profile` 的使用方法，并通过实际案例展示其应用场景。

## 什么是 @Profile？

`@Profile` 是 Spring 提供的一个注解，用于指定某个 Bean 或配置类仅在特定的配置文件激活时才会被加载。通过这种方式，我们可以轻松地为不同的环境配置不同的 Bean，而无需修改代码。

### 基本用法

`@Profile` 注解可以用于类或方法上。当用于类上时，整个类只有在指定的配置文件激活时才会被加载；当用于方法上时，该方法返回的 Bean 只有在指定的配置文件激活时才会被注册到 Spring 容器中。

```java
@Configuration
public class AppConfig {

    @Bean
    @Profile("dev")
    public DataSource devDataSource() {
        return new EmbeddedDatabaseBuilder()
                .setType(EmbeddedDatabaseType.H2)
                .build();
    }

    @Bean
    @Profile("prod")
    public DataSource prodDataSource() {
        return new DriverManagerDataSource("jdbc:mysql://localhost:3306/mydb", "user", "password");
    }
}
```

在上面的代码中，`devDataSource` 方法返回的 Bean 仅在 `dev` 配置文件激活时才会被加载，而 `prodDataSource` 方法返回的 Bean 仅在 `prod` 配置文件激活时才会被加载。

## 激活配置文件

要激活特定的配置文件，可以通过以下几种方式：

1. **通过环境变量激活**：设置 `spring.profiles.active` 环境变量为所需的配置文件名称。例如，在命令行中运行应用程序时，可以使用以下命令：

   ```bash
   java -jar myapp.jar --spring.profiles.active=dev
   ```

2. **通过配置文件激活**：在 `application.properties` 或 `application.yml` 文件中设置 `spring.profiles.active` 属性。例如：

   ```properties
   spring.profiles.active=dev
   ```

3. **通过编程方式激活**：在 Spring 应用程序启动时，通过编程方式设置激活的配置文件。例如：

   ```java
   SpringApplication app = new SpringApplication(MyApp.class);
   app.setAdditionalProfiles("dev");
   app.run(args);
   ```

## 实际应用场景

### 多环境数据库配置

在实际开发中，我们通常会在不同的环境中使用不同的数据库。例如，在开发环境中使用嵌入式数据库（如 H2），而在生产环境中使用 MySQL 数据库。通过 `@Profile`，我们可以轻松实现这一点。

```java
@Configuration
public class DatabaseConfig {

    @Bean
    @Profile("dev")
    public DataSource devDataSource() {
        return new EmbeddedDatabaseBuilder()
                .setType(EmbeddedDatabaseType.H2)
                .addScript("classpath:schema.sql")
                .addScript("classpath:data.sql")
                .build();
    }

    @Bean
    @Profile("prod")
    public DataSource prodDataSource() {
        return new DriverManagerDataSource("jdbc:mysql://localhost:3306/mydb", "user", "password");
    }
}
```

在上面的代码中，`devDataSource` 方法返回的 Bean 仅在 `dev` 配置文件激活时才会被加载，而 `prodDataSource` 方法返回的 Bean 仅在 `prod` 配置文件激活时才会被加载。

### 多环境日志配置

另一个常见的应用场景是根据不同的环境配置不同的日志级别。例如，在开发环境中，我们希望日志级别为 `DEBUG`，而在生产环境中，我们希望日志级别为 `INFO`。

```java
@Configuration
public class LoggingConfig {

    @Bean
    @Profile("dev")
    public Logger devLogger() {
        Logger logger = LoggerFactory.getLogger("devLogger");
        logger.setLevel(Level.DEBUG);
        return logger;
    }

    @Bean
    @Profile("prod")
    public Logger prodLogger() {
        Logger logger = LoggerFactory.getLogger("prodLogger");
        logger.setLevel(Level.INFO);
        return logger;
    }
}
```

在上面的代码中，`devLogger` 方法返回的 Bean 仅在 `dev` 配置文件激活时才会被加载，而 `prodLogger` 方法返回的 Bean 仅在 `prod` 配置文件激活时才会被加载。

## 总结

`@Profile` 是 Spring 中一个非常有用的注解，它允许我们根据不同的环境配置加载不同的 Bean。通过 `@Profile`，我们可以轻松地为不同的环境配置不同的数据库、日志级别等，而无需修改代码。希望本文能帮助你理解并掌握 `@Profile` 的使用方法。

## 附加资源

- [Spring 官方文档 - Profiles](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-definition-profiles)
- [Spring Boot 官方文档 - Profiles](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.profiles)

## 练习

1. 创建一个 Spring Boot 应用程序，并使用 `@Profile` 为开发环境和生产环境配置不同的数据源。
2. 尝试通过环境变量、配置文件和编程方式激活不同的配置文件，并观察应用程序的行为变化。