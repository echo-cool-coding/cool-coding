---
title: Next.js 第三方 API 集成
description: 学习如何在 Next.js 中集成第三方 API，构建功能强大的 Web 应用程序。
---

# Next.js 第三方 API 集成

在现代 Web 开发中，集成第三方 API 是非常常见的需求。无论是获取天气数据、处理支付，还是与社交媒体平台交互，第三方 API 都能为你的应用程序提供丰富的功能。Next.js 作为一个全栈框架，提供了强大的工具来简化与第三方 API 的集成。

本文将带你逐步了解如何在 Next.js 中集成第三方 API，并通过实际案例展示其应用场景。

## 什么是第三方 API 集成？

第三方 API 集成是指将外部服务提供的 API 与你的应用程序连接起来，以便在你的应用中使用这些服务的数据或功能。例如，你可以使用 Twitter API 来获取用户的推文，或者使用 Stripe API 来处理支付。

在 Next.js 中，你可以通过 `getStaticProps`、`getServerSideProps` 或 API 路由来与第三方 API 进行交互。

## 在 Next.js 中集成第三方 API

### 1. 使用 `getStaticProps` 获取数据

`getStaticProps` 是 Next.js 中的一个函数，用于在构建时获取数据并将其作为 props 传递给页面组件。这对于获取静态数据（如博客文章或产品列表）非常有用。

以下是一个简单的示例，展示如何使用 `getStaticProps` 从第三方 API 获取数据：

```javascript
export async function getStaticProps() {
  const res = await fetch('https://api.example.com/data');
  const data = await res.json();

  return {
    props: {
      data,
    },
  };
}

export default function Home({ data }) {
  return (
    <div>
      <h1>第三方 API 数据</h1>
      <pre>{JSON.stringify(data, null, 2)}</pre>
    </div>
  );
}
```

在这个示例中，`getStaticProps` 函数从 `https://api.example.com/data` 获取数据，并将其作为 `data` prop 传递给 `Home` 组件。

### 2. 使用 `getServerSideProps` 获取动态数据

如果你需要在每次请求时获取最新的数据，可以使用 `getServerSideProps`。这个函数在服务器端运行，并在每次请求时获取数据。

```javascript
export async function getServerSideProps() {
  const res = await fetch('https://api.example.com/latest-data');
  const data = await res.json();

  return {
    props: {
      data,
    },
  };
}

export default function LatestData({ data }) {
  return (
    <div>
      <h1>最新数据</h1>
      <pre>{JSON.stringify(data, null, 2)}</pre>
    </div>
  );
}
```

### 3. 使用 API 路由处理复杂逻辑

Next.js 提供了 API 路由功能，允许你在服务器端处理复杂的逻辑。你可以在 `pages/api` 目录下创建 API 路由，并在其中与第三方 API 进行交互。

以下是一个简单的 API 路由示例，用于从第三方 API 获取数据并返回给客户端：

```javascript
// pages/api/data.js
export default async function handler(req, res) {
  const apiRes = await fetch('https://api.example.com/data');
  const data = await apiRes.json();

  res.status(200).json(data);
}
```

然后，你可以在客户端调用这个 API 路由：

```javascript
export default function Home() {
  const [data, setData] = useState(null);

  useEffect(() => {
    fetch('/api/data')
      .then((res) => res.json())
      .then((data) => setData(data));
  }, []);

  return (
    <div>
      <h1>API 路由数据</h1>
      <pre>{JSON.stringify(data, null, 2)}</pre>
    </div>
  );
}
```

## 实际案例：集成天气 API

让我们通过一个实际案例来展示如何在 Next.js 中集成第三方 API。假设我们要构建一个天气应用，使用 OpenWeatherMap API 获取当前天气数据。

### 1. 获取 API 密钥

首先，你需要在 [OpenWeatherMap](https://openweathermap.org/api) 上注册并获取 API 密钥。

### 2. 创建 API 路由

在 `pages/api/weather.js` 中创建一个 API 路由，用于从 OpenWeatherMap API 获取天气数据：

```javascript
// pages/api/weather.js
export default async function handler(req, res) {
  const { city } = req.query;
  const apiKey = process.env.OPENWEATHERMAP_API_KEY;
  const apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}`;

  const apiRes = await fetch(apiUrl);
  const data = await apiRes.json();

  res.status(200).json(data);
}
```

### 3. 在页面中调用 API 路由

接下来，在页面组件中调用这个 API 路由，并显示天气数据：

```javascript
import { useState } from 'react';

export default function Weather() {
  const [city, setCity] = useState('');
  const [weather, setWeather] = useState(null);

  const fetchWeather = async () => {
    const res = await fetch(`/api/weather?city=${city}`);
    const data = await res.json();
    setWeather(data);
  };

  return (
    <div>
      <h1>天气查询</h1>
      <input
        type="text"
        value={city}
        onChange={(e) => setCity(e.target.value)}
        placeholder="输入城市名称"
      />
      <button onClick={fetchWeather}>查询</button>

      {weather && (
        <div>
          <h2>{weather.name}</h2>
          <p>温度: {weather.main.temp}°C</p>
          <p>天气: {weather.weather[0].description}</p>
        </div>
      )}
    </div>
  );
}
```

## 总结

通过本文，你已经学习了如何在 Next.js 中集成第三方 API。无论是使用 `getStaticProps`、`getServerSideProps` 还是 API 路由，Next.js 都提供了灵活的方式来与外部服务进行交互。

### 附加资源

- [Next.js 官方文档](https://nextjs.org/docs)
- [OpenWeatherMap API 文档](https://openweathermap.org/api)
- [Fetch API 文档](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)

### 练习

1. 尝试集成另一个第三方 API，如 Twitter API 或 GitHub API。
2. 创建一个页面，显示从第三方 API 获取的数据，并使用 CSS 美化页面。

通过不断练习，你将更加熟练地掌握 Next.js 中的第三方 API 集成技巧。