---
title: Next.js 客户端状态
description: 了解如何在 Next.js 中管理客户端状态，包括使用 React 的 useState 和 useContext 等工具，以及实际应用场景。
---

# Next.js 客户端状态

在 Next.js 中，客户端状态管理是构建动态和交互式应用程序的关键部分。客户端状态指的是在浏览器中运行的应用部分的状态，而不是在服务器端生成的内容。通过有效地管理客户端状态，您可以创建响应迅速、用户体验良好的应用程序。

## 什么是客户端状态？

客户端状态是指在用户浏览器中存储和管理的应用程序数据。这些数据可以是用户的输入、UI 状态（如菜单是否展开）、或者从服务器获取的数据的缓存。与服务器端状态不同，客户端状态是动态的，并且会随着用户与应用程序的交互而改变。

## 使用 React 的 `useState` 管理简单状态

React 提供了 `useState` 钩子，用于在函数组件中管理简单的客户端状态。以下是一个简单的示例，展示了如何使用 `useState` 来管理一个计数器的状态：

```jsx
import { useState } from 'react';

function Counter() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>当前计数: {count}</p>
      <button onClick={() => setCount(count + 1)}>增加</button>
      <button onClick={() => setCount(count - 1)}>减少</button>
    </div>
  );
}

export default Counter;
```

在这个示例中，`count` 是一个状态变量，`setCount` 是一个用于更新该状态的函数。每次用户点击按钮时，`count` 的值都会相应地增加或减少。

:::note
`useState` 是 React 中最基本的状态管理工具，适用于管理简单的、局部的状态。
:::

## 使用 `useContext` 管理全局状态

对于需要在多个组件之间共享的状态，React 提供了 `useContext` 钩子。`useContext` 允许您创建一个全局状态，并在组件树中的任何地方访问它。

以下是一个使用 `useContext` 的示例：

```jsx
import { createContext, useContext, useState } from 'react';

// 创建一个 Context
const ThemeContext = createContext();

function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');

  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

function ThemedButton() {
  const { theme, setTheme } = useContext(ThemeContext);

  return (
    <button
      style={{ backgroundColor: theme === 'light' ? '#fff' : '#333', color: theme === 'light' ? '#000' : '#fff' }}
      onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}
    >
      切换主题
    </button>
  );
}

export default function App() {
  return (
    <ThemeProvider>
      <ThemedButton />
    </ThemeProvider>
  );
}
```

在这个示例中，`ThemeContext` 是一个全局状态，用于管理应用程序的主题。`ThemeProvider` 组件包裹了整个应用，使得任何子组件都可以通过 `useContext` 访问和修改主题状态。

:::tip
`useContext` 非常适合管理需要在多个组件之间共享的全局状态，例如用户认证信息、主题设置等。
:::

## 实际应用场景

### 1. 表单状态管理

在表单处理中，客户端状态管理尤为重要。您可以使用 `useState` 来跟踪每个输入字段的值，并在用户提交表单时处理这些值。

```jsx
import { useState } from 'react';

function LoginForm() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    console.log('Email:', email);
    console.log('Password:', password);
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="email"
        value={email}
        onChange={(e) => setEmail(e.target.value)}
        placeholder="Email"
      />
      <input
        type="password"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        placeholder="Password"
      />
      <button type="submit">登录</button>
    </form>
  );
}

export default LoginForm;
```

### 2. 购物车状态管理

在电子商务网站中，购物车的状态通常需要在多个页面之间共享。您可以使用 `useContext` 来管理购物车的状态，并在用户添加或删除商品时更新购物车。

```jsx
import { createContext, useContext, useState } from 'react';

const CartContext = createContext();

function CartProvider({ children }) {
  const [cart, setCart] = useState([]);

  const addToCart = (product) => {
    setCart([...cart, product]);
  };

  return (
    <CartContext.Provider value={{ cart, addToCart }}>
      {children}
    </CartContext.Provider>
  );
}

function Product({ product }) {
  const { addToCart } = useContext(CartContext);

  return (
    <div>
      <h3>{product.name}</h3>
      <p>{product.price}</p>
      <button onClick={() => addToCart(product)}>添加到购物车</button>
    </div>
  );
}

function Cart() {
  const { cart } = useContext(CartContext);

  return (
    <div>
      <h2>购物车</h2>
      <ul>
        {cart.map((item, index) => (
          <li key={index}>{item.name} - {item.price}</li>
        ))}
      </ul>
    </div>
  );
}

export default function App() {
  return (
    <CartProvider>
      <Product product={{ name: '商品1', price: '$10' }} />
      <Product product={{ name: '商品2', price: '$20' }} />
      <Cart />
    </CartProvider>
  );
}
```

## 总结

在 Next.js 中，客户端状态管理是构建动态和交互式应用程序的关键。通过使用 React 的 `useState` 和 `useContext`，您可以有效地管理简单和复杂的客户端状态。无论是处理表单输入、管理购物车，还是切换应用程序主题，客户端状态管理都能帮助您创建更好的用户体验。

## 附加资源

- [React 官方文档 - useState](https://reactjs.org/docs/hooks-state.html)
- [React 官方文档 - useContext](https://reactjs.org/docs/hooks-reference.html#usecontext)
- [Next.js 官方文档](https://nextjs.org/docs)

## 练习

1. 创建一个简单的计数器应用，使用 `useState` 来管理计数器的状态。
2. 扩展计数器应用，使用 `useContext` 来管理计数器的状态，并在多个组件之间共享。
3. 创建一个简单的待办事项列表应用，使用 `useState` 来管理待办事项的状态，并允许用户添加和删除待办事项。
