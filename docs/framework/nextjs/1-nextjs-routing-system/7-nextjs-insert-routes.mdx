---
title: Next.js 插入路由
description: 了解如何在 Next.js 中使用插入路由来动态创建页面并优化应用程序的路由结构。
---

## 介绍

在 Next.js 中，路由系统是构建应用程序的核心部分。Next.js 提供了基于文件系统的路由，这意味着你只需在 `pages` 目录下创建文件，Next.js 就会自动为你生成相应的路由。然而，有时我们需要更灵活的路由控制，例如动态路由或嵌套路由。这时，**插入路由**（Interpolated Routing）就派上了用场。

插入路由允许你根据动态数据生成路由，从而创建更复杂的路由结构。本文将详细介绍如何在 Next.js 中使用插入路由，并通过实际案例帮助你理解其应用场景。

---

## 什么是插入路由？

插入路由是一种动态生成路由的技术。它允许你在路由路径中使用变量或表达式，从而根据不同的输入生成不同的路由。例如，你可以根据用户的 ID 或文章的标题动态生成路由路径。

在 Next.js 中，插入路由通常与动态路由（Dynamic Routing）结合使用。动态路由允许你在路由路径中使用方括号 `[]` 来定义动态段，而插入路由则进一步扩展了这一功能，使路由路径更加灵活。

---

## 如何使用插入路由

### 1. 基本动态路由

在 Next.js 中，动态路由是通过在 `pages` 目录下创建带有方括号的文件来实现的。例如，创建一个文件 `pages/posts/[id].js`，这将生成一个动态路由 `/posts/:id`。

```javascript
// pages/posts/[id].js
import { useRouter } from 'next/router';

const Post = () => {
  const router = useRouter();
  const { id } = router.query;

  return <p>Post ID: {id}</p>;
};

export default Post;
```

在这个例子中，`id` 是一个动态段，可以通过 `/posts/1`、`/posts/2` 等 URL 访问。

### 2. 插入路由的进阶用法

插入路由的核心思想是将动态数据插入到路由路径中。例如，假设你有一个文章列表，每篇文章都有一个唯一的 `slug`，你可以根据 `slug` 动态生成路由。

```javascript
// pages/posts/[slug].js
import { useRouter } from 'next/router';

const Post = () => {
  const router = useRouter();
  const { slug } = router.query;

  return <p>Post Slug: {slug}</p>;
};

export default Post;
```

在这个例子中，`slug` 是一个动态段，可以通过 `/posts/my-first-post`、`/posts/another-post` 等 URL 访问。

### 3. 嵌套插入路由

有时，你可能需要更复杂的路由结构，例如嵌套路由。Next.js 允许你在动态路由中嵌套多个动态段。

```javascript
// pages/category/[categoryId]/post/[postId].js
import { useRouter } from 'next/router';

const Post = () => {
  const router = useRouter();
  const { categoryId, postId } = router.query;

  return (
    <p>
      Category ID: {categoryId}, Post ID: {postId}
    </p>
  );
};

export default Post;
```

在这个例子中，你可以通过 `/category/1/post/123` 访问该页面，其中 `categoryId` 和 `postId` 是动态段。

---

## 实际案例

假设你正在构建一个博客应用程序，每篇文章都有一个唯一的 `slug`，并且你希望根据文章的 `slug` 动态生成路由。以下是如何实现这一功能的示例：

1. 在 `pages/posts/[slug].js` 中定义动态路由。
2. 在 `getStaticPaths` 中生成所有可能的 `slug`。
3. 在 `getStaticProps` 中根据 `slug` 获取文章数据。

```javascript
// pages/posts/[slug].js
import { useRouter } from 'next/router';

const Post = ({ post }) => {
  const router = useRouter();
  const { slug } = router.query;

  if (router.isFallback) {
    return <p>Loading...</p>;
  }

  return (
    <div>
      <h1>{post.title}</h1>
      <p>{post.content}</p>
    </div>
  );
};

export async function getStaticPaths() {
  const posts = await fetch('/api/posts').then((res) => res.json());
  const paths = posts.map((post) => ({
    params: { slug: post.slug },
  }));

  return { paths, fallback: true };
}

export async function getStaticProps({ params }) {
  const post = await fetch(`/api/posts/${params.slug}`).then((res) => res.json());

  return { props: { post } };
}

export default Post;
```

在这个例子中，`getStaticPaths` 生成了所有可能的 `slug`，而 `getStaticProps` 根据 `slug` 获取文章数据。这样，你就可以根据文章的 `slug` 动态生成路由。

---

## 总结

插入路由是 Next.js 中一个强大的功能，它允许你根据动态数据生成路由，从而创建更灵活的路由结构。通过结合动态路由和 `getStaticPaths`、`getStaticProps` 等 API，你可以轻松构建复杂的路由系统。

:::tip 提示
如果你需要更复杂的路由控制，可以尝试使用 Next.js 的 `useRouter` 钩子或自定义路由逻辑。
:::

---

## 附加资源

- [Next.js 官方文档 - 动态路由](https://nextjs.org/docs/routing/dynamic-routes)
- [Next.js 官方文档 - 数据获取](https://nextjs.org/docs/basic-features/data-fetching)

---

## 练习

1. 创建一个动态路由 `/users/[userId]`，并根据 `userId` 显示用户信息。
2. 尝试在嵌套路由 `/category/[categoryId]/post/[postId]` 中获取并显示文章数据。
3. 使用 `getStaticPaths` 和 `getStaticProps` 预生成所有可能的动态路由。

通过完成这些练习，你将更好地掌握 Next.js 中的插入路由技术。