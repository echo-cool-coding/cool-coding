---
title: Next.js 保护路由
description: 学习如何在 Next.js 中保护路由，确保只有经过身份验证的用户才能访问特定页面。
---

在构建现代 Web 应用程序时，保护某些路由以确保只有经过身份验证的用户才能访问它们是一个常见的需求。Next.js 提供了多种方法来实现这一目标。本文将逐步介绍如何在 Next.js 中保护路由，确保只有授权用户才能访问特定页面。

## 什么是路由保护？

路由保护是一种机制，用于限制对应用程序中某些页面的访问。通常，这些页面包含敏感信息或需要用户登录后才能访问的功能。通过保护这些路由，您可以确保只有经过身份验证的用户才能访问它们。

## 实现路由保护的基本方法

在 Next.js 中，您可以通过以下几种方式来实现路由保护：

1. **客户端路由保护**：在页面加载时检查用户是否已登录，如果没有登录，则重定向到登录页面。
2. **服务器端路由保护**：在服务器端渲染（SSR）或静态生成（SSG）时检查用户是否已登录，如果没有登录，则重定向到登录页面。

### 客户端路由保护

客户端路由保护通常在 `useEffect` 钩子中实现。以下是一个简单的示例，展示如何在客户端保护路由：

```jsx
import { useEffect } from 'react';
import { useRouter } from 'next/router';
import { useSession } from 'next-auth/react';

export default function ProtectedPage() {
  const { data: session, status } = useSession();
  const router = useRouter();

  useEffect(() => {
    if (status === 'loading') return; // 等待会话加载
    if (!session) {
      router.push('/login'); // 如果用户未登录，重定向到登录页面
    }
  }, [session, status, router]);

  if (!session) {
    return <p>重定向到登录页面...</p>;
  }

  return (
    <div>
      <h1>受保护的页面</h1>
      <p>只有登录用户才能看到此内容。</p>
    </div>
  );
}
```

在这个示例中，我们使用了 `next-auth/react` 提供的 `useSession` 钩子来检查用户是否已登录。如果用户未登录，我们将使用 `useRouter` 钩子将用户重定向到登录页面。

### 服务器端路由保护

服务器端路由保护可以在 `getServerSideProps` 或 `getStaticProps` 中实现。以下是一个使用 `getServerSideProps` 的示例：

```jsx
import { getSession } from 'next-auth/react';

export async function getServerSideProps(context) {
  const session = await getSession(context);

  if (!session) {
    return {
      redirect: {
        destination: '/login',
        permanent: false,
      },
    };
  }

  return {
    props: { session },
  };
}

export default function ProtectedPage({ session }) {
  return (
    <div>
      <h1>受保护的页面</h1>
      <p>只有登录用户才能看到此内容。</p>
    </div>
  );
}
```

在这个示例中，我们使用 `getSession` 函数在服务器端检查用户是否已登录。如果用户未登录，我们将返回一个重定向对象，将用户重定向到登录页面。

## 实际应用场景

假设您正在构建一个电子商务网站，其中包含一个用户仪表板页面，只有登录用户才能访问。您可以使用上述方法之一来保护该页面，确保只有经过身份验证的用户才能访问。

### 示例：保护用户仪表板

```jsx
import { useEffect } from 'react';
import { useRouter } from 'next/router';
import { useSession } from 'next-auth/react';

export default function Dashboard() {
  const { data: session, status } = useSession();
  const router = useRouter();

  useEffect(() => {
    if (status === 'loading') return;
    if (!session) {
      router.push('/login');
    }
  }, [session, status, router]);

  if (!session) {
    return <p>重定向到登录页面...</p>;
  }

  return (
    <div>
      <h1>用户仪表板</h1>
      <p>欢迎回来，{session.user.name}！</p>
    </div>
  );
}
```

在这个示例中，我们保护了用户仪表板页面，确保只有登录用户才能访问。

## 总结

在 Next.js 中保护路由是一个重要的安全措施，可以确保只有经过身份验证的用户才能访问特定页面。您可以通过客户端或服务器端的方式来实现路由保护，具体取决于您的应用程序需求。

:::tip
在实际应用中，建议结合使用客户端和服务器端路由保护，以提供更好的用户体验和安全性。
:::

## 附加资源

- [Next.js 官方文档](https://nextjs.org/docs)
- [NextAuth.js 文档](https://next-auth.js.org/)
- [React useEffect 钩子文档](https://reactjs.org/docs/hooks-effect.html)

## 练习

1. 尝试在您的 Next.js 项目中实现客户端路由保护。
2. 使用 `getServerSideProps` 实现服务器端路由保护。
3. 结合使用客户端和服务器端路由保护，创建一个受保护的仪表板页面。

通过完成这些练习，您将更好地理解如何在 Next.js 中保护路由，并能够在实际项目中应用这些知识。