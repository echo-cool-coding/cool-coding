---
title: Next.js 与MySQL/PostgreSQL
description: 学习如何在Next.js项目中集成MySQL和PostgreSQL数据库，掌握数据库连接、查询和操作的基本方法。
---

# Next.js 与MySQL/PostgreSQL

在现代Web开发中，数据库是存储和管理数据的核心组件。Next.js作为一个全栈框架，允许开发者轻松集成各种数据库系统。本文将重点介绍如何在Next.js项目中集成MySQL和PostgreSQL数据库，并通过实际案例展示其应用。

## 介绍

Next.js是一个基于React的框架，支持服务器端渲染（SSR）和静态生成（SSG）。它不仅可以用于构建前端页面，还可以处理后端逻辑，包括与数据库的交互。MySQL和PostgreSQL是两种流行的关系型数据库管理系统（RDBMS），广泛应用于各种Web应用中。

在Next.js中，我们可以通过API路由（API Routes）与数据库进行交互。API路由是Next.js提供的一种机制，允许我们在服务器端编写处理HTTP请求的逻辑。通过API路由，我们可以执行数据库查询、插入、更新和删除操作。

## 集成MySQL

### 1. 安装MySQL驱动

首先，我们需要安装MySQL的Node.js驱动。可以使用以下命令安装：

```bash
npm install mysql2
```

### 2. 创建数据库连接

在Next.js项目中，我们可以创建一个数据库连接池，以便在多个请求之间共享连接。以下是一个简单的MySQL连接示例：

```javascript
// lib/db.js
import mysql from 'mysql2/promise';

const pool = mysql.createPool({
  host: 'localhost',
  user: 'root',
  password: 'password',
  database: 'mydatabase',
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0,
});

export default pool;
```

### 3. 执行查询

在API路由中，我们可以使用连接池执行SQL查询。以下是一个获取用户数据的示例：

```javascript
// pages/api/users.js
import pool from '../../lib/db';

export default async function handler(req, res) {
  try {
    const [rows] = await pool.query('SELECT * FROM users');
    res.status(200).json(rows);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
}
```

### 4. 测试API

启动Next.js开发服务器后，可以通过访问`http://localhost:3000/api/users`来测试API。如果数据库中有用户数据，API将返回一个包含用户信息的JSON数组。

## 集成PostgreSQL

### 1. 安装PostgreSQL驱动

与MySQL类似，我们需要安装PostgreSQL的Node.js驱动。可以使用以下命令安装：

```bash
npm install pg
```

### 2. 创建数据库连接

PostgreSQL的连接方式与MySQL类似。以下是一个简单的PostgreSQL连接示例：

```javascript
// lib/db.js
import { Pool } from 'pg';

const pool = new Pool({
  user: 'postgres',
  host: 'localhost',
  database: 'mydatabase',
  password: 'password',
  port: 5432,
});

export default pool;
```

### 3. 执行查询

在API路由中，我们可以使用连接池执行SQL查询。以下是一个获取用户数据的示例：

```javascript
// pages/api/users.js
import pool from '../../lib/db';

export default async function handler(req, res) {
  try {
    const { rows } = await pool.query('SELECT * FROM users');
    res.status(200).json(rows);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
}
```

### 4. 测试API

启动Next.js开发服务器后，可以通过访问`http://localhost:3000/api/users`来测试API。如果数据库中有用户数据，API将返回一个包含用户信息的JSON数组。

## 实际案例

假设我们正在开发一个博客系统，需要从数据库中获取文章列表并显示在页面上。我们可以使用Next.js的API路由从MySQL或PostgreSQL数据库中获取文章数据，并在页面中渲染。

### 1. 获取文章数据

首先，我们创建一个API路由来获取文章数据：

```javascript
// pages/api/posts.js
import pool from '../../lib/db';

export default async function handler(req, res) {
  try {
    const [rows] = await pool.query('SELECT * FROM posts');
    res.status(200).json(rows);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
}
```

### 2. 在页面中渲染文章

接下来，我们在页面中使用`getServerSideProps`或`getStaticProps`获取文章数据，并在页面中渲染：

```javascript
// pages/index.js
export async function getServerSideProps() {
  const res = await fetch('http://localhost:3000/api/posts');
  const posts = await res.json();

  return {
    props: {
      posts,
    },
  };
}

export default function Home({ posts }) {
  return (
    <div>
      <h1>文章列表</h1>
      <ul>
        {posts.map((post) => (
          <li key={post.id}>{post.title}</li>
        ))}
      </ul>
    </div>
  );
}
```

## 总结

通过本文，我们学习了如何在Next.js项目中集成MySQL和PostgreSQL数据库。我们创建了数据库连接池，并通过API路由执行SQL查询。最后，我们通过一个实际案例展示了如何从数据库中获取数据并在页面中渲染。

## 附加资源

- [MySQL官方文档](https://dev.mysql.com/doc/)
- [PostgreSQL官方文档](https://www.postgresql.org/docs/)
- [Next.js API路由文档](https://nextjs.org/docs/api-routes/introduction)

## 练习

1. 尝试在Next.js项目中集成SQLite数据库。
2. 创建一个API路由，允许用户通过表单提交数据并将其插入到数据库中。
3. 使用`getStaticProps`和`getServerSideProps`分别获取数据，并比较它们的区别。

:::tip
在实际开发中，建议使用环境变量来存储数据库连接信息，以提高安全性。
:::