---
title: Next.js 字体优化
description: 了解如何在 Next.js 项目中优化字体加载，提升页面性能和用户体验。
---

# Next.js 字体优化

在现代 Web 开发中，字体是页面设计的重要组成部分。然而，不恰当的字体加载方式可能会导致页面性能下降，影响用户体验。Next.js 提供了多种优化字体加载的方法，帮助开发者在不牺牲性能的前提下使用自定义字体。

## 为什么需要字体优化？

字体文件通常较大，如果未经过优化，可能会导致以下问题：
- **页面加载时间变长**：字体文件下载时间过长，导致页面内容延迟显示。
- **布局抖动（Layout Shift）**：字体加载完成后，页面布局可能会发生跳动，影响用户体验。
- **首屏内容显示延迟（FCP）**：字体未加载完成时，浏览器可能会使用备用字体，导致首屏内容显示不一致。

通过优化字体加载，可以有效减少这些问题，提升页面性能和用户体验。

## Next.js 中的字体优化方法

Next.js 提供了多种优化字体加载的方式，以下是几种常见的方法：

### 1. 使用 `next/font` 模块

Next.js 13 引入了 `next/font` 模块，这是一个内置的字体优化工具，支持 Google Fonts 和自定义字体。使用 `next/font` 可以自动优化字体加载，减少布局抖动和首屏内容显示延迟。

#### 使用 Google Fonts

```jsx
import { Inter } from 'next/font/google';

const inter = Inter({ subsets: ['latin'] });

export default function Home() {
  return (
    <div className={inter.className}>
      <h1>Hello, Next.js!</h1>
    </div>
  );
}
```

在上面的代码中，`Inter` 是 Google Fonts 提供的一种字体。通过 `next/font/google` 导入并使用它，Next.js 会自动优化字体的加载方式。

#### 使用自定义字体

```jsx
import localFont from 'next/font/local';

const myFont = localFont({ src: './my-font.woff2' });

export default function Home() {
  return (
    <div className={myFont.className}>
      <h1>Hello, Next.js!</h1>
    </div>
  );
}
```

在这个例子中，我们使用 `next/font/local` 来加载本地字体文件。Next.js 会自动处理字体的加载和优化。

### 2. 预加载字体

为了确保字体在页面渲染时已经加载完成，可以使用 `<link>` 标签预加载字体文件。

```html
<link
  rel="preload"
  href="/fonts/my-font.woff2"
  as="font"
  type="font/woff2"
  crossorigin
/>
```

将上述代码添加到 `_document.js` 或 `_app.js` 中，可以确保字体在页面渲染前已经加载完成。

### 3. 使用 `font-display` 属性

`font-display` 属性可以控制字体加载时的显示行为。常见的值包括：
- `auto`：默认行为，浏览器决定如何显示字体。
- `block`：字体加载完成前，文本不可见。
- `swap`：字体加载完成前，使用备用字体显示文本。
- `fallback`：在短时间内使用备用字体，如果字体未加载完成，则继续使用备用字体。
- `optional`：字体加载完成前使用备用字体，如果字体未加载完成，则继续使用备用字体。

```css
@font-face {
  font-family: 'MyFont';
  src: url('/fonts/my-font.woff2') format('woff2');
  font-display: swap;
}
```

通过设置 `font-display: swap;`，可以在字体加载完成前使用备用字体，减少布局抖动。

## 实际案例

假设我们正在开发一个博客网站，使用了 Google Fonts 中的 `Roboto` 字体。为了优化字体加载，我们可以使用 `next/font` 模块：

```jsx
import { Roboto } from 'next/font/google';

const roboto = Roboto({
  weight: '400',
  subsets: ['latin'],
});

export default function Blog() {
  return (
    <div className={roboto.className}>
      <h1>Welcome to My Blog</h1>
      <p>This is a sample blog post.</p>
    </div>
  );
}
```

通过这种方式，Next.js 会自动优化 `Roboto` 字体的加载，确保页面性能和用户体验。

## 总结

Next.js 提供了多种优化字体加载的方法，包括使用 `next/font` 模块、预加载字体以及设置 `font-display` 属性。通过这些方法，可以有效减少页面加载时间、避免布局抖动，并提升首屏内容显示的一致性。

:::tip
在实际项目中，建议优先使用 `next/font` 模块，因为它提供了开箱即用的字体优化功能，并且与 Next.js 深度集成。
:::

## 附加资源

- [Next.js 官方文档 - 字体优化](https://nextjs.org/docs/basic-features/font-optimization)
- [Google Fonts](https://fonts.google.com/)
- [MDN Web Docs - font-display](https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display)

## 练习

1. 在你的 Next.js 项目中使用 `next/font` 模块加载 Google Fonts 中的 `Open Sans` 字体。
2. 尝试使用 `font-display: swap;` 优化自定义字体的加载行为。
3. 在 `_document.js` 中添加预加载字体文件的代码，观察页面加载性能的变化。

通过以上练习，你将更好地掌握 Next.js 中的字体优化技巧。