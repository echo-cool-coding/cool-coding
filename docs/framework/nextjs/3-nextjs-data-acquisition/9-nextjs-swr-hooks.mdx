---
title: Next.js SWR 钩子
description: "学习如何在 Next.js 中使用 SWR 钩子进行数据获取，掌握其核心概念、实际应用场景以及最佳实践。"
---

# Next.js SWR 钩子

在现代 Web 开发中，数据获取是一个至关重要的部分。Next.js 提供了多种数据获取方式，而 SWR（Stale-While-Revalidate）钩子是一种强大且灵活的工具，能够帮助开发者高效地管理数据获取和缓存。本文将详细介绍 SWR 钩子的概念、使用方法以及实际应用场景。

## 什么是 SWR 钩子？

SWR 是一个由 Vercel 团队开发的 React 钩子库，专门用于数据获取。其名称 "SWR" 来源于 HTTP 缓存策略中的 "Stale-While-Revalidate" 概念，即在返回缓存数据的同时，后台重新验证数据的有效性。这种方式能够显著提升应用的性能和用户体验。

SWR 的核心优势在于：
- **自动缓存**：SWR 会自动缓存数据，减少重复请求。
- **实时更新**：当数据发生变化时，SWR 会自动更新 UI。
- **错误处理**：内置错误处理机制，简化开发流程。
- **轻量级**：SWR 非常轻量，易于集成到现有项目中。

## 安装 SWR

在开始使用 SWR 之前，首先需要安装它。你可以通过以下命令安装 SWR：

```bash
npm install swr
```

或者使用 Yarn：

```bash
yarn add swr
```

## 基本用法

SWR 的基本用法非常简单。以下是一个简单的示例，展示了如何使用 SWR 获取数据：

```jsx
import useSWR from 'swr';

const fetcher = (url) => fetch(url).then((res) => res.json());

function Profile() {
  const { data, error } = useSWR('/api/user', fetcher);

  if (error) return <div>Failed to load</div>;
  if (!data) return <div>Loading...</div>;

  return <div>Hello, {data.name}!</div>;
}
```

在这个示例中，`useSWR` 钩子接受两个参数：
1. **key**：数据的唯一标识符，通常是 API 的 URL。
2. **fetcher**：一个用于获取数据的函数，通常是一个简单的 `fetch` 封装。

`useSWR` 返回两个值：
- **data**：获取到的数据。
- **error**：如果请求失败，返回的错误信息。

## 实际应用场景

### 1. 实时数据更新

SWR 非常适合用于需要实时更新的场景。例如，在一个社交媒体应用中，用户可以实时查看新的点赞或评论。以下是一个简单的示例：

```jsx
function Likes({ postId }) {
  const { data, error } = useSWR(`/api/posts/${postId}/likes`, fetcher, {
    refreshInterval: 1000, // 每秒刷新一次
  });

  if (error) return <div>Failed to load likes</div>;
  if (!data) return <div>Loading likes...</div>;

  return <div>{data.likes} likes</div>;
}
```

在这个示例中，`refreshInterval` 选项设置为 1000 毫秒，意味着每秒钟都会重新获取数据并更新 UI。

### 2. 依赖数据获取

有时，数据的获取可能依赖于其他数据。SWR 允许你根据条件获取数据。例如：

```jsx
function UserProfile({ userId }) {
  const { data: user } = useSWR(`/api/users/${userId}`, fetcher);
  const { data: posts } = useSWR(() => `/api/users/${user.id}/posts`, fetcher);

  if (!user) return <div>Loading user...</div>;
  if (!posts) return <div>Loading posts...</div>;

  return (
    <div>
      <h1>{user.name}</h1>
      <ul>
        {posts.map((post) => (
          <li key={post.id}>{post.title}</li>
        ))}
      </ul>
    </div>
  );
}
```

在这个示例中，`posts` 的获取依赖于 `user` 数据。只有当 `user` 数据加载完成后，才会开始获取 `posts`。

## 总结

SWR 是一个功能强大且易于使用的数据获取工具，特别适合在 Next.js 项目中使用。通过自动缓存、实时更新和错误处理等特性，SWR 能够显著提升应用的性能和开发效率。

:::tip
如果你对 SWR 感兴趣，可以访问 [SWR 官方文档](https://swr.vercel.app/) 获取更多信息和高级用法。
:::

## 附加资源与练习

1. **练习**：尝试在一个 Next.js 项目中使用 SWR 获取并显示用户列表。
2. **资源**：阅读 [SWR GitHub 仓库](https://github.com/vercel/swr) 中的示例和文档，深入了解其高级功能。
3. **挑战**：实现一个带有分页功能的数据列表，并使用 SWR 进行数据获取和缓存管理。

通过本文的学习，你应该已经掌握了 SWR 的基本用法，并能够在实际项目中应用它。继续探索和实践，你将能够更加熟练地使用 SWR 来提升你的 Next.js 应用。