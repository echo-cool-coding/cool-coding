---
title: Next.js API 路由
description: "了解如何在 Next.js 中创建和使用 API 路由，为你的应用提供后端功能。"
---

# Next.js API 路由

Next.js 不仅是一个强大的前端框架，还提供了内置的 API 路由功能，允许你在同一个项目中创建后端 API。这使得开发全栈应用变得更加简单和高效。本文将带你了解 Next.js API 路由的基本概念、使用方法以及实际应用场景。

## 什么是 API 路由？

API 路由是 Next.js 提供的一种功能，允许你在 `pages/api` 目录下创建 API 端点。这些端点可以直接处理 HTTP 请求（如 GET、POST 等），并返回 JSON 数据或其他响应。通过这种方式，你可以在 Next.js 应用中轻松实现后端逻辑，而无需单独设置一个后端服务器。

## 创建你的第一个 API 路由

让我们从一个简单的例子开始。假设你想创建一个返回当前时间的 API 端点。

1. 在 `pages/api` 目录下创建一个新文件，例如 `time.js`。
2. 在该文件中编写以下代码：

```javascript
export default function handler(req, res) {
  const currentTime = new Date().toLocaleTimeString();
  res.status(200).json({ time: currentTime });
}
```

3. 现在，你可以通过访问 `/api/time` 来调用这个 API 端点。例如，在浏览器中打开 `http://localhost:3000/api/time`，你会看到类似以下的 JSON 响应：

```json
{
  "time": "14:35:22"
}
```

### 代码解析

- `handler` 函数是 API 路由的核心。它接收两个参数：`req`（请求对象）和 `res`（响应对象）。
- `req` 对象包含客户端发送的请求信息，如请求方法、请求头等。
- `res` 对象用于向客户端发送响应。在这个例子中，我们使用 `res.status(200).json()` 返回一个包含当前时间的 JSON 对象。

## 处理不同的 HTTP 方法

在实际应用中，你可能需要处理不同的 HTTP 方法（如 GET、POST 等）。Next.js API 路由允许你根据请求方法执行不同的逻辑。

```javascript
export default function handler(req, res) {
  if (req.method === 'GET') {
    // 处理 GET 请求
    res.status(200).json({ message: '这是一个 GET 请求' });
  } else if (req.method === 'POST') {
    // 处理 POST 请求
    res.status(200).json({ message: '这是一个 POST 请求' });
  } else {
    // 处理其他请求方法
    res.status(405).json({ message: '方法不允许' });
  }
}
```

### 代码解析

- 我们使用 `req.method` 来检查请求的方法。
- 根据不同的方法，我们返回不同的响应。
- 如果请求方法不被支持，我们返回 `405 Method Not Allowed` 状态码。

## 实际应用场景

### 用户注册 API

假设你正在开发一个用户注册功能。你可以创建一个 API 路由来处理用户注册请求。

```javascript
export default async function handler(req, res) {
  if (req.method === 'POST') {
    const { username, password } = req.body;

    // 在这里添加用户注册逻辑，例如将用户数据保存到数据库
    // 假设我们有一个 saveUser 函数
    const user = await saveUser(username, password);

    res.status(201).json({ message: '用户注册成功', user });
  } else {
    res.status(405).json({ message: '方法不允许' });
  }
}
```

### 代码解析

- 我们检查请求方法是否为 `POST`。
- 从 `req.body` 中提取用户名和密码。
- 调用 `saveUser` 函数（假设已定义）将用户数据保存到数据库。
- 返回 `201 Created` 状态码和成功消息。

## 总结

Next.js API 路由为开发者提供了一个简单而强大的方式来创建后端 API。通过将 API 路由与前端页面结合，你可以轻松构建全栈应用。本文介绍了如何创建基本的 API 路由、处理不同的 HTTP 方法以及在实际应用中使用 API 路由。

## 附加资源与练习

- **练习 1**: 创建一个 API 路由，返回一个随机数。
- **练习 2**: 扩展用户注册 API，添加输入验证功能。
- **进一步阅读**: [Next.js 官方文档 - API 路由](https://nextjs.org/docs/api-routes/introduction)

:::tip
在开发过程中，记得使用 `console.log` 来调试你的 API 路由，确保它们按预期工作。
:::

:::caution
确保在生产环境中正确处理错误，并返回适当的 HTTP 状态码。
:::