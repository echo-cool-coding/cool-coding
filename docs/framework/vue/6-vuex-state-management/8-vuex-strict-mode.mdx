---
title: Vuex严格模式
description: 了解Vuex中的严格模式，如何启用它，以及它在开发过程中如何帮助你捕获状态变更中的错误。
---

# Vuex严格模式

Vuex 是 Vue.js 应用程序的状态管理库，它帮助我们在复杂的应用程序中更好地管理和共享状态。Vuex 提供了一个称为**严格模式**的功能，它可以帮助开发者在开发过程中捕获不正确的状态变更。本文将详细介绍 Vuex 严格模式的概念、如何启用它，以及它在实际开发中的应用。

## 什么是 Vuex 严格模式？

Vuex 严格模式是一种开发工具，它会在状态变更不是由 mutation 函数引起时抛出错误。在 Vuex 中，状态的变更必须通过提交 mutation 来完成，这是 Vuex 的核心原则之一。严格模式确保所有的状态变更都遵循这一原则，从而避免在开发过程中出现意外的状态变更。

### 为什么需要严格模式？

在大型应用程序中，状态管理可能会变得非常复杂。如果没有严格的控制，开发者可能会在不经意间直接修改状态，这会导致难以追踪的 bug。严格模式通过强制所有状态变更都通过 mutation 来完成，帮助开发者更容易地调试和维护代码。

## 如何启用严格模式？

在 Vuex 中启用严格模式非常简单。你只需要在创建 Vuex store 时将 `strict` 选项设置为 `true` 即可。

```javascript
const store = new Vuex.Store({
  state: {
    count: 0
  },
  mutations: {
    increment(state) {
      state.count++
    }
  },
  strict: true // 启用严格模式
})
```

### 严格模式的行为

当严格模式启用时，Vuex 会监控所有的状态变更。如果状态变更不是由 mutation 引起的，Vuex 会抛出一个错误。例如，以下代码会触发严格模式的错误：

```javascript
store.state.count = 10 // 直接修改状态，会抛出错误
```

正确的做法是通过提交 mutation 来修改状态：

```javascript
store.commit('increment') // 通过 mutation 修改状态，不会抛出错误
```

## 严格模式的性能影响

严格模式会对性能产生一定的影响，因为它需要监控所有的状态变更。因此，建议**仅在开发环境中启用严格模式**，在生产环境中禁用它。

你可以通过环境变量来控制严格模式的启用和禁用：

```javascript
const store = new Vuex.Store({
  state: {
    count: 0
  },
  mutations: {
    increment(state) {
      state.count++
    }
  },
  strict: process.env.NODE_ENV !== 'production' // 仅在开发环境中启用严格模式
})
```

## 实际应用场景

假设你正在开发一个购物车应用程序，用户可以将商品添加到购物车中。你可能会有一个 `cart` 状态来存储购物车中的商品列表。在严格模式下，如果你尝试直接修改 `cart` 状态，Vuex 会抛出错误，提醒你通过 mutation 来修改状态。

```javascript
const store = new Vuex.Store({
  state: {
    cart: []
  },
  mutations: {
    addToCart(state, product) {
      state.cart.push(product)
    }
  },
  strict: true
})

// 错误的做法
store.state.cart.push({ id: 1, name: 'Product A' }) // 会抛出错误

// 正确的做法
store.commit('addToCart', { id: 1, name: 'Product A' }) // 不会抛出错误
```

## 总结

Vuex 严格模式是一个强大的开发工具，它帮助开发者在开发过程中捕获不正确的状态变更。通过强制所有状态变更都通过 mutation 来完成，严格模式确保了状态管理的可预测性和可维护性。然而，由于严格模式会对性能产生一定的影响，建议仅在开发环境中启用它。

### 附加资源

- [Vuex 官方文档](https://vuex.vuejs.org/)
- [Vue.js 官方文档](https://vuejs.org/)
- [Vuex 严格模式示例代码](https://github.com/vuejs/vuex/tree/dev/examples)

### 练习

1. 在你的 Vuex store 中启用严格模式，并尝试直接修改状态，观察 Vuex 的行为。
2. 修改你的代码，确保所有的状态变更都通过 mutation 来完成。
3. 尝试在生产环境中禁用严格模式，并观察性能的变化。
