---
title: Vue.jsprovide 和 inject
description: "了解 Vue.js 中的 provide 和 inject，掌握如何在组件树中跨层级传递数据。"
---

在 Vue.js 中，`provide` 和 `inject` 是一对用于在组件树中跨层级传递数据的 API。它们特别适用于在深层嵌套的组件之间共享数据，而无需通过 props 逐层传递。

## 什么是 provide 和 inject？

`provide` 和 `inject` 是 Vue.js 提供的一种依赖注入机制。通过 `provide`，父组件可以向其所有子组件提供数据或方法，而子组件可以通过 `inject` 来接收这些数据或方法。这种方式避免了通过 props 逐层传递数据的繁琐。

### 基本用法

#### 1. 使用 `provide` 提供数据

在父组件中，你可以使用 `provide` 来提供数据。`provide` 可以是一个对象或一个返回对象的函数。

```javascript
// ParentComponent.vue
<script setup>
import { provide } from 'vue';

provide('message', 'Hello from Parent!');
</script>
```

#### 2. 使用 `inject` 注入数据

在子组件中，你可以使用 `inject` 来接收父组件提供的数据。

```javascript
// ChildComponent.vue
<script setup>
import { inject } from 'vue';

const message = inject('message');
</script>

<template>
  <p>{{ message }}</p>
</template>
```

在这个例子中，`ChildComponent` 会显示 `Hello from Parent!`。

### 实际应用场景

假设你正在构建一个多层级表单，其中包含多个嵌套的输入组件。你希望在顶层组件中管理表单的状态，并在深层嵌套的输入组件中访问和更新这些状态。

#### 示例：多层级表单

```javascript
// FormComponent.vue
<script setup>
import { provide, ref } from 'vue';

const formData = ref({
  username: '',
  email: '',
});

provide('formData', formData);
</script>

<template>
  <div>
    <InputComponent />
  </div>
</template>
```

```javascript
// InputComponent.vue
<script setup>
import { inject } from 'vue';

const formData = inject('formData');
</script>

<template>
  <div>
    <input v-model="formData.username" placeholder="Username" />
    <input v-model="formData.email" placeholder="Email" />
  </div>
</template>
```

在这个例子中，`FormComponent` 提供了 `formData`，而 `InputComponent` 通过 `inject` 接收并绑定了 `formData`。

### 注意事项

:::caution
1. **响应性**：`provide` 和 `inject` 默认不是响应式的。如果你希望提供的数据是响应式的，可以使用 `ref` 或 `reactive`。
2. **命名冲突**：确保 `provide` 和 `inject` 的键名是唯一的，以避免命名冲突。
:::

### 总结

`provide` 和 `inject` 是 Vue.js 中非常强大的工具，特别适用于在深层嵌套的组件之间共享数据。通过 `provide`，父组件可以向其所有子组件提供数据或方法，而子组件可以通过 `inject` 来接收这些数据或方法。这种方式避免了通过 props 逐层传递数据的繁琐，使得代码更加简洁和易于维护。

### 附加资源

- [Vue.js 官方文档 - provide / inject](https://vuejs.org/guide/components/provide-inject.html)
- [Vue.js 组合式 API 指南](https://vuejs.org/guide/composition-api-introduction.html)

### 练习

1. 创建一个包含三层嵌套组件的 Vue 应用，使用 `provide` 和 `inject` 在顶层组件中管理一个计数器状态，并在最底层的组件中显示和更新该计数器。
2. 尝试在 `provide` 中提供一个方法，并在子组件中通过 `inject` 调用该方法。

通过以上练习，你将更深入地理解 `provide` 和 `inject` 的使用场景和优势。