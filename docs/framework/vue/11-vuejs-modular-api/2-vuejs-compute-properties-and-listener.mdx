---
title: Vue.js计算属性与侦听器
description: 了解 Vue.js 中的计算属性和侦听器，掌握如何高效地处理响应式数据的变化。
---

# Vue.js计算属性与侦听器

在 Vue.js 中，计算属性（Computed Properties）和侦听器（Watchers）是处理响应式数据的两种重要方式。它们可以帮助我们更高效地管理和响应数据的变化。本文将详细介绍这两种机制，并通过实际案例展示它们的应用场景。

## 计算属性

计算属性是基于 Vue 实例的响应式数据进行计算的属性。它们的值会被缓存，只有在依赖的响应式数据发生变化时才会重新计算。这使得计算属性非常适合处理复杂的逻辑或需要频繁计算的数据。

### 基本用法

以下是一个简单的计算属性示例：

```javascript
<template>
  <div>
    <p>原始消息: {{ message }}</p>
    <p>反转后的消息: {{ reversedMessage }}</p>
  </div>
</template>

<script>
export default {
  data() {
    return {
      message: 'Hello Vue!'
    };
  },
  computed: {
    reversedMessage() {
      return this.message.split('').reverse().join('');
    }
  }
};
</script>
```

在这个例子中，`reversedMessage` 是一个计算属性，它依赖于 `message`。每当 `message` 发生变化时，`reversedMessage` 会自动更新。

### 计算属性的缓存

计算属性的一个重要特性是它们的值会被缓存。这意味着，只要依赖的响应式数据没有变化，多次访问计算属性时不会重新计算，而是直接返回缓存的值。

```javascript
<template>
  <div>
    <p>计算属性值: {{ computedValue }}</p>
    <p>方法返回值: {{ methodValue() }}</p>
  </div>
</template>

<script>
export default {
  data() {
    return {
      count: 0
    };
  },
  computed: {
    computedValue() {
      console.log('计算属性被调用');
      return this.count * 2;
    }
  },
  methods: {
    methodValue() {
      console.log('方法被调用');
      return this.count * 2;
    }
  }
};
</script>
```

在这个例子中，`computedValue` 是一个计算属性，而 `methodValue` 是一个方法。每次访问 `computedValue` 时，只有在 `count` 发生变化时才会重新计算，而每次访问 `methodValue` 时都会重新执行。

## 侦听器

侦听器用于观察和响应 Vue 实例上的数据变化。当需要在数据变化时执行异步或开销较大的操作时，侦听器非常有用。

### 基本用法

以下是一个简单的侦听器示例：

```javascript
<template>
  <div>
    <p>问题: {{ question }}</p>
    <p>答案: {{ answer }}</p>
  </div>
</template>

<script>
export default {
  data() {
    return {
      question: '',
      answer: '请提出问题'
    };
  },
  watch: {
    question(newQuestion, oldQuestion) {
      if (newQuestion.includes('?')) {
        this.getAnswer();
      }
    }
  },
  methods: {
    getAnswer() {
      this.answer = '思考中...';
      setTimeout(() => {
        this.answer = '答案是 42';
      }, 1000);
    }
  }
};
</script>
```

在这个例子中，`question` 是一个被侦听的属性。每当 `question` 发生变化时，侦听器会检查新值是否包含问号，如果包含，则调用 `getAnswer` 方法。

### 深度侦听

默认情况下，侦听器只在被侦听的属性本身发生变化时触发。如果需要在嵌套对象或数组发生变化时触发侦听器，可以使用深度侦听。

```javascript
<template>
  <div>
    <p>用户信息: {{ user }}</p>
  </div>
</template>

<script>
export default {
  data() {
    return {
      user: {
        name: 'John',
        age: 30
      }
    };
  },
  watch: {
    user: {
      handler(newVal, oldVal) {
        console.log('用户信息发生变化');
      },
      deep: true
    }
  }
};
</script>
```

在这个例子中，`user` 对象的任何属性发生变化时，侦听器都会触发。

## 实际案例

### 案例 1：表单验证

假设我们有一个表单，需要在用户输入时实时验证输入内容。我们可以使用计算属性和侦听器来实现这一功能。

```javascript
<template>
  <div>
    <input v-model="email" placeholder="请输入邮箱" />
    <p v-if="!isEmailValid">邮箱格式不正确</p>
  </div>
</template>

<script>
export default {
  data() {
    return {
      email: ''
    };
  },
  computed: {
    isEmailValid() {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(this.email);
    }
  },
  watch: {
    email(newEmail) {
      if (!this.isEmailValid) {
        console.log('邮箱格式不正确');
      }
    }
  }
};
</script>
```

在这个例子中，`isEmailValid` 是一个计算属性，用于验证邮箱格式。`email` 是一个被侦听的属性，当邮箱格式不正确时，侦听器会输出警告信息。

### 案例 2：数据过滤

假设我们有一个商品列表，需要根据用户输入的关键字进行过滤。我们可以使用计算属性来实现这一功能。

```javascript
<template>
  <div>
    <input v-model="keyword" placeholder="请输入关键字" />
    <ul>
      <li v-for="product in filteredProducts" :key="product.id">
        {{ product.name }}
      </li>
    </ul>
  </div>
</template>

<script>
export default {
  data() {
    return {
      keyword: '',
      products: [
        { id: 1, name: '苹果' },
        { id: 2, name: '香蕉' },
        { id: 3, name: '橙子' }
      ]
    };
  },
  computed: {
    filteredProducts() {
      return this.products.filter(product =>
        product.name.includes(this.keyword)
      );
    }
  }
};
</script>
```

在这个例子中，`filteredProducts` 是一个计算属性，用于根据关键字过滤商品列表。

## 总结

计算属性和侦听器是 Vue.js 中处理响应式数据的两种重要方式。计算属性适合处理需要频繁计算的逻辑，并且具有缓存机制；侦听器适合在数据变化时执行异步或开销较大的操作。通过合理使用这两种机制，可以更高效地管理和响应数据的变化。

## 附加资源与练习

- [Vue.js 官方文档 - 计算属性和侦听器](https://v3.vuejs.org/guide/computed.html)
- 练习：尝试在 Vue.js 项目中实现一个实时搜索功能，使用计算属性过滤列表，并使用侦听器记录用户搜索历史。

:::tip
提示：在实际开发中，尽量使用计算属性来处理需要频繁计算的逻辑，而将侦听器用于处理异步操作或复杂的数据变化。
:::