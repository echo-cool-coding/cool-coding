---
title: Android SharedPreferences
description: "了解如何使用 Android 的 SharedPreferences 来存储和读取简单的键值对数据。本指南适合初学者，包含代码示例和实际应用场景。"
---

# Android SharedPreferences

在 Android 开发中，数据存储是一个非常重要的部分。SharedPreferences 是 Android 提供的一种轻量级的数据存储方式，用于存储简单的键值对数据。它非常适合存储用户偏好设置、应用配置等小规模数据。

## 什么是 SharedPreferences？

SharedPreferences 是一个接口，允许你以键值对的形式存储和读取数据。这些数据会持久化存储在设备的文件系统中，即使应用关闭或设备重启，数据也不会丢失。SharedPreferences 通常用于存储少量的简单数据，例如用户设置、应用状态等。

:::note
SharedPreferences 不适合存储大量数据或复杂数据结构。对于更复杂的数据存储需求，建议使用 SQLite 数据库或 Room 库。
:::

## 如何使用 SharedPreferences？

### 1. 获取 SharedPreferences 对象

要使用 SharedPreferences，首先需要获取一个 SharedPreferences 对象。你可以通过 `Context` 的 `getSharedPreferences()` 方法来获取：

```java
SharedPreferences sharedPreferences = getSharedPreferences("MyPrefs", Context.MODE_PRIVATE);
```

- `"MyPrefs"` 是 SharedPreferences 文件的名称。
- `Context.MODE_PRIVATE` 表示该文件只能被当前应用访问。

### 2. 写入数据

要向 SharedPreferences 中写入数据，需要使用 `SharedPreferences.Editor` 对象。以下是一个示例，展示如何存储一个字符串和一个整数：

```java
SharedPreferences.Editor editor = sharedPreferences.edit();
editor.putString("username", "JohnDoe");
editor.putInt("age", 25);
editor.apply(); // 或者使用 editor.commit();
```

- `putString()` 和 `putInt()` 用于存储字符串和整数。
- `apply()` 是异步的，会立即返回并将更改写入磁盘。`commit()` 是同步的，会阻塞当前线程直到写入完成。

### 3. 读取数据

要从 SharedPreferences 中读取数据，可以直接调用相应的方法：

```java
String username = sharedPreferences.getString("username", "defaultUsername");
int age = sharedPreferences.getInt("age", 0);
```

- `getString()` 和 `getInt()` 用于读取字符串和整数。
- 第二个参数是默认值，如果指定的键不存在，则返回该默认值。

### 4. 删除数据

如果你需要删除某个键值对，可以使用 `SharedPreferences.Editor` 的 `remove()` 方法：

```java
editor.remove("username");
editor.apply();
```

### 5. 清除所有数据

要清除 SharedPreferences 中的所有数据，可以使用 `clear()` 方法：

```java
editor.clear();
editor.apply();
```

## 实际应用场景

### 场景 1：保存用户登录状态

假设你有一个应用，用户登录后需要保存用户的登录状态。你可以使用 SharedPreferences 来存储用户的登录信息：

```java
SharedPreferences sharedPreferences = getSharedPreferences("UserPrefs", Context.MODE_PRIVATE);
SharedPreferences.Editor editor = sharedPreferences.edit();
editor.putBoolean("isLoggedIn", true);
editor.putString("userId", "12345");
editor.apply();
```

当用户再次打开应用时，你可以检查 SharedPreferences 来判断用户是否已经登录：

```java
boolean isLoggedIn = sharedPreferences.getBoolean("isLoggedIn", false);
String userId = sharedPreferences.getString("userId", "");
```

### 场景 2：保存用户偏好设置

假设你有一个应用，允许用户选择主题（亮色或暗色）。你可以使用 SharedPreferences 来保存用户的选择：

```java
SharedPreferences sharedPreferences = getSharedPreferences("AppSettings", Context.MODE_PRIVATE);
SharedPreferences.Editor editor = sharedPreferences.edit();
editor.putString("theme", "dark");
editor.apply();
```

在应用启动时，你可以读取用户的主题设置并应用：

```java
String theme = sharedPreferences.getString("theme", "light");
if (theme.equals("dark")) {
    // 应用暗色主题
} else {
    // 应用亮色主题
}
```

## 总结

SharedPreferences 是 Android 中一种简单而强大的数据存储方式，适合存储少量的键值对数据。通过 SharedPreferences，你可以轻松地保存和读取用户偏好设置、应用状态等信息。虽然它不适合存储大量数据，但在许多场景下，SharedPreferences 都是一个非常实用的工具。

:::tip
如果你需要存储更复杂的数据结构，或者需要更高的性能，可以考虑使用 SQLite 数据库或 Room 库。
:::

## 附加资源

- [Android 官方文档 - SharedPreferences](https://developer.android.com/reference/android/content/SharedPreferences)
- [Android 数据存储指南](https://developer.android.com/guide/topics/data/data-storage)

## 练习

1. 创建一个简单的 Android 应用，使用 SharedPreferences 保存用户的姓名和年龄，并在应用启动时显示这些信息。
2. 修改上面的应用，添加一个功能，允许用户清除所有保存的数据。
3. 尝试使用 SharedPreferences 保存一个布尔值，表示用户是否同意隐私政策，并在应用启动时检查该值。

通过完成这些练习，你将更好地理解 SharedPreferences 的使用方法，并能够在实际项目中应用它。