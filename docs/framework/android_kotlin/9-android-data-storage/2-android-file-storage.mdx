---
title: Android文件存储
description: 了解Android文件存储的基本概念、使用方法以及实际应用场景，适合初学者学习。
---

# Android文件存储

在Android开发中，文件存储是一种常见的数据持久化方式。它允许开发者将数据以文件的形式存储在设备的内部或外部存储中。文件存储适用于保存非结构化数据，例如文本文件、图片、音频等。本文将详细介绍Android文件存储的基本概念、使用方法以及实际应用场景。

## 1. 什么是Android文件存储？

Android文件存储是指将数据以文件的形式存储在设备的内部或外部存储中。Android提供了两种主要的文件存储方式：

- **内部存储**：存储在应用的私有目录中，其他应用无法访问。
- **外部存储**：存储在设备的共享存储中，其他应用可以访问（需要权限）。

:::note
内部存储的文件在应用卸载时会被删除，而外部存储的文件则不会。
:::

## 2. 内部存储

### 2.1 写入文件到内部存储

要将数据写入内部存储，可以使用`Context`类的`openFileOutput()`方法。以下是一个简单的示例：

```java
String filename = "myfile.txt";
String fileContents = "Hello, Android File Storage!";
try (FileOutputStream fos = openFileOutput(filename, Context.MODE_PRIVATE)) {
    fos.write(fileContents.getBytes());
} catch (IOException e) {
    e.printStackTrace();
}
```

### 2.2 从内部存储读取文件

要从内部存储读取文件，可以使用`Context`类的`openFileInput()`方法。以下是一个简单的示例：

```java
String filename = "myfile.txt";
StringBuilder stringBuilder = new StringBuilder();
try (FileInputStream fis = openFileInput(filename)) {
    InputStreamReader inputStreamReader = new InputStreamReader(fis);
    BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
    String line;
    while ((line = bufferedReader.readLine()) != null) {
        stringBuilder.append(line);
    }
} catch (IOException e) {
    e.printStackTrace();
}
String fileContents = stringBuilder.toString();
```

:::tip
`MODE_PRIVATE`表示文件只能被当前应用访问。如果需要与其他应用共享文件，可以使用`MODE_WORLD_READABLE`或`MODE_WORLD_WRITEABLE`，但这些模式在Android 7.0及以上版本中已被弃用。
:::

## 3. 外部存储

### 3.1 检查外部存储可用性

在访问外部存储之前，需要检查外部存储是否可用：

```java
boolean isExternalStorageWritable() {
    String state = Environment.getExternalStorageState();
    return Environment.MEDIA_MOUNTED.equals(state);
}
```

### 3.2 写入文件到外部存储

要将数据写入外部存储，可以使用`Environment.getExternalStorageDirectory()`方法获取外部存储的根目录。以下是一个简单的示例：

```java
String filename = "myfile.txt";
String fileContents = "Hello, External Storage!";
File file = new File(Environment.getExternalStorageDirectory(), filename);
try (FileOutputStream fos = new FileOutputStream(file)) {
    fos.write(fileContents.getBytes());
} catch (IOException e) {
    e.printStackTrace();
}
```

:::caution
从Android 10（API级别29）开始，访问外部存储需要请求`MANAGE_EXTERNAL_STORAGE`权限，并且需要遵循Scoped Storage的规则。
:::

### 3.3 从外部存储读取文件

要从外部存储读取文件，可以使用以下代码：

```java
String filename = "myfile.txt";
File file = new File(Environment.getExternalStorageDirectory(), filename);
StringBuilder stringBuilder = new StringBuilder();
try (FileInputStream fis = new FileInputStream(file)) {
    InputStreamReader inputStreamReader = new InputStreamReader(fis);
    BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
    String line;
    while ((line = bufferedReader.readLine()) != null) {
        stringBuilder.append(line);
    }
} catch (IOException e) {
    e.printStackTrace();
}
String fileContents = stringBuilder.toString();
```

## 4. 实际应用场景

### 4.1 保存用户设置

文件存储可以用于保存用户的设置或配置信息。例如，保存用户的偏好设置到内部存储中：

```java
String filename = "user_settings.txt";
String settings = "theme=dark,language=en";
try (FileOutputStream fos = openFileOutput(filename, Context.MODE_PRIVATE)) {
    fos.write(settings.getBytes());
} catch (IOException e) {
    e.printStackTrace();
}
```

### 4.2 缓存数据

文件存储还可以用于缓存数据，以提高应用的性能。例如，缓存网络请求的结果到内部存储中：

```java
String filename = "cached_data.txt";
String cachedData = "Cached data from network";
try (FileOutputStream fos = openFileOutput(filename, Context.MODE_PRIVATE)) {
    fos.write(cachedData.getBytes());
} catch (IOException e) {
    e.printStackTrace();
}
```

## 5. 总结

Android文件存储是一种简单而有效的数据持久化方式，适用于保存非结构化数据。通过内部存储和外部存储，开发者可以根据需求选择合适的方式来存储和读取文件。在实际开发中，文件存储常用于保存用户设置、缓存数据等场景。

:::warning
在访问外部存储时，务必检查存储的可用性，并遵循Android的权限和存储规则。
:::

## 6. 附加资源与练习

- **练习**：尝试创建一个简单的记事本应用，允许用户将文本保存到内部存储中，并在应用重新启动时加载已保存的文本。
- **资源**：
  - [Android官方文档：数据存储](https://developer.android.com/training/data-storage)
  - [Android Scoped Storage指南](https://developer.android.com/training/data-storage#scoped-storage)

通过本文的学习，你应该已经掌握了Android文件存储的基本概念和使用方法。继续练习和探索，你将能够更好地应用这些知识到实际开发中。