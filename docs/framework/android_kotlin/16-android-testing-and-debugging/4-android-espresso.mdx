---
title: Android Espresso
description: "了解如何使用 Android Espresso 进行 UI 测试，掌握编写可靠且高效的自动化测试用例的技巧。"
---

# Android Espresso

## 介绍

Android Espresso 是 Google 提供的一个用于编写 Android UI 测试的强大框架。它允许开发者以简洁的方式编写自动化测试用例，确保应用程序的用户界面在各种场景下都能正常工作。Espresso 的设计目标是让测试代码更易读、更易维护，同时提供高效的测试执行。

Espresso 的核心思想是模拟用户与应用程序的交互，例如点击按钮、输入文本、滑动屏幕等。通过这种方式，开发者可以验证应用程序的 UI 行为是否符合预期。

## 为什么使用 Espresso？

- **简洁易用**：Espresso 的 API 设计非常直观，适合初学者快速上手。
- **高效执行**：Espresso 会自动同步测试操作与 UI 线程，确保测试的稳定性。
- **可扩展性**：Espresso 支持自定义匹配器和操作，满足复杂测试需求。

## 安装与配置

在开始使用 Espresso 之前，需要在项目中添加相关依赖。打开 `build.gradle` 文件，添加以下依赖项：

```groovy
dependencies {
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.5.1'
    androidTestImplementation 'androidx.test:runner:1.5.2'
    androidTestImplementation 'androidx.test:rules:1.5.2'
}
```

确保在 `defaultConfig` 中指定测试运行器：

```groovy
android {
    defaultConfig {
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }
}
```

## 编写第一个 Espresso 测试

以下是一个简单的 Espresso 测试示例，假设我们有一个包含按钮和文本视图的界面，点击按钮后文本视图会显示 "Hello, Espresso!"。

```kotlin
import androidx.test.espresso.Espresso
import androidx.test.espresso.action.ViewActions
import androidx.test.espresso.assertion.ViewAssertions
import androidx.test.espresso.matcher.ViewMatchers
import androidx.test.ext.junit.rules.ActivityScenarioRule
import androidx.test.ext.junit.runners.AndroidJUnit4
import org.junit.Rule
import org.junit.Test
import org.junit.runner.RunWith

@RunWith(AndroidJUnit4::class)
class MainActivityTest {

    @get:Rule
    val activityRule = ActivityScenarioRule(MainActivity::class.java)

    @Test
    fun testButtonClick() {
        // 查找按钮并执行点击操作
        Espresso.onView(ViewMatchers.withId(R.id.button))
            .perform(ViewActions.click())

        // 验证文本视图是否显示预期的文本
        Espresso.onView(ViewMatchers.withId(R.id.textView))
            .check(ViewAssertions.matches(ViewMatchers.withText("Hello, Espresso!")))
    }
}
```

### 代码解析

1. **`ActivityScenarioRule`**：用于启动 `MainActivity`，确保测试在正确的上下文中运行。
2. **`Espresso.onView`**：查找指定的视图。
3. **`ViewActions.click()`**：模拟点击操作。
4. **`ViewAssertions.matches`**：验证视图的状态是否符合预期。

## 常用 API

### 查找视图

- **`withId`**：通过资源 ID 查找视图。
- **`withText`**：通过文本内容查找视图。
- **`withHint`**：通过提示文本查找视图。

### 执行操作

- **`click()`**：点击视图。
- **`typeText()`**：在输入框中输入文本。
- **`scrollTo()`**：滚动到指定视图。

### 验证状态

- **`matches`**：验证视图的状态是否符合预期。
- **`isDisplayed`**：验证视图是否显示。
- **`isEnabled`**：验证视图是否启用。

## 实际案例

假设我们有一个登录页面，包含用户名输入框、密码输入框和登录按钮。以下是一个测试用例，验证用户输入正确的凭据后是否可以成功登录：

```kotlin
@Test
fun testLoginSuccess() {
    // 输入用户名
    Espresso.onView(ViewMatchers.withId(R.id.username))
        .perform(ViewActions.typeText("user@example.com"))

    // 输入密码
    Espresso.onView(ViewMatchers.withId(R.id.password))
        .perform(ViewActions.typeText("password123"))

    // 点击登录按钮
    Espresso.onView(ViewMatchers.withId(R.id.loginButton))
        .perform(ViewActions.click())

    // 验证是否跳转到主页
    Espresso.onView(ViewMatchers.withId(R.id.homeScreen))
        .check(ViewAssertions.matches(ViewMatchers.isDisplayed()))
}
```

:::tip
在实际测试中，建议使用 `ViewActions.closeSoftKeyboard()` 关闭软键盘，以避免干扰测试。
:::

## 总结

Android Espresso 是一个功能强大且易于使用的 UI 测试框架，适合初学者快速上手。通过模拟用户操作并验证 UI 状态，开发者可以确保应用程序在各种场景下都能正常工作。

## 附加资源

- [Espresso 官方文档](https://developer.android.com/training/testing/espresso)
- [Android Testing Codelab](https://developer.android.com/codelabs/android-testing)

## 练习

1. 为你的应用程序编写一个 Espresso 测试，验证点击按钮后文本视图的内容是否正确更新。
2. 尝试使用 `ViewActions.scrollTo()` 测试一个需要滚动的界面。
3. 编写一个测试用例，验证输入错误凭据时是否会显示错误提示。

Happy Testing! 🚀