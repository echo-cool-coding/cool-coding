---
title: Android Mockito
description: "学习如何使用 Mockito 在 Android 中进行单元测试和模拟对象。本文适合初学者，包含代码示例和实际案例。"
---

## 介绍

在 Android 开发中，测试是确保应用程序质量的关键步骤。Mockito 是一个流行的 Java 测试框架，专门用于创建模拟对象（mock objects）。模拟对象允许你在测试中模拟依赖项的行为，从而隔离和验证代码的特定部分。

Mockito 的主要用途包括：
- 模拟依赖项的行为。
- 验证方法调用。
- 简化单元测试。

本文将逐步介绍如何在 Android 项目中使用 Mockito，并通过实际案例展示其应用。

---

## 安装 Mockito

在开始使用 Mockito 之前，你需要在项目中添加依赖项。打开 `build.gradle` 文件，并添加以下依赖：

```groovy
dependencies {
    testImplementation 'org.mockito:mockito-core:4.0.0'
    androidTestImplementation 'org.mockito:mockito-android:4.0.0'
}
```

:::note
确保你使用的是最新版本的 Mockito。你可以访问 [Mockito 官方 GitHub](https://github.com/mockito/mockito) 查看最新版本。
:::

---

## 基本用法

### 创建模拟对象

Mockito 的核心功能是创建模拟对象。以下是一个简单的示例，展示如何模拟一个 `List` 对象：

```java
import org.mockito.Mockito;
import java.util.List;

public class ExampleTest {
    public void testMockList() {
        // 创建模拟对象
        List<String> mockedList = Mockito.mock(List.class);

        // 设置模拟行为
        Mockito.when(mockedList.get(0)).thenReturn("Mockito");

        // 验证模拟行为
        System.out.println(mockedList.get(0)); // 输出: Mockito
    }
}
```

:::tip
`Mockito.mock()` 方法用于创建模拟对象。`Mockito.when()` 用于定义模拟对象的行为。
:::

### 验证方法调用

Mockito 还可以验证方法是否被调用。以下示例展示了如何验证 `add` 方法是否被调用：

```java
import org.mockito.Mockito;
import java.util.List;

public class ExampleTest {
    public void testVerifyMethodCall() {
        List<String> mockedList = Mockito.mock(List.class);

        // 调用方法
        mockedList.add("Mockito");

        // 验证方法是否被调用
        Mockito.verify(mockedList).add("Mockito");
    }
}
```

:::caution
如果 `add` 方法未被调用，`Mockito.verify()` 将抛出异常。
:::

---

## 实际案例

### 模拟网络请求

在 Android 开发中，网络请求通常是一个异步操作。为了测试依赖于网络请求的代码，我们可以使用 Mockito 模拟网络请求的行为。

以下是一个示例，展示如何模拟 Retrofit 的网络请求：

```java
import retrofit2.Call;
import retrofit2.Response;
import org.mockito.Mockito;

public class NetworkTest {
    public void testNetworkRequest() {
        // 创建模拟的 Retrofit Call 对象
        Call<String> mockedCall = Mockito.mock(Call.class);

        // 模拟成功的网络响应
        Mockito.when(mockedCall.execute()).thenReturn(Response.success("Success"));

        // 验证模拟行为
        System.out.println(mockedCall.execute().body()); // 输出: Success
    }
}
```

:::warning
在实际测试中，确保模拟的行为与真实网络请求的行为一致。
:::

---

## 总结

Mockito 是一个强大的工具，可以帮助你在 Android 开发中编写更可靠的单元测试。通过模拟对象，你可以隔离和验证代码的特定部分，而无需依赖外部系统或复杂的环境。

### 附加资源
- [Mockito 官方文档](https://site.mockito.org/)
- [Android 单元测试指南](https://developer.android.com/training/testing/unit-testing)

### 练习
1. 使用 Mockito 模拟一个 `User` 类，并验证其 `getName()` 方法的行为。
2. 尝试模拟一个 Retrofit 接口，并测试其异步回调逻辑。

Happy testing! 🚀