---
title: Android REST API 交互
description: "学习如何在 Android 应用中与 REST API 进行交互，包括发送请求、处理响应以及实际应用场景。"
---

在现代移动应用开发中，与后端服务器进行数据交互是至关重要的。REST API 是一种常见的通信方式，它允许客户端（如 Android 应用）与服务器进行数据交换。本文将带你了解如何在 Android 应用中与 REST API 进行交互。

## 什么是 REST API？

REST（Representational State Transfer）是一种基于 HTTP 协议的架构风格，用于构建网络服务。REST API 通过 HTTP 方法（如 GET、POST、PUT、DELETE）来执行 CRUD（创建、读取、更新、删除）操作。

## 准备工作

在开始之前，确保你的 Android 项目已经添加了以下依赖项：

```gradle
dependencies {
    implementation 'com.squareup.retrofit2:retrofit:2.9.0'
    implementation 'com.squareup.retrofit2:converter-gson:2.9.0'
    implementation 'com.squareup.okhttp3:okhttp:4.9.3'
}
```

这些库将帮助我们简化网络请求的处理。

## 创建 Retrofit 实例

Retrofit 是一个强大的 HTTP 客户端库，用于简化 REST API 的调用。首先，我们需要创建一个 Retrofit 实例：

```kotlin
val retrofit = Retrofit.Builder()
    .baseUrl("https://api.example.com/")
    .addConverterFactory(GsonConverterFactory.create())
    .client(OkHttpClient())
    .build()
```

- `baseUrl` 是 API 的基础 URL。
- `addConverterFactory` 用于指定数据转换器，这里我们使用 Gson 来解析 JSON 数据。
- `client` 用于指定 HTTP 客户端，这里我们使用 OkHttp。

## 定义 API 接口

接下来，我们需要定义一个接口来描述 API 的端点：

```kotlin
interface ApiService {
    @GET("users/{id}")
    suspend fun getUser(@Path("id") userId: Int): User

    @POST("users")
    suspend fun createUser(@Body user: User): Response<User>
}
```

- `@GET` 和 `@POST` 是 HTTP 方法的注解。
- `@Path` 用于替换 URL 中的路径参数。
- `@Body` 用于指定请求体。

## 发送请求

现在我们可以使用 Retrofit 实例来发送请求：

```kotlin
val apiService = retrofit.create(ApiService::class.java)

// 获取用户信息
val user = apiService.getUser(1)
println(user)

// 创建新用户
val newUser = User(name = "John Doe", email = "john@example.com")
val response = apiService.createUser(newUser)
if (response.isSuccessful) {
    println("User created successfully")
} else {
    println("Failed to create user")
}
```

## 处理响应

Retrofit 会自动将响应解析为 Kotlin 对象。你可以通过 `isSuccessful` 方法检查请求是否成功，并通过 `body` 方法获取响应体。

## 实际应用场景

假设你正在开发一个社交应用，用户可以通过 API 获取他们的好友列表。你可以使用以下代码来实现这一功能：

```kotlin
@GET("friends/{userId}")
suspend fun getFriends(@Path("userId") userId: Int): List<Friend>

val friends = apiService.getFriends(1)
friends.forEach { friend ->
    println(friend.name)
}
```

## 总结

通过本文，你学习了如何在 Android 应用中使用 Retrofit 与 REST API 进行交互。我们涵盖了创建 Retrofit 实例、定义 API 接口、发送请求以及处理响应的基本步骤。希望这些知识能帮助你在实际项目中更好地处理网络请求。

## 附加资源

- [Retrofit 官方文档](https://square.github.io/retrofit/)
- [OkHttp 官方文档](https://square.github.io/okhttp/)
- [Gson 官方文档](https://github.com/google/gson)

## 练习

1. 尝试在你的 Android 项目中实现一个简单的 API 调用，获取并显示用户信息。
2. 扩展你的应用，使其能够创建新用户并处理可能的错误情况。
