---
title: Android JSON解析
description: 学习如何在Android应用中使用JSON格式进行数据解析，掌握JSON解析的基本概念、工具和实际应用场景。
---

# Android JSON解析

在现代移动应用开发中，JSON（JavaScript Object Notation）是一种广泛使用的轻量级数据交换格式。它易于阅读和编写，同时也易于机器解析和生成。在Android开发中，JSON解析是一个非常重要的技能，尤其是在与服务器进行数据交互时。本文将带你从零开始学习如何在Android应用中进行JSON解析。

## 什么是JSON？

JSON是一种基于文本的数据格式，通常用于在客户端和服务器之间传输数据。它的结构由键值对组成，类似于Java中的`Map`或Python中的`字典`。JSON数据可以是以下几种类型：

- **对象**：用花括号 `{}` 包裹，包含多个键值对。
- **数组**：用方括号 `[]` 包裹，包含多个值。
- **字符串**：用双引号 `""` 包裹的文本。
- **数字**：整数或浮点数。
- **布尔值**：`true` 或 `false`。
- **null**：表示空值。

以下是一个简单的JSON示例：

```json
{
  "name": "John Doe",
  "age": 30,
  "isStudent": false,
  "courses": ["Math", "Science", "History"],
  "address": {
    "street": "123 Main St",
    "city": "Anytown"
  }
}
```

## 为什么在Android中使用JSON？

在Android开发中，JSON常用于以下场景：

1. **与服务器通信**：大多数RESTful API返回的数据格式都是JSON。
2. **本地数据存储**：JSON可以用于存储和读取本地数据。
3. **数据交换**：JSON格式简单，易于在不同平台之间交换数据。

## Android中的JSON解析工具

Android提供了多种工具来解析JSON数据，常用的有以下几种：

1. **`org.json`包**：Android自带的JSON解析工具，包含`JSONObject`和`JSONArray`类。
2. **Gson**：Google提供的JSON库，支持将JSON字符串转换为Java对象，反之亦然。
3. **Moshi**：Square公司开发的JSON库，类似于Gson，但更轻量级。

本文将重点介绍`org.json`包和Gson的使用。

### 使用`org.json`包解析JSON

`org.json`包是Android自带的JSON解析工具，适合处理简单的JSON数据。以下是一个使用`JSONObject`和`JSONArray`解析JSON的示例。

#### 示例：解析JSON字符串

假设我们有以下JSON字符串：

```json
{
  "name": "John Doe",
  "age": 30,
  "isStudent": false,
  "courses": ["Math", "Science", "History"],
  "address": {
    "street": "123 Main St",
    "city": "Anytown"
  }
}
```

我们可以使用以下代码来解析这个JSON字符串：

```java
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

public class JsonExample {
    public static void main(String[] args) {
        String jsonString = "{ \"name\": \"John Doe\", \"age\": 30, \"isStudent\": false, \"courses\": [\"Math\", \"Science\", \"History\"], \"address\": { \"street\": \"123 Main St\", \"city\": \"Anytown\" } }";

        try {
            JSONObject jsonObject = new JSONObject(jsonString);

            String name = jsonObject.getString("name");
            int age = jsonObject.getInt("age");
            boolean isStudent = jsonObject.getBoolean("isStudent");

            JSONArray courses = jsonObject.getJSONArray("courses");
            for (int i = 0; i < courses.length(); i++) {
                String course = courses.getString(i);
                System.out.println("Course: " + course);
            }

            JSONObject address = jsonObject.getJSONObject("address");
            String street = address.getString("street");
            String city = address.getString("city");

            System.out.println("Name: " + name);
            System.out.println("Age: " + age);
            System.out.println("Is Student: " + isStudent);
            System.out.println("Street: " + street);
            System.out.println("City: " + city);

        } catch (JSONException e) {
            e.printStackTrace();
        }
    }
}
```

#### 输出结果

```
Course: Math
Course: Science
Course: History
Name: John Doe
Age: 30
Is Student: false
Street: 123 Main St
City: Anytown
```

### 使用Gson解析JSON

Gson是Google提供的一个强大的JSON库，它可以将JSON字符串直接转换为Java对象，反之亦然。使用Gson可以大大简化JSON解析的过程。

#### 示例：使用Gson解析JSON

首先，我们需要在`build.gradle`文件中添加Gson依赖：

```groovy
dependencies {
    implementation 'com.google.code.gson:gson:2.8.9'
}
```

接下来，我们定义一个与JSON结构对应的Java类：

```java
public class User {
    private String name;
    private int age;
    private boolean isStudent;
    private List<String> courses;
    private Address address;

    // Getters and setters
    // ...

    public static class Address {
        private String street;
        private String city;

        // Getters and setters
        // ...
    }
}
```

然后，我们可以使用Gson将JSON字符串转换为Java对象：

```java
import com.google.gson.Gson;

public class GsonExample {
    public static void main(String[] args) {
        String jsonString = "{ \"name\": \"John Doe\", \"age\": 30, \"isStudent\": false, \"courses\": [\"Math\", \"Science\", \"History\"], \"address\": { \"street\": \"123 Main St\", \"city\": \"Anytown\" } }";

        Gson gson = new Gson();
        User user = gson.fromJson(jsonString, User.class);

        System.out.println("Name: " + user.getName());
        System.out.println("Age: " + user.getAge());
        System.out.println("Is Student: " + user.isStudent());
        System.out.println("Street: " + user.getAddress().getStreet());
        System.out.println("City: " + user.getAddress().getCity());
    }
}
```

#### 输出结果

```
Name: John Doe
Age: 30
Is Student: false
Street: 123 Main St
City: Anytown
```

:::tip
使用Gson时，确保Java类的字段名称与JSON中的键名一致，或者使用`@SerializedName`注解来指定映射关系。
:::

## 实际应用场景

### 场景1：从API获取JSON数据并解析

假设我们正在开发一个天气应用，需要从天气API获取JSON格式的数据并解析。以下是一个简单的示例：

```java
import org.json.JSONObject;
import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

public class WeatherApp {
    public static void main(String[] args) {
        try {
            URL url = new URL("https://api.weatherapi.com/v1/current.json?key=YOUR_API_KEY&q=London");
            HttpURLConnection connection = (HttpURLConnection) url.openConnection();
            connection.setRequestMethod("GET");

            BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream()));
            StringBuilder response = new StringBuilder();
            String line;

            while ((line = reader.readLine()) != null) {
                response.append(line);
            }
            reader.close();

            JSONObject jsonObject = new JSONObject(response.toString());
            JSONObject location = jsonObject.getJSONObject("location");
            String city = location.getString("name");
            String country = location.getString("country");

            JSONObject current = jsonObject.getJSONObject("current");
            double temperature = current.getDouble("temp_c");

            System.out.println("City: " + city);
            System.out.println("Country: " + country);
            System.out.println("Temperature: " + temperature + "°C");

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

:::caution
在实际开发中，网络请求应该在后台线程中执行，以避免阻塞主线程。可以使用`AsyncTask`或`OkHttp`等工具来处理网络请求。
:::

## 总结

在本文中，我们学习了如何在Android应用中进行JSON解析。我们介绍了JSON的基本概念，并演示了如何使用`org.json`包和Gson库来解析JSON数据。我们还通过实际应用场景展示了JSON解析在Android开发中的重要性。

## 附加资源与练习

- **练习1**：尝试使用Gson将一个Java对象转换为JSON字符串。
- **练习2**：编写一个Android应用，从API获取JSON数据并显示在UI上。
- **资源**：
  - [Gson官方文档](https://github.com/google/gson)
  - [Android JSON官方文档](https://developer.android.com/reference/org/json/package-summary)

通过不断练习和探索，你将能够熟练掌握Android中的JSON解析技术，为开发更复杂的应用打下坚实的基础。