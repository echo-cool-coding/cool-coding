---
title: Android XML解析
description: 学习如何在Android应用中使用XML解析技术，掌握DOM、SAX和Pull解析器的使用方法，并通过实际案例加深理解。
---

# Android XML解析

在Android开发中，XML（可扩展标记语言）是一种常见的数据交换格式。无论是从网络获取数据，还是解析本地配置文件，XML解析都是一项重要的技能。本文将介绍Android中常用的XML解析技术，包括DOM、SAX和Pull解析器，并通过实际案例帮助你掌握这些技术。

## 什么是XML解析？

XML解析是指将XML格式的数据转换为程序可以处理的数据结构的过程。在Android中，常见的XML解析方式有三种：

1. **DOM解析**：将整个XML文档加载到内存中，形成一个树形结构，适合处理较小的XML文件。
2. **SAX解析**：基于事件驱动的解析方式，逐行读取XML文件，适合处理较大的XML文件。
3. **Pull解析**：类似于SAX解析，但更加灵活，适合处理流式数据。

接下来，我们将逐一介绍这三种解析方式。

## DOM解析

DOM（Document Object Model）解析器将整个XML文档加载到内存中，形成一个树形结构。开发者可以通过操作树节点来获取或修改数据。

### 示例代码

以下是一个简单的DOM解析示例：

```java
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import java.io.InputStream;

public class DOMParserExample {
    public static void main(String[] args) {
        try {
            InputStream inputStream = DOMParserExample.class.getResourceAsStream("/example.xml");
            DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
            DocumentBuilder builder = factory.newDocumentBuilder();
            Document document = builder.parse(inputStream);

            Element root = document.getDocumentElement();
            NodeList nodeList = root.getChildNodes();

            for (int i = 0; i < nodeList.getLength(); i++) {
                Node node = nodeList.item(i);
                if (node.getNodeType() == Node.ELEMENT_NODE) {
                    System.out.println(node.getNodeName() + ": " + node.getTextContent());
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 输入XML

```xml
<root>
    <item>Item 1</item>
    <item>Item 2</item>
    <item>Item 3</item>
</root>
```

### 输出

```
item: Item 1
item: Item 2
item: Item 3
```

:::note
DOM解析适合处理较小的XML文件，因为它会将整个文档加载到内存中。对于较大的XML文件，可能会导致内存溢出。
:::

## SAX解析

SAX（Simple API for XML）解析器是一种基于事件驱动的解析方式。它逐行读取XML文件，并在遇到特定事件时触发回调方法。

### 示例代码

以下是一个简单的SAX解析示例：

```java
import org.xml.sax.Attributes;
import org.xml.sax.SAXException;
import org.xml.sax.helpers.DefaultHandler;

import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory;
import java.io.InputStream;

public class SAXParserExample {
    public static void main(String[] args) {
        try {
            InputStream inputStream = SAXParserExample.class.getResourceAsStream("/example.xml");
            SAXParserFactory factory = SAXParserFactory.newInstance();
            SAXParser saxParser = factory.newSAXParser();

            DefaultHandler handler = new DefaultHandler() {
                boolean itemElement = false;

                @Override
                public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException {
                    if (qName.equalsIgnoreCase("item")) {
                        itemElement = true;
                    }
                }

                @Override
                public void characters(char[] ch, int start, int length) throws SAXException {
                    if (itemElement) {
                        System.out.println("item: " + new String(ch, start, length));
                        itemElement = false;
                    }
                }
            };

            saxParser.parse(inputStream, handler);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 输入XML

```xml
<root>
    <item>Item 1</item>
    <item>Item 2</item>
    <item>Item 3</item>
</root>
```

### 输出

```
item: Item 1
item: Item 2
item: Item 3
```

:::tip
SAX解析适合处理较大的XML文件，因为它不会将整个文档加载到内存中，而是逐行读取并处理。
:::

## Pull解析

Pull解析器是Android中常用的一种解析方式，它结合了DOM和SAX的优点，既灵活又高效。

### 示例代码

以下是一个简单的Pull解析示例：

```java
import org.xmlpull.v1.XmlPullParser;
import org.xmlpull.v1.XmlPullParserFactory;

import java.io.InputStream;

public class PullParserExample {
    public static void main(String[] args) {
        try {
            InputStream inputStream = PullParserExample.class.getResourceAsStream("/example.xml");
            XmlPullParserFactory factory = XmlPullParserFactory.newInstance();
            XmlPullParser parser = factory.newPullParser();
            parser.setInput(inputStream, null);

            int eventType = parser.getEventType();
            while (eventType != XmlPullParser.END_DOCUMENT) {
                if (eventType == XmlPullParser.START_TAG && parser.getName().equalsIgnoreCase("item")) {
                    System.out.println("item: " + parser.nextText());
                }
                eventType = parser.next();
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 输入XML

```xml
<root>
    <item>Item 1</item>
    <item>Item 2</item>
    <item>Item 3</item>
</root>
```

### 输出

```
item: Item 1
item: Item 2
item: Item 3
```

:::caution
Pull解析器在处理XML时，开发者需要手动控制解析过程，因此需要更加小心地处理各种事件。
:::

## 实际案例：解析天气预报XML

假设我们从某个天气API获取了以下XML格式的天气预报数据：

```xml
<weather>
    <city>Beijing</city>
    <temperature>25</temperature>
    <condition>Sunny</condition>
</weather>
```

我们可以使用Pull解析器来解析这个XML：

```java
import org.xmlpull.v1.XmlPullParser;
import org.xmlpull.v1.XmlPullParserFactory;

import java.io.InputStream;

public class WeatherParserExample {
    public static void main(String[] args) {
        try {
            InputStream inputStream = WeatherParserExample.class.getResourceAsStream("/weather.xml");
            XmlPullParserFactory factory = XmlPullParserFactory.newInstance();
            XmlPullParser parser = factory.newPullParser();
            parser.setInput(inputStream, null);

            String city = null;
            int temperature = 0;
            String condition = null;

            int eventType = parser.getEventType();
            while (eventType != XmlPullParser.END_DOCUMENT) {
                if (eventType == XmlPullParser.START_TAG) {
                    switch (parser.getName()) {
                        case "city":
                            city = parser.nextText();
                            break;
                        case "temperature":
                            temperature = Integer.parseInt(parser.nextText());
                            break;
                        case "condition":
                            condition = parser.nextText();
                            break;
                    }
                }
                eventType = parser.next();
            }

            System.out.println("City: " + city);
            System.out.println("Temperature: " + temperature);
            System.out.println("Condition: " + condition);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 输出

```
City: Beijing
Temperature: 25
Condition: Sunny
```

## 总结

在本文中，我们介绍了Android中常用的三种XML解析方式：DOM、SAX和Pull解析器。每种解析方式都有其适用的场景：

- **DOM解析**：适合处理较小的XML文件，但可能会占用较多内存。
- **SAX解析**：适合处理较大的XML文件，但需要手动处理事件。
- **Pull解析**：灵活且高效，适合处理流式数据。

通过实际案例，我们展示了如何使用Pull解析器来解析天气预报数据。希望本文能帮助你掌握Android中的XML解析技术。

## 附加资源与练习

- **练习1**：尝试使用DOM解析器解析一个包含嵌套结构的XML文件。
- **练习2**：使用SAX解析器解析一个较大的XML文件，并统计其中某个标签的出现次数。
- **附加资源**：
  - [Android官方文档：XML解析](https://developer.android.com/training/basics/network-ops/xml)
  - [Java XML解析教程](https://www.tutorialspoint.com/java_xml/index.htm)

继续练习并探索更多XML解析的应用场景，你将能够更加熟练地处理各种XML数据。