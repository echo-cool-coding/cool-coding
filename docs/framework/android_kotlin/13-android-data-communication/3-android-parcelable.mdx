---
title: Android Parcelable
description: 了解如何在 Android 中使用 Parcelable 接口实现对象的高效序列化和反序列化，以便在组件之间传递数据。
---

在 Android 开发中，数据通信是一个常见的需求。当我们需要在不同的组件（如 Activity、Fragment 或 Service）之间传递复杂对象时，`Parcelable` 接口提供了一种高效的方式来实现对象的序列化和反序列化。本文将详细介绍 `Parcelable` 的概念、使用方法以及实际应用场景。

## 什么是 Parcelable？

`Parcelable` 是 Android 提供的一个接口，用于将对象序列化为一个 `Parcel` 对象，以便在组件之间传递。与 `Serializable` 相比，`Parcelable` 的性能更高，因为它避免了反射的使用，并且是专门为 Android 设计的。

:::note
`Parcelable` 是 Android 特有的序列化机制，而 `Serializable` 是 Java 的标准序列化接口。在 Android 开发中，推荐使用 `Parcelable`，因为它更高效。
:::

## 实现 Parcelable 接口

要实现 `Parcelable` 接口，需要完成以下步骤：

1. **实现 `Parcelable` 接口**：在类中实现 `Parcelable` 接口，并重写 `describeContents()` 和 `writeToParcel(Parcel, int)` 方法。
2. **创建 `CREATOR` 对象**：定义一个 `CREATOR` 静态字段，用于从 `Parcel` 中反序列化对象。
3. **编写序列化和反序列化逻辑**：在 `writeToParcel` 方法中编写对象的序列化逻辑，在 `CREATOR` 中编写反序列化逻辑。

以下是一个简单的示例：

```java
public class User implements Parcelable {
    private String name;
    private int age;

    public User(String name, int age) {
        this.name = name;
        this.age = age;
    }

    protected User(Parcel in) {
        name = in.readString();
        age = in.readInt();
    }

    public static final Creator<User> CREATOR = new Creator<User>() {
        @Override
        public User createFromParcel(Parcel in) {
            return new User(in);
        }

        @Override
        public User[] newArray(int size) {
            return new User[size];
        }
    };

    @Override
    public int describeContents() {
        return 0;
    }

    @Override
    public void writeToParcel(Parcel dest, int flags) {
        dest.writeString(name);
        dest.writeInt(age);
    }

    // Getters and setters
}
```

### 代码解释

- **`writeToParcel` 方法**：将对象的字段写入 `Parcel` 对象中。
- **`CREATOR` 对象**：用于从 `Parcel` 中读取数据并重新构建对象。
- **`describeContents` 方法**：通常返回 0，除非对象包含文件描述符。

## 使用 Parcelable 传递数据

在 Activity 之间传递 `Parcelable` 对象非常简单。以下是一个示例：

```java
// 在发送方 Activity 中
Intent intent = new Intent(this, SecondActivity.class);
User user = new User("John Doe", 25);
intent.putExtra("user", user);
startActivity(intent);

// 在接收方 Activity 中
User user = getIntent().getParcelableExtra("user");
```

## 实际应用场景

`Parcelable` 在以下场景中非常有用：

1. **Activity 之间传递复杂对象**：例如，传递用户信息、设置参数等。
2. **Fragment 之间传递数据**：通过 `Bundle` 传递 `Parcelable` 对象。
3. **Service 与 Activity 通信**：在 `Intent` 中传递 `Parcelable` 对象。

:::tip
如果对象中包含大量数据或复杂结构，建议使用 `Parcelable` 而不是 `Serializable`，以提高性能。
:::

## 总结

`Parcelable` 是 Android 中用于高效序列化和反序列化对象的接口。通过实现 `Parcelable` 接口，我们可以在不同的组件之间传递复杂对象，而不会影响性能。本文介绍了 `Parcelable` 的基本概念、实现方法以及实际应用场景。

## 附加资源

- [Android 官方文档 - Parcelable](https://developer.android.com/reference/android/os/Parcelable)
- [Android 数据传递最佳实践](https://developer.android.com/guide/components/activities/parcelable-and-bundles)

## 练习

1. 创建一个包含多个字段的 `Parcelable` 类，并在两个 Activity 之间传递该对象。
2. 比较 `Parcelable` 和 `Serializable` 的性能差异，并记录结果。