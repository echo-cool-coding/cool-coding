---
title: Android蓝牙通信
description: 了解如何在Android应用中实现蓝牙通信，包括设备发现、配对和数据传输的基础知识。
---

# Android蓝牙通信

蓝牙是一种无线通信技术，广泛应用于短距离设备之间的数据传输。在Android开发中，蓝牙通信可以帮助你实现设备之间的数据交换，例如连接耳机、传输文件或与其他设备进行通信。本文将带你了解如何在Android应用中实现蓝牙通信。

## 1. 蓝牙通信简介

蓝牙通信的核心是通过蓝牙协议栈实现设备之间的数据传输。Android提供了强大的API来支持蓝牙功能，包括设备发现、配对、连接和数据传输。以下是蓝牙通信的基本流程：

1. **设备发现**：扫描附近的蓝牙设备。
2. **设备配对**：与目标设备建立安全连接。
3. **数据传输**：通过蓝牙Socket进行数据交换。

## 2. 设置蓝牙权限

在开始之前，确保你的应用具有必要的蓝牙权限。在`AndroidManifest.xml`中添加以下权限：

```xml
<uses-permission android:name="android.permission.BLUETOOTH" />
<uses-permission android:name="android.permission.BLUETOOTH_ADMIN" />
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
```

:::note
从Android 6.0（API 23）开始，访问蓝牙设备需要`ACCESS_FINE_LOCATION`权限。
:::

## 3. 检查蓝牙支持

在应用中使用蓝牙之前，首先需要检查设备是否支持蓝牙功能：

```java
BluetoothAdapter bluetoothAdapter = BluetoothAdapter.getDefaultAdapter();
if (bluetoothAdapter == null) {
    // 设备不支持蓝牙
    Toast.makeText(this, "设备不支持蓝牙", Toast.LENGTH_SHORT).show();
} else {
    // 设备支持蓝牙
    if (!bluetoothAdapter.isEnabled()) {
        // 请求用户启用蓝牙
        Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);
        startActivityForResult(enableBtIntent, REQUEST_ENABLE_BT);
    }
}
```

## 4. 发现蓝牙设备

要发现附近的蓝牙设备，可以使用`BluetoothAdapter`的`startDiscovery()`方法：

```java
BluetoothAdapter bluetoothAdapter = BluetoothAdapter.getDefaultAdapter();
bluetoothAdapter.startDiscovery();
```

:::tip
你可以通过注册`BroadcastReceiver`来监听设备发现事件，并获取发现的设备列表。
:::

```java
BroadcastReceiver receiver = new BroadcastReceiver() {
    @Override
    public void onReceive(Context context, Intent intent) {
        String action = intent.getAction();
        if (BluetoothDevice.ACTION_FOUND.equals(action)) {
            BluetoothDevice device = intent.getParcelableExtra(BluetoothDevice.EXTRA_DEVICE);
            String deviceName = device.getName();
            String deviceAddress = device.getAddress();
            // 处理发现的设备
        }
    }
};

IntentFilter filter = new IntentFilter(BluetoothDevice.ACTION_FOUND);
registerReceiver(receiver, filter);
```

## 5. 设备配对与连接

要与蓝牙设备通信，首先需要与其配对并建立连接。以下是一个简单的配对和连接示例：

```java
BluetoothDevice device = bluetoothAdapter.getRemoteDevice(deviceAddress);
BluetoothSocket socket = device.createRfcommSocketToServiceRecord(MY_UUID);
socket.connect();
```

:::caution
确保在后台线程中执行连接操作，以避免阻塞主线程。
:::

## 6. 数据传输

一旦连接建立，你可以通过`BluetoothSocket`进行数据传输。以下是一个简单的数据发送和接收示例：

```java
// 发送数据
OutputStream outputStream = socket.getOutputStream();
outputStream.write("Hello, Bluetooth!".getBytes());

// 接收数据
InputStream inputStream = socket.getInputStream();
byte[] buffer = new byte[1024];
int bytes = inputStream.read(buffer);
String receivedMessage = new String(buffer, 0, bytes);
```

## 7. 实际应用场景

蓝牙通信在许多实际场景中都有应用，例如：

- **文件传输**：通过蓝牙在设备之间传输文件。
- **音频流**：将音频流传输到蓝牙耳机或扬声器。
- **物联网设备控制**：通过蓝牙控制智能家居设备。

## 8. 总结

通过本文，你已经了解了如何在Android应用中实现蓝牙通信的基本步骤，包括设备发现、配对、连接和数据传输。蓝牙通信是Android开发中的一个重要功能，掌握它将为你的应用开发带来更多可能性。

## 9. 附加资源与练习

- **官方文档**：[Android Bluetooth Overview](https://developer.android.com/guide/topics/connectivity/bluetooth)
- **练习**：尝试实现一个简单的蓝牙聊天应用，允许两个设备通过蓝牙进行文本通信。

:::warning
在实际开发中，务必处理蓝牙连接中的异常情况，并确保应用在断开连接时能够正确释放资源。
:::