---
title: Android USB通信
description: "了解如何在Android设备上实现USB通信，包括基本概念、代码示例和实际应用场景。"
---

## 介绍

USB（通用串行总线）是一种广泛使用的通信协议，用于连接计算机与外部设备。在Android开发中，USB通信允许设备与外部USB设备（如打印机、存储设备或传感器）进行数据交换。本文将介绍如何在Android应用中实现USB通信，包括基本概念、代码示例和实际应用场景。

## USB通信的基本概念

在Android中，USB通信主要涉及以下几个关键概念：

1. **USB Host**：Android设备作为主机，控制连接的USB设备。
2. **USB Accessory**：Android设备作为配件，被其他设备控制。
3. **USB Manager**：Android提供的API，用于管理USB设备和通信。

## 设置USB权限

在AndroidManifest.xml中声明USB权限：

```xml
<uses-feature android:name="android.hardware.usb.host" />
<uses-permission android:name="android.permission.USB_PERMISSION" />
```

## 检测连接的USB设备

使用`UsbManager`来检测连接的USB设备：

```java
UsbManager usbManager = (UsbManager) getSystemService(Context.USB_SERVICE);
HashMap<String, UsbDevice> deviceList = usbManager.getDeviceList();
for (UsbDevice device : deviceList.values()) {
    // 处理每个连接的USB设备
}
```

## 请求USB权限

在访问USB设备之前，需要请求用户权限：

```java
PendingIntent permissionIntent = PendingIntent.getBroadcast(this, 0, new Intent(ACTION_USB_PERMISSION), 0);
usbManager.requestPermission(device, permissionIntent);
```

## 与USB设备通信

一旦获得权限，就可以打开与USB设备的连接并进行通信：

```java
UsbDeviceConnection connection = usbManager.openDevice(device);
if (connection != null) {
    // 进行数据通信
    connection.close();
}
```

## 实际案例：读取USB设备数据

以下是一个简单的示例，展示如何从USB设备读取数据：

```java
UsbInterface intf = device.getInterface(0);
UsbEndpoint endpoint = intf.getEndpoint(0);

UsbDeviceConnection connection = usbManager.openDevice(device);
if (connection != null && connection.claimInterface(intf, true)) {
    byte[] buffer = new byte[endpoint.getMaxPacketSize()];
    int bytesRead = connection.bulkTransfer(endpoint, buffer, buffer.length, 5000);
    if (bytesRead > 0) {
        // 处理读取的数据
    }
    connection.releaseInterface(intf);
    connection.close();
}
```

## 总结

通过本文，您已经了解了如何在Android应用中实现USB通信。我们从基本概念开始，逐步讲解了如何检测USB设备、请求权限以及与设备进行数据通信。希望这些内容能帮助您在开发中更好地利用USB通信功能。

## 附加资源与练习

- [Android官方文档：USB Host](https://developer.android.com/guide/topics/connectivity/usb/host)
- 练习：尝试编写一个Android应用，通过USB连接读取外部传感器的数据并显示在屏幕上。

:::tip
在实际开发中，务必处理USB设备的拔插事件，以确保应用的稳定性和用户体验。
:::