---
title: Android媒体播放器
description: 学习如何在Android应用中实现媒体播放功能。本教程将逐步讲解如何使用Android的MediaPlayer类来播放音频和视频，并提供实际案例和代码示例。
---

## 介绍

在Android应用中，媒体播放是一个常见的需求，无论是播放音频还是视频。Android提供了`MediaPlayer`类，它是一个功能强大的工具，可以帮助开发者轻松实现媒体播放功能。本文将详细介绍如何使用`MediaPlayer`类来播放音频和视频，并通过实际案例展示其应用场景。

## MediaPlayer类概述

`MediaPlayer`类是Android SDK中用于播放音频和视频的核心类。它支持多种媒体格式，包括MP3、AAC、WAV、MP4等。`MediaPlayer`类提供了丰富的API，允许开发者控制播放、暂停、停止、跳转等操作。

### 基本用法

要使用`MediaPlayer`类，首先需要创建一个`MediaPlayer`对象，并为其设置数据源。数据源可以是本地文件、网络流或资源文件。接下来，调用`prepare()`方法准备播放，然后调用`start()`方法开始播放。

以下是一个简单的代码示例，展示如何使用`MediaPlayer`播放本地音频文件：

```java
MediaPlayer mediaPlayer = new MediaPlayer();
mediaPlayer.setDataSource("/sdcard/music.mp3");
mediaPlayer.prepare();
mediaPlayer.start();
```

:::note
在Android 6.0（API级别23）及以上版本中，访问外部存储需要动态请求权限。确保在代码中处理权限请求。
:::

### 播放网络流

`MediaPlayer`也支持播放网络流媒体。只需将URL作为数据源传递给`setDataSource()`方法即可。以下是一个播放网络音频流的示例：

```java
MediaPlayer mediaPlayer = new MediaPlayer();
mediaPlayer.setDataSource("https://example.com/audio.mp3");
mediaPlayer.prepareAsync(); // 异步准备，避免阻塞主线程
mediaPlayer.setOnPreparedListener(new MediaPlayer.OnPreparedListener() {
    @Override
    public void onPrepared(MediaPlayer mp) {
        mp.start();
    }
});
```

:::tip
使用`prepareAsync()`方法可以避免阻塞主线程，特别是在处理网络流媒体时。
:::

## 控制播放

`MediaPlayer`提供了多种方法来控制播放过程，包括暂停、停止、跳转等。以下是一些常用的控制方法：

- `pause()`: 暂停播放。
- `stop()`: 停止播放。
- `seekTo(int milliseconds)`: 跳转到指定的时间点。
- `isPlaying()`: 检查是否正在播放。

以下是一个控制播放的示例：

```java
mediaPlayer.pause(); // 暂停播放
mediaPlayer.seekTo(5000); // 跳转到5秒处
if (mediaPlayer.isPlaying()) {
    mediaPlayer.stop(); // 停止播放
}
```

## 处理播放状态

`MediaPlayer`提供了多种监听器，用于处理播放状态的变化。例如，`OnCompletionListener`用于监听播放完成事件，`OnErrorListener`用于处理播放错误。

以下是一个处理播放完成事件的示例：

```java
mediaPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() {
    @Override
    public void onCompletion(MediaPlayer mp) {
        // 播放完成后的操作
        Log.d("MediaPlayer", "播放完成");
    }
});
```

## 实际案例：音乐播放器

让我们通过一个实际案例来展示`MediaPlayer`的应用。假设我们要开发一个简单的音乐播放器，用户可以播放、暂停和停止音乐。

### 步骤1：创建UI

首先，创建一个简单的UI，包含三个按钮：播放、暂停和停止。

```xml
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:padding="16dp">

    <Button
        android:id="@+id/playButton"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="播放" />

    <Button
        android:id="@+id/pauseButton"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="暂停" />

    <Button
        android:id="@+id/stopButton"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="停止" />
</LinearLayout>
```

### 步骤2：实现播放逻辑

接下来，在Activity中实现播放逻辑。

```java
public class MusicPlayerActivity extends AppCompatActivity {

    private MediaPlayer mediaPlayer;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_music_player);

        mediaPlayer = MediaPlayer.create(this, R.raw.music); // 从资源文件加载音乐

        Button playButton = findViewById(R.id.playButton);
        Button pauseButton = findViewById(R.id.pauseButton);
        Button stopButton = findViewById(R.id.stopButton);

        playButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if (!mediaPlayer.isPlaying()) {
                    mediaPlayer.start();
                }
            }
        });

        pauseButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if (mediaPlayer.isPlaying()) {
                    mediaPlayer.pause();
                }
            }
        });

        stopButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if (mediaPlayer.isPlaying()) {
                    mediaPlayer.stop();
                    mediaPlayer.prepareAsync(); // 重新准备以再次播放
                }
            }
        });
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        if (mediaPlayer != null) {
            mediaPlayer.release();
            mediaPlayer = null;
        }
    }
}
```

:::caution
在Activity销毁时，务必释放`MediaPlayer`资源，以避免内存泄漏。
:::

## 总结

通过本文，我们学习了如何使用Android的`MediaPlayer`类来实现媒体播放功能。我们介绍了`MediaPlayer`的基本用法、控制播放的方法以及如何处理播放状态。最后，我们通过一个简单的音乐播放器案例展示了`MediaPlayer`的实际应用。

## 附加资源与练习

- **官方文档**: [MediaPlayer | Android Developers](https://developer.android.com/reference/android/media/MediaPlayer)
- **练习**: 尝试扩展音乐播放器，添加音量控制、进度条显示等功能。

希望本文能帮助你更好地理解和使用Android的`MediaPlayer`类。祝你编程愉快！