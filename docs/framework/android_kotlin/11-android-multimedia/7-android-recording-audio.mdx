---
title: Android录像
description: 学习如何在Android应用中实现录像功能。本文将从基础概念讲起，逐步引导你完成一个简单的录像功能实现，并提供实际案例和代码示例。
---

# Android录像

在Android开发中，录像功能是多媒体应用的重要组成部分。无论是社交应用、视频编辑工具，还是安全监控系统，录像功能都扮演着关键角色。本文将带你从零开始，学习如何在Android应用中实现录像功能。

## 1. 概述

Android提供了强大的多媒体API，使得开发者可以轻松地实现录像功能。录像的核心是使用`MediaRecorder`类，它允许你捕获音频和视频，并将其保存为文件。在实现录像功能时，你还需要处理权限请求、相机配置以及文件存储等问题。

## 2. 准备工作

在开始编写代码之前，确保你已经完成了以下准备工作：

1. **权限申请**：录像功能需要访问相机和存储权限。在`AndroidManifest.xml`中添加以下权限声明：
   ```xml
   <uses-permission android:name="android.permission.CAMERA" />
   <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
   <uses-permission android:name="android.permission.RECORD_AUDIO" />
   ```

2. **运行时权限请求**：从Android 6.0（API 23）开始，部分权限需要在运行时动态申请。确保在代码中处理权限请求逻辑。

## 3. 实现录像功能

### 3.1 初始化MediaRecorder

首先，我们需要初始化`MediaRecorder`并配置其参数。以下是一个简单的初始化示例：

```java
MediaRecorder mediaRecorder = new MediaRecorder();
mediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);
mediaRecorder.setVideoSource(MediaRecorder.VideoSource.CAMERA);
mediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4);
mediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);
mediaRecorder.setVideoEncoder(MediaRecorder.VideoEncoder.H264);
mediaRecorder.setOutputFile(getOutputMediaFile().toString());
```

:::note
`getOutputMediaFile()`是一个自定义方法，用于生成输出文件的路径。你可以根据需求自定义文件命名规则和存储位置。
:::

### 3.2 配置相机预览

在开始录像之前，通常需要显示相机预览。你可以使用`SurfaceView`或`TextureView`来实现相机预览。以下是一个简单的`SurfaceView`配置示例：

```java
SurfaceView surfaceView = findViewById(R.id.surface_view);
SurfaceHolder holder = surfaceView.getHolder();
holder.addCallback(new SurfaceHolder.Callback() {
    @Override
    public void surfaceCreated(SurfaceHolder holder) {
        mediaRecorder.setPreviewDisplay(holder.getSurface());
    }

    @Override
    public void surfaceChanged(SurfaceHolder holder, int format, int width, int height) {
        // 处理Surface变化
    }

    @Override
    public void surfaceDestroyed(SurfaceHolder holder) {
        // 释放资源
    }
});
```

### 3.3 开始和停止录像

配置完成后，你可以通过以下代码开始和停止录像：

```java
// 开始录像
mediaRecorder.prepare();
mediaRecorder.start();

// 停止录像
mediaRecorder.stop();
mediaRecorder.release();
```

:::caution
在调用`start()`之前，必须确保`MediaRecorder`已经正确配置并调用了`prepare()`方法。否则会抛出`IllegalStateException`异常。
:::

## 4. 实际案例

假设你正在开发一个简单的视频日记应用，用户可以通过该应用录制视频并保存到本地。以下是一个简化的实现流程：

1. **权限检查**：在应用启动时，检查并请求所需的权限。
2. **相机预览**：在`Activity`中显示相机预览。
3. **录像控制**：提供“开始录像”和“停止录像”按钮，用户点击后分别调用`start()`和`stop()`方法。
4. **文件保存**：录像完成后，将视频文件保存到设备的指定目录中。

## 5. 总结

通过本文的学习，你应该已经掌握了如何在Android应用中实现录像功能。我们从基础概念讲起，逐步实现了录像的核心功能，并通过实际案例展示了其应用场景。

## 6. 附加资源与练习

- **官方文档**：阅读[Android官方文档](https://developer.android.com/guide/topics/media/mediarecorder)以了解更多关于`MediaRecorder`的详细信息。
- **练习**：尝试扩展本文的案例，添加视频质量设置、录像时长限制等功能。

:::tip
如果你在实现过程中遇到问题，可以参考GitHub上的开源项目或社区论坛，寻找解决方案。
:::