---
title: Android录音
description: 学习如何在Android应用中实现录音功能。本文将从基础概念入手，逐步讲解如何使用Android的MediaRecorder API进行录音，并提供实际案例和代码示例。
---

## 介绍

在Android开发中，录音功能是一个常见的需求，尤其是在需要处理音频的应用中，如语音备忘录、语音聊天等。Android提供了`MediaRecorder`类，使得开发者可以轻松地实现录音功能。本文将带你从零开始，学习如何在Android应用中实现录音功能。

## 1. 准备工作

在开始编写代码之前，我们需要确保应用已经获得了录音权限。Android要求应用在录音之前必须获得`RECORD_AUDIO`权限。你需要在`AndroidManifest.xml`文件中添加以下权限声明：

```xml
<uses-permission android:name="android.permission.RECORD_AUDIO" />
```

此外，从Android 6.0（API级别23）开始，你还需要在运行时请求权限。我们将在后面的步骤中详细讲解这一点。

## 2. 使用MediaRecorder进行录音

`MediaRecorder`是Android提供的一个用于录制音频和视频的类。以下是使用`MediaRecorder`进行录音的基本步骤：

1. **创建MediaRecorder实例**：首先，你需要创建一个`MediaRecorder`对象。
2. **设置音频源**：指定音频源为麦克风。
3. **设置输出格式**：指定录音的输出格式，如`MP3`或`AAC`。
4. **设置音频编码器**：指定音频编码器，如`AAC`或`AMR_NB`。
5. **设置输出文件**：指定录音文件的保存路径。
6. **准备录音**：调用`prepare()`方法准备录音。
7. **开始录音**：调用`start()`方法开始录音。
8. **停止录音**：调用`stop()`方法停止录音。
9. **释放资源**：调用`release()`方法释放资源。

以下是一个简单的代码示例，展示了如何使用`MediaRecorder`进行录音：

```java
import android.media.MediaRecorder;
import java.io.IOException;

public class AudioRecorder {
    private MediaRecorder mediaRecorder;
    private String outputFile;

    public AudioRecorder(String outputFile) {
        this.outputFile = outputFile;
        mediaRecorder = new MediaRecorder();
    }

    public void startRecording() {
        try {
            mediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);
            mediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4);
            mediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);
            mediaRecorder.setOutputFile(outputFile);
            mediaRecorder.prepare();
            mediaRecorder.start();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public void stopRecording() {
        mediaRecorder.stop();
        mediaRecorder.release();
    }
}
```

:::note
在实际应用中，你可能需要在录音开始前检查并请求录音权限。可以使用`ActivityCompat.requestPermissions()`方法来实现这一点。
:::

## 3. 运行时权限处理

从Android 6.0开始，应用需要在运行时请求敏感权限。以下是如何在录音前请求`RECORD_AUDIO`权限的示例代码：

```java
import android.Manifest;
import android.content.pm.PackageManager;
import androidx.core.app.ActivityCompat;
import androidx.core.content.ContextCompat;

public class MainActivity extends AppCompatActivity {
    private static final int REQUEST_RECORD_AUDIO_PERMISSION = 200;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        if (ContextCompat.checkSelfPermission(this, Manifest.permission.RECORD_AUDIO) != PackageManager.PERMISSION_GRANTED) {
            ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.RECORD_AUDIO}, REQUEST_RECORD_AUDIO_PERMISSION);
        } else {
            // 权限已授予，可以开始录音
        }
    }

    @Override
    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {
        if (requestCode == REQUEST_RECORD_AUDIO_PERMISSION) {
            if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                // 权限已授予，可以开始录音
            } else {
                // 权限被拒绝，提示用户
            }
        }
    }
}
```

## 4. 实际案例：语音备忘录应用

假设我们正在开发一个简单的语音备忘录应用，用户可以录制语音并保存为文件。以下是实现该功能的关键步骤：

1. **创建录音按钮**：在布局文件中添加一个按钮，用于开始和停止录音。
2. **处理按钮点击事件**：在`MainActivity`中处理按钮点击事件，调用`AudioRecorder`类的`startRecording()`和`stopRecording()`方法。
3. **保存录音文件**：将录音文件保存到设备的存储中，并显示在列表中。

以下是一个简化的实现：

```java
public class MainActivity extends AppCompatActivity {
    private AudioRecorder audioRecorder;
    private String outputFile;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        outputFile = getExternalCacheDir().getAbsolutePath() + "/recording.mp4";
        audioRecorder = new AudioRecorder(outputFile);

        Button recordButton = findViewById(R.id.recordButton);
        recordButton.setOnClickListener(v -> {
            if (audioRecorder.isRecording()) {
                audioRecorder.stopRecording();
                recordButton.setText("开始录音");
            } else {
                audioRecorder.startRecording();
                recordButton.setText("停止录音");
            }
        });
    }
}
```

:::tip
在实际应用中，你可能还需要处理录音过程中的异常情况，如存储空间不足、麦克风被占用等。
:::

## 5. 总结

通过本文，你已经学习了如何在Android应用中使用`MediaRecorder`类实现录音功能。我们从基础概念入手，逐步讲解了录音的实现步骤，并提供了一个实际案例来展示如何将这些知识应用到实际开发中。

## 6. 附加资源与练习

- **练习**：尝试扩展语音备忘录应用，添加播放录音的功能。
- **资源**：
  - [Android官方文档：MediaRecorder](https://developer.android.com/reference/android/media/MediaRecorder)
  - [Android权限处理指南](https://developer.android.com/training/permissions/requesting)

希望本文能帮助你更好地理解Android录音功能的实现。如果你有任何问题或建议，欢迎在评论区留言！