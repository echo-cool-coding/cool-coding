---
title: Gin CORS 中间件
description: 了解如何在 Gin 框架中使用 CORS 中间件来处理跨域资源共享（CORS）请求。
---

# Gin CORS 中间件

在现代 Web 开发中，跨域资源共享（CORS）是一个常见的问题。当你的前端应用尝试从一个域名请求另一个域名的资源时，浏览器会执行 CORS 检查。为了允许这种跨域请求，服务器需要正确配置 CORS 头信息。Gin 框架提供了一个简单而强大的中间件来处理 CORS 请求。

## 什么是 CORS？

CORS（Cross-Origin Resource Sharing）是一种机制，它允许浏览器向跨域服务器发送请求，并接收响应。默认情况下，浏览器会阻止跨域请求，以防止恶意网站访问用户的敏感数据。通过配置 CORS，服务器可以明确允许某些跨域请求。

## 为什么需要 CORS 中间件？

在开发前后端分离的应用时，前端和后端通常运行在不同的域名或端口上。例如，前端可能运行在 `http://localhost:3000`，而后端运行在 `http://localhost:8080`。在这种情况下，前端向后端发送请求时，浏览器会执行 CORS 检查。如果后端没有正确配置 CORS 头信息，浏览器会阻止请求。

Gin 的 CORS 中间件可以帮助你轻松地配置这些头信息，从而允许跨域请求。

## 安装 Gin CORS 中间件

首先，你需要安装 Gin 框架和 CORS 中间件。你可以使用以下命令来安装它们：

```bash
go get -u github.com/gin-gonic/gin
go get -u github.com/gin-contrib/cors
```

## 使用 Gin CORS 中间件

接下来，我们来看如何在 Gin 中使用 CORS 中间件。以下是一个简单的示例：

```go
package main

import (
    "github.com/gin-gonic/gin"
    "github.com/gin-contrib/cors"
)

func main() {
    r := gin.Default()

    // 配置 CORS 中间件
    r.Use(cors.Default())

    r.GET("/ping", func(c *gin.Context) {
        c.JSON(200, gin.H{
            "message": "pong",
        })
    })

    r.Run() // 默认监听 0.0.0.0:8080
}
```

在这个示例中，我们使用了 `cors.Default()` 来配置 CORS 中间件。`cors.Default()` 提供了一些默认的配置，允许所有来源的请求，并允许常见的 HTTP 方法（如 GET、POST 等）。

### 自定义 CORS 配置

如果你需要更精细的控制，可以自定义 CORS 配置。以下是一个自定义配置的示例：

```go
package main

import (
    "github.com/gin-gonic/gin"
    "github.com/gin-contrib/cors"
)

func main() {
    r := gin.Default()

    // 自定义 CORS 配置
    config := cors.Config{
        AllowOrigins:     []string{"https://example.com"},
        AllowMethods:     []string{"GET", "POST", "PUT", "DELETE"},
        AllowHeaders:     []string{"Origin", "Content-Type"},
        ExposeHeaders:    []string{"Content-Length"},
        AllowCredentials: true,
        MaxAge:           12 * time.Hour,
    }

    r.Use(cors.New(config))

    r.GET("/ping", func(c *gin.Context) {
        c.JSON(200, gin.H{
            "message": "pong",
        })
    })

    r.Run() // 默认监听 0.0.0.0:8080
}
```

在这个示例中，我们创建了一个自定义的 CORS 配置，只允许来自 `https://example.com` 的请求，并且只允许 GET、POST、PUT 和 DELETE 方法。我们还配置了允许的请求头、暴露的头信息、是否允许携带凭证以及预检请求的缓存时间。

## 实际应用场景

假设你正在开发一个前后端分离的应用，前端运行在 `http://localhost:3000`，后端运行在 `http://localhost:8080`。前端需要向后端发送请求来获取数据。在这种情况下，你需要在后端配置 CORS 中间件，以允许来自 `http://localhost:3000` 的请求。

```go
package main

import (
    "github.com/gin-gonic/gin"
    "github.com/gin-contrib/cors"
)

func main() {
    r := gin.Default()

    // 配置 CORS 中间件，允许来自 http://localhost:3000 的请求
    config := cors.Config{
        AllowOrigins:     []string{"http://localhost:3000"},
        AllowMethods:     []string{"GET", "POST", "PUT", "DELETE"},
        AllowHeaders:     []string{"Origin", "Content-Type"},
        ExposeHeaders:    []string{"Content-Length"},
        AllowCredentials: true,
        MaxAge:           12 * time.Hour,
    }

    r.Use(cors.New(config))

    r.GET("/data", func(c *gin.Context) {
        c.JSON(200, gin.H{
            "data": "Some data from the backend",
        })
    })

    r.Run() // 默认监听 0.0.0.0:8080
}
```

在这个示例中，我们配置了 CORS 中间件，只允许来自 `http://localhost:3000` 的请求。这样，前端应用就可以安全地访问后端的数据了。

## 总结

Gin 的 CORS 中间件是一个强大的工具，可以帮助你轻松处理跨域请求。通过简单的配置，你可以允许特定的来源、方法和头信息，从而确保你的应用能够安全地处理跨域请求。

:::tip
在实际开发中，建议根据具体的需求来配置 CORS，避免过于宽松的配置，以防止潜在的安全风险。
:::

## 附加资源

- [Gin 官方文档](https://gin-gonic.com/docs/)
- [MDN Web Docs: CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS)
- [Gin CORS 中间件 GitHub 仓库](https://github.com/gin-contrib/cors)

## 练习

1. 尝试在你的 Gin 项目中配置 CORS 中间件，允许来自 `http://localhost:3000` 的请求。
2. 修改 CORS 配置，只允许 GET 和 POST 方法，并测试你的配置是否生效。
3. 研究并尝试使用 `AllowCredentials` 和 `ExposeHeaders` 配置项，理解它们的作用。

通过以上练习，你将更深入地理解 Gin CORS 中间件的使用和配置。