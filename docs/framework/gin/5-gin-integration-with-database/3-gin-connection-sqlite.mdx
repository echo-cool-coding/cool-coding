---
title: Gin 连接SQLite
description: 学习如何在Gin框架中连接SQLite数据库，并实现基本的CRUD操作。本文适合初学者，包含详细的代码示例和实际应用场景。
---

# Gin 连接SQLite

在现代Web开发中，数据库是不可或缺的一部分。SQLite是一个轻量级的嵌入式数据库，非常适合小型项目或原型开发。Gin是一个高性能的Go语言Web框架，结合SQLite可以快速构建高效的Web应用。本文将详细介绍如何在Gin框架中连接SQLite数据库，并实现基本的CRUD操作。

## 1. 介绍

Gin是一个用Go语言编写的Web框架，以其高性能和简洁的API而闻名。SQLite是一个轻量级的嵌入式数据库，不需要独立的服务器进程，数据存储在一个单一的文件中。将Gin与SQLite结合，可以快速构建出高效、轻量级的Web应用。

## 2. 准备工作

在开始之前，确保你已经安装了Go语言环境，并且已经安装了Gin框架和SQLite的Go驱动。

```bash
go get -u github.com/gin-gonic/gin
go get -u github.com/mattn/go-sqlite3
```

## 3. 连接SQLite数据库

首先，我们需要在Gin应用中连接SQLite数据库。以下是一个简单的示例，展示了如何连接SQLite数据库并创建一个表。

```go
package main

import (
    "database/sql"
    "github.com/gin-gonic/gin"
    _ "github.com/mattn/go-sqlite3"
    "log"
)

func main() {
    // 打开数据库连接
    db, err := sql.Open("sqlite3", "./test.db")
    if err != nil {
        log.Fatal(err)
    }
    defer db.Close()

    // 创建表
    _, err = db.Exec("CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT, age INTEGER)")
    if err != nil {
        log.Fatal(err)
    }

    // 初始化Gin
    r := gin.Default()

    // 定义路由
    r.GET("/users", func(c *gin.Context) {
        var users []struct {
            ID   int    `json:"id"`
            Name string `json:"name"`
            Age  int    `json:"age"`
        }

        rows, err := db.Query("SELECT id, name, age FROM users")
        if err != nil {
            c.JSON(500, gin.H{"error": err.Error()})
            return
        }
        defer rows.Close()

        for rows.Next() {
            var user struct {
                ID   int    `json:"id"`
                Name string `json:"name"`
                Age  int    `json:"age"`
            }
            if err := rows.Scan(&user.ID, &user.Name, &user.Age); err != nil {
                c.JSON(500, gin.H{"error": err.Error()})
                return
            }
            users = append(users, user)
        }

        c.JSON(200, users)
    })

    // 启动服务
    r.Run(":8080")
}
```

在这个示例中，我们首先使用 `sql.Open` 函数连接SQLite数据库，然后创建了一个名为 `users` 的表。接着，我们定义了一个路由 `/users`，用于查询并返回所有用户信息。

## 4. 实现CRUD操作

接下来，我们将实现完整的CRUD（创建、读取、更新、删除）操作。

### 4.1 创建用户

```go
r.POST("/users", func(c *gin.Context) {
    var user struct {
        Name string `json:"name"`
        Age  int    `json:"age"`
    }
    if err := c.ShouldBindJSON(&user); err != nil {
        c.JSON(400, gin.H{"error": err.Error()})
        return
    }

    result, err := db.Exec("INSERT INTO users (name, age) VALUES (?, ?)", user.Name, user.Age)
    if err != nil {
        c.JSON(500, gin.H{"error": err.Error()})
        return
    }

    id, _ := result.LastInsertId()
    c.JSON(200, gin.H{"id": id})
})
```

### 4.2 读取用户

```go
r.GET("/users/:id", func(c *gin.Context) {
    id := c.Param("id")

    var user struct {
        ID   int    `json:"id"`
        Name string `json:"name"`
        Age  int    `json:"age"`
    }

    err := db.QueryRow("SELECT id, name, age FROM users WHERE id = ?", id).Scan(&user.ID, &user.Name, &user.Age)
    if err != nil {
        c.JSON(404, gin.H{"error": "User not found"})
        return
    }

    c.JSON(200, user)
})
```

### 4.3 更新用户

```go
r.PUT("/users/:id", func(c *gin.Context) {
    id := c.Param("id")

    var user struct {
        Name string `json:"name"`
        Age  int    `json:"age"`
    }
    if err := c.ShouldBindJSON(&user); err != nil {
        c.JSON(400, gin.H{"error": err.Error()})
        return
    }

    _, err := db.Exec("UPDATE users SET name = ?, age = ? WHERE id = ?", user.Name, user.Age, id)
    if err != nil {
        c.JSON(500, gin.H{"error": err.Error()})
        return
    }

    c.JSON(200, gin.H{"status": "success"})
})
```

### 4.4 删除用户

```go
r.DELETE("/users/:id", func(c *gin.Context) {
    id := c.Param("id")

    _, err := db.Exec("DELETE FROM users WHERE id = ?", id)
    if err != nil {
        c.JSON(500, gin.H{"error": err.Error()})
        return
    }

    c.JSON(200, gin.H{"status": "success"})
})
```

## 5. 实际应用场景

假设你正在开发一个简单的用户管理系统，你需要存储用户的基本信息（如姓名和年龄），并提供创建、读取、更新和删除用户的功能。使用Gin和SQLite，你可以快速搭建这样一个系统，并且由于SQLite的轻量级特性，你可以在本地开发环境中轻松运行和测试。

## 6. 总结

通过本文，你已经学会了如何在Gin框架中连接SQLite数据库，并实现了基本的CRUD操作。Gin和SQLite的结合为小型项目或原型开发提供了一个高效、轻量级的解决方案。

## 7. 附加资源与练习

- **练习**：尝试扩展本文中的示例，添加更多的字段到 `users` 表中，并实现相应的CRUD操作。
- **资源**：
  - [Gin官方文档](https://gin-gonic.com/docs/)
  - [SQLite官方文档](https://www.sqlite.org/docs.html)
  - [Go语言数据库操作指南](https://golang.org/pkg/database/sql/)

:::tip
在实际开发中，记得处理数据库连接的错误，并确保在操作完成后关闭数据库连接，以避免资源泄露。
:::