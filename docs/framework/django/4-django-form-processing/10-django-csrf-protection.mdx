---
title: Django CSRF 保护
description: 了解 Django 中的 CSRF 保护机制，学习如何防止跨站请求伪造攻击，并通过实际案例掌握其应用。
---

## 什么是 CSRF 保护？

CSRF（Cross-Site Request Forgery，跨站请求伪造）是一种常见的网络攻击方式。攻击者通过伪造用户的请求，诱使用户在不知情的情况下执行某些操作，例如修改账户信息或发起转账。Django 提供了内置的 CSRF 保护机制，帮助开发者防止此类攻击。

:::note
CSRF 保护的核心思想是确保每个表单提交或敏感操作请求都来自用户的真实意图，而不是恶意伪造的请求。
:::

## Django 如何实现 CSRF 保护？

Django 的 CSRF 保护机制基于以下步骤：

1. **生成 CSRF Token**：当用户访问包含表单的页面时，Django 会生成一个唯一的 CSRF Token，并将其嵌入到表单中。
2. **验证 CSRF Token**：当用户提交表单时，Django 会验证请求中的 CSRF Token 是否与服务器生成的 Token 匹配。如果不匹配，请求将被拒绝。

### 代码示例

以下是一个简单的 Django 表单示例，展示了如何启用 CSRF 保护：

```python
# views.py
from django.shortcuts import render
from django.http import HttpResponse
from django.views.decorators.csrf import csrf_protect

@csrf_protect
def my_form_view(request):
    if request.method == 'POST':
        # 处理表单数据
        return HttpResponse('表单提交成功！')
    return render(request, 'my_form.html')
```

```html
<!-- my_form.html -->
<form method="post">
    {% csrf_token %}
    <input type="text" name="username" placeholder="请输入用户名" />
    <button type="submit">提交</button>
</form>
```

:::tip
在模板中使用 `{% csrf_token %}` 标签会自动生成一个隐藏的输入字段，包含 CSRF Token。Django 会在表单提交时验证该 Token。
:::

### 输入与输出

- **输入**：用户在表单中输入数据并提交。
- **输出**：如果 CSRF Token 验证通过，表单数据将被处理并返回成功消息；否则，Django 会返回 403 禁止访问错误。

## 实际应用场景

假设你正在开发一个电子商务网站，用户可以通过表单提交订单。如果没有 CSRF 保护，攻击者可能会伪造一个订单提交请求，导致用户在不知情的情况下购买商品。

通过启用 Django 的 CSRF 保护，你可以确保每个订单请求都来自真实的用户操作，从而防止此类攻击。

## 总结

Django 的 CSRF 保护机制是确保 Web 应用程序安全的重要工具。通过生成和验证 CSRF Token，Django 能够有效防止跨站请求伪造攻击。作为开发者，你只需在表单中添加 `{% csrf_token %}` 标签，即可轻松启用这一功能。

:::caution
请确保在所有涉及敏感操作的 POST 请求中启用 CSRF 保护，否则你的应用程序可能会面临安全风险。
:::

## 附加资源与练习

- **官方文档**：[Django CSRF 保护文档](https://docs.djangoproject.com/en/stable/ref/csrf/)
- **练习**：尝试在一个 Django 项目中实现 CSRF 保护，并模拟攻击场景，观察 Django 如何阻止非法请求。

通过学习和实践，你将能够更好地理解和应用 Django 的 CSRF 保护机制，为你的 Web 应用程序提供更强的安全保障。