---
title: Django 表单基础
description: 学习Django表单的基础知识，包括如何创建、验证和处理表单，以及如何在Django项目中使用表单。
---

# Django 表单基础

在Web开发中，表单是用户与网站交互的重要方式之一。Django提供了一个强大的表单处理系统，使得开发者能够轻松地创建、验证和处理表单数据。本文将带你了解Django表单的基础知识，并通过实际案例展示如何在Django项目中使用表单。

## 什么是Django表单？

Django表单是Django框架中的一个模块，用于处理HTML表单的创建、验证和数据提交。通过Django表单，开发者可以定义表单字段、验证规则以及如何处理用户提交的数据。Django表单不仅简化了表单的创建过程，还提供了强大的数据验证功能，确保用户输入的数据符合预期。

## 创建Django表单

在Django中，表单通常定义在`forms.py`文件中。我们可以通过继承`django.forms.Form`类来创建一个表单。以下是一个简单的表单示例：

```python
from django import forms

class ContactForm(forms.Form):
    name = forms.CharField(label='Your name', max_length=100)
    email = forms.EmailField(label='Your email')
    message = forms.CharField(label='Your message', widget=forms.Textarea)
```

在这个例子中，我们定义了一个`ContactForm`表单，包含三个字段：`name`、`email`和`message`。每个字段都指定了相应的类型和标签。

## 在视图中使用表单

定义好表单后，我们需要在视图中使用它。以下是一个简单的视图函数，用于处理表单的提交：

```python
from django.shortcuts import render
from .forms import ContactForm

def contact_view(request):
    if request.method == 'POST':
        form = ContactForm(request.POST)
        if form.is_valid():
            # 处理表单数据
            name = form.cleaned_data['name']
            email = form.cleaned_data['email']
            message = form.cleaned_data['message']
            # 这里可以添加保存数据或发送邮件的逻辑
            return render(request, 'contact/success.html')
    else:
        form = ContactForm()
    return render(request, 'contact/contact.html', {'form': form})
```

在这个视图中，我们首先检查请求方法是否为`POST`。如果是`POST`请求，我们将用户提交的数据传递给表单实例，并调用`is_valid()`方法进行验证。如果表单数据有效，我们可以通过`cleaned_data`属性访问已验证的数据，并进行进一步处理。

## 在模板中渲染表单

在Django模板中，我们可以使用`{{ form }}`来渲染整个表单，或者使用`{{ form.field_name }}`来渲染单个字段。以下是一个简单的模板示例：

```html
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Submit</button>
</form>
```

在这个模板中，我们使用`{{ form.as_p }}`将表单渲染为一系列段落（`<p>`标签）。`{% csrf_token %}`用于防止跨站请求伪造（CSRF）攻击。

## 表单验证

Django表单提供了强大的验证功能。每个表单字段都可以定义验证规则，例如`required`、`max_length`等。如果用户提交的数据不符合这些规则，表单将自动返回错误信息。

以下是一个带有自定义验证的表单示例：

```python
from django import forms

class ContactForm(forms.Form):
    name = forms.CharField(label='Your name', max_length=100)
    email = forms.EmailField(label='Your email')
    message = forms.CharField(label='Your message', widget=forms.Textarea)

    def clean_message(self):
        message = self.cleaned_data['message']
        if len(message) < 10:
            raise forms.ValidationError("Message must be at least 10 characters long.")
        return message
```

在这个例子中，我们添加了一个`clean_message`方法，用于自定义验证`message`字段。如果消息长度小于10个字符，表单将返回一个验证错误。

## 实际案例：用户注册表单

让我们通过一个实际案例来展示Django表单的应用。假设我们要创建一个用户注册表单，包含用户名、电子邮件和密码字段。

```python
from django import forms

class RegistrationForm(forms.Form):
    username = forms.CharField(label='Username', max_length=100)
    email = forms.EmailField(label='Email')
    password = forms.CharField(label='Password', widget=forms.PasswordInput)
    confirm_password = forms.CharField(label='Confirm Password', widget=forms.PasswordInput)

    def clean(self):
        cleaned_data = super().clean()
        password = cleaned_data.get('password')
        confirm_password = cleaned_data.get('confirm_password')

        if password and confirm_password and password != confirm_password:
            raise forms.ValidationError("Passwords do not match.")
```

在这个表单中，我们添加了一个`clean`方法，用于验证密码和确认密码是否匹配。如果不匹配，表单将返回一个验证错误。

## 总结

Django表单是处理用户输入数据的强大工具。通过本文的学习，你应该已经掌握了如何创建、验证和处理Django表单。我们还通过实际案例展示了如何在Django项目中使用表单。

:::tip
如果你想进一步学习Django表单的高级功能，可以查阅Django官方文档，或者尝试创建一个包含多个表单字段和复杂验证逻辑的表单。
:::

## 附加资源

- [Django官方文档 - 表单](https://docs.djangoproject.com/en/stable/topics/forms/)
- [Django表单字段参考](https://docs.djangoproject.com/en/stable/ref/forms/fields/)
- [Django表单验证参考](https://docs.djangoproject.com/en/stable/ref/forms/validation/)

## 练习

1. 创建一个包含多个字段的Django表单，并添加自定义验证逻辑。
2. 在视图中处理表单提交，并将数据保存到数据库中。
3. 尝试使用Django的`ModelForm`来简化表单的创建过程。