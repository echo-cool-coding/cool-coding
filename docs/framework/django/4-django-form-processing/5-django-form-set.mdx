---
title: Django 表单集
description: 了解如何在Django中使用表单集（Formset）处理多个表单实例，并掌握其在实际项目中的应用。
---

# Django 表单集

在Django中，表单集（Formset）是一种用于处理多个表单实例的工具。它允许你在一个页面上同时处理多个相同类型的表单，非常适合处理一对多关系的数据。例如，你可能需要在一个页面上同时编辑多个订单项或评论。

## 什么是表单集？

表单集是Django提供的一个高级功能，它允许你将多个表单实例组合在一起，并在一个视图中统一处理。表单集特别适用于以下场景：

- 处理多个相同类型的表单。
- 处理一对多关系的数据。
- 批量编辑或创建多个对象。

## 表单集的基本用法

### 创建表单集

要创建一个表单集，首先需要定义一个表单类，然后使用 `formset_factory` 函数将其转换为表单集。以下是一个简单的例子：

```python
from django import forms
from django.forms import formset_factory

class BookForm(forms.Form):
    title = forms.CharField()
    author = forms.CharField()

BookFormSet = formset_factory(BookForm, extra=2)
```

在这个例子中，我们定义了一个 `BookForm` 表单类，然后使用 `formset_factory` 创建了一个表单集 `BookFormSet`。`extra=2` 参数表示默认显示2个空表单。

### 在视图中使用表单集

接下来，我们可以在视图中使用这个表单集。以下是一个简单的视图示例：

```python
from django.shortcuts import render
from .forms import BookFormSet

def manage_books(request):
    if request.method == 'POST':
        formset = BookFormSet(request.POST)
        if formset.is_valid():
            for form in formset:
                # 处理每个表单的数据
                print(form.cleaned_data)
    else:
        formset = BookFormSet()
    return render(request, 'manage_books.html', {'formset': formset})
```

在这个视图中，我们首先检查请求方法是否为 `POST`。如果是，我们使用提交的数据初始化表单集，并验证表单集的有效性。如果表单集有效，我们可以遍历每个表单并处理其数据。如果请求方法不是 `POST`，我们只需初始化一个空的表单集并将其传递给模板。

### 在模板中渲染表单集

在模板中，我们可以使用Django的模板语言来渲染表单集。以下是一个简单的模板示例：

```html
<form method="post">
    {{ formset.management_form }}
    {% for form in formset %}
        {{ form.as_p }}
    {% endfor %}
    <button type="submit">提交</button>
</form>
```

在这个模板中，我们首先渲染表单集的管理表单（`management_form`），这是Django表单集的一个必要部分。然后，我们遍历表单集中的每个表单，并使用 `as_p` 方法将其渲染为段落形式。最后，我们添加一个提交按钮。

## 表单集的实际应用

### 批量编辑书籍

假设你正在开发一个图书管理系统，需要在一个页面上批量编辑多本书的信息。使用表单集可以轻松实现这一功能。以下是一个完整的示例：

```python
from django import forms
from django.forms import formset_factory
from django.shortcuts import render

class BookForm(forms.Form):
    title = forms.CharField()
    author = forms.CharField()

BookFormSet = formset_factory(BookForm, extra=2)

def manage_books(request):
    if request.method == 'POST':
        formset = BookFormSet(request.POST)
        if formset.is_valid():
            for form in formset:
                # 处理每个表单的数据
                print(form.cleaned_data)
    else:
        formset = BookFormSet()
    return render(request, 'manage_books.html', {'formset': formset})
```

在这个示例中，我们定义了一个 `BookForm` 表单类，并使用 `formset_factory` 创建了一个表单集。在视图中，我们处理表单集的提交，并在模板中渲染表单集。

### 处理一对多关系

表单集也非常适合处理一对多关系的数据。例如，你可能需要在一个页面上编辑一个作者及其所有书籍。以下是一个示例：

```python
from django import forms
from django.forms import inlineformset_factory
from django.shortcuts import render
from .models import Author, Book

class BookForm(forms.ModelForm):
    class Meta:
        model = Book
        fields = ['title', 'author']

BookFormSet = inlineformset_factory(Author, Book, form=BookForm, extra=1)

def manage_author(request, author_id):
    author = Author.objects.get(id=author_id)
    if request.method == 'POST':
        formset = BookFormSet(request.POST, instance=author)
        if formset.is_valid():
            formset.save()
    else:
        formset = BookFormSet(instance=author)
    return render(request, 'manage_author.html', {'formset': formset})
```

在这个示例中，我们使用 `inlineformset_factory` 创建了一个内联表单集，用于编辑一个作者的所有书籍。在视图中，我们处理表单集的提交，并在模板中渲染表单集。

## 总结

Django表单集是一个强大的工具，可以帮助你轻松处理多个表单实例。无论是批量编辑数据还是处理一对多关系，表单集都能大大简化你的开发工作。通过本文的学习，你应该已经掌握了表单集的基本用法，并能够在实际项目中应用它。

## 附加资源

- [Django官方文档 - 表单集](https://docs.djangoproject.com/en/stable/topics/forms/formsets/)
- [Django官方文档 - 内联表单集](https://docs.djangoproject.com/en/stable/topics/forms/modelforms/#inline-formsets)

## 练习

1. 创建一个表单集，用于批量编辑用户信息。
2. 使用内联表单集，在一个页面上编辑一个博客文章及其所有评论。
3. 尝试在表单集中添加验证逻辑，确保所有表单的数据都符合要求。
