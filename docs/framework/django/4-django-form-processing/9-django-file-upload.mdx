---
title: Django 文件上传
description: 学习如何在Django中处理文件上传，包括表单设置、视图处理和文件存储。
---

# Django 文件上传

在Web开发中，文件上传是一个常见的需求。无论是上传用户头像、文档还是其他类型的文件，Django都提供了强大的工具来处理这些任务。本文将逐步介绍如何在Django中实现文件上传，并通过实际案例展示其应用。

## 介绍

Django的文件上传功能主要通过表单和视图来处理。用户通过表单选择文件并提交，服务器端的视图接收文件并处理存储。Django的`FileField`和`ImageField`模型字段使得在数据库中存储文件路径变得非常简单。

## 设置表单

首先，我们需要在Django的表单中设置文件上传字段。Django提供了`forms.FileField`来处理文件上传。

```python
from django import forms

class UploadFileForm(forms.Form):
    title = forms.CharField(max_length=50)
    file = forms.FileField()
```

在这个例子中，我们创建了一个包含标题和文件字段的表单。`file`字段将用于上传文件。

## 处理文件上传的视图

接下来，我们需要在视图中处理文件上传。Django的`request.FILES`字典包含了所有上传的文件。

```python
from django.shortcuts import render
from .forms import UploadFileForm

def upload_file(request):
    if request.method == 'POST':
        form = UploadFileForm(request.POST, request.FILES)
        if form.is_valid():
            handle_uploaded_file(request.FILES['file'])
            return render(request, 'success.html')
    else:
        form = UploadFileForm()
    return render(request, 'upload.html', {'form': form})

def handle_uploaded_file(f):
    with open('some/file/name.txt', 'wb+') as destination:
        for chunk in f.chunks():
            destination.write(chunk)
```

在这个视图中，我们首先检查请求方法是否为`POST`。如果是，我们使用`request.FILES`来处理上传的文件。`handle_uploaded_file`函数将文件写入服务器的文件系统中。

## 存储文件

Django提供了多种方式来存储上传的文件。最常见的方式是使用`FileField`或`ImageField`模型字段。

```python
from django.db import models

class Document(models.Model):
    title = models.CharField(max_length=50)
    file = models.FileField(upload_to='documents/')
```

在这个模型中，`file`字段将上传的文件存储在`MEDIA_ROOT/documents/`目录下。`MEDIA_ROOT`是Django设置中指定的媒体文件根目录。

## 实际案例

假设我们正在开发一个博客平台，用户可以在发布文章时上传图片。我们可以使用以下模型和表单来实现这一功能。

```python
from django.db import models
from django import forms

class Article(models.Model):
    title = models.CharField(max_length=100)
    content = models.TextField()
    image = models.ImageField(upload_to='articles/')

class ArticleForm(forms.ModelForm):
    class Meta:
        model = Article
        fields = ['title', 'content', 'image']
```

在视图中，我们可以处理表单提交并保存文章及其图片。

```python
from django.shortcuts import render, redirect
from .forms import ArticleForm

def create_article(request):
    if request.method == 'POST':
        form = ArticleForm(request.POST, request.FILES)
        if form.is_valid():
            form.save()
            return redirect('article_list')
    else:
        form = ArticleForm()
    return render(request, 'create_article.html', {'form': form})
```

## 总结

Django的文件上传功能非常强大且易于使用。通过设置表单、处理视图和存储文件，我们可以轻松实现文件上传功能。在实际应用中，文件上传可以用于多种场景，如用户头像、文档管理、图片上传等。

## 附加资源

- [Django官方文档 - 文件上传](https://docs.djangoproject.com/en/stable/topics/http/file-uploads/)
- [Django官方文档 - 模型字段](https://docs.djangoproject.com/en/stable/ref/models/fields/)

## 练习

1. 创建一个Django项目，实现用户上传头像的功能。
2. 扩展博客平台，允许用户上传多个图片到一篇文章中。
3. 研究如何在Django中使用第三方存储服务（如AWS S3）来存储上传的文件。

通过以上步骤和练习，你将掌握Django文件上传的核心概念，并能够在实际项目中应用这些知识。