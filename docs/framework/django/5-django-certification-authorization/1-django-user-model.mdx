---
title: Django 用户模型
description: 了解Django中的用户模型，掌握如何扩展默认用户模型以满足实际需求。
---

# Django 用户模型

Django是一个功能强大的Web框架，提供了许多开箱即用的功能，其中之一就是用户认证系统。Django的用户认证系统基于一个内置的**用户模型**（User Model），它负责管理用户的基本信息，如用户名、密码、电子邮件等。本文将详细介绍Django的用户模型，并展示如何扩展它以满足实际需求。

## 什么是Django用户模型？

Django的用户模型是一个内置的模型类，名为 `User`，位于 `django.contrib.auth.models` 模块中。它提供了用户认证所需的基本字段和方法，例如：

- `username`: 用户的唯一标识符。
- `password`: 用户的密码（经过哈希处理）。
- `email`: 用户的电子邮件地址。
- `first_name` 和 `last_name`: 用户的名字和姓氏。
- `is_staff` 和 `is_superuser`: 用于区分普通用户和管理员用户。

Django的用户模型还提供了许多有用的方法，例如：

- `set_password(password)`: 设置用户的密码。
- `check_password(password)`: 检查用户输入的密码是否正确。
- `get_full_name()`: 获取用户的全名。

## 默认用户模型的使用

在Django中，默认的用户模型已经足够应对大多数基本场景。以下是一个简单的示例，展示如何使用默认用户模型创建用户：

```python
from django.contrib.auth.models import User

# 创建一个新用户
user = User.objects.create_user(username='john', email='john@example.com', password='password123')

# 设置用户的全名
user.first_name = 'John'
user.last_name = 'Doe'
user.save()

# 检查密码
print(user.check_password('password123'))  # 输出: True
```

在这个示例中，我们使用 `create_user` 方法创建了一个新用户，并设置了用户名、电子邮件和密码。然后，我们设置了用户的名字和姓氏，并保存了用户对象。最后，我们使用 `check_password` 方法验证了用户输入的密码。

## 扩展用户模型

虽然默认的用户模型已经非常强大，但在实际应用中，我们通常需要存储更多的用户信息，例如用户的电话号码、地址或头像。为了满足这些需求，Django允许我们扩展默认的用户模型。

### 方法一：使用 `OneToOneField` 扩展用户模型

一种常见的扩展用户模型的方法是使用 `OneToOneField` 创建一个与 `User` 模型关联的模型。以下是一个示例：

```python
from django.contrib.auth.models import User
from django.db import models

class Profile(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE)
    phone_number = models.CharField(max_length=15, blank=True)
    address = models.CharField(max_length=255, blank=True)
    avatar = models.ImageField(upload_to='avatars/', blank=True)

    def __str__(self):
        return f'{self.user.username} Profile'
```

在这个示例中，我们创建了一个 `Profile` 模型，它与 `User` 模型通过 `OneToOneField` 关联。`Profile` 模型包含了用户的电话号码、地址和头像等额外信息。

### 方法二：自定义用户模型

另一种更灵活的方法是创建一个自定义的用户模型，继承自 `AbstractUser` 或 `AbstractBaseUser`。以下是一个使用 `AbstractUser` 的示例：

```python
from django.contrib.auth.models import AbstractUser
from django.db import models

class CustomUser(AbstractUser):
    phone_number = models.CharField(max_length=15, blank=True)
    address = models.CharField(max_length=255, blank=True)
    avatar = models.ImageField(upload_to='avatars/', blank=True)

    def __str__(self):
        return self.username
```

在这个示例中，我们创建了一个 `CustomUser` 模型，它继承自 `AbstractUser`，并添加了电话号码、地址和头像等字段。

:::note
在使用自定义用户模型时，需要在 `settings.py` 中指定 `AUTH_USER_MODEL` 设置：

```python
AUTH_USER_MODEL = 'myapp.CustomUser'
```

这将告诉Django使用自定义的用户模型而不是默认的 `User` 模型。
:::

## 实际应用场景

假设我们正在开发一个电子商务网站，需要存储用户的送货地址和支付信息。我们可以通过扩展用户模型来实现这一需求：

```python
from django.contrib.auth.models import AbstractUser
from django.db import models

class CustomUser(AbstractUser):
    phone_number = models.CharField(max_length=15, blank=True)
    shipping_address = models.CharField(max_length=255, blank=True)
    billing_address = models.CharField(max_length=255, blank=True)

    def __str__(self):
        return self.username
```

在这个示例中，我们添加了 `shipping_address` 和 `billing_address` 字段，用于存储用户的送货地址和支付信息。

## 总结

Django的用户模型是构建用户认证系统的基础。默认的用户模型已经提供了许多有用的功能，但在实际应用中，我们通常需要扩展它以存储更多的用户信息。通过使用 `OneToOneField` 或自定义用户模型，我们可以轻松地扩展用户模型以满足实际需求。

## 附加资源与练习

- **官方文档**: [Django用户模型](https://docs.djangoproject.com/en/stable/topics/auth/customizing/)
- **练习**: 尝试创建一个自定义用户模型，并添加一些额外的字段，例如用户的生日或性别。然后，编写视图和模板来显示这些信息。

通过本文的学习，你应该已经掌握了Django用户模型的基本概念和扩展方法。继续实践和探索，你将能够构建更复杂的用户认证系统。