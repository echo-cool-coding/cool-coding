---
title: Django 令牌认证
description: 了解如何在Django中使用令牌认证（Token Authentication）来保护API端点，并实现用户身份验证。
---

# Django 令牌认证

在现代Web开发中，API的安全性至关重要。Django提供了多种认证方式，其中**令牌认证（Token Authentication）**是一种简单且高效的方式，特别适用于无状态（stateless）的API。本文将详细介绍Django中的令牌认证，并通过实际案例帮助你理解其工作原理和应用场景。

## 什么是令牌认证？

令牌认证是一种基于令牌（Token）的身份验证机制。用户通过提供有效的用户名和密码登录后，服务器会生成一个唯一的令牌并返回给客户端。客户端在后续的请求中，需要在HTTP头中携带该令牌，服务器通过验证令牌来确认用户身份。

令牌认证的主要优点包括：
- **无状态**：服务器不需要存储会话信息，适合分布式系统。
- **安全性**：令牌可以设置过期时间，减少安全风险。
- **灵活性**：适用于多种客户端（如移动端、Web端等）。

## 如何在Django中实现令牌认证？

Django提供了一个名为`django-rest-framework`的第三方库，它内置了对令牌认证的支持。以下是实现令牌认证的步骤：

### 1. 安装`django-rest-framework`

首先，确保你已经安装了`django-rest-framework`。如果没有安装，可以通过以下命令安装：

```bash
pip install djangorestframework
```

### 2. 配置Django项目

在`settings.py`中，将`rest_framework`和`rest_framework.authtoken`添加到`INSTALLED_APPS`中：

```python
INSTALLED_APPS = [
    ...
    'rest_framework',
    'rest_framework.authtoken',
    ...
]
```

然后，配置`REST_FRAMEWORK`的默认认证类：

```python
REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.TokenAuthentication',
    ],
}
```

### 3. 创建并应用数据库迁移

运行以下命令来创建令牌认证所需的数据库表：

```bash
python manage.py migrate
```

### 4. 为用户生成令牌

你可以通过Django的管理界面或命令行为用户生成令牌。以下是通过命令行生成令牌的示例：

```bash
python manage.py drf_create_token <username>
```

### 5. 在视图中使用令牌认证

假设你有一个简单的API视图，你可以在视图中使用`TokenAuthentication`来保护它：

```python
from rest_framework.authentication import TokenAuthentication
from rest_framework.permissions import IsAuthenticated
from rest_framework.response import Response
from rest_framework.views import APIView

class ProtectedView(APIView):
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated]

    def get(self, request):
        return Response({"message": "This is a protected view!"})
```

### 6. 客户端如何使用令牌？

客户端在登录后，会收到一个令牌。在后续的请求中，客户端需要在HTTP头中携带该令牌：

```http
Authorization: Token <your_token>
```

例如，使用`curl`命令访问受保护的API：

```bash
curl -X GET http://localhost:8000/api/protected/ -H 'Authorization: Token <your_token>'
```

## 实际应用场景

假设你正在开发一个移动应用，用户需要通过API登录并访问个人数据。你可以使用令牌认证来确保只有经过身份验证的用户才能访问这些数据。

1. **用户登录**：用户通过提供用户名和密码登录，服务器返回一个令牌。
2. **访问个人数据**：用户在后续请求中携带该令牌，服务器验证令牌并返回个人数据。

## 总结

Django的令牌认证是一种简单且高效的身份验证机制，特别适用于无状态的API。通过本文的介绍，你应该已经掌握了如何在Django中实现令牌认证，并了解了其实际应用场景。

:::tip
如果你想进一步学习，可以尝试以下练习：
1. 为你的Django项目添加令牌认证。
2. 尝试为令牌设置过期时间。
3. 探索其他认证方式，如JWT（JSON Web Token）。
:::

:::note
**附加资源**：
- [Django REST Framework官方文档](https://www.django-rest-framework.org/)
- [Token Authentication in DRF](https://www.django-rest-framework.org/api-guide/authentication/#tokenauthentication)
:::