---
title: Django 模板上下文
description: 了解Django模板上下文的概念及其在模板渲染中的作用，掌握如何传递和使用上下文数据。
---

## 介绍

在Django中，模板上下文（Template Context）是将数据从视图传递到模板的桥梁。它允许你在模板中动态地显示数据，从而使网页内容更加灵活和可定制。模板上下文是一个字典（dictionary），其中键是变量名，值是对应的数据。在模板中，你可以通过变量名访问这些数据。

## 什么是模板上下文？

模板上下文是Django视图与模板之间的数据传递机制。当视图渲染模板时，它会将数据打包成一个上下文对象，并将其传递给模板引擎。模板引擎随后会根据上下文中的数据渲染模板。

### 示例：简单的上下文传递

假设我们有一个视图函数 `my_view`，它返回一个包含用户名的上下文：

```python
from django.shortcuts import render

def my_view(request):
    context = {
        'username': 'Alice',
        'age': 25
    }
    return render(request, 'my_template.html', context)
```

在模板 `my_template.html` 中，你可以通过 `{{ username }}` 和 `{{ age }}` 访问这些数据：

```html
<p>Welcome, {{ username }}! You are {{ age }} years old.</p>
```

渲染后的输出将是：

```html
<p>Welcome, Alice! You are 25 years old.</p>
```

## 上下文的传递方式

Django提供了多种方式来传递上下文数据：

1. **通过视图函数传递**：如上例所示，视图函数可以通过 `render` 函数的第三个参数传递上下文。
2. **通过类视图传递**：在基于类的视图中，你可以重写 `get_context_data` 方法来添加额外的上下文数据。
3. **通过模板标签传递**：某些模板标签（如 `{% with %}`）可以在模板中创建临时的上下文变量。

### 示例：类视图中的上下文传递

```python
from django.views.generic import TemplateView

class MyView(TemplateView):
    template_name = 'my_template.html'

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['username'] = 'Bob'
        context['age'] = 30
        return context
```

在这个例子中，`get_context_data` 方法被重写以添加额外的上下文数据。

## 上下文处理器

Django还提供了上下文处理器（Context Processors），它们可以在每个请求中自动向模板上下文添加数据。上下文处理器是一个函数，它接收一个 `HttpRequest` 对象并返回一个字典，该字典将被合并到模板上下文中。

### 示例：自定义上下文处理器

假设我们想要在每个模板中显示当前时间，可以创建一个上下文处理器：

```python
from datetime import datetime

def current_time(request):
    return {
        'current_time': datetime.now()
    }
```

然后，在 `settings.py` 中将这个处理器添加到 `TEMPLATES` 配置中：

```python
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'OPTIONS': {
            'context_processors': [
                # 其他处理器
                'myapp.context_processors.current_time',
            ],
        },
    },
]
```

现在，在每个模板中都可以使用 `{{ current_time }}` 来访问当前时间。

## 实际应用场景

### 场景1：用户个人资料页面

假设你正在开发一个用户个人资料页面，需要显示用户的姓名、邮箱和注册日期。你可以通过视图传递这些数据：

```python
def profile_view(request):
    user = request.user
    context = {
        'name': user.get_full_name(),
        'email': user.email,
        'joined': user.date_joined
    }
    return render(request, 'profile.html', context)
```

在模板 `profile.html` 中：

```html
<h1>{{ name }}</h1>
<p>Email: {{ email }}</p>
<p>Joined: {{ joined }}</p>
```

### 场景2：动态导航栏

假设你希望在导航栏中显示当前用户的未读消息数量。你可以通过上下文处理器来实现：

```python
def unread_messages(request):
    if request.user.is_authenticated:
        return {
            'unread_messages': request.user.messages.filter(read=False).count()
        }
    return {}
```

在模板中：

```html
<nav>
    <a href="/messages">Messages ({{ unread_messages }})</a>
</nav>
```

## 总结

Django模板上下文是连接视图和模板的关键机制。通过上下文，你可以将动态数据传递给模板，并在模板中使用这些数据来生成最终的HTML页面。无论是通过视图函数、类视图还是上下文处理器，Django都提供了灵活的方式来管理模板上下文。

## 附加资源与练习

- **练习1**：创建一个视图，传递一个包含多个用户信息的上下文，并在模板中显示这些信息。
- **练习2**：编写一个自定义上下文处理器，将网站的版本号添加到每个模板的上下文中。
- **阅读**：[Django官方文档 - 模板上下文](https://docs.djangoproject.com/en/stable/ref/templates/api/#context)

通过掌握Django模板上下文，你将能够更灵活地控制模板中的数据展示，从而创建更加动态和个性化的网页。