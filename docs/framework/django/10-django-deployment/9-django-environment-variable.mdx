---
title: Django 环境变量
description: 了解如何在Django项目中使用环境变量来管理敏感信息和配置，确保应用程序的安全性和灵活性。
---

# Django 环境变量

在开发Django应用程序时，管理敏感信息（如数据库密码、API密钥等）和配置选项是一个重要的任务。为了确保这些信息的安全性，我们通常不会将它们直接硬编码在代码中，而是使用**环境变量**来存储和管理这些信息。本文将详细介绍如何在Django项目中使用环境变量，并通过实际案例展示其应用场景。

## 什么是环境变量？

环境变量是操作系统或应用程序运行时使用的动态值。它们通常用于存储配置信息、路径、密钥等。在Django中，环境变量可以帮助我们将敏感信息与代码分离，从而提高代码的安全性和可维护性。

## 为什么使用环境变量？

1. **安全性**：避免将敏感信息（如数据库密码、API密钥）硬编码在代码中，防止泄露。
2. **灵活性**：通过环境变量，可以在不同的环境（开发、测试、生产）中使用不同的配置，而无需修改代码。
3. **可维护性**：将配置信息集中管理，便于维护和更新。

## 如何在Django中使用环境变量？

### 1. 安装 `python-decouple` 库

为了更方便地管理环境变量，我们可以使用 `python-decouple` 库。首先，安装该库：

```bash
pip install python-decouple
```

### 2. 创建 `.env` 文件

在Django项目的根目录下创建一个 `.env` 文件，用于存储环境变量。例如：

```plaintext
SECRET_KEY=your-secret-key
DEBUG=True
DATABASE_URL=postgres://user:password@localhost:5432/mydatabase
```

### 3. 在 `settings.py` 中使用环境变量

在 `settings.py` 文件中，使用 `python-decouple` 来读取环境变量：

```python
from decouple import config

SECRET_KEY = config('SECRET_KEY')
DEBUG = config('DEBUG', default=False, cast=bool)
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': config('DATABASE_NAME'),
        'USER': config('DATABASE_USER'),
        'PASSWORD': config('DATABASE_PASSWORD'),
        'HOST': config('DATABASE_HOST'),
        'PORT': config('DATABASE_PORT', default='5432'),
    }
}
```

:::note
`config` 函数的第二个参数是默认值，如果环境变量未设置，则使用该默认值。`cast` 参数用于将环境变量的值转换为指定的类型（如布尔值、整数等）。
:::

### 4. 在开发和生产环境中使用不同的 `.env` 文件

在开发环境中，我们可以使用 `.env.development` 文件，而在生产环境中使用 `.env.production` 文件。通过设置环境变量 `DJANGO_SETTINGS_MODULE` 来指定使用哪个 `.env` 文件。

```bash
export DJANGO_SETTINGS_MODULE=myproject.settings.development
```

## 实际案例

假设我们有一个Django项目，需要在开发和生产环境中使用不同的数据库配置。我们可以通过以下步骤实现：

1. 在 `.env.development` 文件中配置开发环境的数据库信息：

```plaintext
DATABASE_NAME=dev_db
DATABASE_USER=dev_user
DATABASE_PASSWORD=dev_password
DATABASE_HOST=localhost
DATABASE_PORT=5432
```

2. 在 `.env.production` 文件中配置生产环境的数据库信息：

```plaintext
DATABASE_NAME=prod_db
DATABASE_USER=prod_user
DATABASE_PASSWORD=prod_password
DATABASE_HOST=prod_host
DATABASE_PORT=5432
```

3. 在 `settings.py` 中根据环境变量加载不同的配置：

```python
from decouple import config

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': config('DATABASE_NAME'),
        'USER': config('DATABASE_USER'),
        'PASSWORD': config('DATABASE_PASSWORD'),
        'HOST': config('DATABASE_HOST'),
        'PORT': config('DATABASE_PORT', default='5432'),
    }
}
```

:::tip
通过这种方式，我们可以在不同的环境中轻松切换数据库配置，而无需修改代码。
:::

## 总结

在Django项目中使用环境变量是一种有效的方式来管理敏感信息和配置选项。通过将配置信息存储在环境变量中，我们可以提高代码的安全性、灵活性和可维护性。本文介绍了如何使用 `python-decouple` 库来管理环境变量，并通过实际案例展示了其应用场景。

## 附加资源

- [python-decouple 官方文档](https://github.com/henriquebastos/python-decouple)
- [Django 官方文档 - 设置](https://docs.djangoproject.com/en/stable/topics/settings/)

## 练习

1. 在你的Django项目中创建一个 `.env` 文件，并将 `SECRET_KEY` 和 `DEBUG` 配置项移动到该文件中。
2. 尝试在不同的环境中使用不同的 `.env` 文件，并验证配置是否正确加载。

通过以上步骤，你将掌握如何在Django项目中使用环境变量来管理配置信息。祝你学习愉快！