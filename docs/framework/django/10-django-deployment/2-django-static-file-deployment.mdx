---
title: Django 静态文件部署
description: 学习如何在Django项目中正确部署静态文件，包括CSS、JavaScript和图片等资源，确保生产环境中静态文件的高效加载。
---

## 介绍

在Django项目中，静态文件（如CSS、JavaScript和图片）是网站外观和功能的重要组成部分。在开发环境中，Django会自动处理这些文件，但在生产环境中，静态文件的处理方式有所不同。本文将详细介绍如何在生产环境中正确部署Django静态文件。

## 静态文件的基本概念

静态文件是指那些不会随着用户请求而改变的文件，例如CSS样式表、JavaScript脚本和图片。在Django中，这些文件通常存放在`static`目录下。

### 开发环境中的静态文件

在开发环境中，Django提供了一个方便的方式来处理静态文件。你只需要在`settings.py`中设置`STATIC_URL`，并在模板中使用`{% static %}`标签来引用静态文件。

```python
# settings.py
STATIC_URL = '/static/'
```

```html
<!-- 模板文件 -->
<link rel="stylesheet" href="{% static 'css/style.css' %}">
```

### 生产环境中的静态文件

在生产环境中，Django不会自动处理静态文件。你需要使用`collectstatic`命令将所有静态文件收集到一个目录中，并通过Web服务器（如Nginx或Apache）来提供这些文件。

## 部署静态文件的步骤

### 1. 配置`STATIC_ROOT`

首先，你需要在`settings.py`中设置`STATIC_ROOT`，这是`collectstatic`命令将静态文件收集到的目录。

```python
# settings.py
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
```

### 2. 运行`collectstatic`命令

在部署之前，运行以下命令将所有静态文件收集到`STATIC_ROOT`目录中：

```bash
python manage.py collectstatic
```

### 3. 配置Web服务器

接下来，你需要配置Web服务器来提供静态文件。以下是Nginx的配置示例：

```nginx
server {
    location /static/ {
        alias /path/to/your/staticfiles/;
    }
}
```

### 4. 确保`DEBUG`为`False`

在生产环境中，确保`settings.py`中的`DEBUG`设置为`False`，以避免Django尝试处理静态文件。

```python
# settings.py
DEBUG = False
```

## 实际案例

假设你有一个Django项目，项目结构如下：

```
myproject/
├── myproject/
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── myapp/
│   ├── static/
│   │   └── myapp/
│   │       └── css/
│   │           └── style.css
│   └── templates/
│       └── myapp/
│           └── index.html
└── manage.py
```

在`settings.py`中，你设置了`STATIC_ROOT`：

```python
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
```

运行`collectstatic`后，所有静态文件将被收集到`staticfiles`目录中：

```
myproject/
├── staticfiles/
│   └── myapp/
│       └── css/
│           └── style.css
└── ...
```

然后，你配置Nginx来提供这些静态文件：

```nginx
server {
    location /static/ {
        alias /path/to/myproject/staticfiles/;
    }
}
```

## 总结

在生产环境中正确部署Django静态文件是确保网站高效运行的关键步骤。通过配置`STATIC_ROOT`、运行`collectstatic`命令以及配置Web服务器，你可以确保静态文件在生产环境中被正确加载。

## 附加资源

- [Django官方文档 - 静态文件](https://docs.djangoproject.com/en/stable/howto/static-files/)
- [Nginx官方文档](https://nginx.org/en/docs/)

## 练习

1. 在你的Django项目中，尝试配置`STATIC_ROOT`并运行`collectstatic`命令。
2. 配置Nginx或Apache来提供静态文件，并验证静态文件是否正确加载。
