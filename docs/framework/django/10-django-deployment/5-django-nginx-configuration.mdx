---
title: Django Nginx 配置
description: 学习如何配置 Nginx 作为 Django 应用的反向代理服务器，以提升性能和安全性。
---

# Django Nginx 配置

在部署 Django 应用时，Nginx 是一个常用的反向代理服务器。它可以帮助我们处理静态文件、负载均衡以及提高应用的安全性。本文将详细介绍如何配置 Nginx 以与 Django 应用协同工作。

## 什么是 Nginx？

Nginx 是一个高性能的 HTTP 服务器和反向代理服务器。它以其高并发处理能力和低内存消耗而闻名，非常适合用于生产环境中部署 Django 应用。

## 为什么使用 Nginx？

- **静态文件处理**：Nginx 可以高效地处理静态文件（如 CSS、JavaScript、图片等），减轻 Django 应用的负担。
- **反向代理**：Nginx 可以作为反向代理，将请求转发给 Django 应用服务器（如 Gunicorn 或 uWSGI）。
- **负载均衡**：Nginx 可以在多个应用服务器之间分配请求，提高系统的可用性和性能。
- **安全性**：Nginx 提供了多种安全功能，如 SSL/TLS 加密、请求过滤等。

## 安装 Nginx

在开始配置之前，首先需要在服务器上安装 Nginx。以下是在 Ubuntu 系统上安装 Nginx 的命令：

```bash
sudo apt update
sudo apt install nginx
```

安装完成后，可以通过以下命令启动 Nginx 服务：

```bash
sudo systemctl start nginx
```

## 配置 Nginx 作为 Django 的反向代理

### 1. 创建 Nginx 配置文件

首先，我们需要为 Django 应用创建一个新的 Nginx 配置文件。通常，Nginx 的配置文件位于 `/etc/nginx/sites-available/` 目录下。我们可以创建一个新的配置文件，例如 `my_django_app`：

```bash
sudo nano /etc/nginx/sites-available/my_django_app
```

### 2. 配置 Nginx

在配置文件中，我们需要指定 Nginx 如何处理请求。以下是一个基本的配置示例：

```nginx
server {
    listen 80;
    server_name your_domain.com;

    location /static/ {
        alias /path/to/your/static/files/;
    }

    location /media/ {
        alias /path/to/your/media/files/;
    }

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

:::note
- `server_name`：替换为你的域名或 IP 地址。
- `/static/` 和 `/media/`：分别指向 Django 项目的静态文件和媒体文件目录。
- `proxy_pass`：将请求转发给 Django 应用服务器（如 Gunicorn 或 uWSGI），通常运行在 `127.0.0.1:8000`。
:::

### 3. 启用配置文件

创建配置文件后，需要将其链接到 `/etc/nginx/sites-enabled/` 目录以启用配置：

```bash
sudo ln -s /etc/nginx/sites-available/my_django_app /etc/nginx/sites-enabled/
```

### 4. 测试并重启 Nginx

在重启 Nginx 之前，建议先测试配置文件是否正确：

```bash
sudo nginx -t
```

如果测试通过，可以重启 Nginx 以应用新的配置：

```bash
sudo systemctl restart nginx
```

## 实际案例

假设我们有一个 Django 项目，项目结构如下：

```
/my_django_project
    /static
    /media
    /my_app
    manage.py
```

我们需要将 `/static/` 和 `/media/` 目录分别映射到 Nginx 的配置文件中。假设静态文件位于 `/my_django_project/static/`，媒体文件位于 `/my_django_project/media/`，则 Nginx 配置如下：

```nginx
server {
    listen 80;
    server_name example.com;

    location /static/ {
        alias /my_django_project/static/;
    }

    location /media/ {
        alias /my_django_project/media/;
    }

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## 总结

通过配置 Nginx 作为 Django 应用的反向代理，我们可以显著提升应用的性能和安全性。Nginx 不仅可以高效地处理静态文件，还可以作为反向代理将请求转发给 Django 应用服务器。

## 附加资源

- [Nginx 官方文档](https://nginx.org/en/docs/)
- [Django 部署指南](https://docs.djangoproject.com/en/stable/howto/deployment/)
- [Gunicorn 文档](https://docs.gunicorn.org/en/stable/)

## 练习

1. 尝试在本地环境中安装并配置 Nginx，将其作为 Django 应用的反向代理。
2. 修改 Nginx 配置文件，使其支持 HTTPS（SSL/TLS 加密）。
3. 使用 Nginx 的负载均衡功能，配置多个 Django 应用服务器。

通过以上步骤，你将能够熟练地配置 Nginx 以部署 Django 应用。