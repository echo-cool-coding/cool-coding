---
title: Django 管理站点表单
description: 了解如何在Django管理站点中使用表单，自定义表单字段，以及如何通过表单管理模型数据。
---

# Django 管理站点表单

Django的管理站点（Admin Site）是一个强大的工具，允许开发者快速创建和管理后台界面。通过Django的管理站点，你可以轻松地管理数据库中的数据，而无需编写额外的代码。其中，表单是管理站点的重要组成部分，它允许你以结构化的方式输入和编辑数据。

在本教程中，我们将深入探讨Django管理站点中的表单，包括如何自定义表单字段、验证数据以及处理表单提交。

## 什么是Django管理站点表单？

Django管理站点表单是用于在管理后台中创建、更新和删除模型实例的界面。每个模型在管理站点中都有一个默认的表单，该表单会自动生成，基于模型的字段。然而，Django允许你自定义这些表单，以满足特定的需求。

### 默认表单

当你注册一个模型到Django管理站点时，Django会自动为该模型生成一个默认的表单。这个表单包含模型的所有字段，并且会根据字段类型自动选择合适的表单控件（如文本框、下拉菜单等）。

例如，假设我们有一个简单的 `Book` 模型：

```python
from django.db import models

class Book(models.Model):
    title = models.CharField(max_length=100)
    author = models.CharField(max_length=100)
    published_date = models.DateField()
```

在管理站点中注册这个模型后，Django会自动生成一个包含 `title`、`author` 和 `published_date` 字段的表单。

### 自定义表单

虽然默认表单已经足够强大，但在某些情况下，你可能需要自定义表单。例如，你可能希望隐藏某些字段、添加额外的验证逻辑，或者更改字段的显示方式。

要自定义表单，你可以创建一个自定义的 `ModelForm`，并在 `ModelAdmin` 类中使用它。

```python
from django import forms
from .models import Book

class BookForm(forms.ModelForm):
    class Meta:
        model = Book
        fields = ['title', 'author', 'published_date']

    def clean_title(self):
        title = self.cleaned_data['title']
        if len(title) < 5:
            raise forms.ValidationError("Title must be at least 5 characters long.")
        return title
```

在这个例子中，我们创建了一个 `BookForm`，并添加了一个自定义的验证逻辑，确保书名至少包含5个字符。

接下来，我们需要在 `ModelAdmin` 类中使用这个自定义表单：

```python
from django.contrib import admin
from .models import Book
from .forms import BookForm

class BookAdmin(admin.ModelAdmin):
    form = BookForm

admin.site.register(Book, BookAdmin)
```

现在，当你在管理站点中编辑或创建一本书时，将使用这个自定义表单，并且会应用我们定义的验证逻辑。

## 实际案例：自定义表单字段

假设我们有一个 `Product` 模型，其中包含 `name`、`price` 和 `description` 字段。我们希望在产品管理表单中隐藏 `description` 字段，并且将 `price` 字段的标签更改为“售价”。

首先，我们创建一个自定义表单：

```python
from django import forms
from .models import Product

class ProductForm(forms.ModelForm):
    class Meta:
        model = Product
        fields = ['name', 'price']

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.fields['price'].label = "售价"
```

在这个表单中，我们只包含了 `name` 和 `price` 字段，并且在 `__init__` 方法中更改了 `price` 字段的标签。

接下来，我们在 `ModelAdmin` 类中使用这个表单：

```python
from django.contrib import admin
from .models import Product
from .forms import ProductForm

class ProductAdmin(admin.ModelAdmin):
    form = ProductForm

admin.site.register(Product, ProductAdmin)
```

现在，当你在管理站点中编辑或创建一个产品时，`description` 字段将不会显示，并且 `price` 字段的标签将显示为“售价”。

## 总结

Django管理站点表单是管理后台中用于处理模型数据的重要工具。通过自定义表单，你可以灵活地控制字段的显示、验证逻辑以及其他行为。无论是隐藏字段、更改标签，还是添加自定义验证，Django都提供了强大的工具来满足你的需求。

### 附加资源

- [Django官方文档 - 管理站点](https://docs.djangoproject.com/en/stable/ref/contrib/admin/)
- [Django官方文档 - 表单](https://docs.djangoproject.com/en/stable/topics/forms/)

### 练习

1. 创建一个 `Student` 模型，包含 `name`、`age` 和 `grade` 字段。在管理站点中自定义表单，隐藏 `age` 字段，并将 `grade` 字段的标签更改为“年级”。
2. 在 `Student` 表单中添加一个自定义验证，确保 `grade` 字段的值在1到12之间。

通过完成这些练习，你将更好地理解如何在Django管理站点中使用和自定义表单。