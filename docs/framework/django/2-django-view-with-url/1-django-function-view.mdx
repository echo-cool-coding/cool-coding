---
title: Django 函数视图
description: 了解 Django 中的函数视图，掌握如何通过简单的 Python 函数处理 HTTP 请求并返回响应。
---

# Django 函数视图

在 Django 中，视图（View）是处理用户请求并返回响应的核心组件。视图可以是基于函数的，也可以是基于类的。本文将重点介绍 **函数视图**，这是 Django 中最基础且常用的视图类型。

## 什么是函数视图？

函数视图是一个简单的 Python 函数，它接收一个 `HttpRequest` 对象作为参数，并返回一个 `HttpResponse` 对象。通过函数视图，你可以定义如何处理用户的请求，并生成相应的响应。

### 基本结构

一个典型的函数视图如下所示：

```python
from django.http import HttpResponse

def hello_world(request):
    return HttpResponse("Hello, World!")
```

在这个例子中，`hello_world` 是一个函数视图。它接收一个 `request` 参数（即 `HttpRequest` 对象），并返回一个包含 "Hello, World!" 文本的 `HttpResponse` 对象。

:::tip
`HttpRequest` 对象包含了用户请求的所有信息，例如请求方法（GET、POST 等）、请求头、请求体等。`HttpResponse` 对象则是 Django 用来生成 HTTP 响应的工具。
:::

## 如何将函数视图与 URL 映射？

在 Django 中，视图需要通过 URL 配置来与特定的 URL 路径关联。以下是一个简单的 URL 配置示例：

```python
from django.urls import path
from .views import hello_world

urlpatterns = [
    path('hello/', hello_world),
]
```

在这个例子中，当用户访问 `/hello/` 路径时，Django 会调用 `hello_world` 视图函数，并返回 "Hello, World!"。

:::note
`path()` 函数用于将 URL 路径与视图函数关联。第一个参数是 URL 路径，第二个参数是对应的视图函数。
:::

## 处理不同的 HTTP 方法

函数视图可以根据请求的 HTTP 方法（如 GET、POST）执行不同的逻辑。以下是一个处理 GET 和 POST 请求的示例：

```python
from django.http import HttpResponse

def greet_user(request):
    if request.method == 'GET':
        return HttpResponse("Please submit your name.")
    elif request.method == 'POST':
        name = request.POST.get('name', 'Guest')
        return HttpResponse(f"Hello, {name}!")
```

在这个例子中，如果用户通过 GET 方法访问该视图，会返回 "Please submit your name."。如果用户通过 POST 方法提交表单数据，视图会读取表单中的 `name` 字段，并返回个性化的问候。

:::caution
在处理 POST 请求时，务必确保表单数据的安全性，避免潜在的安全漏洞，如 SQL 注入或跨站脚本攻击（XSS）。
:::

## 实际应用场景

假设你正在开发一个博客应用，用户可以提交评论。以下是一个处理评论提交的函数视图示例：

```python
from django.http import HttpResponse, HttpResponseRedirect
from django.shortcuts import render
from .models import Comment

def submit_comment(request):
    if request.method == 'POST':
        comment_text = request.POST.get('comment', '')
        if comment_text:
            Comment.objects.create(text=comment_text)
            return HttpResponseRedirect('/thank-you/')
        else:
            return HttpResponse("Comment cannot be empty.", status=400)
    else:
        return render(request, 'comment_form.html')
```

在这个例子中，如果用户提交了一个有效的评论，视图会将其保存到数据库中，并重定向到感谢页面。如果评论为空，视图会返回一个错误响应。

:::note
`HttpResponseRedirect` 用于重定向用户到另一个 URL，而 `render` 函数用于渲染模板并返回响应。
:::

## 总结

函数视图是 Django 中最基础的视图类型，适合处理简单的逻辑。通过函数视图，你可以轻松地处理 HTTP 请求并生成响应。以下是本文的关键点：

1. 函数视图是一个接收 `HttpRequest` 并返回 `HttpResponse` 的 Python 函数。
2. 通过 URL 配置将视图与特定的 URL 路径关联。
3. 可以根据请求的 HTTP 方法（如 GET、POST）执行不同的逻辑。
4. 函数视图适用于处理简单的业务逻辑，如表单提交、数据展示等。

## 附加资源与练习

- **练习 1**：创建一个函数视图，返回当前日期和时间。
- **练习 2**：编写一个函数视图，处理用户登录表单（假设用户名和密码为固定值）。
- **进一步学习**：阅读 Django 官方文档中关于 [视图](https://docs.djangoproject.com/en/stable/topics/http/views/) 的部分，了解更多高级用法。

通过本文的学习，你应该已经掌握了 Django 函数视图的基本概念和使用方法。接下来，尝试在实际项目中应用这些知识，进一步提升你的 Django 技能！