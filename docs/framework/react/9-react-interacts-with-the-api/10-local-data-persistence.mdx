---
title: 数据本地持久化
description: 学习如何在 React 应用中实现数据本地持久化，确保数据在页面刷新或关闭后仍然可用。
---

# 数据本地持久化

在开发 React 应用时，我们经常需要与 API 进行交互以获取或提交数据。然而，有时我们希望这些数据在用户刷新页面或关闭浏览器后仍然可用。这就是**数据本地持久化**的用武之地。本文将详细介绍如何在 React 应用中实现数据本地持久化，并通过实际案例展示其应用场景。

## 什么是数据本地持久化？

数据本地持久化是指将数据存储在用户的浏览器中，以便在页面刷新或关闭后仍然可以访问这些数据。常见的持久化方式包括使用浏览器的 `localStorage`、`sessionStorage` 和 `IndexedDB`。本文将重点介绍 `localStorage` 的使用。

## 使用 `localStorage` 实现数据持久化

`localStorage` 是浏览器提供的一种简单的键值对存储方式。它的数据不会随着页面刷新或关闭而丢失，除非用户手动清除浏览器缓存。

### 基本操作

`localStorage` 提供了以下基本操作：

- **存储数据**：`localStorage.setItem(key, value)`
- **获取数据**：`localStorage.getItem(key)`
- **删除数据**：`localStorage.removeItem(key)`
- **清空所有数据**：`localStorage.clear()`

### 示例代码

以下是一个简单的示例，展示如何在 React 中使用 `localStorage` 存储和获取数据：

```javascript
import React, { useState, useEffect } from 'react';

function App() {
  const [inputValue, setInputValue] = useState('');
  const [storedValue, setStoredValue] = useState('');

  // 保存数据到 localStorage
  const saveData = () => {
    localStorage.setItem('userInput', inputValue);
    setStoredValue(inputValue);
  };

  // 从 localStorage 获取数据
  useEffect(() => {
    const savedValue = localStorage.getItem('userInput');
    if (savedValue) {
      setStoredValue(savedValue);
    }
  }, []);

  return (
    <div>
      <input
        type="text"
        value={inputValue}
        onChange={(e) => setInputValue(e.target.value)}
      />
      <button onClick={saveData}>保存</button>
      <p>已保存的值: {storedValue}</p>
    </div>
  );
}

export default App;
```

### 代码解释

1. **状态管理**：我们使用 `useState` 来管理输入框的值和从 `localStorage` 获取的值。
2. **保存数据**：当用户点击“保存”按钮时，输入框的值会被保存到 `localStorage` 中。
3. **获取数据**：在组件挂载时，我们使用 `useEffect` 从 `localStorage` 中获取之前保存的值，并将其显示在页面上。

:::tip
`localStorage` 只能存储字符串类型的数据。如果你需要存储对象或数组，可以使用 `JSON.stringify` 和 `JSON.parse` 进行转换。
:::

## 实际应用场景

### 用户偏好设置

假设你正在开发一个支持主题切换的应用。用户可以选择自己喜欢的主题（如“深色”或“浅色”），并且希望这个设置在页面刷新后仍然有效。你可以使用 `localStorage` 来存储用户的选择。

```javascript
import React, { useState, useEffect } from 'react';

function ThemeSwitcher() {
  const [theme, setTheme] = useState('light');

  // 保存主题到 localStorage
  const saveTheme = (selectedTheme) => {
    localStorage.setItem('theme', selectedTheme);
    setTheme(selectedTheme);
  };

  // 从 localStorage 获取主题
  useEffect(() => {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      setTheme(savedTheme);
    }
  }, []);

  return (
    <div>
      <button onClick={() => saveTheme('light')}>浅色主题</button>
      <button onClick={() => saveTheme('dark')}>深色主题</button>
      <p>当前主题: {theme}</p>
    </div>
  );
}

export default ThemeSwitcher;
```

### 购物车数据

在电商网站中，用户可能会将商品添加到购物车中。即使页面刷新或关闭，购物车中的商品信息仍然需要保留。你可以使用 `localStorage` 来存储购物车数据。

```javascript
import React, { useState, useEffect } from 'react';

function ShoppingCart() {
  const [cart, setCart] = useState([]);

  // 保存购物车数据到 localStorage
  const saveCart = (newCart) => {
    localStorage.setItem('cart', JSON.stringify(newCart));
    setCart(newCart);
  };

  // 从 localStorage 获取购物车数据
  useEffect(() => {
    const savedCart = JSON.parse(localStorage.getItem('cart'));
    if (savedCart) {
      setCart(savedCart);
    }
  }, []);

  const addToCart = (product) => {
    const newCart = [...cart, product];
    saveCart(newCart);
  };

  return (
    <div>
      <button onClick={() => addToCart({ id: 1, name: '商品1' })}>添加商品1</button>
      <button onClick={() => addToCart({ id: 2, name: '商品2' })}>添加商品2</button>
      <ul>
        {cart.map((item, index) => (
          <li key={index}>{item.name}</li>
        ))}
      </ul>
    </div>
  );
}

export default ShoppingCart;
```

## 总结

数据本地持久化是 React 应用开发中的一个重要概念，尤其是在需要保存用户数据或应用状态时。通过使用 `localStorage`，我们可以轻松实现数据的持久化存储，并在页面刷新或关闭后仍然保持数据的可用性。

:::caution
`localStorage` 的数据存储容量有限（通常为 5MB），并且不适合存储敏感信息（如密码或支付信息）。对于更复杂的存储需求，可以考虑使用 `IndexedDB` 或其他数据库解决方案。
:::

## 附加资源与练习

- **练习**：尝试在 React 应用中实现一个简单的待办事项列表，并使用 `localStorage` 保存待办事项数据。
- **资源**：
  - [MDN Web Docs: localStorage](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage)
  - [React 官方文档](https://reactjs.org/docs/hooks-intro.html)

通过本文的学习，你应该已经掌握了如何在 React 应用中实现数据本地持久化的基本方法。继续练习并探索更多高级用法，以提升你的开发技能！