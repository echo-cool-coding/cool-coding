---
title: Next.js 数据获取
description: 了解如何在 Next.js 中实现服务端渲染（SSR）和静态生成（SSG）的数据获取方法，包括 `getStaticProps`、`getServerSideProps` 和 `getStaticPaths`。
---

在构建现代 Web 应用程序时，数据获取是一个至关重要的环节。Next.js 提供了多种数据获取方法，使开发者能够根据需求选择最适合的方式。本文将详细介绍 Next.js 中的数据获取方法，包括服务端渲染（SSR）和静态生成（SSG），并通过实际案例帮助你理解这些概念。

## 什么是 Next.js 数据获取？

Next.js 是一个基于 React 的框架，支持服务端渲染（SSR）和静态生成（SSG）。数据获取是指在页面渲染之前从外部 API 或数据库获取数据的过程。Next.js 提供了三种主要的数据获取方法：

1. **`getStaticProps`**：用于静态生成页面时获取数据。
2. **`getServerSideProps`**：用于服务端渲染页面时获取数据。
3. **`getStaticPaths`**：用于动态路由的静态生成。

接下来，我们将逐一讲解这些方法。

---

## 1. `getStaticProps`：静态生成时获取数据

`getStaticProps` 用于在构建时获取数据并生成静态页面。这种方法适用于内容不经常变化的页面，例如博客文章或产品列表。

### 示例代码

```javascript
export async function getStaticProps() {
  const res = await fetch('https://api.example.com/posts');
  const posts = await res.json();

  return {
    props: {
      posts,
    },
  };
}

export default function Blog({ posts }) {
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  );
}
```

### 解释
- `getStaticProps` 是一个异步函数，在构建时运行。
- 它从 API 获取数据，并将数据作为 `props` 传递给页面组件。
- 页面将在构建时生成，并在每次请求时直接提供静态 HTML。

:::tip
使用 `getStaticProps` 时，页面内容在构建时确定，因此适合内容不经常变化的场景。
:::

---

## 2. `getServerSideProps`：服务端渲染时获取数据

`getServerSideProps` 用于在每次请求时获取数据并渲染页面。这种方法适用于需要实时数据的页面，例如用户仪表盘或动态内容。

### 示例代码

```javascript
export async function getServerSideProps() {
  const res = await fetch('https://api.example.com/user');
  const user = await res.json();

  return {
    props: {
      user,
    },
  };
}

export default function Dashboard({ user }) {
  return (
    <div>
      <h1>Welcome, {user.name}</h1>
      <p>Your email is {user.email}</p>
    </div>
  );
}
```

### 解释
- `getServerSideProps` 是一个异步函数，在每次请求时运行。
- 它从 API 获取数据，并将数据作为 `props` 传递给页面组件。
- 页面将在每次请求时动态生成。

:::caution
由于 `getServerSideProps` 在每次请求时运行，可能会增加服务器负载，因此应谨慎使用。
:::

---

## 3. `getStaticPaths`：动态路由的静态生成

`getStaticPaths` 用于生成动态路由的静态页面。它通常与 `getStaticProps` 一起使用，以生成基于动态参数的页面。

### 示例代码

```javascript
export async function getStaticPaths() {
  const res = await fetch('https://api.example.com/posts');
  const posts = await res.json();

  const paths = posts.map((post) => ({
    params: { id: post.id.toString() },
  }));

  return {
    paths,
    fallback: false,
  };
}

export async function getStaticProps({ params }) {
  const res = await fetch(`https://api.example.com/posts/${params.id}`);
  const post = await res.json();

  return {
    props: {
      post,
    },
  };
}

export default function Post({ post }) {
  return (
    <div>
      <h1>{post.title}</h1>
      <p>{post.content}</p>
    </div>
  );
}
```

### 解释
- `getStaticPaths` 用于生成动态路由的路径列表。
- `getStaticProps` 根据路径参数获取特定数据。
- 页面将在构建时生成，并在每次请求时直接提供静态 HTML。

:::note
`fallback` 参数用于控制未预生成页面的行为。设置为 `false` 时，访问未生成的路径将返回 404 页面。
:::

---

## 实际案例：博客系统

假设你正在构建一个博客系统，其中包含以下功能：
1. 首页显示所有博客文章的列表（使用 `getStaticProps`）。
2. 每篇文章的详情页（使用 `getStaticPaths` 和 `getStaticProps`）。
3. 用户仪表盘显示实时数据（使用 `getServerSideProps`）。

通过结合使用这些方法，你可以构建一个高效且灵活的博客系统。

---

## 总结

Next.js 提供了强大的数据获取方法，使开发者能够根据需求选择最适合的方式：
- 使用 `getStaticProps` 生成静态页面。
- 使用 `getServerSideProps` 实现服务端渲染。
- 使用 `getStaticPaths` 生成动态路由的静态页面。

通过合理选择数据获取方法，你可以构建高性能的 Web 应用程序。

---

## 附加资源与练习

### 资源
- [Next.js 官方文档](https://nextjs.org/docs)
- [React 官方文档](https://reactjs.org/docs/getting-started.html)

### 练习
1. 创建一个简单的博客系统，使用 `getStaticProps` 和 `getStaticPaths` 生成静态页面。
2. 尝试使用 `getServerSideProps` 实现一个实时数据展示页面。
3. 探索 `fallback` 参数的不同设置，并观察其行为。

通过实践，你将更好地掌握 Next.js 的数据获取方法！