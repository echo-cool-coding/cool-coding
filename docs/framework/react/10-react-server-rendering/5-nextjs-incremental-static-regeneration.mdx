---
title: Next.js 增量静态再生成
description: 了解 Next.js 中的增量静态再生成（ISR）功能，学习如何通过 ISR 动态更新静态页面，同时保持高性能和低延迟。
---

## 介绍

Next.js 是一个流行的 React 框架，提供了许多强大的功能来优化 Web 应用的性能。其中，**增量静态再生成（Incremental Static Regeneration, ISR）** 是一个关键特性，它允许你在构建后动态更新静态页面，而无需重新构建整个应用。

ISR 的核心思想是：在用户请求页面时，如果页面已经过时，Next.js 会在后台重新生成该页面，并将新版本提供给后续的请求。这种方式既保留了静态页面的性能优势，又实现了动态内容的更新。

## 为什么需要 ISR？

在传统的静态站点生成（SSG）中，页面内容在构建时生成，之后不会改变。这意味着如果数据发生变化，你需要重新构建整个站点才能更新内容。这对于频繁更新的内容（如博客、新闻网站）来说是不现实的。

ISR 解决了这个问题，它允许你在不重新构建整个站点的情况下，动态更新部分页面内容。这对于需要频繁更新但又希望保持高性能的应用场景非常有用。

## 如何使用 ISR？

在 Next.js 中，使用 ISR 非常简单。你只需要在 `getStaticProps` 函数中返回一个 `revalidate` 属性，指定页面重新生成的间隔时间（以秒为单位）。

### 示例代码

以下是一个简单的示例，展示如何使用 ISR 动态更新页面内容：

```javascript
// pages/posts/[id].js
import { useRouter } from 'next/router';

export async function getStaticProps({ params }) {
  const res = await fetch(`https://api.example.com/posts/${params.id}`);
  const post = await res.json();

  return {
    props: {
      post,
    },
    revalidate: 10, // 每 10 秒重新生成页面
  };
}

export async function getStaticPaths() {
  const res = await fetch('https://api.example.com/posts');
  const posts = await res.json();

  const paths = posts.map((post) => ({
    params: { id: post.id.toString() },
  }));

  return { paths, fallback: 'blocking' };
}

export default function Post({ post }) {
  const router = useRouter();

  if (router.isFallback) {
    return <div>Loading...</div>;
  }

  return (
    <div>
      <h1>{post.title}</h1>
      <p>{post.content}</p>
    </div>
  );
}
```

### 代码解释

1. **`getStaticProps`**: 这个函数用于在构建时获取页面所需的数据。通过返回 `revalidate: 10`，我们告诉 Next.js 每 10 秒重新生成这个页面。

2. **`getStaticPaths`**: 这个函数用于生成动态路由的路径。通过返回 `fallback: 'blocking'`，我们告诉 Next.js 在请求时生成尚未预渲染的页面。

3. **`Post` 组件**: 这是页面的 React 组件。如果页面正在重新生成，`router.isFallback` 会返回 `true`，我们可以显示一个加载状态。

### 输入与输出

- **输入**: 用户访问 `/posts/1` 页面。
- **输出**: 如果页面已经生成，Next.js 会立即返回静态页面。如果页面需要重新生成，Next.js 会在后台生成新页面，并在生成完成后返回给用户。

## 实际应用场景

### 新闻网站

假设你正在开发一个新闻网站，新闻内容会频繁更新。使用 ISR，你可以在构建时生成所有新闻页面的静态版本，并在新闻更新时动态更新页面内容。这样，用户始终能看到最新的新闻，而无需等待整个站点重新构建。

### 电商网站

在电商网站中，商品信息可能会频繁变化（如价格、库存）。使用 ISR，你可以在商品信息变化时动态更新商品页面，确保用户看到的是最新的信息。

## 总结

Next.js 的增量静态再生成（ISR）是一个强大的功能，它允许你在不重新构建整个站点的情况下，动态更新静态页面内容。通过合理使用 ISR，你可以在保持高性能的同时，实现动态内容的更新。

## 附加资源与练习

- **官方文档**: [Next.js ISR 文档](https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration)
- **练习**: 尝试在你的 Next.js 项目中实现 ISR，并观察页面内容如何动态更新。

:::tip
如果你对 ISR 的工作原理有疑问，可以尝试在开发模式下运行 Next.js 项目，并观察控制台日志，了解页面生成的过程。
:::