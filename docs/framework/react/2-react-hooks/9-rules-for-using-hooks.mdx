---
title: Hooks 使用规则
description: 了解 React Hooks 的基本使用规则，掌握如何在函数组件中正确使用 Hooks。
---

# Hooks 使用规则

React Hooks 是 React 16.8 引入的一项功能，它允许你在函数组件中使用状态和其他 React 特性。Hooks 提供了一种更简洁、更直观的方式来编写组件逻辑。然而，为了确保 Hooks 的正确使用，React 团队制定了一些规则。本文将详细介绍这些规则，并通过示例帮助你理解它们的重要性。

## 1. 只在顶层调用 Hooks

Hooks 必须在 React 函数的顶层调用，不能在循环、条件或嵌套函数中使用。这是因为 React 依赖于 Hooks 的调用顺序来正确管理状态。

```jsx
// 正确示例
function MyComponent() {
  const [count, setCount] = useState(0);

  if (count > 10) {
    // 错误示例：不能在条件语句中调用 Hooks
    // const [name, setName] = useState('React');
  }

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

:::caution
不要在循环、条件或嵌套函数中调用 Hooks，这会导致 Hooks 的调用顺序不一致，从而引发错误。
:::

## 2. 只在 React 函数组件或自定义 Hooks 中调用 Hooks

Hooks 只能在 React 函数组件或自定义 Hooks 中调用，不能在普通的 JavaScript 函数中调用。

```jsx
// 正确示例
function useCustomHook() {
  const [value, setValue] = useState(0);
  return value;
}

function MyComponent() {
  const value = useCustomHook();
  return <div>{value}</div>;
}

// 错误示例
function regularFunction() {
  const [value, setValue] = useState(0); // 错误：不能在普通函数中调用 Hooks
}
```

:::tip
如果你需要在多个组件中复用逻辑，可以将其提取到自定义 Hooks 中。
:::

## 3. 使用 Hooks 的顺序必须一致

React 依赖于 Hooks 的调用顺序来正确管理状态。因此，每次渲染时，Hooks 的调用顺序必须保持一致。

```jsx
function MyComponent() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('React');

  // 正确示例：Hooks 的调用顺序一致
  return (
    <div>
      <p>{name}</p>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

:::warning
如果 Hooks 的调用顺序不一致，React 将无法正确管理状态，导致不可预见的错误。
:::

## 4. 使用 `useEffect` 处理副作用

`useEffect` 是 React 提供的一个 Hook，用于处理副作用（如数据获取、订阅或手动修改 DOM）。你可以在 `useEffect` 中执行副作用操作，并在组件卸载时清理这些操作。

```jsx
function MyComponent() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    document.title = `You clicked ${count} times`;

    // 清理函数
    return () => {
      document.title = 'React App';
    };
  }, [count]); // 仅在 count 变化时执行

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

:::note
`useEffect` 的第二个参数是一个依赖数组，只有当数组中的值发生变化时，`useEffect` 才会重新执行。
:::

## 5. 实际应用场景

假设你正在开发一个简单的计数器应用，用户点击按钮时计数器增加，并在页面标题中显示当前计数。你可以使用 `useState` 和 `useEffect` 来实现这个功能。

```jsx
function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    document.title = `Count: ${count}`;
  }, [count]);

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>Increment</button>
    </div>
  );
}
```

在这个例子中，`useState` 用于管理计数器的状态，`useEffect` 用于更新页面标题。

## 6. 总结

React Hooks 提供了一种更简洁、更直观的方式来编写组件逻辑，但为了确保其正确使用，必须遵循以下规则：

1. 只在顶层调用 Hooks。
2. 只在 React 函数组件或自定义 Hooks 中调用 Hooks。
3. 使用 Hooks 的顺序必须一致。
4. 使用 `useEffect` 处理副作用。

遵循这些规则可以帮助你避免常见的错误，并编写出更健壮的 React 组件。

## 7. 附加资源与练习

- [React 官方文档 - Hooks](https://reactjs.org/docs/hooks-intro.html)
- [React Hooks 入门教程](https://www.robinwieruch.de/react-hooks/)
- 练习：尝试创建一个自定义 Hook，用于管理表单输入的状态。

通过不断练习和探索，你将能够更熟练地使用 React Hooks，并编写出更高效的 React 组件。