---
title: useContext钩子
description: "了解如何使用React的useContext钩子来在组件之间共享状态，避免prop drilling问题。"
---

## 介绍

在React中，组件之间的状态共享是一个常见的需求。通常情况下，我们会通过将状态从父组件传递到子组件（即“prop drilling”）来实现这一点。然而，当组件层级较深时，这种方式会导致代码变得冗长且难以维护。为了解决这个问题，React提供了`useContext`钩子。

`useContext`是React提供的一个钩子，它允许你在组件树中共享状态，而无需显式地通过props逐层传递。它基于React的Context API，使得状态可以在组件之间轻松共享。

## 什么是Context？

Context是React提供的一种跨组件传递数据的方式。它允许你在组件树中创建一个“全局”状态，任何子组件都可以访问这个状态，而不需要通过props逐层传递。

### 创建Context

要使用`useContext`，首先需要创建一个Context对象。你可以使用`React.createContext`来创建一个Context：

```javascript
import React from 'react';

const MyContext = React.createContext();
```

### 提供Context值

创建Context后，你需要使用`Context.Provider`来为组件树提供Context的值。`Provider`组件接受一个`value`属性，这个值将被传递给所有消费该Context的子组件。

```javascript
function App() {
  const value = { name: "React", version: "18" };

  return (
    <MyContext.Provider value={value}>
      <ChildComponent />
    </MyContext.Provider>
  );
}
```

### 使用useContext消费Context

在子组件中，你可以使用`useContext`钩子来访问Context的值：

```javascript
import React, { useContext } from 'react';

function ChildComponent() {
  const contextValue = useContext(MyContext);

  return (
    <div>
      <p>Name: {contextValue.name}</p>
      <p>Version: {contextValue.version}</p>
    </div>
  );
}
```

在这个例子中，`ChildComponent`通过`useContext`访问了`MyContext`的值，并展示了`name`和`version`。

## 实际应用场景

### 主题切换

一个常见的应用场景是实现主题切换。你可以使用`useContext`来管理应用的主题，并在组件中根据主题动态调整样式。

```javascript
import React, { useContext, useState } from 'react';

const ThemeContext = React.createContext();

function App() {
  const [theme, setTheme] = useState('light');

  const toggleTheme = () => {
    setTheme(prevTheme => (prevTheme === 'light' ? 'dark' : 'light'));
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      <Toolbar />
    </ThemeContext.Provider>
  );
}

function Toolbar() {
  return (
    <div>
      <ThemedButton />
    </div>
  );
}

function ThemedButton() {
  const { theme, toggleTheme } = useContext(ThemeContext);

  return (
    <button
      style={{
        backgroundColor: theme === 'light' ? '#fff' : '#333',
        color: theme === 'light' ? '#000' : '#fff',
      }}
      onClick={toggleTheme}
    >
      Toggle Theme
    </button>
  );
}
```

在这个例子中，`App`组件管理主题状态，并通过`ThemeContext.Provider`将主题和切换主题的函数传递给子组件。`ThemedButton`组件通过`useContext`访问这些值，并根据当前主题动态调整按钮的样式。

## 总结

`useContext`是React中一个强大的工具，它允许你在组件树中共享状态，而无需通过props逐层传递。通过使用`useContext`，你可以简化代码结构，避免prop drilling问题，并提高代码的可维护性。

在实际应用中，`useContext`常用于管理全局状态，如主题、用户认证信息等。通过结合`useState`或`useReducer`，你可以构建出更加复杂的状态管理逻辑。

## 附加资源

- [React官方文档 - Context](https://reactjs.org/docs/context.html)
- [React官方文档 - useContext](https://reactjs.org/docs/hooks-reference.html#usecontext)

## 练习

1. 创建一个`UserContext`，并在多个组件中共享用户信息。
2. 尝试使用`useContext`和`useReducer`结合，实现一个简单的待办事项列表应用。
