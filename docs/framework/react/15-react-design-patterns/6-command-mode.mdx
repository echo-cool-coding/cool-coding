---
title: 命令模式
description: 了解命令模式的概念、实现方式及其在 React 中的应用场景。通过代码示例和实际案例，掌握如何利用命令模式解耦请求与执行。
---

# 命令模式

命令模式（Command Pattern）是一种行为设计模式，它将请求封装为对象，从而使你可以用不同的请求对客户进行参数化，并支持请求的排队、记录日志以及撤销操作。命令模式的核心思想是将“请求”与“执行”解耦，使得请求的发起者和执行者不需要直接交互。

## 什么是命令模式？

命令模式的核心是将一个请求封装为一个对象，从而使你可以用不同的请求对客户进行参数化。通过这种方式，请求的发起者（Invoker）和请求的执行者（Receiver）之间不需要直接耦合。

命令模式通常包含以下几个角色：

1. **Command（命令接口）**：定义了执行操作的接口。
2. **ConcreteCommand（具体命令）**：实现了命令接口，负责调用接收者的操作。
3. **Receiver（接收者）**：知道如何执行与请求相关的操作。
4. **Invoker（调用者）**：持有命令对象，并在某个时间点调用命令的执行方法。
5. **Client（客户端）**：创建命令对象并设置其接收者。

## 命令模式的实现

让我们通过一个简单的例子来理解命令模式的实现。假设我们有一个遥控器（Invoker），它可以控制电灯（Receiver）的开关。我们可以通过命令模式来实现这个功能。

### 代码示例

```javascript
// 命令接口
class Command {
  execute() {}
  undo() {}
}

// 具体命令：开灯
class LightOnCommand extends Command {
  constructor(light) {
    super();
    this.light = light;
  }

  execute() {
    this.light.on();
  }

  undo() {
    this.light.off();
  }
}

// 具体命令：关灯
class LightOffCommand extends Command {
  constructor(light) {
    super();
    this.light = light;
  }

  execute() {
    this.light.off();
  }

  undo() {
    this.light.on();
  }
}

// 接收者：电灯
class Light {
  on() {
    console.log('电灯已打开');
  }

  off() {
    console.log('电灯已关闭');
  }
}

// 调用者：遥控器
class RemoteControl {
  constructor() {
    this.command = null;
  }

  setCommand(command) {
    this.command = command;
  }

  pressButton() {
    this.command.execute();
  }

  pressUndo() {
    this.command.undo();
  }
}

// 客户端代码
const light = new Light();
const lightOn = new LightOnCommand(light);
const lightOff = new LightOffCommand(light);

const remote = new RemoteControl();

remote.setCommand(lightOn);
remote.pressButton(); // 输出：电灯已打开

remote.setCommand(lightOff);
remote.pressButton(); // 输出：电灯已关闭

remote.pressUndo(); // 输出：电灯已打开
```

### 代码解释

1. **Command** 是一个抽象类，定义了 `execute` 和 `undo` 方法。
2. **LightOnCommand** 和 **LightOffCommand** 是具体命令类，分别实现了开灯和关灯的操作。
3. **Light** 是接收者类，知道如何执行开灯和关灯的操作。
4. **RemoteControl** 是调用者类，持有一个命令对象，并在需要时调用其 `execute` 或 `undo` 方法。
5. 客户端代码创建了具体的命令对象，并将其设置到遥控器中，然后通过遥控器执行命令。

## 命令模式的实际应用场景

命令模式在实际开发中有很多应用场景，特别是在需要解耦请求与执行的情况下。以下是一些常见的应用场景：

1. **撤销操作**：命令模式可以轻松实现撤销功能。每个命令对象都可以保存执行前的状态，并在需要时恢复到该状态。
2. **任务队列**：命令模式可以将多个命令对象放入队列中，并按顺序执行。
3. **日志记录**：命令模式可以记录所有执行的命令，便于后续的日志分析或重放。
4. **宏命令**：可以将多个命令组合成一个宏命令，从而一次性执行多个操作。

### 实际案例：撤销操作

假设我们正在开发一个文本编辑器，用户可以在编辑器中输入文本，并且可以撤销之前的操作。我们可以使用命令模式来实现这个功能。

```javascript
// 命令接口
class Command {
  execute() {}
  undo() {}
}

// 具体命令：插入文本
class InsertTextCommand extends Command {
  constructor(textEditor, text) {
    super();
    this.textEditor = textEditor;
    this.text = text;
    this.previousText = '';
  }

  execute() {
    this.previousText = this.textEditor.getText();
    this.textEditor.insertText(this.text);
  }

  undo() {
    this.textEditor.setText(this.previousText);
  }
}

// 接收者：文本编辑器
class TextEditor {
  constructor() {
    this.text = '';
  }

  insertText(text) {
    this.text += text;
    console.log(`当前文本：${this.text}`);
  }

  setText(text) {
    this.text = text;
    console.log(`当前文本：${this.text}`);
  }

  getText() {
    return this.text;
  }
}

// 调用者：编辑器控制器
class EditorController {
  constructor() {
    this.commands = [];
    this.currentCommandIndex = -1;
  }

  executeCommand(command) {
    command.execute();
    this.commands = this.commands.slice(0, this.currentCommandIndex + 1);
    this.commands.push(command);
    this.currentCommandIndex++;
  }

  undo() {
    if (this.currentCommandIndex >= 0) {
      const command = this.commands[this.currentCommandIndex];
      command.undo();
      this.currentCommandIndex--;
    }
  }
}

// 客户端代码
const textEditor = new TextEditor();
const editorController = new EditorController();

editorController.executeCommand(new InsertTextCommand(textEditor, 'Hello, '));
editorController.executeCommand(new InsertTextCommand(textEditor, 'World!'));

editorController.undo(); // 撤销插入 "World!"
editorController.undo(); // 撤销插入 "Hello, "
```

### 代码解释

1. **InsertTextCommand** 是一个具体命令类，负责在文本编辑器中插入文本，并支持撤销操作。
2. **TextEditor** 是接收者类，负责实际的操作（插入文本和设置文本）。
3. **EditorController** 是调用者类，负责执行命令并支持撤销操作。
4. 客户端代码创建了文本编辑器和编辑器控制器，并通过控制器执行和撤销命令。

## 总结

命令模式是一种非常有用的设计模式，特别是在需要解耦请求与执行的情况下。通过将请求封装为对象，命令模式使得请求的发起者和执行者之间不需要直接耦合，从而提高了代码的灵活性和可维护性。

在实际开发中，命令模式可以用于实现撤销操作、任务队列、日志记录等功能。通过合理地使用命令模式，你可以使代码更加模块化，并且更容易扩展和维护。

## 附加资源与练习

- **练习**：尝试在文本编辑器的案例中添加一个“重做”功能，使得用户可以重新执行被撤销的命令。
- **进一步学习**：阅读更多关于行为设计模式的内容，了解其他模式如观察者模式、策略模式等。

:::tip
命令模式非常适合用于需要支持撤销、重做、日志记录等功能的场景。通过将请求封装为对象，你可以轻松地管理和操作这些请求。
:::