---
title: 复合组件模式
description: 了解 React 中的复合组件模式，这是一种用于构建灵活且可重用组件的设计模式，特别适合初学者。
---

# 复合组件模式

复合组件模式（Compound Components Pattern）是 React 中一种强大的设计模式，它允许开发者通过组合多个小组件来构建复杂的 UI 结构。这种模式的核心思想是将组件的逻辑和 UI 分离，使得组件更加灵活、可重用，并且易于维护。

## 什么是复合组件模式？

复合组件模式通过将多个小组件组合在一起，形成一个更大的组件。这些小组件之间通过共享状态和上下文进行通信，从而形成一个完整的 UI 结构。这种模式特别适合用于构建复杂的 UI 组件，例如选项卡、下拉菜单、模态框等。

### 为什么使用复合组件模式？

1. **灵活性**：复合组件模式允许开发者根据需要组合不同的子组件，从而构建出灵活的 UI 结构。
2. **可重用性**：通过将组件的逻辑和 UI 分离，复合组件模式使得组件更容易被重用。
3. **易于维护**：由于组件的逻辑和 UI 分离，复合组件模式使得代码更易于维护和扩展。

## 复合组件模式的基本结构

在复合组件模式中，通常会有一个父组件和多个子组件。父组件负责管理状态和逻辑，而子组件负责渲染 UI。父组件通过 React 的 `Context` 或 `props` 将状态和逻辑传递给子组件。

### 示例：简单的选项卡组件

让我们通过一个简单的选项卡组件来理解复合组件模式。

```jsx
import React, { useState } from 'react';

const Tabs = ({ children }) => {
  const [activeIndex, setActiveIndex] = useState(0);

  return React.Children.map(children, (child, index) =>
    React.cloneElement(child, {
      isActive: index === activeIndex,
      onClick: () => setActiveIndex(index),
    })
  );
};

const Tab = ({ isActive, onClick, children }) => {
  return (
    <button
      style={{ fontWeight: isActive ? 'bold' : 'normal' }}
      onClick={onClick}
    >
      {children}
    </button>
  );
};

const TabPanel = ({ isActive, children }) => {
  return isActive ? <div>{children}</div> : null;
};

const App = () => {
  return (
    <Tabs>
      <Tab>Tab 1</Tab>
      <Tab>Tab 2</Tab>
      <TabPanel>Content for Tab 1</TabPanel>
      <TabPanel>Content for Tab 2</TabPanel>
    </Tabs>
  );
};

export default App;
```

在这个示例中，`Tabs` 是父组件，负责管理当前选中的选项卡。`Tab` 和 `TabPanel` 是子组件，分别负责渲染选项卡按钮和选项卡内容。父组件通过 `React.cloneElement` 将状态和逻辑传递给子组件。

### 输出

- 当用户点击 "Tab 1" 时，`TabPanel` 会显示 "Content for Tab 1"。
- 当用户点击 "Tab 2" 时，`TabPanel` 会显示 "Content for Tab 2"。

## 复合组件模式的实际应用

复合组件模式在实际开发中有广泛的应用。以下是一些常见的应用场景：

1. **选项卡组件**：如上例所示，选项卡组件通常由多个 `Tab` 和 `TabPanel` 组成。
2. **下拉菜单**：下拉菜单通常由 `Dropdown`、`DropdownItem` 和 `DropdownMenu` 组成。
3. **模态框**：模态框通常由 `Modal`、`ModalHeader`、`ModalBody` 和 `ModalFooter` 组成。

### 示例：下拉菜单组件

```jsx
import React, { useState } from 'react';

const Dropdown = ({ children }) => {
  const [isOpen, setIsOpen] = useState(false);

  return React.Children.map(children, child =>
    React.cloneElement(child, {
      isOpen,
      onToggle: () => setIsOpen(!isOpen),
    })
  );
};

const DropdownToggle = ({ isOpen, onToggle, children }) => {
  return (
    <button onClick={onToggle}>
      {children} {isOpen ? '▲' : '▼'}
    </button>
  );
};

const DropdownMenu = ({ isOpen, children }) => {
  return isOpen ? <ul>{children}</ul> : null;
};

const DropdownItem = ({ children }) => {
  return <li>{children}</li>;
};

const App = () => {
  return (
    <Dropdown>
      <DropdownToggle>Toggle Menu</DropdownToggle>
      <DropdownMenu>
        <DropdownItem>Item 1</DropdownItem>
        <DropdownItem>Item 2</DropdownItem>
        <DropdownItem>Item 3</DropdownItem>
      </DropdownMenu>
    </Dropdown>
  );
};

export default App;
```

在这个示例中，`Dropdown` 是父组件，负责管理下拉菜单的打开和关闭状态。`DropdownToggle`、`DropdownMenu` 和 `DropdownItem` 是子组件，分别负责渲染下拉菜单的按钮、菜单和菜单项。

### 输出

- 当用户点击 "Toggle Menu" 时，下拉菜单会显示或隐藏。
- 下拉菜单中包含三个菜单项：Item 1、Item 2 和 Item 3。

## 总结

复合组件模式是 React 中一种非常强大的设计模式，它通过将多个小组件组合在一起，形成一个更大的组件。这种模式使得组件更加灵活、可重用，并且易于维护。通过使用复合组件模式，开发者可以轻松构建复杂的 UI 结构，例如选项卡、下拉菜单和模态框。

## 附加资源与练习

- **练习**：尝试使用复合组件模式构建一个模态框组件，包含 `Modal`、`ModalHeader`、`ModalBody` 和 `ModalFooter`。
- **资源**：阅读 [React 官方文档](https://reactjs.org/docs/context.html) 以了解更多关于 `Context` 的使用方法。

:::tip
在构建复合组件时，尽量保持组件的职责单一，这样可以使得组件更加灵活和易于维护。
:::