---
title: 设计模式实战应用
description: 学习如何在 React 中应用常见的设计模式，提升代码的可维护性和可扩展性。本文将通过实际案例和代码示例，帮助你理解设计模式的核心概念。
---

## 介绍

设计模式是软件开发中解决常见问题的经典解决方案。它们提供了一种结构化的方式来组织代码，使其更易于理解、维护和扩展。在 React 中，设计模式尤为重要，因为它们可以帮助你管理组件的复杂性，尤其是在大型应用中。

本文将介绍几种常见的 React 设计模式，并通过实际案例展示它们的应用场景。

## 1. 容器与展示组件模式

### 概念

容器与展示组件模式（Container/Presentational Pattern）是一种将逻辑与 UI 分离的设计模式。容器组件负责处理数据逻辑和状态管理，而展示组件则负责渲染 UI。

### 代码示例

```jsx
// 容器组件
import React, { useState, useEffect } from 'react';
import UserList from './UserList';

const UserContainer = () => {
  const [users, setUsers] = useState([]);

  useEffect(() => {
    fetch('/api/users')
      .then(response => response.json())
      .then(data => setUsers(data));
  }, []);

  return <UserList users={users} />;
};

export default UserContainer;

// 展示组件
const UserList = ({ users }) => {
  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
};

export default UserList;
```

### 解释

- **容器组件** `UserContainer` 负责从 API 获取用户数据，并将数据传递给展示组件。
- **展示组件** `UserList` 只负责渲染用户列表，不包含任何逻辑。

### 实际应用场景

这种模式非常适合用于需要从多个来源获取数据并展示的场景。通过分离逻辑和 UI，你可以更容易地测试和重用展示组件。

## 2. 高阶组件模式

### 概念

高阶组件（Higher-Order Component, HOC）是一个函数，它接受一个组件并返回一个新的组件。HOC 通常用于在不修改原始组件的情况下，为其添加额外的功能。

### 代码示例

```jsx
// 高阶组件
const withLoading = (WrappedComponent) => {
  return function WithLoadingComponent({ isLoading, ...props }) {
    if (isLoading) {
      return <div>Loading...</div>;
    }
    return <WrappedComponent {...props} />;
  };
};

// 使用高阶组件
const UserList = ({ users }) => {
  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
};

const UserListWithLoading = withLoading(UserList);

// 使用
<UserListWithLoading isLoading={true} users={[]} />
```

### 解释

- `withLoading` 是一个高阶组件，它接受一个组件 `WrappedComponent` 并返回一个新的组件 `WithLoadingComponent`。
- 如果 `isLoading` 为 `true`，则显示加载提示，否则渲染原始组件。

### 实际应用场景

HOC 非常适合用于添加通用功能，如加载状态、错误处理、权限控制等。通过 HOC，你可以在不修改原始组件的情况下，为其添加这些功能。

## 3. Render Props 模式

### 概念

Render Props 模式是一种通过将函数作为 props 传递给组件来实现代码复用的技术。这个函数通常用于渲染 UI。

### 代码示例

```jsx
// Render Props 组件
const DataFetcher = ({ url, render }) => {
  const [data, setData] = useState(null);

  useEffect(() => {
    fetch(url)
      .then(response => response.json())
      .then(data => setData(data));
  }, [url]);

  return render(data);
};

// 使用 Render Props
const App = () => {
  return (
    <DataFetcher
      url="/api/users"
      render={data => {
        if (!data) return <div>Loading...</div>;
        return (
          <ul>
            {data.map(user => (
              <li key={user.id}>{user.name}</li>
            ))}
          </ul>
        );
      }}
    />
  );
};
```

### 解释

- `DataFetcher` 组件通过 `render` prop 接受一个函数，并在获取数据后调用该函数来渲染 UI。
- 使用 `DataFetcher` 时，你可以通过 `render` prop 自定义如何渲染数据。

### 实际应用场景

Render Props 模式非常适合用于需要灵活渲染逻辑的场景。通过将渲染逻辑作为函数传递，你可以轻松地复用数据获取逻辑，同时保持 UI 的灵活性。

## 4. 组合模式

### 概念

组合模式（Composition Pattern）是一种通过将多个小组件组合成一个更大组件的方式来构建 UI 的设计模式。React 的组件模型天然支持这种模式。

### 代码示例

```jsx
// 基础组件
const Button = ({ onClick, children }) => {
  return <button onClick={onClick}>{children}</button>;
};

const Input = ({ value, onChange }) => {
  return <input type="text" value={value} onChange={onChange} />;
};

// 组合组件
const SearchBar = ({ onSearch }) => {
  const [query, setQuery] = useState('');

  const handleSearch = () => {
    onSearch(query);
  };

  return (
    <div>
      <Input value={query} onChange={e => setQuery(e.target.value)} />
      <Button onClick={handleSearch}>Search</Button>
    </div>
  );
};
```

### 解释

- `Button` 和 `Input` 是基础组件，它们分别负责渲染按钮和输入框。
- `SearchBar` 是一个组合组件，它通过组合 `Button` 和 `Input` 来实现搜索功能。

### 实际应用场景

组合模式非常适合用于构建复杂的 UI。通过将 UI 分解为多个小组件，你可以更容易地管理和重用这些组件。

## 总结

设计模式是 React 开发中的重要工具，它们可以帮助你构建更可维护和可扩展的应用程序。本文介绍了四种常见的 React 设计模式：容器与展示组件模式、高阶组件模式、Render Props 模式和组合模式。每种模式都有其独特的应用场景，理解它们将有助于你在实际项目中做出更好的设计决策。

## 附加资源与练习

- **练习 1**: 尝试将容器与展示组件模式应用到你的项目中，分离逻辑和 UI。
- **练习 2**: 创建一个高阶组件，为你的组件添加错误处理功能。
- **练习 3**: 使用 Render Props 模式实现一个数据获取组件，并自定义其渲染逻辑。
- **练习 4**: 通过组合模式构建一个复杂的 UI 组件，如导航栏或表单。

:::tip
如果你想深入学习 React 设计模式，推荐阅读《React 设计模式与最佳实践》一书，它将帮助你更深入地理解这些模式的应用。
:::