---
title: Context API 基础
description: 了解 React 中的 Context API，掌握如何使用它来管理全局状态，避免 prop drilling 问题。
---

## 介绍

在 React 应用中，组件之间的数据传递通常通过 props 实现。然而，当应用变得复杂时，props 的层层传递（即 prop drilling）会导致代码难以维护。为了解决这个问题，React 提供了 **Context API**，它允许我们在组件树中共享数据，而不必显式地通过每一层传递 props。

Context API 是一种用于在组件树中共享全局数据的机制。它特别适用于主题、用户认证状态、语言偏好等需要在多个组件中共享的数据。

---

## Context API 的核心概念

Context API 的核心包括以下三个部分：

1. **React.createContext**：创建一个 Context 对象。
2. **Context.Provider**：用于提供数据，包裹需要访问该数据的组件。
3. **Context.Consumer** 或 **useContext Hook**：用于在组件中消费 Context 数据。

---

## 创建 Context

首先，我们需要使用 `React.createContext` 创建一个 Context 对象。这个对象包含两个组件：`Provider` 和 `Consumer`。

```jsx
import React from 'react';

// 创建一个 Context 对象
const ThemeContext = React.createContext('light'); // 'light' 是默认值
```

在上面的代码中，我们创建了一个名为 `ThemeContext` 的 Context 对象，并为其设置了默认值 `'light'`。

---

## 使用 Provider 提供数据

`Provider` 组件用于将数据传递给其子组件。它接受一个 `value` 属性，该属性的值可以是任何类型的数据（如字符串、对象、函数等）。

```jsx
function App() {
  return (
    <ThemeContext.Provider value="dark">
      <Toolbar />
    </ThemeContext.Provider>
  );
}

function Toolbar() {
  return (
    <div>
      <ThemedButton />
    </div>
  );
}
```

在上面的例子中，`ThemeContext.Provider` 将 `value` 设置为 `'dark'`，并将其传递给 `Toolbar` 组件及其子组件。

---

## 使用 Consumer 或 useContext 消费数据

有两种方式可以消费 Context 数据：

1. **使用 `Context.Consumer`**：适用于类组件或需要更复杂逻辑的场景。
2. **使用 `useContext` Hook**：适用于函数组件，更简洁。

### 使用 `Context.Consumer`

```jsx
function ThemedButton() {
  return (
    <ThemeContext.Consumer>
      {theme => <button style={{ backgroundColor: theme === 'dark' ? '#333' : '#FFF' }}>Themed Button</button>}
    </ThemeContext.Consumer>
  );
}
```

### 使用 `useContext` Hook

```jsx
import React, { useContext } from 'react';

function ThemedButton() {
  const theme = useContext(ThemeContext);
  return (
    <button style={{ backgroundColor: theme === 'dark' ? '#333' : '#FFF' }}>
      Themed Button
    </button>
  );
}
```

在上面的例子中，`ThemedButton` 组件通过 `useContext` 获取 `ThemeContext` 的值，并根据主题设置按钮的背景颜色。

---

## 实际应用场景

### 场景：用户认证状态管理

假设我们有一个应用，需要在多个组件中共享用户的认证状态。我们可以使用 Context API 来实现这一需求。

```jsx
import React, { createContext, useContext, useState } from 'react';

// 创建 Context
const AuthContext = createContext();

function App() {
  const [isAuthenticated, setIsAuthenticated] = useState(false);

  return (
    <AuthContext.Provider value={{ isAuthenticated, setIsAuthenticated }}>
      <Navbar />
      <MainContent />
    </AuthContext.Provider>
  );
}

function Navbar() {
  const { isAuthenticated, setIsAuthenticated } = useContext(AuthContext);

  return (
    <nav>
      <button onClick={() => setIsAuthenticated(!isAuthenticated)}>
        {isAuthenticated ? 'Logout' : 'Login'}
      </button>
    </nav>
  );
}

function MainContent() {
  const { isAuthenticated } = useContext(AuthContext);

  return (
    <div>
      {isAuthenticated ? <h1>Welcome back!</h1> : <h1>Please log in.</h1>}
    </div>
  );
}
```

在这个例子中，`AuthContext` 用于管理用户的认证状态，`Navbar` 和 `MainContent` 组件都可以访问和更新这个状态。

---

## 总结

Context API 是 React 中用于管理全局状态的强大工具。它可以帮助我们避免 prop drilling，使代码更加简洁和可维护。通过 `createContext`、`Provider` 和 `useContext`，我们可以轻松地在组件树中共享数据。

:::tip
- 使用 Context API 时，尽量避免将过多的数据放入一个 Context 中，以免导致性能问题。
- 如果应用非常复杂，可以考虑结合状态管理库（如 Redux）使用。
:::

---

## 附加资源与练习

### 资源
- [React 官方文档 - Context](https://reactjs.org/docs/context.html)
- [useContext Hook 文档](https://reactjs.org/docs/hooks-reference.html#usecontext)

### 练习
1. 创建一个 `LanguageContext`，用于在应用中切换语言（如中文和英文）。
2. 尝试将 Context API 与 `useReducer` 结合使用，实现一个简单的计数器应用。

Happy coding! 🚀