---
title: Mobx状态管理
description: 了解如何使用Mobx进行React应用的状态管理。本文将从基础概念入手，逐步讲解Mobx的核心功能，并通过实际案例展示其应用场景。
---

# Mobx状态管理

在现代前端开发中，状态管理是一个至关重要的部分。React本身提供了`useState`和`useReducer`等工具来管理组件的状态，但在大型应用中，这些工具可能不足以应对复杂的状态管理需求。Mobx是一个功能强大且易于使用的状态管理库，它通过响应式编程的方式简化了状态管理的过程。

## 什么是Mobx？

Mobx是一个基于观察者模式的状态管理库，它通过自动追踪和更新状态的变化，使得开发者可以更专注于业务逻辑的实现，而不必手动管理状态的更新。Mobx的核心思想是“状态驱动视图”，即当状态发生变化时，视图会自动更新。

### Mobx的核心概念

1. **Observable State（可观察状态）**：Mobx通过`observable`函数将状态标记为可观察的。当这些状态发生变化时，Mobx会自动通知所有依赖这些状态的组件或计算属性。

2. **Actions（动作）**：`action`是修改状态的方法。Mobx要求所有的状态修改都通过`action`来完成，这样可以确保状态的变化是可追踪和可预测的。

3. **Computed Values（计算值）**：`computed`是派生状态，它依赖于其他可观察状态。当依赖的状态发生变化时，计算值会自动重新计算。

4. **Reactions（反应）**：`reaction`是Mobx中的副作用函数，它会在依赖的状态发生变化时自动执行。常见的反应包括`autorun`和`when`。

## 安装Mobx

要开始使用Mobx，首先需要安装它。你可以通过以下命令安装Mobx和Mobx-React（用于与React集成）：

```bash
npm install mobx mobx-react
```

## 基本用法

### 创建可观察状态

首先，我们需要创建一个可观察的状态。我们可以使用`observable`函数来标记状态为可观察的。

```javascript
import { observable } from 'mobx';

class Store {
  @observable count = 0;
}

const store = new Store();
```

在上面的代码中，我们创建了一个`Store`类，并将`count`属性标记为可观察的。这意味着当`count`发生变化时，所有依赖它的组件或计算属性都会自动更新。

### 修改状态

接下来，我们需要定义一些`action`来修改状态。Mobx要求所有的状态修改都通过`action`来完成。

```javascript
import { observable, action } from 'mobx';

class Store {
  @observable count = 0;

  @action increment() {
    this.count++;
  }

  @action decrement() {
    this.count--;
  }
}

const store = new Store();
```

在上面的代码中，我们定义了两个`action`：`increment`和`decrement`，分别用于增加和减少`count`的值。

### 使用计算值

计算值是派生状态，它依赖于其他可观察状态。我们可以使用`computed`来定义计算值。

```javascript
import { observable, action, computed } from 'mobx';

class Store {
  @observable count = 0;

  @action increment() {
    this.count++;
  }

  @action decrement() {
    this.count--;
  }

  @computed get doubleCount() {
    return this.count * 2;
  }
}

const store = new Store();
```

在上面的代码中，我们定义了一个计算值`doubleCount`，它返回`count`的两倍。当`count`发生变化时，`doubleCount`会自动重新计算。

### 在React中使用Mobx

要在React中使用Mobx，我们需要使用`mobx-react`库中的`observer`高阶组件。`observer`会将React组件转换为响应式组件，当组件依赖的可观察状态发生变化时，组件会自动重新渲染。

```javascript
import React from 'react';
import { observer } from 'mobx-react';
import store from './store';

const Counter = observer(() => {
  return (
    <div>
      <p>Count: {store.count}</p>
      <p>Double Count: {store.doubleCount}</p>
      <button onClick={() => store.increment()}>Increment</button>
      <button onClick={() => store.decrement()}>Decrement</button>
    </div>
  );
});

export default Counter;
```

在上面的代码中，我们使用`observer`将`Counter`组件转换为响应式组件。当`store.count`或`store.doubleCount`发生变化时，`Counter`组件会自动重新渲染。

## 实际案例：待办事项列表

让我们通过一个实际的案例来展示Mobx的应用场景。我们将创建一个简单的待办事项列表应用。

### 创建Store

首先，我们需要创建一个`Store`类来管理待办事项的状态。

```javascript
import { observable, action, computed } from 'mobx';

class TodoStore {
  @observable todos = [];

  @action addTodo(text) {
    this.todos.push({ text, completed: false });
  }

  @action toggleTodo(index) {
    this.todos[index].completed = !this.todos[index].completed;
  }

  @computed get completedTodos() {
    return this.todos.filter(todo => todo.completed);
  }
}

const todoStore = new TodoStore();
```

在上面的代码中，我们创建了一个`TodoStore`类，它包含一个可观察的`todos`数组，以及`addTodo`和`toggleTodo`两个`action`。我们还定义了一个计算值`completedTodos`，它返回所有已完成的待办事项。

### 创建React组件

接下来，我们创建两个React组件：`TodoList`和`TodoItem`。

```javascript
import React from 'react';
import { observer } from 'mobx-react';
import todoStore from './todoStore';

const TodoItem = observer(({ todo, index }) => {
  return (
    <li>
      <input
        type="checkbox"
        checked={todo.completed}
        onChange={() => todoStore.toggleTodo(index)}
      />
      <span style={{ textDecoration: todo.completed ? 'line-through' : 'none' }}>
        {todo.text}
      </span>
    </li>
  );
});

const TodoList = observer(() => {
  const [newTodo, setNewTodo] = React.useState('');

  const handleAddTodo = () => {
    if (newTodo.trim()) {
      todoStore.addTodo(newTodo);
      setNewTodo('');
    }
  };

  return (
    <div>
      <h1>Todo List</h1>
      <input
        type="text"
        value={newTodo}
        onChange={(e) => setNewTodo(e.target.value)}
      />
      <button onClick={handleAddTodo}>Add Todo</button>
      <ul>
        {todoStore.todos.map((todo, index) => (
          <TodoItem key={index} todo={todo} index={index} />
        ))}
      </ul>
      <p>Completed: {todoStore.completedTodos.length}</p>
    </div>
  );
});

export default TodoList;
```

在上面的代码中，我们使用`observer`将`TodoList`和`TodoItem`组件转换为响应式组件。当`todoStore.todos`或`todoStore.completedTodos`发生变化时，这些组件会自动重新渲染。

## 总结

Mobx是一个功能强大且易于使用的状态管理库，它通过响应式编程的方式简化了状态管理的过程。通过使用`observable`、`action`、`computed`和`observer`等核心概念，我们可以轻松地在React应用中管理复杂的状态。

### 附加资源

- [Mobx官方文档](https://mobx.js.org/README.html)
- [Mobx-React官方文档](https://mobx-react.js.org/)

### 练习

1. 尝试扩展待办事项列表应用，添加删除待办事项的功能。
2. 创建一个新的Mobx Store，用于管理用户登录状态，并在React组件中使用它。

通过本文的学习，你应该已经掌握了Mobx的基本用法，并能够在实际项目中应用它。继续练习和探索，你将能够更深入地理解Mobx的强大功能。