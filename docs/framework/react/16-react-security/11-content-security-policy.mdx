---
title: Content Security Policy
description: 了解如何使用 Content Security Policy (CSP) 来增强 React 应用的安全性，防止跨站脚本攻击 (XSS) 和其他安全威胁。
---

# Content Security Policy (CSP)

在现代 Web 开发中，安全性是一个至关重要的方面。Content Security Policy (CSP) 是一种强大的安全机制，可以帮助开发者防止跨站脚本攻击 (XSS)、数据注入攻击等安全威胁。本文将详细介绍 CSP 的概念、如何配置它，以及如何在 React 应用中使用它来增强安全性。

## 什么是 Content Security Policy？

Content Security Policy (CSP) 是一种 HTTP 响应头，允许网站管理员控制哪些资源（如脚本、样式表、图片等）可以被加载和执行。通过配置 CSP，开发者可以限制浏览器只加载来自可信来源的内容，从而减少恶意代码注入的风险。

### 为什么需要 CSP？

在 Web 应用中，攻击者可能会尝试通过注入恶意脚本来窃取用户数据或执行其他恶意操作。CSP 通过限制资源的加载来源，可以有效防止这类攻击。例如，CSP 可以阻止浏览器加载和执行来自未知来源的脚本。

## 如何配置 CSP？

CSP 通过 HTTP 响应头 `Content-Security-Policy` 来配置。以下是一个简单的 CSP 配置示例：

```http
Content-Security-Policy: default-src 'self'; script-src 'self' https://trusted.cdn.com; style-src 'self' 'unsafe-inline';
```

在这个示例中：

- `default-src 'self'`：默认情况下，所有资源只能从当前域名加载。
- `script-src 'self' https://trusted.cdn.com`：脚本只能从当前域名和 `https://trusted.cdn.com` 加载。
- `style-src 'self' 'unsafe-inline'`：样式表只能从当前域名加载，并且允许内联样式。

### 逐步讲解 CSP 指令

1. **default-src**：这是 CSP 的默认指令，适用于所有未明确指定的资源类型。例如，`default-src 'self'` 表示所有资源默认只能从当前域名加载。

2. **script-src**：控制脚本的加载来源。例如，`script-src 'self' https://trusted.cdn.com` 表示脚本只能从当前域名和 `https://trusted.cdn.com` 加载。

3. **style-src**：控制样式表的加载来源。例如，`style-src 'self' 'unsafe-inline'` 表示样式表只能从当前域名加载，并且允许内联样式。

4. **img-src**：控制图片的加载来源。例如，`img-src 'self' data:` 表示图片只能从当前域名和 `data:` URL 加载。

5. **connect-src**：控制 AJAX、WebSocket 等连接的来源。例如，`connect-src 'self' https://api.example.com` 表示只能从当前域名和 `https://api.example.com` 发起连接。

6. **frame-src**：控制嵌入框架（如 iframe）的加载来源。例如，`frame-src 'self' https://trusted.embed.com` 表示框架只能从当前域名和 `https://trusted.embed.com` 加载。

:::tip
你可以根据应用的需求，组合使用这些指令来创建适合的 CSP 策略。
:::

## 在 React 应用中使用 CSP

在 React 应用中，CSP 可以通过服务器配置或通过 `meta` 标签来设置。以下是一个通过 `meta` 标签设置 CSP 的示例：

```html
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://trusted.cdn.com; style-src 'self' 'unsafe-inline';">
```

### 实际案例

假设你有一个 React 应用，它使用了一个来自 CDN 的第三方库。为了确保安全性，你可以配置 CSP 来限制脚本只能从当前域名和 CDN 加载：

```http
Content-Security-Policy: default-src 'self'; script-src 'self' https://cdn.example.com; style-src 'self' 'unsafe-inline';
```

这样，即使攻击者尝试注入恶意脚本，浏览器也会阻止加载和执行这些脚本。

## 总结

Content Security Policy (CSP) 是一种强大的安全机制，可以帮助开发者防止跨站脚本攻击 (XSS) 和其他安全威胁。通过合理配置 CSP，你可以限制浏览器只加载来自可信来源的资源，从而增强应用的安全性。

:::caution
在配置 CSP 时，务必仔细测试，确保不会意外阻止合法资源的加载。
:::

## 附加资源

- [MDN Web Docs: Content Security Policy (CSP)](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP)
- [Google Web Fundamentals: Content Security Policy](https://web.dev/csp/)
- [CSP Evaluator](https://csp-evaluator.withgoogle.com/) - 一个用于评估 CSP 配置的工具。

## 练习

1. 在你的 React 应用中配置一个基本的 CSP，并测试其效果。
2. 尝试使用不同的 CSP 指令，如 `script-src` 和 `style-src`，观察它们对应用的影响。
3. 使用 [CSP Evaluator](https://csp-evaluator.withgoogle.com/) 工具评估你的 CSP 配置，确保其安全性。
