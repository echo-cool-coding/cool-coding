---
title: 高阶组件 (HOC)
description: 了解 React 高阶组件 (HOC) 的概念、用法和实际应用场景，帮助你编写更灵活和可重用的组件。
---

## 什么是高阶组件 (HOC)？

高阶组件（Higher-Order Component，简称 HOC）是 React 中一种用于复用组件逻辑的高级技术。它本质上是一个函数，接收一个组件并返回一个新的组件。HOC 并不是 React API 的一部分，而是基于 React 组合特性的一种设计模式。

:::tip
高阶组件的主要目的是**复用组件逻辑**，而不是复制代码。通过 HOC，你可以将通用的逻辑提取出来，应用到多个组件中。
:::

### 高阶组件的基本结构

一个高阶组件通常是一个函数，其结构如下：

```javascript
function withSomeLogic(WrappedComponent) {
  return function EnhancedComponent(props) {
    // 在这里添加额外的逻辑
    return <WrappedComponent {...props} />;
  };
}
```

在这个例子中，`withSomeLogic` 是一个高阶组件，它接收一个组件 `WrappedComponent` 并返回一个新的组件 `EnhancedComponent`。`EnhancedComponent` 可以在渲染 `WrappedComponent` 之前或之后执行一些额外的逻辑。

## 高阶组件的实际应用

### 1. 添加额外的 Props

假设我们有一个组件 `UserProfile`，它需要接收一个 `user` 对象作为 props。我们可以通过高阶组件来为这个组件自动注入 `user` 数据。

```javascript
function withUser(WrappedComponent) {
  return function EnhancedComponent(props) {
    const user = { name: "John Doe", age: 30 }; // 模拟从 API 获取的用户数据
    return <WrappedComponent {...props} user={user} />;
  };
}

function UserProfile({ user }) {
  return (
    <div>
      <h1>{user.name}</h1>
      <p>Age: {user.age}</p>
    </div>
  );
}

const EnhancedUserProfile = withUser(UserProfile);
```

在这个例子中，`withUser` 高阶组件为 `UserProfile` 组件注入了 `user` 数据，使得 `UserProfile` 不需要自己获取用户数据。

### 2. 条件渲染

高阶组件还可以用于条件渲染。例如，我们可以创建一个高阶组件，只有在用户登录时才渲染目标组件。

```javascript
function withAuth(WrappedComponent) {
  return function EnhancedComponent(props) {
    const isLoggedIn = true; // 模拟用户登录状态
    if (isLoggedIn) {
      return <WrappedComponent {...props} />;
    } else {
      return <p>Please log in to view this content.</p>;
    }
  };
}

function Dashboard() {
  return <h1>Welcome to the Dashboard!</h1>;
}

const EnhancedDashboard = withAuth(Dashboard);
```

在这个例子中，`withAuth` 高阶组件会根据用户的登录状态决定是否渲染 `Dashboard` 组件。

## 高阶组件的注意事项

:::caution
1. **不要修改原始组件**：高阶组件应该通过组合的方式扩展组件功能，而不是直接修改原始组件。
2. **传递无关的 Props**：确保高阶组件将所有无关的 props 传递给被包裹的组件，以避免丢失重要的 props。
3. **避免在 render 方法中使用 HOC**：在 render 方法中使用 HOC 会导致每次渲染时都创建一个新的组件，这可能会导致性能问题和状态丢失。
:::

## 实际案例：日志记录

假设我们希望在每次组件渲染时记录日志。我们可以使用高阶组件来实现这一功能。

```javascript
function withLogger(WrappedComponent) {
  return function EnhancedComponent(props) {
    console.log(`Rendering ${WrappedComponent.name}`);
    return <WrappedComponent {...props} />;
  };
}

function MyComponent() {
  return <p>Hello, World!</p>;
}

const EnhancedMyComponent = withLogger(MyComponent);
```

在这个例子中，每次 `MyComponent` 渲染时，控制台都会输出一条日志。

## 总结

高阶组件是 React 中一种强大的工具，可以帮助你复用组件逻辑，避免代码重复。通过高阶组件，你可以将通用的逻辑提取出来，应用到多个组件中，从而提高代码的可维护性和可读性。

:::note
**练习**：尝试创建一个高阶组件，用于在组件挂载时显示加载动画，并在数据加载完成后渲染目标组件。
:::

## 附加资源

- [React 官方文档 - 高阶组件](https://reactjs.org/docs/higher-order-components.html)
- [React 高阶组件实战指南](https://www.robinwieruch.de/react-higher-order-components)
