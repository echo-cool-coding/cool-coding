---
title: 错误边界处理
description: 学习如何在 React 中使用错误边界（Error Boundaries）来捕获和处理组件中的 JavaScript 错误，提升应用的健壮性。
---

# 错误边界处理

在 React 应用中，JavaScript 错误可能会导致整个应用崩溃。为了避免这种情况，React 引入了**错误边界（Error Boundaries）**的概念。错误边界是一种 React 组件，它可以捕获并处理其子组件树中发生的 JavaScript 错误，从而防止这些错误传播到整个应用。

## 什么是错误边界？

错误边界是 React 16 引入的一个新特性。它是一个特殊的 React 组件，可以捕获其子组件树中发生的 JavaScript 错误，并显示一个备用 UI，而不是让整个应用崩溃。错误边界类似于 JavaScript 中的 `try-catch` 语句，但它专门用于 React 组件。

:::note
错误边界只能捕获以下类型的错误：
- 渲染期间发生的错误
- 生命周期方法中的错误
- 构造函数中的错误

它无法捕获以下类型的错误：
- 事件处理函数中的错误
- 异步代码中的错误（如 `setTimeout` 或 `Promise`）
- 服务端渲染中的错误
- 错误边界组件自身抛出的错误
:::

## 如何创建错误边界？

要创建一个错误边界组件，你需要定义一个类组件，并实现 `componentDidCatch` 生命周期方法。这个方法会在子组件抛出错误时被调用。

```jsx
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    // 更新 state 以显示备用 UI
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    // 你可以在这里记录错误信息
    console.error("Error caught by ErrorBoundary:", error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      // 你可以渲染任何自定义的备用 UI
      return <h1>Something went wrong.</h1>;
    }

    return this.props.children;
  }
}
```

### 使用错误边界

你可以将错误边界组件包裹在任何可能抛出错误的组件周围。例如：

```jsx
function BuggyComponent() {
  throw new Error("I crashed!");
  return <div>This will not render.</div>;
}

function App() {
  return (
    <ErrorBoundary>
      <BuggyComponent />
    </ErrorBoundary>
  );
}
```

在这个例子中，`BuggyComponent` 会抛出一个错误，但由于它被 `ErrorBoundary` 包裹，错误会被捕获，并显示备用 UI。

## 实际应用场景

### 1. 捕获特定组件的错误

假设你有一个复杂的仪表盘应用，其中包含多个独立的组件。如果其中一个组件崩溃，你不希望整个仪表盘都崩溃。你可以为每个组件添加一个错误边界：

```jsx
function Dashboard() {
  return (
    <div>
      <ErrorBoundary>
        <SalesChart />
      </ErrorBoundary>
      <ErrorBoundary>
        <UserActivity />
      </ErrorBoundary>
    </div>
  );
}
```

### 2. 记录错误信息

你可以在 `componentDidCatch` 方法中记录错误信息，以便后续分析和修复：

```jsx
componentDidCatch(error, errorInfo) {
  console.error("Error caught by ErrorBoundary:", error, errorInfo);
  // 你可以将错误信息发送到错误跟踪服务
  logErrorToService(error, errorInfo);
}
```

## 总结

错误边界是 React 中处理组件错误的强大工具。通过使用错误边界，你可以防止单个组件的错误导致整个应用崩溃，并提供一个友好的备用 UI。记住，错误边界只能捕获渲染期间、生命周期方法和构造函数中的错误，无法捕获事件处理函数和异步代码中的错误。

## 附加资源

- [React 官方文档 - 错误边界](https://reactjs.org/docs/error-boundaries.html)
- [React 错误边界的最佳实践](https://www.robinwieruch.de/react-error-boundaries)

## 练习

1. 创建一个错误边界组件，并在其中捕获一个子组件抛出的错误。
2. 尝试在错误边界中记录错误信息，并将其发送到一个模拟的错误跟踪服务。
3. 思考并实现一个场景，其中多个组件分别被不同的错误边界包裹，确保一个组件的错误不会影响其他组件。

通过以上练习，你将更好地理解错误边界的使用场景和实现方式。