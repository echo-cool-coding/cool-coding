---
title: 表单提交处理
description: 学习如何在 React 中处理表单提交，包括表单数据的收集、验证和提交到服务器的完整流程。
---

## 介绍

在 React 中，表单是用户与应用程序交互的重要方式之一。表单提交处理是表单开发中的核心部分，它涉及收集用户输入的数据、验证数据的有效性，并将数据提交到服务器进行处理。本文将逐步讲解如何在 React 中处理表单提交，并通过实际案例帮助你掌握这一技能。

## 表单提交的基本流程

表单提交处理通常包括以下几个步骤：

1. **收集表单数据**：获取用户在表单中输入的数据。
2. **验证数据**：确保用户输入的数据符合预期要求。
3. **提交数据**：将数据发送到服务器进行处理。
4. **处理服务器响应**：根据服务器的响应更新 UI 或显示错误信息。

### 1. 收集表单数据

在 React 中，表单数据通常通过 `state` 或 `ref` 来管理。我们推荐使用 `state`，因为它更符合 React 的数据流思想。

```jsx
import React, { useState } from 'react';

function MyForm() {
  const [formData, setFormData] = useState({
    username: '',
    password: '',
  });

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData({
      ...formData,
      [name]: value,
    });
  };

  return (
    <form>
      <label>
        用户名:
        <input
          type="text"
          name="username"
          value={formData.username}
          onChange={handleChange}
        />
      </label>
      <br />
      <label>
        密码:
        <input
          type="password"
          name="password"
          value={formData.password}
          onChange={handleChange}
        />
      </label>
      <br />
      <button type="submit">提交</button>
    </form>
  );
}

export default MyForm;
```

在上面的代码中，我们使用 `useState` 来管理表单数据，并通过 `handleChange` 函数更新 `state`。

### 2. 验证数据

在提交表单之前，通常需要对用户输入的数据进行验证。例如，确保用户名和密码不为空。

```jsx
const handleSubmit = (e) => {
  e.preventDefault();
  if (!formData.username || !formData.password) {
    alert('用户名和密码不能为空');
    return;
  }
  // 提交数据到服务器
};
```

在 `handleSubmit` 函数中，我们首先调用 `e.preventDefault()` 来阻止表单的默认提交行为，然后检查用户名和密码是否为空。如果为空，则显示警告信息并停止提交。

### 3. 提交数据

在数据验证通过后，我们可以将数据提交到服务器。通常使用 `fetch` 或 `axios` 来发送 HTTP 请求。

```jsx
const handleSubmit = async (e) => {
  e.preventDefault();
  if (!formData.username || !formData.password) {
    alert('用户名和密码不能为空');
    return;
  }

  try {
    const response = await fetch('/api/submit', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(formData),
    });

    if (!response.ok) {
      throw new Error('提交失败');
    }

    const result = await response.json();
    console.log('提交成功:', result);
  } catch (error) {
    console.error('提交失败:', error);
  }
};
```

在上面的代码中，我们使用 `fetch` 发送 POST 请求，并将表单数据作为 JSON 格式发送到服务器。如果请求成功，我们处理服务器的响应；如果请求失败，我们捕获错误并显示错误信息。

### 4. 处理服务器响应

根据服务器的响应，我们可以更新 UI 或显示成功/错误信息。

```jsx
const [submitStatus, setSubmitStatus] = useState(null);

const handleSubmit = async (e) => {
  e.preventDefault();
  if (!formData.username || !formData.password) {
    alert('用户名和密码不能为空');
    return;
  }

  try {
    const response = await fetch('/api/submit', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(formData),
    });

    if (!response.ok) {
      throw new Error('提交失败');
    }

    const result = await response.json();
    setSubmitStatus('提交成功');
    console.log('提交成功:', result);
  } catch (error) {
    setSubmitStatus('提交失败');
    console.error('提交失败:', error);
  }
};

return (
  <form onSubmit={handleSubmit}>
    {/* 表单内容 */}
    {submitStatus && <p>{submitStatus}</p>}
  </form>
);
```

在上面的代码中，我们使用 `submitStatus` 状态来存储提交状态，并在表单中显示提交结果。

## 实际案例

假设我们正在开发一个用户注册表单，用户需要输入用户名、密码和电子邮件地址。我们需要确保所有字段都填写完整，并且电子邮件地址格式正确。

```jsx
import React, { useState } from 'react';

function RegistrationForm() {
  const [formData, setFormData] = useState({
    username: '',
    password: '',
    email: '',
  });

  const [submitStatus, setSubmitStatus] = useState(null);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData({
      ...formData,
      [name]: value,
    });
  };

  const validateEmail = (email) => {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!formData.username || !formData.password || !formData.email) {
      alert('所有字段都必须填写');
      return;
    }

    if (!validateEmail(formData.email)) {
      alert('请输入有效的电子邮件地址');
      return;
    }

    try {
      const response = await fetch('/api/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData),
      });

      if (!response.ok) {
        throw new Error('注册失败');
      }

      const result = await response.json();
      setSubmitStatus('注册成功');
      console.log('注册成功:', result);
    } catch (error) {
      setSubmitStatus('注册失败');
      console.error('注册失败:', error);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <label>
        用户名:
        <input
          type="text"
          name="username"
          value={formData.username}
          onChange={handleChange}
        />
      </label>
      <br />
      <label>
        密码:
        <input
          type="password"
          name="password"
          value={formData.password}
          onChange={handleChange}
        />
      </label>
      <br />
      <label>
        电子邮件:
        <input
          type="email"
          name="email"
          value={formData.email}
          onChange={handleChange}
        />
      </label>
      <br />
      <button type="submit">注册</button>
      {submitStatus && <p>{submitStatus}</p>}
    </form>
  );
}

export default RegistrationForm;
```

在这个案例中，我们添加了电子邮件验证，并在提交表单时检查所有字段是否填写完整以及电子邮件格式是否正确。

## 总结

在 React 中处理表单提交涉及多个步骤，包括收集表单数据、验证数据、提交数据到服务器以及处理服务器响应。通过本文的学习，你应该能够掌握这些基本技能，并能够在实际项目中应用它们。

:::tip 提示
在实际开发中，表单处理可能会更加复杂，例如处理文件上传、处理异步验证等。建议你深入学习 React 表单处理的相关知识，并尝试在实际项目中应用这些技能。
:::

## 附加资源

- [React 官方文档 - 表单](https://reactjs.org/docs/forms.html)
- [React Hook Form](https://react-hook-form.com/) - 一个强大的 React 表单库
- [Formik](https://formik.org/) - 另一个流行的 React 表单库

## 练习

1. 尝试在现有的表单中添加一个新的字段（例如电话号码），并确保在提交表单时验证该字段。
2. 修改表单提交逻辑，使其在提交成功后清空表单字段。
3. 使用 `axios` 替换 `fetch` 来提交表单数据，并比较两者的使用体验。
