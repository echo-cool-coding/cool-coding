---
title: 表单验证基础
description: 学习如何在 React 中实现基本的表单验证，确保用户输入的数据符合预期要求。
---

## 介绍

在 Web 开发中，表单是用户与应用程序交互的重要方式之一。无论是登录、注册还是提交数据，表单都扮演着关键角色。然而，用户输入的数据并不总是可靠的，因此表单验证成为了确保数据完整性和有效性的必要步骤。

表单验证的主要目的是确保用户输入的数据符合预期的格式和要求。例如，验证电子邮件地址是否有效，密码是否符合安全标准，或者必填字段是否已填写。在 React 中，表单验证可以通过多种方式实现，包括内置的 HTML5 验证、自定义 JavaScript 逻辑以及第三方库。

本文将逐步介绍如何在 React 中实现基本的表单验证，并通过实际案例展示其应用。

## 基本表单验证

### 1. HTML5 内置验证

HTML5 提供了一些内置的表单验证功能，例如 `required`、`minLength`、`maxLength`、`pattern` 等。这些属性可以直接在表单元素上使用，浏览器会自动处理验证。

```jsx
<form>
  <label htmlFor="email">Email:</label>
  <input type="email" id="email" name="email" required />
  <br />
  <label htmlFor="password">Password:</label>
  <input type="password" id="password" name="password" minLength="8" required />
  <br />
  <button type="submit">Submit</button>
</form>
```

在这个例子中，`email` 字段必须是一个有效的电子邮件地址，`password` 字段必须至少包含 8 个字符。如果用户输入的数据不符合要求，浏览器会显示相应的错误消息。

:::note
HTML5 内置验证虽然方便，但在实际开发中，通常需要更复杂的验证逻辑。因此，自定义 JavaScript 验证是更常见的选择。
:::

### 2. 自定义 JavaScript 验证

在 React 中，可以通过状态管理和事件处理来实现自定义的表单验证。以下是一个简单的例子，展示了如何验证用户名和密码字段：

```jsx
import React, { useState } from 'react';

function LoginForm() {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [errors, setErrors] = useState({});

  const validateForm = () => {
    const newErrors = {};
    if (!username) {
      newErrors.username = 'Username is required';
    }
    if (!password) {
      newErrors.password = 'Password is required';
    } else if (password.length < 8) {
      newErrors.password = 'Password must be at least 8 characters long';
    }
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (validateForm()) {
      // 表单验证通过，提交数据
      console.log('Form submitted successfully');
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <div>
        <label htmlFor="username">Username:</label>
        <input
          type="text"
          id="username"
          value={username}
          onChange={(e) => setUsername(e.target.value)}
        />
        {errors.username && <span>{errors.username}</span>}
      </div>
      <div>
        <label htmlFor="password">Password:</label>
        <input
          type="password"
          id="password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
        />
        {errors.password && <span>{errors.password}</span>}
      </div>
      <button type="submit">Submit</button>
    </form>
  );
}

export default LoginForm;
```

在这个例子中，`validateForm` 函数用于检查用户名和密码字段是否有效。如果字段无效，错误消息会显示在相应的输入框下方。

:::tip
在实际开发中，可以将验证逻辑提取到一个单独的函数或模块中，以便在不同的表单中复用。
:::

### 3. 使用第三方库进行表单验证

虽然自定义验证逻辑可以满足大多数需求，但在复杂的表单中，使用第三方库可以大大简化开发过程。一些流行的表单验证库包括 `Formik` 和 `React Hook Form`。

以下是一个使用 `React Hook Form` 的简单例子：

```jsx
import React from 'react';
import { useForm } from 'react-hook-form';

function SignUpForm() {
  const { register, handleSubmit, formState: { errors } } = useForm();

  const onSubmit = (data) => {
    console.log(data);
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div>
        <label htmlFor="email">Email:</label>
        <input
          type="email"
          id="email"
          {...register('email', { required: 'Email is required' })}
        />
        {errors.email && <span>{errors.email.message}</span>}
      </div>
      <div>
        <label htmlFor="password">Password:</label>
        <input
          type="password"
          id="password"
          {...register('password', { required: 'Password is required', minLength: { value: 8, message: 'Password must be at least 8 characters long' } })}
        />
        {errors.password && <span>{errors.password.message}</span>}
      </div>
      <button type="submit">Sign Up</button>
    </form>
  );
}

export default SignUpForm;
```

在这个例子中，`React Hook Form` 提供了简单的 API 来处理表单验证和提交。`register` 函数用于注册输入字段，`handleSubmit` 函数用于处理表单提交。

:::caution
使用第三方库时，务必阅读文档并理解其工作原理，以避免潜在的性能问题或兼容性问题。
:::

## 实际案例

假设我们正在开发一个用户注册表单，要求用户输入姓名、电子邮件地址和密码。以下是实现该表单的完整代码：

```jsx
import React, { useState } from 'react';

function RegistrationForm() {
  const [name, setName] = useState('');
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [errors, setErrors] = useState({});

  const validateForm = () => {
    const newErrors = {};
    if (!name) {
      newErrors.name = 'Name is required';
    }
    if (!email) {
      newErrors.email = 'Email is required';
    } else if (!/\S+@\S+\.\S+/.test(email)) {
      newErrors.email = 'Email address is invalid';
    }
    if (!password) {
      newErrors.password = 'Password is required';
    } else if (password.length < 8) {
      newErrors.password = 'Password must be at least 8 characters long';
    }
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (validateForm()) {
      // 表单验证通过，提交数据
      console.log('Form submitted successfully');
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <div>
        <label htmlFor="name">Name:</label>
        <input
          type="text"
          id="name"
          value={name}
          onChange={(e) => setName(e.target.value)}
        />
        {errors.name && <span>{errors.name}</span>}
      </div>
      <div>
        <label htmlFor="email">Email:</label>
        <input
          type="email"
          id="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
        />
        {errors.email && <span>{errors.email}</span>}
      </div>
      <div>
        <label htmlFor="password">Password:</label>
        <input
          type="password"
          id="password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
        />
        {errors.password && <span>{errors.password}</span>}
      </div>
      <button type="submit">Register</button>
    </form>
  );
}

export default RegistrationForm;
```

在这个案例中，我们实现了完整的表单验证逻辑，确保用户输入的姓名、电子邮件地址和密码都符合要求。

## 总结

表单验证是 Web 开发中不可或缺的一部分，它确保了用户输入的数据符合预期要求。在 React 中，可以通过 HTML5 内置验证、自定义 JavaScript 逻辑或第三方库来实现表单验证。本文介绍了这些方法的基本用法，并通过实际案例展示了如何在实际项目中应用这些技术。

## 附加资源

- [React 官方文档](https://reactjs.org/docs/forms.html)
- [React Hook Form 文档](https://react-hook-form.com/)
- [Formik 文档](https://formik.org/)

## 练习

1. 尝试在现有的表单中添加一个新的字段（例如电话号码），并实现相应的验证逻辑。
2. 使用 `React Hook Form` 重构上述案例中的表单验证逻辑，并比较两者的优缺点。
3. 探索其他表单验证库（如 `Yup`），并将其集成到你的 React 项目中。
