---
title: 网络请求API
description: 了解小程序中的网络请求API，掌握如何在小程序中发起HTTP请求，获取数据并与服务器交互。
---

## 介绍

在小程序开发中，网络请求是与服务器进行数据交互的核心功能之一。通过小程序提供的网络请求API，开发者可以轻松地发起HTTP请求，获取远程数据，并将数据展示在小程序页面上。无论是获取用户信息、提交表单数据，还是加载动态内容，网络请求API都是不可或缺的工具。

本文将详细介绍小程序中的网络请求API，包括如何使用 `wx.request` 发起请求、处理响应数据、以及在实际开发中的应用场景。

## 小程序中的网络请求API

小程序提供了 `wx.request` 方法来发起网络请求。该方法支持多种HTTP请求方法（如GET、POST等），并且可以设置请求头、请求参数、超时时间等选项。

### 基本用法

以下是一个简单的 `wx.request` 示例，展示了如何发起一个GET请求：

```javascript
wx.request({
  url: 'https://api.example.com/data', // 请求的URL
  method: 'GET', // 请求方法
  success(res) {
    console.log('请求成功', res.data); // 请求成功后的回调函数
  },
  fail(err) {
    console.error('请求失败', err); // 请求失败后的回调函数
  },
  complete() {
    console.log('请求完成'); // 请求完成后的回调函数（无论成功或失败）
  }
});
```

在这个示例中，我们向 `https://api.example.com/data` 发起了一个GET请求。如果请求成功，`success` 回调函数会被触发，并返回服务器响应的数据 `res.data`。如果请求失败，`fail` 回调函数会被触发，并返回错误信息 `err`。无论请求成功或失败，`complete` 回调函数都会在请求完成后被触发。

### 请求参数

`wx.request` 方法支持多种配置参数，以下是一些常用的参数：

- `url`: 请求的URL地址，必需。
- `method`: 请求方法，如 `GET`、`POST`、`PUT`、`DELETE` 等，默认为 `GET`。
- `data`: 请求的参数，可以是对象或字符串。
- `header`: 设置请求的头部信息。
- `timeout`: 请求的超时时间，单位为毫秒。
- `dataType`: 返回数据的格式，默认为 `json`。
- `responseType`: 响应的数据类型，默认为 `text`。

以下是一个带有请求参数的示例：

```javascript
wx.request({
  url: 'https://api.example.com/user',
  method: 'POST',
  data: {
    username: 'testuser',
    password: 'testpassword'
  },
  header: {
    'Content-Type': 'application/json'
  },
  success(res) {
    console.log('用户信息', res.data);
  },
  fail(err) {
    console.error('请求失败', err);
  }
});
```

在这个示例中，我们向 `https://api.example.com/user` 发起了一个POST请求，并传递了 `username` 和 `password` 作为请求参数。请求头中设置了 `Content-Type` 为 `application/json`，表示请求体是JSON格式。

### 处理响应数据

`wx.request` 的 `success` 回调函数会返回一个响应对象 `res`，其中包含了服务器返回的数据。以下是一些常用的响应字段：

- `res.data`: 服务器返回的数据，通常是JSON格式。
- `res.statusCode`: HTTP状态码，如200表示成功，404表示未找到资源等。
- `res.header`: 响应头信息。

以下是一个处理响应数据的示例：

```javascript
wx.request({
  url: 'https://api.example.com/data',
  method: 'GET',
  success(res) {
    if (res.statusCode === 200) {
      console.log('数据获取成功', res.data);
    } else {
      console.error('请求失败，状态码:', res.statusCode);
    }
  },
  fail(err) {
    console.error('请求失败', err);
  }
});
```

在这个示例中，我们检查了 `res.statusCode` 是否为200，如果是，则表示请求成功，并打印出返回的数据 `res.data`。否则，打印出错误的状态码。

## 实际应用场景

### 1. 获取用户信息

在小程序中，通常需要从服务器获取用户信息并展示在页面上。以下是一个获取用户信息的示例：

```javascript
wx.request({
  url: 'https://api.example.com/user/123',
  method: 'GET',
  success(res) {
    if (res.statusCode === 200) {
      const user = res.data;
      console.log('用户信息:', user);
      // 将用户信息展示在页面上
      this.setData({
        userName: user.name,
        userAvatar: user.avatar
      });
    } else {
      console.error('获取用户信息失败');
    }
  },
  fail(err) {
    console.error('请求失败', err);
  }
});
```

在这个示例中，我们通过 `wx.request` 获取了用户ID为 `123` 的用户信息，并将用户的名字和头像展示在页面上。

### 2. 提交表单数据

在小程序中，用户可以通过表单提交数据到服务器。以下是一个提交表单数据的示例：

```javascript
Page({
  data: {
    formData: {
      name: '',
      email: ''
    }
  },
  submitForm() {
    wx.request({
      url: 'https://api.example.com/submit',
      method: 'POST',
      data: this.data.formData,
      header: {
        'Content-Type': 'application/json'
      },
      success(res) {
        if (res.statusCode === 200) {
          console.log('表单提交成功');
        } else {
          console.error('表单提交失败');
        }
      },
      fail(err) {
        console.error('请求失败', err);
      }
    });
  }
});
```

在这个示例中，用户填写表单后，点击提交按钮，表单数据会被发送到服务器。

## 总结

通过本文，我们学习了小程序中的网络请求API `wx.request` 的基本用法、请求参数、响应数据处理以及实际应用场景。掌握这些知识后，你将能够在小程序中轻松地发起网络请求，与服务器进行数据交互。

### 附加资源

- [小程序官方文档 - 网络请求](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html)
- [HTTP请求方法详解](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods)
- [JSON数据格式介绍](https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Objects/JSON)

### 练习

1. 尝试使用 `wx.request` 发起一个GET请求，获取某个API的数据并展示在小程序页面上。
2. 修改上面的表单提交示例，使其能够处理更多的表单字段，并在提交成功后显示成功提示。