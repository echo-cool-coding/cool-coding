---
title: 相册选择图片
description: 学习如何在小程序中实现从相册选择图片的功能，包括基本概念、代码示例和实际应用场景。
---

## 介绍

在小程序开发中，相册选择图片是一个常见的功能，允许用户从设备的相册中选择图片并进行进一步处理。这个功能在需要用户上传图片的场景中非常有用，例如头像设置、图片分享等。

本文将逐步讲解如何在小程序中实现相册选择图片的功能，并提供代码示例和实际应用场景。

## 基本概念

在小程序中，相册选择图片的功能主要通过 `wx.chooseImage` API 实现。这个 API 允许用户从相册中选择图片，或者直接拍摄新照片。选择后的图片会以临时文件路径的形式返回，开发者可以进一步处理这些图片。

### `wx.chooseImage` API

`wx.chooseImage` 是一个异步 API，它接受一个配置对象作为参数，并返回用户选择的图片的临时文件路径。

```javascript
wx.chooseImage({
  count: 1, // 最多可以选择的图片张数
  sizeType: ['original', 'compressed'], // 所选的图片的尺寸
  sourceType: ['album', 'camera'], // 选择图片的来源
  success(res) {
    const tempFilePaths = res.tempFilePaths // 返回选定图片的本地文件路径列表
    console.log(tempFilePaths)
  }
})
```

### 参数说明

- `count`: 最多可以选择的图片张数，默认为 9。
- `sizeType`: 所选的图片的尺寸，可选值为 `['original', 'compressed']`，默认为 `['original', 'compressed']`。
- `sourceType`: 选择图片的来源，可选值为 `['album', 'camera']`，默认为 `['album', 'camera']`。

### 返回值

- `tempFilePaths`: 返回选定图片的本地文件路径列表。

## 代码示例

以下是一个完整的代码示例，展示了如何在小程序中实现相册选择图片的功能。

```javascript
Page({
  data: {
    imageSrc: '' // 用于存储选择的图片路径
  },
  chooseImage() {
    wx.chooseImage({
      count: 1,
      sizeType: ['original', 'compressed'],
      sourceType: ['album'],
      success: (res) => {
        const tempFilePaths = res.tempFilePaths
        this.setData({
          imageSrc: tempFilePaths[0]
        })
      }
    })
  }
})
```

### 页面结构

```html
<view>
  <button bindtap="chooseImage">选择图片</button>
  <image src="{{imageSrc}}" mode="aspectFit" />
</view>
```

### 解释

1. `chooseImage` 方法调用 `wx.chooseImage` API，允许用户从相册中选择一张图片。
2. 选择成功后，`tempFilePaths` 中存储了图片的临时文件路径。
3. 通过 `this.setData` 方法将图片路径更新到页面的 `data` 中。
4. 页面中的 `image` 组件会根据 `imageSrc` 的值显示选择的图片。

## 实际应用场景

### 头像设置

在用户设置头像的场景中，可以让用户从相册中选择一张图片作为头像。选择后，可以将图片上传到服务器并更新用户的头像信息。

```javascript
Page({
  data: {
    avatarUrl: '' // 用于存储用户头像的URL
  },
  chooseAvatar() {
    wx.chooseImage({
      count: 1,
      sizeType: ['original', 'compressed'],
      sourceType: ['album'],
      success: (res) => {
        const tempFilePaths = res.tempFilePaths
        this.setData({
          avatarUrl: tempFilePaths[0]
        })
        // 上传图片到服务器
        this.uploadImage(tempFilePaths[0])
      }
    })
  },
  uploadImage(filePath) {
    wx.uploadFile({
      url: 'https://example.com/upload',
      filePath: filePath,
      name: 'avatar',
      success(res) {
        console.log('上传成功', res.data)
      }
    })
  }
})
```

### 图片分享

在图片分享的场景中，可以让用户从相册中选择一张图片，然后分享给好友或发布到朋友圈。

```javascript
Page({
  data: {
    shareImage: '' // 用于存储分享的图片路径
  },
  chooseShareImage() {
    wx.chooseImage({
      count: 1,
      sizeType: ['original', 'compressed'],
      sourceType: ['album'],
      success: (res) => {
        const tempFilePaths = res.tempFilePaths
        this.setData({
          shareImage: tempFilePaths[0]
        })
        // 分享图片
        this.shareImage(tempFilePaths[0])
      }
    })
  },
  shareImage(filePath) {
    wx.shareAppMessage({
      title: '分享图片',
      imageUrl: filePath
    })
  }
})
```

## 总结

通过 `wx.chooseImage` API，我们可以轻松实现从小程序中选择图片的功能。这个功能在头像设置、图片分享等场景中非常有用。本文提供了详细的代码示例和实际应用场景，帮助初学者快速掌握这一功能。

## 附加资源

- [微信小程序官方文档 - wx.chooseImage](https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseImage.html)
- [微信小程序开发指南](https://developers.weixin.qq.com/ebook?action=get_post_info&docid=0008aeea9a8978ab0086a685851c0a)

## 练习

1. 修改代码示例，允许用户选择最多 3 张图片，并在页面中显示所有选择的图片。
2. 尝试在图片选择后，将图片上传到服务器，并在上传成功后显示提示信息。

:::tip
在开发过程中，记得处理用户取消选择图片的情况，避免程序出现异常。
:::