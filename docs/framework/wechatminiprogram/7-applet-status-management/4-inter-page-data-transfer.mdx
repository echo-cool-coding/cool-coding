---
title: 页面间数据传递
description: 了解在小程序中如何实现页面间的数据传递，掌握常见的传递方式及其应用场景。
---

# 页面间数据传递

在小程序开发中，页面间的数据传递是一个非常重要的概念。无论是从首页跳转到详情页，还是在多个页面之间共享数据，都需要通过某种方式将数据从一个页面传递到另一个页面。本文将详细介绍小程序中常见的页面间数据传递方式，并通过实际案例帮助你更好地理解和应用这些方法。

## 1. 什么是页面间数据传递？

页面间数据传递是指在一个小程序中，将数据从一个页面传递到另一个页面的过程。例如，当用户点击首页的商品列表中的某个商品时，我们需要将商品的详细信息传递到商品详情页，以便展示给用户。

在小程序中，页面间数据传递的方式有多种，包括通过 URL 参数传递、通过全局变量传递、通过缓存传递等。接下来，我们将逐一介绍这些方法。

## 2. 通过 URL 参数传递数据

通过 URL 参数传递数据是最常见的方式之一。当从一个页面跳转到另一个页面时，可以将数据作为 URL 参数传递给目标页面。

### 2.1 基本用法

假设我们有一个商品列表页面 `index`，当用户点击某个商品时，我们需要跳转到商品详情页面 `detail`，并将商品的 ID 传递给详情页面。

在 `index` 页面中，我们可以这样编写跳转代码：

```javascript
wx.navigateTo({
  url: '/pages/detail/detail?id=123'
});
```

在 `detail` 页面中，我们可以通过 `onLoad` 生命周期函数获取传递过来的参数：

```javascript
Page({
  onLoad(options) {
    const productId = options.id;
    console.log('商品ID:', productId); // 输出: 商品ID: 123
  }
});
```

### 2.2 注意事项

- URL 参数只能传递字符串类型的数据。如果需要传递复杂的数据结构（如对象或数组），需要先将数据序列化为字符串（例如使用 `JSON.stringify`），然后在目标页面中反序列化。
- URL 参数的长度有限制，通常不超过 1024 个字符。如果需要传递大量数据，建议使用其他方式。

## 3. 通过全局变量传递数据

全局变量是小程序中另一种常见的页面间数据传递方式。通过将数据存储在全局变量中，可以在不同的页面中共享这些数据。

### 3.1 基本用法

在小程序的 `app.js` 文件中，我们可以定义一个全局变量来存储数据：

```javascript
App({
  globalData: {
    productInfo: null
  }
});
```

在 `index` 页面中，我们可以将商品信息存储到全局变量中：

```javascript
const app = getApp();
app.globalData.productInfo = { id: 123, name: '商品A' };

wx.navigateTo({
  url: '/pages/detail/detail'
});
```

在 `detail` 页面中，我们可以从全局变量中获取商品信息：

```javascript
const app = getApp();
Page({
  onLoad() {
    const productInfo = app.globalData.productInfo;
    console.log('商品信息:', productInfo); // 输出: 商品信息: { id: 123, name: '商品A' }
  }
});
```

### 3.2 注意事项

- 全局变量在整个小程序的生命周期内都有效，因此需要注意内存管理，避免存储过多不必要的数据。
- 全局变量的数据是共享的，因此在多个页面中修改同一个全局变量时，可能会导致数据不一致的问题。

## 4. 通过缓存传递数据

小程序提供了本地缓存功能，可以将数据存储在本地缓存中，然后在不同的页面中读取这些数据。

### 4.1 基本用法

在 `index` 页面中，我们可以将商品信息存储到本地缓存中：

```javascript
wx.setStorageSync('productInfo', { id: 123, name: '商品A' });

wx.navigateTo({
  url: '/pages/detail/detail'
});
```

在 `detail` 页面中，我们可以从本地缓存中获取商品信息：

```javascript
Page({
  onLoad() {
    const productInfo = wx.getStorageSync('productInfo');
    console.log('商品信息:', productInfo); // 输出: 商品信息: { id: 123, name: '商品A' }
  }
});
```

### 4.2 注意事项

- 本地缓存的数据是持久化的，即使小程序关闭后，数据仍然存在。因此，需要注意缓存数据的清理，避免占用过多存储空间。
- 本地缓存的数据大小有限制，通常不超过 10MB。如果需要存储大量数据，建议使用其他方式。

## 5. 实际案例

假设我们正在开发一个电商小程序，用户可以在首页浏览商品列表，点击某个商品后跳转到商品详情页。我们需要将商品的 ID 和名称传递到详情页，并在详情页中展示商品的详细信息。

### 5.1 通过 URL 参数传递

在 `index` 页面中：

```javascript
wx.navigateTo({
  url: '/pages/detail/detail?id=123&name=商品A'
});
```

在 `detail` 页面中：

```javascript
Page({
  onLoad(options) {
    const productId = options.id;
    const productName = options.name;
    console.log('商品ID:', productId); // 输出: 商品ID: 123
    console.log('商品名称:', productName); // 输出: 商品名称: 商品A
  }
});
```

### 5.2 通过全局变量传递

在 `app.js` 中：

```javascript
App({
  globalData: {
    productInfo: null
  }
});
```

在 `index` 页面中：

```javascript
const app = getApp();
app.globalData.productInfo = { id: 123, name: '商品A' };

wx.navigateTo({
  url: '/pages/detail/detail'
});
```

在 `detail` 页面中：

```javascript
const app = getApp();
Page({
  onLoad() {
    const productInfo = app.globalData.productInfo;
    console.log('商品信息:', productInfo); // 输出: 商品信息: { id: 123, name: '商品A' }
  }
});
```

### 5.3 通过缓存传递

在 `index` 页面中：

```javascript
wx.setStorageSync('productInfo', { id: 123, name: '商品A' });

wx.navigateTo({
  url: '/pages/detail/detail'
});
```

在 `detail` 页面中：

```javascript
Page({
  onLoad() {
    const productInfo = wx.getStorageSync('productInfo');
    console.log('商品信息:', productInfo); // 输出: 商品信息: { id: 123, name: '商品A' }
  }
});
```

## 6. 总结

在小程序开发中，页面间的数据传递是一个非常重要的环节。通过 URL 参数、全局变量和本地缓存等方式，我们可以轻松地在不同页面之间传递数据。每种方式都有其适用的场景和注意事项，开发者需要根据实际需求选择合适的方式。

## 7. 附加资源与练习

- **练习 1**：尝试在一个小程序中使用 URL 参数传递一个对象类型的数据，并在目标页面中解析该对象。
- **练习 2**：使用全局变量和本地缓存分别实现页面间的数据传递，并比较两者的优缺点。
- **附加资源**：阅读小程序官方文档中关于 [页面路由](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/route.html) 和 [数据缓存](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.setStorageSync.html) 的部分，深入了解相关 API 的使用方法。

:::tip
在实际开发中，建议根据数据的复杂性和使用场景选择合适的数据传递方式。对于简单的数据传递，URL 参数是最方便的选择；而对于复杂的数据结构或需要在多个页面中共享的数据，全局变量或本地缓存可能更为合适。
:::