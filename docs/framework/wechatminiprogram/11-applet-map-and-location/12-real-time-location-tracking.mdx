---
title: 位置实时追踪
description: 了解如何使用小程序实现位置实时追踪功能，掌握相关 API 的使用方法，并通过实际案例加深理解。
---

## 介绍

位置实时追踪是现代应用程序中常见的功能之一，尤其是在需要实时监控移动对象（如共享单车、外卖配送等）的场景中。通过小程序的地图与位置 API，开发者可以轻松实现这一功能。本文将逐步讲解如何在小程序中实现位置实时追踪，并提供代码示例和实际应用场景。

## 基本概念

位置实时追踪的核心是通过设备的 GPS 或其他定位技术，持续获取用户或设备的地理位置信息，并将其实时显示在地图上。小程序提供了 `wx.getLocation` 和 `wx.onLocationChange` 等 API 来实现这一功能。

### 1. 获取用户位置

首先，我们需要获取用户的当前位置。小程序提供了 `wx.getLocation` 方法来实现这一功能。

```javascript
wx.getLocation({
  type: 'wgs84',
  success(res) {
    const latitude = res.latitude
    const longitude = res.longitude
    console.log(`当前位置：纬度 ${latitude}, 经度 ${longitude}`)
  },
  fail(err) {
    console.error('获取位置失败', err)
  }
})
```

- `type`: 指定返回的坐标类型，`wgs84` 表示返回 GPS 坐标。
- `success`: 获取位置成功后的回调函数，返回的 `res` 对象包含 `latitude` 和 `longitude` 属性。
- `fail`: 获取位置失败时的回调函数。

### 2. 实时追踪位置变化

为了实现实时追踪，我们需要监听位置的变化。小程序提供了 `wx.onLocationChange` 方法来监听位置的变化。

```javascript
wx.onLocationChange((res) => {
  const latitude = res.latitude
  const longitude = res.longitude
  console.log(`位置变化：纬度 ${latitude}, 经度 ${longitude}`)
})
```

- `res`: 包含最新的位置信息，包括 `latitude` 和 `longitude`。

:::note
注意：`wx.onLocationChange` 需要用户授权，并且可能会消耗较多的电量，因此在实际应用中应谨慎使用。
:::

### 3. 在地图上显示位置

获取到位置信息后，我们可以将其显示在小程序的地图组件上。以下是一个简单的示例：

```javascript
Page({
  data: {
    latitude: 0,
    longitude: 0,
  },
  onLoad() {
    wx.getLocation({
      type: 'wgs84',
      success: (res) => {
        this.setData({
          latitude: res.latitude,
          longitude: res.longitude,
        })
      },
    })

    wx.onLocationChange((res) => {
      this.setData({
        latitude: res.latitude,
        longitude: res.longitude,
      })
    })
  },
})
```

```html
<map
  latitude="{{latitude}}"
  longitude="{{longitude}}"
  markers="{{[{latitude, longitude}]}}"
  style="width: 100%; height: 300px;"
></map>
```

- `latitude` 和 `longitude`: 地图中心点的经纬度。
- `markers`: 在地图上显示的标记点。

## 实际应用场景

### 1. 共享单车实时追踪

在共享单车应用中，用户可以通过小程序实时查看单车的位置。通过 `wx.onLocationChange`，开发者可以实时更新单车的位置，并将其显示在地图上。

### 2. 外卖配送实时追踪

外卖配送应用中，用户可以通过小程序实时查看配送员的位置。通过 `wx.onLocationChange`，开发者可以实时更新配送员的位置，并将其显示在地图上。

## 总结

位置实时追踪是小程序中一个非常实用的功能，适用于多种场景。通过 `wx.getLocation` 和 `wx.onLocationChange`，开发者可以轻松实现这一功能。在实际应用中，需要注意用户授权和电量消耗等问题。

## 附加资源与练习

- **练习**: 尝试在小程序中实现一个简单的实时位置追踪功能，并将位置信息显示在地图上。
- **资源**: 参考小程序官方文档，了解更多关于地图与位置 API 的使用方法。

:::tip
提示：在实际开发中，建议结合后台服务来存储和处理位置数据，以便实现更复杂的功能，如历史轨迹回放等。
:::