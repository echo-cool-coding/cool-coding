---
title: 模板消息使用
description: 了解如何在小程序中使用模板消息，向用户发送重要的通知和提醒。本文将从基础概念到实际应用，逐步讲解模板消息的使用方法。
---

# 模板消息使用

在小程序开发中，模板消息是一种非常重要的功能，它允许开发者向用户发送重要的通知和提醒。这些消息通常用于订单状态更新、活动提醒、系统通知等场景。通过模板消息，开发者可以确保用户及时获取关键信息，从而提升用户体验。

## 什么是模板消息？

模板消息是小程序提供的一种消息推送机制。开发者可以通过预先定义的模板，向用户发送结构化的消息。这些消息会显示在用户的微信聊天列表中，用户点击后可以直接跳转到小程序的相关页面。

:::note
模板消息需要用户主动触发某些行为（如提交表单、支付等）后才能发送，且有一定的发送限制。
:::

## 模板消息的使用步骤

### 1. 获取模板 ID

首先，你需要在微信公众平台申请模板消息的模板 ID。登录微信公众平台，进入“功能” -> “模板消息” -> “我的模板”，选择适合的模板并获取其 ID。

### 2. 发送模板消息

在小程序中，你可以通过调用微信提供的 API 来发送模板消息。以下是一个简单的示例代码：

```javascript
wx.requestSubscribeMessage({
  tmplIds: ['TEMPLATE_ID'], // 模板 ID
  success(res) {
    if (res['TEMPLATE_ID'] === 'accept') {
      // 用户同意接收模板消息
      wx.request({
        url: 'https://api.weixin.qq.com/cgi-bin/message/wxopen/template/send',
        method: 'POST',
        data: {
          touser: 'USER_OPENID', // 用户的 openid
          template_id: 'TEMPLATE_ID', // 模板 ID
          page: 'pages/index/index', // 点击消息后跳转的页面
          data: {
            keyword1: {
              value: '订单状态' // 模板中的第一个关键词
            },
            keyword2: {
              value: '已发货' // 模板中的第二个关键词
            }
          }
        },
        success(res) {
          console.log('模板消息发送成功', res);
        },
        fail(err) {
          console.error('模板消息发送失败', err);
        }
      });
    }
  }
});
```

### 3. 处理用户授权

在发送模板消息之前，你需要确保用户已经授权接收模板消息。可以通过 `wx.requestSubscribeMessage` 方法请求用户授权。

```javascript
wx.requestSubscribeMessage({
  tmplIds: ['TEMPLATE_ID'], // 模板 ID
  success(res) {
    if (res['TEMPLATE_ID'] === 'accept') {
      console.log('用户同意接收模板消息');
    } else {
      console.log('用户拒绝接收模板消息');
    }
  }
});
```

## 实际应用场景

### 订单状态通知

假设你正在开发一个电商小程序，用户下单后，你需要通知用户订单的状态变化。你可以使用模板消息来发送“订单已发货”、“订单已签收”等通知。

```javascript
wx.request({
  url: 'https://api.weixin.qq.com/cgi-bin/message/wxopen/template/send',
  method: 'POST',
  data: {
    touser: 'USER_OPENID',
    template_id: 'ORDER_STATUS_TEMPLATE_ID',
    page: 'pages/order/order',
    data: {
      keyword1: {
        value: '订单号：123456'
      },
      keyword2: {
        value: '已发货'
      },
      keyword3: {
        value: '2023-10-01 10:00:00'
      }
    }
  },
  success(res) {
    console.log('订单状态通知发送成功', res);
  },
  fail(err) {
    console.error('订单状态通知发送失败', err);
  }
});
```

### 活动提醒

如果你正在策划一个线上活动，可以通过模板消息提醒用户活动的开始时间、参与方式等信息。

```javascript
wx.request({
  url: 'https://api.weixin.qq.com/cgi-bin/message/wxopen/template/send',
  method: 'POST',
  data: {
    touser: 'USER_OPENID',
    template_id: 'ACTIVITY_REMINDER_TEMPLATE_ID',
    page: 'pages/activity/activity',
    data: {
      keyword1: {
        value: '双十一大促'
      },
      keyword2: {
        value: '2023-11-11 00:00:00'
      },
      keyword3: {
        value: '点击参与'
      }
    }
  },
  success(res) {
    console.log('活动提醒发送成功', res);
  },
  fail(err) {
    console.error('活动提醒发送失败', err);
  }
});
```

## 总结

模板消息是小程序中非常重要的功能，它可以帮助开发者向用户发送重要的通知和提醒。通过本文的学习，你应该已经掌握了如何获取模板 ID、发送模板消息以及处理用户授权。希望你能在实际开发中灵活运用这些知识，提升小程序的用户体验。

## 附加资源

- [微信官方文档 - 模板消息](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/template-message.html)
- [小程序开发指南](https://developers.weixin.qq.com/ebook?action=get_post_info&docid=0008aeea9a8978ab0086a685851c0a)

## 练习

1. 尝试在你的小程序中实现一个订单状态通知功能，使用模板消息发送“订单已发货”通知。
2. 设计一个活动提醒功能，使用模板消息提醒用户活动的开始时间和参与方式。

:::tip
在开发过程中，记得测试模板消息的发送效果，确保用户能够正常接收并查看消息。
:::