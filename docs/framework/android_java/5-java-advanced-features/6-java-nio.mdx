---
title: Java NIO
description: 了解 Java NIO（非阻塞 I/O）的核心概念、工作原理及其在实际开发中的应用。
---

# Java NIO

Java NIO（New I/O）是 Java 1.4 引入的一组用于高效处理 I/O 操作的 API。与传统的 Java I/O（即 `java.io` 包）不同，Java NIO 提供了非阻塞 I/O、通道（Channel）和缓冲区（Buffer）等特性，能够显著提高 I/O 操作的性能，尤其是在处理大量并发连接时。

## 为什么需要 Java NIO？

传统的 Java I/O 是基于流的（Stream-based），这意味着它是阻塞的：当一个线程执行 I/O 操作时，它会一直等待，直到操作完成。这种模型在处理少量连接时表现良好，但在高并发场景下（如网络服务器），阻塞 I/O 会导致性能瓶颈。

Java NIO 通过引入非阻塞 I/O 和事件驱动模型，使得一个线程可以同时处理多个连接，从而显著提高了系统的吞吐量。

---

## Java NIO 的核心组件

Java NIO 的核心组件包括以下几个部分：

1. **缓冲区（Buffer）**：用于存储数据。
2. **通道（Channel）**：用于传输数据。
3. **选择器（Selector）**：用于监控多个通道的事件。

### 1. 缓冲区（Buffer）

缓冲区是 Java NIO 中用于存储数据的容器。它是一个固定大小的数组，支持读写操作。常见的缓冲区类型包括 `ByteBuffer`、`CharBuffer`、`IntBuffer` 等。

以下是一个使用 `ByteBuffer` 的简单示例：

```java
import java.nio.ByteBuffer;

public class BufferExample {
    public static void main(String[] args) {
        // 分配一个容量为 10 的 ByteBuffer
        ByteBuffer buffer = ByteBuffer.allocate(10);

        // 写入数据
        buffer.put((byte) 'H');
        buffer.put((byte) 'e');
        buffer.put((byte) 'l');
        buffer.put((byte) 'l');
        buffer.put((byte) 'o');

        // 切换到读模式
        buffer.flip();

        // 读取数据
        while (buffer.hasRemaining()) {
            System.out.print((char) buffer.get());
        }
    }
}
```

**输出：**
```
Hello
```

### 2. 通道（Channel）

通道是 Java NIO 中用于传输数据的对象。与流不同，通道是双向的，既可以读也可以写。常见的通道类型包括 `FileChannel`、`SocketChannel` 和 `ServerSocketChannel`。

以下是一个使用 `FileChannel` 读取文件的示例：

```java
import java.io.RandomAccessFile;
import java.nio.ByteBuffer;
import java.nio.channels.FileChannel;

public class ChannelExample {
    public static void main(String[] args) throws Exception {
        // 打开文件并获取 FileChannel
        RandomAccessFile file = new RandomAccessFile("example.txt", "rw");
        FileChannel channel = file.getChannel();

        // 分配缓冲区
        ByteBuffer buffer = ByteBuffer.allocate(1024);

        // 从通道读取数据到缓冲区
        int bytesRead = channel.read(buffer);

        // 切换到读模式并输出数据
        buffer.flip();
        while (buffer.hasRemaining()) {
            System.out.print((char) buffer.get());
        }

        // 关闭通道和文件
        channel.close();
        file.close();
    }
}
```

### 3. 选择器（Selector）

选择器是 Java NIO 中用于监控多个通道事件的对象。通过选择器，一个线程可以同时处理多个通道的 I/O 操作，从而实现非阻塞 I/O。

以下是一个简单的选择器示例：

```java
import java.nio.channels.Selector;
import java.nio.channels.ServerSocketChannel;
import java.nio.channels.SelectionKey;
import java.net.InetSocketAddress;

public class SelectorExample {
    public static void main(String[] args) throws Exception {
        // 创建选择器
        Selector selector = Selector.open();

        // 创建 ServerSocketChannel 并绑定端口
        ServerSocketChannel serverChannel = ServerSocketChannel.open();
        serverChannel.bind(new InetSocketAddress(8080));
        serverChannel.configureBlocking(false);

        // 将 ServerSocketChannel 注册到选择器，监听连接事件
        serverChannel.register(selector, SelectionKey.OP_ACCEPT);

        // 事件循环
        while (true) {
            selector.select(); // 阻塞，直到有事件发生
            for (SelectionKey key : selector.selectedKeys()) {
                if (key.isAcceptable()) {
                    // 处理连接事件
                    System.out.println("New connection accepted!");
                }
            }
        }
    }
}
```

---

## 实际应用场景

Java NIO 广泛应用于需要高并发处理的场景，例如：

1. **网络服务器**：如 Web 服务器、聊天服务器等。
2. **文件传输**：如大文件的分块传输。
3. **实时数据处理**：如金融交易系统。

---

## 总结

Java NIO 提供了一种高效处理 I/O 操作的方式，特别适合高并发场景。通过缓冲区、通道和选择器的组合，Java NIO 能够显著提高系统的性能和吞吐量。

:::tip
如果你对 Java NIO 感兴趣，可以尝试以下练习：
1. 实现一个简单的聊天服务器。
2. 使用 `FileChannel` 实现文件的复制功能。
3. 深入学习 `Selector` 的高级用法，如处理读写事件。
:::

---

## 附加资源

- [Java NIO 官方文档](https://docs.oracle.com/javase/8/docs/api/java/nio/package-summary.html)
- 《Java NIO》书籍（作者：Ron Hitchens）
- [Java NIO 教程](https://www.baeldung.com/java-nio)