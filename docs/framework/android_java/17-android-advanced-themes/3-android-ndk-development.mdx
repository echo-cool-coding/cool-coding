---
title: Android NDK开发
description: "了解如何使用Android NDK（Native Development Kit）进行高性能的本地代码开发，扩展Android应用的功能。"
---

# Android NDK开发

## 介绍

Android NDK（Native Development Kit）是一个工具集，允许开发者使用C、C++等本地语言编写Android应用的部分代码。通过NDK，开发者可以访问底层系统资源，优化性能，并重用现有的C/C++代码库。NDK通常用于需要高性能计算的应用场景，如游戏、图像处理和音频处理。

在本教程中，我们将逐步介绍如何使用Android NDK进行开发，并通过实际案例展示其应用。

## 安装与配置

### 1. 安装NDK

首先，确保你已经安装了Android Studio。然后，打开SDK Manager，选择“SDK Tools”选项卡，勾选“NDK (Native Development Kit)”并点击“Apply”进行安装。

### 2. 配置项目

在Android Studio中创建一个新项目或打开现有项目。在项目的`build.gradle`文件中，添加NDK支持：

```groovy
android {
    ...
    defaultConfig {
        ...
        ndk {
            abiFilters "armeabi-v7a", "arm64-v8a", "x86", "x86_64"
        }
    }
    ...
}
```

## 编写本地代码

### 1. 创建本地方法

在Java或Kotlin类中声明一个本地方法：

```java
public class NativeLib {
    static {
        System.loadLibrary("native-lib");
    }

    public native String stringFromJNI();
}
```

### 2. 生成C/C++头文件

使用`javah`工具生成C/C++头文件。在终端中运行以下命令：

```bash
javah -jni com.example.NativeLib
```

这将生成一个名为`com_example_NativeLib.h`的头文件。

### 3. 实现本地方法

在`cpp`目录下创建一个新的C++文件（例如`native-lib.cpp`），并实现头文件中的方法：

```cpp
#include <jni.h>
#include <string>

extern "C" JNIEXPORT jstring JNICALL
Java_com_example_NativeLib_stringFromJNI(JNIEnv* env, jobject /* this */) {
    std::string hello = "Hello from C++";
    return env->NewStringUTF(hello.c_str());
}
```

## 构建与运行

### 1. 构建项目

在Android Studio中点击“Build” > “Make Project”来构建项目。如果一切顺利，NDK将编译你的C++代码并将其打包到APK中。

### 2. 运行应用

在设备或模拟器上运行应用。你应该会看到从C++代码返回的字符串“Hello from C++”显示在屏幕上。

## 实际案例

### 图像处理

假设你正在开发一个图像处理应用，需要高性能的像素操作。你可以使用NDK编写C++代码来处理图像数据，并通过JNI将结果返回给Java层。

```cpp
extern "C" JNIEXPORT void JNICALL
Java_com_example_ImageProcessor_processImage(JNIEnv* env, jobject /* this */, jintArray pixels, jint width, jint height) {
    jint* pixelArray = env->GetIntArrayElements(pixels, NULL);
    // 在这里进行图像处理
    env->ReleaseIntArrayElements(pixels, pixelArray, 0);
}
```

### 音频处理

在音频处理应用中，你可以使用NDK来处理音频流，实现低延迟的音频效果。

```cpp
extern "C" JNIEXPORT void JNICALL
Java_com_example_AudioProcessor_processAudio(JNIEnv* env, jobject /* this */, jshortArray audioData, jint length) {
    jshort* audioArray = env->GetShortArrayElements(audioData, NULL);
    // 在这里进行音频处理
    env->ReleaseShortArrayElements(audioData, audioArray, 0);
}
```

## 总结

Android NDK为开发者提供了强大的工具，用于编写高性能的本地代码。通过本教程，你已经学会了如何配置NDK、编写本地方法、构建项目以及在实际应用中使用NDK。

## 附加资源

- [Android NDK官方文档](https://developer.android.com/ndk)
- [JNI编程指南](https://docs.oracle.com/javase/7/docs/technotes/guides/jni/)
- [NDK示例代码](https://github.com/android/ndk-samples)

## 练习

1. 尝试在现有项目中添加一个新的本地方法，并返回一个计算后的整数值。
2. 使用NDK实现一个简单的图像滤镜，并将其应用到图像视图上。
3. 探索NDK中的多线程编程，尝试在C++代码中创建和管理线程。

通过不断练习，你将更加熟练地掌握Android NDK开发，并能够在实际项目中应用这些技能。