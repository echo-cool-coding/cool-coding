---
title: Android地图集成
description: 学习如何在Android应用中集成地图功能，使用Google Maps API实现地图显示、标记、导航等功能。
---

# Android地图集成

在现代移动应用中，地图功能已经成为不可或缺的一部分。无论是导航、位置标记，还是基于位置的服务，地图集成都能为用户提供直观的交互体验。本文将带你逐步学习如何在Android应用中集成地图功能，使用Google Maps API实现地图显示、标记、导航等功能。

## 1. 介绍

Android地图集成通常依赖于Google Maps API，这是一套强大的工具，允许开发者在应用中嵌入地图、添加标记、绘制路线等。通过Google Maps API，你可以轻松实现以下功能：

- 显示地图
- 添加标记（Marker）
- 绘制路线
- 获取用户当前位置
- 实现导航功能

在开始之前，你需要确保已经具备以下条件：

- 一个Google Cloud Platform (GCP) 项目
- 启用了Google Maps SDK for Android
- 获取了API密钥

## 2. 设置Google Maps API

首先，你需要在Google Cloud Console中启用Google Maps SDK for Android，并获取API密钥。以下是具体步骤：

1. 登录Google Cloud Console。
2. 创建一个新项目或选择现有项目。
3. 导航到“API和服务” > “库”。
4. 搜索“Google Maps SDK for Android”并启用它。
5. 在“API和服务” > “凭据”中创建一个API密钥。

:::note
确保在Android应用的 `AndroidManifest.xml` 文件中添加API密钥：

```xml
<meta-data
    android:name="com.google.android.geo.API_KEY"
    android:value="YOUR_API_KEY" />
```
:::

## 3. 在应用中显示地图

接下来，我们将创建一个简单的Android应用，显示Google地图。

### 3.1 添加依赖

首先，在 `build.gradle` 文件中添加Google Maps依赖：

```groovy
dependencies {
    implementation 'com.google.android.gms:play-services-maps:18.1.0'
}
```

### 3.2 创建地图布局

在 `res/layout/activity_main.xml` 中，添加一个 `MapFragment` 或 `MapView`：

```xml
<fragment
    android:id="@+id/map"
    android:name="com.google.android.gms.maps.SupportMapFragment"
    android:layout_width="match_parent"
    android:layout_height="match_parent" />
```

### 3.3 初始化地图

在 `MainActivity.java` 中，初始化地图：

```java
import android.os.Bundle;
import androidx.fragment.app.FragmentActivity;
import com.google.android.gms.maps.CameraUpdateFactory;
import com.google.android.gms.maps.GoogleMap;
import com.google.android.gms.maps.OnMapReadyCallback;
import com.google.android.gms.maps.SupportMapFragment;
import com.google.android.gms.maps.model.LatLng;
import com.google.android.gms.maps.model.MarkerOptions;

public class MainActivity extends FragmentActivity implements OnMapReadyCallback {

    private GoogleMap mMap;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        SupportMapFragment mapFragment = (SupportMapFragment) getSupportFragmentManager()
                .findFragmentById(R.id.map);
        mapFragment.getMapAsync(this);
    }

    @Override
    public void onMapReady(GoogleMap googleMap) {
        mMap = googleMap;

        // 添加一个标记并移动相机
        LatLng sydney = new LatLng(-34, 151);
        mMap.addMarker(new MarkerOptions().position(sydney).title("Marker in Sydney"));
        mMap.moveCamera(CameraUpdateFactory.newLatLng(sydney));
    }
}
```

### 3.4 运行应用

运行应用后，你将看到一个显示悉尼位置的地图，并带有一个标记。

## 4. 添加标记和绘制路线

### 4.1 添加标记

在上面的代码中，我们已经展示了如何添加一个简单的标记。你可以通过 `MarkerOptions` 自定义标记的图标、标题等信息。

```java
mMap.addMarker(new MarkerOptions()
    .position(new LatLng(-34, 151))
    .title("Sydney")
    .icon(BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_BLUE)));
```

### 4.2 绘制路线

要在地图上绘制路线，你可以使用 `Polyline`。以下是一个简单的示例：

```java
Polyline line = mMap.addPolyline(new PolylineOptions()
    .add(new LatLng(-34, 151), new LatLng(-35, 150))
    .width(5)
    .color(Color.RED));
```

## 5. 获取用户当前位置

要获取用户的当前位置，你可以使用 `FusedLocationProviderClient`。首先，确保在 `AndroidManifest.xml` 中添加位置权限：

```xml
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
```

然后，在代码中请求位置权限并获取位置：

```java
FusedLocationProviderClient fusedLocationClient = LocationServices.getFusedLocationProviderClient(this);

if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)
        == PackageManager.PERMISSION_GRANTED) {
    fusedLocationClient.getLastLocation()
        .addOnSuccessListener(this, new OnSuccessListener<Location>() {
            @Override
            public void onSuccess(Location location) {
                if (location != null) {
                    LatLng currentLocation = new LatLng(location.getLatitude(), location.getLongitude());
                    mMap.addMarker(new MarkerOptions().position(currentLocation).title("You are here"));
                    mMap.moveCamera(CameraUpdateFactory.newLatLngZoom(currentLocation, 15));
                }
            }
        });
}
```

## 6. 实际应用场景

地图集成在许多实际应用场景中都非常有用，例如：

- **导航应用**：显示路线和实时交通信息。
- **外卖应用**：显示餐厅位置和配送路线。
- **社交应用**：显示用户当前位置和附近的朋友。

## 7. 总结

通过本文，你已经学会了如何在Android应用中集成Google Maps API，并实现了地图显示、标记、路线绘制和获取用户位置等功能。这些技能将帮助你在开发中创建更加丰富和实用的应用。

## 8. 附加资源与练习

- **Google Maps API 文档**：[Google Maps Android API](https://developers.google.com/maps/documentation/android-sdk/intro)
- **练习**：尝试在你的应用中添加多个标记，并使用不同的颜色绘制多条路线。

:::tip
如果你遇到任何问题，可以参考Google Maps API的官方文档，或者在开发者社区中寻求帮助。
:::