---
title: Android ExoPlayer
description: 了解 Android ExoPlayer，一个强大的媒体播放库，适用于流媒体和本地媒体播放。本文将从基础概念到实际应用，逐步讲解如何使用 ExoPlayer 构建多媒体播放功能。
---

# Android ExoPlayer

## 介绍

ExoPlayer 是 Google 提供的一个开源媒体播放库，专为 Android 应用程序设计。它支持多种媒体格式，包括 MP4、MP3、HLS、DASH 等，并且可以轻松集成到 Android 应用中。与 Android 内置的 `MediaPlayer` 相比，ExoPlayer 提供了更高的灵活性和可扩展性，适用于流媒体播放、自定义渲染器、DRM 支持等高级功能。

ExoPlayer 的核心优势在于其模块化设计，开发者可以根据需求定制播放器的各个组件，例如数据源、渲染器、音视频解码器等。

## 安装 ExoPlayer

要在项目中使用 ExoPlayer，首先需要将其依赖项添加到 `build.gradle` 文件中：

```groovy
dependencies {
    implementation 'com.google.android.exoplayer:exoplayer:2.X.X'
}
```

请将 `2.X.X` 替换为最新的 ExoPlayer 版本。

## 基本用法

### 初始化 ExoPlayer

以下是一个简单的示例，展示如何初始化 ExoPlayer 并播放一个视频文件：

```kotlin
val player = ExoPlayer.Builder(context).build()
val mediaItem = MediaItem.fromUri("https://example.com/video.mp4")
player.setMediaItem(mediaItem)
player.prepare()
player.play()
```

### 设置播放器视图

为了在 UI 中显示视频，可以使用 `PlayerView`：

```xml
<com.google.android.exoplayer2.ui.PlayerView
    android:id="@+id/player_view"
    android:layout_width="match_parent"
    android:layout_height="match_parent" />
```

然后在代码中将其与 ExoPlayer 关联：

```kotlin
val playerView = findViewById<PlayerView>(R.id.player_view)
playerView.player = player
```

## 高级功能

### 处理播放状态

ExoPlayer 提供了多种监听器来监控播放状态。例如，可以使用 `Player.Listener` 来监听播放事件：

```kotlin
player.addListener(object : Player.Listener {
    override fun onPlaybackStateChanged(state: Int) {
        when (state) {
            Player.STATE_READY -> println("播放器已准备好")
            Player.STATE_ENDED -> println("播放结束")
            Player.STATE_BUFFERING -> println("正在缓冲")
            Player.STATE_IDLE -> println("播放器空闲")
        }
    }
})
```

### 自定义数据源

ExoPlayer 允许开发者自定义数据源。例如，可以使用 `HttpDataSource` 来从网络加载媒体文件：

```kotlin
val dataSourceFactory = DefaultHttpDataSource.Factory()
val mediaSource = ProgressiveMediaSource.Factory(dataSourceFactory)
    .createMediaSource(MediaItem.fromUri("https://example.com/video.mp4"))
player.setMediaSource(mediaSource)
player.prepare()
```

## 实际应用场景

### 流媒体播放

ExoPlayer 非常适合用于流媒体播放，例如 HLS 或 DASH 格式的视频。以下是一个播放 HLS 流的示例：

```kotlin
val hlsMediaSource = HlsMediaSource.Factory(dataSourceFactory)
    .createMediaSource(MediaItem.fromUri("https://example.com/stream.m3u8"))
player.setMediaSource(hlsMediaSource)
player.prepare()
```

### 离线播放

ExoPlayer 还支持离线播放。可以通过下载媒体文件到本地存储，然后使用 `FileDataSource` 来播放：

```kotlin
val file = File(context.getExternalFilesDir(null), "video.mp4")
val fileDataSourceFactory = FileDataSource.Factory()
val mediaSource = ProgressiveMediaSource.Factory(fileDataSourceFactory)
    .createMediaSource(MediaItem.fromUri(Uri.fromFile(file)))
player.setMediaSource(mediaSource)
player.prepare()
```

## 总结

ExoPlayer 是一个功能强大且灵活的媒体播放库，适用于各种 Android 应用场景。通过本文，您已经了解了如何初始化 ExoPlayer、设置播放器视图、处理播放状态以及实现流媒体和离线播放。希望这些内容能帮助您在项目中成功集成 ExoPlayer。

## 附加资源

- [ExoPlayer 官方文档](https://exoplayer.dev/guide.html)
- [ExoPlayer GitHub 仓库](https://github.com/google/ExoPlayer)
- [Android 开发者指南 - 多媒体](https://developer.android.com/guide/topics/media)

## 练习

1. 尝试在您的 Android 项目中集成 ExoPlayer，并播放一个本地视频文件。
2. 修改代码，使其支持 HLS 流媒体播放。
3. 实现一个功能，当视频播放结束时自动播放下一个视频。
