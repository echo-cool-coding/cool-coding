---
title: Android UI 测试
description: 了解 Android UI 测试的基础知识，学习如何使用 Espresso 和 UI Automator 进行 UI 测试，并通过实际案例掌握其应用。
---

# Android UI 测试

在 Android 应用开发中，UI 测试是确保应用界面行为符合预期的重要环节。通过 UI 测试，开发者可以模拟用户与应用的交互，验证界面元素的显示、点击事件、输入操作等是否正常工作。本文将介绍 Android UI 测试的基础知识，并逐步讲解如何使用 Espresso 和 UI Automator 进行 UI 测试。

## 什么是 Android UI 测试？

Android UI 测试是一种自动化测试方法，用于验证应用的用户界面是否按预期工作。它模拟用户与应用的交互，例如点击按钮、输入文本、滑动屏幕等，并检查界面元素的状态和行为是否符合预期。

UI 测试通常分为两类：
1. **基于视图的测试**：使用 Espresso 框架，适用于单个应用内的 UI 测试。
2. **跨应用测试**：使用 UI Automator 框架，适用于测试多个应用之间的交互。

## 使用 Espresso 进行 UI 测试

Espresso 是 Android 官方推荐的 UI 测试框架，专为单个应用内的 UI 测试设计。它提供了简洁的 API，能够轻松编写和执行 UI 测试。

### 1. 设置 Espresso

首先，在项目的 `build.gradle` 文件中添加 Espresso 依赖：

```groovy
dependencies {
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.5.1'
    androidTestImplementation 'androidx.test:runner:1.5.2'
    androidTestImplementation 'androidx.test:rules:1.5.2'
}
```

### 2. 编写 Espresso 测试

以下是一个简单的 Espresso 测试示例，测试一个按钮点击后是否显示正确的文本：

```kotlin
import androidx.test.espresso.Espresso.onView
import androidx.test.espresso.action.ViewActions.click
import androidx.test.espresso.assertion.ViewAssertions.matches
import androidx.test.espresso.matcher.ViewMatchers.withId
import androidx.test.espresso.matcher.ViewMatchers.withText
import androidx.test.ext.junit.rules.ActivityScenarioRule
import androidx.test.ext.junit.runners.AndroidJUnit4
import org.junit.Rule
import org.junit.Test
import org.junit.runner.RunWith

@RunWith(AndroidJUnit4::class)
class MainActivityTest {

    @get:Rule
    val activityRule = ActivityScenarioRule(MainActivity::class.java)

    @Test
    fun testButtonClick() {
        // 点击按钮
        onView(withId(R.id.button)).perform(click())

        // 验证文本是否正确显示
        onView(withId(R.id.textView)).check(matches(withText("Hello, Espresso!")))
    }
}
```

### 3. 运行测试

在 Android Studio 中，右键点击测试类并选择 `Run`，即可执行测试。如果测试通过，说明按钮点击后文本显示正确。

:::tip
Espresso 提供了丰富的 API，例如 `onView()`、`perform()`、`check()` 等，可以轻松模拟用户操作并验证界面状态。
:::

## 使用 UI Automator 进行跨应用测试

UI Automator 是另一个 Android 官方测试框架，适用于跨应用测试。它可以访问设备上的所有应用，并模拟用户操作，例如点击系统设置、与其他应用交互等。

### 1. 设置 UI Automator

在 `build.gradle` 文件中添加 UI Automator 依赖：

```groovy
dependencies {
    androidTestImplementation 'androidx.test.uiautomator:uiautomator:2.2.0'
}
```

### 2. 编写 UI Automator 测试

以下是一个简单的 UI Automator 测试示例，测试设备设置中的 Wi-Fi 开关是否正常工作：

```kotlin
import androidx.test.uiautomator.By
import androidx.test.uiautomator.UiDevice
import androidx.test.uiautomator.Until
import androidx.test.platform.app.InstrumentationRegistry
import org.junit.Before
import org.junit.Test

class SettingsTest {

    private lateinit var device: UiDevice

    @Before
    fun setUp() {
        // 获取设备实例
        device = UiDevice.getInstance(InstrumentationRegistry.getInstrumentation())
    }

    @Test
    fun testWifiSwitch() {
        // 打开设置应用
        device.pressHome()
        device.findObject(By.desc("Settings")).click()

        // 点击 Wi-Fi 设置
        device.wait(Until.findObject(By.text("Wi-Fi")), 3000).click()

        // 切换 Wi-Fi 开关
        val wifiSwitch = device.findObject(By.res("android:id/switch_widget"))
        wifiSwitch.click()

        // 验证 Wi-Fi 开关状态
        assert(wifiSwitch.isChecked)
    }
}
```

### 3. 运行测试

与 Espresso 测试类似，在 Android Studio 中运行 UI Automator 测试即可。

:::caution
UI Automator 测试需要设备权限，并且可能无法在模拟器上正常运行。建议在真实设备上运行测试。
:::

## 实际案例：测试登录界面

假设我们有一个登录界面，包含用户名输入框、密码输入框和登录按钮。我们需要测试以下场景：
1. 输入正确的用户名和密码后，点击登录按钮，跳转到主界面。
2. 输入错误的用户名或密码后，显示错误提示。

### 1. 使用 Espresso 测试登录界面

```kotlin
@Test
fun testLoginSuccess() {
    // 输入用户名和密码
    onView(withId(R.id.username)).perform(typeText("user123"))
    onView(withId(R.id.password)).perform(typeText("password123"))

    // 点击登录按钮
    onView(withId(R.id.loginButton)).perform(click())

    // 验证是否跳转到主界面
    onView(withId(R.id.mainActivity)).check(matches(isDisplayed()))
}

@Test
fun testLoginFailure() {
    // 输入错误的用户名和密码
    onView(withId(R.id.username)).perform(typeText("wrongUser"))
    onView(withId(R.id.password)).perform(typeText("wrongPassword"))

    // 点击登录按钮
    onView(withId(R.id.loginButton)).perform(click())

    // 验证错误提示是否显示
    onView(withId(R.id.errorMessage)).check(matches(withText("Invalid credentials")))
}
```

### 2. 使用 UI Automator 测试登录界面

```kotlin
@Test
fun testLoginWithUI Automator() {
    // 打开应用
    device.pressHome()
    device.findObject(By.desc("MyApp")).click()

    // 输入用户名和密码
    device.findObject(By.res("com.example.myapp:id/username")).text = "user123"
    device.findObject(By.res("com.example.myapp:id/password")).text = "password123"

    // 点击登录按钮
    device.findObject(By.res("com.example.myapp:id/loginButton")).click()

    // 验证是否跳转到主界面
    assert(device.findObject(By.res("com.example.myapp:id/mainActivity")).exists())
}
```

## 总结

Android UI 测试是确保应用界面行为符合预期的重要工具。通过 Espresso 和 UI Automator，开发者可以轻松编写和执行 UI 测试，验证应用的用户界面是否正常工作。本文介绍了这两种框架的基本用法，并通过实际案例展示了如何测试登录界面。

:::note
建议在实际项目中结合单元测试和 UI 测试，全面覆盖应用的各个功能模块。
:::

## 附加资源与练习

1. **官方文档**：
   - [Espresso 官方文档](https://developer.android.com/training/testing/espresso)
   - [UI Automator 官方文档](https://developer.android.com/training/testing/ui-automator)

2. **练习**：
   - 编写一个 Espresso 测试，验证 RecyclerView 中的列表项是否正确显示。
   - 使用 UI Automator 测试设备设置中的蓝牙开关功能。

通过不断练习和实践，你将能够熟练掌握 Android UI 测试的技巧，并提升应用的质量和用户体验。