---
title: Android Hilt
description: 了解 Android Hilt，一个简化依赖注入的库，适合初学者学习如何在 Android 应用中使用 Hilt 进行架构设计。
---

# Android Hilt

## 介绍

Android Hilt 是 Google 推出的一个依赖注入库，基于 Dagger 构建，旨在简化 Android 应用中的依赖注入过程。依赖注入是一种设计模式，允许对象从外部接收其依赖项，而不是自己创建它们。Hilt 通过减少样板代码和提供标准化的依赖注入方式，使开发者能够更专注于业务逻辑。

Hilt 的主要特点包括：
- **与 Android 组件深度集成**：Hilt 直接支持 Activity、Fragment、Service 等 Android 组件。
- **减少样板代码**：Hilt 自动生成许多 Dagger 所需的代码，减少了开发者的工作量。
- **易于学习和使用**：Hilt 提供了清晰的 API 和文档，适合初学者快速上手。

## 安装 Hilt

要在项目中使用 Hilt，首先需要在 `build.gradle` 文件中添加依赖项：

```groovy
// 项目级别的 build.gradle
buildscript {
    dependencies {
        classpath 'com.google.dagger:hilt-android-gradle-plugin:2.40.5'
    }
}

// 应用级别的 build.gradle
plugins {
    id 'com.android.application'
    id 'kotlin-android'
    id 'kotlin-kapt'
    id 'dagger.hilt.android.plugin'
}

dependencies {
    implementation 'com.google.dagger:hilt-android:2.40.5'
    kapt 'com.google.dagger:hilt-compiler:2.40.5'
}
```

## 基本用法

### 1. 定义依赖项

首先，我们需要定义一个依赖项。例如，假设我们有一个 `UserRepository` 类：

```kotlin
class UserRepository {
    fun getUser(): String {
        return "John Doe"
    }
}
```

### 2. 使用 Hilt 注入依赖

接下来，我们需要告诉 Hilt 如何提供 `UserRepository` 的实例。我们可以通过创建一个 `Module` 来实现：

```kotlin
@Module
@InstallIn(SingletonComponent::class)
object AppModule {

    @Provides
    @Singleton
    fun provideUserRepository(): UserRepository {
        return UserRepository()
    }
}
```

在上面的代码中，`@Module` 注解表示这是一个 Hilt 模块，`@InstallIn(SingletonComponent::class)` 表示该模块在整个应用生命周期内都是单例的。`@Provides` 注解用于告诉 Hilt 如何提供 `UserRepository` 的实例。

### 3. 在 Activity 中使用依赖

现在，我们可以在 Activity 中使用 `UserRepository` 了。首先，我们需要使用 `@AndroidEntryPoint` 注解标记 Activity：

```kotlin
@AndroidEntryPoint
class MainActivity : AppCompatActivity() {

    @Inject
    lateinit var userRepository: UserRepository

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        val user = userRepository.getUser()
        println("User: $user") // 输出: User: John Doe
    }
}
```

在上面的代码中，`@Inject` 注解用于告诉 Hilt 将 `UserRepository` 注入到 `MainActivity` 中。

## 实际案例

假设我们正在开发一个简单的新闻应用，我们需要从网络获取新闻数据并显示在 UI 上。我们可以使用 Hilt 来管理 `NewsRepository` 和 `NewsViewModel` 的依赖关系。

### 1. 定义 `NewsRepository`

```kotlin
class NewsRepository @Inject constructor(
    private val newsApi: NewsApi
) {
    fun getNews(): List<News> {
        return newsApi.fetchNews()
    }
}
```

### 2. 定义 `NewsApi`

```kotlin
interface NewsApi {
    fun fetchNews(): List<News>
}

class NewsApiImpl @Inject constructor() : NewsApi {
    override fun fetchNews(): List<News> {
        // 模拟从网络获取新闻数据
        return listOf(News("Title 1", "Content 1"), News("Title 2", "Content 2"))
    }
}
```

### 3. 创建 Hilt 模块

```kotlin
@Module
@InstallIn(SingletonComponent::class)
object NewsModule {

    @Provides
    @Singleton
    fun provideNewsApi(): NewsApi {
        return NewsApiImpl()
    }

    @Provides
    @Singleton
    fun provideNewsRepository(newsApi: NewsApi): NewsRepository {
        return NewsRepository(newsApi)
    }
}
```

### 4. 在 ViewModel 中使用依赖

```kotlin
@HiltViewModel
class NewsViewModel @Inject constructor(
    private val newsRepository: NewsRepository
) : ViewModel() {

    val news = newsRepository.getNews()
}
```

### 5. 在 Activity 中使用 ViewModel

```kotlin
@AndroidEntryPoint
class NewsActivity : AppCompatActivity() {

    private val newsViewModel: NewsViewModel by viewModels()

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_news)

        val news = newsViewModel.news
        // 显示新闻数据
    }
}
```

## 总结

Android Hilt 是一个强大的依赖注入库，它简化了 Android 应用中的依赖管理。通过 Hilt，开发者可以更轻松地管理复杂的依赖关系，减少样板代码，并提高代码的可测试性和可维护性。

## 附加资源

- [Hilt 官方文档](https://dagger.dev/hilt/)
- [Android 开发者指南：依赖注入](https://developer.android.com/training/dependency-injection)
- [Dagger 2 与 Hilt 的比较](https://proandroiddev.com/dagger-2-vs-hilt-a-comparison-6b5d7a8b0b1b)

## 练习

1. 创建一个简单的 Android 应用，使用 Hilt 注入一个 `UserService`，并在 Activity 中显示用户信息。
2. 尝试在 ViewModel 中使用 Hilt 注入一个 `DataRepository`，并在 UI 中显示数据。

通过以上练习，你将更好地理解 Hilt 的工作原理，并能够在实际项目中应用它。