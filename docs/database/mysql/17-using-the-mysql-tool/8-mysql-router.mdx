---
title: MySQL Router
description: 了解 MySQL Router 的基本概念、功能及其在实际应用中的使用方法，适合初学者入门。
---

## 什么是 MySQL Router？

MySQL Router 是 MySQL 官方提供的一个轻量级中间件，用于将客户端应用程序与 MySQL 服务器集群连接起来。它的主要功能是将客户端的请求路由到正确的 MySQL 服务器实例，从而实现负载均衡和高可用性。

MySQL Router 通常与 MySQL InnoDB Cluster 或 MySQL Replication 一起使用，帮助应用程序透明地处理数据库的读写分离、故障转移等操作。

:::note
MySQL Router 是一个独立的应用程序，不需要与 MySQL 服务器安装在同一台机器上。
:::

## MySQL Router 的核心功能

1. **路由请求**：根据配置的路由策略，将客户端请求分发到合适的 MySQL 服务器。
2. **高可用性**：自动检测 MySQL 服务器的状态，并在主节点故障时切换到备用节点。
3. **负载均衡**：通过轮询或其他策略，将请求均匀分配到多个 MySQL 服务器。
4. **读写分离**：将写请求路由到主节点，读请求路由到从节点。

## 安装 MySQL Router

在开始使用 MySQL Router 之前，需要先安装它。以下是安装步骤：

1. **下载 MySQL Router**：
   访问 [MySQL 官方网站](https://dev.mysql.com/downloads/router/) 下载适合您操作系统的安装包。

2. **安装 MySQL Router**：
   根据您的操作系统，使用以下命令安装：

   - **Ubuntu/Debian**：
     ```bash
     sudo dpkg -i mysql-router-<version>.deb
     ```
   - **CentOS/RHEL**：
     ```bash
     sudo rpm -ivh mysql-router-<version>.rpm
     ```

3. **验证安装**：
   安装完成后，可以通过以下命令验证是否安装成功：
   ```bash
   mysqlrouter --version
   ```

## 配置 MySQL Router

MySQL Router 的配置文件通常位于 `/etc/mysqlrouter/mysqlrouter.conf`。以下是一个简单的配置示例：

```ini
[DEFAULT]
logging_folder = /var/log/mysqlrouter
plugin_folder = /usr/lib/mysqlrouter

[routing:primary]
bind_address = 0.0.0.0
bind_port = 6446
destinations = 192.168.1.101:3306,192.168.1.102:3306
routing_strategy = round-robin

[routing:secondary]
bind_address = 0.0.0.0
bind_port = 6447
destinations = 192.168.1.103:3306,192.168.1.104:3306
routing_strategy = first-available
```

:::tip
`routing_strategy` 可以设置为 `round-robin`（轮询）或 `first-available`（优先可用）。
:::

## 启动 MySQL Router

配置完成后，可以通过以下命令启动 MySQL Router：

```bash
mysqlrouter --config=/etc/mysqlrouter/mysqlrouter.conf &
```

启动后，MySQL Router 会监听配置文件中指定的端口（如 `6446` 和 `6447`），并将客户端请求路由到相应的 MySQL 服务器。

## 实际应用场景

假设我们有一个 MySQL InnoDB Cluster，包含一个主节点和两个从节点。我们希望应用程序能够自动处理读写分离和故障转移。

1. **配置 MySQL Router**：
   在 MySQL Router 的配置文件中，将主节点配置为写请求的目标，从节点配置为读请求的目标。

2. **应用程序连接**：
   应用程序连接到 MySQL Router 的端口（如 `6446` 和 `6447`），而不是直接连接到 MySQL 服务器。

3. **故障转移**：
   如果主节点发生故障，MySQL Router 会自动将写请求路由到新的主节点，而应用程序无需修改任何代码。

## 总结

MySQL Router 是一个强大的工具，能够帮助应用程序轻松实现 MySQL 集群的负载均衡和高可用性。通过合理的配置，您可以显著提高数据库的性能和可靠性。

:::caution
在使用 MySQL Router 时，请确保您的 MySQL 集群已经正确配置，并且所有节点之间的网络连接稳定。
:::

## 附加资源

- [MySQL Router 官方文档](https://dev.mysql.com/doc/mysql-router/en/)
- [MySQL InnoDB Cluster 指南](https://dev.mysql.com/doc/refman/8.0/en/mysql-innodb-cluster.html)

## 练习

1. 在本地环境中安装并配置 MySQL Router，尝试将读写请求路由到不同的 MySQL 服务器。
2. 模拟主节点故障，观察 MySQL Router 如何自动切换到备用节点。