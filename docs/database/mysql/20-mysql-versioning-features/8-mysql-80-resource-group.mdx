---
title: MySQL 8.0 资源组
description: 了解 MySQL 8.0 中的资源组功能，掌握如何通过资源组管理 CPU 资源分配，优化数据库性能。
---

## 介绍

MySQL 8.0 引入了资源组（Resource Groups）功能，允许数据库管理员将系统资源（如 CPU）分配给特定的线程或查询。通过资源组，可以更好地控制数据库工作负载的优先级和资源分配，从而优化数据库性能。

资源组的主要用途包括：
- 为高优先级查询分配更多 CPU 资源。
- 限制低优先级查询的 CPU 使用率。
- 在多租户环境中隔离不同租户的资源使用。

## 资源组的基本概念

在 MySQL 8.0 中，资源组是一个逻辑实体，用于管理 CPU 资源的分配。每个资源组可以绑定到一个或多个线程，并指定其 CPU 亲和性（即使用哪些 CPU 核心）和优先级。

### 资源组的属性

每个资源组有以下属性：
- **名称**：资源组的唯一标识符。
- **类型**：资源组的类型，可以是 `SYSTEM` 或 `USER`。`SYSTEM` 类型用于系统线程，`USER` 类型用于用户线程。
- **CPU 亲和性**：指定资源组可以使用的 CPU 核心。
- **优先级**：资源组的优先级，范围从 -20（最高优先级）到 19（最低优先级）。

## 创建和管理资源组

### 创建资源组

可以使用 `CREATE RESOURCE GROUP` 语句创建资源组。以下是一个创建资源组的示例：

```sql
CREATE RESOURCE GROUP high_priority
    TYPE = USER
    VCPU = 0-1
    THREAD_PRIORITY = 5;
```

在这个示例中，我们创建了一个名为 `high_priority` 的资源组，类型为 `USER`，绑定到 CPU 核心 0 和 1，优先级为 5。

### 修改资源组

可以使用 `ALTER RESOURCE GROUP` 语句修改资源组的属性。例如，修改资源组的 CPU 亲和性和优先级：

```sql
ALTER RESOURCE GROUP high_priority
    VCPU = 2-3
    THREAD_PRIORITY = 10;
```

### 删除资源组

可以使用 `DROP RESOURCE GROUP` 语句删除资源组：

```sql
DROP RESOURCE GROUP high_priority;
```

## 将线程绑定到资源组

创建资源组后，可以将线程绑定到资源组。可以使用 `SET RESOURCE GROUP` 语句将当前线程绑定到指定的资源组：

```sql
SET RESOURCE GROUP high_priority;
```

也可以在执行查询时指定资源组：

```sql
SELECT /*+ RESOURCE_GROUP(high_priority) */ * FROM large_table;
```

## 实际应用场景

### 场景 1：优化高优先级查询

假设我们有一个数据库，其中某些查询需要快速响应（如实时分析查询），而其他查询可以容忍较长的执行时间（如批量数据处理）。我们可以为高优先级查询创建一个资源组，并为其分配更多的 CPU 资源。

```sql
CREATE RESOURCE GROUP real_time
    TYPE = USER
    VCPU = 0-3
    THREAD_PRIORITY = 0;

CREATE RESOURCE GROUP batch_processing
    TYPE = USER
    VCPU = 4-7
    THREAD_PRIORITY = 10;
```

在执行高优先级查询时，我们可以将其绑定到 `real_time` 资源组：

```sql
SELECT /*+ RESOURCE_GROUP(real_time) */ * FROM real_time_table;
```

### 场景 2：多租户环境中的资源隔离

在多租户环境中，不同租户的查询可能需要隔离资源使用。我们可以为每个租户创建独立的资源组，并限制其 CPU 使用率。

```sql
CREATE RESOURCE GROUP tenant1
    TYPE = USER
    VCPU = 0-1
    THREAD_PRIORITY = 5;

CREATE RESOURCE GROUP tenant2
    TYPE = USER
    VCPU = 2-3
    THREAD_PRIORITY = 5;
```

在执行租户的查询时，可以将其绑定到相应的资源组：

```sql
SELECT /*+ RESOURCE_GROUP(tenant1) */ * FROM tenant1_table;
SELECT /*+ RESOURCE_GROUP(tenant2) */ * FROM tenant2_table;
```

## 总结

MySQL 8.0 的资源组功能为数据库管理员提供了更细粒度的 CPU 资源管理能力。通过合理配置资源组，可以优化数据库性能，确保高优先级查询获得足够的资源，同时限制低优先级查询的资源使用。

## 附加资源

- [MySQL 8.0 官方文档 - 资源组](https://dev.mysql.com/doc/refman/8.0/en/resource-groups.html)
- [MySQL 性能优化指南](https://dev.mysql.com/doc/refman/8.0/en/optimization.html)

## 练习

1. 创建一个名为 `low_priority` 的资源组，绑定到 CPU 核心 4-7，优先级为 15。
2. 将当前线程绑定到 `low_priority` 资源组，并执行一个查询。
3. 修改 `low_priority` 资源组的 CPU 亲和性为 2-3，优先级为 10。