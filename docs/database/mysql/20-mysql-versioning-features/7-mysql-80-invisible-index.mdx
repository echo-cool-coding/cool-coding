---
title: MySQL 8.0 不可见索引
description: 了解 MySQL 8.0 中的不可见索引功能，掌握如何在不删除索引的情况下暂时禁用索引，以及如何在实际场景中使用它。
---

# MySQL 8.0 不可见索引

MySQL 8.0 引入了**不可见索引（Invisible Indexes）**功能，这是一个非常有用的特性，允许数据库管理员在不删除索引的情况下，暂时禁用索引。这对于测试索引的性能影响或调试查询性能问题非常有帮助。

## 什么是不可见索引？

不可见索引是一种特殊的索引，它对查询优化器不可见。这意味着，即使索引存在于表中，查询优化器也不会使用它来优化查询。然而，索引仍然会随着数据的更新而维护，只是不会被查询优化器使用。

:::note
不可见索引的主要用途是：
- 测试索引对查询性能的影响。
- 在不删除索引的情况下，暂时禁用索引。
:::

## 如何创建不可见索引？

在 MySQL 8.0 中，可以在创建索引时将其标记为不可见。以下是一个示例：

```sql
CREATE TABLE employees (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    department_id INT,
    INDEX idx_department (department_id) INVISIBLE
);
```

在这个示例中，我们创建了一个名为 `idx_department` 的索引，并将其标记为不可见。

## 如何将现有索引设置为不可见？

如果你已经有一个索引，并且希望将其设置为不可见，可以使用 `ALTER TABLE` 语句：

```sql
ALTER TABLE employees ALTER INDEX idx_department INVISIBLE;
```

## 如何将不可见索引重新设置为可见？

如果你决定重新启用不可见索引，可以将其重新设置为可见：

```sql
ALTER TABLE employees ALTER INDEX idx_department VISIBLE;
```

## 不可见索引的实际应用场景

### 场景 1：测试索引对查询性能的影响

假设你有一个大型表，并且你怀疑某个索引可能对查询性能有负面影响。你可以将该索引设置为不可见，然后运行查询，观察性能变化。

```sql
-- 将索引设置为不可见
ALTER TABLE employees ALTER INDEX idx_department INVISIBLE;

-- 运行查询
EXPLAIN SELECT * FROM employees WHERE department_id = 5;

-- 将索引重新设置为可见
ALTER TABLE employees ALTER INDEX idx_department VISIBLE;
```

通过这种方式，你可以轻松地测试索引对查询性能的影响，而无需删除和重新创建索引。

### 场景 2：临时禁用索引

在某些情况下，你可能希望暂时禁用索引，例如在进行批量数据导入时。禁用索引可以提高导入速度，因为数据库不需要在每次插入时更新索引。

```sql
-- 将索引设置为不可见
ALTER TABLE employees ALTER INDEX idx_department INVISIBLE;

-- 执行批量数据导入
LOAD DATA INFILE 'data.csv' INTO TABLE employees;

-- 将索引重新设置为可见
ALTER TABLE employees ALTER INDEX idx_department VISIBLE;
```

## 总结

MySQL 8.0 的不可见索引功能为数据库管理员提供了更多的灵活性，允许他们在不删除索引的情况下，暂时禁用索引。这对于测试索引性能、调试查询问题以及优化批量数据导入等场景非常有用。

:::tip
**提示**：在使用不可见索引时，请确保在测试完成后将索引重新设置为可见，以避免影响查询性能。
:::

## 附加资源

- [MySQL 8.0 官方文档 - 不可见索引](https://dev.mysql.com/doc/refman/8.0/en/invisible-indexes.html)
- [MySQL 索引优化指南](https://dev.mysql.com/doc/refman/8.0/en/optimization-indexes.html)

## 练习

1. 创建一个包含不可见索引的表，并尝试运行查询，观察查询优化器是否使用了该索引。
2. 将一个现有索引设置为不可见，并测试其对查询性能的影响。
3. 在批量数据导入的场景中，尝试使用不可见索引来提高导入速度。

通过这些练习，你将更好地理解不可见索引的功能及其在实际应用中的价值。