---
title: MySQL 创建触发器
description: 学习如何在MySQL中创建触发器，了解触发器的基本概念、语法及其实际应用场景。
---

# MySQL 创建触发器

## 介绍

触发器（Trigger）是MySQL中的一种特殊存储过程，它会在特定事件（如插入、更新或删除）发生时自动执行。触发器通常用于在数据库操作前后执行一些额外的逻辑，例如数据验证、日志记录或自动更新相关表。

触发器的主要特点包括：
- 与表相关联，绑定到特定的表。
- 在特定事件（INSERT、UPDATE、DELETE）发生时触发。
- 可以在事件之前（BEFORE）或之后（AFTER）执行。

## 触发器的基本语法

在MySQL中，创建触发器的基本语法如下：

```sql
CREATE TRIGGER trigger_name
trigger_time trigger_event
ON table_name FOR EACH ROW
BEGIN
    -- 触发器逻辑
END;
```

- `trigger_name`：触发器的名称，必须是唯一的。
- `trigger_time`：触发时间，可以是 `BEFORE` 或 `AFTER`。
- `trigger_event`：触发事件，可以是 `INSERT`、`UPDATE` 或 `DELETE`。
- `table_name`：触发器绑定的表名。
- `FOR EACH ROW`：表示触发器对每一行数据都会执行。

## 创建触发器的步骤

### 1. 确定触发器的目的
在创建触发器之前，首先需要明确触发器的目的。例如，你可能希望在插入新记录时自动更新某个字段，或者在删除记录时将数据备份到另一个表中。

### 2. 编写触发器逻辑
根据触发器的目的，编写相应的SQL逻辑。触发器逻辑可以包含任何有效的SQL语句，包括条件判断、循环、变量声明等。

### 3. 创建触发器
使用 `CREATE TRIGGER` 语句将触发器绑定到指定的表上。

### 4. 测试触发器
在创建触发器后，通过执行相应的操作（如插入、更新或删除）来测试触发器是否按预期工作。

## 实际案例

### 案例1：自动更新最后修改时间

假设我们有一个 `users` 表，其中包含 `last_modified` 字段。我们希望每次更新用户信息时，自动更新 `last_modified` 字段为当前时间。

```sql
CREATE TRIGGER update_last_modified
BEFORE UPDATE ON users FOR EACH ROW
BEGIN
    SET NEW.last_modified = NOW();
END;
```

**测试触发器：**

```sql
UPDATE users SET username = 'new_username' WHERE id = 1;
```

执行上述更新语句后，`last_modified` 字段将自动更新为当前时间。

### 案例2：记录删除操作

假设我们希望在删除 `orders` 表中的记录时，将删除的记录备份到 `deleted_orders` 表中。

```sql
CREATE TRIGGER log_deleted_order
AFTER DELETE ON orders FOR EACH ROW
BEGIN
    INSERT INTO deleted_orders (order_id, customer_id, order_date, deleted_at)
    VALUES (OLD.order_id, OLD.customer_id, OLD.order_date, NOW());
END;
```

**测试触发器：**

```sql
DELETE FROM orders WHERE order_id = 101;
```

执行上述删除语句后，被删除的订单记录将被插入到 `deleted_orders` 表中。

## 总结

触发器是MySQL中非常强大的工具，可以帮助我们在数据库操作前后自动执行一些逻辑。通过触发器，我们可以实现数据验证、日志记录、自动更新等功能，从而提高数据库的自动化程度和数据一致性。

在实际使用中，需要注意以下几点：
- 触发器可能会影响数据库性能，尤其是在处理大量数据时。
- 触发器的逻辑应尽量简洁，避免复杂的操作。
- 在创建触发器之前，务必进行充分的测试，以确保其按预期工作。

## 附加资源

- [MySQL官方文档 - 触发器](https://dev.mysql.com/doc/refman/8.0/en/triggers.html)
- [MySQL触发器实战教程](https://www.mysqltutorial.org/mysql-triggers/)

## 练习

1. 创建一个触发器，在插入新订单时自动更新 `customers` 表中的 `total_orders` 字段。
2. 创建一个触发器，在更新 `products` 表中的库存数量时，如果库存数量低于某个阈值，则发送通知。

通过完成这些练习，你将更好地理解触发器的使用场景和实现方法。