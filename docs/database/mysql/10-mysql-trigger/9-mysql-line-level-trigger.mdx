---
title: MySQL 行级触发器
description: 了解MySQL行级触发器的基本概念、语法及其在实际场景中的应用。本文适合初学者，包含代码示例和实际案例。
---

# MySQL 行级触发器

MySQL触发器是一种在数据库中自动执行的特殊存储过程，它会在特定事件（如插入、更新或删除）发生时触发。行级触发器是触发器的一种，它会在每一行数据受到影响时执行。本文将详细介绍MySQL行级触发器的概念、语法及其实际应用。

## 什么是行级触发器？

行级触发器是一种在数据库中针对每一行数据执行操作的触发器。与语句级触发器不同，行级触发器会在每一行数据受到影响时触发，而不是在整个SQL语句执行完毕后触发。这使得行级触发器在处理每一行数据时更加灵活和精确。

## 行级触发器的语法

在MySQL中，创建行级触发器的基本语法如下：

```sql
CREATE TRIGGER trigger_name
BEFORE|AFTER INSERT|UPDATE|DELETE
ON table_name FOR EACH ROW
BEGIN
    -- 触发器逻辑
END;
```

- `trigger_name`：触发器的名称。
- `BEFORE|AFTER`：指定触发器在事件之前或之后执行。
- `INSERT|UPDATE|DELETE`：指定触发器在插入、更新或删除操作时触发。
- `table_name`：触发器所属的表名。
- `FOR EACH ROW`：指定触发器为行级触发器。
- `BEGIN...END`：触发器的主体，包含触发器的逻辑。

## 行级触发器的实际应用

### 示例1：自动更新库存

假设我们有一个商品表 `products` 和一个库存表 `inventory`。每当有新的商品插入到 `products` 表中时，我们希望自动在 `inventory` 表中插入一条库存记录。

```sql
CREATE TRIGGER update_inventory
AFTER INSERT ON products
FOR EACH ROW
BEGIN
    INSERT INTO inventory (product_id, quantity)
    VALUES (NEW.id, 0);
END;
```

在这个例子中，`NEW.id` 表示新插入的商品的ID。触发器会在每次插入新商品时自动执行，将新商品的ID和初始库存量（0）插入到 `inventory` 表中。

### 示例2：记录数据变更

假设我们有一个员工表 `employees`，我们希望在每次更新员工工资时，记录下工资的变更历史。

```sql
CREATE TABLE salary_history (
    id INT AUTO_INCREMENT PRIMARY KEY,
    employee_id INT,
    old_salary DECIMAL(10, 2),
    new_salary DECIMAL(10, 2),
    change_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TRIGGER log_salary_change
AFTER UPDATE ON employees
FOR EACH ROW
BEGIN
    IF OLD.salary != NEW.salary THEN
        INSERT INTO salary_history (employee_id, old_salary, new_salary)
        VALUES (OLD.id, OLD.salary, NEW.salary);
    END IF;
END;
```

在这个例子中，`OLD.salary` 表示更新前的工资，`NEW.salary` 表示更新后的工资。触发器会在每次更新员工工资时检查工资是否发生变化，如果发生变化，则将变更记录插入到 `salary_history` 表中。

## 行级触发器的注意事项

1. **性能影响**：行级触发器会在每一行数据受到影响时触发，因此在处理大量数据时可能会影响性能。
2. **触发器嵌套**：MySQL允许触发器嵌套，即一个触发器可以触发另一个触发器。但需要注意避免无限循环的情况。
3. **事务管理**：触发器中的操作是事务的一部分，如果触发器中的操作失败，整个事务将回滚。

## 总结

MySQL行级触发器是一种强大的工具，可以在数据库操作中自动执行复杂的逻辑。通过本文的介绍，你应该已经了解了行级触发器的基本概念、语法及其在实际场景中的应用。希望这些知识能帮助你在实际项目中更好地使用MySQL触发器。

## 附加资源

- [MySQL官方文档 - 触发器](https://dev.mysql.com/doc/refman/8.0/en/triggers.html)
- [MySQL触发器实战](https://www.mysqltutorial.org/mysql-triggers/)

## 练习

1. 创建一个触发器，在删除 `orders` 表中的订单时，自动将订单的状态更新为“已取消”。
2. 创建一个触发器，在插入新员工时，自动将员工的入职日期设置为当前日期。

通过完成这些练习，你将更深入地理解MySQL行级触发器的使用。