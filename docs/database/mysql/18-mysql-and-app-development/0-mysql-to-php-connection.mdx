---
title: MySQL 与PHP连接
description: "学习如何使用PHP连接MySQL数据库，并执行基本的数据库操作。本文适合初学者，包含代码示例和实际应用场景。"
---

# MySQL 与PHP连接

在现代Web开发中，数据库是不可或缺的一部分。MySQL是最流行的关系型数据库之一，而PHP是一种广泛用于Web开发的服务器端脚本语言。将PHP与MySQL结合使用，可以创建动态、数据驱动的Web应用程序。本文将详细介绍如何使用PHP连接MySQL数据库，并执行基本的数据库操作。

## 1. 介绍

在Web应用程序中，PHP通常用于处理服务器端的逻辑，而MySQL用于存储和管理数据。为了在PHP中访问和操作MySQL数据库，我们需要建立一个连接。这个连接允许PHP脚本与MySQL数据库进行通信，执行查询、插入、更新和删除等操作。

## 2. 连接MySQL数据库

要连接MySQL数据库，我们需要使用PHP的`mysqli`扩展。`mysqli`是MySQL Improved的缩写，它提供了面向对象和面向过程两种方式来操作MySQL数据库。

### 2.1 使用面向过程的方式连接MySQL

以下是使用面向过程的方式连接MySQL数据库的示例代码：

```php
<?php
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "myDB";

// 创建连接
$conn = mysqli_connect($servername, $username, $password, $dbname);

// 检查连接是否成功
if (!$conn) {
    die("连接失败: " . mysqli_connect_error());
}
echo "连接成功";
?>
```

**解释：**
- `$servername`：MySQL服务器的主机名，通常是`localhost`。
- `$username`：MySQL用户名，通常是`root`。
- `$password`：MySQL用户的密码。
- `$dbname`：要连接的数据库名称。
- `mysqli_connect()`：用于创建与MySQL数据库的连接。
- `mysqli_connect_error()`：返回连接错误的描述。

### 2.2 使用面向对象的方式连接MySQL

以下是使用面向对象的方式连接MySQL数据库的示例代码：

```php
<?php
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "myDB";

// 创建连接
$conn = new mysqli($servername, $username, $password, $dbname);

// 检查连接是否成功
if ($conn->connect_error) {
    die("连接失败: " . $conn->connect_error);
}
echo "连接成功";
?>
```

**解释：**
- `new mysqli()`：创建一个新的`mysqli`对象，用于连接MySQL数据库。
- `$conn->connect_error`：检查连接是否成功，如果失败则输出错误信息。

:::tip
建议使用面向对象的方式，因为它更符合现代PHP编程风格，并且提供了更多的功能和灵活性。
:::

## 3. 执行SQL查询

一旦成功连接到MySQL数据库，我们就可以执行SQL查询了。以下是一些常见的SQL操作示例。

### 3.1 查询数据

以下是一个从数据库中查询数据的示例：

```php
<?php
$sql = "SELECT id, firstname, lastname FROM MyGuests";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    // 输出每行数据
    while($row = $result->fetch_assoc()) {
        echo "id: " . $row["id"]. " - Name: " . $row["firstname"]. " " . $row["lastname"]. "<br />";
    }
} else {
    echo "0 结果";
}
?>
```

**解释：**
- `$sql`：SQL查询语句。
- `$result`：执行查询后返回的结果集。
- `$result->num_rows`：返回结果集中的行数。
- `$result->fetch_assoc()`：以关联数组的形式获取结果集中的每一行。

### 3.2 插入数据

以下是一个向数据库中插入数据的示例：

```php
<?php
$sql = "INSERT INTO MyGuests (firstname, lastname, email)
VALUES ('John', 'Doe', 'john@example.com')";

if ($conn->query($sql) === TRUE) {
    echo "新记录插入成功";
} else {
    echo "Error: " . $sql . "<br />" . $conn->error;
}
?>
```

**解释：**
- `$sql`：插入数据的SQL语句。
- `$conn->query($sql)`：执行SQL语句。
- `$conn->error`：返回错误信息。

### 3.3 更新数据

以下是一个更新数据库中数据的示例：

```php
<?php
$sql = "UPDATE MyGuests SET lastname='Doe' WHERE id=2";

if ($conn->query($sql) === TRUE) {
    echo "记录更新成功";
} else {
    echo "Error updating record: " . $conn->error;
}
?>
```

**解释：**
- `$sql`：更新数据的SQL语句。
- `$conn->query($sql)`：执行SQL语句。

### 3.4 删除数据

以下是一个从数据库中删除数据的示例：

```php
<?php
$sql = "DELETE FROM MyGuests WHERE id=3";

if ($conn->query($sql) === TRUE) {
    echo "记录删除成功";
} else {
    echo "Error deleting record: " . $conn->error;
}
?>
```

**解释：**
- `$sql`：删除数据的SQL语句。
- `$conn->query($sql)`：执行SQL语句。

## 4. 实际应用场景

假设我们正在开发一个简单的博客系统，用户可以在其中发布文章。我们需要将文章存储在MySQL数据库中，并在用户访问博客时从数据库中检索文章。

### 4.1 创建数据库表

首先，我们需要创建一个名为`posts`的表来存储文章：

```sql
CREATE TABLE posts (
    id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    author VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 4.2 插入文章

以下是一个插入新文章的PHP脚本：

```php
<?php
$title = "我的第一篇博客文章";
$content = "这是文章的内容。";
$author = "John Doe";

$sql = "INSERT INTO posts (title, content, author)
VALUES ('$title', '$content', '$author')";

if ($conn->query($sql) === TRUE) {
    echo "新文章发布成功";
} else {
    echo "Error: " . $sql . "<br />" . $conn->error;
}
?>
```

### 4.3 显示文章

以下是一个从数据库中检索并显示文章的PHP脚本：

```php
<?php
$sql = "SELECT id, title, content, author, created_at FROM posts";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    while($row = $result->fetch_assoc()) {
        echo "<h2>" . $row["title"]. "</h2>";
        echo "<p>" . $row["content"]. "</p>";
        echo "<p>作者: " . $row["author"]. "</p>";
        echo "<p>发布时间: " . $row["created_at"]. "</p>";
        echo "<hr />";
    }
} else {
    echo "暂无文章";
}
?>
```

## 5. 总结

通过本文，我们学习了如何使用PHP连接MySQL数据库，并执行基本的数据库操作。我们了解了如何查询、插入、更新和删除数据，并通过一个简单的博客系统展示了这些操作的实际应用场景。

:::note
在实际开发中，建议使用预处理语句（Prepared Statements）来防止SQL注入攻击，并提高代码的安全性。
:::

## 6. 附加资源与练习

- **练习1**：尝试创建一个用户注册系统，将用户信息存储在MySQL数据库中。
- **练习2**：修改博客系统，使其支持文章的编辑和删除功能。
- **附加资源**：
  - [PHP官方文档](https://www.php.net/manual/en/)
  - [MySQL官方文档](https://dev.mysql.com/doc/)

通过不断练习和探索，你将能够更熟练地使用PHP与MySQL进行开发。