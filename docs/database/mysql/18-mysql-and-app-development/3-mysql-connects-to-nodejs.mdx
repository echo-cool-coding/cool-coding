---
title: MySQL 与Node.js连接
description: "学习如何使用Node.js连接MySQL数据库，并通过实际案例掌握基本操作。"
---

# MySQL 与Node.js连接

在现代Web开发中，数据库是不可或缺的一部分。MySQL是一个流行的关系型数据库管理系统，而Node.js是一个强大的JavaScript运行时环境。将两者结合，可以构建高效的后端服务。本文将详细介绍如何使用Node.js连接MySQL数据库，并通过实际案例展示其应用。

## 1. 介绍

Node.js与MySQL的连接是通过MySQL客户端库实现的。这些库允许Node.js应用程序与MySQL数据库进行交互，执行查询、插入、更新和删除操作。我们将使用`mysql2`库，它是Node.js中最常用的MySQL客户端库之一。

## 2. 安装MySQL客户端库

首先，我们需要在Node.js项目中安装`mysql2`库。打开终端并运行以下命令：

```bash
npm install mysql2
```

## 3. 连接到MySQL数据库

安装完成后，我们可以开始编写代码来连接MySQL数据库。以下是一个简单的示例：

```javascript
const mysql = require('mysql2');

// 创建连接
const connection = mysql.createConnection({
  host: 'localhost',
  user: 'root',
  password: 'yourpassword',
  database: 'testdb'
});

// 连接到数据库
connection.connect((err) => {
  if (err) {
    console.error('Error connecting to MySQL:', err);
    return;
  }
  console.log('Connected to MySQL database!');
});

// 关闭连接
connection.end();
```

### 代码解释

- `mysql.createConnection()`：创建一个新的MySQL连接对象。
- `connection.connect()`：尝试连接到MySQL数据库。
- `connection.end()`：关闭数据库连接。

:::note
确保将`host`、`user`、`password`和`database`替换为你的实际数据库信息。
:::

## 4. 执行SQL查询

连接成功后，我们可以执行SQL查询。以下是一个查询示例：

```javascript
connection.query('SELECT * FROM users', (err, results, fields) => {
  if (err) {
    console.error('Error executing query:', err);
    return;
  }
  console.log('Query results:', results);
});
```

### 代码解释

- `connection.query()`：执行SQL查询。
- `results`：查询结果。
- `fields`：查询返回的字段信息。

## 5. 插入数据

除了查询，我们还可以插入数据到数据库中。以下是一个插入数据的示例：

```javascript
const user = { name: 'John Doe', email: 'john@example.com' };
connection.query('INSERT INTO users SET ?', user, (err, results) => {
  if (err) {
    console.error('Error inserting data:', err);
    return;
  }
  console.log('Inserted data with ID:', results.insertId);
});
```

### 代码解释

- `INSERT INTO users SET ?`：插入数据到`users`表中。
- `user`：要插入的数据对象。
- `results.insertId`：插入数据的ID。

## 6. 更新和删除数据

更新和删除数据的操作与插入类似。以下是一个更新数据的示例：

```javascript
connection.query('UPDATE users SET email = ? WHERE id = ?', ['john.doe@example.com', 1], (err, results) => {
  if (err) {
    console.error('Error updating data:', err);
    return;
  }
  console.log('Updated rows:', results.affectedRows);
});
```

删除数据的示例：

```javascript
connection.query('DELETE FROM users WHERE id = ?', [1], (err, results) => {
  if (err) {
    console.error('Error deleting data:', err);
    return;
  }
  console.log('Deleted rows:', results.affectedRows);
});
```

## 7. 实际案例：用户管理系统

假设我们要构建一个简单的用户管理系统，允许用户注册、登录和查看个人信息。以下是一个简化的实现：

```javascript
const express = require('express');
const mysql = require('mysql2');
const app = express();

// 创建连接
const connection = mysql.createConnection({
  host: 'localhost',
  user: 'root',
  password: 'yourpassword',
  database: 'testdb'
});

// 用户注册
app.post('/register', (req, res) => {
  const user = { name: req.body.name, email: req.body.email, password: req.body.password };
  connection.query('INSERT INTO users SET ?', user, (err, results) => {
    if (err) {
      res.status(500).send('Error registering user');
      return;
    }
    res.send('User registered successfully');
  });
});

// 用户登录
app.post('/login', (req, res) => {
  const { email, password } = req.body;
  connection.query('SELECT * FROM users WHERE email = ? AND password = ?', [email, password], (err, results) => {
    if (err) {
      res.status(500).send('Error logging in');
      return;
    }
    if (results.length > 0) {
      res.send('Login successful');
    } else {
      res.status(401).send('Invalid credentials');
    }
  });
});

// 启动服务器
app.listen(3000, () => {
  console.log('Server is running on port 3000');
});
```

### 代码解释

- `express`：用于创建Web服务器的框架。
- `app.post()`：处理POST请求。
- `connection.query()`：执行数据库操作。

## 8. 总结

通过本文，我们学习了如何使用Node.js连接MySQL数据库，并执行基本的CRUD操作。我们还通过一个实际案例展示了如何构建一个简单的用户管理系统。希望这些内容能帮助你更好地理解MySQL与Node.js的结合使用。

## 9. 附加资源与练习

- **练习**：尝试扩展用户管理系统，添加更多功能，如用户信息更新和删除。
- **资源**：
  - [MySQL官方文档](https://dev.mysql.com/doc/)
  - [Node.js官方文档](https://nodejs.org/en/docs/)
  - [mysql2库文档](https://github.com/sidorares/node-mysql2)

继续探索和实践，你将能够构建更复杂的应用程序！