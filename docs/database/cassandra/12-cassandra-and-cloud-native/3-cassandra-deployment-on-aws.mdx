---
title: Cassandra 在AWS上的部署
description: "了解如何在AWS上部署Apache Cassandra，并探索其在云原生环境中的实际应用。"
---

## 介绍

Apache Cassandra 是一个高度可扩展的分布式 NoSQL 数据库，专为处理大规模数据而设计。它以其高可用性、无单点故障和线性扩展能力而闻名。在云原生环境中，Cassandra 可以轻松部署在 AWS 等云平台上，以充分利用云计算的弹性和灵活性。

本文将逐步指导您如何在 AWS 上部署 Cassandra，并探讨其在实际应用中的使用场景。

## 准备工作

在开始部署之前，您需要完成以下准备工作：

1. **AWS 账户**：确保您拥有一个 AWS 账户，并具备创建 EC2 实例和配置安全组的权限。
2. **SSH 密钥对**：在 AWS 控制台中创建一个 SSH 密钥对，以便后续通过 SSH 连接到 EC2 实例。
3. **Cassandra 安装包**：下载 Cassandra 的最新版本，或使用包管理器（如 `apt` 或 `yum`）进行安装。

## 部署步骤

### 1. 创建 EC2 实例

首先，我们需要在 AWS 上创建 EC2 实例来运行 Cassandra。以下是创建 EC2 实例的步骤：

1. 登录 AWS 控制台，导航到 EC2 服务。
2. 点击“启动实例”按钮，选择一个适合的 Amazon Machine Image (AMI)，例如 Amazon Linux 2。
3. 选择实例类型，建议使用 `t2.medium` 或更高配置的实例类型。
4. 配置实例详细信息，确保选择正确的 VPC 和子网。
5. 在“配置安全组”步骤中，添加以下规则以允许 Cassandra 的通信：
   - 类型：`Custom TCP`，端口范围：`9042`，源：`0.0.0.0/0`（仅用于测试，生产环境应限制访问）
   - 类型：`SSH`，端口范围：`22`，源：`您的IP地址`
6. 选择之前创建的 SSH 密钥对，并启动实例。

### 2. 安装 Cassandra

在 EC2 实例启动后，通过 SSH 连接到实例并安装 Cassandra：

```bash
ssh -i your-key.pem ec2-user@your-instance-ip
```

更新系统并安装 Java（Cassandra 需要 Java 运行环境）：

```bash
sudo yum update -y
sudo yum install java-1.8.0-openjdk -y
```

下载并安装 Cassandra：

```bash
wget https://downloads.apache.org/cassandra/4.0.7/apache-cassandra-4.0.7-bin.tar.gz
tar -xvzf apache-cassandra-4.0.7-bin.tar.gz
sudo mv apache-cassandra-4.0.7 /opt/cassandra
```

### 3. 配置 Cassandra

编辑 Cassandra 的配置文件 `/opt/cassandra/conf/cassandra.yaml`，确保以下配置项正确：

```yaml
cluster_name: 'MyCassandraCluster'
listen_address: 'your-instance-private-ip'
rpc_address: 'your-instance-private-ip'
seed_provider:
  - class_name: org.apache.cassandra.locator.SimpleSeedProvider
    parameters:
      - seeds: "your-instance-private-ip"
```

### 4. 启动 Cassandra

启动 Cassandra 服务：

```bash
/opt/cassandra/bin/cassandra -f
```

:::note
`-f` 参数表示在前台运行 Cassandra，方便查看日志。在生产环境中，建议使用 `-R` 参数在后台运行。
:::

### 5. 验证部署

使用 `cqlsh` 连接到 Cassandra 并验证部署是否成功：

```bash
/opt/cassandra/bin/cqlsh your-instance-private-ip
```

如果连接成功，您将看到类似以下的输出：

```plaintext
Connected to MyCassandraCluster at your-instance-private-ip:9042.
[cqlsh 5.0.1 | Cassandra 4.0.7 | CQL spec 3.4.5 | Native protocol v4]
Use HELP for help.
cqlsh>
```

## 实际应用场景

Cassandra 在 AWS 上的部署适用于多种场景，例如：

1. **大规模数据存储**：Cassandra 可以轻松处理 PB 级别的数据，适合需要存储大量数据的应用。
2. **高可用性应用**：Cassandra 的无单点故障设计使其成为高可用性应用的理想选择。
3. **实时数据分析**：Cassandra 支持快速写入和读取，适合实时数据分析场景。

## 总结

通过本文，您已经学会了如何在 AWS 上部署 Apache Cassandra。我们涵盖了从创建 EC2 实例到安装和配置 Cassandra 的完整过程，并探讨了其在实际应用中的使用场景。

## 附加资源

- [Apache Cassandra 官方文档](https://cassandra.apache.org/doc/latest/)
- [AWS EC2 用户指南](https://docs.aws.amazon.com/ec2/index.html)
- [Cassandra 在 Kubernetes 上的部署指南](https://cassandra.apache.org/doc/latest/cassandra/operating/kubernetes.html)

## 练习

1. 尝试在多个 EC2 实例上部署 Cassandra 集群，并配置跨节点的数据复制。
2. 使用 `nodetool` 工具监控 Cassandra 集群的状态。
3. 探索如何在 AWS 上使用自动扩展组（Auto Scaling Group）来动态调整 Cassandra 集群的规模。

希望本文对您的 Cassandra 学习之旅有所帮助！