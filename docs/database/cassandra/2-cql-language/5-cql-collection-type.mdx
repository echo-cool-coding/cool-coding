---
title: CQL集合类型
description: 了解CQL（Cassandra Query Language）中的集合类型，包括集合的定义、使用场景以及如何操作集合数据。
---

# CQL集合类型

在CQL（Cassandra Query Language）中，集合类型是一种强大的数据结构，允许你在单个列中存储多个值。集合类型特别适合存储具有相同数据类型的多个值，例如标签、电话号码或地址列表。CQL支持三种主要的集合类型：**列表（List）**、**集合（Set）** 和 **映射（Map）**。本文将详细介绍这些集合类型，并通过示例展示它们的实际应用。

## 1. 集合类型简介

集合类型是CQL中用于存储多个值的列类型。它们可以帮助你在单个列中存储多个相关值，而不需要创建额外的表或复杂的结构。以下是CQL支持的三种集合类型：

- **列表（List）**：有序的、可重复的值的集合。
- **集合（Set）**：无序的、不可重复的值的集合。
- **映射（Map）**：键值对的集合，其中键和值都是特定类型的。

:::note
集合类型在CQL中是强类型的，这意味着你必须在定义列时指定集合中元素的类型。例如，`List<text>`表示一个存储文本值的列表。
:::

## 2. 列表（List）

列表是一个有序的、可重复的值的集合。你可以使用列表来存储一组有序的值，例如用户的标签或历史记录。

### 2.1 定义列表

在创建表时，你可以定义一个列表列：

```sql
CREATE TABLE user_tags (
    user_id uuid PRIMARY KEY,
    tags list<text>
);
```

### 2.2 插入和查询列表数据

你可以使用`INSERT`语句向列表中添加数据：

```sql
INSERT INTO user_tags (user_id, tags) 
VALUES (uuid(), ['cassandra', 'database', 'nosql']);
```

查询列表数据时，CQL会返回整个列表：

```sql
SELECT tags FROM user_tags WHERE user_id = ?;
```

输出：

```
['cassandra', 'database', 'nosql']
```

### 2.3 更新列表

你可以使用`UPDATE`语句向列表中添加或删除元素：

```sql
UPDATE user_tags 
SET tags = tags + ['bigdata'] 
WHERE user_id = ?;
```

删除列表中的元素：

```sql
UPDATE user_tags 
SET tags = tags - ['nosql'] 
WHERE user_id = ?;
```

## 3. 集合（Set）

集合是一个无序的、不可重复的值的集合。集合适合存储唯一的值，例如用户的兴趣或标签。

### 3.1 定义集合

在创建表时，你可以定义一个集合列：

```sql
CREATE TABLE user_interests (
    user_id uuid PRIMARY KEY,
    interests set<text>
);
```

### 3.2 插入和查询集合数据

你可以使用`INSERT`语句向集合中添加数据：

```sql
INSERT INTO user_interests (user_id, interests) 
VALUES (uuid(), {'programming', 'databases', 'cloud'});
```

查询集合数据时，CQL会返回整个集合：

```sql
SELECT interests FROM user_interests WHERE user_id = ?;
```

输出：

```
{'programming', 'databases', 'cloud'}
```

### 3.3 更新集合

你可以使用`UPDATE`语句向集合中添加或删除元素：

```sql
UPDATE user_interests 
SET interests = interests + {'ai'} 
WHERE user_id = ?;
```

删除集合中的元素：

```sql
UPDATE user_interests 
SET interests = interests - {'cloud'} 
WHERE user_id = ?;
```

## 4. 映射（Map）

映射是一个键值对的集合，其中键和值都是特定类型的。映射适合存储键值对数据，例如用户的属性或配置。

### 4.1 定义映射

在创建表时，你可以定义一个映射列：

```sql
CREATE TABLE user_profiles (
    user_id uuid PRIMARY KEY,
    profile map<text, text>
);
```

### 4.2 插入和查询映射数据

你可以使用`INSERT`语句向映射中添加数据：

```sql
INSERT INTO user_profiles (user_id, profile) 
VALUES (uuid(), {'name': 'Alice', 'age': '30', 'city': 'New York'});
```

查询映射数据时，CQL会返回整个映射：

```sql
SELECT profile FROM user_profiles WHERE user_id = ?;
```

输出：

```
{'name': 'Alice', 'age': '30', 'city': 'New York'}
```

### 4.3 更新映射

你可以使用`UPDATE`语句向映射中添加或删除键值对：

```sql
UPDATE user_profiles 
SET profile['city'] = 'San Francisco' 
WHERE user_id = ?;
```

删除映射中的键值对：

```sql
UPDATE user_profiles 
SET profile = profile - {'age'} 
WHERE user_id = ?;
```

## 5. 实际应用场景

### 5.1 使用列表存储用户的历史记录

假设你正在开发一个电商网站，你可以使用列表来存储用户的浏览历史：

```sql
CREATE TABLE user_history (
    user_id uuid PRIMARY KEY,
    history list<text>
);
```

每次用户浏览一个商品时，你可以将商品ID添加到列表中：

```sql
UPDATE user_history 
SET history = history + ['product123'] 
WHERE user_id = ?;
```

### 5.2 使用集合存储用户的兴趣标签

在社交网络应用中，你可以使用集合来存储用户的兴趣标签，确保每个标签只出现一次：

```sql
CREATE TABLE user_interests (
    user_id uuid PRIMARY KEY,
    interests set<text>
);
```

当用户添加新的兴趣时，你可以将其添加到集合中：

```sql
UPDATE user_interests 
SET interests = interests + {'music'} 
WHERE user_id = ?;
```

### 5.3 使用映射存储用户的配置

在用户配置管理中，你可以使用映射来存储用户的个性化设置：

```sql
CREATE TABLE user_settings (
    user_id uuid PRIMARY KEY,
    settings map<text, text>
);
```

你可以轻松地更新用户的设置：

```sql
UPDATE user_settings 
SET settings['theme'] = 'dark' 
WHERE user_id = ?;
```

## 6. 总结

CQL中的集合类型（列表、集合和映射）为存储和操作多个值提供了强大的工具。通过使用这些集合类型，你可以简化数据结构，减少表的数量，并提高查询效率。无论是存储用户的历史记录、兴趣标签还是配置设置，集合类型都能帮助你轻松管理复杂的数据。

:::tip
在实际应用中，选择适当的集合类型非常重要。列表适合有序且可重复的数据，集合适合唯一值，而映射则适合键值对数据。
:::

## 7. 附加资源与练习

- **练习1**：创建一个表，使用列表存储用户的购物车商品，并尝试添加、删除和查询商品。
- **练习2**：使用集合存储用户的收藏夹，确保每个商品只出现一次。
- **练习3**：使用映射存储用户的个人资料，并尝试更新和删除键值对。

通过练习这些示例，你将更好地理解CQL集合类型的使用方法，并能够在实际项目中灵活应用它们。