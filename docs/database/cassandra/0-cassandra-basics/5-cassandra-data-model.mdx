---
title: Cassandra 数据模型
description: 了解 Cassandra 数据模型的基础知识，包括其核心概念、设计原则以及如何在实际场景中使用。
---

## 介绍

Cassandra 是一个高度可扩展的分布式 NoSQL 数据库，设计用于处理大量数据并确保高可用性。与传统的关系型数据库不同，Cassandra 采用了一种独特的数据模型，称为 **宽列存储模型**。这种模型结合了键值存储和表格存储的特点，使其非常适合处理大规模分布式数据。

在本节中，我们将深入探讨 Cassandra 数据模型的核心概念，并通过实际示例展示如何设计和使用它。

---

## Cassandra 数据模型的核心概念

### 1. Keyspace（键空间）

Keyspace 是 Cassandra 中数据的最外层容器，类似于关系型数据库中的数据库。它定义了数据的复制策略和配置。每个 Keyspace 包含多个表（Table）。

```sql
CREATE KEYSPACE my_keyspace
WITH replication = {'class': 'SimpleStrategy', 'replication_factor': 3};
```

### 2. Table（表）

表是 Cassandra 中存储数据的主要结构。每个表由行（Row）和列（Column）组成。与关系型数据库不同，Cassandra 的表是 **宽列存储**，这意味着每行可以有不同的列。

```sql
CREATE TABLE my_keyspace.users (
    user_id UUID PRIMARY KEY,
    name TEXT,
    email TEXT,
    age INT
);
```

### 3. Row（行）

每一行由一个 **主键（Primary Key）** 唯一标识。主键可以是一个简单的列，也可以是一个复合键（由多个列组成）。

### 4. Column（列）

列是 Cassandra 表中的基本数据单元。每个列由名称、值和时间戳组成。Cassandra 的列是动态的，这意味着每行可以有不同的列。

### 5. Partition Key（分区键）

分区键用于决定数据在集群中的分布。Cassandra 使用分区键的哈希值来确定数据存储在哪个节点上。

```sql
CREATE TABLE my_keyspace.orders (
    order_id UUID,
    user_id UUID,
    product TEXT,
    quantity INT,
    PRIMARY KEY ((user_id), order_id)
);
```

在上面的示例中，`user_id` 是分区键，而 `order_id` 是集群键（Clustering Key）。

### 6. Clustering Key（集群键）

集群键用于在分区内对数据进行排序。它决定了数据在分区内的存储顺序。

---

## Cassandra 数据模型的设计原则

### 1. 基于查询设计表

Cassandra 的数据模型设计应围绕查询需求进行。与关系型数据库不同，Cassandra 不支持复杂的 JOIN 操作，因此需要为每个查询设计专门的表。

:::tip
在设计表时，先明确查询需求，再根据查询需求设计表结构。
:::

### 2. 避免过度规范化

Cassandra 鼓励数据冗余，以避免复杂的 JOIN 操作。这意味着同一数据可能会存储在多个表中。

### 3. 使用宽行

Cassandra 的宽列存储模型允许每行包含大量列。这种设计非常适合存储时间序列数据或日志数据。

---

## 实际案例：用户订单系统

假设我们正在为一个电商平台设计一个用户订单系统。以下是 Cassandra 数据模型的设计示例：

### 表 1：用户信息表

```sql
CREATE TABLE my_keyspace.users (
    user_id UUID PRIMARY KEY,
    name TEXT,
    email TEXT,
    age INT
);
```

### 表 2：用户订单表

```sql
CREATE TABLE my_keyspace.user_orders (
    user_id UUID,
    order_id UUID,
    product TEXT,
    quantity INT,
    order_date TIMESTAMP,
    PRIMARY KEY ((user_id), order_id)
);
```

### 表 3：产品订单表

```sql
CREATE TABLE my_keyspace.product_orders (
    product TEXT,
    order_id UUID,
    user_id UUID,
    quantity INT,
    order_date TIMESTAMP,
    PRIMARY KEY ((product), order_id)
);
```

### 查询示例

1. 查询某个用户的所有订单：

```sql
SELECT * FROM my_keyspace.user_orders WHERE user_id = ?;
```

2. 查询某个产品的所有订单：

```sql
SELECT * FROM my_keyspace.product_orders WHERE product = ?;
```

---

## 总结

Cassandra 的数据模型与传统关系型数据库有很大不同，它基于宽列存储模型，强调分布式和高可用性。通过合理设计分区键和集群键，可以高效地存储和查询大规模数据。

在设计 Cassandra 数据模型时，请始终围绕查询需求进行，并充分利用其分布式特性。

---

## 附加资源与练习

### 资源
- [Cassandra 官方文档](https://cassandra.apache.org/doc/latest/)
- 《Cassandra: The Definitive Guide》书籍

### 练习
1. 设计一个 Cassandra 表来存储博客文章的评论数据。
2. 编写查询语句，查找某个用户的所有评论。
3. 尝试在本地安装 Cassandra 并创建上述表结构。

:::note
如果你对 Cassandra 数据模型有任何疑问，欢迎在评论区留言！
:::