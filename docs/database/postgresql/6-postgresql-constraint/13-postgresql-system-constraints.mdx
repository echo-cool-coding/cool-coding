---
title: PostgreSQL 系统约束
description: 了解 PostgreSQL 中的系统约束，包括其类型、作用以及如何在实际场景中使用它们来确保数据的完整性和一致性。
---

## 介绍

在 PostgreSQL 中，**系统约束**是用于确保数据库中数据完整性和一致性的规则。这些约束由数据库系统自动管理，通常用于限制表中数据的插入、更新或删除操作。通过使用系统约束，开发者可以避免无效或不一致的数据进入数据库，从而提高数据的质量和可靠性。

PostgreSQL 提供了多种类型的系统约束，包括主键约束、唯一约束、外键约束、检查约束和非空约束。每种约束都有其特定的用途和应用场景。

## 系统约束的类型

### 1. 主键约束（Primary Key Constraint）

主键约束用于唯一标识表中的每一行数据。它确保表中的每一行都有一个唯一的标识符，并且不允许空值（NULL）。一个表只能有一个主键。

```sql
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL
);
```

在上面的示例中，`user_id` 列被定义为主键，因此每个用户的 `user_id` 必须是唯一的，且不能为空。

### 2. 唯一约束（Unique Constraint）

唯一约束确保表中的某一列或一组列的值是唯一的。与主键约束不同，唯一约束允许空值（NULL），但每个非空值必须是唯一的。

```sql
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(100) NOT NULL,
    sku VARCHAR(50) UNIQUE
);
```

在这个例子中，`sku` 列被定义为唯一约束，因此每个产品的 `sku` 必须是唯一的。

### 3. 外键约束（Foreign Key Constraint）

外键约束用于建立表与表之间的关系。它确保一个表中的列（或一组列）的值必须与另一个表中的主键或唯一键的值匹配。

```sql
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(user_id),
    order_date DATE NOT NULL
);
```

在这个例子中，`user_id` 列是外键，它引用了 `users` 表中的 `user_id` 列。这意味着每个订单必须与一个有效的用户相关联。

### 4. 检查约束（Check Constraint）

检查约束用于确保列中的值满足特定条件。它允许开发者定义一个布尔表达式，该表达式必须为真，否则数据将无法插入或更新。

```sql
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    salary NUMERIC CHECK (salary > 0)
);
```

在这个例子中，`salary` 列被定义为检查约束，确保每个员工的工资必须大于 0。

### 5. 非空约束（Not Null Constraint）

非空约束用于确保列中的值不能为空（NULL）。它强制要求该列在插入或更新时必须包含一个值。

```sql
CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL
);
```

在这个例子中，`name` 和 `email` 列都被定义为非空约束，因此每个客户必须提供姓名和电子邮件地址。

## 实际应用场景

### 场景 1：确保用户唯一性

在一个用户管理系统中，确保每个用户的电子邮件地址是唯一的非常重要。可以通过在 `users` 表的 `email` 列上添加唯一约束来实现这一点。

```sql
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE
);
```

### 场景 2：确保订单的有效性

在一个订单管理系统中，确保每个订单都与一个有效的用户相关联非常重要。可以通过在 `orders` 表的 `user_id` 列上添加外键约束来实现这一点。

```sql
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(user_id),
    order_date DATE NOT NULL
);
```

### 场景 3：确保工资的合理性

在一个员工管理系统中，确保每个员工的工资大于 0 非常重要。可以通过在 `employees` 表的 `salary` 列上添加检查约束来实现这一点。

```sql
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    salary NUMERIC CHECK (salary > 0)
);
```

## 总结

PostgreSQL 的系统约束是确保数据完整性和一致性的重要工具。通过使用主键约束、唯一约束、外键约束、检查约束和非空约束，开发者可以有效地管理数据库中的数据，避免无效或不一致的数据进入系统。

在实际应用中，系统约束可以帮助开发者构建更加健壮和可靠的数据库系统。通过合理使用这些约束，可以大大提高数据的质量和系统的稳定性。

## 附加资源

- [PostgreSQL 官方文档 - 约束](https://www.postgresql.org/docs/current/ddl-constraints.html)
- [PostgreSQL 教程 - 约束](https://www.postgresqltutorial.com/postgresql-constraints/)

## 练习

1. 创建一个 `students` 表，要求每个学生有一个唯一的学号（`student_id`），并且姓名（`name`）不能为空。
2. 创建一个 `courses` 表，要求每个课程有一个唯一的课程代码（`course_code`），并且课程名称（`course_name`）不能为空。
3. 创建一个 `enrollments` 表，要求每个选课记录必须与一个有效的学生和课程相关联。

通过完成这些练习，你将更好地理解 PostgreSQL 系统约束的应用和重要性。