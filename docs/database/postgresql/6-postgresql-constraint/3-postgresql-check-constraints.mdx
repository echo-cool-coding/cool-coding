---
title: PostgreSQL 检查约束
description: 了解如何在 PostgreSQL 中使用检查约束来确保数据完整性。本文详细介绍了检查约束的概念、语法、实际应用场景以及示例代码。
---

# PostgreSQL 检查约束

在 PostgreSQL 中，**检查约束（CHECK Constraint）** 是一种用于确保表中数据满足特定条件的约束。它允许你定义一个布尔表达式，该表达式必须为 `TRUE`，否则插入或更新操作将被拒绝。检查约束是确保数据完整性的重要工具之一。

## 什么是检查约束？

检查约束是一种数据库约束，用于限制表中列的值必须满足特定条件。它通过在插入或更新数据时验证指定的布尔表达式来实现。如果表达式结果为 `FALSE`，操作将被拒绝。

例如，你可以使用检查约束来确保某个列的值始终为正数，或者确保某个日期列的值在未来。

## 检查约束的语法

在 PostgreSQL 中，检查约束可以在创建表时定义，也可以在表创建后通过 `ALTER TABLE` 语句添加。以下是检查约束的基本语法：

```sql
CREATE TABLE table_name (
    column1 datatype,
    column2 datatype,
    ...
    CONSTRAINT constraint_name CHECK (condition)
);
```

- `table_name`：表的名称。
- `column1, column2, ...`：表中的列。
- `constraint_name`：约束的名称（可选）。
- `condition`：一个布尔表达式，用于验证数据。

### 示例：创建带有检查约束的表

假设我们有一个 `employees` 表，我们希望确保 `salary` 列的值始终大于 0。我们可以使用以下 SQL 语句创建表并添加检查约束：

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    salary NUMERIC(10, 2) CHECK (salary > 0)
);
```

在这个例子中，`salary` 列的值必须大于 0，否则插入或更新操作将失败。

## 添加检查约束到现有表

如果你已经有一个表，并且希望添加检查约束，可以使用 `ALTER TABLE` 语句。例如，假设我们有一个 `products` 表，我们希望确保 `price` 列的值大于 0：

```sql
ALTER TABLE products
ADD CONSTRAINT price_check CHECK (price > 0);
```

## 检查约束的实际应用场景

检查约束在许多实际场景中非常有用。以下是一些常见的应用场景：

1. **确保数值范围**：例如，确保年龄在 0 到 120 之间。
2. **验证日期**：例如，确保订单日期不早于当前日期。
3. **限制字符串长度**：例如，确保用户名长度在 5 到 20 个字符之间。

### 示例：验证日期

假设我们有一个 `orders` 表，我们希望确保 `order_date` 列的值不早于当前日期：

```sql
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    order_date DATE CHECK (order_date >= CURRENT_DATE)
);
```

在这个例子中，如果尝试插入一个早于当前日期的订单日期，操作将被拒绝。

## 检查约束的注意事项

:::caution
- **性能影响**：检查约束会在每次插入或更新时进行验证，因此复杂的检查约束可能会影响性能。
- **NULL 值**：如果检查条件涉及 `NULL` 值，请确保正确处理。例如，`CHECK (column > 0)` 不会拒绝 `NULL` 值，因为 `NULL` 与任何值的比较结果都是 `NULL`，而不是 `FALSE`。
:::

## 总结

检查约束是 PostgreSQL 中确保数据完整性的强大工具。通过定义布尔表达式，你可以限制表中列的值必须满足特定条件。无论是验证数值范围、日期还是字符串长度，检查约束都能帮助你保持数据的准确性和一致性。

## 附加资源与练习

- **练习**：尝试创建一个 `students` 表，并使用检查约束确保 `age` 列的值在 18 到 30 之间。
- **进一步阅读**：PostgreSQL 官方文档中的 [Constraints](https://www.postgresql.org/docs/current/ddl-constraints.html) 部分。

通过掌握检查约束，你将能够更好地管理和维护数据库中的数据完整性。继续练习并探索更多 PostgreSQL 的功能吧！