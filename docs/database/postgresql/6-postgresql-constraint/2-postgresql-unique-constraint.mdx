---
title: PostgreSQL 唯一约束
description: 了解 PostgreSQL 中的唯一约束，掌握如何确保表中某一列或多列的值唯一，避免重复数据。
---

# PostgreSQL 唯一约束

在 PostgreSQL 中，**唯一约束（Unique Constraint）** 是一种用于确保表中某一列或多列的值唯一的约束。它防止在这些列中插入重复的值，从而保证数据的完整性和一致性。唯一约束可以应用于单个列，也可以应用于多个列的组合。

## 什么是唯一约束？

唯一约束是一种数据库约束，用于确保表中某一列或多列的值是唯一的。与主键（Primary Key）不同，唯一约束允许列中包含 `NULL` 值，但每个 `NULL` 值只能出现一次（如果列允许 `NULL`）。

:::note
唯一约束和主键的区别：
- 主键不允许 `NULL` 值，而唯一约束允许。
- 一个表只能有一个主键，但可以有多个唯一约束。
:::

## 创建唯一约束

在 PostgreSQL 中，可以通过以下两种方式创建唯一约束：

1. **在创建表时定义唯一约束**
2. **在现有表上添加唯一约束**

### 1. 在创建表时定义唯一约束

在创建表时，可以使用 `UNIQUE` 关键字为某一列或多列定义唯一约束。以下是一个示例：

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE,
    email VARCHAR(100) UNIQUE
);
```

在这个示例中，`username` 和 `email` 列都被定义为唯一约束。这意味着每个用户名和电子邮件地址在表中都必须是唯一的。

### 2. 在现有表上添加唯一约束

如果表已经存在，可以使用 `ALTER TABLE` 语句添加唯一约束。以下是一个示例：

```sql
ALTER TABLE users
ADD CONSTRAINT unique_username UNIQUE (username);
```

在这个示例中，我们为 `users` 表的 `username` 列添加了一个名为 `unique_username` 的唯一约束。

## 唯一约束的实际应用

唯一约束在实际应用中有很多用途。以下是一些常见的场景：

### 1. 确保用户名的唯一性

在一个用户管理系统中，通常需要确保每个用户的用户名是唯一的。通过为 `username` 列添加唯一约束，可以防止用户注册时使用重复的用户名。

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE,
    password VARCHAR(100)
);
```

### 2. 防止重复的电子邮件地址

在用户注册或订阅系统中，通常需要确保每个电子邮件地址只能注册一次。通过为 `email` 列添加唯一约束，可以防止重复的电子邮件地址被插入到表中。

```sql
CREATE TABLE subscribers (
    id SERIAL PRIMARY KEY,
    email VARCHAR(100) UNIQUE,
    subscribed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 3. 组合唯一约束

有时，单一列的唯一性可能不足以满足需求。例如，在一个订单系统中，可能需要确保每个用户在每个日期只能下一个订单。这时可以使用组合唯一约束。

```sql
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INT,
    order_date DATE,
    UNIQUE (user_id, order_date)
);
```

在这个示例中，`user_id` 和 `order_date` 列的组合必须是唯一的。

## 唯一约束的限制

虽然唯一约束非常有用，但在使用时也需要注意一些限制：

1. **NULL 值的处理**：唯一约束允许 `NULL` 值，但每个 `NULL` 值只能出现一次。如果列允许 `NULL`，则多个 `NULL` 值不会违反唯一约束。
2. **性能影响**：唯一约束会在插入或更新数据时进行检查，这可能会对性能产生一定影响，尤其是在大数据量的情况下。

## 总结

唯一约束是 PostgreSQL 中一种强大的工具，用于确保表中某一列或多列的值唯一。它可以帮助我们避免重复数据，保证数据的完整性和一致性。通过本文的学习，你应该已经掌握了如何在 PostgreSQL 中创建和使用唯一约束。

## 附加资源与练习

- **练习 1**：创建一个 `products` 表，并为 `product_code` 列添加唯一约束。
- **练习 2**：在一个现有的 `employees` 表中，为 `employee_id` 和 `department_id` 列添加组合唯一约束。
- **进一步阅读**：PostgreSQL 官方文档中的 [唯一约束](https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-UNIQUE-CONSTRAINTS) 部分。

通过实践和进一步学习，你将能够更好地理解和应用 PostgreSQL 中的唯一约束。