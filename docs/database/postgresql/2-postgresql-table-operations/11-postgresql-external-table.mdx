---
title: PostgreSQL 外部表
description: 了解 PostgreSQL 外部表的概念、创建方法以及实际应用场景。本文适合初学者，包含详细的代码示例和逐步讲解。
---

## 介绍

PostgreSQL 外部表（Foreign Table）是一种特殊的表，它允许你访问存储在其他数据库或文件系统中的数据，而无需将这些数据导入到 PostgreSQL 数据库中。外部表的概念类似于数据库中的视图，但它们的数据源可以是外部的，例如另一个数据库、CSV 文件或其他数据存储系统。

通过使用外部表，你可以在 PostgreSQL 中查询和操作外部数据，就像操作本地表一样。这对于数据集成、数据分析和数据迁移等场景非常有用。

## 创建外部表

要创建外部表，首先需要安装并启用 `postgres_fdw` 扩展。`postgres_fdw` 是 PostgreSQL 提供的一个外部数据包装器（Foreign Data Wrapper, FDW），它允许你访问其他 PostgreSQL 数据库中的数据。

### 1. 安装 `postgres_fdw` 扩展

首先，确保你已经安装了 `postgres_fdw` 扩展。如果没有安装，可以使用以下命令进行安装：

```sql
CREATE EXTENSION postgres_fdw;
```

### 2. 创建外部服务器

接下来，你需要创建一个外部服务器，用于连接到外部数据源。假设你要连接到另一个 PostgreSQL 数据库，可以使用以下命令：

```sql
CREATE SERVER foreign_server
FOREIGN DATA WRAPPER postgres_fdw
OPTIONS (host 'remote_host', dbname 'remote_db', port '5432');
```

在这个例子中，`foreign_server` 是外部服务器的名称，`remote_host` 是外部数据库的主机名，`remote_db` 是外部数据库的名称，`port` 是外部数据库的端口号。

### 3. 创建用户映射

为了连接到外部服务器，你需要创建一个用户映射，将本地用户与外部数据库的用户关联起来：

```sql
CREATE USER MAPPING FOR local_user
SERVER foreign_server
OPTIONS (user 'remote_user', password 'remote_password');
```

在这个例子中，`local_user` 是本地 PostgreSQL 用户，`remote_user` 和 `remote_password` 是外部数据库的用户名和密码。

### 4. 创建外部表

现在，你可以创建一个外部表，用于访问外部数据库中的数据。假设外部数据库中有一个名为 `remote_table` 的表，你可以使用以下命令创建外部表：

```sql
CREATE FOREIGN TABLE foreign_table (
    id INT,
    name TEXT,
    age INT
)
SERVER foreign_server
OPTIONS (schema_name 'public', table_name 'remote_table');
```

在这个例子中，`foreign_table` 是外部表的名称，`remote_table` 是外部数据库中的表名。

## 查询外部表

创建外部表后，你可以像查询本地表一样查询外部表。例如：

```sql
SELECT * FROM foreign_table WHERE age > 30;
```

这个查询将返回外部表中 `age` 大于 30 的所有记录。

## 实际应用场景

### 数据集成

假设你有一个分布在多个数据库中的数据集，你可以使用外部表将这些数据集集成到一个 PostgreSQL 数据库中，从而简化数据查询和分析。

### 数据迁移

在数据迁移过程中，你可以使用外部表将数据从旧数据库迁移到新数据库，而无需将数据导出和导入。

### 数据分析

如果你有存储在外部文件（如 CSV 文件）中的数据，你可以使用外部表将这些数据导入到 PostgreSQL 中进行分析。

## 总结

PostgreSQL 外部表提供了一种灵活的方式来访问和操作外部数据源中的数据。通过使用 `postgres_fdw` 扩展，你可以轻松地连接到其他 PostgreSQL 数据库，并像操作本地表一样查询外部数据。

外部表在数据集成、数据迁移和数据分析等场景中非常有用。希望本文能帮助你理解并掌握 PostgreSQL 外部表的使用。

## 附加资源

- [PostgreSQL 官方文档 - Foreign Data Wrappers](https://www.postgresql.org/docs/current/postgres-fdw.html)
- [PostgreSQL 外部表教程](https://www.postgresqltutorial.com/postgresql-foreign-data-wrapper/)

## 练习

1. 尝试创建一个外部表，连接到另一个 PostgreSQL 数据库，并查询其中的数据。
2. 使用外部表将 CSV 文件中的数据导入到 PostgreSQL 中，并进行简单的数据分析。
