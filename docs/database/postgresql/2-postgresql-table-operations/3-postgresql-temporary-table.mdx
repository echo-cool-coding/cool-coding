---
title: PostgreSQL 临时表
description: 了解如何在 PostgreSQL 中使用临时表，掌握其创建、使用和删除的方法，并通过实际案例加深理解。
---

# PostgreSQL 临时表

在 PostgreSQL 中，临时表是一种特殊类型的表，它仅在当前会话中存在，并在会话结束时自动删除。临时表非常适合用于存储中间结果或临时数据，尤其是在复杂的查询或数据处理过程中。

## 什么是临时表？

临时表是 PostgreSQL 提供的一种机制，用于在会话期间存储临时数据。与普通表不同，临时表的数据不会持久化到磁盘，而是在会话结束后自动删除。这使得临时表非常适合用于存储中间结果或临时数据。

## 创建临时表

要创建临时表，可以使用 `CREATE TEMPORARY TABLE` 语句。临时表的语法与普通表类似，只是在 `CREATE TABLE` 前加上 `TEMPORARY` 关键字。

```sql
CREATE TEMPORARY TABLE temp_employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    salary NUMERIC
);
```

在这个例子中，我们创建了一个名为 `temp_employees` 的临时表，它包含 `id`、`name` 和 `salary` 三个字段。

:::note
临时表的名称在当前会话中是唯一的。如果在同一个会话中尝试创建同名的临时表，PostgreSQL 会抛出错误。
:::

## 插入数据到临时表

插入数据到临时表的方式与普通表相同。我们可以使用 `INSERT INTO` 语句将数据插入到临时表中。

```sql
INSERT INTO temp_employees (name, salary) VALUES
('Alice', 50000),
('Bob', 60000),
('Charlie', 70000);
```

## 查询临时表

查询临时表的方式与查询普通表相同。我们可以使用 `SELECT` 语句从临时表中检索数据。

```sql
SELECT * FROM temp_employees;
```

输出结果如下：

```
 id |  name   | salary 
----+---------+--------
  1 | Alice   |  50000
  2 | Bob     |  60000
  3 | Charlie |  70000
(3 rows)
```

## 删除临时表

临时表在会话结束时会自动删除，但如果你希望在会话期间手动删除临时表，可以使用 `DROP TABLE` 语句。

```sql
DROP TABLE temp_employees;
```

:::caution
删除临时表后，表中的所有数据将丢失，且无法恢复。
:::

## 临时表的实际应用场景

临时表在许多实际场景中非常有用。以下是一些常见的应用场景：

1. **中间结果存储**：在复杂的查询中，临时表可以用于存储中间结果，从而简化查询逻辑。
2. **数据清理**：在数据处理过程中，临时表可以用于存储需要清理或转换的数据。
3. **测试和调试**：在开发和测试过程中，临时表可以用于存储测试数据，而不会影响生产环境中的数据。

### 示例：使用临时表进行数据清理

假设我们有一个包含大量数据的表 `employees`，我们需要对其中的数据进行清理，例如删除工资低于某个阈值的员工。我们可以使用临时表来存储需要删除的员工数据。

```sql
-- 创建临时表
CREATE TEMPORARY TABLE temp_low_salary_employees AS
SELECT * FROM employees WHERE salary < 50000;

-- 删除原表中的数据
DELETE FROM employees WHERE salary < 50000;

-- 查询临时表以确认删除的数据
SELECT * FROM temp_low_salary_employees;
```

在这个例子中，我们首先创建了一个临时表 `temp_low_salary_employees`，用于存储工资低于 50000 的员工数据。然后，我们从原表 `employees` 中删除了这些数据，并通过查询临时表来确认删除的数据。

## 总结

临时表是 PostgreSQL 中非常有用的工具，特别适合用于存储临时数据或中间结果。通过使用 `CREATE TEMPORARY TABLE` 语句，我们可以在会话期间创建临时表，并在会话结束时自动删除它们。临时表的使用可以简化复杂的查询和数据处理过程，同时避免对生产环境中的数据造成影响。

## 附加资源

- [PostgreSQL 官方文档：CREATE TABLE](https://www.postgresql.org/docs/current/sql-createtable.html)
- [PostgreSQL 官方文档：DROP TABLE](https://www.postgresql.org/docs/current/sql-droptable.html)

## 练习

1. 创建一个临时表 `temp_students`，包含 `id`、`name` 和 `grade` 字段。
2. 向 `temp_students` 表中插入一些数据。
3. 查询 `temp_students` 表中的数据。
4. 删除 `temp_students` 表。

通过完成这些练习，你将更好地理解临时表的使用方法。