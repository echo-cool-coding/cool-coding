---
title: PostgreSQL 复合类型
description: 了解 PostgreSQL 中的复合类型，包括其定义、使用方法以及实际应用场景。适合初学者学习如何创建和使用复合类型。
---

## 什么是 PostgreSQL 复合类型？

PostgreSQL 复合类型（Composite Type）是一种用户自定义的数据类型，它允许你将多个字段组合成一个单一的类型。这些字段可以是不同的数据类型，类似于表中的一行记录。复合类型非常适合用于表示复杂的数据结构，例如地址、坐标或用户信息。

### 复合类型的定义

要定义一个复合类型，可以使用 `CREATE TYPE` 语句。以下是一个简单的示例，定义了一个表示地址的复合类型：

```sql
CREATE TYPE address AS (
    street TEXT,
    city TEXT,
    state TEXT,
    zip_code VARCHAR(10)
);
```

在这个例子中，我们定义了一个名为 `address` 的复合类型，它包含四个字段：`street`、`city`、`state` 和 `zip_code`。

### 使用复合类型

定义复合类型后，你可以在表中使用它，或者将其作为函数的参数或返回值。以下是一个在表中使用复合类型的示例：

```sql
CREATE TABLE customers (
    id SERIAL PRIMARY KEY,
    name TEXT,
    home_address address
);
```

在这个表中，`home_address` 列的类型是我们之前定义的 `address` 复合类型。

### 插入和查询复合类型数据

插入复合类型数据时，需要使用 `ROW` 构造函数或直接使用括号括起来的值列表。以下是一个插入数据的示例：

```sql
INSERT INTO customers (name, home_address)
VALUES ('John Doe', ROW('123 Main St', 'Anytown', 'CA', '12345'));
```

查询复合类型数据时，可以使用点号（`.`）来访问复合类型中的字段：

```sql
SELECT name, (home_address).city
FROM customers;
```

输出结果可能如下：

```
   name   |   city
----------+----------
 John Doe | Anytown
```

### 实际应用场景

复合类型非常适合用于表示复杂的数据结构。以下是一些实际应用场景：

1. **地址信息**：如上面的示例所示，复合类型可以用于存储地址信息，包括街道、城市、州和邮政编码。
2. **坐标点**：你可以定义一个表示二维或三维坐标的复合类型，例如 `(x, y)` 或 `(x, y, z)`。
3. **用户信息**：复合类型可以用于存储用户的详细信息，例如姓名、年龄、联系方式等。

### 总结

PostgreSQL 复合类型是一种强大的工具，允许你将多个字段组合成一个单一的类型。它非常适合用于表示复杂的数据结构，并且可以在表、函数等多种场景中使用。通过定义和使用复合类型，你可以使数据库设计更加灵活和高效。

### 附加资源与练习

- **练习**：尝试定义一个表示三维坐标的复合类型，并在表中使用它。
- **进一步学习**：阅读 PostgreSQL 官方文档中关于复合类型的更多内容，了解如何将复合类型与数组、函数等结合使用。

:::tip
复合类型是 PostgreSQL 中非常灵活的功能，掌握它可以极大地提升你的数据库设计能力。尝试在实际项目中应用复合类型，体验其带来的便利。
:::