---
title: PostgreSQL JSON 类型
description: 了解 PostgreSQL 中的 JSON 数据类型，掌握如何存储、查询和操作 JSON 数据。
---

# PostgreSQL JSON 类型

在现代应用程序中，JSON（JavaScript Object Notation）已成为一种流行的数据交换格式。PostgreSQL 提供了对 JSON 数据类型的原生支持，使得存储和查询 JSON 数据变得非常方便。本文将详细介绍 PostgreSQL 中的 JSON 类型，并通过示例展示其使用方法。

## 什么是 JSON 类型？

JSON 是一种轻量级的数据交换格式，易于人阅读和编写，同时也易于机器解析和生成。PostgreSQL 提供了两种 JSON 数据类型：

1. **JSON**：存储精确的 JSON 数据，保留所有空格和键的顺序。
2. **JSONB**：以二进制格式存储 JSON 数据，不保留空格和键的顺序，但支持索引和更高效的查询。

:::tip
在大多数情况下，推荐使用 `JSONB`，因为它提供了更好的性能和功能。
:::

## 创建包含 JSON 类型的表

让我们从一个简单的例子开始，创建一个包含 JSON 类型字段的表。

```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    details JSONB
);
```

在这个例子中，`details` 字段被定义为 `JSONB` 类型，用于存储产品的详细信息。

## 插入 JSON 数据

接下来，我们向表中插入一些 JSON 数据。

```sql
INSERT INTO products (name, details)
VALUES 
    ('Laptop', '{"brand": "Dell", "ram": "16GB", "storage": "512GB SSD"}'),
    ('Smartphone', '{"brand": "Apple", "model": "iPhone 13", "color": "Midnight"}');
```

## 查询 JSON 数据

PostgreSQL 提供了丰富的操作符和函数来查询 JSON 数据。以下是一些常见的查询示例。

### 查询特定键的值

```sql
SELECT details->>'brand' AS brand
FROM products;
```

**输出：**

```
 brand 
-------
 Dell
 Apple
(2 rows)
```

### 查询嵌套的 JSON 数据

假设 `details` 字段中包含嵌套的 JSON 数据：

```sql
UPDATE products
SET details = '{"brand": "Dell", "specs": {"ram": "16GB", "storage": "512GB SSD"}}'
WHERE name = 'Laptop';
```

我们可以使用 `#>` 操作符来查询嵌套的键：

```sql
SELECT details#>'{specs,ram}' AS ram
FROM products
WHERE name = 'Laptop';
```

**输出：**

```
  ram   
--------
 "16GB"
(1 row)
```

### 使用 JSONB 函数

PostgreSQL 提供了许多用于操作 JSONB 数据的函数。例如，`jsonb_set` 可以用于更新 JSONB 数据：

```sql
UPDATE products
SET details = jsonb_set(details, '{color}', '"Silver"')
WHERE name = 'Laptop';
```

## 实际应用场景

### 动态属性存储

在某些应用中，实体的属性可能是动态的。例如，电子商务网站中的产品可能具有不同的属性。使用 JSON 类型可以灵活地存储这些属性，而不需要频繁修改数据库模式。

### 配置存储

应用程序的配置通常以 JSON 格式存储。将这些配置存储在 PostgreSQL 的 JSON 类型字段中，可以方便地进行查询和更新。

## 总结

PostgreSQL 的 JSON 类型为存储和查询 JSON 数据提供了强大的支持。通过使用 `JSONB`，您可以获得更好的性能和功能。本文介绍了如何创建包含 JSON 类型的表、插入和查询 JSON 数据，以及一些实际应用场景。

## 附加资源

- [PostgreSQL JSON 文档](https://www.postgresql.org/docs/current/datatype-json.html)
- [PostgreSQL JSONB 函数和操作符](https://www.postgresql.org/docs/current/functions-json.html)

## 练习

1. 创建一个包含 `JSONB` 类型的表，用于存储用户的配置文件。
2. 插入一些包含嵌套 JSON 数据的记录。
3. 编写查询，提取嵌套 JSON 数据中的特定键值。

通过完成这些练习，您将更好地掌握 PostgreSQL 中的 JSON 类型。