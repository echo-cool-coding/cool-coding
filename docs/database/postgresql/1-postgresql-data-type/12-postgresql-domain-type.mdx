---
title: PostgreSQL 域类型
description: 了解 PostgreSQL 中的域类型（Domain Types），这是一种自定义数据类型，用于增强数据完整性和可重用性。本文将通过示例和实际应用场景帮助初学者掌握域类型的使用。
---

## 介绍

在 PostgreSQL 中，**域类型（Domain Types）** 是一种用户定义的数据类型，它基于现有的数据类型（如整数、字符串等），并添加了额外的约束条件。域类型的主要目的是增强数据的完整性和可重用性。通过定义域类型，您可以为特定字段设置统一的规则，从而减少重复代码并确保数据的一致性。

例如，如果您需要在一个表中多次使用相同的约束条件（如电子邮件地址的格式验证），您可以创建一个域类型来封装这些规则，而不是在每个字段中重复定义。

---

## 创建域类型

要创建一个域类型，您可以使用 `CREATE DOMAIN` 语句。以下是基本语法：

```sql
CREATE DOMAIN domain_name AS data_type
  [ DEFAULT default_value ]
  [ CONSTRAINT constraint_name CHECK (condition) ];
```

- `domain_name`：域类型的名称。
- `data_type`：域类型基于的现有数据类型（如 `VARCHAR`、`INTEGER` 等）。
- `default_value`：域的默认值（可选）。
- `constraint_name`：约束的名称（可选）。
- `condition`：约束条件（如范围检查、格式验证等）。

### 示例：创建电子邮件域类型

假设我们需要定义一个域类型来存储电子邮件地址，并要求其符合常见的电子邮件格式。可以使用以下语句：

```sql
CREATE DOMAIN email AS VARCHAR(255)
  CHECK (VALUE ~ '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$');
```

在这个示例中：
- `email` 是域类型的名称。
- `VARCHAR(255)` 是基础数据类型。
- `CHECK` 子句用于验证电子邮件地址的格式。

---

## 使用域类型

创建域类型后，您可以像使用其他数据类型一样在表中使用它。例如：

```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  username VARCHAR(50) NOT NULL,
  email email NOT NULL
);
```

在这个表中，`email` 字段将自动应用我们在域类型中定义的约束条件。

### 插入数据示例

尝试插入符合和不符合约束条件的数据：

```sql
-- 插入有效数据
INSERT INTO users (username, email) VALUES ('john_doe', 'john.doe@example.com');

-- 插入无效数据（将抛出错误）
INSERT INTO users (username, email) VALUES ('jane_doe', 'jane.doe@invalid');
```

:::note
如果插入的数据不符合域类型的约束条件，PostgreSQL 将抛出错误并拒绝插入。
:::

---

## 实际应用场景

### 场景 1：统一约束条件

假设您有一个包含多个表的数据库，每个表都有一个 `phone_number` 字段。为了确保所有电话号码都符合特定的格式（如 10 位数字），您可以创建一个域类型：

```sql
CREATE DOMAIN phone_number AS VARCHAR(10)
  CHECK (VALUE ~ '^[0-9]{10}$');
```

然后在所有表中使用该域类型：

```sql
CREATE TABLE customers (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  phone phone_number NOT NULL
);

CREATE TABLE employees (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  phone phone_number NOT NULL
);
```

### 场景 2：默认值和约束

假设您需要一个域类型来表示百分比值（0 到 100 之间的整数），并设置默认值为 0：

```sql
CREATE DOMAIN percentage AS INTEGER
  DEFAULT 0
  CHECK (VALUE BETWEEN 0 AND 100);
```

在表中使用：

```sql
CREATE TABLE survey_results (
  id SERIAL PRIMARY KEY,
  question VARCHAR(255) NOT NULL,
  response_percentage percentage NOT NULL
);
```

---

## 总结

PostgreSQL 的域类型是一种强大的工具，可以帮助您定义可重用的数据类型并增强数据完整性。通过封装约束条件和默认值，域类型可以减少重复代码并确保数据的一致性。

### 关键点回顾
- 域类型基于现有的数据类型，并添加额外的约束条件。
- 使用 `CREATE DOMAIN` 语句定义域类型。
- 域类型可以在多个表中重复使用，确保统一的约束规则。

---

## 附加资源与练习

### 练习
1. 创建一个域类型 `age`，要求值在 0 到 120 之间。
2. 创建一个域类型 `postal_code`，要求值符合您所在国家的邮政编码格式。
3. 在一个表中使用上述域类型，并尝试插入有效和无效数据。

### 进一步学习
- 阅读 [PostgreSQL 官方文档](https://www.postgresql.org/docs/current/sql-createdomain.html) 以了解更多关于域类型的详细信息。
- 尝试在您的项目中应用域类型，以简化数据约束管理。

:::tip
域类型不仅适用于简单的约束，还可以用于复杂的业务规则。尝试结合多个约束条件创建更强大的域类型！
:::