---
title: PostgreSQL 自定义类型
description: 了解如何在 PostgreSQL 中创建和使用自定义类型，扩展数据库的功能以满足特定需求。
---

# PostgreSQL 自定义类型

PostgreSQL 是一个功能强大的关系型数据库管理系统，支持多种内置数据类型，如整数、字符串、日期等。然而，在某些情况下，内置类型可能无法完全满足你的需求。这时，你可以通过创建自定义类型来扩展 PostgreSQL 的功能。本文将详细介绍如何在 PostgreSQL 中创建和使用自定义类型，并通过实际案例展示其应用场景。

## 什么是自定义类型？

自定义类型是用户定义的数据类型，允许你根据特定需求创建新的数据类型。这些类型可以是简单的组合类型（如结构体），也可以是复杂的类型（如枚举或复合类型）。通过自定义类型，你可以更好地组织数据，并在数据库中实现更复杂的逻辑。

## 创建自定义类型

在 PostgreSQL 中，你可以使用 `CREATE TYPE` 语句来创建自定义类型。以下是创建自定义类型的几种常见方式：

### 1. 复合类型（Composite Types）

复合类型是一种由多个字段组成的类型，类似于结构体。你可以使用 `CREATE TYPE` 语句来定义复合类型。

```sql
CREATE TYPE address AS (
    street TEXT,
    city TEXT,
    state TEXT,
    zip_code TEXT
);
```

在这个例子中，我们创建了一个名为 `address` 的复合类型，它包含四个字段：`street`、`city`、`state` 和 `zip_code`。

### 2. 枚举类型（Enum Types）

枚举类型是一种包含一组预定义值的类型。你可以使用 `CREATE TYPE` 语句来定义枚举类型。

```sql
CREATE TYPE mood AS ENUM ('happy', 'sad', 'neutral');
```

在这个例子中，我们创建了一个名为 `mood` 的枚举类型，它包含三个可能的值：`happy`、`sad` 和 `neutral`。

### 3. 范围类型（Range Types）

范围类型是一种表示值范围的数据类型。你可以使用 `CREATE TYPE` 语句来定义范围类型。

```sql
CREATE TYPE temperature_range AS RANGE (
    subtype = float8
);
```

在这个例子中，我们创建了一个名为 `temperature_range` 的范围类型，它表示一个浮点数的范围。

## 使用自定义类型

创建自定义类型后，你可以在表定义、函数参数和返回值中使用这些类型。以下是一些使用自定义类型的示例。

### 在表中使用自定义类型

你可以在表定义中使用自定义类型作为列的数据类型。

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name TEXT,
    home_address address,
    current_mood mood
);
```

在这个例子中，我们创建了一个名为 `employees` 的表，其中 `home_address` 列使用了 `address` 复合类型，`current_mood` 列使用了 `mood` 枚举类型。

### 在函数中使用自定义类型

你可以在函数参数和返回值中使用自定义类型。

```sql
CREATE FUNCTION get_employee_mood(employee_id INT) RETURNS mood AS $$
DECLARE
    employee_mood mood;
BEGIN
    SELECT current_mood INTO employee_mood FROM employees WHERE id = employee_id;
    RETURN employee_mood;
END;
$$ LANGUAGE plpgsql;
```

在这个例子中，我们创建了一个名为 `get_employee_mood` 的函数，它接受一个 `employee_id` 参数，并返回一个 `mood` 类型的值。

## 实际案例

假设你正在开发一个员工管理系统，需要存储员工的家庭地址和当前情绪状态。通过使用自定义类型，你可以更好地组织数据，并在数据库中实现更复杂的逻辑。

```sql
-- 创建自定义类型
CREATE TYPE address AS (
    street TEXT,
    city TEXT,
    state TEXT,
    zip_code TEXT
);

CREATE TYPE mood AS ENUM ('happy', 'sad', 'neutral');

-- 创建表
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name TEXT,
    home_address address,
    current_mood mood
);

-- 插入数据
INSERT INTO employees (name, home_address, current_mood)
VALUES ('John Doe', ('123 Main St', 'Anytown', 'CA', '12345'), 'happy');

-- 查询数据
SELECT * FROM employees;
```

在这个案例中，我们创建了 `address` 和 `mood` 两个自定义类型，并在 `employees` 表中使用了这些类型。通过这种方式，我们可以更清晰地组织员工的数据，并在查询时更容易地访问这些数据。

## 总结

PostgreSQL 的自定义类型功能允许你根据特定需求创建新的数据类型，从而扩展数据库的功能。通过使用复合类型、枚举类型和范围类型，你可以更好地组织数据，并在数据库中实现更复杂的逻辑。本文介绍了如何创建和使用自定义类型，并通过实际案例展示了其应用场景。

## 附加资源

- [PostgreSQL 官方文档：自定义类型](https://www.postgresql.org/docs/current/sql-createtype.html)
- [PostgreSQL 官方文档：复合类型](https://www.postgresql.org/docs/current/rowtypes.html)
- [PostgreSQL 官方文档：枚举类型](https://www.postgresql.org/docs/current/datatype-enum.html)
- [PostgreSQL 官方文档：范围类型](https://www.postgresql.org/docs/current/rangetypes.html)

## 练习

1. 创建一个名为 `product` 的复合类型，包含 `name`、`price` 和 `quantity` 字段。
2. 创建一个名为 `status` 的枚举类型，包含 `pending`、`approved` 和 `rejected` 值。
3. 创建一个表 `orders`，使用 `product` 和 `status` 自定义类型作为列的数据类型。
4. 插入一些数据并查询表，验证自定义类型的使用。

通过完成这些练习，你将更好地理解 PostgreSQL 自定义类型的使用方法。