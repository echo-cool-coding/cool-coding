---
title: PostgreSQL 范围类型
description: 了解 PostgreSQL 中的范围类型，掌握如何使用它们来表示和操作连续的数据范围。
---

## 介绍

在 PostgreSQL 中，范围类型（Range Types）是一种用于表示连续数据范围的数据类型。它们可以用于表示时间范围、数字范围、日期范围等。范围类型不仅简化了数据的存储和查询，还提供了丰富的操作符和函数来处理这些范围。

范围类型的主要特点包括：
- 支持开区间、闭区间和半开区间。
- 提供内置的操作符和函数，用于范围比较、重叠检查、合并等。
- 适用于多种场景，如时间调度、数值区间管理等。

## 范围类型的基本语法

PostgreSQL 提供了多种内置的范围类型，例如：
- `int4range`：表示整数范围。
- `int8range`：表示大整数范围。
- `numrange`：表示数值范围。
- `tsrange`：表示时间戳范围（不带时区）。
- `tstzrange`：表示带时区的时间戳范围。
- `daterange`：表示日期范围。

### 创建范围类型

要创建一个范围类型的列，可以使用以下语法：

```sql
CREATE TABLE example_table (
    id SERIAL PRIMARY KEY,
    valid_period daterange
);
```

### 插入范围数据

插入范围数据时，可以使用 `[` 或 `(` 表示闭区间或开区间。例如：

```sql
INSERT INTO example_table (valid_period)
VALUES ('[2023-01-01, 2023-12-31]');
```

### 查询范围数据

查询范围数据时，可以使用范围操作符。例如，查找包含某个日期的范围：

```sql
SELECT * FROM example_table
WHERE valid_period @> '2023-06-15';
```

## 范围类型的操作符和函数

PostgreSQL 提供了丰富的操作符和函数来处理范围类型。以下是一些常用的操作符和函数：

### 范围操作符

- `@>`：检查范围是否包含某个值或另一个范围。
- `<@`：检查某个值或范围是否被包含在另一个范围内。
- `&&`：检查两个范围是否重叠。
- `<<`：检查第一个范围是否完全在第二个范围的左侧。
- `>>`：检查第一个范围是否完全在第二个范围的右侧。
- `-|-`：检查两个范围是否相邻。

### 范围函数

- `lower(range)`：获取范围的下界。
- `upper(range)`：获取范围的上界。
- `isempty(range)`：检查范围是否为空。
- `range_merge(range1, range2)`：合并两个范围。

### 示例

以下是一个使用范围操作符和函数的示例：

```sql
-- 创建表
CREATE TABLE reservations (
    id SERIAL PRIMARY KEY,
    room_id INT,
    reservation_period tsrange
);

-- 插入数据
INSERT INTO reservations (room_id, reservation_period)
VALUES
    (1, '[2023-10-01 14:00, 2023-10-01 16:00)'),
    (2, '[2023-10-01 15:00, 2023-10-01 17:00)');

-- 查询重叠的预订
SELECT * FROM reservations
WHERE reservation_period && '[2023-10-01 15:30, 2023-10-01 16:30)';
```

## 实际应用场景

### 场景 1：时间调度

假设你正在开发一个会议室预订系统，需要检查某个时间段内是否有可用的会议室。使用范围类型可以轻松实现这一功能：

```sql
-- 检查某个时间段是否有可用的会议室
SELECT room_id
FROM reservations
WHERE reservation_period && '[2023-10-01 15:00, 2023-10-01 16:00)';
```

### 场景 2：数值区间管理

假设你需要管理一组数值区间，并检查某个值是否落在这些区间内：

```sql
-- 创建表
CREATE TABLE numeric_ranges (
    id SERIAL PRIMARY KEY,
    value_range numrange
);

-- 插入数据
INSERT INTO numeric_ranges (value_range)
VALUES
    ('[10, 20]'),
    ('[30, 40]');

-- 检查某个值是否落在区间内
SELECT * FROM numeric_ranges
WHERE value_range @> 15;
```

## 总结

PostgreSQL 的范围类型为处理连续数据范围提供了强大的工具。通过使用范围类型，你可以简化数据的存储和查询，并利用内置的操作符和函数高效地处理范围数据。无论是时间调度、数值区间管理，还是其他需要处理范围数据的场景，范围类型都能显著提升开发效率。

## 附加资源

- [PostgreSQL 官方文档 - 范围类型](https://www.postgresql.org/docs/current/rangetypes.html)
- 练习：尝试创建一个包含范围类型的表，并编写查询来检查范围的重叠、包含关系等。

:::tip
如果你对范围类型的使用有任何疑问，可以查阅 PostgreSQL 官方文档，或者在社区论坛中寻求帮助。
:::