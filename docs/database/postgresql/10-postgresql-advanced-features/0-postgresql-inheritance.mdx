---
title: PostgreSQL 继承
description: 了解 PostgreSQL 中的继承特性，掌握如何通过继承实现表结构的复用和扩展。
---

# PostgreSQL 继承

PostgreSQL 的继承特性允许你创建一个表，使其继承另一个表的结构和数据。这种特性在数据库设计中非常有用，尤其是在需要复用表结构或实现层次化数据模型时。本文将详细介绍 PostgreSQL 的继承特性，并通过实际案例帮助你理解其应用场景。

## 什么是 PostgreSQL 继承？

在 PostgreSQL 中，继承是一种表与表之间的关系，其中一个表（子表）可以继承另一个表（父表）的结构和数据。子表会自动包含父表的所有列，并且可以选择性地添加自己的列。通过继承，你可以轻松地复用表结构，并在子表中扩展新的功能。

:::note
继承是 PostgreSQL 独有的特性，其他关系型数据库（如 MySQL 或 SQL Server）并不支持这种功能。
:::

## 创建继承关系

让我们通过一个简单的例子来理解如何创建继承关系。假设我们有一个 `vehicles` 表，用于存储车辆的基本信息。我们希望创建两个子表 `cars` 和 `trucks`，分别用于存储轿车和卡车的信息。

首先，创建父表 `vehicles`：

```sql
CREATE TABLE vehicles (
    id SERIAL PRIMARY KEY,
    make VARCHAR(50) NOT NULL,
    model VARCHAR(50) NOT NULL,
    year INT NOT NULL
);
```

接下来，创建子表 `cars` 和 `trucks`，并让它们继承 `vehicles` 表：

```sql
CREATE TABLE cars (
    fuel_type VARCHAR(20)
) INHERITS (vehicles);

CREATE TABLE trucks (
    load_capacity INT
) INHERITS (vehicles);
```

在这个例子中，`cars` 和 `trucks` 表继承了 `vehicles` 表的所有列，并分别添加了自己的列 `fuel_type` 和 `load_capacity`。

## 插入数据

现在，我们可以向子表中插入数据。插入的数据会自动包含父表的列：

```sql
INSERT INTO cars (make, model, year, fuel_type)
VALUES ('Toyota', 'Corolla', 2020, 'Gasoline');

INSERT INTO trucks (make, model, year, load_capacity)
VALUES ('Ford', 'F-150', 2019, 2000);
```

查询 `cars` 表：

```sql
SELECT * FROM cars;
```

输出结果：

```
 id |  make  |  model  | year | fuel_type
----+--------+---------+------+-----------
  1 | Toyota | Corolla | 2020 | Gasoline
```

查询 `trucks` 表：

```sql
SELECT * FROM trucks;
```

输出结果：

```
 id | make | model | year | load_capacity
----+------+-------+------+---------------
  2 | Ford | F-150 | 2019 |          2000
```

## 查询继承表

当你查询父表时，PostgreSQL 会自动包含所有子表的数据。例如，查询 `vehicles` 表：

```sql
SELECT * FROM vehicles;
```

输出结果：

```
 id |  make  |  model  | year
----+--------+---------+------
  1 | Toyota | Corolla | 2020
  2 | Ford   | F-150   | 2019
```

:::tip
如果你只想查询父表的数据，可以使用 `ONLY` 关键字：

```sql
SELECT * FROM ONLY vehicles;
```
:::

## 实际应用场景

### 1. 层次化数据模型

继承特性非常适合用于实现层次化数据模型。例如，在一个学校管理系统中，你可以创建一个 `people` 表作为父表，然后创建 `students` 和 `teachers` 表作为子表，分别存储学生和教师的信息。

```sql
CREATE TABLE people (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    birthdate DATE NOT NULL
);

CREATE TABLE students (
    grade_level INT
) INHERITS (people);

CREATE TABLE teachers (
    subject VARCHAR(50)
) INHERITS (people);
```

### 2. 分区表

继承特性还可以用于实现表分区。例如，你可以创建一个 `sales` 表作为父表，然后创建多个子表（如 `sales_2022`、`sales_2023`）来存储不同年份的销售数据。

```sql
CREATE TABLE sales (
    id SERIAL PRIMARY KEY,
    sale_date DATE NOT NULL,
    amount NUMERIC(10, 2) NOT NULL
);

CREATE TABLE sales_2022 () INHERITS (sales);
CREATE TABLE sales_2023 () INHERITS (sales);
```

## 总结

PostgreSQL 的继承特性为数据库设计提供了强大的灵活性。通过继承，你可以轻松地复用表结构，并在子表中扩展新的功能。无论是实现层次化数据模型还是表分区，继承都是一个非常有用的工具。

:::caution
需要注意的是，继承特性并不支持所有 SQL 标准功能（如外键约束），因此在设计数据库时需要谨慎使用。
:::

## 附加资源与练习

- **练习**：尝试创建一个 `animals` 表作为父表，然后创建 `dogs` 和 `cats` 表作为子表，分别存储狗和猫的信息。
- **进一步学习**：阅读 [PostgreSQL 官方文档](https://www.postgresql.org/docs/current/ddl-inherit.html) 以了解更多关于继承的高级用法。

通过本文的学习，你应该已经掌握了 PostgreSQL 继承的基本概念和应用场景。继续实践和探索，你将能够更好地利用这一特性来优化你的数据库设计。