---
title: PostgreSQL 条件函数
description: 了解如何使用PostgreSQL中的条件函数，包括CASE、COALESCE、NULLIF等，以及它们在查询中的实际应用。
---

# PostgreSQL 条件函数

在PostgreSQL中，条件函数允许我们根据特定条件执行不同的操作。这些函数在处理数据时非常有用，尤其是在需要根据某些条件返回不同结果的情况下。本文将介绍PostgreSQL中常用的条件函数，并通过示例展示它们的用法。

## 1. CASE 表达式

`CASE` 表达式是PostgreSQL中最常用的条件函数之一。它允许我们根据条件返回不同的值。`CASE` 表达式有两种形式：简单 `CASE` 和搜索 `CASE`。

### 简单 CASE 表达式

简单 `CASE` 表达式将一个表达式与多个值进行比较，并返回匹配的值。

```sql
SELECT 
    name,
    CASE grade
        WHEN 'A' THEN '优秀'
        WHEN 'B' THEN '良好'
        WHEN 'C' THEN '及格'
        ELSE '不及格'
    END AS result
FROM students;
```

**输入：**

| name  | grade |
|-------|-------|
| Alice | A     |
| Bob   | B     |
| Carol | C     |
| Dave  | D     |

**输出：**

| name  | result  |
|-------|---------|
| Alice | 优秀    |
| Bob   | 良好    |
| Carol | 及格    |
| Dave  | 不及格  |

### 搜索 CASE 表达式

搜索 `CASE` 表达式允许我们使用更复杂的条件。

```sql
SELECT 
    name,
    CASE 
        WHEN score >= 90 THEN '优秀'
        WHEN score >= 80 THEN '良好'
        WHEN score >= 60 THEN '及格'
        ELSE '不及格'
    END AS result
FROM students;
```

**输入：**

| name  | score |
|-------|-------|
| Alice | 95    |
| Bob   | 85    |
| Carol | 65    |
| Dave  | 50    |

**输出：**

| name  | result  |
|-------|---------|
| Alice | 优秀    |
| Bob   | 良好    |
| Carol | 及格    |
| Dave  | 不及格  |

## 2. COALESCE 函数

`COALESCE` 函数返回参数列表中的第一个非空值。如果所有参数都为 `NULL`，则返回 `NULL`。

```sql
SELECT 
    name,
    COALESCE(email, '无邮箱') AS email
FROM users;
```

**输入：**

| name  | email       |
|-------|-------------|
| Alice | alice@example.com |
| Bob   | NULL        |
| Carol | carol@example.com |

**输出：**

| name  | email               |
|-------|---------------------|
| Alice | alice@example.com   |
| Bob   | 无邮箱              |
| Carol | carol@example.com   |

## 3. NULLIF 函数

`NULLIF` 函数比较两个表达式，如果它们相等，则返回 `NULL`，否则返回第一个表达式的值。

```sql
SELECT 
    name,
    NULLIF(score, 0) AS score
FROM students;
```

**输入：**

| name  | score |
|-------|-------|
| Alice | 95    |
| Bob   | 0     |
| Carol | 65    |

**输出：**

| name  | score |
|-------|-------|
| Alice | 95    |
| Bob   | NULL  |
| Carol | 65    |

## 4. 实际应用场景

### 场景 1：处理缺失数据

假设我们有一个用户表，其中某些用户的邮箱信息缺失。我们可以使用 `COALESCE` 函数来提供一个默认值。

```sql
SELECT 
    name,
    COALESCE(email, '无邮箱') AS email
FROM users;
```

### 场景 2：条件评分

假设我们有一个学生成绩表，我们需要根据分数给出评级。

```sql
SELECT 
    name,
    CASE 
        WHEN score >= 90 THEN 'A'
        WHEN score >= 80 THEN 'B'
        WHEN score >= 70 THEN 'C'
        WHEN score >= 60 THEN 'D'
        ELSE 'F'
    END AS grade
FROM students;
```

## 5. 总结

PostgreSQL中的条件函数为我们提供了强大的工具来处理复杂的条件逻辑。通过 `CASE`、`COALESCE` 和 `NULLIF` 等函数，我们可以轻松地根据不同的条件返回不同的结果，处理缺失数据，以及避免不必要的错误。

## 6. 附加资源与练习

- **练习 1**：编写一个查询，使用 `CASE` 表达式将学生的分数转换为等级（A、B、C、D、F）。
- **练习 2**：使用 `COALESCE` 函数处理一个包含 `NULL` 值的列，并返回一个默认值。
- **练习 3**：使用 `NULLIF` 函数比较两个列，并在它们相等时返回 `NULL`。

通过练习这些条件函数，你将更好地理解它们在PostgreSQL中的应用场景和用法。