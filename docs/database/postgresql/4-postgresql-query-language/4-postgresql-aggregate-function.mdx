---
title: PostgreSQL 聚合函数
description: 了解 PostgreSQL 中的聚合函数，掌握如何使用它们对数据进行分组和汇总。本文适合初学者，包含详细的解释、代码示例和实际应用场景。
---

# PostgreSQL 聚合函数

在 PostgreSQL 中，聚合函数（Aggregate Functions）用于对一组值进行计算并返回单个结果。它们通常与 `GROUP BY` 子句一起使用，以便对数据进行分组和汇总。聚合函数是 SQL 查询中非常强大的工具，能够帮助我们快速分析和总结数据。

## 常见的聚合函数

PostgreSQL 提供了多种聚合函数，以下是一些最常用的：

- `COUNT()`：计算行数。
- `SUM()`：计算数值列的总和。
- `AVG()`：计算数值列的平均值。
- `MIN()`：查找列中的最小值。
- `MAX()`：查找列中的最大值。

### 1. `COUNT()` 函数

`COUNT()` 函数用于计算表中的行数。它可以用于计算所有行，或者满足特定条件的行。

```sql
SELECT COUNT(*) FROM employees;
```

**输出：**
```
 count
-------
   100
```

### 2. `SUM()` 函数

`SUM()` 函数用于计算数值列的总和。

```sql
SELECT SUM(salary) FROM employees;
```

**输出：**
```
   sum
--------
 500000
```

### 3. `AVG()` 函数

`AVG()` 函数用于计算数值列的平均值。

```sql
SELECT AVG(salary) FROM employees;
```

**输出：**
```
        avg
-------------------
 5000.000000000000
```

### 4. `MIN()` 和 `MAX()` 函数

`MIN()` 和 `MAX()` 函数分别用于查找列中的最小值和最大值。

```sql
SELECT MIN(salary), MAX(salary) FROM employees;
```

**输出：**
```
 min | max
-----+-----
 3000| 8000
```

## 使用 `GROUP BY` 进行分组

聚合函数通常与 `GROUP BY` 子句一起使用，以便对数据进行分组和汇总。例如，我们可以按部门计算员工的平均工资。

```sql
SELECT department, AVG(salary) 
FROM employees 
GROUP BY department;
```

**输出：**
```
 department |        avg
------------+-------------------
 Sales      | 4500.000000000000
 Engineering| 5500.000000000000
 HR         | 4000.000000000000
```

## 实际应用场景

假设我们有一个 `orders` 表，其中包含以下字段：`order_id`, `customer_id`, `order_date`, 和 `amount`。我们想要计算每个客户的总订单金额。

```sql
SELECT customer_id, SUM(amount) 
FROM orders 
GROUP BY customer_id;
```

**输出：**
```
 customer_id |   sum
-------------+--------
           1 |  1500
           2 |  2300
           3 |  1800
```

## 总结

PostgreSQL 的聚合函数是数据分析中不可或缺的工具。通过使用 `COUNT()`, `SUM()`, `AVG()`, `MIN()`, 和 `MAX()` 等函数，我们可以轻松地对数据进行汇总和分组。结合 `GROUP BY` 子句，聚合函数能够帮助我们快速生成有价值的统计信息。

:::tip
在实际应用中，聚合函数通常与 `WHERE` 子句结合使用，以便对特定条件下的数据进行汇总。
:::

## 附加资源

- [PostgreSQL 官方文档 - 聚合函数](https://www.postgresql.org/docs/current/functions-aggregate.html)
- 练习：尝试在 `orders` 表中计算每个客户的平均订单金额，并找出最高和最低的订单金额。

通过掌握这些聚合函数，你将能够更有效地分析和处理数据库中的数据。继续练习和探索，你会发现它们在数据处理中的强大之处！