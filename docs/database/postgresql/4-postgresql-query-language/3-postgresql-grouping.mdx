---
title: PostgreSQL 分组
description: 了解如何在PostgreSQL中使用GROUP BY子句对数据进行分组，并通过实际案例掌握其应用场景。
---

# PostgreSQL 分组

在PostgreSQL中，分组（Grouping）是一种强大的功能，允许我们根据一个或多个列对数据进行分组，并对每个组执行聚合操作。通过使用`GROUP BY`子句，我们可以将数据划分为多个组，并对每个组进行计算，例如求和、平均值、计数等。

## 什么是分组？

分组是将数据集按照某些列的值进行分类的过程。例如，假设我们有一个包含销售数据的表，我们可以按照“销售地区”对数据进行分组，然后计算每个地区的总销售额。分组通常与聚合函数（如`SUM`、`AVG`、`COUNT`等）一起使用，以便对每个组进行计算。

## 基本语法

`GROUP BY`子句的基本语法如下：

```sql
SELECT column1, column2, aggregate_function(column3)
FROM table_name
GROUP BY column1, column2;
```

- `column1`, `column2`：用于分组的列。
- `aggregate_function(column3)`：对每个组执行的聚合函数，例如`SUM(column3)`、`AVG(column3)`等。

## 示例：按地区分组计算总销售额

假设我们有一个名为`sales`的表，其中包含以下数据：

| id  | region  | amount |
|-----|---------|--------|
| 1   | North   | 100    |
| 2   | South   | 200    |
| 3   | North   | 150    |
| 4   | East    | 300    |
| 5   | South   | 250    |

我们可以使用`GROUP BY`子句按地区分组，并计算每个地区的总销售额：

```sql
SELECT region, SUM(amount) AS total_sales
FROM sales
GROUP BY region;
```

**输出结果：**

| region | total_sales |
|--------|-------------|
| North  | 250         |
| South  | 450         |
| East   | 300         |

在这个例子中，数据被按`region`列分组，并对每个组的`amount`列求和。

## 分组与聚合函数

分组通常与聚合函数一起使用。以下是一些常用的聚合函数：

- `SUM()`：计算组中某列的总和。
- `AVG()`：计算组中某列的平均值。
- `COUNT()`：计算组中的行数。
- `MIN()`：找到组中某列的最小值。
- `MAX()`：找到组中某列的最大值。

### 示例：计算每个地区的平均销售额

我们可以使用`AVG()`函数计算每个地区的平均销售额：

```sql
SELECT region, AVG(amount) AS average_sales
FROM sales
GROUP BY region;
```

**输出结果：**

| region | average_sales |
|--------|---------------|
| North  | 125           |
| South  | 225           |
| East   | 300           |

## 分组与`HAVING`子句

`HAVING`子句用于过滤分组后的结果。与`WHERE`子句不同，`HAVING`子句在分组之后应用，因此可以用于过滤聚合结果。

### 示例：筛选总销售额大于300的地区

```sql
SELECT region, SUM(amount) AS total_sales
FROM sales
GROUP BY region
HAVING SUM(amount) > 300;
```

**输出结果：**

| region | total_sales |
|--------|-------------|
| South  | 450         |

在这个例子中，只有总销售额大于300的地区被返回。

## 实际应用场景

### 场景1：电商平台的订单分析

假设你有一个电商平台，你需要分析每个用户的订单总金额。你可以使用`GROUP BY`按用户ID分组，并计算每个用户的总订单金额：

```sql
SELECT user_id, SUM(order_amount) AS total_spent
FROM orders
GROUP BY user_id;
```

### 场景2：学生成绩统计

假设你有一个学生成绩表，你需要计算每个班级的平均成绩。你可以按班级分组，并使用`AVG()`函数计算平均成绩：

```sql
SELECT class, AVG(score) AS average_score
FROM student_scores
GROUP BY class;
```

## 总结

`GROUP BY`是PostgreSQL中用于对数据进行分组的重要工具。通过分组，我们可以对数据集进行分类，并对每个组执行聚合操作。结合`HAVING`子句，我们可以进一步过滤分组后的结果，以满足特定的查询需求。

:::tip
在使用`GROUP BY`时，确保选择的分组列是唯一的，或者与聚合函数一起使用，以避免错误。
:::

## 附加资源与练习

1. **练习1**：创建一个包含员工信息的表，并计算每个部门的平均工资。
2. **练习2**：使用`HAVING`子句筛选出销售额超过1000的产品类别。
3. **进一步阅读**：PostgreSQL官方文档中的[GROUP BY](https://www.postgresql.org/docs/current/sql-select.html#SQL-GROUPBY)部分。

通过以上内容，你应该已经掌握了PostgreSQL中分组的基本概念和应用。继续练习并探索更多高级用法，以提升你的SQL技能！