---
title: 外连接(LEFT, RIGHT, FULL OUTER JOIN)
description: 了解 Hive 中的外连接（LEFT JOIN、RIGHT JOIN 和 FULL OUTER JOIN），掌握如何使用它们处理表连接，并通过实际案例加深理解。
---

在 Hive 中，表连接（JOIN）是处理多个表数据的重要操作之一。外连接（OUTER JOIN）是连接操作的一种，它允许我们在连接表时保留不匹配的行。本文将详细介绍三种常见的外连接：**LEFT JOIN**、**RIGHT JOIN** 和 **FULL OUTER JOIN**，并通过示例帮助你理解它们的用法。

## 什么是外连接？

外连接是一种表连接操作，它允许我们在连接两个表时保留不匹配的行。与内连接（INNER JOIN）不同，外连接会返回所有匹配的行以及至少一个表中不匹配的行。外连接分为三种类型：

1. **LEFT JOIN（左连接）**：返回左表的所有行，即使右表中没有匹配的行。
2. **RIGHT JOIN（右连接）**：返回右表的所有行，即使左表中没有匹配的行。
3. **FULL OUTER JOIN（全外连接）**：返回左表和右表的所有行，即使没有匹配的行。

:::tip
外连接的关键在于“保留不匹配的行”。如果你需要保留某个表中的所有数据，即使另一个表中没有匹配的数据，外连接就是你的选择。
:::

## LEFT JOIN（左连接）

LEFT JOIN 返回左表的所有行，即使右表中没有匹配的行。如果右表中没有匹配的行，结果中对应的列将显示为 `NULL`。

### 语法
```sql
SELECT 列名
FROM 左表
LEFT JOIN 右表
ON 左表.列名 = 右表.列名;
```

### 示例
假设我们有两个表：`employees` 和 `departments`。

**employees 表：**
| id  | name   | department_id |
|-----|--------|---------------|
| 1   | Alice  | 101           |
| 2   | Bob    | 102           |
| 3   | Charlie| 103           |
| 4   | David  | NULL          |

**departments 表：**
| id  | department_name |
|-----|-----------------|
| 101 | HR              |
| 102 | IT              |
| 104 | Finance         |

我们使用 LEFT JOIN 连接这两个表：
```sql
SELECT employees.name, departments.department_name
FROM employees
LEFT JOIN departments
ON employees.department_id = departments.id;
```

**输出结果：**
| name   | department_name |
|--------|-----------------|
| Alice  | HR              |
| Bob    | IT              |
| Charlie| NULL            |
| David  | NULL            |

:::note
注意，`Charlie` 和 `David` 的 `department_name` 为 `NULL`，因为 `departments` 表中没有与 `department_id` 103 和 `NULL` 匹配的行。
:::

## RIGHT JOIN（右连接）

RIGHT JOIN 返回右表的所有行，即使左表中没有匹配的行。如果左表中没有匹配的行，结果中对应的列将显示为 `NULL`。

### 语法
```sql
SELECT 列名
FROM 左表
RIGHT JOIN 右表
ON 左表.列名 = 右表.列名;
```

### 示例
继续使用 `employees` 和 `departments` 表，我们使用 RIGHT JOIN 连接这两个表：
```sql
SELECT employees.name, departments.department_name
FROM employees
RIGHT JOIN departments
ON employees.department_id = departments.id;
```

**输出结果：**
| name   | department_name |
|--------|-----------------|
| Alice  | HR              |
| Bob    | IT              |
| NULL   | Finance         |

:::note
注意，`Finance` 部门的 `name` 为 `NULL`，因为 `employees` 表中没有与 `department_id` 104 匹配的行。
:::

## FULL OUTER JOIN（全外连接）

FULL OUTER JOIN 返回左表和右表的所有行，即使没有匹配的行。如果某个表中没有匹配的行，结果中对应的列将显示为 `NULL`。

### 语法
```sql
SELECT 列名
FROM 左表
FULL OUTER JOIN 右表
ON 左表.列名 = 右表.列名;
```

### 示例
继续使用 `employees` 和 `departments` 表，我们使用 FULL OUTER JOIN 连接这两个表：
```sql
SELECT employees.name, departments.department_name
FROM employees
FULL OUTER JOIN departments
ON employees.department_id = departments.id;
```

**输出结果：**
| name   | department_name |
|--------|-----------------|
| Alice  | HR              |
| Bob    | IT              |
| Charlie| NULL            |
| David  | NULL            |
| NULL   | Finance         |

:::note
注意，`Charlie` 和 `David` 的 `department_name` 为 `NULL`，而 `Finance` 部门的 `name` 也为 `NULL`。FULL OUTER JOIN 保留了所有不匹配的行。
:::

## 实际应用场景

外连接在实际应用中非常有用，尤其是在处理数据不完整或需要保留所有记录的情况下。以下是一些常见的应用场景：

1. **员工与部门匹配**：在人力资源系统中，可能需要列出所有员工及其所属部门，即使某些员工没有分配部门或某些部门没有员工。
2. **订单与客户匹配**：在电商系统中，可能需要列出所有订单及其对应的客户，即使某些订单没有关联的客户或某些客户没有订单。
3. **数据分析**：在数据分析中，可能需要保留所有数据记录，即使某些记录没有匹配的数据，以便进行全面的分析。

## 总结

外连接（LEFT JOIN、RIGHT JOIN 和 FULL OUTER JOIN）是 Hive 中处理表连接的重要工具。它们允许我们在连接表时保留不匹配的行，从而确保数据的完整性。通过本文的讲解和示例，你应该已经掌握了外连接的基本概念和用法。

:::tip
如果你想进一步练习，可以尝试创建自己的表并使用不同的外连接操作来观察结果。这将帮助你更好地理解外连接的行为。
:::

## 附加资源

- [Hive 官方文档](https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Joins)
- [SQL JOIN 可视化工具](https://sql-joins.leopard.in.ua/)

祝你学习愉快！