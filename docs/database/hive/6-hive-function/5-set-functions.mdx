---
title: 集合函数
description: 了解 Hive 中的集合函数，掌握如何使用这些函数处理数组、映射和结构体等复杂数据类型。
---

# 集合函数

在 Hive 中，集合函数用于处理复杂数据类型，如数组（Array）、映射（Map）和结构体（Struct）。这些函数可以帮助你从集合中提取、转换或聚合数据。本文将详细介绍 Hive 中的集合函数，并通过示例展示它们的实际应用。

## 什么是集合函数？

集合函数是 Hive 提供的一组内置函数，用于操作复杂数据类型。这些数据类型包括：

- **数组（Array）**：一组有序的元素，元素可以是任何数据类型。
- **映射（Map）**：一组键值对，键和值可以是任何数据类型。
- **结构体（Struct）**：一组命名的字段，每个字段可以是任何数据类型。

集合函数可以帮助你从这些复杂数据类型中提取信息、进行转换或执行聚合操作。

## 常用的集合函数

### 1. `array_contains(array, value)`

`array_contains` 函数用于检查数组中是否包含指定的值。如果包含，则返回 `true`，否则返回 `false`。

**示例：**

```sql
SELECT array_contains(array(1, 2, 3), 2);
```

**输出：**

```
true
```

### 2. `map_keys(map)`

`map_keys` 函数返回映射中所有键的数组。

**示例：**

```sql
SELECT map_keys(map('a', 1, 'b', 2));
```

**输出：**

```
["a", "b"]
```

### 3. `map_values(map)`

`map_values` 函数返回映射中所有值的数组。

**示例：**

```sql
SELECT map_values(map('a', 1, 'b', 2));
```

**输出：**

```
[1, 2]
```

### 4. `size(array|map)`

`size` 函数返回数组或映射的大小。对于数组，返回元素的数量；对于映射，返回键值对的数量。

**示例：**

```sql
SELECT size(array(1, 2, 3));
```

**输出：**

```
3
```

### 5. `sort_array(array)`

`sort_array` 函数对数组中的元素进行升序排序。

**示例：**

```sql
SELECT sort_array(array(3, 1, 2));
```

**输出：**

```
[1, 2, 3]
```

### 6. `explode(array|map)`

`explode` 函数将数组或映射中的每个元素展开为单独的行。对于数组，每个元素成为一行；对于映射，每个键值对成为一行。

**示例：**

```sql
SELECT explode(array(1, 2, 3));
```

**输出：**

```
1
2
3
```

## 实际应用场景

### 场景 1：统计数组中元素的出现次数

假设你有一个包含用户兴趣爱好的表，每个用户的兴趣爱好存储在一个数组中。你可以使用 `explode` 函数将数组展开，然后使用 `GROUP BY` 统计每个兴趣爱好的出现次数。

**示例：**

```sql
SELECT interest, COUNT(*) AS count
FROM (
  SELECT explode(interests) AS interest
  FROM user_interests
) t
GROUP BY interest;
```

### 场景 2：提取映射中的键和值

假设你有一个包含用户属性的表，每个用户的属性存储在一个映射中。你可以使用 `map_keys` 和 `map_values` 函数提取映射中的键和值。

**示例：**

```sql
SELECT user_id, map_keys(attributes) AS keys, map_values(attributes) AS values
FROM user_attributes;
```

## 总结

集合函数是 Hive 中处理复杂数据类型的重要工具。通过掌握这些函数，你可以更高效地处理数组、映射和结构体等数据类型。本文介绍了常用的集合函数，并通过实际应用场景展示了它们的使用方法。

:::tip
建议你通过实际数据集练习这些函数，以加深对它们的理解。
:::

## 附加资源

- [Hive 官方文档](https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF)
- [Hive 函数参考](https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF)

:::note
如果你有任何问题或需要进一步的帮助，请访问我们的社区论坛或联系我们的支持团队。
:::