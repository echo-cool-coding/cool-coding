---
title: Hive 复杂数据类型
description: 了解Hive中的复杂数据类型，包括数组、映射和结构体，并通过实际案例掌握其使用方法。
---

# Hive 复杂数据类型

在Hive中，除了基本数据类型（如`INT`、`STRING`、`FLOAT`等），还支持复杂数据类型。这些复杂数据类型允许我们存储和处理更复杂的数据结构，如数组、映射和结构体。本文将详细介绍这些复杂数据类型，并通过实际案例帮助你理解它们的用法。

## 1. 数组（ARRAY）

数组是一种有序的元素集合，其中每个元素都具有相同的数据类型。在Hive中，数组可以存储多个值，并通过索引访问这些值。

### 1.1 定义数组

在Hive中，数组的定义方式如下：

```sql
ARRAY<data_type>
```

其中，`data_type`是数组中元素的数据类型，例如`INT`、`STRING`等。

### 1.2 示例

假设我们有一个表`students`，其中包含学生的姓名和他们所选的课程：

```sql
CREATE TABLE students (
    name STRING,
    courses ARRAY<STRING>
);
```

我们可以插入一些数据：

```sql
INSERT INTO students VALUES
('Alice', ARRAY('Math', 'Science', 'History')),
('Bob', ARRAY('English', 'Art'));
```

### 1.3 查询数组

我们可以使用`[]`来访问数组中的元素。例如，查询每个学生的第一门课程：

```sql
SELECT name, courses[0] AS first_course
FROM students;
```

输出结果：

| name  | first_course |
|-------|--------------|
| Alice | Math         |
| Bob   | English      |

:::tip
数组的索引从0开始，因此`courses[0]`表示数组中的第一个元素。
:::

## 2. 映射（MAP）

映射是一种键值对的集合，其中每个键都映射到一个值。在Hive中，映射可以存储多个键值对，并通过键访问对应的值。

### 2.1 定义映射

在Hive中，映射的定义方式如下：

```sql
MAP<key_type, value_type>
```

其中，`key_type`是键的数据类型，`value_type`是值的数据类型。

### 2.2 示例

假设我们有一个表`employee_skills`，其中包含员工的姓名和他们的技能等级：

```sql
CREATE TABLE employee_skills (
    name STRING,
    skills MAP<STRING, INT>
);
```

我们可以插入一些数据：

```sql
INSERT INTO employee_skills VALUES
('Alice', MAP('Java', 5, 'Python', 4)),
('Bob', MAP('SQL', 3, 'JavaScript', 2));
```

### 2.3 查询映射

我们可以使用`[]`来访问映射中的值。例如，查询每个员工的Java技能等级：

```sql
SELECT name, skills['Java'] AS java_skill_level
FROM employee_skills;
```

输出结果：

| name  | java_skill_level |
|-------|------------------|
| Alice | 5                |
| Bob   | NULL             |

:::caution
如果映射中不存在指定的键，查询结果将返回`NULL`。
:::

## 3. 结构体（STRUCT）

结构体是一种可以包含多个字段的复杂数据类型，每个字段都有自己的名称和数据类型。在Hive中，结构体可以用于将多个相关的字段组合在一起。

### 3.1 定义结构体

在Hive中，结构体的定义方式如下：

```sql
STRUCT<field_name1 : data_type1, field_name2 : data_type2, ...>
```

其中，`field_name`是字段的名称，`data_type`是字段的数据类型。

### 3.2 示例

假设我们有一个表`employee_details`，其中包含员工的姓名和他们的地址信息：

```sql
CREATE TABLE employee_details (
    name STRING,
    address STRUCT<street: STRING, city: STRING, zip: INT>
);
```

我们可以插入一些数据：

```sql
INSERT INTO employee_details VALUES
('Alice', STRUCT('123 Main St', 'New York', 10001)),
('Bob', STRUCT('456 Elm St', 'San Francisco', 94107));
```

### 3.3 查询结构体

我们可以使用`.`来访问结构体中的字段。例如，查询每个员工的城市：

```sql
SELECT name, address.city AS city
FROM employee_details;
```

输出结果：

| name  | city          |
|-------|---------------|
| Alice | New York      |
| Bob   | San Francisco |

:::note
结构体中的字段可以通过`.`操作符直接访问。
:::

## 4. 实际案例

假设我们有一个表`orders`，其中包含订单的详细信息，包括订单ID、客户ID、产品列表和订单总金额：

```sql
CREATE TABLE orders (
    order_id INT,
    customer_id INT,
    products ARRAY<STRUCT<product_name: STRING, quantity: INT, price: FLOAT>>,
    total_amount FLOAT
);
```

我们可以插入一些数据：

```sql
INSERT INTO orders VALUES
(1, 101, ARRAY(STRUCT('Laptop', 1, 1200.0), 1200.0),
(2, 102, ARRAY(STRUCT('Phone', 2, 800.0), STRUCT('Headphones', 1, 150.0)), 1750.0);
```

### 4.1 查询订单详情

我们可以查询每个订单的产品详情：

```sql
SELECT order_id, customer_id, 
       product.product_name, product.quantity, product.price
FROM orders
LATERAL VIEW explode(products) product_table AS product;
```

输出结果：

| order_id | customer_id | product_name | quantity | price |
|----------|-------------|--------------|----------|-------|
| 1        | 101         | Laptop       | 1        | 1200.0|
| 2        | 102         | Phone        | 2        | 800.0 |
| 2        | 102         | Headphones   | 1        | 150.0 |

:::warning
`LATERAL VIEW`和`explode`函数用于将数组中的元素展开为多行。
:::

## 5. 总结

Hive的复杂数据类型（数组、映射和结构体）为我们提供了强大的工具来处理和分析复杂的数据结构。通过本文的介绍和示例，你应该已经掌握了这些数据类型的基本用法。在实际应用中，灵活使用这些复杂数据类型可以大大简化数据处理过程。

## 6. 附加资源与练习

- **练习1**：创建一个包含数组、映射和结构体的表，并插入一些数据。然后编写查询语句，提取并分析这些数据。
- **练习2**：尝试使用`LATERAL VIEW`和`explode`函数处理嵌套的复杂数据类型。

:::tip
如果你对Hive的复杂数据类型还有疑问，可以参考[Hive官方文档](https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Types)以获取更多信息。
:::