---
title: UNION操作
description: "了解HiveQL中的UNION操作，掌握如何将多个查询结果合并为一个结果集。本文适合初学者，包含详细的解释、代码示例和实际应用场景。"
---

# UNION操作

在HiveQL中，`UNION`操作用于将两个或多个`SELECT`语句的结果集合并为一个结果集。`UNION`操作非常有用，尤其是在需要从多个表中提取数据并将它们组合在一起时。本文将详细介绍`UNION`操作的使用方法，并通过示例帮助你理解其实际应用。

## 什么是UNION操作？

`UNION`操作允许你将多个`SELECT`语句的结果集合并为一个结果集。每个`SELECT`语句的结果集必须具有相同的列数和数据类型。默认情况下，`UNION`会去除重复的行。如果你希望保留重复的行，可以使用`UNION ALL`。

### 语法

```sql
SELECT column1, column2, ...
FROM table1
UNION [ALL]
SELECT column1, column2, ...
FROM table2;
```

- `UNION`：合并结果集并去除重复行。
- `UNION ALL`：合并结果集并保留所有行，包括重复行。

## 使用UNION的步骤

1. **编写多个SELECT语句**：每个`SELECT`语句必须返回相同数量的列，并且列的数据类型必须兼容。
2. **使用UNION或UNION ALL**：根据是否需要去除重复行，选择使用`UNION`或`UNION ALL`。
3. **执行查询**：将多个`SELECT`语句的结果集合并为一个结果集。

## 代码示例

假设我们有两个表：`sales_2022`和`sales_2023`，它们分别存储了2022年和2023年的销售数据。我们希望将这两年的销售数据合并为一个结果集。

### 表结构

```sql
CREATE TABLE sales_2022 (
    product_id INT,
    sale_date STRING,
    amount DOUBLE
);

CREATE TABLE sales_2023 (
    product_id INT,
    sale_date STRING,
    amount DOUBLE
);
```

### 插入示例数据

```sql
INSERT INTO sales_2022 VALUES
(1, '2022-01-01', 100.0),
(2, '2022-02-01', 200.0),
(3, '2022-03-01', 300.0);

INSERT INTO sales_2023 VALUES
(1, '2023-01-01', 150.0),
(2, '2023-02-01', 250.0),
(4, '2023-03-01', 350.0);
```

### 使用UNION合并数据

```sql
SELECT product_id, sale_date, amount
FROM sales_2022
UNION
SELECT product_id, sale_date, amount
FROM sales_2023;
```

### 输出结果

| product_id | sale_date  | amount |
|------------|------------|--------|
| 1          | 2022-01-01 | 100.0  |
| 2          | 2022-02-01 | 200.0  |
| 3          | 2022-03-01 | 300.0  |
| 1          | 2023-01-01 | 150.0  |
| 2          | 2023-02-01 | 250.0  |
| 4          | 2023-03-01 | 350.0  |

:::note
注意：如果使用`UNION ALL`，结果集会包含所有行，包括重复的行。
:::

## 实际应用场景

### 场景1：合并多个时间段的数据

假设你有一个电商平台，需要分析过去几年的销售数据。你可以使用`UNION`操作将不同年份的销售数据合并，然后进行整体分析。

### 场景2：合并多个部门的数据

假设你有一个公司，每个部门的销售数据存储在不同的表中。你可以使用`UNION`操作将所有部门的销售数据合并，然后进行公司整体的销售分析。

## 总结

`UNION`操作是HiveQL中一个非常有用的工具，它允许你将多个`SELECT`语句的结果集合并为一个结果集。通过本文的学习，你应该已经掌握了`UNION`操作的基本用法，并了解了它在实际应用中的价值。

:::tip
提示：在使用`UNION`时，确保每个`SELECT`语句返回的列数和数据类型一致，以避免错误。
:::

## 附加资源与练习

1. **练习**：尝试在你的Hive环境中创建两个表，并使用`UNION`和`UNION ALL`操作合并它们的数据。
2. **进一步学习**：阅读Hive官方文档中关于`UNION`操作的更多细节，了解其在不同场景下的高级用法。

通过不断练习和探索，你将能够熟练使用`UNION`操作来处理复杂的数据合并任务。