---
title: CASE WHEN 表达式
description: 了解 HiveQL 中的 CASE WHEN 表达式，掌握如何使用它进行条件判断和数据转换。
---

# CASE WHEN 表达式

在 HiveQL 中，`CASE WHEN` 表达式是一种强大的工具，用于根据条件对数据进行判断和转换。它类似于其他编程语言中的 `if-else` 语句，但更适合在 SQL 查询中使用。通过 `CASE WHEN`，你可以根据不同的条件返回不同的值，从而简化复杂的数据处理逻辑。

## 基本语法

`CASE WHEN` 表达式的基本语法如下：

```sql
CASE
    WHEN condition1 THEN result1
    WHEN condition2 THEN result2
    ...
    ELSE default_result
END
```

- `condition1`, `condition2` 等是布尔表达式，用于判断是否满足条件。
- `result1`, `result2` 等是当对应条件为真时返回的结果。
- `ELSE` 子句是可选的，用于指定当所有条件都不满足时的默认返回值。
- `END` 表示 `CASE WHEN` 表达式的结束。

## 示例

假设我们有一个名为 `employees` 的表，其中包含员工的姓名和薪水信息。我们希望根据薪水范围将员工分类为“低收入”、“中等收入”和“高收入”。

```sql
SELECT
    name,
    salary,
    CASE
        WHEN salary < 3000 THEN '低收入'
        WHEN salary BETWEEN 3000 AND 7000 THEN '中等收入'
        ELSE '高收入'
    END AS income_level
FROM
    employees;
```

### 输入数据

| name   | salary |
|--------|--------|
| Alice  | 2500   |
| Bob    | 4500   |
| Charlie| 8000   |

### 输出结果

| name   | salary | income_level |
|--------|--------|--------------|
| Alice  | 2500   | 低收入       |
| Bob    | 4500   | 中等收入     |
| Charlie| 8000   | 高收入       |

## 实际应用场景

### 场景 1：数据分类

在数据分析中，我们经常需要根据某些条件对数据进行分类。例如，根据用户的购买金额将其分为“普通用户”、“VIP用户”和“超级VIP用户”。

```sql
SELECT
    user_id,
    total_purchase,
    CASE
        WHEN total_purchase < 1000 THEN '普通用户'
        WHEN total_purchase BETWEEN 1000 AND 5000 THEN 'VIP用户'
        ELSE '超级VIP用户'
    END AS user_level
FROM
    user_purchases;
```

### 场景 2：数据清洗

在数据清洗过程中，我们可能需要将某些异常值替换为默认值。例如，将负数的年龄替换为 `NULL`。

```sql
SELECT
    user_id,
    CASE
        WHEN age < 0 THEN NULL
        ELSE age
    END AS cleaned_age
FROM
    users;
```

## 总结

`CASE WHEN` 表达式是 HiveQL 中非常实用的工具，能够帮助我们根据条件对数据进行灵活的处理和转换。无论是数据分类、数据清洗，还是其他复杂的数据处理任务，`CASE WHEN` 都能提供简洁而强大的解决方案。

## 附加资源与练习

- **练习 1**：在 `employees` 表中，添加一列 `performance_level`，根据员工的薪水和工作年限进行分类。
- **练习 2**：在 `user_purchases` 表中，创建一个新的列 `discount_category`，根据用户的购买金额给予不同的折扣等级。

通过不断练习，你将能够熟练掌握 `CASE WHEN` 表达式，并在实际工作中灵活运用它。