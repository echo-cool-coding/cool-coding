---
title: HAVING子句
description: 了解如何在HiveQL中使用HAVING子句来过滤分组后的数据。本文适合初学者，包含详细的解释、代码示例和实际案例。
---

# HAVING子句

在HiveQL中，`HAVING`子句用于在`GROUP BY`之后对分组的结果进行过滤。它与`WHERE`子句类似，但`WHERE`子句用于过滤行，而`HAVING`子句用于过滤分组后的结果集。

## 介绍

`HAVING`子句通常与`GROUP BY`一起使用，用于对分组后的数据进行条件筛选。它的主要作用是过滤掉不符合条件的分组结果。与`WHERE`子句不同，`HAVING`子句可以包含聚合函数（如`SUM`、`COUNT`、`AVG`等），因为它作用于分组后的数据。

### 语法

```sql
SELECT column1, column2, ..., aggregate_function(column)
FROM table_name
GROUP BY column1, column2, ...
HAVING condition;
```

- `column1, column2, ...`：要选择的列。
- `aggregate_function(column)`：聚合函数，如`SUM`、`COUNT`、`AVG`等。
- `table_name`：要查询的表。
- `GROUP BY column1, column2, ...`：按指定列分组。
- `HAVING condition`：过滤分组后的结果。

## 代码示例

假设我们有一个销售数据表`sales`，包含以下列：`region`（地区）、`product`（产品）、`sales_amount`（销售额）。

### 示例1：过滤销售额总和大于1000的地区

```sql
SELECT region, SUM(sales_amount) AS total_sales
FROM sales
GROUP BY region
HAVING SUM(sales_amount) > 1000;
```

**输入数据：**

| region | product | sales_amount |
|--------|---------|--------------|
| North  | A       | 500          |
| North  | B       | 600          |
| South  | A       | 300          |
| South  | B       | 400          |
| East   | A       | 700          |
| East   | B       | 800          |

**输出结果：**

| region | total_sales |
|--------|-------------|
| North  | 1100        |
| East   | 1500        |

在这个例子中，`HAVING`子句过滤掉了`South`地区，因为它的总销售额为700，不满足`SUM(sales_amount) > 1000`的条件。

### 示例2：过滤产品数量大于1的地区

```sql
SELECT region, COUNT(product) AS product_count
FROM sales
GROUP BY region
HAVING COUNT(product) > 1;
```

**输出结果：**

| region | product_count |
|--------|---------------|
| North  | 2             |
| South  | 2             |
| East   | 2             |

在这个例子中，所有地区的产品数量都大于1，因此没有数据被过滤掉。

## 实际案例

### 案例1：电商平台销售分析

假设你在一家电商平台工作，需要分析每个地区的销售情况，找出销售额超过5000的地区。

```sql
SELECT region, SUM(sales_amount) AS total_sales
FROM sales
GROUP BY region
HAVING SUM(sales_amount) > 5000;
```

**输出结果：**

| region | total_sales |
|--------|-------------|
| North  | 5500        |
| East   | 6000        |

### 案例2：员工绩效评估

假设你有一个员工绩效表`employee_performance`，包含以下列：`department`（部门）、`employee_id`（员工ID）、`performance_score`（绩效分数）。你需要找出平均绩效分数高于80的部门。

```sql
SELECT department, AVG(performance_score) AS avg_score
FROM employee_performance
GROUP BY department
HAVING AVG(performance_score) > 80;
```

**输出结果：**

| department | avg_score |
|------------|-----------|
| HR         | 85        |
| IT         | 90        |

## 总结

`HAVING`子句是HiveQL中用于过滤分组后数据的重要工具。它允许你在`GROUP BY`之后对分组结果进行条件筛选，通常与聚合函数一起使用。通过本文的示例和案例，你应该能够理解如何在HiveQL中使用`HAVING`子句来处理分组数据。

## 附加资源

- [Hive官方文档](https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Select)
- [SQL HAVING子句教程](https://www.w3schools.com/sql/sql_having.asp)

## 练习

1. 编写一个HiveQL查询，找出销售额总和大于2000的地区。
2. 编写一个HiveQL查询，找出员工数量超过10人的部门。
3. 编写一个HiveQL查询，找出平均绩效分数低于60的部门。

通过完成这些练习，你将更好地掌握`HAVING`子句的使用。