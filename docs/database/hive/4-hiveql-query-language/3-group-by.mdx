---
title: GROUP BY 分组
description: 了解 HiveQL 中的 GROUP BY 分组操作，掌握如何使用它对数据进行分组聚合。
---

# GROUP BY 分组

在 HiveQL 中，`GROUP BY` 是一种用于对数据进行分组聚合的操作。它允许我们根据一个或多个列对数据进行分组，并对每个分组应用聚合函数（如 `COUNT`、`SUM`、`AVG` 等）。通过 `GROUP BY`，我们可以轻松地从大量数据中提取有用的汇总信息。

## 什么是 GROUP BY？

`GROUP BY` 是 SQL 和 HiveQL 中的一种关键操作，用于将数据按照指定的列进行分组。每个分组包含具有相同值的行，然后我们可以对这些分组应用聚合函数来计算汇总值。

例如，假设我们有一个销售数据表，其中包含产品名称、销售日期和销售金额。我们可以使用 `GROUP BY` 按产品名称分组，并计算每个产品的总销售额。

## 基本语法

`GROUP BY` 的基本语法如下：

```sql
SELECT column1, aggregate_function(column2)
FROM table_name
GROUP BY column1;
```

- `column1`：用于分组的列。
- `aggregate_function(column2)`：对分组后的数据应用的聚合函数，如 `COUNT`、`SUM`、`AVG` 等。
- `table_name`：要查询的表。

## 示例

假设我们有一个名为 `sales` 的表，结构如下：

| product_name | sale_date  | amount |
|--------------|------------|--------|
| Apple        | 2023-01-01 | 100    |
| Banana       | 2023-01-01 | 200    |
| Apple        | 2023-01-02 | 150    |
| Banana       | 2023-01-02 | 250    |

我们想要计算每个产品的总销售额。可以使用以下查询：

```sql
SELECT product_name, SUM(amount) AS total_sales
FROM sales
GROUP BY product_name;
```

### 输出结果

| product_name | total_sales |
|--------------|-------------|
| Apple        | 250         |
| Banana       | 450         |

在这个例子中，`GROUP BY` 将数据按 `product_name` 分组，然后对每个分组应用 `SUM` 函数，计算每个产品的总销售额。

## 多列分组

`GROUP BY` 也可以根据多个列进行分组。例如，如果我们想要按产品和销售日期分组，并计算每天的销售额，可以使用以下查询：

```sql
SELECT product_name, sale_date, SUM(amount) AS daily_sales
FROM sales
GROUP BY product_name, sale_date;
```

### 输出结果

| product_name | sale_date  | daily_sales |
|--------------|------------|-------------|
| Apple        | 2023-01-01 | 100         |
| Banana       | 2023-01-01 | 200         |
| Apple        | 2023-01-02 | 150         |
| Banana       | 2023-01-02 | 250         |

在这个例子中，数据首先按 `product_name` 分组，然后在每个产品组内按 `sale_date` 进一步分组。

## 实际应用场景

### 场景 1：计算每个地区的总销售额

假设我们有一个包含地区、销售日期和销售额的表 `regional_sales`。我们可以使用 `GROUP BY` 计算每个地区的总销售额：

```sql
SELECT region, SUM(sales_amount) AS total_sales
FROM regional_sales
GROUP BY region;
```

### 场景 2：计算每个月的平均销售额

如果我们想要计算每个月的平均销售额，可以使用以下查询：

```sql
SELECT MONTH(sale_date) AS sale_month, AVG(sales_amount) AS avg_sales
FROM regional_sales
GROUP BY MONTH(sale_date);
```

## 注意事项

:::caution
在使用 `GROUP BY` 时，SELECT 语句中的非聚合列必须包含在 `GROUP BY` 子句中，否则会导致错误。
:::

例如，以下查询是错误的，因为 `sale_date` 没有包含在 `GROUP BY` 子句中：

```sql
SELECT product_name, sale_date, SUM(amount) AS total_sales
FROM sales
GROUP BY product_name;
```

正确的查询应该是：

```sql
SELECT product_name, sale_date, SUM(amount) AS total_sales
FROM sales
GROUP BY product_name, sale_date;
```

## 总结

`GROUP BY` 是 HiveQL 中用于数据分组和聚合的强大工具。通过 `GROUP BY`，我们可以轻松地对数据进行分组，并应用各种聚合函数来提取有用的汇总信息。无论是计算总销售额、平均值还是其他统计指标，`GROUP BY` 都能帮助我们高效地完成任务。

## 附加资源与练习

- **练习 1**：创建一个包含学生姓名、科目和成绩的表，并使用 `GROUP BY` 计算每个学生的平均成绩。
- **练习 2**：在一个包含订单信息的表中，使用 `GROUP BY` 计算每个客户的订单总金额。

通过练习这些查询，你将更好地掌握 `GROUP BY` 的使用方法，并能够在实际项目中灵活应用。