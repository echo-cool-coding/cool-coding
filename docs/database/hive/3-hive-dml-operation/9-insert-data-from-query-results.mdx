---
title: 从查询结果插入数据
description: 学习如何在 Hive 中使用 DML 操作将查询结果插入到表中。本文适合初学者，包含详细的解释、代码示例和实际应用场景。
---

## 介绍

在 Hive 中，数据操作语言（DML）允许我们对表中的数据进行操作。其中，**从查询结果插入数据**是一种常见的操作，它允许我们将一个查询的结果直接插入到另一个表中。这种方式非常适合在数据转换、数据迁移或数据聚合的场景中使用。

本文将逐步讲解如何在 Hive 中执行这一操作，并通过代码示例和实际案例帮助你更好地理解。

## 基本语法

在 Hive 中，可以使用 `INSERT INTO` 或 `INSERT OVERWRITE` 语句将查询结果插入到目标表中。两者的区别在于：

- `INSERT INTO`：将查询结果追加到目标表中，不会影响表中已有的数据。
- `INSERT OVERWRITE`：将查询结果覆盖到目标表中，目标表中已有的数据会被删除。

以下是基本语法：

```sql
INSERT INTO|OVERWRITE TABLE target_table
SELECT column1, column2, ...
FROM source_table
WHERE condition;
```

### 示例 1：使用 `INSERT INTO` 追加数据

假设我们有一个表 `source_table`，其中包含以下数据：

| id  | name  | age |
|-----|-------|-----|
| 1   | Alice | 25  |
| 2   | Bob   | 30  |
| 3   | Carol | 22  |

我们想将这些数据插入到另一个表 `target_table` 中。可以使用以下语句：

```sql
INSERT INTO TABLE target_table
SELECT id, name, age
FROM source_table;
```

执行后，`target_table` 将包含与 `source_table` 相同的数据。

### 示例 2：使用 `INSERT OVERWRITE` 覆盖数据

如果我们希望覆盖 `target_table` 中的数据，可以使用 `INSERT OVERWRITE`：

```sql
INSERT OVERWRITE TABLE target_table
SELECT id, name, age
FROM source_table;
```

执行后，`target_table` 中原有的数据将被删除，并被 `source_table` 中的数据替换。

## 实际应用场景

### 场景 1：数据聚合

假设我们有一个销售数据表 `sales`，其中包含以下字段：

- `order_id`：订单 ID
- `product_id`：产品 ID
- `quantity`：销售数量
- `sale_date`：销售日期

我们希望将每天的销售总量插入到一个新的表 `daily_sales` 中。可以使用以下查询：

```sql
INSERT INTO TABLE daily_sales
SELECT sale_date, SUM(quantity) AS total_quantity
FROM sales
GROUP BY sale_date;
```

执行后，`daily_sales` 表将包含每天的销售总量。

### 场景 2：数据迁移

假设我们需要将 `old_table` 中的数据迁移到 `new_table` 中，并且只迁移满足特定条件的数据。可以使用以下查询：

```sql
INSERT INTO TABLE new_table
SELECT *
FROM old_table
WHERE age > 25;
```

执行后，`new_table` 中将只包含 `old_table` 中 `age` 大于 25 的记录。

## 总结

通过本文，我们学习了如何在 Hive 中使用 `INSERT INTO` 和 `INSERT OVERWRITE` 语句将查询结果插入到目标表中。这些操作在数据聚合、数据迁移等场景中非常有用。

:::tip 提示
- 使用 `INSERT INTO` 时，目标表必须已经存在。
- 使用 `INSERT OVERWRITE` 时，目标表中的数据将被完全覆盖，请谨慎操作。
:::

## 附加资源与练习

为了巩固所学知识，建议你尝试以下练习：

1. 创建一个包含学生信息的表 `students`，并插入一些数据。
2. 使用 `INSERT INTO` 将 `students` 中的数据插入到另一个表 `graduated_students` 中。
3. 使用 `INSERT OVERWRITE` 将 `graduated_students` 中的数据替换为 `students` 中年龄大于 20 的记录。

通过实践，你将更好地掌握 Hive 中的 DML 操作。祝你学习愉快！