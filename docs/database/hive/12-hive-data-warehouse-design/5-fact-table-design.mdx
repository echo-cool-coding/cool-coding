---
title: 事实表设计
description: 了解Hive数据仓库中的事实表设计，掌握其核心概念、设计原则及实际应用场景。
---

# 事实表设计

在数据仓库中，**事实表**是存储业务过程度量数据的核心表。它通常包含数值型数据（如销售额、数量等），并与**维度表**关联，用于支持复杂的分析和查询。本文将详细介绍事实表的设计原则、类型以及实际应用场景，帮助你掌握这一关键概念。

## 什么是事实表？

事实表是数据仓库中用于存储业务过程度量数据的表。它通常包含以下两类数据：
1. **度量值**：数值型数据，如销售额、数量、利润等。
2. **外键**：用于关联维度表的外键，如产品ID、时间ID、客户ID等。

事实表的设计直接影响数据仓库的性能和查询效率，因此理解其设计原则至关重要。

---

## 事实表的类型

根据业务需求和数据粒度，事实表可以分为以下几种类型：

### 1. 事务事实表
事务事实表记录业务过程中发生的每个事务。例如，每次销售交易都会在表中生成一条记录。

```sql
CREATE TABLE sales_fact (
    transaction_id INT,
    product_id INT,
    customer_id INT,
    date_id INT,
    quantity INT,
    amount DECIMAL(10, 2)
);
```

### 2. 快照事实表
快照事实表记录某一时间点的状态。例如，每日库存快照。

```sql
CREATE TABLE inventory_snapshot (
    product_id INT,
    date_id INT,
    stock_quantity INT
);
```

### 3. 累积事实表
累积事实表记录一段时间内的累积数据。例如，每月销售累积。

```sql
CREATE TABLE monthly_sales_fact (
    product_id INT,
    month_id INT,
    total_quantity INT,
    total_amount DECIMAL(10, 2)
);
```

---

## 事实表的设计原则

设计事实表时，需遵循以下原则：

### 1. 选择适当的粒度
**粒度**是指事实表中每条记录所代表的业务细节级别。例如，是按天、按小时，还是按每笔交易记录数据？粒度越细，数据量越大，但分析能力也越强。

:::tip
在设计事实表时，尽量选择最细的粒度，以便支持更灵活的分析。
:::

### 2. 使用外键关联维度表
事实表通过外键与维度表关联。例如，`product_id` 关联产品维度表，`date_id` 关联时间维度表。

```sql
CREATE TABLE sales_fact (
    transaction_id INT,
    product_id INT,  -- 外键，关联产品维度表
    customer_id INT, -- 外键，关联客户维度表
    date_id INT,     -- 外键，关联时间维度表
    quantity INT,
    amount DECIMAL(10, 2)
);
```

### 3. 避免冗余数据
事实表应只存储度量值和外键，避免存储描述性信息（如产品名称、客户姓名等），这些信息应存储在维度表中。

---

## 实际案例：电商销售事实表设计

假设我们正在为一个电商平台设计数据仓库，以下是销售事实表的设计示例：

### 1. 确定粒度
每条记录代表一笔交易。

### 2. 定义度量值和外键
- 度量值：`quantity`（购买数量）、`amount`（交易金额）
- 外键：`product_id`、`customer_id`、`date_id`

### 3. 创建事实表
```sql
CREATE TABLE sales_fact (
    transaction_id INT,
    product_id INT,
    customer_id INT,
    date_id INT,
    quantity INT,
    amount DECIMAL(10, 2)
);
```

### 4. 关联维度表
```sql
SELECT 
    sf.transaction_id,
    p.product_name,
    c.customer_name,
    d.date,
    sf.quantity,
    sf.amount
FROM 
    sales_fact sf
JOIN 
    product_dim p ON sf.product_id = p.product_id
JOIN 
    customer_dim c ON sf.customer_id = c.customer_id
JOIN 
    date_dim d ON sf.date_id = d.date_id;
```

---

## 总结

事实表是数据仓库的核心组件，用于存储业务过程的度量数据。设计事实表时，需注意以下几点：
1. 选择适当的粒度。
2. 使用外键关联维度表。
3. 避免冗余数据。

通过合理设计事实表，可以显著提高数据仓库的性能和分析能力。

---

## 附加资源与练习

### 资源
- [Hive官方文档](https://hive.apache.org/)
- 《数据仓库工具箱》：深入讲解事实表和维度表设计。

### 练习
1. 为一个在线教育平台设计一个学习记录事实表，记录学生的学习时长和完成课程数。
2. 尝试创建一个快照事实表，记录每日的用户活跃状态。

:::note
如果你有任何问题或需要进一步的帮助，请随时在评论区留言！
:::