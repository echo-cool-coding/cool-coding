---
title: SQL 内置函数
description: 了解SQL内置函数的基本概念、常见类型及其在实际查询中的应用。本文适合初学者，包含代码示例和实际案例。
---

# SQL 内置函数

SQL（结构化查询语言）是用于管理和操作关系型数据库的标准语言。SQL内置函数是SQL语言中预定义的函数，用于执行各种操作，例如数据计算、字符串处理、日期操作等。这些函数可以帮助我们更高效地处理数据，减少手动编写复杂逻辑的需求。

## 什么是SQL内置函数？

SQL内置函数是数据库系统提供的函数，可以直接在SQL查询中使用。它们通常分为以下几类：

1. **聚合函数**：用于对一组值进行计算并返回单个值，例如 `SUM()`、`AVG()`、`COUNT()` 等。
2. **标量函数**：对单个值进行操作并返回单个值，例如 `UPPER()`、`LOWER()`、`ROUND()` 等。
3. **日期和时间函数**：用于处理日期和时间数据，例如 `NOW()`、`DATE()`、`DATEDIFF()` 等。
4. **字符串函数**：用于处理字符串数据，例如 `CONCAT()`、`SUBSTRING()`、`LENGTH()` 等。

## 常见SQL内置函数

### 1. 聚合函数

聚合函数用于对一组值进行计算并返回单个值。以下是一些常见的聚合函数：

- `SUM()`：计算一组值的总和。
- `AVG()`：计算一组值的平均值。
- `COUNT()`：计算一组值的数量。
- `MIN()`：返回一组值中的最小值。
- `MAX()`：返回一组值中的最大值。

#### 示例

假设我们有一个名为 `sales` 的表，其中包含以下数据：

| id  | product | amount |
|-----|---------|--------|
| 1   | A       | 100    |
| 2   | B       | 200    |
| 3   | A       | 150    |
| 4   | C       | 300    |

我们可以使用聚合函数来计算总销售额、平均销售额等：

```sql
SELECT 
    SUM(amount) AS total_sales,
    AVG(amount) AS average_sales,
    COUNT(*) AS total_orders,
    MIN(amount) AS min_sale,
    MAX(amount) AS max_sale
FROM sales;
```

**输出：**

| total_sales | average_sales | total_orders | min_sale | max_sale |
|-------------|---------------|--------------|----------|----------|
| 750         | 187.5         | 4            | 100      | 300      |

### 2. 标量函数

标量函数对单个值进行操作并返回单个值。以下是一些常见的标量函数：

- `UPPER()`：将字符串转换为大写。
- `LOWER()`：将字符串转换为小写。
- `ROUND()`：将数值四舍五入到指定的小数位数。
- `ABS()`：返回数值的绝对值。

#### 示例

假设我们有一个名为 `employees` 的表，其中包含以下数据：

| id  | name   | salary |
|-----|--------|--------|
| 1   | Alice  | 50000  |
| 2   | Bob    | 60000  |
| 3   | Charlie| 55000  |

我们可以使用标量函数来处理数据：

```sql
SELECT 
    UPPER(name) AS name_upper,
    LOWER(name) AS name_lower,
    ROUND(salary / 12, 2) AS monthly_salary
FROM employees;
```

**输出：**

| name_upper | name_lower | monthly_salary |
|------------|------------|----------------|
| ALICE      | alice      | 4166.67        |
| BOB        | bob        | 5000.00        |
| CHARLIE    | charlie    | 4583.33        |

### 3. 日期和时间函数

日期和时间函数用于处理日期和时间数据。以下是一些常见的日期和时间函数：

- `NOW()`：返回当前日期和时间。
- `DATE()`：提取日期部分。
- `DATEDIFF()`：计算两个日期之间的差异。
- `DATE_ADD()`：在日期上添加指定的时间间隔。

#### 示例

假设我们有一个名为 `orders` 的表，其中包含以下数据：

| id  | order_date  | delivery_date |
|-----|-------------|---------------|
| 1   | 2023-01-01  | 2023-01-05    |
| 2   | 2023-02-01  | 2023-02-10    |
| 3   | 2023-03-01  | 2023-03-15    |

我们可以使用日期函数来计算订单的处理时间：

```sql
SELECT 
    order_date,
    delivery_date,
    DATEDIFF(delivery_date, order_date) AS processing_days
FROM orders;
```

**输出：**

| order_date | delivery_date | processing_days |
|------------|---------------|-----------------|
| 2023-01-01 | 2023-01-05    | 4               |
| 2023-02-01 | 2023-02-10    | 9               |
| 2023-03-01 | 2023-03-15    | 14              |

### 4. 字符串函数

字符串函数用于处理字符串数据。以下是一些常见的字符串函数：

- `CONCAT()`：连接两个或多个字符串。
- `SUBSTRING()`：提取字符串的一部分。
- `LENGTH()`：返回字符串的长度。
- `REPLACE()`：替换字符串中的子字符串。

#### 示例

假设我们有一个名为 `customers` 的表，其中包含以下数据：

| id  | first_name | last_name |
|-----|------------|-----------|
| 1   | John       | Doe       |
| 2   | Jane       | Smith     |
| 3   | Alice      | Johnson   |

我们可以使用字符串函数来处理数据：

```sql
SELECT 
    CONCAT(first_name, ' ', last_name) AS full_name,
    SUBSTRING(first_name, 1, 1) AS initial,
    LENGTH(last_name) AS last_name_length
FROM customers;
```

**输出：**

| full_name    | initial | last_name_length |
|--------------|---------|------------------|
| John Doe     | J       | 3                |
| Jane Smith   | J       | 5                |
| Alice Johnson| A       | 7                |

## 实际案例

### 案例1：计算员工的总工资和平均工资

假设我们有一个名为 `employees` 的表，其中包含员工的工资信息。我们可以使用聚合函数来计算总工资和平均工资：

```sql
SELECT 
    SUM(salary) AS total_salary,
    AVG(salary) AS average_salary
FROM employees;
```

### 案例2：格式化员工姓名

我们可以使用字符串函数来格式化员工的姓名，例如将姓名转换为大写并连接起来：

```sql
SELECT 
    UPPER(CONCAT(first_name, ' ', last_name)) AS formatted_name
FROM employees;
```

### 案例3：计算订单的处理时间

假设我们有一个名为 `orders` 的表，其中包含订单的日期和交付日期。我们可以使用日期函数来计算每个订单的处理时间：

```sql
SELECT 
    order_date,
    delivery_date,
    DATEDIFF(delivery_date, order_date) AS processing_days
FROM orders;
```

## 总结

SQL内置函数是SQL语言中非常强大的工具，可以帮助我们更高效地处理数据。通过使用聚合函数、标量函数、日期和时间函数以及字符串函数，我们可以轻松地执行各种数据操作。掌握这些函数的使用方法，将大大提高我们在数据库查询中的效率和灵活性。

## 附加资源

- [SQL官方文档](https://www.w3schools.com/sql/)
- [SQL函数参考](https://dev.mysql.com/doc/refman/8.0/en/functions.html)
- [SQL练习平台](https://sqlzoo.net/)

:::tip
建议初学者通过实际练习来巩固所学的SQL函数知识。可以尝试在数据库管理系统中创建一些简单的表，并使用这些函数进行查询和操作。
:::