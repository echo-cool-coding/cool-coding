---
title: SQL 表达式排序
description: 学习如何使用SQL表达式对查询结果进行排序，掌握ORDER BY子句的高级用法，包括使用表达式、函数和条件排序。
---

# SQL 表达式排序

在SQL中，排序是数据查询中非常常见的操作。我们通常使用`ORDER BY`子句对查询结果进行排序。默认情况下，`ORDER BY`会根据指定的列进行升序或降序排列。然而，SQL还允许我们使用**表达式**来进行更复杂的排序操作。本文将详细介绍如何使用SQL表达式进行排序，并通过实际案例帮助你理解其应用场景。

## 什么是SQL表达式排序？

SQL表达式排序是指在`ORDER BY`子句中使用表达式（如算术运算、函数调用、条件判断等）来决定排序顺序。与简单的列排序不同，表达式排序可以根据计算结果动态调整排序规则，从而实现更灵活的排序需求。

### 基本语法

```sql
SELECT column1, column2, ...
FROM table_name
ORDER BY expression [ASC|DESC];
```

- `expression`：可以是列名、算术表达式、函数调用或条件表达式。
- `ASC`：升序排列（默认）。
- `DESC`：降序排列。

## 使用算术表达式排序

假设我们有一个`products`表，其中包含产品的名称、价格和库存数量。我们希望根据产品的总价值（价格 × 库存）对产品进行排序。

```sql
SELECT name, price, stock
FROM products
ORDER BY price * stock DESC;
```

### 输入数据

| name       | price | stock |
|------------|-------|-------|
| Product A  | 10    | 100   |
| Product B  | 15    | 50    |
| Product C  | 20    | 30    |

### 输出结果

| name       | price | stock |
|------------|-------|-------|
| Product A  | 10    | 100   |
| Product B  | 15    | 50    |
| Product C  | 20    | 30    |

在这个例子中，`price * stock`计算了每个产品的总价值，并根据该值进行降序排列。

## 使用函数排序

SQL提供了许多内置函数，可以在`ORDER BY`子句中使用。例如，我们可以使用`LENGTH()`函数根据字符串的长度进行排序。

```sql
SELECT name
FROM products
ORDER BY LENGTH(name) ASC;
```

### 输入数据

| name       |
|------------|
| Product A  |
| Product B  |
| Product C  |

### 输出结果

| name       |
|------------|
| Product A  |
| Product B  |
| Product C  |

在这个例子中，`LENGTH(name)`计算了每个产品名称的长度，并根据长度进行升序排列。

## 使用条件表达式排序

有时我们需要根据某些条件对数据进行排序。例如，我们希望将库存低于50的产品排在前面，然后再按价格排序。

```sql
SELECT name, price, stock
FROM products
ORDER BY 
    CASE 
        WHEN stock < 50 THEN 1 
        ELSE 0 
    END,
    price ASC;
```

### 输入数据

| name       | price | stock |
|------------|-------|-------|
| Product A  | 10    | 100   |
| Product B  | 15    | 50    |
| Product C  | 20    | 30    |

### 输出结果

| name       | price | stock |
|------------|-------|-------|
| Product C  | 20    | 30    |
| Product B  | 15    | 50    |
| Product A  | 10    | 100   |

在这个例子中，`CASE`表达式用于判断库存是否低于50，并根据条件进行排序。

## 实际应用场景

### 场景1：动态排序

假设我们有一个`employees`表，其中包含员工的姓名、工资和奖金。我们希望根据员工的总收入（工资 + 奖金）进行排序，但如果有员工的奖金为NULL，则将其视为0。

```sql
SELECT name, salary, bonus
FROM employees
ORDER BY salary + COALESCE(bonus, 0) DESC;
```

### 场景2：多条件排序

在一个`orders`表中，我们希望先根据订单状态排序（未处理 > 处理中 > 已完成），然后再根据订单金额排序。

```sql
SELECT order_id, status, amount
FROM orders
ORDER BY 
    CASE 
        WHEN status = '未处理' THEN 1
        WHEN status = '处理中' THEN 2
        WHEN status = '已完成' THEN 3
    END,
    amount DESC;
```

## 总结

SQL表达式排序为我们提供了强大的灵活性，可以根据复杂的逻辑对数据进行排序。无论是使用算术表达式、函数还是条件表达式，我们都可以轻松实现各种排序需求。掌握这些技巧将帮助你在实际工作中更高效地处理数据。

## 附加资源与练习

- **练习1**：在一个`sales`表中，根据销售额（`quantity * price`）对销售记录进行排序，并显示前10条记录。
- **练习2**：在一个`students`表中，根据学生的年龄和成绩进行排序，年龄小的优先，如果年龄相同则按成绩降序排列。

:::tip
如果你对SQL表达式排序还有疑问，建议多尝试不同的表达式和排序条件，通过实践来加深理解。
:::