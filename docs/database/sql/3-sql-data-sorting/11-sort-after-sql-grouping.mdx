---
title: SQL 分组后排序
description: 学习如何在SQL中对分组后的数据进行排序，掌握GROUP BY和ORDER BY的结合使用，提升数据处理能力。
---

# SQL 分组后排序

在SQL中，分组（GROUP BY）和排序（ORDER BY）是两个非常常用的操作。分组用于将数据按照某些列的值进行分类，而排序则用于对数据进行有序排列。在某些情况下，我们需要在分组后对数据进行排序，以便更好地分析和展示数据。本文将详细介绍如何在SQL中实现分组后排序。

## 1. 基本概念

### 1.1 GROUP BY
`GROUP BY` 子句用于将结果集按照一个或多个列进行分组。通常与聚合函数（如 `COUNT`、`SUM`、`AVG` 等）一起使用，以便对每个分组进行计算。

### 1.2 ORDER BY
`ORDER BY` 子句用于对结果集按照一个或多个列进行排序。默认情况下，排序是升序（ASC），但也可以通过指定 `DESC` 来进行降序排序。

### 1.3 分组后排序
分组后排序是指在 `GROUP BY` 分组的基础上，对分组后的结果进行排序。这通常涉及到在 `GROUP BY` 之后使用 `ORDER BY` 来对分组后的数据进行排序。

## 2. 基本语法

```sql
SELECT column1, column2, aggregate_function(column3)
FROM table_name
GROUP BY column1, column2
ORDER BY column1 ASC|DESC, column2 ASC|DESC;
```

- `column1`, `column2`: 用于分组的列。
- `aggregate_function(column3)`: 对分组后的数据进行聚合计算的函数。
- `ORDER BY`: 用于对分组后的结果进行排序。

## 3. 示例

假设我们有一个名为 `sales` 的表，记录了不同销售员的销售数据：

```sql
CREATE TABLE sales (
    salesperson VARCHAR(50),
    region VARCHAR(50),
    amount DECIMAL(10, 2)
);

INSERT INTO sales (salesperson, region, amount) VALUES
('Alice', 'North', 1000.00),
('Bob', 'South', 1500.00),
('Alice', 'North', 2000.00),
('Bob', 'South', 2500.00),
('Charlie', 'North', 3000.00),
('Charlie', 'North', 3500.00);
```

### 3.1 按销售员分组并计算总销售额

```sql
SELECT salesperson, SUM(amount) AS total_sales
FROM sales
GROUP BY salesperson;
```

**输出：**

| salesperson | total_sales |
|-------------|-------------|
| Alice       | 3000.00     |
| Bob         | 4000.00     |
| Charlie     | 6500.00     |

### 3.2 按销售员分组并按总销售额降序排序

```sql
SELECT salesperson, SUM(amount) AS total_sales
FROM sales
GROUP BY salesperson
ORDER BY total_sales DESC;
```

**输出：**

| salesperson | total_sales |
|-------------|-------------|
| Charlie     | 6500.00     |
| Bob         | 4000.00     |
| Alice       | 3000.00     |

### 3.3 按地区和销售员分组并按总销售额降序排序

```sql
SELECT region, salesperson, SUM(amount) AS total_sales
FROM sales
GROUP BY region, salesperson
ORDER BY region, total_sales DESC;
```

**输出：**

| region | salesperson | total_sales |
|--------|-------------|-------------|
| North  | Charlie     | 6500.00     |
| North  | Alice       | 3000.00     |
| South  | Bob         | 4000.00     |

## 4. 实际应用场景

### 4.1 销售数据分析
在销售数据分析中，我们经常需要按地区或销售员分组，并计算总销售额。然后，我们可以按总销售额进行排序，以便找出表现最好的地区或销售员。

### 4.2 学生成绩统计
在学生成绩统计中，我们可以按班级分组，并计算每个班级的平均成绩。然后，我们可以按平均成绩进行排序，以便找出表现最好的班级。

## 5. 总结

在SQL中，分组后排序是一个非常实用的功能，可以帮助我们更好地分析和展示数据。通过结合 `GROUP BY` 和 `ORDER BY`，我们可以轻松地对分组后的数据进行排序，从而得到更有价值的信息。

## 6. 附加资源与练习

### 6.1 附加资源
- [SQL GROUP BY 文档](https://www.w3schools.com/sql/sql_groupby.asp)
- [SQL ORDER BY 文档](https://www.w3schools.com/sql/sql_orderby.asp)

### 6.2 练习
1. 在 `sales` 表中，按地区分组并计算每个地区的总销售额，然后按总销售额降序排序。
2. 在 `sales` 表中，按销售员分组并计算每个销售员的平均销售额，然后按平均销售额升序排序。

:::tip
在编写SQL查询时，确保理解每个子句的作用，并逐步构建查询，以避免错误。
:::