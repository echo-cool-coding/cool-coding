---
title: SQL JSON 操作
description: 学习如何在 SQL 中使用 JSON 数据类型，掌握 JSON 数据的存储、查询和操作技巧。
---

## 介绍

在现代应用程序中，JSON（JavaScript Object Notation）已经成为一种非常流行的数据交换格式。它轻量、易读，并且与多种编程语言兼容。SQL 数据库也支持 JSON 数据类型，允许你在关系型数据库中存储和操作 JSON 数据。本文将带你了解 SQL 中的 JSON 操作，包括如何存储、查询和修改 JSON 数据。

## JSON 数据类型

在 SQL 中，JSON 数据类型允许你存储 JSON 格式的数据。JSON 数据可以是一个对象、数组、字符串、数字、布尔值或 `null`。SQL 提供了多种函数和操作符来处理 JSON 数据。

### 创建包含 JSON 列的表

首先，我们创建一个包含 JSON 列的表：

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    profile JSONB
);
```

在这个例子中，`profile` 列的数据类型是 `JSONB`，它是 PostgreSQL 中的一种二进制 JSON 格式，支持高效的查询和索引。

### 插入 JSON 数据

接下来，我们向表中插入一些 JSON 数据：

```sql
INSERT INTO users (name, profile)
VALUES 
    ('Alice', '{"age": 30, "email": "alice@example.com", "hobbies": ["reading", "hiking"]}'),
    ('Bob', '{"age": 25, "email": "bob@example.com", "hobbies": ["gaming", "cooking"]}');
```

## 查询 JSON 数据

SQL 提供了多种操作符和函数来查询 JSON 数据。

### 访问 JSON 字段

你可以使用 `->` 操作符来访问 JSON 对象中的字段：

```sql
SELECT name, profile->'email' AS email
FROM users;
```

输出结果：

| name  | email               |
|-------|---------------------|
| Alice | "alice@example.com" |
| Bob   | "bob@example.com"   |

### 访问 JSON 数组元素

你可以使用 `->>` 操作符来访问 JSON 数组中的元素：

```sql
SELECT name, profile->'hobbies'->>0 AS first_hobby
FROM users;
```

输出结果：

| name  | first_hobby |
|-------|-------------|
| Alice | reading     |
| Bob   | gaming      |

### 使用 JSON 函数

SQL 还提供了一些内置函数来处理 JSON 数据。例如，`jsonb_each` 函数可以将 JSON 对象转换为键值对：

```sql
SELECT name, jsonb_each(profile)
FROM users;
```

输出结果：

| name  | key   | value                     |
|-------|-------|---------------------------|
| Alice | age   | 30                        |
| Alice | email | "alice@example.com"       |
| Alice | hobbies | ["reading", "hiking"]   |
| Bob   | age   | 25                        |
| Bob   | email | "bob@example.com"         |
| Bob   | hobbies | ["gaming", "cooking"]   |

## 修改 JSON 数据

你可以使用 SQL 的 `UPDATE` 语句来修改 JSON 数据。

### 更新 JSON 字段

假设我们想更新 Alice 的年龄：

```sql
UPDATE users
SET profile = jsonb_set(profile, '{age}', '31')
WHERE name = 'Alice';
```

### 添加新的 JSON 字段

我们还可以向 JSON 对象中添加新的字段：

```sql
UPDATE users
SET profile = jsonb_set(profile, '{city}', '"New York"')
WHERE name = 'Alice';
```

## 实际应用场景

### 存储用户配置文件

在许多应用程序中，用户配置文件可能包含各种动态字段。使用 JSON 数据类型可以灵活地存储这些字段，而不需要频繁修改数据库模式。

### 日志记录

日志数据通常包含不同的字段和结构。使用 JSON 数据类型可以轻松地存储和查询这些日志数据。

## 总结

SQL 中的 JSON 操作为处理半结构化数据提供了强大的工具。通过使用 JSON 数据类型和相关的函数，你可以在关系型数据库中灵活地存储和查询 JSON 数据。本文介绍了如何创建包含 JSON 列的表、插入和查询 JSON 数据，以及如何修改 JSON 数据。

## 附加资源

- [PostgreSQL JSON 文档](https://www.postgresql.org/docs/current/datatype-json.html)
- [MySQL JSON 文档](https://dev.mysql.com/doc/refman/8.0/en/json.html)
- [SQL JSON 练习](https://www.sql-ex.com/)

:::tip
尝试在你的数据库中创建一个包含 JSON 列的表，并插入一些 JSON 数据。然后使用本文介绍的操作符和函数来查询和修改这些数据。
:::