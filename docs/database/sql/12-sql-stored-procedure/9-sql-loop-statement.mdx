---
title: SQL 循环语句
description: 了解SQL中的循环语句，掌握如何在存储过程中使用循环来处理重复任务。
---

# SQL 循环语句

在SQL中，循环语句是一种强大的工具，允许你在存储过程中重复执行一段代码，直到满足特定条件为止。循环语句在处理需要重复操作的任务时非常有用，例如批量更新数据、生成序列号或处理复杂的业务逻辑。

## 什么是SQL循环语句？

SQL循环语句是一种控制结构，允许你重复执行一段代码块，直到满足某个条件为止。常见的循环语句包括 `WHILE` 循环和 `LOOP` 循环。这些循环语句通常用于存储过程中，以便在数据库中进行复杂的操作。

## SQL 中的循环类型

在SQL中，主要有两种类型的循环语句：

1. **WHILE循环**：在满足特定条件时重复执行代码块。
2. **LOOP循环**：无限循环，直到显式地使用 `LEAVE` 或 `BREAK` 语句退出。

### WHILE循环

`WHILE` 循环是最常见的循环类型之一。它的语法如下：

```sql
WHILE condition DO
    -- 循环体
END WHILE;
```

在 `WHILE` 循环中，只要 `condition` 为真，循环体中的代码就会重复执行。当 `condition` 变为假时，循环结束。

#### 示例：使用WHILE循环计算1到10的和

```sql
DECLARE @sum INT = 0;
DECLARE @counter INT = 1;

WHILE @counter <= 10 DO
    SET @sum = @sum + @counter;
    SET @counter = @counter + 1;
END WHILE;

SELECT @sum AS TotalSum;
```

**输出：**

```
TotalSum
--------
55
```

在这个示例中，`WHILE` 循环从1开始累加，直到计数器达到10为止。最终，`@sum` 的值为55。

### LOOP循环

`LOOP` 循环是一种无限循环，除非显式地使用 `LEAVE` 或 `BREAK` 语句退出。它的语法如下：

```sql
LOOP
    -- 循环体
    IF condition THEN
        LEAVE;
    END IF;
END LOOP;
```

#### 示例：使用LOOP循环计算1到10的和

```sql
DECLARE @sum INT = 0;
DECLARE @counter INT = 1;

LOOP
    SET @sum = @sum + @counter;
    SET @counter = @counter + 1;
    IF @counter > 10 THEN
        LEAVE;
    END IF;
END LOOP;

SELECT @sum AS TotalSum;
```

**输出：**

```
TotalSum
--------
55
```

在这个示例中，`LOOP` 循环会一直执行，直到 `@counter` 大于10时，使用 `LEAVE` 语句退出循环。

## 实际应用场景

### 批量更新数据

假设你有一个包含员工工资的表 `Employees`，你需要为每个员工的工资增加10%。你可以使用 `WHILE` 循环来实现这一任务。

```sql
DECLARE @EmployeeID INT;
DECLARE @Salary DECIMAL(10, 2);

DECLARE EmployeeCursor CURSOR FOR
SELECT EmployeeID, Salary FROM Employees;

OPEN EmployeeCursor;

FETCH NEXT FROM EmployeeCursor INTO @EmployeeID, @Salary;

WHILE @@FETCH_STATUS = 0 DO
    SET @Salary = @Salary * 1.10;
    UPDATE Employees SET Salary = @Salary WHERE EmployeeID = @EmployeeID;
    FETCH NEXT FROM EmployeeCursor INTO @EmployeeID, @Salary;
END WHILE;

CLOSE EmployeeCursor;
DEALLOCATE EmployeeCursor;
```

在这个示例中，`WHILE` 循环遍历 `Employees` 表中的每一行，并将每个员工的工资增加10%。

### 生成序列号

假设你需要为某个表中的每一行生成一个唯一的序列号。你可以使用 `LOOP` 循环来实现这一任务。

```sql
DECLARE @SequenceNumber INT = 1;
DECLARE @MaxID INT;

SELECT @MaxID = MAX(ID) FROM MyTable;

LOOP
    IF @SequenceNumber > @MaxID THEN
        LEAVE;
    END IF;
    UPDATE MyTable SET SequenceNumber = @SequenceNumber WHERE ID = @SequenceNumber;
    SET @SequenceNumber = @SequenceNumber + 1;
END LOOP;
```

在这个示例中，`LOOP` 循环为 `MyTable` 表中的每一行生成一个唯一的序列号。

## 总结

SQL循环语句是处理重复任务的有力工具。通过 `WHILE` 循环和 `LOOP` 循环，你可以在存储过程中实现复杂的逻辑和批量操作。掌握这些循环语句将帮助你更高效地处理数据库中的数据。

:::tip
在使用循环语句时，务必注意循环的退出条件，以避免无限循环。
:::

## 附加资源

- [SQL存储过程教程](https://example.com/sql-stored-procedures)
- [SQL控制结构](https://example.com/sql-control-structures)
- [SQL循环语句练习](https://example.com/sql-loops-exercises)

通过练习和实践，你将能够熟练使用SQL循环语句来处理各种复杂的数据库任务。