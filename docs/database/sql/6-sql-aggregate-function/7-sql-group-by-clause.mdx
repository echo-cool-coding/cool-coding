---
title: SQL GROUP BY 子句
description: 了解如何使用 SQL 的 GROUP BY 子句对数据进行分组，并结合聚合函数进行数据分析。
---

## 介绍

在 SQL 中，`GROUP BY` 子句用于将具有相同值的行分组到一起，通常与聚合函数（如 `COUNT`、`SUM`、`AVG`、`MAX`、`MIN` 等）一起使用，以便对每个分组进行计算。通过 `GROUP BY`，我们可以轻松地对数据进行分类汇总，从而更好地理解和分析数据。

## 基本语法

`GROUP BY` 子句的基本语法如下：

```sql
SELECT column1, aggregate_function(column2)
FROM table_name
GROUP BY column1;
```

- `column1`：要分组的列。
- `aggregate_function(column2)`：对分组后的数据应用的聚合函数。
- `table_name`：要查询的表。

:::note
`GROUP BY` 子句通常与 `SELECT` 语句中的列一起使用，这些列要么是分组列，要么是聚合函数的结果。
:::

## 示例 1：简单的 GROUP BY

假设我们有一个名为 `orders` 的表，记录了客户的订单信息：

| order_id | customer_id | amount |
|----------|-------------|--------|
| 1        | 101         | 100    |
| 2        | 102         | 200    |
| 3        | 101         | 150    |
| 4        | 103         | 300    |
| 5        | 102         | 250    |

我们想要计算每个客户的总订单金额。可以使用以下 SQL 查询：

```sql
SELECT customer_id, SUM(amount) AS total_amount
FROM orders
GROUP BY customer_id;
```

**输出结果：**

| customer_id | total_amount |
|-------------|--------------|
| 101         | 250          |
| 102         | 450          |
| 103         | 300          |

在这个例子中，`GROUP BY` 将数据按 `customer_id` 分组，然后对每个分组应用 `SUM` 函数，计算每个客户的总订单金额。

## 示例 2：GROUP BY 与多个列

有时我们需要根据多个列进行分组。例如，假设我们有一个 `sales` 表，记录了不同地区和时间段的销售数据：

| region  | year | sales |
|---------|------|-------|
| North   | 2022 | 1000  |
| South   | 2022 | 1500  |
| North   | 2023 | 1200  |
| South   | 2023 | 1800  |
| North   | 2022 | 1100  |

我们想要计算每个地区每年的总销售额。可以使用以下 SQL 查询：

```sql
SELECT region, year, SUM(sales) AS total_sales
FROM sales
GROUP BY region, year;
```

**输出结果：**

| region | year | total_sales |
|--------|------|-------------|
| North  | 2022 | 2100        |
| South  | 2022 | 1500        |
| North  | 2023 | 1200        |
| South  | 2023 | 1800        |

在这个例子中，`GROUP BY` 根据 `region` 和 `year` 两个列进行分组，然后计算每个分组的 `sales` 总和。

## 示例 3：GROUP BY 与 HAVING 子句

`HAVING` 子句用于过滤分组后的结果。与 `WHERE` 子句不同，`HAVING` 是在分组和聚合之后应用的。

假设我们想要找出总销售额超过 2000 的地区和年份。可以使用以下 SQL 查询：

```sql
SELECT region, year, SUM(sales) AS total_sales
FROM sales
GROUP BY region, year
HAVING SUM(sales) > 2000;
```

**输出结果：**

| region | year | total_sales |
|--------|------|-------------|
| North  | 2022 | 2100        |

在这个例子中，`HAVING` 子句过滤掉了总销售额不超过 2000 的分组。

## 实际应用场景

### 场景 1：电商平台订单分析

在电商平台中，我们可能需要分析每个用户的购买行为。例如，计算每个用户的订单数量、总消费金额等。通过 `GROUP BY`，我们可以轻松地生成这些统计数据，从而帮助平台优化用户体验和营销策略。

### 场景 2：销售数据汇总

在销售管理中，我们经常需要按地区、时间等维度汇总销售数据。`GROUP BY` 可以帮助我们快速生成这些汇总报表，从而为决策提供数据支持。

## 总结

`GROUP BY` 子句是 SQL 中一个强大的工具，用于对数据进行分组和汇总。通过结合聚合函数，我们可以轻松地生成各种统计报表，从而更好地理解和分析数据。

:::tip
在使用 `GROUP BY` 时，请确保 `SELECT` 语句中的列要么是分组列，要么是聚合函数的结果。否则，SQL 查询可能会报错。
:::

## 附加资源与练习

1. **练习 1**：假设你有一个 `employees` 表，记录了员工的部门、工资等信息。请编写一个 SQL 查询，计算每个部门的平均工资。
2. **练习 2**：在 `orders` 表中，计算每个客户的订单数量，并筛选出订单数量大于 2 的客户。

通过练习，你可以更好地掌握 `GROUP BY` 的使用方法。祝你学习愉快！