---
title: SQL 多表更新
description: 学习如何使用SQL语句在多个表中更新数据，掌握多表更新的基本语法和实际应用场景。
---

# SQL 多表更新

在SQL中，更新数据是常见的操作之一。通常情况下，我们使用`UPDATE`语句来更新单个表中的数据。然而，在某些情况下，我们需要同时更新多个表中的数据。这时，**SQL多表更新**就派上了用场。

## 什么是SQL多表更新？

SQL多表更新是指在一个SQL语句中同时更新多个表中的数据。这种操作通常用于处理多个表之间存在关联关系的情况。通过多表更新，我们可以确保数据的一致性和完整性。

## 基本语法

SQL多表更新的基本语法如下：

```sql
UPDATE table1
SET table1.column1 = value1
FROM table2
WHERE table1.column2 = table2.column2;
```

在这个语法中：
- `table1` 是要更新的主表。
- `table2` 是提供更新条件的辅助表。
- `SET` 子句用于指定要更新的列和新的值。
- `FROM` 子句用于指定辅助表。
- `WHERE` 子句用于指定更新条件。

:::note
不同的数据库管理系统（如MySQL、PostgreSQL、SQL Server等）对多表更新的支持可能有所不同。在使用时，请确保查阅相关数据库的文档。
:::

## 示例

假设我们有两个表：`employees` 和 `departments`。`employees` 表包含员工的信息，`departments` 表包含部门的信息。我们希望将所有在 "Sales" 部门的员工的薪水增加 10%。

### 表结构

```sql
CREATE TABLE employees (
    employee_id INT PRIMARY KEY,
    name VARCHAR(100),
    salary DECIMAL(10, 2),
    department_id INT
);

CREATE TABLE departments (
    department_id INT PRIMARY KEY,
    department_name VARCHAR(100)
);
```

### 初始数据

```sql
INSERT INTO departments (department_id, department_name) VALUES
(1, 'Sales'),
(2, 'HR');

INSERT INTO employees (employee_id, name, salary, department_id) VALUES
(1, 'Alice', 50000, 1),
(2, 'Bob', 60000, 1),
(3, 'Charlie', 70000, 2);
```

### 更新操作

```sql
UPDATE employees
SET salary = salary * 1.10
FROM departments
WHERE employees.department_id = departments.department_id
AND departments.department_name = 'Sales';
```

### 更新后的数据

```sql
SELECT * FROM employees;
```

输出结果：

| employee_id | name    | salary  | department_id |
|-------------|---------|---------|---------------|
| 1           | Alice   | 55000.00| 1             |
| 2           | Bob     | 66000.00| 1             |
| 3           | Charlie | 70000.00| 2             |

可以看到，`Alice` 和 `Bob` 的薪水都增加了 10%，而 `Charlie` 的薪水保持不变。

## 实际应用场景

### 场景1：更新订单状态

假设我们有一个 `orders` 表和一个 `customers` 表。我们希望将所有未付款的订单状态更新为 "Cancelled"，并且这些订单属于某个特定客户。

```sql
UPDATE orders
SET status = 'Cancelled'
FROM customers
WHERE orders.customer_id = customers.customer_id
AND customers.customer_name = 'John Doe'
AND orders.status = 'Unpaid';
```

### 场景2：批量更新库存

假设我们有一个 `products` 表和一个 `suppliers` 表。我们希望将所有由某个供应商提供的产品的库存数量增加 100。

```sql
UPDATE products
SET stock_quantity = stock_quantity + 100
FROM suppliers
WHERE products.supplier_id = suppliers.supplier_id
AND suppliers.supplier_name = 'Supplier A';
```

## 总结

SQL多表更新是一种强大的工具，可以帮助我们在多个表中同时更新数据，确保数据的一致性和完整性。通过掌握多表更新的基本语法和实际应用场景，你可以更高效地处理复杂的数据库操作。

## 附加资源

- [SQL UPDATE 语句](https://www.w3schools.com/sql/sql_update.asp)
- [SQL JOIN 语句](https://www.w3schools.com/sql/sql_join.asp)
- [SQL 多表更新示例](https://www.sqlshack.com/sql-update-from-select-join-multiple-tables/)

## 练习

1. 创建一个 `students` 表和一个 `courses` 表。编写一个SQL语句，将所有选修 "Mathematics" 课程的学生的成绩增加 5 分。
2. 假设你有一个 `orders` 表和一个 `shipping` 表。编写一个SQL语句，将所有已发货的订单状态更新为 "Completed"。

通过完成这些练习，你将更好地理解SQL多表更新的概念和应用。