---
title: SQL 正则表达式
description: 学习如何在 SQL 中使用正则表达式进行数据过滤，掌握正则表达式的基本语法和实际应用场景。
---

# SQL 正则表达式

正则表达式（Regular Expression，简称 regex）是一种强大的工具，用于匹配和处理文本数据。在 SQL 中，正则表达式可以帮助我们更灵活地过滤和查询数据。本文将介绍如何在 SQL 中使用正则表达式，并通过实际案例展示其应用。

## 什么是正则表达式？

正则表达式是一种用于描述字符串模式的语法。它可以帮助我们匹配、查找和替换文本中的特定模式。在 SQL 中，正则表达式通常用于 `WHERE` 子句中，以过滤出符合特定模式的记录。

## SQL 中的正则表达式语法

不同的数据库管理系统（DBMS）对正则表达式的支持有所不同。以下是一些常见的 SQL 正则表达式函数和操作符：

- **MySQL**: 使用 `REGEXP` 或 `RLIKE` 操作符。
- **PostgreSQL**: 使用 `~` 操作符。
- **Oracle**: 使用 `REGEXP_LIKE` 函数。
- **SQL Server**: 使用 `LIKE` 操作符，但不支持完整的正则表达式。

### 基本语法

在 MySQL 中，可以使用 `REGEXP` 操作符来匹配正则表达式。例如：

```sql
SELECT * FROM users WHERE name REGEXP '^J';
```

这条查询语句会返回所有名字以字母 "J" 开头的用户。

### 常用正则表达式符号

以下是一些常用的正则表达式符号及其含义：

- `^`: 匹配字符串的开头。
- `$`: 匹配字符串的结尾。
- `.`: 匹配任意单个字符。
- `*`: 匹配前面的字符零次或多次。
- `+`: 匹配前面的字符一次或多次。
- `?`: 匹配前面的字符零次或一次。
- `[]`: 匹配括号内的任意一个字符。
- `[^]`: 匹配不在括号内的任意一个字符。
- `|`: 或操作符，匹配左边或右边的模式。

### 示例

假设我们有一个 `users` 表，其中包含以下数据：

| id | name   | email               |
|----|--------|---------------------|
| 1  | John   | john@example.com    |
| 2  | Jane   | jane@example.com    |
| 3  | Alice  | alice@example.com   |
| 4  | Bob    | bob@example.com     |
| 5  | Charlie| charlie@example.com |

#### 示例 1: 匹配以 "J" 开头的名字

```sql
SELECT * FROM users WHERE name REGEXP '^J';
```

**输出:**

| id | name | email               |
|----|------|---------------------|
| 1  | John | john@example.com    |
| 2  | Jane | jane@example.com    |

#### 示例 2: 匹配包含 "a" 或 "e" 的名字

```sql
SELECT * FROM users WHERE name REGEXP '[ae]';
```

**输出:**

| id | name   | email               |
|----|--------|---------------------|
| 1  | John   | john@example.com    |
| 2  | Jane   | jane@example.com    |
| 3  | Alice  | alice@example.com   |
| 4  | Bob    | bob@example.com     |

#### 示例 3: 匹配以 ".com" 结尾的电子邮件

```sql
SELECT * FROM users WHERE email REGEXP '\.com$';
```

**输出:**

| id | name   | email               |
|----|--------|---------------------|
| 1  | John   | john@example.com    |
| 2  | Jane   | jane@example.com    |
| 3  | Alice  | alice@example.com   |
| 4  | Bob    | bob@example.com     |
| 5  | Charlie| charlie@example.com |

## 实际应用场景

### 场景 1: 验证电子邮件格式

假设我们需要验证用户输入的电子邮件是否符合标准格式。我们可以使用正则表达式来匹配常见的电子邮件格式：

```sql
SELECT * FROM users WHERE email REGEXP '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$';
```

这条查询语句会返回所有符合标准电子邮件格式的记录。

### 场景 2: 查找包含特定模式的电话号码

假设我们有一个 `contacts` 表，其中包含电话号码。我们需要查找所有以 "555" 开头的电话号码：

```sql
SELECT * FROM contacts WHERE phone_number REGEXP '^555';
```

## 总结

正则表达式是 SQL 中一个非常强大的工具，可以帮助我们更灵活地过滤和查询数据。通过掌握正则表达式的基本语法和常用符号，你可以在 SQL 中实现更复杂的查询操作。

## 附加资源

- [MySQL 正则表达式文档](https://dev.mysql.com/doc/refman/8.0/en/regexp.html)
- [PostgreSQL 正则表达式文档](https://www.postgresql.org/docs/current/functions-matching.html)
- [正则表达式在线测试工具](https://regex101.com/)

## 练习

1. 编写一个 SQL 查询，查找所有以 "A" 开头并以 "e" 结尾的名字。
2. 编写一个 SQL 查询，查找所有包含数字的电子邮件地址。
3. 编写一个 SQL 查询，查找所有以 "123" 结尾的电话号码。

通过完成这些练习，你将更好地掌握 SQL 正则表达式的使用。