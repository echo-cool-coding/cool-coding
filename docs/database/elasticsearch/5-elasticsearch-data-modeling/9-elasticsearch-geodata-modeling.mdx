---
title: Elasticsearch 地理数据建模
description: 了解如何在Elasticsearch中建模和查询地理数据，包括地理点、地理形状和实际应用场景。
---

# Elasticsearch 地理数据建模

Elasticsearch 是一个强大的分布式搜索引擎，支持多种数据类型，包括地理数据。地理数据建模是 Elasticsearch 中的一个重要概念，它允许我们存储和查询与地理位置相关的信息。本文将介绍如何在 Elasticsearch 中建模地理数据，并通过实际案例展示其应用。

## 什么是地理数据建模？

地理数据建模是指在 Elasticsearch 中定义和存储与地理位置相关的数据。Elasticsearch 支持两种主要的地理数据类型：

1. **地理点（Geo-point）**：表示地球表面上的一个点，通常由纬度和经度组成。
2. **地理形状（Geo-shape）**：表示更复杂的地理形状，如多边形、线串等。

通过地理数据建模，我们可以执行各种地理查询，如查找某个点附近的文档、计算两个点之间的距离、判断一个点是否在某个区域内等。

## 地理点（Geo-point）建模

### 定义地理点字段

在 Elasticsearch 中，地理点字段可以通过 `geo_point` 类型来定义。以下是一个示例映射：

```json
PUT /locations
{
  "mappings": {
    "properties": {
      "name": {
        "type": "text"
      },
      "location": {
        "type": "geo_point"
      }
    }
  }
}
```

在这个示例中，我们定义了一个名为 `locations` 的索引，其中包含一个 `name` 字段和一个 `location` 字段。`location` 字段的类型为 `geo_point`，用于存储地理点数据。

### 插入地理点数据

接下来，我们可以插入一些地理点数据：

```json
POST /locations/_doc/1
{
  "name": "Eiffel Tower",
  "location": {
    "lat": 48.8584,
    "lon": 2.2945
  }
}

POST /locations/_doc/2
{
  "name": "Statue of Liberty",
  "location": {
    "lat": 40.6892,
    "lon": -74.0445
  }
}
```

在这个示例中，我们插入了两个文档，分别表示埃菲尔铁塔和自由女神像的地理位置。

### 查询地理点数据

我们可以使用 `geo_distance` 查询来查找某个点附近的文档。例如，查找距离巴黎（48.8566, 2.3522）100公里以内的所有地点：

```json
GET /locations/_search
{
  "query": {
    "geo_distance": {
      "distance": "100km",
      "location": {
        "lat": 48.8566,
        "lon": 2.3522
      }
    }
  }
}
```

这个查询将返回埃菲尔铁塔的文档，因为它在巴黎100公里以内。

## 地理形状（Geo-shape）建模

### 定义地理形状字段

地理形状字段可以通过 `geo_shape` 类型来定义。以下是一个示例映射：

```json
PUT /regions
{
  "mappings": {
    "properties": {
      "name": {
        "type": "text"
      },
      "area": {
        "type": "geo_shape"
      }
    }
  }
}
```

在这个示例中，我们定义了一个名为 `regions` 的索引，其中包含一个 `name` 字段和一个 `area` 字段。`area` 字段的类型为 `geo_shape`，用于存储地理形状数据。

### 插入地理形状数据

我们可以插入一些地理形状数据，例如一个多边形：

```json
POST /regions/_doc/1
{
  "name": "Central Park",
  "area": {
    "type": "polygon",
    "coordinates": [
      [
        [-73.9730, 40.7648],
        [-73.9818, 40.7681],
        [-73.9582, 40.8006],
        [-73.9494, 40.7968],
        [-73.9730, 40.7648]
      ]
    ]
  }
}
```

在这个示例中，我们插入了一个表示纽约中央公园的多边形。

### 查询地理形状数据

我们可以使用 `geo_shape` 查询来判断一个点是否在某个地理形状内。例如，判断点（-73.9654, 40.7829）是否在中央公园内：

```json
GET /regions/_search
{
  "query": {
    "geo_shape": {
      "area": {
        "shape": {
          "type": "point",
          "coordinates": [-73.9654, 40.7829]
        },
        "relation": "within"
      }
    }
  }
}
```

这个查询将返回中央公园的文档，因为该点在中央公园的多边形内。

## 实际应用场景

### 1. 附近地点搜索

假设你正在开发一个旅游应用，用户可以通过输入当前位置来查找附近的景点。你可以使用 `geo_point` 字段存储景点的位置，并使用 `geo_distance` 查询来查找附近的景点。

### 2. 地理围栏

假设你正在开发一个物流应用，需要监控车辆是否进入或离开某个区域。你可以使用 `geo_shape` 字段存储区域的地理形状，并使用 `geo_shape` 查询来判断车辆的位置是否在区域内。

## 总结

Elasticsearch 的地理数据建模功能非常强大，能够处理各种与地理位置相关的需求。通过 `geo_point` 和 `geo_shape` 字段，我们可以存储和查询地理数据，并应用于各种实际场景中。

## 附加资源与练习

- **练习**：尝试创建一个包含 `geo_point` 字段的索引，并插入一些地理点数据。然后使用 `geo_distance` 查询查找某个点附近的文档。
- **资源**：阅读 Elasticsearch 官方文档中关于 [地理数据](https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-queries.html) 的部分，了解更多高级查询和功能。

通过本文的学习，你应该已经掌握了 Elasticsearch 中地理数据建模的基本概念和应用。继续探索和实践，你将能够更好地利用 Elasticsearch 处理地理数据。