---
title: Elasticsearch 跨集群复制
description: 了解Elasticsearch跨集群复制（CCR）的概念、工作原理及其在实际场景中的应用。
---

# Elasticsearch 跨集群复制

Elasticsearch跨集群复制（Cross-Cluster Replication, CCR）是一项高级功能，允许您将一个Elasticsearch集群中的索引复制到另一个集群中。这项功能特别适用于需要跨多个数据中心或区域进行数据同步的场景，例如灾难恢复、数据备份或跨区域数据分析。

## 什么是跨集群复制？

跨集群复制（CCR）是Elasticsearch提供的一种机制，用于将一个集群中的索引数据复制到另一个集群中。源集群（Leader Cluster）中的索引被称为“Leader Index”，而目标集群（Follower Cluster）中的索引被称为“Follower Index”。Follower Index会持续从Leader Index中拉取数据更新，以保持两者之间的数据一致性。

:::note
CCR适用于Elasticsearch 6.5及以上版本，并且需要启用X-Pack插件。
:::

## 跨集群复制的工作原理

CCR的核心思想是通过远程集群连接（Remote Cluster Connection）将两个集群连接起来。Follower Index会定期从Leader Index中拉取数据变更（如新增、更新或删除操作），并将这些变更应用到本地索引中。

### 1. 配置远程集群连接

首先，您需要在Follower Cluster中配置与Leader Cluster的连接。以下是一个配置示例：

```yaml
PUT /_cluster/settings
{
  "persistent": {
    "cluster": {
      "remote": {
        "leader_cluster": {
          "seeds": ["leader_cluster_node1:9300", "leader_cluster_node2:9300"]
        }
      }
    }
  }
}
```

### 2. 创建Follower Index

接下来，您需要在Follower Cluster中创建一个Follower Index，并指定它要复制的Leader Index。以下是一个创建Follower Index的示例：

```yaml
PUT /follower_index/_ccr/follow
{
  "remote_cluster": "leader_cluster",
  "leader_index": "leader_index"
}
```

### 3. 监控复制状态

您可以通过以下API查看Follower Index的复制状态：

```yaml
GET /follower_index/_ccr/stats
```

## 实际应用场景

### 1. 灾难恢复

通过CCR，您可以将生产环境中的索引数据复制到另一个地理位置的集群中。如果主集群发生故障，您可以快速切换到备用集群，确保业务连续性。

### 2. 跨区域数据分析

如果您的业务分布在多个区域，您可以使用CCR将各区域的数据集中到一个集群中进行分析，而无需手动同步数据。

### 3. 数据备份

CCR还可以用于数据备份。您可以将生产环境中的索引数据复制到备份集群中，以防止数据丢失。

## 总结

Elasticsearch跨集群复制（CCR）是一项强大的功能，适用于需要跨多个集群同步数据的场景。通过CCR，您可以轻松实现灾难恢复、跨区域数据分析和数据备份等功能。

:::tip
如果您想深入了解CCR的更多细节，建议查阅Elasticsearch官方文档，或者尝试在本地环境中搭建两个集群进行实验。
:::

## 附加资源

- [Elasticsearch官方文档 - 跨集群复制](https://www.elastic.co/guide/en/elasticsearch/reference/current/xpack-ccr.html)
- [Elasticsearch跨集群复制实战指南](https://www.elastic.co/blog/cross-cluster-replication-in-elasticsearch)

## 练习

1. 尝试在两个Elasticsearch集群之间配置CCR，并观察数据同步的过程。
2. 使用CCR实现一个简单的灾难恢复方案，模拟主集群故障并切换到备用集群。
