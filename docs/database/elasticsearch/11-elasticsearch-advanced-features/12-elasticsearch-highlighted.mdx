---
title: Elasticsearch 高亮显示
description: 了解如何在Elasticsearch中使用高亮显示功能，以突出显示搜索结果中的匹配文本片段。
---

# Elasticsearch 高亮显示

在Elasticsearch中，高亮显示（Highlighting）是一种强大的功能，它允许你在搜索结果中突出显示与查询匹配的文本片段。这对于用户快速定位搜索结果中的关键信息非常有用。本文将详细介绍如何在Elasticsearch中使用高亮显示功能，并通过实际案例帮助你更好地理解其应用。

## 什么是高亮显示？

高亮显示是Elasticsearch中的一项功能，它能够在搜索结果中标记出与查询条件匹配的文本片段。通常，这些匹配的文本片段会被包裹在HTML标签中（如`<em>`），以便在前端页面中以不同的样式显示。

例如，如果你搜索“Elasticsearch”，高亮显示功能可能会返回如下结果：

```json
{
  "hits": {
    "hits": [
      {
        "_source": {
          "content": "Elasticsearch is a distributed search engine."
        },
        "highlight": {
          "content": [
            "<em>Elasticsearch</em> is a distributed search engine."
          ]
        }
      }
    ]
  }
}
```

在这个例子中，`<em>`标签包裹了匹配的文本“Elasticsearch”，表示这是一个高亮显示的片段。

## 如何使用高亮显示？

要在Elasticsearch中使用高亮显示功能，你需要在查询中添加`highlight`参数。以下是一个简单的示例：

```json
GET /my_index/_search
{
  "query": {
    "match": {
      "content": "Elasticsearch"
    }
  },
  "highlight": {
    "fields": {
      "content": {}
    }
  }
}
```

在这个查询中，我们指定了`highlight`参数，并告诉Elasticsearch要对`content`字段进行高亮显示。Elasticsearch会返回匹配的文档，并在`highlight`字段中包含高亮显示的文本片段。

### 高亮显示的配置选项

Elasticsearch提供了多种配置选项来定制高亮显示的行为。以下是一些常用的选项：

- **`pre_tags` 和 `post_tags`**: 用于指定高亮显示文本的前后标签。默认情况下，Elasticsearch使用`<em>`标签，但你可以自定义这些标签。

  ```json
  "highlight": {
    "fields": {
      "content": {
        "pre_tags": ["<strong>"],
        "post_tags": ["</strong>"]
      }
    }
  }
  ```

- **`fragment_size`**: 控制每个高亮片段的大小（以字符为单位）。默认值为100。

  ```json
  "highlight": {
    "fields": {
      "content": {
        "fragment_size": 150
      }
    }
  }
  ```

- **`number_of_fragments`**: 控制返回的高亮片段的数量。默认值为5。

  ```json
  "highlight": {
    "fields": {
      "content": {
        "number_of_fragments": 3
      }
    }
  }
  ```

## 实际案例

假设你正在构建一个博客搜索引擎，用户可以通过关键词搜索博客文章。你希望搜索结果中能够高亮显示匹配的关键词，以便用户快速找到相关内容。

以下是一个完整的查询示例：

```json
GET /blog_posts/_search
{
  "query": {
    "match": {
      "content": "Elasticsearch"
    }
  },
  "highlight": {
    "fields": {
      "content": {
        "pre_tags": ["<strong>"],
        "post_tags": ["</strong>"],
        "fragment_size": 200,
        "number_of_fragments": 2
      }
    }
  }
}
```

假设有一篇博客文章的内容如下：

```text
Elasticsearch is a powerful search engine that allows you to perform full-text searches on large datasets. It is built on top of Apache Lucene and provides a distributed, RESTful search engine.
```

执行上述查询后，Elasticsearch可能会返回如下结果：

```json
{
  "hits": {
    "hits": [
      {
        "_source": {
          "content": "Elasticsearch is a powerful search engine that allows you to perform full-text searches on large datasets. It is built on top of Apache Lucene and provides a distributed, RESTful search engine."
        },
        "highlight": {
          "content": [
            "<strong>Elasticsearch</strong> is a powerful search engine that allows you to perform full-text searches on large datasets.",
            "It is built on top of Apache Lucene and provides a distributed, RESTful search engine."
          ]
        }
      }
    ]
  }
}
```

在这个结果中，`Elasticsearch`被高亮显示，并且只返回了两个片段。

## 总结

Elasticsearch的高亮显示功能是一个非常实用的工具，它可以帮助用户在搜索结果中快速定位关键信息。通过本文的介绍，你应该已经掌握了如何在Elasticsearch中使用高亮显示功能，并了解了如何通过配置选项来定制高亮显示的行为。

:::tip 提示
在实际应用中，你可以根据需求调整高亮显示的样式和片段数量，以提供更好的用户体验。
:::

## 附加资源

- [Elasticsearch官方文档 - Highlighting](https://www.elastic.co/guide/en/elasticsearch/reference/current/highlighting.html)
- [Elasticsearch高亮显示最佳实践](https://www.elastic.co/blog/elasticsearch-highlighting-best-practices)

## 练习

1. 尝试在你的Elasticsearch索引中创建一个包含文本数据的文档，并使用高亮显示功能进行搜索。
2. 修改`pre_tags`和`post_tags`，使用不同的HTML标签来高亮显示匹配的文本。
3. 调整`fragment_size`和`number_of_fragments`，观察返回的高亮片段的变化。

通过以上练习，你将更深入地理解Elasticsearch高亮显示功能的工作原理和应用场景。