---
title: Elasticsearch 身份认证
description: 了解Elasticsearch中的身份认证机制，掌握如何为Elasticsearch集群配置用户认证，确保数据安全。
---

## 介绍

Elasticsearch是一个强大的分布式搜索引擎，广泛应用于日志分析、全文搜索和实时数据分析等场景。然而，随着数据量的增加和业务复杂性的提升，确保Elasticsearch集群的安全性变得至关重要。身份认证是Elasticsearch安全防护的第一道防线，它确保只有经过验证的用户才能访问集群资源。

在本教程中，我们将深入探讨Elasticsearch的身份认证机制，学习如何配置用户认证，并通过实际案例展示其应用场景。

## 什么是Elasticsearch身份认证？

身份认证是验证用户身份的过程，确保只有授权的用户才能访问Elasticsearch集群。Elasticsearch提供了多种身份认证方式，包括：

- **内置用户认证**：使用Elasticsearch自带的用户管理系统。
- **LDAP/Active Directory**：与外部目录服务集成。
- **PKI（公钥基础设施）**：使用数字证书进行认证。

在本教程中，我们将重点介绍内置用户认证。

## 配置内置用户认证

### 1. 启用安全功能

默认情况下，Elasticsearch的安全功能是关闭的。要启用安全功能，需要在`elasticsearch.yml`配置文件中添加以下内容：

```yaml
xpack.security.enabled: true
```

### 2. 设置内置用户密码

启用安全功能后，需要为内置用户设置密码。Elasticsearch提供了`elasticsearch-setup-passwords`工具来完成此操作。运行以下命令：

```bash
bin/elasticsearch-setup-passwords auto
```

该命令会自动为所有内置用户生成随机密码。你也可以使用`interactive`模式手动设置密码：

```bash
bin/elasticsearch-setup-passwords interactive
```

### 3. 验证认证

配置完成后，尝试访问Elasticsearch集群时，系统会提示输入用户名和密码。例如，使用`curl`命令访问集群：

```bash
curl -u elastic:your_password http://localhost:9200
```

如果认证成功，你将看到类似以下的输出：

```json
{
  "name" : "node-1",
  "cluster_name" : "elasticsearch",
  "cluster_uuid" : "abc123",
  "version" : {
    "number" : "8.0.0",
    "build_flavor" : "default",
    "build_type" : "tar",
    "build_hash" : "abc123",
    "build_date" : "2023-01-01T00:00:00.000Z",
    "build_snapshot" : false,
    "lucene_version" : "9.0.0",
    "minimum_wire_compatibility_version" : "7.17.0",
    "minimum_index_compatibility_version" : "7.0.0"
  },
  "tagline" : "You Know, for Search"
}
```

## 实际案例

### 场景：保护日志数据

假设你正在运行一个日志分析系统，使用Elasticsearch存储日志数据。为了保护敏感日志信息，你需要确保只有授权的运维人员才能访问Elasticsearch集群。

#### 步骤：

1. **启用安全功能**：在`elasticsearch.yml`中启用安全功能。
2. **设置用户密码**：为内置用户`elastic`和其他用户设置强密码。
3. **配置Kibana认证**：确保Kibana也配置了相同的认证机制，以便用户可以通过Kibana界面访问日志数据。

#### 结果：

只有经过认证的用户才能访问Elasticsearch集群和Kibana界面，确保了日志数据的安全性。

## 总结

Elasticsearch的身份认证是保护集群安全的重要措施。通过启用安全功能、设置用户密码和配置认证机制，你可以有效防止未经授权的访问，确保数据安全。

## 附加资源

- [Elasticsearch官方文档：安全设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-settings.html)
- [Kibana安全配置指南](https://www.elastic.co/guide/en/kibana/current/security-settings-kb.html)

## 练习

1. 在你的本地Elasticsearch集群中启用安全功能，并设置内置用户密码。
2. 尝试使用`curl`命令访问集群，验证认证是否生效。
3. 配置Kibana与Elasticsearch的认证集成，确保通过Kibana界面访问数据时需要输入用户名和密码。

通过以上练习，你将更深入地理解Elasticsearch身份认证的实际应用。