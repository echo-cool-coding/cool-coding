---
title: Elasticsearch 范围查询
description: 了解如何在 Elasticsearch 中使用范围查询来筛选特定范围内的数据。本文适合初学者，包含详细的解释、代码示例和实际应用场景。
---

# Elasticsearch 范围查询

Elasticsearch 是一个强大的分布式搜索引擎，支持多种查询类型。其中，**范围查询（Range Query）** 是一种常用的查询方式，用于筛选出满足特定范围条件的文档。无论是数字、日期还是字符串，范围查询都能帮助你快速找到所需的数据。

## 什么是范围查询？

范围查询允许你根据字段的值是否在指定范围内来筛选文档。常见的应用场景包括：

- 查找价格在某个区间内的商品。
- 筛选出某个时间段内的日志记录。
- 查询年龄在特定范围内的用户。

范围查询支持以下操作符：

- `gt`：大于（greater than）
- `gte`：大于等于（greater than or equal to）
- `lt`：小于（less than）
- `lte`：小于等于（less than or equal to）

## 基本语法

范围查询的基本语法如下：

```json
{
  "query": {
    "range": {
      "field_name": {
        "gte": "lower_bound",
        "lte": "upper_bound"
      }
    }
  }
}
```

- `field_name`：要查询的字段名称。
- `lower_bound` 和 `upper_bound`：范围的上下界。

## 示例：查询价格在 100 到 500 之间的商品

假设我们有一个商品索引，其中每个文档包含 `name` 和 `price` 字段。我们希望查询价格在 100 到 500 之间的商品。

```json
{
  "query": {
    "range": {
      "price": {
        "gte": 100,
        "lte": 500
      }
    }
  }
}
```

### 输入

```json
{
  "name": "Product A",
  "price": 200
}
{
  "name": "Product B",
  "price": 50
}
{
  "name": "Product C",
  "price": 400
}
```

### 输出

```json
{
  "hits": {
    "total": {
      "value": 2,
      "relation": "eq"
    },
    "hits": [
      {
        "_source": {
          "name": "Product A",
          "price": 200
        }
      },
      {
        "_source": {
          "name": "Product C",
          "price": 400
        }
      }
    ]
  }
}
```

:::note
注意：范围查询不仅适用于数字字段，还可以用于日期和字符串字段。
:::

## 日期范围查询

Elasticsearch 支持对日期字段进行范围查询。假设我们有一个日志索引，其中每个文档包含 `timestamp` 字段。我们希望查询 2023 年 1 月 1 日到 2023 年 1 月 31 日之间的日志。

```json
{
  "query": {
    "range": {
      "timestamp": {
        "gte": "2023-01-01",
        "lte": "2023-01-31"
      }
    }
  }
}
```

:::tip
提示：Elasticsearch 支持多种日期格式，你可以根据需要选择合适的格式。
:::

## 字符串范围查询

虽然字符串范围查询不常见，但在某些场景下仍然有用。例如，查询名称以字母 "A" 到 "M" 开头的用户。

```json
{
  "query": {
    "range": {
      "name": {
        "gte": "A",
        "lte": "M"
      }
    }
  }
}
```

:::caution
注意：字符串范围查询基于字典顺序，因此结果可能与预期不同，尤其是在处理多字节字符时。
:::

## 实际应用场景

### 电商网站的价格筛选

在电商网站中，用户通常希望根据价格范围筛选商品。使用 Elasticsearch 的范围查询，可以快速返回符合条件的结果，提升用户体验。

### 日志分析

在日志分析中，范围查询可以帮助你筛选出特定时间段内的日志记录，便于进一步分析。

### 用户年龄筛选

在用户管理系统中，你可能需要根据年龄范围筛选用户。例如，查找年龄在 18 到 30 岁之间的用户。

## 总结

范围查询是 Elasticsearch 中非常实用的功能，适用于多种数据类型和场景。通过本文的学习，你应该已经掌握了如何使用范围查询来筛选特定范围内的数据。

## 附加资源

- [Elasticsearch 官方文档 - 范围查询](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html)
- [Elasticsearch 查询 DSL 指南](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html)

## 练习

1. 创建一个包含 `age` 字段的用户索引，并编写一个范围查询，筛选出年龄在 20 到 30 岁之间的用户。
2. 尝试对日期字段进行范围查询，筛选出过去一周内的日志记录。
3. 使用字符串范围查询，筛选出名称以字母 "A" 到 "G" 开头的商品。

通过完成这些练习，你将更深入地理解 Elasticsearch 范围查询的应用。