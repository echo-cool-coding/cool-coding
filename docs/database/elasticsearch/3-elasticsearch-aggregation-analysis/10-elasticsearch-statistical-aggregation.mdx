---
title: Elasticsearch 统计聚合
description: 了解如何使用Elasticsearch的统计聚合功能，对数据进行统计分析，包括平均值、总和、最小值、最大值等。
---

# Elasticsearch 统计聚合

Elasticsearch 是一个强大的分布式搜索和分析引擎，广泛应用于日志分析、全文搜索、数据聚合等场景。统计聚合（Stats Aggregation）是 Elasticsearch 提供的一种聚合功能，用于对数值型字段进行统计分析，包括计算平均值、总和、最小值、最大值等。

## 什么是统计聚合？

统计聚合是一种用于对数值型字段进行统计分析的聚合类型。它可以帮助你快速获取一组数据的统计信息，而不需要编写复杂的查询或手动计算。统计聚合的结果通常包括以下字段：

- `count`：参与统计的文档数量。
- `min`：字段的最小值。
- `max`：字段的最大值。
- `avg`：字段的平均值。
- `sum`：字段的总和。

## 统计聚合的基本语法

在 Elasticsearch 中，统计聚合的基本语法如下：

```json
{
  "aggs": {
    "聚合名称": {
      "stats": {
        "field": "字段名"
      }
    }
  }
}
```

- `聚合名称`：你为聚合指定的名称，用于标识聚合结果。
- `field`：需要进行统计分析的字段名。

## 示例：统计商品价格

假设我们有一个电商网站的索引 `products`，其中包含商品的名称和价格。我们想要统计所有商品的价格信息，包括平均价格、最高价格、最低价格和总价格。

### 输入

```json
{
  "size": 0,
  "aggs": {
    "price_stats": {
      "stats": {
        "field": "price"
      }
    }
  }
}
```

### 输出

```json
{
  "aggregations": {
    "price_stats": {
      "count": 100,
      "min": 10,
      "max": 1000,
      "avg": 250.5,
      "sum": 25050
    }
  }
}
```

在这个例子中，我们统计了 `price` 字段的值，得到了以下结果：

- `count`：共有 100 个商品。
- `min`：最低价格为 10。
- `max`：最高价格为 1000。
- `avg`：平均价格为 250.5。
- `sum`：所有商品的总价格为 25050。

## 实际应用场景

### 场景 1：分析销售数据

假设你有一个销售数据的索引 `sales`，其中包含每笔交易的金额。你可以使用统计聚合来分析所有交易的总金额、平均金额、最高金额和最低金额。

```json
{
  "size": 0,
  "aggs": {
    "sales_stats": {
      "stats": {
        "field": "amount"
      }
    }
  }
}
```

### 场景 2：监控系统性能

在监控系统中，你可能需要统计服务器的响应时间。通过统计聚合，你可以快速获取响应时间的平均值、最大值和最小值，从而评估系统的性能。

```json
{
  "size": 0,
  "aggs": {
    "response_time_stats": {
      "stats": {
        "field": "response_time"
      }
    }
  }
}
```

## 总结

统计聚合是 Elasticsearch 中非常实用的功能，能够帮助你快速获取数值型字段的统计信息。无论是分析销售数据、监控系统性能，还是进行其他数据分析任务，统计聚合都能为你提供有价值的洞察。

:::tip
如果你需要对多个字段进行统计，可以尝试使用 `extended_stats` 聚合，它提供了更多的统计信息，如方差、标准差等。
:::

## 附加资源

- [Elasticsearch 官方文档 - 统计聚合](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-stats-aggregation.html)
- [Elasticsearch 聚合查询实战](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html)

## 练习

1. 在你的 Elasticsearch 索引中，选择一个数值型字段，使用统计聚合获取其统计信息。
2. 尝试使用 `extended_stats` 聚合，比较它与 `stats` 聚合的结果差异。

通过以上内容，你应该已经掌握了 Elasticsearch 统计聚合的基本用法。继续练习和探索，你将能够更熟练地使用 Elasticsearch 进行数据分析。