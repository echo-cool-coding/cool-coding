---
title: Elasticsearch Ids 查询
description: 了解如何使用 Elasticsearch 的 Ids 查询来根据文档的唯一标识符（ID）检索文档。本文适合初学者，包含代码示例和实际应用场景。
---

# Elasticsearch Ids 查询

Elasticsearch 是一个强大的分布式搜索和分析引擎，支持多种查询方式。其中，**Ids 查询**是一种简单但非常有用的查询类型，它允许你根据文档的唯一标识符（ID）来检索文档。本文将详细介绍 Ids 查询的使用方法，并通过示例帮助你理解其工作原理。

## 什么是 Ids 查询？

Ids 查询是一种基于文档 ID 的查询方式。它允许你通过指定一个或多个文档 ID 来检索这些文档。这种查询方式非常高效，因为它直接通过文档的 ID 进行查找，而不需要扫描整个索引。

### 适用场景

Ids 查询通常用于以下场景：

- 你已经知道文档的 ID，并且希望快速检索这些文档。
- 你需要根据一组已知的 ID 来批量获取文档。
- 你希望避免使用复杂的查询条件，直接通过 ID 获取文档。

## Ids 查询的基本语法

Ids 查询的基本语法如下：

```json
{
  "query": {
    "ids": {
      "values": ["id1", "id2", "id3"]
    }
  }
}
```

- `ids`：表示这是一个 Ids 查询。
- `values`：一个数组，包含你要查询的文档 ID。

### 示例

假设我们有一个名为 `my_index` 的索引，其中包含以下文档：

```json
[
  {
    "_id": "1",
    "name": "Alice",
    "age": 25
  },
  {
    "_id": "2",
    "name": "Bob",
    "age": 30
  },
  {
    "_id": "3",
    "name": "Charlie",
    "age": 35
  }
]
```

现在，我们想要检索 ID 为 `1` 和 `3` 的文档。可以使用以下查询：

```json
{
  "query": {
    "ids": {
      "values": ["1", "3"]
    }
  }
}
```

### 查询结果

执行上述查询后，Elasticsearch 将返回以下结果：

```json
{
  "hits": {
    "total": {
      "value": 2,
      "relation": "eq"
    },
    "hits": [
      {
        "_id": "1",
        "_source": {
          "name": "Alice",
          "age": 25
        }
      },
      {
        "_id": "3",
        "_source": {
          "name": "Charlie",
          "age": 35
        }
      }
    ]
  }
}
```

:::note
注意：如果指定的 ID 不存在，Elasticsearch 将不会返回任何错误，而是简单地忽略这些 ID。
:::

## 实际应用场景

### 场景 1：批量获取用户信息

假设你有一个用户管理系统，用户的 ID 存储在一个列表中。你需要根据这些 ID 批量获取用户信息。使用 Ids 查询可以轻松实现这一需求。

```json
{
  "query": {
    "ids": {
      "values": ["101", "102", "103"]
    }
  }
}
```

### 场景 2：快速检索特定文档

在某些情况下，你可能已经知道某些文档的 ID，并且希望快速检索这些文档。例如，你可能在日志系统中记录了某些重要事件的 ID，现在需要快速查看这些事件的详细信息。

```json
{
  "query": {
    "ids": {
      "values": ["event_123", "event_456"]
    }
  }
}
```

## 总结

Ids 查询是 Elasticsearch 中一种简单但非常高效的查询方式，特别适用于你已经知道文档 ID 的情况。通过本文的介绍，你应该已经掌握了 Ids 查询的基本语法和使用场景。

### 附加资源

- [Elasticsearch 官方文档](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html)
- [Elasticsearch 查询 DSL 入门指南](#)

### 练习

1. 创建一个包含多个文档的索引，并使用 Ids 查询检索其中的几个文档。
2. 尝试在 Ids 查询中指定一个不存在的 ID，观察 Elasticsearch 的返回结果。

通过实践这些练习，你将更好地理解 Ids 查询的工作原理和应用场景。