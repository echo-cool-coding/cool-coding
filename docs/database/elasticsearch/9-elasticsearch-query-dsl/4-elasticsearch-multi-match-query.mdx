---
title: Elasticsearch Multi Match 查询
description: 了解 Elasticsearch 中的 Multi Match 查询，掌握如何在多个字段中搜索相同的关键词，并学习其实际应用场景。
---

# Elasticsearch Multi Match 查询

Elasticsearch 是一个强大的搜索引擎，支持多种查询方式。其中，**Multi Match 查询**是一种非常实用的查询类型，允许你在多个字段中搜索相同的关键词。本文将详细介绍 Multi Match 查询的概念、语法、使用场景以及实际案例。

## 什么是 Multi Match 查询？

Multi Match 查询是 Elasticsearch 提供的一种查询类型，它允许你在多个字段中搜索相同的关键词。与 `match` 查询不同，`multi_match` 查询可以同时在多个字段中查找匹配的内容，并返回最相关的结果。

这种查询方式非常适合在需要对多个字段进行全文搜索的场景中使用，例如在电商网站中同时搜索商品名称、描述和标签。

## Multi Match 查询的基本语法

Multi Match 查询的基本语法如下：

```json
{
  "query": {
    "multi_match": {
      "query": "搜索关键词",
      "fields": ["字段1", "字段2", "字段3"]
    }
  }
}
```

- `query`: 要搜索的关键词。
- `fields`: 指定要在哪些字段中进行搜索。你可以列出多个字段名称。

### 示例

假设我们有一个索引 `products`，其中包含以下字段：

- `name`: 商品名称
- `description`: 商品描述
- `tags`: 商品标签

我们希望在 `name`、`description` 和 `tags` 字段中搜索关键词 "手机"，可以使用以下查询：

```json
{
  "query": {
    "multi_match": {
      "query": "手机",
      "fields": ["name", "description", "tags"]
    }
  }
}
```

### 输出结果

执行上述查询后，Elasticsearch 会返回在 `name`、`description` 或 `tags` 字段中包含 "手机" 的所有文档。

## Multi Match 查询的类型

Multi Match 查询支持多种类型，每种类型都有不同的搜索行为。以下是常见的几种类型：

1. **`best_fields`**: 默认类型。它会从指定的字段中选择最匹配的字段，并基于该字段的得分进行排序。
2. **`most_fields`**: 它会将所有字段的得分合并，并基于合并后的得分进行排序。
3. **`cross_fields`**: 它将所有字段视为一个整体，并在所有字段中查找匹配的内容。
4. **`phrase`**: 它会将查询关键词视为一个短语，并在指定的字段中查找完全匹配的短语。
5. **`phrase_prefix`**: 类似于 `phrase`，但它允许查询关键词的最后一个词进行前缀匹配。

### 示例：使用 `best_fields` 类型

```json
{
  "query": {
    "multi_match": {
      "query": "智能手机",
      "fields": ["name", "description"],
      "type": "best_fields"
    }
  }
}
```

在这个示例中，Elasticsearch 会从 `name` 和 `description` 字段中选择最匹配的字段，并基于该字段的得分进行排序。

## 实际应用场景

### 场景 1：电商网站的商品搜索

在电商网站中，用户可能会在搜索框中输入一个关键词，例如 "智能手机"。为了提供更好的搜索结果，我们可以在多个字段中进行搜索，例如商品名称、描述和标签。

```json
{
  "query": {
    "multi_match": {
      "query": "智能手机",
      "fields": ["name", "description", "tags"]
    }
  }
}
```

### 场景 2：博客文章的全文搜索

假设我们有一个博客系统，用户可以在标题、内容和标签中搜索文章。我们可以使用 Multi Match 查询来同时搜索这些字段。

```json
{
  "query": {
    "multi_match": {
      "query": "Elasticsearch",
      "fields": ["title", "content", "tags"]
    }
  }
}
```

## 总结

Multi Match 查询是 Elasticsearch 中非常强大的工具，特别适合在多个字段中进行全文搜索的场景。通过灵活使用不同的查询类型，你可以根据具体需求调整搜索行为，从而提供更精准的搜索结果。

:::tip 提示
在实际使用中，建议根据数据的特点和搜索需求选择合适的 Multi Match 查询类型。例如，如果你希望搜索结果更偏向于某个字段，可以使用 `best_fields` 类型；如果你希望综合考虑所有字段的匹配情况，可以使用 `most_fields` 类型。
:::

## 附加资源与练习

- **练习 1**: 在你的 Elasticsearch 索引中创建一个包含多个字段的文档，并使用 Multi Match 查询进行搜索。
- **练习 2**: 尝试使用不同的 Multi Match 查询类型（如 `best_fields`、`most_fields` 等），并观察搜索结果的变化。

通过本文的学习，你应该已经掌握了 Elasticsearch 中 Multi Match 查询的基本概念和使用方法。继续实践和探索，你将能够更好地利用 Elasticsearch 的强大功能来满足各种搜索需求。