---
title: Elasticsearch Match Phrase 查询
description: 了解 Elasticsearch 中的 Match Phrase 查询，掌握如何使用它来精确匹配短语，并通过实际案例加深理解。
---

# Elasticsearch Match Phrase 查询

Elasticsearch 是一个强大的搜索引擎，支持多种查询类型来满足不同的搜索需求。其中，**Match Phrase 查询**是一种用于精确匹配短语的查询方式。它不仅能匹配指定的词语，还能确保这些词语以特定的顺序出现在文档中。本文将详细介绍 Match Phrase 查询的概念、用法以及实际应用场景。

## 什么是 Match Phrase 查询？

Match Phrase 查询用于在文档中查找与指定短语完全匹配的内容。与普通的 Match 查询不同，Match Phrase 查询不仅要求文档中包含查询中的所有词语，还要求这些词语以相同的顺序出现。这使得 Match Phrase 查询非常适合用于搜索固定短语或特定顺序的词语组合。

例如，假设我们有一个包含以下文档的索引：

```json
[
  { "text": "The quick brown fox jumps over the lazy dog" },
  { "text": "A quick brown fox jumps over the lazy dog" },
  { "text": "The quick brown fox jumps over a lazy dog" }
]
```

如果我们使用 Match Phrase 查询来搜索 `"quick brown fox"`，只有包含这个短语的文档会被匹配，而顺序不同的文档则不会被匹配。

## Match Phrase 查询的基本语法

Match Phrase 查询的基本语法如下：

```json
{
  "query": {
    "match_phrase": {
      "field_name": "search_phrase"
    }
  }
}
```

- `field_name`：要搜索的字段名称。
- `search_phrase`：要匹配的短语。

### 示例

假设我们有一个名为 `my_index` 的索引，其中包含一个 `text` 字段。我们可以使用以下查询来搜索包含 `"quick brown fox"` 的文档：

```json
{
  "query": {
    "match_phrase": {
      "text": "quick brown fox"
    }
  }
}
```

### 查询结果

执行上述查询后，Elasticsearch 会返回所有包含 `"quick brown fox"` 短语的文档。例如：

```json
{
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "hits": [
      {
        "_index": "my_index",
        "_type": "_doc",
        "_id": "1",
        "_score": 1.0,
        "_source": {
          "text": "The quick brown fox jumps over the lazy dog"
        }
      }
    ]
  }
}
```

:::note
Match Phrase 查询默认情况下是区分顺序的，因此只有完全匹配的短语才会被返回。
:::

## Match Phrase 查询的高级用法

### 1. `slop` 参数

`slop` 参数允许我们在 Match Phrase 查询中指定词语之间的最大间隔距离。这意味着即使词语之间有一些间隔，只要间隔不超过 `slop` 指定的值，文档仍然会被匹配。

例如，如果我们设置 `slop` 为 1，那么以下文档也会被匹配：

```json
{ "text": "The quick brown lazy fox jumps over the dog" }
```

查询示例：

```json
{
  "query": {
    "match_phrase": {
      "text": {
        "query": "quick brown fox",
        "slop": 1
      }
    }
  }
}
```

### 2. `analyzer` 参数

`analyzer` 参数允许我们指定用于分析查询文本的分析器。默认情况下，Elasticsearch 会使用字段的分析器，但我们可以通过 `analyzer` 参数覆盖它。

```json
{
  "query": {
    "match_phrase": {
      "text": {
        "query": "quick brown fox",
        "analyzer": "standard"
      }
    }
  }
}
```

## 实际应用场景

### 场景 1：搜索固定短语

假设我们正在开发一个新闻搜索应用，用户希望搜索包含特定短语的新闻文章。例如，用户输入 `"climate change impact"`，我们希望返回所有包含这个短语的文章。

```json
{
  "query": {
    "match_phrase": {
      "content": "climate change impact"
    }
  }
}
```

### 场景 2：搜索包含近似短语的文档

在某些情况下，用户可能希望搜索包含近似短语的文档。例如，用户输入 `"quick brown fox"`，但我们希望返回包含 `"quick brown lazy fox"` 的文档。这时，我们可以使用 `slop` 参数来实现。

```json
{
  "query": {
    "match_phrase": {
      "content": {
        "query": "quick brown fox",
        "slop": 1
      }
    }
  }
}
```

## 总结

Match Phrase 查询是 Elasticsearch 中用于精确匹配短语的强大工具。它不仅要求文档中包含查询中的所有词语，还要求这些词语以相同的顺序出现。通过 `slop` 参数，我们还可以灵活地匹配包含近似短语的文档。

:::tip
在实际应用中，Match Phrase 查询非常适合用于搜索固定短语或特定顺序的词语组合。结合 `slop` 参数，可以进一步扩展其应用场景。
:::

## 附加资源与练习

- **练习 1**：创建一个包含多个文档的索引，并使用 Match Phrase 查询来搜索包含特定短语的文档。
- **练习 2**：尝试使用 `slop` 参数，观察不同 `slop` 值对查询结果的影响。
- **进一步阅读**：Elasticsearch 官方文档中的 [Match Phrase Query](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html) 部分。

通过本文的学习，你应该已经掌握了 Elasticsearch 中的 Match Phrase 查询的基本用法和高级技巧。希望你能在实际项目中灵活运用这些知识，提升搜索体验！