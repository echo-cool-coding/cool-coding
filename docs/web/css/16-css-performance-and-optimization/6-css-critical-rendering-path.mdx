---
title: CSS 关键渲染路径
description: 了解CSS关键渲染路径的概念及其在网页性能优化中的重要性。本文将从基础概念入手，逐步讲解如何优化CSS渲染路径，并提供实际案例和代码示例。
---

## 什么是CSS关键渲染路径？

CSS关键渲染路径（Critical Rendering Path, CRP）是指浏览器从接收HTML、CSS和JavaScript文件到将这些文件渲染成像素到屏幕上的过程。优化CSS关键渲染路径可以显著提升网页的加载速度和用户体验。

在网页加载过程中，浏览器需要完成以下步骤：

1. **解析HTML**：构建DOM（文档对象模型）。
2. **解析CSS**：构建CSSOM（CSS对象模型）。
3. **合并DOM和CSSOM**：生成渲染树（Render Tree）。
4. **布局（Layout）**：计算每个元素的位置和大小。
5. **绘制（Paint）**：将像素绘制到屏幕上。

CSS关键渲染路径的优化主要集中在减少阻塞渲染的CSS资源，确保页面内容能够尽快显示。

## 为什么CSS关键渲染路径重要？

CSS是**渲染阻塞资源**，这意味着浏览器在构建CSSOM之前无法渲染页面。如果CSS文件过大或加载时间过长，用户会看到白屏或内容闪烁（FOUC，Flash of Unstyled Content）。通过优化CSS关键渲染路径，可以减少页面加载时间，提升用户体验。

## 如何优化CSS关键渲染路径？

### 1. 内联关键CSS

将关键的CSS直接内联到HTML文件中，可以减少外部CSS文件的请求时间。关键CSS是指页面首屏内容所需的CSS样式。

```html
<head>
  <style>
    /* 关键CSS */
    body { font-family: Arial, sans-serif; }
    .header { background-color: #f0f0f0; }
  </style>
</head>
```

:::tip
内联CSS适用于小型项目或关键样式，但对于大型项目，建议使用工具（如Critical）自动提取关键CSS。
:::

### 2. 异步加载非关键CSS

对于非关键CSS，可以使用`media`属性或JavaScript异步加载，避免阻塞渲染。

```html
<link rel="stylesheet" href="non-critical.css" media="print" onload="this.media='all'">
```

:::note
`media="print"`表示该CSS文件仅在打印时加载，`onload`事件触发后将其应用于所有媒体类型。
:::

### 3. 减少CSS文件大小

通过以下方法减少CSS文件大小：

- **压缩CSS**：使用工具（如CSSNano）删除空格、注释和未使用的样式。
- **删除未使用的CSS**：使用工具（如PurgeCSS）删除未使用的CSS规则。

### 4. 避免使用`@import`

`@import`会阻塞渲染，因为它需要等待外部CSS文件加载完成。建议使用`<link>`标签代替。

```html
<!-- 不推荐 -->
<style>
  @import url('styles.css');
</style>

<!-- 推荐 -->
<link rel="stylesheet" href="styles.css">
```

### 5. 使用`preload`预加载关键CSS

通过`<link rel="preload">`提前加载关键CSS文件，确保它们尽快可用。

```html
<link rel="preload" href="critical.css" as="style" onload="this.rel='stylesheet'">
```

## 实际案例

假设我们有一个简单的网页，包含以下内容：

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>优化CSS关键渲染路径示例</title>
  <style>
    /* 关键CSS */
    body { font-family: Arial, sans-serif; }
    .header { background-color: #f0f0f0; }
  </style>
  <link rel="preload" href="non-critical.css" as="style" onload="this.rel='stylesheet'">
</head>
<body>
  <div class="header">欢迎来到我的网站</div>
  <div class="content">这是页面内容。</div>
</body>
</html>
```

在这个例子中，关键CSS被内联到HTML中，而非关键CSS通过`preload`异步加载，从而优化了渲染路径。

## 总结

优化CSS关键渲染路径是提升网页性能的关键步骤。通过内联关键CSS、异步加载非关键CSS、减少CSS文件大小以及使用`preload`等技术，可以显著减少页面加载时间，提升用户体验。

## 附加资源与练习

- **练习**：尝试在自己的项目中内联关键CSS，并使用工具（如Lighthouse）测试性能改进。
- **资源**：
  - [Google Web Fundamentals: Critical Rendering Path](https://web.dev/critical-rendering-path/)
  - [MDN: Render-blocking CSS](https://developer.mozilla.org/en-US/docs/Web/Performance/Critical_rendering_path)

通过不断实践和优化，你将掌握CSS关键渲染路径的核心技巧，并能够构建更高效的网页！