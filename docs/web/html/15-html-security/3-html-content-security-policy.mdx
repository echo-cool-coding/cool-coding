---
title: HTML 内容安全策略
description: 了解HTML内容安全策略（CSP）的基本概念、工作原理以及如何通过CSP保护您的网站免受常见攻击。
---

# HTML 内容安全策略

HTML内容安全策略（Content Security Policy，简称CSP）是一种安全机制，用于帮助网站管理员控制哪些资源可以被加载和执行，从而减少跨站脚本攻击（XSS）等安全风险。通过CSP，您可以指定哪些来源是可信的，从而限制浏览器加载和执行来自不可信来源的内容。

## 什么是内容安全策略？

内容安全策略是一种HTTP响应头，它允许您定义一组规则，告诉浏览器哪些资源可以加载和执行。这些资源包括脚本、样式表、图片、字体、框架等。通过CSP，您可以防止恶意脚本注入，保护用户数据安全。

### 为什么需要CSP？

在传统的Web开发中，浏览器会默认加载和执行任何来源的资源。这种宽松的策略使得攻击者可以通过注入恶意脚本来窃取用户数据或执行其他恶意操作。CSP通过限制资源的加载和执行来源，有效地减少了这类攻击的风险。

## 如何实现CSP？

CSP通过HTTP响应头 `Content-Security-Policy` 来实现。您可以在服务器端配置该响应头，或者在HTML文档中使用 `<meta>` 标签来定义CSP规则。

### 通过HTTP响应头配置CSP

以下是一个简单的CSP配置示例，它只允许加载来自同一域名的资源：

```http
Content-Security-Policy: default-src 'self';
```

在这个例子中，`default-src 'self'` 表示所有资源（如脚本、样式表、图片等）只能从当前域名加载。

### 通过 `<meta>` 标签配置CSP

如果您无法在服务器端配置HTTP响应头，也可以通过HTML文档中的 `<meta>` 标签来定义CSP规则：

```html
<meta http-equiv="Content-Security-Policy" content="default-src 'self';">
```

这个 `<meta>` 标签的作用与HTTP响应头相同，但它是在HTML文档中定义的。

## CSP指令详解

CSP提供了多种指令，用于控制不同类型的资源。以下是一些常用的CSP指令：

- `default-src`: 定义所有资源的默认加载策略。
- `script-src`: 定义JavaScript脚本的加载策略。
- `style-src`: 定义样式表的加载策略。
- `img-src`: 定义图片的加载策略。
- `font-src`: 定义字体的加载策略。
- `connect-src`: 定义通过脚本（如`XMLHttpRequest`或`fetch`）发起的网络请求的来源。
- `frame-src`: 定义嵌入框架（如`<iframe>`）的加载策略。
- `report-uri`: 定义当CSP规则被违反时，向哪个URL发送报告。

### 示例：限制脚本加载

假设您希望只允许从当前域名和`https://trusted.cdn.com`加载脚本，可以使用以下CSP配置：

```http
Content-Security-Policy: script-src 'self' https://trusted.cdn.com;
```

在这个例子中，`script-src`指令指定了脚本的加载来源，`'self'`表示当前域名，`https://trusted.cdn.com`表示允许从该域名加载脚本。

## 实际应用场景

### 防止XSS攻击

XSS攻击是一种常见的Web安全漏洞，攻击者通过注入恶意脚本来窃取用户数据或执行其他恶意操作。通过CSP，您可以限制脚本的加载来源，从而有效地防止XSS攻击。

例如，假设您的网站允许用户输入评论，并且这些评论会显示在页面上。如果没有CSP，攻击者可以在评论中注入恶意脚本，从而在用户浏览页面时执行该脚本。通过配置CSP，您可以限制脚本的加载来源，防止这种攻击。

```http
Content-Security-Policy: script-src 'self';
```

在这个例子中，`script-src 'self'`表示只允许从当前域名加载脚本，从而防止了来自其他域名的恶意脚本注入。

### 限制外部资源加载

在某些情况下，您可能希望限制网站加载外部资源，例如图片、字体或框架。通过CSP，您可以轻松实现这一点。

例如，假设您希望只允许从当前域名和`https://trusted.cdn.com`加载图片，可以使用以下CSP配置：

```http
Content-Security-Policy: img-src 'self' https://trusted.cdn.com;
```

在这个例子中，`img-src`指令指定了图片的加载来源，`'self'`表示当前域名，`https://trusted.cdn.com`表示允许从该域名加载图片。

## 总结

HTML内容安全策略（CSP）是一种强大的安全机制，可以帮助您保护网站免受XSS攻击和其他安全威胁。通过配置CSP，您可以控制哪些资源可以被加载和执行，从而减少安全风险。

在实际应用中，您可以根据需要灵活配置CSP规则，例如限制脚本、图片、字体等资源的加载来源。通过合理使用CSP，您可以大大提高网站的安全性。

## 附加资源与练习

- **练习**: 尝试在您的网站中配置CSP，并测试不同的CSP规则对资源加载的影响。
- **资源**: 阅读 [MDN Web Docs 上的CSP文档](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP) 以了解更多关于CSP的详细信息。

:::tip
在配置CSP时，建议您逐步测试和调整规则，以确保不会意外阻止合法资源的加载。
:::