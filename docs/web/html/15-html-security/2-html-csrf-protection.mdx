---
title: HTML CSRF防护
description: 了解什么是CSRF攻击，以及如何在HTML中实施有效的防护措施来保护你的Web应用程序。
---

# HTML CSRF防护

## 什么是CSRF攻击？

CSRF（Cross-Site Request Forgery，跨站请求伪造）是一种常见的Web安全漏洞。攻击者通过诱使用户在不知情的情况下执行非预期的操作，从而利用用户的身份进行恶意请求。例如，攻击者可以伪造一个请求，让用户在登录状态下执行转账操作。

:::note
CSRF攻击通常发生在用户已经登录的情况下，因为攻击者可以利用用户的会话信息来执行操作。
:::

## CSRF攻击的工作原理

为了更好地理解CSRF攻击，让我们来看一个简单的例子：

1. 用户登录了一个银行网站，并保持登录状态。
2. 攻击者创建了一个恶意网站，其中包含一个表单，表单的`action`指向银行网站的转账接口。
3. 用户访问了攻击者的网站，浏览器自动发送了带有用户会话信息的请求，执行了转账操作。

```html
<form action="https://bank.com/transfer" method="POST">
  <input type="hidden" name="amount" value="1000" />
  <input type="hidden" name="toAccount" value="attacker" />
  <input type="submit" value="点击领取奖品" />
</form>
```

在这个例子中，用户点击了“点击领取奖品”按钮，但实际上却执行了一个转账操作。

## 如何防护CSRF攻击？

为了防止CSRF攻击，我们可以采取以下几种防护措施：

### 1. 使用CSRF令牌（CSRF Token）

CSRF令牌是一种常见的防护方法。它的工作原理是：服务器生成一个随机的令牌，并将其嵌入到表单中。当用户提交表单时，服务器会验证该令牌是否与服务器存储的令牌一致。

```html
<form action="https://bank.com/transfer" method="POST">
  <input type="hidden" name="csrf_token" value="随机生成的令牌" />
  <input type="text" name="amount" />
  <input type="text" name="toAccount" />
  <input type="submit" value="转账" />
</form>
```

服务器端代码示例（伪代码）：

```javascript
if (request.method === 'POST') {
  const csrfToken = request.body.csrf_token;
  if (csrfToken !== session.csrfToken) {
    return 'CSRF令牌验证失败';
  }
  // 继续处理转账逻辑
}
```

:::tip
CSRF令牌应该是一次性的，并且在每次请求后重新生成，以防止令牌被重复使用。
:::

### 2. 使用SameSite Cookie属性

`SameSite`是Cookie的一个属性，它可以限制Cookie的发送范围。通过将`SameSite`属性设置为`Strict`或`Lax`，可以防止跨站请求携带Cookie。

```javascript
Set-Cookie: sessionId=12345; SameSite=Strict; Secure; HttpOnly
```

- `SameSite=Strict`：Cookie仅在同站请求中发送。
- `SameSite=Lax`：Cookie在跨站请求中仅发送GET请求。

:::caution
`SameSite`属性并不是所有浏览器都支持，因此在某些情况下可能需要结合其他防护措施。
:::

### 3. 验证HTTP Referer头部

服务器可以检查请求的`Referer`头部，确保请求来自合法的源。如果`Referer`头部不匹配，服务器可以拒绝请求。

```javascript
if (request.headers.referer !== 'https://bank.com') {
  return '请求来源不合法';
}
```

:::warning
`Referer`头部可以被伪造或禁用，因此这种方法不能作为唯一的防护措施。
:::

## 实际案例

假设你正在开发一个在线购物网站，用户可以在网站上添加商品到购物车并结账。为了防止CSRF攻击，你可以在结账表单中添加CSRF令牌。

```html
<form action="https://shop.com/checkout" method="POST">
  <input type="hidden" name="csrf_token" value="随机生成的令牌" />
  <input type="submit" value="结账" />
</form>
```

服务器端代码示例（伪代码）：

```javascript
if (request.method === 'POST') {
  const csrfToken = request.body.csrf_token;
  if (csrfToken !== session.csrfToken) {
    return 'CSRF令牌验证失败';
  }
  // 继续处理结账逻辑
}
```

通过这种方式，即使攻击者尝试伪造结账请求，由于缺少有效的CSRF令牌，请求也会被服务器拒绝。

## 总结

CSRF攻击是一种常见的Web安全威胁，但通过实施有效的防护措施，我们可以大大降低风险。常用的防护方法包括使用CSRF令牌、设置`SameSite` Cookie属性以及验证`Referer`头部。

:::note
在实际开发中，建议结合多种防护措施，以提高安全性。
:::

## 附加资源

- [OWASP CSRF防护指南](https://owasp.org/www-community/attacks/csrf)
- [MDN Web Docs: SameSite Cookies](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite)

## 练习

1. 在你的Web应用程序中实现CSRF令牌的生成和验证。
2. 尝试使用`SameSite` Cookie属性，并测试其在不同浏览器中的行为。
3. 研究并实现一种结合多种防护措施的CSRF防护策略。

通过以上学习和实践，你将能够更好地理解和防护CSRF攻击，保护你的Web应用程序免受此类威胁。