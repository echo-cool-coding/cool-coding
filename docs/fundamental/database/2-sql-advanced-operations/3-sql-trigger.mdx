---
title: SQL触发器
description: 了解SQL触发器的概念、语法及其在实际场景中的应用。本文适合初学者，通过代码示例和实际案例帮助你掌握SQL触发器的高级操作。
---

# SQL触发器

SQL触发器（Trigger）是数据库中的一种特殊存储过程，它在特定事件（如插入、更新或删除）发生时自动执行。触发器通常用于维护数据的完整性、记录日志或执行复杂的业务逻辑。

## 什么是SQL触发器？

触发器是与表相关联的数据库对象，它在表上发生特定事件时自动触发。触发器可以在以下事件发生时执行：

- **INSERT**：在插入新记录时触发。
- **UPDATE**：在更新记录时触发。
- **DELETE**：在删除记录时触发。

触发器可以在事件发生之前（`BEFORE`）或之后（`AFTER`）执行，具体取决于你的需求。

## 触发器的语法

以下是创建触发器的基本语法：

```sql
CREATE TRIGGER trigger_name
[BEFORE | AFTER] [INSERT | UPDATE | DELETE]
ON table_name
FOR EACH ROW
BEGIN
    -- 触发器逻辑
END;
```

- `trigger_name`：触发器的名称。
- `BEFORE` 或 `AFTER`：指定触发器在事件之前还是之后执行。
- `INSERT`, `UPDATE`, `DELETE`：指定触发器响应的事件类型。
- `table_name`：触发器关联的表。
- `FOR EACH ROW`：表示触发器对每一行数据都执行。

## 触发器的实际应用

### 案例1：自动更新库存

假设你有一个 `products` 表和一个 `orders` 表。每当有新的订单插入时，你希望自动减少产品的库存数量。

```sql
CREATE TRIGGER update_inventory
AFTER INSERT ON orders
FOR EACH ROW
BEGIN
    UPDATE products
    SET stock = stock - NEW.quantity
    WHERE product_id = NEW.product_id;
END;
```

在这个例子中，`NEW.quantity` 和 `NEW.product_id` 是插入到 `orders` 表中的新记录的字段值。

### 案例2：记录数据变更日志

假设你希望在每次更新 `employees` 表时记录变更日志。

```sql
CREATE TRIGGER log_employee_changes
AFTER UPDATE ON employees
FOR EACH ROW
BEGIN
    INSERT INTO employee_log (employee_id, old_salary, new_salary, change_date)
    VALUES (OLD.employee_id, OLD.salary, NEW.salary, NOW());
END;
```

在这个例子中，`OLD.salary` 是更新前的工资，`NEW.salary` 是更新后的工资。

## 触发器的注意事项

:::caution
- **性能影响**：触发器会在每次事件发生时执行，可能会影响数据库性能。
- **调试困难**：触发器的逻辑隐藏在数据库中，调试起来可能比较困难。
- **避免循环触发**：确保触发器不会导致无限循环，例如一个触发器触发另一个触发器。
:::

## 总结

SQL触发器是数据库管理中非常强大的工具，能够自动执行复杂的业务逻辑和数据完整性检查。通过本文的学习，你应该已经掌握了触发器的基本概念、语法以及实际应用场景。

## 附加资源与练习

- **练习1**：创建一个触发器，在删除 `customers` 表中的记录时，自动将删除的记录插入到 `deleted_customers` 表中。
- **练习2**：创建一个触发器，在更新 `orders` 表中的 `status` 字段时，自动发送通知。

通过实践这些练习，你将更深入地理解SQL触发器的应用。