---
title: Lean 递归函数
description: 了解如何在Lean中定义和使用递归函数，掌握递归的基本概念及其实际应用。
---

# Lean 递归函数

递归是编程中的一个重要概念，它允许函数在其定义中调用自身。在Lean中，递归函数是解决许多问题的强大工具，尤其是在处理数学归纳和数据结构时。本文将逐步介绍如何在Lean中定义和使用递归函数，并通过实际案例帮助你理解其应用。

## 什么是递归函数？

递归函数是一种在其定义中调用自身的函数。递归通常用于解决可以分解为更小、相似子问题的问题。例如，计算阶乘、斐波那契数列或遍历树结构时，递归是非常有用的。

在Lean中，递归函数的定义需要特别注意，因为Lean的类型系统要求递归必须是“结构递归”或“良基递归”，以确保函数总是终止。

## 定义一个简单的递归函数

让我们从一个简单的例子开始：计算一个自然数的阶乘。阶乘的定义如下：

- 0的阶乘是1。
- 对于任何正整数n，n的阶乘是n乘以(n-1)的阶乘。

在Lean中，我们可以这样定义阶乘函数：

```lean
def factorial : Nat → Nat
| 0 => 1
| n + 1 => (n + 1) * factorial n
```

在这个定义中，我们使用了模式匹配来处理不同的情况。当输入为0时，返回1；否则，递归地计算`n-1`的阶乘，并将结果乘以`n`。

### 示例

让我们计算5的阶乘：

```lean
#eval factorial 5  -- 输出: 120
```

## 递归与结构递归

Lean的类型系统要求递归函数必须是“结构递归”的，这意味着递归调用必须作用于输入参数的“更小”部分。例如，在上面的阶乘函数中，递归调用`factorial n`作用于`n`，而`n`是`n + 1`的“更小”部分。

这种限制确保了递归函数总是会终止，避免了无限递归的问题。

## 实际应用：斐波那契数列

斐波那契数列是另一个经典的递归问题。斐波那契数列的定义如下：

- 第0项是0。
- 第1项是1。
- 对于任何n ≥ 2，第n项是第(n-1)项和第(n-2)项的和。

在Lean中，我们可以这样定义斐波那契函数：

```lean
def fibonacci : Nat → Nat
| 0 => 0
| 1 => 1
| n + 2 => fibonacci (n + 1) + fibonacci n
```

### 示例

让我们计算第6项斐波那契数：

```lean
#eval fibonacci 6  -- 输出: 8
```

## 递归与归纳

递归与数学归纳法密切相关。事实上，递归函数的正确性通常可以通过归纳法来证明。例如，我们可以通过归纳法证明`factorial`函数的正确性。

### 归纳证明示例

**定理**：对于所有自然数n，`factorial n`等于n的阶乘。

**证明**：
- 基本情况：当n = 0时，`factorial 0 = 1`，这是正确的。
- 归纳假设：假设对于某个k，`factorial k = k!`。
- 归纳步骤：我们需要证明`factorial (k + 1) = (k + 1)!`。根据定义，`factorial (k + 1) = (k + 1) * factorial k`。根据归纳假设，`factorial k = k!`，因此`factorial (k + 1) = (k + 1) * k! = (k + 1)!`。

## 总结

递归是Lean编程中的一个强大工具，尤其是在处理数学归纳和数据结构时。通过结构递归，我们可以确保递归函数总是终止，并且可以通过归纳法来证明其正确性。

在实际应用中，递归函数可以用于解决许多问题，如计算阶乘、斐波那契数列等。掌握递归的概念和技巧，将帮助你更好地理解和编写Lean程序。

## 附加资源与练习

- **练习1**：定义一个递归函数`sum : Nat → Nat`，计算从1到n的所有自然数的和。
- **练习2**：定义一个递归函数`power : Nat → Nat → Nat`，计算`x`的`n`次幂。
- **进一步阅读**：Lean官方文档中的[递归与归纳](https://leanprover.github.io/)部分，了解更多关于递归和归纳的细节。

希望本文能帮助你理解Lean中的递归函数，并为你的编程学习之旅提供帮助！