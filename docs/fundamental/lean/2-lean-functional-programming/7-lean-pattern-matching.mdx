---
title: Lean 模式匹配
description: "了解Lean中的模式匹配，掌握如何通过模式匹配简化代码逻辑并提高代码的可读性。"
---

# Lean 模式匹配

模式匹配是函数式编程中的核心概念之一，它允许我们根据数据的结构来分解和处理数据。在Lean中，模式匹配是编写清晰、简洁代码的强大工具。本文将带你从基础开始，逐步掌握Lean中的模式匹配。

## 什么是模式匹配？

模式匹配是一种根据数据的形状或结构来匹配和处理数据的方式。它类似于其他编程语言中的`switch`语句，但功能更强大。通过模式匹配，我们可以直接提取数据结构中的值，并根据不同的情况执行不同的逻辑。

### 基本语法

在Lean中，模式匹配通常与`match`表达式一起使用。以下是一个简单的例子：

```lean
def isZero : Nat → Bool
  | 0 => true
  | _ => false
```

在这个例子中，我们定义了一个函数`isZero`，它接受一个自然数（`Nat`）作为输入，并返回一个布尔值（`Bool`）。函数通过模式匹配来判断输入是否为`0`。如果是`0`，则返回`true`；否则返回`false`。

### 模式匹配的工作原理

模式匹配的核心思想是将输入值与一系列模式进行比较，直到找到匹配的模式。一旦找到匹配的模式，就会执行相应的代码块。如果没有找到匹配的模式，Lean会抛出一个错误。

让我们通过一个更复杂的例子来理解这一点：

```lean
def describeNumber : Nat → String
  | 0 => "Zero"
  | 1 => "One"
  | 2 => "Two"
  | _ => "Many"
```

在这个例子中，我们定义了一个函数`describeNumber`，它根据输入的自然数返回相应的描述。如果输入是`0`、`1`或`2`，则分别返回`"Zero"`、`"One"`和`"Two"`。对于其他所有情况，返回`"Many"`。

## 模式匹配的实际应用

模式匹配不仅仅适用于简单的值匹配，它还可以用于处理复杂的数据结构，如列表、元组和自定义类型。

### 列表的模式匹配

让我们看一个处理列表的例子：

```lean
def sumList : List Nat → Nat
  | [] => 0
  | head :: tail => head + sumList tail
```

在这个例子中，我们定义了一个函数`sumList`，它计算一个自然数列表的总和。如果列表为空（`[]`），则返回`0`。如果列表不为空，则将列表分解为头部（`head`）和尾部（`tail`），并递归地计算尾部的总和，然后与头部相加。

### 自定义类型的模式匹配

在Lean中，我们可以定义自己的数据类型，并使用模式匹配来处理这些类型。以下是一个简单的例子：

```lean
inductive Shape where
  | Circle (radius : Float)
  | Rectangle (width : Float) (height : Float)

def area : Shape → Float
  | Circle r => 3.14 * r * r
  | Rectangle w h => w * h
```

在这个例子中，我们定义了一个`Shape`类型，它可以是`Circle`或`Rectangle`。然后，我们定义了一个`area`函数，它根据不同的形状计算面积。对于`Circle`，我们使用公式`π * r²`；对于`Rectangle`，我们使用公式`width * height`。

## 模式匹配的高级用法

模式匹配不仅可以用于简单的值匹配，还可以用于更复杂的场景，如嵌套模式匹配和守卫模式。

### 嵌套模式匹配

嵌套模式匹配允许我们在一个模式匹配中嵌套另一个模式匹配。以下是一个例子：

```lean
def describePair : Nat × Nat → String
  | (0, 0) => "Both are zero"
  | (0, _) => "First is zero"
  | (_, 0) => "Second is zero"
  | _ => "Neither is zero"
```

在这个例子中，我们定义了一个函数`describePair`，它接受一个由两个自然数组成的元组作为输入，并根据元组中的值返回相应的描述。

### 守卫模式

守卫模式允许我们在模式匹配中添加额外的条件。以下是一个例子：

```lean
def isEven : Nat → Bool
  | n => n % 2 == 0
```

在这个例子中，我们定义了一个函数`isEven`，它判断一个自然数是否为偶数。我们使用守卫模式来检查`n % 2 == 0`是否为真。

## 总结

模式匹配是Lean中一个非常强大的工具，它可以帮助我们编写更简洁、更易读的代码。通过模式匹配，我们可以轻松地处理各种数据结构，并根据不同的情况执行不同的逻辑。

### 附加资源

- [Lean官方文档](https://leanprover.github.io/)
- 《函数式编程入门》——一本适合初学者的函数式编程书籍

### 练习

1. 定义一个函数`isPositive`，它接受一个整数并返回`true`，如果该整数为正数，否则返回`false`。
2. 定义一个函数`length`，它计算一个列表的长度。
3. 定义一个函数`max`，它接受两个整数并返回较大的那个。

通过完成这些练习，你将更好地理解Lean中的模式匹配。祝你学习愉快！