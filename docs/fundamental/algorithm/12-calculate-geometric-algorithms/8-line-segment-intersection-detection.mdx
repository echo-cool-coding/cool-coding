---
title: 线段相交检测
description: 学习如何检测两条线段是否相交，理解计算几何中的基本算法及其应用场景。
---

## 介绍

在计算几何中，**线段相交检测**是一个基础但非常重要的问题。它用于判断两条线段是否在二维平面上相交。这个问题在许多领域都有应用，例如计算机图形学、机器人路径规划、地理信息系统（GIS）等。

本文将逐步讲解如何检测两条线段是否相交，并通过代码示例和实际案例帮助你理解这一概念。

## 基本概念

### 线段的表示

在二维平面上，一条线段可以由两个端点表示。假设我们有两条线段：

- 线段 A：端点 `(x1, y1)` 和 `(x2, y2)`
- 线段 B：端点 `(x3, y3)` 和 `(x4, y4)`

我们的目标是判断这两条线段是否相交。

### 向量叉积

为了判断两条线段是否相交，我们需要用到**向量叉积**的概念。向量叉积可以帮助我们判断两个向量的相对方向。

给定两个向量 `u = (u1, u2)` 和 `v = (v1, v2)`，它们的叉积定义为：

```
u × v = u1 * v2 - u2 * v1
```

叉积的结果可以用来判断两个向量的方向关系：

- 如果 `u × v > 0`，则 `u` 在 `v` 的顺时针方向。
- 如果 `u × v < 0`，则 `u` 在 `v` 的逆时针方向。
- 如果 `u × v = 0`，则 `u` 和 `v` 共线。

### 快速排斥实验和跨立实验

为了判断两条线段是否相交，我们可以使用两个步骤：

1. **快速排斥实验**：如果两条线段的最小包围矩形不相交，那么这两条线段肯定不相交。
2. **跨立实验**：如果两条线段互相跨立，那么它们相交。

## 算法步骤

### 1. 快速排斥实验

首先，我们检查两条线段的最小包围矩形是否相交。如果不相交，那么线段肯定不相交。

```python
def bounding_box_intersect(a, b, c, d):
    return max(a.x, b.x) >= min(c.x, d.x) and \
           max(c.x, d.x) >= min(a.x, b.x) and \
           max(a.y, b.y) >= min(c.y, d.y) and \
           max(c.y, d.y) >= min(a.y, b.y)
```

### 2. 跨立实验

如果快速排斥实验通过，我们再进行跨立实验。跨立实验的核心是判断两条线段是否互相跨立。

```python
def cross_product(o, a, b):
    return (a.x - o.x) * (b.y - o.y) - (a.y - o.y) * (b.x - o.x)

def is_point_on_segment(a, b, c):
    return min(a.x, b.x) <= c.x <= max(a.x, b.x) and \
           min(a.y, b.y) <= c.y <= max(a.y, b.y)

def segments_intersect(a, b, c, d):
    if not bounding_box_intersect(a, b, c, d):
        return False

    cp1 = cross_product(a, b, c)
    cp2 = cross_product(a, b, d)
    cp3 = cross_product(c, d, a)
    cp4 = cross_product(c, d, b)

    if ((cp1 > 0 and cp2 < 0) or (cp1 < 0 and cp2 > 0)) and \
       ((cp3 > 0 and cp4 < 0) or (cp3 < 0 and cp4 > 0)):
        return True

    if cp1 == 0 and is_point_on_segment(a, b, c):
        return True
    if cp2 == 0 and is_point_on_segment(a, b, d):
        return True
    if cp3 == 0 and is_point_on_segment(c, d, a):
        return True
    if cp4 == 0 and is_point_on_segment(c, d, b):
        return True

    return False
```

### 代码示例

假设我们有两条线段：

- 线段 A：`(1, 1)` 到 `(4, 4)`
- 线段 B：`(1, 4)` 到 `(4, 1)`

我们可以使用上面的代码来判断它们是否相交：

```python
class Point:
    def __init__(self, x, y):
        self.x = x
        self.y = y

a = Point(1, 1)
b = Point(4, 4)
c = Point(1, 4)
d = Point(4, 1)

print(segments_intersect(a, b, c, d))  # 输出: True
```

### 实际应用场景

线段相交检测在许多实际应用中都非常重要。例如：

- **计算机图形学**：在渲染图形时，需要检测线段是否相交以确定图形的可见性。
- **机器人路径规划**：机器人需要检测路径上的障碍物是否与路径相交，以避免碰撞。
- **地理信息系统（GIS）**：在地图上绘制道路或河流时，需要检测它们是否相交。

## 总结

线段相交检测是计算几何中的一个基础问题，通过快速排斥实验和跨立实验，我们可以有效地判断两条线段是否相交。本文通过详细的步骤和代码示例，帮助你理解这一概念，并展示了其在实际中的应用。

## 附加资源与练习

- **练习**：尝试实现一个函数，判断多条线段中是否有任意两条线段相交。
- **资源**：推荐阅读《计算几何：算法与应用》一书，深入了解计算几何的更多算法和应用。

:::tip
如果你对向量叉积的概念还不熟悉，建议先学习向量的基本知识，这将有助于你更好地理解线段相交检测的算法。
:::