---
title: 作用域与闭包
description: 了解 JavaScript 中的作用域和闭包，掌握它们的工作原理及其在实际开发中的应用。
---

# 作用域与闭包

在 JavaScript 中，**作用域**和**闭包**是两个非常重要的概念。理解它们不仅有助于编写更高效的代码，还能帮助你避免一些常见的错误。本文将逐步讲解作用域和闭包的概念，并通过代码示例和实际应用场景帮助你更好地掌握它们。

## 什么是作用域？

**作用域**是指程序中变量、函数和对象的可访问范围。JavaScript 中有两种主要的作用域：

1. **全局作用域**：在全局作用域中定义的变量和函数可以在代码的任何地方访问。
2. **局部作用域**：在函数内部定义的变量和函数只能在函数内部访问。

### 全局作用域示例

```javascript
var globalVar = "I am global";

function showGlobalVar() {
  console.log(globalVar); // 输出: I am global
}

showGlobalVar();
```

在上面的代码中，`globalVar` 是一个全局变量，因此可以在函数 `showGlobalVar` 中访问。

### 局部作用域示例

```javascript
function showLocalVar() {
  var localVar = "I am local";
  console.log(localVar); // 输出: I am local
}

showLocalVar();
console.log(localVar); // 报错: localVar is not defined
```

在这个例子中，`localVar` 是一个局部变量，只能在 `showLocalVar` 函数内部访问。如果在函数外部访问它，会抛出错误。

:::note
在 ES6 中，引入了 `let` 和 `const` 关键字，它们也支持块级作用域（即 `{}` 内的作用域）。
:::

## 什么是闭包？

**闭包**是指函数能够访问其词法作用域中的变量，即使这个函数在其词法作用域之外执行。换句话说，闭包允许函数“记住”它被创建时的环境。

### 闭包示例

```javascript
function outerFunction() {
  var outerVar = "I am outside!";

  function innerFunction() {
    console.log(outerVar); // 输出: I am outside!
  }

  return innerFunction;
}

var closure = outerFunction();
closure();
```

在这个例子中，`innerFunction` 是一个闭包，因为它能够访问 `outerFunction` 中的 `outerVar` 变量，即使 `outerFunction` 已经执行完毕。

## 闭包的实际应用

闭包在实际开发中有很多应用场景，例如：

1. **数据封装**：通过闭包可以创建私有变量，避免外部直接访问和修改。
2. **回调函数**：闭包常用于回调函数中，以保留函数执行时的上下文。

### 数据封装示例

```javascript
function createCounter() {
  var count = 0;

  return function() {
    count++;
    return count;
  };
}

var counter = createCounter();
console.log(counter()); // 输出: 1
console.log(counter()); // 输出: 2
```

在这个例子中，`count` 变量被封装在 `createCounter` 函数内部，外部无法直接访问或修改它，只能通过返回的闭包函数来操作。

### 回调函数示例

```javascript
function delayedGreeting(name) {
  setTimeout(function() {
    console.log("Hello, " + name);
  }, 1000);
}

delayedGreeting("Alice"); // 1秒后输出: Hello, Alice
```

在这个例子中，`setTimeout` 的回调函数是一个闭包，它能够访问 `delayedGreeting` 函数中的 `name` 变量。

## 总结

- **作用域**决定了变量和函数的可访问范围，分为全局作用域和局部作用域。
- **闭包**是指函数能够访问其词法作用域中的变量，即使在其词法作用域之外执行。
- 闭包在实际开发中有广泛的应用，如数据封装和回调函数。

## 附加资源与练习

1. **练习**：尝试编写一个闭包函数，实现一个简单的缓存机制。
2. **阅读**：深入了解 JavaScript 中的作用域链和闭包的工作原理。
3. **实践**：在项目中尝试使用闭包来封装数据或处理异步操作。

:::tip
理解作用域和闭包是掌握 JavaScript 的关键。通过不断练习和实践，你将能够更好地运用这些概念来编写高效、可维护的代码。
:::