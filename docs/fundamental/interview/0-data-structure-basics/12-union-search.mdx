---
title: 并查集
description: 并查集是一种用于管理元素分组的数据结构，支持高效的合并和查找操作。本文详细介绍并查集的概念、实现及其应用场景。
---

# 并查集

并查集（Disjoint Set Union，简称 DSU）是一种用于管理元素分组的数据结构。它支持两种主要操作：**查找**（Find）和**合并**（Union）。并查集常用于解决动态连通性问题，例如判断两个元素是否属于同一个集合，或者将两个集合合并为一个集合。

## 基本概念

并查集的核心思想是通过树结构来表示集合。每个集合用一棵树表示，树的根节点代表该集合的“代表元素”。通过路径压缩和按秩合并等优化技术，并查集可以在近乎常数时间内完成查找和合并操作。

### 主要操作

1. **查找（Find）**：确定某个元素所属的集合（即找到其根节点）。
2. **合并（Union）**：将两个集合合并为一个集合。

### 代码示例

以下是一个简单的并查集实现：

```python
class UnionFind:
    def __init__(self, n):
        self.parent = list(range(n))
        self.rank = [1] * n

    def find(self, x):
        if self.parent[x] != x:
            self.parent[x] = self.find(self.parent[x])  # 路径压缩
        return self.parent[x]

    def union(self, x, y):
        rootX = self.find(x)
        rootY = self.find(y)
        if rootX != rootY:
            if self.rank[rootX] > self.rank[rootY]:
                self.parent[rootY] = rootX
            elif self.rank[rootX] < self.rank[rootY]:
                self.parent[rootX] = rootY
            else:
                self.parent[rootY] = rootX
                self.rank[rootX] += 1
```

### 示例输入与输出

假设我们有 5 个元素，初始时每个元素都是一个独立的集合：

```python
uf = UnionFind(5)
print(uf.find(0))  # 输出: 0
print(uf.find(1))  # 输出: 1
```

合并元素 0 和 1：

```python
uf.union(0, 1)
print(uf.find(0))  # 输出: 0
print(uf.find(1))  # 输出: 0
```

合并元素 1 和 2：

```python
uf.union(1, 2)
print(uf.find(2))  # 输出: 0
```

## 优化技术

### 路径压缩

路径压缩通过在查找时将节点直接连接到根节点，从而减少后续查找的时间复杂度。例如，在 `find` 方法中，我们通过递归将节点的父节点更新为根节点。

### 按秩合并

按秩合并通过将较小的树合并到较大的树中，从而避免树的高度过高。秩（rank）表示树的高度或大小，合并时选择秩较大的树作为根。

## 实际应用场景

并查集广泛应用于以下场景：

1. **动态连通性问题**：例如判断网络中的两个节点是否连通。
2. **最小生成树算法**：例如 Kruskal 算法中用于检测环。
3. **图像处理**：例如像素区域的连通性分析。

### 示例：Kruskal 算法

Kruskal 算法用于求解最小生成树。它通过按边权重排序，并使用并查集来检测是否形成环。

```python
def kruskal(edges, n):
    uf = UnionFind(n)
    edges.sort(key=lambda x: x[2])  # 按权重排序
    mst = []
    for u, v, w in edges:
        if uf.find(u) != uf.find(v):
            uf.union(u, v)
            mst.append((u, v, w))
    return mst
```

## 总结

并查集是一种高效的数据结构，适用于动态连通性问题。通过路径压缩和按秩合并，其操作的时间复杂度可以接近常数级别。掌握并查集对于解决许多算法问题非常有帮助。

## 附加资源与练习

1. **练习**：尝试实现并查集，并解决一个动态连通性问题。
2. **扩展阅读**：学习并查集在 Kruskal 算法中的应用。
3. **挑战**：尝试优化并查集，使其支持更多操作，例如删除元素。

:::tip
并查集的核心思想是“路径压缩”和“按秩合并”，理解这两点可以帮助你更好地掌握并查集的实现和优化。
:::