---
title: 代理模式
description: 代理模式是一种结构型设计模式，它允许你提供一个代理对象来控制对另一个对象的访问。代理模式常用于延迟初始化、访问控制、日志记录等场景。
---

## 介绍

代理模式（Proxy Pattern）是一种结构型设计模式，它允许你创建一个代理对象来控制对另一个对象的访问。代理对象通常会在客户端和目标对象之间充当一个中介，从而可以在不改变目标对象的情况下，添加额外的功能或控制访问。

代理模式的核心思想是：**通过引入一个代理对象，来控制对目标对象的访问**。代理对象通常会在客户端和目标对象之间充当一个中介，从而可以在不改变目标对象的情况下，添加额外的功能或控制访问。

## 代理模式的类型

代理模式主要有以下几种类型：

1. **虚拟代理（Virtual Proxy）**：延迟初始化，只有在真正需要时才创建目标对象。
2. **保护代理（Protection Proxy）**：控制对目标对象的访问权限。
3. **远程代理（Remote Proxy）**：为位于不同地址空间的对象提供本地代表。
4. **智能引用代理（Smart Reference Proxy）**：在访问目标对象时执行额外的操作，如引用计数、日志记录等。

## 代码示例

下面是一个简单的虚拟代理的示例，展示了如何通过代理对象来延迟初始化一个资源密集型对象。

```python
class RealSubject:
    def request(self):
        print("RealSubject: Handling request.")

class Proxy:
    def __init__(self):
        self._real_subject = None

    def request(self):
        if self._real_subject is None:
            self._real_subject = RealSubject()
        self._real_subject.request()

# 客户端代码
proxy = Proxy()
proxy.request()  # 输出: RealSubject: Handling request.
```

在这个示例中，`Proxy` 类充当了 `RealSubject` 的代理。只有在 `request` 方法被调用时，`RealSubject` 对象才会被创建。

## 实际应用场景

代理模式在实际开发中有许多应用场景，以下是一些常见的例子：

1. **延迟初始化**：当创建一个对象的开销很大时，可以使用代理模式来延迟对象的初始化，直到真正需要时才创建。
2. **访问控制**：代理可以控制对目标对象的访问权限，例如只允许特定用户访问某些资源。
3. **日志记录**：代理可以在访问目标对象时记录日志，以便于调试和监控。
4. **远程代理**：在分布式系统中，代理可以充当远程对象的本地代表，隐藏网络通信的复杂性。

## 总结

代理模式是一种非常有用的设计模式，它允许你通过引入一个代理对象来控制对目标对象的访问。代理模式可以用于延迟初始化、访问控制、日志记录等场景。通过使用代理模式，你可以在不改变目标对象的情况下，添加额外的功能或控制访问。

## 附加资源

- [设计模式：可复用面向对象软件的基础](https://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612) - 这本书是设计模式领域的经典之作，详细介绍了代理模式以及其他设计模式。
- [Refactoring Guru - 代理模式](https://refactoring.guru/design-patterns/proxy) - 一个非常棒的设计模式学习网站，提供了关于代理模式的详细解释和示例代码。

## 练习

1. 实现一个保护代理，控制对某个敏感资源的访问权限。
2. 修改上面的虚拟代理示例，使其在每次访问目标对象时记录日志。
3. 思考并实现一个远程代理，模拟一个远程服务的本地代表。

:::tip
在实现代理模式时，务必确保代理对象和目标对象具有相同的接口，这样客户端代码可以无缝切换使用代理对象或目标对象。
:::