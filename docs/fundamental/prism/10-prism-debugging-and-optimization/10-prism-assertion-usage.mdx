---
title: PRISM 断言使用
description: 学习如何在PRISM模型检查器中使用断言进行调试和验证，包括语法、实际案例和最佳实践。
---

# PRISM 断言使用

## 介绍

断言（Assertions）是PRISM模型检查器中用于验证模型属性的重要工具。它们允许你在模型执行过程中检查特定条件是否满足，从而帮助识别逻辑错误或验证预期行为。对于初学者而言，掌握断言的使用能显著提升调试效率和模型可靠性。

## 断言基础

在PRISM中，断言通过 `assert` 关键字实现，语法如下：
```prism
assert "描述" : 条件;
```
- **描述**：可读性标签，用于标识断言。
- **条件**：布尔表达式，当为 `false` 时触发错误。

### 示例：简单断言
```prism
module Example
    x : [0..3] init 0;
    
    [step] x < 3 -> (x' = x + 1);
    [done] x >= 3 -> true;

    // 断言：x不应超过3
    assert "x不超过上限" : x <= 3;
endmodule
```
当 `x` 超过3时，PRISM会报告断言失败。

## 断言的常见用途

### 1. 验证不变量
确保模型状态始终满足某些条件：
```prism
assert "资源不耗尽" : resources >= 0;
```

### 2. 检查转移条件
验证状态转移的合法性：
```prism
[request] queue_size < max_queue -> (queue_size' = queue_size + 1);
assert "队列不溢出" : queue_size <= max_queue;
```

### 3. 调试复杂逻辑
在嵌套条件中定位问题：
```prism
if (x > y) {
    assert "x应大于y" : x > y;
    z := x - y;
} else {
    z := 0;
}
```

## 实际案例：缓存一致性协议

以下是一个简化缓存模型的断言示例，确保数据一致性：
```prism
module Cache
    data_valid : bool init false;
    [load] !data_valid -> (data_valid' = true);
    [invalidate] data_valid -> (data_valid' = false);

    // 断言：无效化操作仅在数据有效时执行
    assert "无效化前提条件" : data_valid | !invalidate;
endmodule
```

## 高级技巧

### 结合概率属性
断言可以与概率计算结合，验证统计特性：
```prism
const double p = 0.9;
assert "高成功率" : P>=p [F success];
```

### 动态条件检查
使用临时变量辅助复杂断言：
```prism
var temp : bool;
temp := (x > 0) & (y < 10);
assert "复合条件" : temp;
```

## 调试断言失败

当断言失败时，PRISM会提供：
1. 失败断言的位置和描述。
2. 导致失败的具体状态值。

:::tip 调试建议
- 使用 `--verbose` 标志运行PRISM，获取详细上下文。
- 逐步缩小模型范围，定位问题根源。
:::

## 总结

断言是PRISM中强大的验证工具，适用于：
- 实时检查模型正确性。
- 捕获非法状态转移。
- 辅助复杂逻辑调试。

## 练习
1. 在现有模型中添加断言，验证所有状态转移的合法性。
2. 尝试结合 `P` 运算符编写概率断言。

## 扩展阅读
- PRISM官方文档：Assertions章节
- 《模型检查》第5章：运行时验证