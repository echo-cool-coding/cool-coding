---
title: PRISM 公式定义
description: 学习如何在PRISM模型检查器中定义和使用概率逻辑公式进行属性规约
---

# PRISM 公式定义

## 介绍

在PRISM概率模型检查器中，**公式定义**是用于规约系统属性的核心机制。这些公式基于概率计算树逻辑(PCTL)、连续随机逻辑(CSL)等扩展时序逻辑，允许你表达诸如"系统在95%的情况下能在5秒内响应"之类的概率性质。

公式定义在PRISM中扮演两个关键角色：
1. 作为属性规约语言，描述需要验证的系统行为
2. 作为模型中的命名常量，提高模型的可读性和可维护性

## 基本语法结构

PRISM公式定义的基本语法如下：

```prism
formula <name> = <expression>;
```

其中：
- `<name>` 是公式的唯一标识符
- `<expression>` 是合法的PRISM表达式，可以包含：
  - 布尔运算符 (`&`, `|`, `!`)
  - 算术比较 (`<`, `<=`, `>`, `>=`, `=`)
  - 概率/时间运算符 (`P`, `S`, `R`)
  - 其他已定义的公式

:::note
公式名称区分大小写且不能与模型中的变量名冲突。
:::

## 基础公式示例

### 布尔公式

定义系统处于"安全状态"的条件：

```prism
formula is_safe = (temperature <= 100) & (pressure <= 200);
```

### 概率公式

定义"系统在10步内达到目标状态的概率至少为0.9"：

```prism
formula reach_goal = P>=0.9 [ F<=10 goal ];
```

### 奖励公式

定义"系统在稳定状态下每小时的预期能耗"：

```prism
formula energy_per_hour = R{"energy"}=? [ S ];
```

## 高级公式特性

### 嵌套公式

公式可以引用其他公式，形成层次化定义：

```prism
formula temp_ok = temperature >= -10 & temperature <= 40;
formula pressure_ok = pressure <= 100;
formula system_ok = temp_ok & pressure_ok;
```

### 参数化公式

PRISM支持带参数的公式，类似于函数：

```prism
formula threshold_breach(x) = (value >= x);
```

使用时可以这样引用：`threshold_breach(5.0)`

## 实际应用案例

### 通信协议案例

考虑一个简单的通信协议模型，我们可以定义以下公式：

```prism
// 定义消息成功传递的条件
formula message_delivered = (sender_state = done) & (receiver_state = received);

// 定义在100个时间单位内传递的概率
formula timely_delivery = P>=0.99 [ F<=100 message_delivered ];

// 定义系统吞吐量（每分钟平均处理的消息数）
formula throughput = R{"messages"}=? [ C<=60 ];
```

### 电池系统案例

对于电池管理系统，可以定义：

```prism
formula battery_low = charge <= 20;
formula battery_critical = charge <= 5;
formula safe_operation = !battery_critical | (backup_power_on & battery_low);

// 电池在耗尽前切换到备用电源的概率
formula safe_transition = P>=0.999 [ !battery_critical U backup_power_on ];
```

## 公式验证流程

在PRISM中使用公式通常遵循以下步骤：

1. 在模型文件中定义公式（或单独的属性文件）
2. 使用PRISM命令行或GUI加载模型
3. 指定要验证的公式
4. 分析验证结果

例如验证上面定义的`timely_delivery`公式：

```bash
prism protocol.prism -pf formula.props
```

其中`formula.props`内容为：

```prism
// 要验证的公式列表
P>=0.99 [ F<=100 message_delivered ]
```

## 常见错误与调试

初学者常遇到的问题包括：

1. **未定义的标识符**：确保公式中引用的所有变量都已正确定义
   ```prism
   // 错误：undefined_var未定义
   formula error = (undefined_var > 0);
   ```

2. **循环引用**：公式不能直接或间接引用自身
   ```prism
   // 错误：循环引用
   formula A = B;
   formula B = A;
   ```

3. **类型不匹配**：确保比较操作的两边类型兼容
   ```prism
   // 错误：比较布尔值和数值
   formula error = (state = active) > 5;
   ```

:::tip 调试建议
使用PRISM的`-verbose`选项查看详细的公式解析过程，帮助定位问题。
:::

## 总结

PRISM公式定义提供了强大的方式来规约和分析概率系统的行为属性。通过本教程，你应该已经掌握：

✓ 公式定义的基本语法结构<br />
✓ 布尔、概率和奖励公式的创建方法<br />
✓ 高级特性如嵌套和参数化公式<br />
✓ 实际应用中的典型案例<br />
✓ 常见错误的识别与解决方法

## 延伸学习

要进一步探索PRISM公式定义，可以参考：

1. PRISM官方手册中的"Property Specification"章节
2. 概率计算树逻辑(PCTL)的形式化定义
3. 模型检查中的时间逻辑专题

尝试以下练习巩固知识：

1. 为交通灯系统定义"不会同时出现两个方向绿灯"的安全属性
2. 创建一个参数化公式，表达"在t时间单位内达到稳定状态"
3. 设计一个奖励公式，计算系统在故障前的平均运行时间