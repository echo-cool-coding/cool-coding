---
title: R数据透视
description: 学习如何使用R语言进行数据透视，掌握数据汇总和分析的基本技巧。
---

# R数据透视

数据透视（Pivoting）是数据分析中的一项重要技术，它允许我们重新排列和汇总数据，以便更好地理解和分析数据。在R语言中，数据透视通常用于将长格式数据转换为宽格式，或者反之。这对于数据可视化、统计分析和报告生成非常有用。

## 什么是数据透视？

数据透视是指将数据表中的行和列进行重新排列，以便更好地展示数据的某些特征。例如，你可能有一个包含销售数据的长格式表格，其中每一行代表一个销售记录。通过数据透视，你可以将这些数据转换为宽格式，其中每一行代表一个产品，每一列代表一个时间段，单元格中的值则是该产品在该时间段的销售总额。

## R中的数据透视工具

在R中，`tidyverse`包中的`tidyr`和`dplyr`包提供了强大的数据透视功能。`tidyr`包中的`pivot_longer()`和`pivot_wider()`函数是进行数据透视的主要工具。

### `pivot_longer()` 和 `pivot_wider()`

- `pivot_longer()`：将宽格式数据转换为长格式。
- `pivot_wider()`：将长格式数据转换为宽格式。

## 代码示例

### 示例1：使用 `pivot_longer()` 将宽格式数据转换为长格式

假设我们有以下宽格式数据：

```r
library(tidyr)
library(dplyr)

# 创建示例数据
sales_data <- data.frame(
  Product = c("A", "B", "C"),
  Q1 = c(100, 150, 200),
  Q2 = c(110, 160, 210),
  Q3 = c(120, 170, 220),
  Q4 = c(130, 180, 230)
)

# 查看数据
print(sales_data)
```

输出：

```
  Product  Q1  Q2  Q3  Q4
1       A 100 110 120 130
2       B 150 160 170 180
3       C 200 210 220 230
```

现在，我们使用 `pivot_longer()` 将数据转换为长格式：

```r
long_data <- sales_data %>%
  pivot_longer(cols = starts_with("Q"), names_to = "Quarter", values_to = "Sales")

# 查看转换后的数据
print(long_data)
```

输出：

```
# A tibble: 12 × 3
   Product Quarter Sales
   <chr>   <chr>   <dbl>
 1 A       Q1        100
 2 A       Q2        110
 3 A       Q3        120
 4 A       Q4        130
 5 B       Q1        150
 6 B       Q2        160
 7 B       Q3        170
 8 B       Q4        180
 9 C       Q1        200
10 C       Q2        210
11 C       Q3        220
12 C       Q4        230
```

### 示例2：使用 `pivot_wider()` 将长格式数据转换为宽格式

假设我们有以下长格式数据：

```r
long_data <- data.frame(
  Product = rep(c("A", "B", "C"), each = 4),
  Quarter = rep(c("Q1", "Q2", "Q3", "Q4"), times = 3),
  Sales = c(100, 110, 120, 130, 150, 160, 170, 180, 200, 210, 220, 230)
)

# 查看数据
print(long_data)
```

输出：

```
   Product Quarter Sales
1        A      Q1   100
2        A      Q2   110
3        A      Q3   120
4        A      Q4   130
5        B      Q1   150
6        B      Q2   160
7        B      Q3   170
8        B      Q4   180
9        C      Q1   200
10       C      Q2   210
11       C      Q3   220
12       C      Q4   230
```

现在，我们使用 `pivot_wider()` 将数据转换为宽格式：

```r
wide_data <- long_data %>%
  pivot_wider(names_from = Quarter, values_from = Sales)

# 查看转换后的数据
print(wide_data)
```

输出：

```
# A tibble: 3 × 5
  Product    Q1    Q2    Q3    Q4
  <chr>   <dbl> <dbl> <dbl> <dbl>
1 A         100   110   120   130
2 B         150   160   170   180
3 C         200   210   220   230
```

## 实际应用场景

### 场景1：销售数据分析

假设你有一份包含多个产品在不同季度的销售数据。通过数据透视，你可以轻松地计算每个产品的年度销售总额，或者比较不同产品在不同季度的销售表现。

### 场景2：学生成绩分析

假设你有一份包含多个学生在不同科目上的成绩数据。通过数据透视，你可以将数据转换为每个学生的总成绩，或者每个科目的平均成绩，从而更好地分析学生的表现。

## 总结

数据透视是数据分析中的一项重要技术，它可以帮助我们更好地理解和分析数据。在R语言中，`tidyr`包中的`pivot_longer()`和`pivot_wider()`函数是实现数据透视的强大工具。通过掌握这些工具，你可以轻松地将数据从长格式转换为宽格式，或者反之，从而更好地进行数据分析和可视化。

## 附加资源

- [R for Data Science](https://r4ds.had.co.nz/)：一本关于R语言数据科学的经典书籍，其中包含关于数据透视的详细讲解。
- [Tidyverse官方文档](https://www.tidyverse.org/)：`tidyverse`包的官方文档，包含`tidyr`和`dplyr`的详细使用说明。

## 练习

1. 使用`pivot_longer()`将以下宽格式数据转换为长格式：

```r
data <- data.frame(
  ID = c(1, 2, 3),
  Jan = c(10, 20, 30),
  Feb = c(15, 25, 35),
  Mar = c(20, 30, 40)
)
```

2. 使用`pivot_wider()`将以下长格式数据转换为宽格式：

```r
data <- data.frame(
  ID = rep(c(1, 2, 3), each = 3),
  Month = rep(c("Jan", "Feb", "Mar"), times = 3),
  Value = c(10, 15, 20, 20, 25, 30, 30, 35, 40)
)
```

通过完成这些练习，你将更好地掌握R中的数据透视技术。