---
title: YARN节点标签
description: 了解YARN节点标签的概念、用途以及如何在Hadoop集群中使用它们来优化资源分配。
---

# YARN节点标签

## 介绍

YARN（Yet Another Resource Negotiator）是Hadoop生态系统中的资源管理框架，负责集群资源的分配和调度。YARN节点标签（Node Labels）是YARN提供的一种功能，允许用户为集群中的节点分配标签，从而更精细地控制资源分配和任务调度。

通过节点标签，用户可以将集群中的节点划分为不同的逻辑组，并为每个组分配特定的资源。例如，可以将某些节点标记为“高优先级”或“低优先级”，从而确保关键任务在资源充足的节点上运行。

## 节点标签的基本概念

### 什么是节点标签？

节点标签是用户定义的标签，用于标识集群中的节点。每个节点可以有一个或多个标签，这些标签可以用来区分节点的特性或用途。例如：

- **高优先级节点**：用于运行关键任务。
- **低优先级节点**：用于运行非关键任务。
- **GPU节点**：用于运行需要GPU加速的任务。

### 节点标签的类型

YARN支持两种类型的节点标签：

1. **独占标签（Exclusive Labels）**：节点只能属于一个独占标签。这意味着如果一个节点被标记为“高优先级”，它就不能同时被标记为“低优先级”。
2. **共享标签（Shared Labels）**：节点可以属于多个共享标签。例如，一个节点可以同时被标记为“高优先级”和“GPU节点”。

## 如何配置节点标签

### 1. 启用节点标签功能

首先，需要在YARN的配置文件中启用节点标签功能。编辑 `yarn-site.xml` 文件，添加以下配置：

```xml
<property>
  <name>yarn.node-labels.enabled</name>
  <value>true</value>
</property>
```

### 2. 创建节点标签

使用YARN的命令行工具可以创建节点标签。例如，创建一个名为“high_priority”的独占标签：

```bash
yarn rmadmin -addToClusterNodeLabels "high_priority(exclusive=true)"
```

### 3. 将节点分配到标签

接下来，将特定的节点分配到标签。例如，将节点 `node1` 分配到“high_priority”标签：

```bash
yarn rmadmin -replaceLabelsOnNode "node1=high_priority"
```

## 使用节点标签调度任务

### 1. 提交任务时指定标签

在提交任务时，可以通过 `-D` 参数指定任务所需的节点标签。例如，提交一个需要“high_priority”标签的任务：

```bash
hadoop jar myjob.jar -D yarn.scheduler.capacity.root.queues.myqueue.accessible-node-labels=high_priority
```

### 2. 查看节点标签状态

可以使用以下命令查看集群中节点标签的状态：

```bash
yarn node -list
```

输出将显示每个节点的标签信息。

## 实际应用场景

### 场景1：优先级调度

假设你有一个包含100个节点的集群，其中20个节点被标记为“high_priority”，80个节点被标记为“low_priority”。你可以将关键任务提交到“high_priority”队列，确保这些任务在资源充足的节点上运行，而非关键任务则可以在“low_priority”节点上运行。

### 场景2：GPU加速任务

如果你有一些节点配备了GPU，可以将这些节点标记为“gpu”。然后，在提交需要GPU加速的任务时，指定“gpu”标签，确保任务在GPU节点上运行。

## 总结

YARN节点标签是优化Hadoop集群资源分配和任务调度的强大工具。通过为节点分配标签，用户可以更精细地控制任务的运行环境，确保关键任务获得足够的资源，同时充分利用集群的硬件资源。

## 附加资源

- [YARN官方文档](https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/NodeLabel.html)
- [Hadoop集群管理指南](https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/ClusterSetup.html)

## 练习

1. 在你的Hadoop集群中启用节点标签功能，并创建一个名为“gpu”的独占标签。
2. 将集群中的某些节点分配到“gpu”标签，并提交一个需要GPU加速的任务。
3. 使用 `yarn node -list` 命令查看节点标签的状态，并验证任务是否在正确的节点上运行。
