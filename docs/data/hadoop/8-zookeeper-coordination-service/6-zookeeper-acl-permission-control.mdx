---
title: ZooKeeper ACL权限控制
description: "了解ZooKeeper的ACL权限控制机制，掌握如何通过ACL保护ZooKeeper节点数据的安全性。"
---

# ZooKeeper ACL权限控制

ZooKeeper是一个分布式协调服务，广泛应用于分布式系统中。为了保证数据的安全性，ZooKeeper提供了ACL（Access Control List，访问控制列表）权限控制机制。通过ACL，你可以精确控制哪些用户或系统可以访问或修改ZooKeeper中的节点数据。

## 什么是ACL？

ACL是ZooKeeper中用于控制节点访问权限的机制。每个ZooKeeper节点都可以关联一个ACL列表，列表中定义了哪些用户或系统可以执行哪些操作。ACL权限控制的核心思想是“谁可以做什么”。

### ACL的组成

每个ACL条目由以下三部分组成：

1. **Scheme**：定义权限的验证方式。常见的Scheme包括：
   - `world`：默认权限，所有用户都可以访问。
   - `auth`：已认证的用户（通过`addauth`命令认证的用户）。
   - `digest`：基于用户名和密码的认证。
   - `ip`：基于IP地址的认证。

2. **ID**：与Scheme相关的标识符。例如：
   - 对于`digest`，ID是用户名和密码的哈希值。
   - 对于`ip`，ID是IP地址或IP段。

3. **Permissions**：定义允许的操作。ZooKeeper支持以下权限：
   - `CREATE`：允许创建子节点。
   - `READ`：允许读取节点数据及子节点列表。
   - `WRITE`：允许修改节点数据。
   - `DELETE`：允许删除子节点。
   - `ADMIN`：允许设置节点的ACL。

## 如何使用ACL？

### 1. 设置节点的ACL

在创建或修改节点时，可以通过`create`或`setAcl`命令设置ACL。以下是一个使用`digest` Scheme设置ACL的示例：

```bash
# 创建节点并设置ACL
create /myNode "myData" digest:user1:password1:cdrwa
```

:::note
`cdrwa`是权限的简写，分别对应`CREATE`、`READ`、`WRITE`、`DELETE`和`ADMIN`。
:::

### 2. 认证用户

在使用`digest` Scheme时，客户端需要通过`addauth`命令进行认证：

```bash
# 认证用户
addauth digest user1:password1
```

### 3. 查看节点的ACL

可以使用`getAcl`命令查看节点的ACL：

```bash
# 查看节点的ACL
getAcl /myNode
```

输出示例：

```plaintext
'digest,'user1:password1
: cdrwa
```

### 4. 修改节点的ACL

可以使用`setAcl`命令修改节点的ACL：

```bash
# 修改节点的ACL
setAcl /myNode digest:user2:password2:rwa
```

## 实际应用场景

### 场景1：多用户协作

假设你有一个分布式系统，多个团队需要访问ZooKeeper中的不同节点。你可以为每个团队设置不同的ACL，确保他们只能访问和修改自己负责的节点。

```bash
# 为团队A设置ACL
create /teamA/data "Team A Data" digest:teamA:passwordA:cdrwa

# 为团队B设置ACL
create /teamB/data "Team B Data" digest:teamB:passwordB:cdrwa
```

### 场景2：限制IP访问

如果你希望只有特定IP范围的客户端可以访问某个节点，可以使用`ip` Scheme：

```bash
# 限制只有192.168.1.0/24网段的客户端可以访问
create /secureNode "Secure Data" ip:192.168.1.0/24:rwa
```

## 总结

ZooKeeper的ACL权限控制机制为分布式系统中的数据安全提供了重要保障。通过合理设置ACL，你可以精确控制哪些用户或系统可以访问或修改ZooKeeper节点数据。掌握ACL的使用方法，能够帮助你更好地管理和保护分布式系统中的数据。

## 附加资源与练习

- **练习1**：创建一个ZooKeeper节点，并使用`digest` Scheme设置ACL，然后尝试通过认证访问该节点。
- **练习2**：使用`ip` Scheme限制某个节点只能由特定IP地址的客户端访问。
- **参考文档**：[ZooKeeper官方文档](https://zookeeper.apache.org/doc/current/zookeeperProgrammers.html#sc_ZooKeeperAccessControl)