---
title: Pandas 时间特征提取
description: 学习如何使用Pandas从时间序列数据中提取有用的时间特征，例如年、月、日、小时等，并应用于实际数据分析场景。
---

# Pandas 时间特征提取

在数据分析中，时间序列数据是非常常见的。Pandas提供了强大的工具来处理时间序列数据，并从中提取有用的时间特征。这些特征可以帮助我们更好地理解数据，并为后续的分析和建模提供支持。

## 什么是时间特征提取？

时间特征提取是指从时间戳或日期时间数据中提取出有意义的特征，例如年、月、日、小时、分钟、星期几等。这些特征可以用于数据分析、可视化、机器学习模型的特征工程等。

## 基本时间特征提取

首先，我们需要确保我们的数据中包含日期时间列。Pandas提供了`to_datetime`函数，可以将字符串或整数转换为`datetime`对象。

```python
import pandas as pd

# 创建一个包含日期时间的数据框
data = {
    'date': ['2023-01-01', '2023-02-01', '2023-03-01'],
    'value': [10, 20, 30]
}
df = pd.DataFrame(data)

# 将 'date' 列转换为 datetime 类型
df['date'] = pd.to_datetime(df['date'])

print(df)
```

输出：
```
        date  value
0 2023-01-01     10
1 2023-02-01     20
2 2023-03-01     30
```

现在，我们可以从`date`列中提取各种时间特征。

### 提取年、月、日

```python
df['year'] = df['date'].dt.year
df['month'] = df['date'].dt.month
df['day'] = df['date'].dt.day

print(df)
```

输出：
```
        date  value  year  month  day
0 2023-01-01     10  2023      1    1
1 2023-02-01     20  2023      2    1
2 2023-03-01     30  2023      3    1
```

### 提取星期几

```python
df['weekday'] = df['date'].dt.weekday  # 星期一为0，星期日为6

print(df)
```

输出：
```
        date  value  year  month  day  weekday
0 2023-01-01     10  2023      1    1        6
1 2023-02-01     20  2023      2    1        2
2 2023-03-01     30  2023      3    1        2
```

:::tip
`dt.weekday`返回的是整数，0表示星期一，6表示星期日。如果你想得到星期几的名称，可以使用`dt.day_name()`。
:::

## 高级时间特征提取

除了基本的年、月、日等特征，我们还可以提取更多复杂的时间特征。

### 提取季度

```python
df['quarter'] = df['date'].dt.quarter

print(df)
```

输出：
```
        date  value  year  month  day  weekday  quarter
0 2023-01-01     10  2023      1    1        6        1
1 2023-02-01     20  2023      2    1        2        1
2 2023-03-01     30  2023      3    1        2        1
```

### 提取一年中的第几天

```python
df['dayofyear'] = df['date'].dt.dayofyear

print(df)
```

输出：
```
        date  value  year  month  day  weekday  quarter  dayofyear
0 2023-01-01     10  2023      1    1        6        1          1
1 2023-02-01     20  2023      2    1        2        1         32
2 2023-03-01     30  2023      3    1        2        1         60
```

### 提取小时、分钟、秒

如果你的数据中包含时间信息，你还可以提取小时、分钟、秒等特征。

```python
# 添加时间信息
df['datetime'] = pd.to_datetime(['2023-01-01 12:30:45', '2023-02-01 14:45:30', '2023-03-01 08:15:00'])

df['hour'] = df['datetime'].dt.hour
df['minute'] = df['datetime'].dt.minute
df['second'] = df['datetime'].dt.second

print(df)
```

输出：
```
             datetime  value  year  month  day  weekday  quarter  dayofyear  hour  minute  second
0 2023-01-01 12:30:45     10  2023      1    1        6        1          1    12      30      45
1 2023-02-01 14:45:30     20  2023      2    1        2        1         32    14      45      30
2 2023-03-01 08:15:00     30  2023      3    1        2        1         60     8      15       0
```

## 实际应用场景

### 销售数据分析

假设你有一份销售数据，其中包含每天的销售额。你可以通过提取时间特征来分析销售趋势。

```python
# 假设我们有一份销售数据
sales_data = {
    'date': pd.date_range(start='2023-01-01', periods=365, freq='D'),
    'sales': np.random.randint(100, 1000, size=365)
}
sales_df = pd.DataFrame(sales_data)

# 提取时间特征
sales_df['year'] = sales_df['date'].dt.year
sales_df['month'] = sales_df['date'].dt.month
sales_df['day'] = sales_df['date'].dt.day
sales_df['weekday'] = sales_df['date'].dt.weekday

# 按月份汇总销售额
monthly_sales = sales_df.groupby('month')['sales'].sum()

print(monthly_sales)
```

输出：
```
month
1     14567
2     13245
3     14890
...
12    15678
Name: sales, dtype: int64
```

通过提取月份特征并按月份汇总销售额，我们可以轻松地分析每个月的销售趋势。

## 总结

在本文中，我们学习了如何使用Pandas从时间序列数据中提取各种时间特征。这些特征可以帮助我们更好地理解数据，并为后续的分析和建模提供支持。无论是基本的年、月、日，还是更复杂的季度、星期几等特征，Pandas都提供了简单易用的方法来实现。

## 附加资源与练习

- **练习1**：尝试从你的数据集中提取更多的时间特征，例如一年中的第几周、是否为周末等。
- **练习2**：使用提取的时间特征进行数据可视化，例如绘制每月的销售额趋势图。
- **附加资源**：阅读Pandas官方文档中关于时间序列处理的部分，了解更多高级功能。

:::note
Pandas的时间处理功能非常强大，除了本文介绍的内容外，还包括时区处理、时间差计算、时间重采样等。建议深入学习这些内容以充分利用Pandas的时间序列处理能力。
:::