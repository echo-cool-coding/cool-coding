---
title: Pandas 数据展开
description: 学习如何使用 Pandas 进行数据展开操作，掌握如何将数据从长格式转换为宽格式，以及在实际应用中的使用场景。
---

# Pandas 数据展开

在数据分析和处理中，数据的格式可能会影响我们进行分析的方式。Pandas 提供了强大的工具来帮助我们重塑数据，其中**数据展开**是一个重要的操作。数据展开通常用于将长格式的数据转换为宽格式，以便更好地进行可视化和分析。

## 什么是数据展开？

数据展开（Data Pivoting）是指将数据从长格式（Long Format）转换为宽格式（Wide Format）的过程。长格式的数据通常是指每一行代表一个观察值，而宽格式的数据则是指每一列代表一个变量。

例如，假设我们有一个数据集，记录了不同城市在不同日期的温度：

| 城市   | 日期       | 温度 |
| ------ | ---------- | ---- |
| 北京   | 2023-10-01 | 20   |
| 北京   | 2023-10-02 | 22   |
| 上海   | 2023-10-01 | 25   |
| 上海   | 2023-10-02 | 24   |

通过数据展开，我们可以将这个数据集转换为宽格式，使得每一列代表一个日期的温度：

| 城市   | 2023-10-01 | 2023-10-02 |
| ------ | ---------- | ---------- |
| 北京   | 20         | 22         |
| 上海   | 25         | 24         |

## 使用 Pandas 进行数据展开

Pandas 提供了 `pivot` 函数来实现数据展开操作。下面我们通过一个具体的例子来演示如何使用 `pivot` 函数。

### 示例：将长格式数据转换为宽格式

假设我们有以下数据集：

```python
import pandas as pd

data = {
    '城市': ['北京', '北京', '上海', '上海'],
    '日期': ['2023-10-01', '2023-10-02', '2023-10-01', '2023-10-02'],
    '温度': [20, 22, 25, 24]
}

df = pd.DataFrame(data)
print(df)
```

输出：

```
   城市        日期  温度
0  北京  2023-10-01  20
1  北京  2023-10-02  22
2  上海  2023-10-01  25
3  上海  2023-10-02  24
```

我们可以使用 `pivot` 函数将数据展开为宽格式：

```python
pivot_df = df.pivot(index='城市', columns='日期', values='温度')
print(pivot_df)
```

输出：

```
日期    2023-10-01  2023-10-02
城市                            
北京           20          22
上海           25          24
```

在这个例子中，`index` 参数指定了行索引，`columns` 参数指定了列索引，`values` 参数指定了填充到表格中的值。

### 处理重复值

在实际应用中，数据集中可能存在重复值。例如，假设我们有以下数据集：

```python
data = {
    '城市': ['北京', '北京', '上海', '上海', '北京'],
    '日期': ['2023-10-01', '2023-10-02', '2023-10-01', '2023-10-02', '2023-10-01'],
    '温度': [20, 22, 25, 24, 21]
}

df = pd.DataFrame(data)
print(df)
```

输出：

```
   城市        日期  温度
0  北京  2023-10-01  20
1  北京  2023-10-02  22
2  上海  2023-10-01  25
3  上海  2023-10-02  24
4  北京  2023-10-01  21
```

在这个数据集中，北京在 2023-10-01 有两个温度值。如果我们直接使用 `pivot` 函数，Pandas 会抛出错误，因为它无法处理重复值。为了解决这个问题，我们可以使用 `pivot_table` 函数，并指定一个聚合函数（如 `mean`）来处理重复值：

```python
pivot_df = df.pivot_table(index='城市', columns='日期', values='温度', aggfunc='mean')
print(pivot_df)
```

输出：

```
日期    2023-10-01  2023-10-02
城市                            
北京         20.5          22
上海         25.0          24
```

在这个例子中，我们使用 `aggfunc='mean'` 来计算重复值的平均值。

## 实际应用场景

数据展开在实际应用中有很多场景，例如：

1. **时间序列分析**：将时间序列数据从长格式转换为宽格式，以便更好地进行趋势分析和可视化。
2. **数据透视表**：在 Excel 中，数据透视表是一种常见的数据分析工具，Pandas 的 `pivot_table` 函数可以实现类似的功能。
3. **数据可视化**：宽格式的数据通常更适合用于绘制图表，例如热力图、折线图等。

## 总结

数据展开是 Pandas 中一个非常有用的功能，它可以帮助我们将数据从长格式转换为宽格式，以便更好地进行分析和可视化。通过 `pivot` 和 `pivot_table` 函数，我们可以轻松地实现这一操作。

:::tip
在实际应用中，如果数据集中存在重复值，记得使用 `pivot_table` 并指定一个合适的聚合函数来处理重复值。
:::

## 附加资源与练习

- **练习**：尝试使用 Pandas 的 `pivot` 和 `pivot_table` 函数处理你自己的数据集，看看如何将长格式数据转换为宽格式。
- **资源**：你可以参考 [Pandas 官方文档](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pivot.html) 来了解更多关于数据展开的详细信息。

希望这篇内容能帮助你更好地理解 Pandas 中的数据展开操作！如果你有任何问题，欢迎在评论区留言。