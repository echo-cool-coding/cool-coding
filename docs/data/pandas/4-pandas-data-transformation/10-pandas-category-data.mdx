---
title: Pandas 类别数据
description: 了解Pandas中的类别数据类型，掌握如何高效处理分类数据，并通过实际案例展示其应用场景。
---

# Pandas 类别数据

在数据分析和处理中，分类数据（Categorical Data）是一种常见的数据类型。它通常用于表示具有有限且固定数量的可能值的变量，例如性别、产品类别、地区等。Pandas 提供了 `category` 数据类型，专门用于处理这类数据。本文将详细介绍 Pandas 中的类别数据类型，并通过代码示例和实际案例帮助你掌握其使用方法。

## 什么是类别数据？

类别数据是一种特殊的数据类型，用于表示具有离散值的变量。与字符串或整数类型不同，类别数据在内存中存储时会被优化，从而提高性能和效率。Pandas 的 `category` 类型允许我们将数据标记为分类数据，并对其进行高效的操作。

### 类别数据的优势

1. **内存效率**：类别数据在内存中存储的是类别代码，而不是原始值，因此可以显著减少内存占用。
2. **性能提升**：对类别数据进行排序、分组等操作时，Pandas 会利用其内部优化机制，从而提高计算速度。
3. **语义清晰**：类别数据可以更好地表达数据的含义，例如将性别标记为“男”或“女”而不是使用数字编码。

## 创建类别数据

在 Pandas 中，我们可以通过多种方式将数据转换为类别类型。以下是一些常见的创建类别数据的方法。

### 1. 使用 `astype` 方法

我们可以使用 `astype` 方法将现有的列转换为类别类型。

```python
import pandas as pd

# 创建一个包含分类数据的DataFrame
data = {'gender': ['male', 'female', 'male', 'female', 'male']}
df = pd.DataFrame(data)

# 将 'gender' 列转换为类别类型
df['gender'] = df['gender'].astype('category')

print(df['gender'])
```

**输出：**

```
0      male
1    female
2      male
3    female
4      male
Name: gender, dtype: category
Categories (2, object): ['female', 'male']
```

### 2. 使用 `pd.Categorical` 函数

我们还可以使用 `pd.Categorical` 函数直接创建类别数据。

```python
# 使用 pd.Categorical 创建类别数据
categories = pd.Categorical(['A', 'B', 'C', 'A', 'B'], categories=['A', 'B', 'C'])

print(categories)
```

**输出：**

```
['A', 'B', 'C', 'A', 'B']
Categories (3, object): ['A', 'B', 'C']
```

## 类别数据的操作

### 1. 查看类别

我们可以使用 `.cat.categories` 属性查看类别数据的所有可能值。

```python
print(df['gender'].cat.categories)
```

**输出：**

```
Index(['female', 'male'], dtype='object')
```

### 2. 添加新类别

我们可以使用 `.cat.add_categories` 方法向类别数据中添加新的类别。

```python
df['gender'] = df['gender'].cat.add_categories(['unknown'])
print(df['gender'].cat.categories)
```

**输出：**

```
Index(['female', 'male', 'unknown'], dtype='object')
```

### 3. 删除未使用的类别

如果某些类别在数据中没有被使用，我们可以使用 `.cat.remove_unused_categories` 方法将其删除。

```python
df['gender'] = df['gender'].cat.remove_unused_categories()
print(df['gender'].cat.categories)
```

**输出：**

```
Index(['female', 'male'], dtype='object')
```

## 实际案例：分析产品类别

假设我们有一个包含产品类别的数据集，我们希望分析每个类别的销售情况。

```python
# 创建示例数据
data = {
    'product': ['A', 'B', 'C', 'A', 'B', 'C'],
    'sales': [100, 200, 150, 300, 250, 400]
}
df = pd.DataFrame(data)

# 将 'product' 列转换为类别类型
df['product'] = df['product'].astype('category')

# 按类别分组并计算总销售额
sales_by_category = df.groupby('product')['sales'].sum()

print(sales_by_category)
```

**输出：**

```
product
A    400
B    450
C    550
Name: sales, dtype: int64
```

在这个案例中，我们将产品类别转换为 `category` 类型，并通过分组操作快速计算了每个类别的总销售额。

## 总结

Pandas 的 `category` 数据类型为处理分类数据提供了强大的工具。通过将数据标记为类别类型，我们可以显著提高内存效率和计算性能。本文介绍了如何创建和操作类别数据，并通过实际案例展示了其应用场景。

:::tip
**提示**：在处理具有有限且固定数量的可能值的数据时，考虑将其转换为类别类型，以获得更好的性能和内存效率。
:::

## 附加资源与练习

1. **练习**：尝试将你自己的数据集中的某一列转换为类别类型，并观察内存使用情况的变化。
2. **进一步学习**：阅读 Pandas 官方文档中关于 [类别数据](https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html) 的更多内容，深入了解其高级功能。

通过掌握 Pandas 的类别数据类型，你将能够更高效地处理和分析分类数据，为你的数据分析工作带来更多便利。