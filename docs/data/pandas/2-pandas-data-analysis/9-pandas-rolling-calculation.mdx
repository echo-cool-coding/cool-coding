---
title: Pandas 滚动计算
description: 学习如何使用Pandas进行滚动计算，掌握时间序列数据分析中的移动窗口技术。
---

# Pandas 滚动计算

在数据分析中，滚动计算（Rolling Calculation）是一种常见的技术，用于在时间序列数据或有序数据上执行移动窗口计算。Pandas库提供了强大的工具来实现这一功能，使得我们能够轻松地对数据进行滑动窗口分析。

## 什么是滚动计算？

滚动计算是指在数据上定义一个固定大小的窗口，然后在这个窗口内执行某种计算（如求和、平均值、标准差等）。窗口会随着数据的移动而滑动，从而生成一系列计算结果。这种方法特别适用于时间序列数据，例如股票价格、气温变化等。

## 基本用法

Pandas中的`rolling()`方法用于创建滚动窗口对象。我们可以在这个对象上应用各种聚合函数，如`mean()`、`sum()`、`std()`等。

### 示例1：简单滚动平均值

假设我们有一个包含每日气温的时间序列数据，我们想要计算过去7天的平均气温。

```python
import pandas as pd

# 创建示例数据
data = {'date': pd.date_range(start='2023-01-01', periods=10, freq='D'),
        'temperature': [22, 24, 25, 23, 21, 20, 19, 18, 17, 16]}
df = pd.DataFrame(data)

# 计算7天滚动平均值
df['7_day_avg'] = df['temperature'].rolling(window=7).mean()

print(df)
```

**输出：**

```
        date  temperature  7_day_avg
0 2023-01-01           22        NaN
1 2023-01-02           24        NaN
2 2023-01-03           25        NaN
3 2023-01-04           23        NaN
4 2023-01-05           21        NaN
5 2023-01-06           20        NaN
6 2023-01-07           19  22.000000
7 2023-01-08           18  21.428571
8 2023-01-09           17  20.571429
9 2023-01-10           16  19.714286
```

:::note
注意：在前6行中，`7_day_avg`列的值为`NaN`，因为窗口大小为7，前6行没有足够的数据来计算7天滚动平均值。
:::

### 示例2：滚动标准差

除了平均值，我们还可以计算滚动标准差，以衡量数据的波动性。

```python
df['7_day_std'] = df['temperature'].rolling(window=7).std()

print(df)
```

**输出：**

```
        date  temperature  7_day_avg  7_day_std
0 2023-01-01           22        NaN        NaN
1 2023-01-02           24        NaN        NaN
2 2023-01-03           25        NaN        NaN
3 2023-01-04           23        NaN        NaN
4 2023-01-05           21        NaN        NaN
5 2023-01-06           20        NaN        NaN
6 2023-01-07           19  22.000000   2.160247
7 2023-01-08           18  21.428571   2.507133
8 2023-01-09           17  20.571429   2.878492
9 2023-01-10           16  19.714286   3.093772
```

## 实际应用场景

### 股票价格分析

滚动计算在金融数据分析中非常有用。例如，我们可以计算股票的20天移动平均线（MA），以帮助判断股票价格的趋势。

```python
# 假设我们有一个包含股票价格的数据框
stock_data = {'date': pd.date_range(start='2023-01-01', periods=30, freq='D'),
              'price': [100, 102, 101, 103, 105, 107, 106, 108, 110, 112, 
                        115, 114, 116, 118, 120, 119, 121, 123, 125, 124, 
                        126, 128, 130, 132, 134, 136, 138, 140, 142, 144]}
df_stock = pd.DataFrame(stock_data)

# 计算20天移动平均线
df_stock['20_day_MA'] = df_stock['price'].rolling(window=20).mean()

print(df_stock.tail())
```

**输出：**

```
         date  price  20_day_MA
25 2023-01-26    136  120.5
26 2023-01-27    138  122.5
27 2023-01-28    140  124.5
28 2023-01-29    142  126.5
29 2023-01-30    144  128.5
```

:::tip
移动平均线是技术分析中常用的工具，用于平滑价格波动并识别趋势。
:::

## 总结

滚动计算是Pandas中一个强大的功能，特别适用于时间序列数据分析。通过定义窗口大小，我们可以在数据上执行各种滑动窗口计算，如平均值、标准差等。这些计算在金融、气象、销售等领域都有广泛的应用。

## 附加资源与练习

- **练习1**：创建一个包含100个随机数的数据框，计算其10天滚动平均值和滚动标准差。
- **练习2**：使用真实股票数据（可以从Yahoo Finance下载），计算50天和200天移动平均线，并观察它们如何反映股票价格的趋势。

:::caution
在实际应用中，确保数据的连续性和完整性非常重要。缺失值可能会影响滚动计算的结果。
:::

希望这篇内容能帮助你更好地理解Pandas中的滚动计算，并在实际项目中应用这一技术！