---
title: Pandas 分组操作
description: 学习如何使用Pandas进行分组操作，掌握数据分组、聚合和转换的基本技巧，并通过实际案例加深理解。
---

# Pandas 分组操作

在数据分析中，分组操作是一种非常强大的工具，它允许我们根据某些条件将数据分成不同的组，然后对每个组进行独立的分析或操作。Pandas库提供了灵活且高效的分组功能，使得处理复杂的数据集变得更加简单。

## 什么是分组操作？

分组操作是指将数据集按照某些列的值进行分组，然后对每个组应用聚合、转换或过滤等操作。例如，假设我们有一个销售数据集，我们可以按照“地区”列进行分组，然后计算每个地区的总销售额。

## 基本分组操作

在Pandas中，分组操作通常使用 `groupby()` 方法来实现。以下是一个简单的示例：

```python
import pandas as pd

# 创建一个示例数据集
data = {
    '地区': ['北京', '上海', '北京', '上海', '北京', '上海'],
    '销售额': [100, 150, 200, 250, 300, 350]
}

df = pd.DataFrame(data)

# 按照“地区”列进行分组，并计算每个地区的总销售额
grouped = df.groupby('地区')['销售额'].sum()

print(grouped)
```

**输出：**
```
地区
北京    600
上海    750
Name: 销售额, dtype: int64
```

在这个例子中，我们按照“地区”列对数据进行了分组，并计算了每个地区的总销售额。

## 分组后的聚合操作

分组后，我们可以对每个组应用各种聚合函数，如 `sum()`、`mean()`、`count()` 等。以下是一些常见的聚合操作示例：

```python
# 计算每个地区的平均销售额
mean_sales = df.groupby('地区')['销售额'].mean()

# 计算每个地区的销售记录数
count_sales = df.groupby('地区')['销售额'].count()

print("平均销售额：\n", mean_sales)
print("\n销售记录数：\n", count_sales)
```

**输出：**
```
平均销售额：
 地区
北京    200.0
上海    250.0
Name: 销售额, dtype: float64

销售记录数：
 地区
北京    3
上海    3
Name: 销售额, dtype: int64
```

## 分组后的转换操作

除了聚合操作，我们还可以对分组后的数据进行转换。例如，我们可以计算每个地区销售额的标准化值：

```python
# 计算每个地区销售额的标准化值
df['标准化销售额'] = df.groupby('地区')['销售额'].transform(lambda x: (x - x.mean()) / x.std())

print(df)
```

**输出：**
```
   地区  销售额  标准化销售额
0  北京   100   -1.224745
1  上海   150   -1.224745
2  北京   200    0.000000
3  上海   250    0.000000
4  北京   300    1.224745
5  上海   350    1.224745
```

在这个例子中，我们使用 `transform()` 方法对每个地区的销售额进行了标准化处理。

## 实际案例：分析销售数据

假设我们有一个包含多个地区销售记录的CSV文件，我们需要分析每个地区的销售情况。以下是一个完整的示例：

```python
import pandas as pd

# 读取CSV文件
df = pd.read_csv('sales_data.csv')

# 按照“地区”列进行分组，并计算每个地区的总销售额和平均销售额
grouped = df.groupby('地区')['销售额'].agg(['sum', 'mean'])

print(grouped)
```

**输出：**
```
       sum   mean
地区                
北京   600  200.0
上海   750  250.0
```

在这个案例中，我们读取了一个CSV文件，并按照“地区”列对数据进行了分组，然后计算了每个地区的总销售额和平均销售额。

## 总结

Pandas的分组操作是数据分析中非常强大的工具，它允许我们根据某些条件将数据分成不同的组，并对每个组进行独立的分析或操作。通过 `groupby()` 方法，我们可以轻松地实现数据的分组、聚合和转换。

:::tip
在实际应用中，分组操作通常与其他Pandas功能（如过滤、排序等）结合使用，以实现更复杂的数据分析任务。
:::

## 附加资源与练习

- **练习1**：尝试使用 `groupby()` 方法对一个包含多个列的数据集进行分组，并计算每个组的多个统计量（如总和、平均值、最大值等）。
- **练习2**：使用 `transform()` 方法对分组后的数据进行标准化处理，并将结果保存到新的列中。

通过不断练习，你将能够熟练掌握Pandas的分组操作，并在实际项目中灵活运用。