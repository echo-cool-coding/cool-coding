---
title: Pandas 分组过滤
description: 学习如何使用Pandas对数据进行分组并应用过滤条件，提取满足特定条件的数据子集。
---

# Pandas 分组过滤

在数据分析中，分组和过滤是非常常见的操作。Pandas库提供了强大的工具来帮助我们轻松地完成这些任务。本文将详细介绍如何使用Pandas对数据进行分组并应用过滤条件，以便提取满足特定条件的数据子集。

## 什么是分组过滤？

分组过滤是指在数据集中按照某个或多个列的值进行分组，然后对每个分组应用过滤条件，最终返回满足条件的分组或数据子集。这种操作在数据分析中非常有用，尤其是在处理大型数据集时，可以帮助我们快速找到感兴趣的数据。

## 基本概念

在Pandas中，分组操作通常使用 `groupby` 方法来实现。分组后，我们可以对每个分组应用各种操作，如聚合、转换或过滤。过滤操作通常使用 `filter` 方法来完成。

### 1. 分组操作

首先，我们需要对数据进行分组。假设我们有一个包含销售数据的DataFrame：

```python
import pandas as pd

data = {
    'Salesperson': ['Alice', 'Bob', 'Charlie', 'Alice', 'Bob', 'Charlie'],
    'Region': ['North', 'South', 'North', 'South', 'North', 'South'],
    'Sales': [200, 150, 300, 250, 100, 400]
}

df = pd.DataFrame(data)
print(df)
```

输出：

```
  Salesperson Region  Sales
0       Alice  North    200
1         Bob  South    150
2     Charlie  North    300
3       Alice  South    250
4         Bob  North    100
5     Charlie  South    400
```

我们可以按照 `Salesperson` 列进行分组：

```python
grouped = df.groupby('Salesperson')
```

### 2. 过滤操作

分组后，我们可以使用 `filter` 方法对每个分组应用过滤条件。例如，我们只想保留那些总销售额超过300的销售人员的记录：

```python
filtered_df = grouped.filter(lambda x: x['Sales'].sum() > 300)
print(filtered_df)
```

输出：

```
  Salesperson Region  Sales
0       Alice  North    200
1         Bob  South    150
2     Charlie  North    300
3       Alice  South    250
5     Charlie  South    400
```

在这个例子中，`Alice` 和 `Charlie` 的总销售额分别为450和700，超过了300，因此他们的记录被保留下来。而 `Bob` 的总销售额为250，低于300，因此他的记录被过滤掉了。

## 实际应用案例

假设我们有一个包含学生成绩的DataFrame，我们想要找出那些在每门课程中平均分超过80分的学生：

```python
data = {
    'Student': ['Alice', 'Bob', 'Charlie', 'Alice', 'Bob', 'Charlie'],
    'Course': ['Math', 'Math', 'Math', 'Science', 'Science', 'Science'],
    'Score': [85, 75, 90, 88, 78, 92]
}

df = pd.DataFrame(data)
print(df)
```

输出：

```
   Student   Course  Score
0    Alice     Math     85
1      Bob     Math     75
2  Charlie     Math     90
3    Alice  Science     88
4      Bob  Science     78
5  Charlie  Science     92
```

我们可以按照 `Student` 列进行分组，并过滤出那些平均分超过80分的学生：

```python
filtered_df = df.groupby('Student').filter(lambda x: x['Score'].mean() > 80)
print(filtered_df)
```

输出：

```
   Student   Course  Score
0    Alice     Math     85
2  Charlie     Math     90
3    Alice  Science     88
5  Charlie  Science     92
```

在这个例子中，`Alice` 和 `Charlie` 的平均分分别为86.5和91，超过了80分，因此他们的记录被保留下来。而 `Bob` 的平均分为76.5，低于80分，因此他的记录被过滤掉了。

## 总结

Pandas的分组过滤功能非常强大，可以帮助我们轻松地从数据集中提取满足特定条件的数据子集。通过 `groupby` 和 `filter` 方法的结合使用，我们可以对数据进行灵活的分组和过滤操作，从而更好地理解和分析数据。

## 附加资源与练习

- **练习1**：尝试使用Pandas对一个包含多个列的数据集进行分组过滤，找出那些在多个条件下满足特定条件的数据子集。
- **练习2**：探索Pandas文档，了解更多关于 `groupby` 和 `filter` 方法的高级用法。

:::tip
如果你对Pandas的分组和过滤操作还不熟悉，建议先从简单的数据集开始练习，逐步掌握这些强大的工具。
:::