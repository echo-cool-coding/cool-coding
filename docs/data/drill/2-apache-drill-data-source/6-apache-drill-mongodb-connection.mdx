---
title: Apache Drill MongoDB 连接
description: "学习如何使用 Apache Drill 连接 MongoDB 数据源，并通过 SQL 查询 MongoDB 中的数据。本文适合初学者，包含详细的步骤、代码示例和实际应用场景。"
---

## 介绍

Apache Drill 是一个开源的分布式 SQL 查询引擎，能够直接查询多种数据源，包括 MongoDB。通过 Apache Drill，您可以使用标准的 SQL 语法查询 MongoDB 中的文档数据，而无需将数据迁移到关系型数据库中。本文将详细介绍如何配置 Apache Drill 以连接 MongoDB，并通过实际案例展示其应用。

## 配置 Apache Drill 连接 MongoDB

### 1. 安装 Apache Drill

首先，确保您已经安装并运行了 Apache Drill。您可以从 [Apache Drill 官方网站](https://drill.apache.org/) 下载并安装 Drill。

### 2. 配置 MongoDB 存储插件

Apache Drill 通过存储插件与 MongoDB 进行交互。以下是配置 MongoDB 存储插件的步骤：

1. 打开 Apache Drill 的 Web UI（通常位于 `http://localhost:8047`）。
2. 导航到 "Storage" 选项卡。
3. 找到并启用 `mongo` 存储插件。如果未找到，您可以手动添加以下配置：

```json
{
  "type": "mongo",
  "connection": "mongodb://localhost:27017",
  "enabled": true
}
```

:::note
确保 MongoDB 服务器正在运行，并且您使用的连接字符串（如 `mongodb://localhost:27017`）是正确的。
:::

### 3. 测试连接

配置完成后，您可以通过执行以下 SQL 查询来测试连接：

```sql
SHOW DATABASES;
```

如果配置正确，您将看到 MongoDB 中的数据库列表。

## 查询 MongoDB 数据

### 1. 查询集合

假设 MongoDB 中有一个名为 `test` 的数据库，其中包含一个名为 `users` 的集合。您可以使用以下 SQL 查询来检索数据：

```sql
SELECT * FROM mongo.test.users LIMIT 10;
```

这将返回 `users` 集合中的前 10 条记录。

### 2. 嵌套文档查询

MongoDB 支持嵌套文档，Apache Drill 也可以轻松处理这些数据。例如，假设 `users` 集合中的文档结构如下：

```json
{
  "_id": "1",
  "name": "John Doe",
  "address": {
    "city": "New York",
    "state": "NY"
  }
}
```

您可以使用以下查询来检索用户的姓名和所在城市：

```sql
SELECT name, address.city FROM mongo.test.users;
```

### 3. 聚合查询

Apache Drill 支持标准的 SQL 聚合函数。例如，您可以计算每个州的用户数量：

```sql
SELECT address.state, COUNT(*) AS user_count
FROM mongo.test.users
GROUP BY address.state;
```

## 实际应用场景

### 场景：分析用户地理位置分布

假设您正在开发一个应用程序，需要分析用户的地理位置分布。通过 Apache Drill，您可以轻松地从 MongoDB 中提取用户的地理信息，并生成报告。

```sql
SELECT address.state, COUNT(*) AS user_count
FROM mongo.test.users
GROUP BY address.state
ORDER BY user_count DESC;
```

此查询将返回按州分组的用户数量，并按用户数量降序排列。

## 总结

通过 Apache Drill，您可以轻松地连接 MongoDB 并使用 SQL 查询文档数据。本文介绍了如何配置 MongoDB 存储插件、执行基本查询以及处理嵌套文档和聚合查询。Apache Drill 的强大功能使得从 NoSQL 数据库中提取和分析数据变得简单易行。

## 附加资源

- [Apache Drill 官方文档](https://drill.apache.org/docs/)
- [MongoDB 官方文档](https://docs.mongodb.com/)
- [SQL 教程](https://www.w3schools.com/sql/)

## 练习

1. 配置 Apache Drill 连接您的本地 MongoDB 实例。
2. 查询一个包含嵌套文档的集合，并提取特定字段。
3. 编写一个聚合查询，计算某个字段的唯一值数量。

通过完成这些练习，您将更好地掌握 Apache Drill 与 MongoDB 的连接和查询技巧。