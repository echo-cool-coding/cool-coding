---
title: Apache Drill HAVING子句
description: "了解如何在 Apache Drill 中使用 HAVING 子句对分组数据进行过滤。本教程适合初学者，包含详细的解释、代码示例和实际案例。"
---

# Apache Drill HAVING子句

在 Apache Drill 中，`HAVING` 子句用于对分组后的数据进行过滤。它与 `GROUP BY` 子句结合使用，允许你根据聚合函数的结果筛选数据。与 `WHERE` 子句不同，`HAVING` 子句作用于分组后的数据，而不是原始数据。

## 1. HAVING子句的基本语法

`HAVING` 子句通常与 `GROUP BY` 子句一起使用，其基本语法如下：

```sql
SELECT column1, aggregate_function(column2)
FROM table_name
GROUP BY column1
HAVING condition;
```

- `aggregate_function`：可以是 `SUM`、`COUNT`、`AVG`、`MAX` 或 `MIN` 等聚合函数。
- `condition`：用于过滤分组后的数据，通常基于聚合函数的结果。

## 2. HAVING子句与WHERE子句的区别

- `WHERE` 子句在分组前过滤数据，作用于原始数据。
- `HAVING` 子句在分组后过滤数据，作用于分组后的数据。

:::tip
如果你需要对原始数据进行过滤，请使用 `WHERE` 子句；如果你需要对分组后的数据进行过滤，请使用 `HAVING` 子句。
:::

## 3. 代码示例

假设我们有一个名为 `sales` 的表，包含以下数据：

| id  | product | quantity | price |
|-----|---------|----------|-------|
| 1   | A       | 10       | 100   |
| 2   | B       | 5        | 200   |
| 3   | A       | 8        | 100   |
| 4   | C       | 12       | 150   |
| 5   | B       | 7        | 200   |

### 示例 1：使用HAVING过滤分组数据

我们希望找出总销售额大于 1500 的产品：

```sql
SELECT product, SUM(quantity * price) AS total_sales
FROM sales
GROUP BY product
HAVING total_sales > 1500;
```

**输出：**

| product | total_sales |
|---------|-------------|
| A       | 1800        |
| B       | 2400        |

### 示例 2：结合WHERE和HAVING

我们希望找出总销售额大于 1500 且单价大于 100 的产品：

```sql
SELECT product, SUM(quantity * price) AS total_sales
FROM sales
WHERE price > 100
GROUP BY product
HAVING total_sales > 1500;
```

**输出：**

| product | total_sales |
|---------|-------------|
| B       | 2400        |

## 4. 实际应用场景

### 场景 1：电商平台销售分析

假设你是一家电商平台的数据分析师，需要分析哪些产品的总销售额超过了特定阈值。通过 `HAVING` 子句，你可以轻松筛选出符合条件的产品。

### 场景 2：学生成绩统计

假设你是一名教师，需要统计每个班级的平均成绩，并筛选出平均成绩高于 80 分的班级。通过 `HAVING` 子句，你可以快速完成这一任务。

## 5. 总结

`HAVING` 子句是 Apache Drill 中用于过滤分组数据的重要工具。它与 `GROUP BY` 子句结合使用，允许你根据聚合函数的结果筛选数据。通过本文的学习，你应该能够理解 `HAVING` 子句的基本用法，并在实际场景中应用它。

## 6. 附加资源与练习

- **练习 1**：在 `sales` 表中，找出总销售额大于 2000 且单价小于 200 的产品。
- **练习 2**：创建一个包含学生成绩的表，统计每个班级的平均成绩，并筛选出平均成绩高于 85 分的班级。

:::note
如果你对 `HAVING` 子句的使用还有疑问，建议多尝试不同的查询，并结合 `WHERE` 子句进行练习。
:::