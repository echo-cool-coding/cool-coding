---
title: Apache Drill UNION 操作
description: 了解如何在 Apache Drill 中使用 UNION 操作来合并多个查询的结果集。本文适合初学者，包含详细的解释、代码示例和实际案例。
---

# Apache Drill UNION 操作

在 Apache Drill 中，`UNION` 操作用于将两个或多个查询的结果集合并为一个结果集。这对于需要从多个表或数据源中提取数据并将其组合在一起的情况非常有用。本文将详细介绍 `UNION` 操作的使用方法，并通过示例帮助您理解其实际应用。

## 什么是 UNION 操作？

`UNION` 操作是 SQL 中的一种集合操作，用于将两个或多个 `SELECT` 语句的结果集合并为一个结果集。合并后的结果集将包含所有查询的行的并集，但会去除重复的行（除非使用 `UNION ALL`）。

:::note
- `UNION`：去除重复行。
- `UNION ALL`：保留所有行，包括重复行。
:::

## UNION 操作的基本语法

```sql
SELECT column1, column2, ...
FROM table1
UNION
SELECT column1, column2, ...
FROM table2;
```

在上述语法中，`UNION` 操作将 `table1` 和 `table2` 的查询结果合并为一个结果集。如果两个查询返回相同的行，则只会保留一行。

## 使用 UNION ALL 保留重复行

如果您希望保留所有行，包括重复的行，可以使用 `UNION ALL`：

```sql
SELECT column1, column2, ...
FROM table1
UNION ALL
SELECT column1, column2, ...
FROM table2;
```

## 示例：合并两个表的数据

假设我们有两个表 `employees` 和 `contractors`，它们都包含员工的姓名和职位信息。我们希望将这两个表的数据合并为一个结果集。

### 表结构

```sql
-- employees 表
+----+----------+-----------+
| id | name     | position  |
+----+----------+-----------+
| 1  | Alice    | Engineer  |
| 2  | Bob      | Manager   |
+----+----------+-----------+

-- contractors 表
+----+----------+-----------+
| id | name     | position  |
+----+----------+-----------+
| 1  | Charlie  | Developer |
| 2  | Alice    | Engineer  |
+----+----------+-----------+
```

### 使用 UNION 操作

```sql
SELECT name, position
FROM employees
UNION
SELECT name, position
FROM contractors;
```

### 输出结果

```sql
+----------+-----------+
| name     | position  |
+----------+-----------+
| Alice    | Engineer  |
| Bob      | Manager   |
| Charlie  | Developer |
+----------+-----------+
```

:::tip
注意：`UNION` 操作会自动去除重复的行。在这个例子中，`Alice` 只出现了一次，尽管她在两个表中都存在。
:::

### 使用 UNION ALL 操作

```sql
SELECT name, position
FROM employees
UNION ALL
SELECT name, position
FROM contractors;
```

### 输出结果

```sql
+----------+-----------+
| name     | position  |
+----------+-----------+
| Alice    | Engineer  |
| Bob      | Manager   |
| Charlie  | Developer |
| Alice    | Engineer  |
+----------+-----------+
```

:::caution
注意：`UNION ALL` 保留了所有行，包括重复的行。在这个例子中，`Alice` 出现了两次。
:::

## 实际应用场景

### 场景 1：合并多个数据源

假设您有两个不同的数据源，分别存储了不同地区的销售数据。您可以使用 `UNION` 操作将这两个数据源的数据合并，以便进行整体分析。

```sql
SELECT region, sales_amount
FROM sales_north
UNION
SELECT region, sales_amount
FROM sales_south;
```

### 场景 2：合并历史数据和当前数据

假设您有一个存储历史数据的表和一个存储当前数据的表。您可以使用 `UNION` 操作将历史数据和当前数据合并，以便进行趋势分析。

```sql
SELECT date, revenue
FROM historical_data
UNION
SELECT date, revenue
FROM current_data;
```

## 总结

`UNION` 操作是 Apache Drill 中一个强大的工具，用于合并多个查询的结果集。通过 `UNION`，您可以轻松地将来自不同表或数据源的数据组合在一起，以便进行更全面的分析。记住，`UNION` 会自动去除重复的行，而 `UNION ALL` 则会保留所有行。

## 附加资源与练习

- **练习 1**：尝试在两个不同的表中使用 `UNION` 操作，并观察结果。
- **练习 2**：使用 `UNION ALL` 操作合并两个表的数据，并比较与 `UNION` 的区别。
- **进一步阅读**：查阅 Apache Drill 官方文档，了解更多关于集合操作的内容。

希望本文能帮助您更好地理解 Apache Drill 中的 `UNION` 操作。如果您有任何问题或需要进一步的帮助，请随时查阅相关文档或社区资源。