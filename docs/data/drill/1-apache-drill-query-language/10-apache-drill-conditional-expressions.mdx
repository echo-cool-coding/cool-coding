---
title: Apache Drill 条件表达式
description: 了解 Apache Drill 中的条件表达式，掌握如何使用它们进行数据筛选和逻辑判断。本文适合初学者，包含详细的解释、代码示例和实际应用场景。
---

# Apache Drill 条件表达式

在 Apache Drill 中，条件表达式是用于根据特定条件筛选数据或执行逻辑判断的重要工具。它们允许你在查询中动态地选择或计算值，从而实现更灵活的数据处理。本文将详细介绍 Apache Drill 中的条件表达式，并通过示例帮助你理解其用法。

## 什么是条件表达式？

条件表达式是一种根据特定条件返回不同值的表达式。在 Apache Drill 中，最常见的条件表达式是 `CASE` 和 `IF`。它们允许你在查询中根据条件执行不同的操作，例如筛选数据、计算新列或执行逻辑判断。

### CASE 表达式

`CASE` 表达式是 Apache Drill 中最常用的条件表达式之一。它的语法如下：

```sql
CASE
    WHEN condition1 THEN result1
    WHEN condition2 THEN result2
    ...
    ELSE default_result
END
```

- `condition1`, `condition2` 等是布尔表达式，如果为真，则返回对应的 `result1`, `result2`。
- `ELSE` 子句是可选的，如果所有条件都不满足，则返回 `default_result`。

#### 示例 1：简单的 CASE 表达式

假设我们有一个表 `sales`，其中包含 `amount` 和 `region` 列。我们想根据 `region` 的值返回不同的销售类别：

```sql
SELECT
    region,
    amount,
    CASE
        WHEN region = 'North' THEN 'High'
        WHEN region = 'South' THEN 'Medium'
        ELSE 'Low'
    END AS sales_category
FROM sales;
```

**输入数据：**

| region | amount |
|--------|--------|
| North  | 1000   |
| South  | 500    |
| East   | 300    |

**输出结果：**

| region | amount | sales_category |
|--------|--------|----------------|
| North  | 1000   | High           |
| South  | 500    | Medium         |
| East   | 300    | Low            |

### IF 表达式

`IF` 表达式是另一种常用的条件表达式，它的语法更简洁：

```sql
IF(condition, true_result, false_result)
```

- `condition` 是一个布尔表达式。
- 如果 `condition` 为真，则返回 `true_result`，否则返回 `false_result`。

#### 示例 2：使用 IF 表达式

假设我们想根据 `amount` 的值判断是否为高销售额：

```sql
SELECT
    region,
    amount,
    IF(amount > 800, 'High', 'Low') AS sales_level
FROM sales;
```

**输入数据：**

| region | amount |
|--------|--------|
| North  | 1000   |
| South  | 500    |
| East   | 300    |

**输出结果：**

| region | amount | sales_level |
|--------|--------|-------------|
| North  | 1000   | High        |
| South  | 500    | Low         |
| East   | 300    | Low         |

## 实际应用场景

### 场景 1：动态计算折扣

假设我们有一个 `orders` 表，包含 `order_id`, `customer_id`, 和 `total_amount` 列。我们想根据 `total_amount` 的值动态计算折扣：

```sql
SELECT
    order_id,
    customer_id,
    total_amount,
    CASE
        WHEN total_amount > 1000 THEN total_amount * 0.9
        WHEN total_amount > 500 THEN total_amount * 0.95
        ELSE total_amount
    END AS discounted_amount
FROM orders;
```

**输入数据：**

| order_id | customer_id | total_amount |
|----------|-------------|--------------|
| 1        | 101         | 1200         |
| 2        | 102         | 600          |
| 3        | 103         | 300          |

**输出结果：**

| order_id | customer_id | total_amount | discounted_amount |
|----------|-------------|--------------|-------------------|
| 1        | 101         | 1200         | 1080              |
| 2        | 102         | 600          | 570               |
| 3        | 103         | 300          | 300               |

### 场景 2：分类客户

假设我们有一个 `customers` 表，包含 `customer_id`, `name`, 和 `purchase_amount` 列。我们想根据 `purchase_amount` 的值将客户分类为 `VIP`, `Regular`, 或 `New`：

```sql
SELECT
    customer_id,
    name,
    purchase_amount,
    CASE
        WHEN purchase_amount > 1000 THEN 'VIP'
        WHEN purchase_amount > 500 THEN 'Regular'
        ELSE 'New'
    END AS customer_category
FROM customers;
```

**输入数据：**

| customer_id | name   | purchase_amount |
|-------------|--------|-----------------|
| 1           | Alice  | 1200            |
| 2           | Bob    | 600             |
| 3           | Charlie| 300             |

**输出结果：**

| customer_id | name   | purchase_amount | customer_category |
|-------------|--------|-----------------|-------------------|
| 1           | Alice  | 1200            | VIP               |
| 2           | Bob    | 600             | Regular           |
| 3           | Charlie| 300             | New               |

## 总结

Apache Drill 中的条件表达式是强大的工具，可以帮助你根据特定条件动态地筛选数据或执行逻辑判断。通过 `CASE` 和 `IF` 表达式，你可以轻松地实现复杂的数据处理任务。本文通过详细的示例和实际应用场景，帮助你掌握了这些表达式的用法。

## 附加资源与练习

- **练习 1**：在 `sales` 表中，使用 `CASE` 表达式创建一个新列 `sales_region`，将 `region` 为 `North` 或 `South` 的销售标记为 `Domestic`，其他标记为 `International`。
- **练习 2**：在 `orders` 表中，使用 `IF` 表达式创建一个新列 `order_status`，如果 `total_amount` 大于 1000，则标记为 `High Priority`，否则标记为 `Normal Priority`。

通过练习，你将进一步巩固对 Apache Drill 条件表达式的理解。祝你学习愉快！