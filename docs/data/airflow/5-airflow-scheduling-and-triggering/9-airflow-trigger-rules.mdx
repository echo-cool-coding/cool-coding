---
title: Airflow 触发器规则
description: 了解Airflow中的触发器规则，掌握如何通过规则控制任务的执行逻辑，适合初学者。
---

# Airflow 触发器规则

在Apache Airflow中，**触发器规则（Trigger Rules）**用于定义任务在DAG（有向无环图）中的执行条件。通过触发器规则，你可以控制任务是否应该运行，以及何时运行。这对于构建复杂的任务依赖关系和工作流至关重要。

## 什么是触发器规则？

触发器规则决定了任务在满足特定条件时是否会被触发执行。默认情况下，Airflow使用 `all_success` 规则，即只有当所有上游任务都成功时，当前任务才会执行。然而，Airflow提供了多种触发器规则，允许你根据不同的需求调整任务的执行逻辑。

## 常见的触发器规则

以下是Airflow中常见的触发器规则：

1. **all_success**（默认）：所有上游任务都成功时触发。
2. **all_failed**：所有上游任务都失败时触发。
3. **all_done**：所有上游任务都完成（无论成功或失败）时触发。
4. **one_success**：至少有一个上游任务成功时触发。
5. **one_failed**：至少有一个上游任务失败时触发。
6. **none_failed**：没有上游任务失败时触发（允许跳过）。
7. **none_skipped**：没有上游任务被跳过时触发。
8. **dummy**：忽略上游任务状态，总是触发。

## 触发器规则的使用

在Airflow中，你可以通过设置任务的 `trigger_rule` 参数来指定触发器规则。以下是一个简单的示例：

```python
from airflow import DAG
from airflow.operators.dummy_operator import DummyOperator
from airflow.utils.dates import days_ago

dag = DAG(
    'trigger_rule_example',
    default_args={'start_date': days_ago(1)},
    schedule_interval='@daily',
)

task_a = DummyOperator(task_id='task_a', dag=dag)
task_b = DummyOperator(task_id='task_b', dag=dag)
task_c = DummyOperator(task_id='task_c', dag=dag, trigger_rule='one_success')

task_a >> task_c
task_b >> task_c
```

在这个示例中，`task_c` 的触发器规则被设置为 `one_success`，这意味着只要 `task_a` 或 `task_b` 中有一个成功，`task_c` 就会被触发。

## 实际应用场景

假设你有一个数据处理管道，其中包含数据提取、数据清洗和数据加载三个步骤。你希望即使数据提取失败，数据清洗任务仍然可以运行（例如，使用缓存数据）。这时，你可以将数据清洗任务的触发器规则设置为 `all_done`，以确保无论数据提取是否成功，数据清洗任务都会执行。

```python
extract_data = DummyOperator(task_id='extract_data', dag=dag)
clean_data = DummyOperator(task_id='clean_data', dag=dag, trigger_rule='all_done')
load_data = DummyOperator(task_id='load_data', dag=dag)

extract_data >> clean_data >> load_data
```

## 总结

触发器规则是Airflow中控制任务执行逻辑的重要工具。通过合理设置触发器规则，你可以构建更加灵活和健壮的工作流。无论是处理复杂的依赖关系，还是应对任务失败的情况，触发器规则都能帮助你实现预期的行为。

## 附加资源与练习

- **官方文档**：了解更多关于触发器规则的详细信息，请参考 [Airflow官方文档](https://airflow.apache.org/docs/apache-airflow/stable/concepts/dags.html#trigger-rules)。
- **练习**：尝试创建一个包含多个任务的DAG，并使用不同的触发器规则观察任务的执行行为。

:::tip
在实际使用中，建议根据业务需求选择合适的触发器规则，以确保工作流的正确性和可靠性。
:::