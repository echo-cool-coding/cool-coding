---
title: Airflow 时区设置
description: 了解如何在Apache Airflow中正确设置时区，以确保调度任务的时间准确性。本文适合初学者，包含代码示例和实际案例。
---

# Airflow 时区设置

在Apache Airflow中，时区设置是一个非常重要的配置项，它直接影响到任务的调度时间。如果时区设置不正确，可能会导致任务在错误的时间执行，从而影响整个工作流的准确性。本文将详细介绍如何在Airflow中设置时区，并提供实际案例帮助理解。

## 什么是时区设置？

时区设置是指为Airflow配置一个特定的时区，以便所有的时间相关操作（如任务调度、日志记录等）都基于该时区进行。默认情况下，Airflow使用UTC时区，但在实际应用中，我们可能需要根据业务需求将其设置为本地时区。

## 如何设置时区？

### 1. 修改 `airflow.cfg` 文件

在Airflow的配置文件 `airflow.cfg` 中，可以通过修改 `default_timezone` 参数来设置时区。例如，如果你想将时区设置为北京时间（UTC+8），可以按照以下步骤操作：

1. 打开 `airflow.cfg` 文件。
2. 找到 `[core]` 部分。
3. 修改 `default_timezone` 参数为 `Asia/Shanghai`。

```ini
[core]
default_timezone = Asia/Shanghai
```

### 2. 使用环境变量

除了修改配置文件，你还可以通过设置环境变量来配置时区。例如，在启动Airflow之前，设置以下环境变量：

```bash
export AIRFLOW__CORE__DEFAULT_TIMEZONE=Asia/Shanghai
```

### 3. 在DAG中设置时区

在某些情况下，你可能希望为特定的DAG设置不同的时区。这可以通过在DAG定义中设置 `timezone` 参数来实现：

```python
from airflow import DAG
from airflow.utils.dates import days_ago

dag = DAG(
    'my_dag',
    default_args={'start_date': days_ago(1)},
    schedule_interval='@daily',
    timezone='Asia/Shanghai',
)
```

## 实际案例

假设你有一个每天凌晨2点执行的任务，用于生成前一天的销售报告。如果你将时区设置为UTC，任务将在UTC时间的凌晨2点执行，这可能与你的本地时间不符。通过将时区设置为 `Asia/Shanghai`，任务将在北京时间凌晨2点执行，确保报告的准确性。

```python
from airflow import DAG
from airflow.operators.bash import BashOperator
from airflow.utils.dates import days_ago

dag = DAG(
    'daily_sales_report',
    default_args={'start_date': days_ago(1)},
    schedule_interval='0 2 * * *',
    timezone='Asia/Shanghai',
)

generate_report = BashOperator(
    task_id='generate_report',
    bash_command='generate_sales_report.sh',
    dag=dag,
)
```

## 总结

正确设置Airflow的时区对于确保任务调度的准确性至关重要。通过修改配置文件、设置环境变量或在DAG中指定时区，你可以轻松地将Airflow配置为使用本地时区。希望本文能帮助你理解并正确配置Airflow的时区设置。

## 附加资源

- [Airflow官方文档 - 时区设置](https://airflow.apache.org/docs/apache-airflow/stable/timezone.html)
- [时区数据库](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)

## 练习

1. 尝试将你的Airflow实例的时区设置为 `America/New_York`，并观察任务调度时间的变化。
2. 创建一个新的DAG，并将其时区设置为 `Europe/London`，然后验证任务是否在正确的时间执行。
