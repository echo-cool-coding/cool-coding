---
title: Nginx 重写标志
description: 了解Nginx中的重写标志，掌握如何使用它们来控制URL重写的行为。本文适合初学者，包含清晰的解释、代码示例和实际案例。
---

## 介绍

在Nginx中，URL重写是一个强大的功能，允许你修改客户端请求的URL。重写标志（Rewrite Flags）是控制重写行为的关键部分。它们决定了Nginx在重写URL后如何处理请求。本文将详细介绍Nginx中的重写标志，并通过示例帮助你理解它们的用法。

## 什么是重写标志？

重写标志是Nginx `rewrite`指令的可选参数，用于指定重写后的行为。常见的重写标志包括 `last`、`break`、`redirect` 和 `permanent`。每个标志都有不同的作用，理解它们的区别对于正确配置Nginx至关重要。

## 常见的重写标志

### 1. `last`

`last` 标志表示重写后的URL将被重新处理，Nginx会重新匹配新的URL。这意味着重写后的URL可能会再次被其他 `location` 块处理。

**示例：**

```nginx
location /old-path {
    rewrite ^/old-path$ /new-path last;
}

location /new-path {
    return 200 "This is the new path!";
}
```

**输入：** `/old-path`  
**输出：** `This is the new path!`

在这个例子中，请求 `/old-path` 会被重写为 `/new-path`，然后Nginx会重新处理 `/new-path` 请求。

### 2. `break`

`break` 标志表示重写后的URL将停止进一步的重写处理。Nginx会直接使用重写后的URL进行后续处理，而不会重新匹配 `location` 块。

**示例：**

```nginx
location /old-path {
    rewrite ^/old-path$ /new-path break;
}

location /new-path {
    return 200 "This is the new path!";
}
```

**输入：** `/old-path`  
**输出：** `404 Not Found`

在这个例子中，请求 `/old-path` 会被重写为 `/new-path`，但由于使用了 `break` 标志，Nginx不会重新匹配 `/new-path` 的 `location` 块，因此返回404错误。

### 3. `redirect`

`redirect` 标志表示重写后的URL将返回一个302临时重定向响应给客户端。客户端会收到一个新的URL并重新发起请求。

**示例：**

```nginx
location /old-path {
    rewrite ^/old-path$ /new-path redirect;
}
```

**输入：** `/old-path`  
**输出：** 浏览器会收到一个302重定向响应，并跳转到 `/new-path`。

### 4. `permanent`

`permanent` 标志与 `redirect` 类似，但它返回的是301永久重定向响应。这意味着客户端会缓存这个重定向，并在未来的请求中直接跳转到新的URL。

**示例：**

```nginx
location /old-path {
    rewrite ^/old-path$ /new-path permanent;
}
```

**输入：** `/old-path`  
**输出：** 浏览器会收到一个301重定向响应，并跳转到 `/new-path`。

## 实际应用场景

### 场景1：网站迁移

假设你正在将网站从旧域名迁移到新域名，并且希望将所有旧域名的请求重定向到新域名。你可以使用 `permanent` 标志来实现这一点。

```nginx
server {
    listen 80;
    server_name old-domain.com;

    location / {
        rewrite ^/(.*)$ http://new-domain.com/$1 permanent;
    }
}
```

**输入：** `http://old-domain.com/about`  
**输出：** 浏览器会收到一个301重定向响应，并跳转到 `http://new-domain.com/about`。

### 场景2：URL美化

假设你希望将 `/product?id=123` 这样的URL重写为 `/product/123`，以美化URL。你可以使用 `last` 标志来实现这一点。

```nginx
location /product {
    rewrite ^/product/(\d+)$ /product?id=$1 last;
}
```

**输入：** `/product/123`  
**输出：** 请求会被重写为 `/product?id=123`，然后Nginx会重新处理这个请求。

## 总结

Nginx的重写标志是控制URL重写行为的关键。通过合理使用 `last`、`break`、`redirect` 和 `permanent` 标志，你可以实现各种URL重写需求。希望本文能帮助你理解这些标志的用法，并在实际项目中灵活应用。

## 附加资源

- [Nginx官方文档](https://nginx.org/en/docs/)
- [Nginx Rewrite模块文档](https://nginx.org/en/docs/http/ngx_http_rewrite_module.html)

## 练习

1. 尝试在本地Nginx配置中使用 `last` 和 `break` 标志，观察它们的行为差异。
2. 配置一个Nginx服务器，将所有HTTP请求重定向到HTTPS，使用 `permanent` 标志。
3. 使用 `rewrite` 指令将 `/blog/2023/01/01` 这样的URL重写为 `/blog?id=20230101`。

通过练习，你将更深入地理解Nginx重写标志的用法。