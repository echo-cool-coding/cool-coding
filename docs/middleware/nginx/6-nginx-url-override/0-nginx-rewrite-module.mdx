---
title: Nginx 重写模块
description: 了解Nginx重写模块的基本概念、语法和实际应用场景，帮助初学者掌握URL重写的技巧。
---

# Nginx 重写模块

Nginx是一个高性能的Web服务器和反向代理服务器，广泛用于处理HTTP请求。Nginx的重写模块（`ngx_http_rewrite_module`）允许你通过重写URL来改变请求的路径，从而实现更灵活的URL管理和SEO优化。本文将详细介绍Nginx重写模块的基本概念、语法和实际应用场景。

## 什么是Nginx重写模块？

Nginx重写模块允许你在Nginx配置文件中定义规则，用于修改客户端请求的URL。这些规则可以基于正则表达式匹配URL，并将其重写为新的URL。重写后的URL可以用于内部重定向、外部重定向或直接返回给客户端。

### 主要用途

- **URL美化**：将复杂的URL转换为更简洁、易读的形式。
- **SEO优化**：通过重写URL，使搜索引擎更容易索引你的网站。
- **请求重定向**：将旧URL重定向到新URL，避免404错误。
- **动态URL处理**：将动态生成的URL转换为静态URL，提高性能。

## Nginx 重写模块的基本语法

Nginx重写模块的核心指令是 `rewrite`，其基本语法如下：

```nginx
rewrite regex replacement [flag];
```

- **regex**：用于匹配URL的正则表达式。
- **replacement**：匹配成功后，URL将被重写为这个值。
- **flag**：可选参数，用于指定重写后的行为。常见的flag有：
  - `last`：停止处理当前的重写规则，并使用重写后的URL继续匹配其他规则。
  - `break`：停止处理当前的重写规则，并使用重写后的URL继续处理请求。
  - `redirect`：返回302临时重定向。
  - `permanent`：返回301永久重定向。

### 示例1：简单的URL重写

假设我们有一个URL `/old-page`，我们希望将其重写为 `/new-page`，可以使用以下配置：

```nginx
location /old-page {
    rewrite ^/old-page$ /new-page permanent;
}
```

- **输入**：`http://example.com/old-page`
- **输出**：`http://example.com/new-page`（301永久重定向）

### 示例2：使用正则表达式重写URL

假设我们有一个动态URL `/product/123`，我们希望将其重写为 `/product?id=123`，可以使用以下配置：

```nginx
location /product {
    rewrite ^/product/(\d+)$ /product?id=$1 break;
}
```

- **输入**：`http://example.com/product/123`
- **输出**：`http://example.com/product?id=123`（内部重写）

## 实际应用场景

### 场景1：URL美化

假设你有一个博客系统，原始的URL是 `/blog.php?id=123`，你希望将其重写为 `/blog/123`，可以使用以下配置：

```nginx
location /blog {
    rewrite ^/blog/(\d+)$ /blog.php?id=$1 break;
}
```

- **输入**：`http://example.com/blog/123`
- **输出**：`http://example.com/blog.php?id=123`（内部重写）

### 场景2：旧URL重定向

假设你有一个旧版本的网站，URL结构发生了变化，你需要将旧URL重定向到新URL。例如，将 `/old-site/page1` 重定向到 `/new-site/page1`，可以使用以下配置：

```nginx
location /old-site {
    rewrite ^/old-site/(.*)$ /new-site/$1 permanent;
}
```

- **输入**：`http://example.com/old-site/page1`
- **输出**：`http://example.com/new-site/page1`（301永久重定向）

## 总结

Nginx重写模块是一个非常强大的工具，可以帮助你灵活地管理URL，提升网站的用户体验和SEO效果。通过本文的介绍，你应该已经掌握了Nginx重写模块的基本语法和实际应用场景。

:::tip 提示
在实际使用中，建议先在小范围内测试重写规则，确保其行为符合预期，然后再应用到生产环境中。
:::

## 附加资源

- [Nginx官方文档 - ngx_http_rewrite_module](http://nginx.org/en/docs/http/ngx_http_rewrite_module.html)
- [正则表达式入门教程](https://www.regular-expressions.info/tutorial.html)

## 练习

1. 尝试将 `/user/123` 重写为 `/profile?id=123`。
2. 将 `/old-blog/2023/01/01` 重定向到 `/blog/2023/01/01`。

通过完成这些练习，你将更深入地理解Nginx重写模块的使用方法。