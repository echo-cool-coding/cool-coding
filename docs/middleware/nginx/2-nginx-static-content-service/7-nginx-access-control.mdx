---
title: Nginx 访问控制
description: 了解如何使用Nginx实现访问控制，限制或允许特定IP地址、用户或网络访问您的静态内容服务。
---

## 介绍

Nginx是一个高性能的Web服务器和反向代理服务器，广泛用于静态内容服务。在实际应用中，您可能需要限制某些用户或IP地址访问您的网站资源，或者允许特定的网络访问。Nginx提供了强大的访问控制功能，可以帮助您实现这些需求。

本文将逐步介绍如何使用Nginx配置访问控制，包括基于IP地址的访问控制、基于用户认证的访问控制，以及如何结合这些功能实现更复杂的访问策略。

## 基于IP地址的访问控制

Nginx允许您通过配置`allow`和`deny`指令来限制或允许特定IP地址或IP段的访问。这些指令可以在`http`、`server`或`location`块中使用。

### 示例：允许特定IP地址访问

以下配置允许IP地址为`192.168.1.100`的客户端访问，而拒绝其他所有IP地址的访问：

```nginx
location / {
    allow 192.168.1.100;
    deny all;
}
```

- `allow 192.168.1.100;`：允许IP地址为`192.168.1.100`的客户端访问。
- `deny all;`：拒绝所有其他IP地址的访问。

### 示例：允许特定IP段访问

如果您希望允许某个IP段（例如`192.168.1.0/24`）的客户端访问，可以这样配置：

```nginx
location / {
    allow 192.168.1.0/24;
    deny all;
}
```

- `allow 192.168.1.0/24;`：允许IP段为`192.168.1.0/24`的客户端访问。
- `deny all;`：拒绝所有其他IP地址的访问。

:::note
`allow`和`deny`指令的顺序非常重要。Nginx会按照配置的顺序依次检查规则，一旦匹配到某个规则，就会立即应用该规则并停止后续检查。
:::

## 基于用户认证的访问控制

除了基于IP地址的访问控制，Nginx还支持基于HTTP基本认证的访问控制。您可以通过配置`auth_basic`和`auth_basic_user_file`指令来实现。

### 示例：配置HTTP基本认证

首先，您需要创建一个包含用户名和密码的文件。可以使用`htpasswd`工具来生成这个文件：

```bash
htpasswd -c /etc/nginx/.htpasswd username
```

然后，在Nginx配置中添加以下内容：

```nginx
location / {
    auth_basic "Restricted Access";
    auth_basic_user_file /etc/nginx/.htpasswd;
}
```

- `auth_basic "Restricted Access";`：启用HTTP基本认证，并设置提示信息。
- `auth_basic_user_file /etc/nginx/.htpasswd;`：指定包含用户名和密码的文件路径。

:::caution
确保`.htpasswd`文件的权限设置正确，只有Nginx进程能够读取该文件。
:::

## 实际应用场景

### 场景1：内部管理页面访问控制

假设您有一个内部管理页面，只允许公司内部网络的IP地址访问，并且需要用户认证。您可以结合基于IP地址和基于用户认证的访问控制来实现：

```nginx
location /admin {
    allow 192.168.1.0/24;
    deny all;

    auth_basic "Admin Area";
    auth_basic_user_file /etc/nginx/.htpasswd;
}
```

- `allow 192.168.1.0/24;`：允许公司内部网络的IP地址访问。
- `deny all;`：拒绝其他所有IP地址的访问。
- `auth_basic "Admin Area";`：启用HTTP基本认证。
- `auth_basic_user_file /etc/nginx/.htpasswd;`：指定用户认证文件。

### 场景2：限制特定文件类型的访问

假设您希望限制某些文件类型（例如`.zip`文件）的访问，只允许特定IP地址下载：

```nginx
location ~ \.zip$ {
    allow 192.168.1.100;
    deny all;
}
```

- `location ~ \.zip$`：匹配所有以`.zip`结尾的文件。
- `allow 192.168.1.100;`：允许IP地址为`192.168.1.100`的客户端访问。
- `deny all;`：拒绝其他所有IP地址的访问。

## 总结

Nginx的访问控制功能非常强大，可以帮助您灵活地管理谁可以访问您的网站资源。通过结合基于IP地址的访问控制和基于用户认证的访问控制，您可以实现复杂的访问策略，满足不同的安全需求。

## 附加资源与练习

- **练习1**：尝试配置一个Nginx服务器，只允许特定IP段访问您的静态资源，并启用HTTP基本认证。
- **练习2**：创建一个Nginx配置，限制特定文件类型（例如`.pdf`文件）的访问，只允许特定用户下载。

:::tip
如果您想深入了解Nginx的访问控制功能，可以参考Nginx官方文档中的[访问控制模块](https://nginx.org/en/docs/http/ngx_http_access_module.html)部分。
:::