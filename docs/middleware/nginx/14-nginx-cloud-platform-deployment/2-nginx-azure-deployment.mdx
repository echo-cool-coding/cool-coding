---
title: Nginx Azure 部署
description: 学习如何在 Microsoft Azure 上部署 Nginx，并了解其在实际应用中的使用场景。
---

## 介绍

Nginx 是一个高性能的 HTTP 服务器和反向代理服务器，广泛用于负载均衡、缓存和静态内容服务。Microsoft Azure 是一个强大的云平台，提供了丰富的服务来托管和扩展应用程序。将 Nginx 部署到 Azure 上，可以帮助你构建高可用性、可扩展的 Web 应用。

在本教程中，我们将逐步讲解如何在 Azure 上部署 Nginx，并通过实际案例展示其应用场景。

## 准备工作

在开始之前，请确保你已经完成以下准备工作：

1. **Azure 账户**：如果你还没有 Azure 账户，请先注册一个。
2. **Azure CLI**：安装并配置 Azure CLI，以便通过命令行管理 Azure 资源。
3. **Nginx 安装包**：你可以从 [Nginx 官方网站](https://nginx.org/en/download.html) 下载最新的稳定版本。

## 步骤 1：创建 Azure 虚拟机

首先，我们需要在 Azure 上创建一个虚拟机来托管 Nginx。

### 使用 Azure CLI 创建虚拟机

打开终端并运行以下命令来创建一个 Ubuntu 虚拟机：

```bash
az vm create \
  --resource-group myResourceGroup \
  --name myVM \
  --image UbuntuLTS \
  --admin-username azureuser \
  --generate-ssh-keys
```

:::note
请将 `myResourceGroup` 和 `myVM` 替换为你自己的资源组和虚拟机名称。
:::

### 连接到虚拟机

创建虚拟机后，使用以下命令连接到虚拟机：

```bash
ssh azureuser@<public-ip-address>
```

将 `<public-ip-address>` 替换为你的虚拟机的公共 IP 地址。

## 步骤 2：在虚拟机上安装 Nginx

连接到虚拟机后，运行以下命令来安装 Nginx：

```bash
sudo apt update
sudo apt install nginx -y
```

安装完成后，启动 Nginx 服务：

```bash
sudo systemctl start nginx
```

你可以通过访问虚拟机的公共 IP 地址来验证 Nginx 是否成功安装。如果看到 Nginx 的欢迎页面，说明安装成功。

## 步骤 3：配置 Nginx

默认情况下，Nginx 的配置文件位于 `/etc/nginx/nginx.conf`。你可以根据需要编辑此文件来配置 Nginx。

### 示例：配置反向代理

假设你有一个运行在 `localhost:3000` 的应用程序，你可以通过以下配置将 Nginx 配置为反向代理：

```nginx
server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

保存配置文件后，重新加载 Nginx：

```bash
sudo systemctl reload nginx
```

## 步骤 4：配置 Azure 网络安全组

为了确保外部用户可以访问你的 Nginx 服务器，你需要配置 Azure 网络安全组以允许 HTTP 流量。

### 使用 Azure CLI 配置网络安全组

运行以下命令以允许 HTTP 流量：

```bash
az network nsg rule create \
  --resource-group myResourceGroup \
  --nsg-name myVMNSG \
  --name allow-http \
  --protocol tcp \
  --priority 1000 \
  --destination-port-range 80
```

:::caution
确保将 `myResourceGroup` 和 `myVMNSG` 替换为你自己的资源组和网络安全组名称。
:::

## 实际案例：部署一个简单的 Web 应用

假设你有一个简单的 Node.js Web 应用，你可以将其部署到 Azure 上，并使用 Nginx 作为反向代理。

### 部署 Node.js 应用

1. 在虚拟机上安装 Node.js：

   ```bash
   curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -
   sudo apt-get install -y nodejs
   ```

2. 创建一个简单的 Node.js 应用：

   ```bash
   mkdir myapp
   cd myapp
   npm init -y
   npm install express
   ```

3. 创建一个 `index.js` 文件并添加以下代码：

   ```javascript
   const express = require('express');
   const app = express();
   const port = 3000;

   app.get('/', (req, res) => {
     res.send('Hello World!');
   });

   app.listen(port, () => {
     console.log(`App listening at http://localhost:${port}`);
   });
   ```

4. 启动应用：

   ```bash
   node index.js
   ```

5. 按照步骤 3 中的配置，将 Nginx 配置为反向代理。

6. 访问虚拟机的公共 IP 地址，你应该会看到 "Hello World!" 的消息。

## 总结

在本教程中，我们学习了如何在 Azure 上部署 Nginx，并通过实际案例展示了如何将 Nginx 配置为反向代理来托管一个简单的 Web 应用。通过这种方式，你可以轻松地在 Azure 上构建高可用性、可扩展的 Web 应用。

## 附加资源

- [Nginx 官方文档](https://nginx.org/en/docs/)
- [Azure 虚拟机文档](https://docs.microsoft.com/en-us/azure/virtual-machines/)
- [Azure CLI 文档](https://docs.microsoft.com/en-us/cli/azure/)

## 练习

1. 尝试在 Azure 上部署一个 Django 应用，并使用 Nginx 作为反向代理。
2. 配置 Nginx 以支持 HTTPS，使用 Let's Encrypt 获取免费的 SSL 证书。
3. 探索 Azure 负载均衡器，并将 Nginx 配置为负载均衡器。

通过完成这些练习，你将更深入地理解 Nginx 在 Azure 上的应用。