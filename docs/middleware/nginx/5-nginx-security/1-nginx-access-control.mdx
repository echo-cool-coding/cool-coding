---
title: Nginx 访问控制
description: 学习如何使用Nginx实现访问控制，保护你的Web服务器免受未经授权的访问。本文适合初学者，包含详细的解释、代码示例和实际案例。
---

## 介绍

Nginx是一个高性能的HTTP服务器和反向代理服务器，广泛用于Web服务的部署。为了保护Web服务器免受未经授权的访问，Nginx提供了多种访问控制机制。通过配置访问控制，你可以限制特定IP地址、子网或用户的访问权限，从而增强服务器的安全性。

本文将详细介绍如何使用Nginx实现访问控制，包括基于IP地址的访问控制、基于HTTP认证的访问控制，以及如何结合这些技术来构建更复杂的安全策略。

## 基于IP地址的访问控制

Nginx允许你通过配置`allow`和`deny`指令来限制或允许特定IP地址或IP地址范围的访问。这些指令可以放在`http`、`server`或`location`块中。

### 示例：允许特定IP访问

假设你希望只允许来自IP地址`192.168.1.100`的访问，而拒绝其他所有IP地址的访问。你可以在Nginx配置文件中添加以下内容：

```nginx
location / {
    allow 192.168.1.100;
    deny all;
}
```

在这个配置中，`allow`指令允许来自`192.168.1.100`的请求，而`deny all`指令则拒绝所有其他IP地址的请求。

### 示例：允许特定IP段访问

如果你希望允许来自某个IP段的访问，可以使用CIDR表示法。例如，允许来自`192.168.1.0/24`网段的所有IP地址访问：

```nginx
location / {
    allow 192.168.1.0/24;
    deny all;
}
```

在这个配置中，`allow 192.168.1.0/24`允许来自`192.168.1.0`到`192.168.1.255`的所有IP地址访问。

:::note
`allow`和`deny`指令的顺序非常重要。Nginx会按照配置文件中出现的顺序依次检查这些指令，一旦匹配到某个规则，就会立即执行相应的操作。
:::

## 基于HTTP认证的访问控制

除了基于IP地址的访问控制，Nginx还支持基于HTTP认证的访问控制。通过配置HTTP认证，你可以要求用户在访问特定资源时提供用户名和密码。

### 示例：配置HTTP认证

首先，你需要创建一个包含用户名和密码的文件。可以使用`htpasswd`工具来生成这个文件：

```bash
htpasswd -c /etc/nginx/.htpasswd username
```

接下来，在Nginx配置文件中添加以下内容：

```nginx
location /secure {
    auth_basic "Restricted Access";
    auth_basic_user_file /etc/nginx/.htpasswd;
}
```

在这个配置中，`auth_basic`指令启用了HTTP基本认证，并设置了认证提示信息。`auth_basic_user_file`指令指定了包含用户名和密码的文件路径。

当用户访问`/secure`路径时，Nginx会要求用户输入用户名和密码。只有输入正确的凭据后，用户才能访问该资源。

:::caution
HTTP基本认证的凭据是以Base64编码的形式传输的，因此并不安全。建议在启用HTTP认证的同时，使用HTTPS来加密传输数据。
:::

## 实际案例：结合IP地址和HTTP认证的访问控制

在实际应用中，你可能需要结合多种访问控制机制来构建更复杂的安全策略。例如，你可能希望只允许来自特定IP地址的用户访问某个资源，并且要求这些用户提供HTTP认证。

### 示例：结合IP地址和HTTP认证

假设你希望只允许来自`192.168.1.0/24`网段的用户访问`/secure`路径，并且要求这些用户提供HTTP认证。你可以在Nginx配置文件中添加以下内容：

```nginx
location /secure {
    allow 192.168.1.0/24;
    deny all;

    auth_basic "Restricted Access";
    auth_basic_user_file /etc/nginx/.htpasswd;
}
```

在这个配置中，`allow`指令允许来自`192.168.1.0/24`网段的IP地址访问，而`deny all`指令则拒绝其他所有IP地址的访问。同时，`auth_basic`和`auth_basic_user_file`指令启用了HTTP认证。

## 总结

Nginx提供了强大的访问控制机制，可以帮助你保护Web服务器免受未经授权的访问。通过合理配置`allow`、`deny`和`auth_basic`等指令，你可以实现基于IP地址和HTTP认证的访问控制，从而构建更复杂的安全策略。

在实际应用中，建议结合多种访问控制机制，并根据具体需求进行调整。同时，确保使用HTTPS来加密传输数据，以增强安全性。

## 附加资源

- [Nginx官方文档](https://nginx.org/en/docs/)
- [Nginx访问控制模块](https://nginx.org/en/docs/http/ngx_http_access_module.html)
- [Nginx HTTP认证模块](https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html)

## 练习

1. 配置Nginx，只允许来自`10.0.0.0/8`网段的IP地址访问`/admin`路径。
2. 配置Nginx，要求所有访问`/private`路径的用户提供HTTP认证。
3. 结合IP地址和HTTP认证，配置Nginx，只允许来自`192.168.1.0/24`网段的用户访问`/secure`路径，并且要求这些用户提供HTTP认证。
