---
title: Nginx 请求限制
description: 了解如何使用Nginx的请求限制功能来保护您的Web服务器免受恶意请求的侵害。
---

# Nginx 请求限制

Nginx是一个高性能的Web服务器和反向代理服务器，广泛用于处理高流量的网站。然而，随着流量的增加，恶意请求（如DDoS攻击）的风险也随之增加。为了保护您的服务器免受这些威胁，Nginx提供了请求限制功能，允许您控制客户端请求的频率。

## 什么是Nginx请求限制？

Nginx请求限制是一种机制，用于限制客户端在一定时间内可以发送的请求数量。通过设置请求限制，您可以防止恶意用户或机器人对您的服务器进行过度的请求，从而保护服务器资源，确保正常用户的访问体验。

## 如何配置Nginx请求限制？

Nginx的请求限制功能主要通过`limit_req`模块实现。该模块允许您定义一个“漏桶”算法，用于控制请求的速率。以下是配置Nginx请求限制的基本步骤：

### 1. 定义限制区域

首先，您需要在Nginx配置文件中定义一个限制区域。这个区域将用于存储客户端的请求状态。

```nginx
http {
    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;
}
```

在这个例子中，`limit_req_zone`指令定义了一个名为`one`的限制区域，大小为10MB，允许的请求速率为每秒1个请求（`1r/s`）。`$binary_remote_addr`变量用于标识客户端IP地址。

### 2. 应用限制区域

接下来，您需要在特定的`location`块中应用这个限制区域。

```nginx
server {
    location /api/ {
        limit_req zone=one burst=5;
        proxy_pass http://backend;
    }
}
```

在这个例子中，`limit_req`指令将`one`限制区域应用到`/api/`路径。`burst=5`参数允许在请求速率超过限制时，最多允许5个请求排队等待处理。

### 3. 处理超出限制的请求

当请求速率超过限制时，Nginx会返回`503 Service Temporarily Unavailable`错误。您可以通过配置`limit_req_status`指令来更改返回的状态码。

```nginx
http {
    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;
    limit_req_status 429;
}
```

在这个例子中，当请求速率超过限制时，Nginx将返回`429 Too Many Requests`状态码。

## 实际案例

假设您运营一个电子商务网站，并且您的API接口经常受到恶意爬虫的攻击。为了保护您的API接口，您可以配置Nginx请求限制，如下所示：

```nginx
http {
    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

    server {
        location /api/ {
            limit_req zone=api_limit burst=20 nodelay;
            proxy_pass http://backend;
        }
    }
}
```

在这个配置中，`api_limit`区域允许每秒10个请求，并且允许最多20个请求排队等待处理。`nodelay`参数表示立即处理排队中的请求，而不是等待。

## 总结

Nginx请求限制是一种强大的工具，可以帮助您保护服务器免受恶意请求的侵害。通过合理配置请求限制，您可以确保服务器的稳定性和正常用户的访问体验。

## 附加资源

- [Nginx官方文档](https://nginx.org/en/docs/)
- [Nginx请求限制模块文档](https://nginx.org/en/docs/http/ngx_http_limit_req_module.html)

## 练习

1. 在您的Nginx配置文件中，尝试定义一个限制区域，并将其应用到某个路径。
2. 测试您的配置，观察当请求速率超过限制时，Nginx的行为。
3. 尝试调整`burst`和`nodelay`参数，观察它们对请求处理的影响。

通过以上步骤，您将能够更好地理解和使用Nginx的请求限制功能。