---
title: Nginx SSL 代理
description: 学习如何使用 Nginx 配置 SSL 代理，确保客户端与服务器之间的通信安全。
---

## 介绍

在现代 Web 开发中，确保数据传输的安全性至关重要。SSL（Secure Sockets Layer）及其继任者 TLS（Transport Layer Security）是用于加密客户端与服务器之间通信的协议。Nginx 是一个高性能的 Web 服务器和反向代理服务器，支持 SSL/TLS 加密，能够轻松配置为 SSL 代理。

本文将逐步介绍如何在 Nginx 中配置 SSL 代理，确保你的网站或应用程序能够通过 HTTPS 安全地提供服务。

## 什么是 SSL 代理？

SSL 代理是一种反向代理，它在客户端与服务器之间建立加密连接。当客户端（如浏览器）请求访问服务器时，SSL 代理会处理 SSL/TLS 握手过程，确保数据在传输过程中被加密。Nginx 可以作为 SSL 代理，处理客户端的 HTTPS 请求，并将请求转发到后端服务器。

## 配置 Nginx SSL 代理

### 1. 获取 SSL 证书

在配置 Nginx SSL 代理之前，你需要获取 SSL 证书。你可以从受信任的证书颁发机构（CA）购买证书，或者使用 Let's Encrypt 等免费服务获取证书。

假设你已经获得了以下文件：
- `example.com.crt`：SSL 证书文件
- `example.com.key`：私钥文件

### 2. 配置 Nginx

接下来，你需要在 Nginx 配置文件中添加 SSL 配置。通常，Nginx 的配置文件位于 `/etc/nginx/nginx.conf` 或 `/etc/nginx/sites-available/default`。

以下是一个基本的 Nginx SSL 代理配置示例：

```nginx
server {
    listen 443 ssl;
    server_name example.com;

    ssl_certificate /etc/nginx/ssl/example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/example.com.key;

    location / {
        proxy_pass http://backend_server;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 3. 解释配置

- `listen 443 ssl;`：监听 443 端口（HTTPS 默认端口），并启用 SSL。
- `server_name example.com;`：指定服务器名称，通常为你的域名。
- `ssl_certificate` 和 `ssl_certificate_key`：分别指定 SSL 证书和私钥的路径。
- `proxy_pass http://backend_server;`：将请求转发到后端服务器。`backend_server` 可以是 IP 地址或域名。
- `proxy_set_header`：设置请求头，确保后端服务器能够正确识别客户端信息。

### 4. 重启 Nginx

完成配置后，保存文件并重启 Nginx 以应用更改：

```bash
sudo systemctl restart nginx
```

## 实际案例

假设你有一个运行在 `http://localhost:3000` 的 Node.js 应用程序，你希望通过 HTTPS 提供服务。你可以使用 Nginx 作为 SSL 代理，将 `https://example.com` 的请求转发到 `http://localhost:3000`。

### 配置示例

```nginx
server {
    listen 443 ssl;
    server_name example.com;

    ssl_certificate /etc/nginx/ssl/example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/example.com.key;

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 测试配置

在浏览器中访问 `https://example.com`，你应该能够看到 Node.js 应用程序的内容，并且连接是加密的。

## 总结

通过 Nginx 配置 SSL 代理，你可以轻松地为你的网站或应用程序启用 HTTPS，确保客户端与服务器之间的通信安全。本文介绍了如何获取 SSL 证书、配置 Nginx 以及实际应用案例。

:::tip
如果你使用的是 Let's Encrypt 证书，可以使用 Certbot 自动配置 Nginx SSL 代理。
:::

## 附加资源

- [Nginx 官方文档](https://nginx.org/en/docs/)
- [Let's Encrypt 官方网站](https://letsencrypt.org/)
- [Certbot 官方指南](https://certbot.eff.org/)

## 练习

1. 使用 Let's Encrypt 获取 SSL 证书，并配置 Nginx SSL 代理。
2. 尝试将 Nginx 配置为多个域名的 SSL 代理。
3. 研究如何配置 HTTP/2 以进一步提高性能。
