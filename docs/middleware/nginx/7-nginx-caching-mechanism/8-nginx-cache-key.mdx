---
title: Nginx 缓存键
description: 了解Nginx缓存键的概念及其在缓存机制中的作用，掌握如何配置和优化缓存键以提高网站性能。
---

# Nginx 缓存键

## 介绍

Nginx缓存键（Cache Key）是Nginx缓存机制中的核心概念之一。它决定了Nginx如何识别和存储缓存内容。简单来说，缓存键是一个唯一的标识符，用于区分不同的缓存条目。通过合理配置缓存键，可以显著提高缓存的命中率，从而提升网站的性能。

## 缓存键的作用

缓存键的主要作用是确保Nginx能够正确地识别和存储缓存内容。当Nginx接收到一个请求时，它会根据缓存键来判断是否已经缓存了该请求的响应。如果缓存键匹配，Nginx会直接返回缓存的内容，而不需要再次处理请求。

## 缓存键的组成

缓存键通常由请求的URI、请求方法、请求头等信息组成。Nginx允许你自定义缓存键的组成，以便更好地满足你的需求。

### 默认缓存键

默认情况下，Nginx的缓存键由以下部分组成：

- 请求的URI
- 请求方法（GET、POST等）
- 请求头中的`Host`字段

例如，对于以下请求：

```
GET /index.html HTTP/1.1
Host: example.com
```

默认的缓存键可能是：

```
GET|example.com|/index.html
```

### 自定义缓存键

你可以通过`proxy_cache_key`指令来自定义缓存键。例如，假设你希望缓存键包含请求的URI和查询参数，可以这样配置：

```nginx
proxy_cache_key "$scheme$proxy_host$request_uri";
```

在这个例子中，缓存键将包含协议（`$scheme`）、代理主机（`$proxy_host`）和请求的URI（`$request_uri`）。

## 实际案例

### 案例1：缓存动态内容

假设你有一个动态生成内容的网站，内容根据用户的地理位置不同而变化。为了缓存这些动态内容，你可以在缓存键中包含用户的地理位置信息。

```nginx
proxy_cache_key "$scheme$proxy_host$request_uri$http_cf_ipcountry";
```

在这个例子中，`$http_cf_ipcountry`是一个自定义的请求头，包含了用户的地理位置信息。这样，Nginx会根据用户的地理位置生成不同的缓存键，从而缓存不同的内容。

### 案例2：缓存API响应

假设你有一个API，响应内容根据请求头中的`Authorization`字段不同而变化。为了缓存这些API响应，你可以在缓存键中包含`Authorization`字段。

```nginx
proxy_cache_key "$scheme$proxy_host$request_uri$http_authorization";
```

在这个例子中，`$http_authorization`是请求头中的`Authorization`字段。这样，Nginx会根据不同的`Authorization`字段生成不同的缓存键，从而缓存不同的API响应。

## 总结

Nginx缓存键是Nginx缓存机制中的关键概念，它决定了Nginx如何识别和存储缓存内容。通过合理配置缓存键，可以显著提高缓存的命中率，从而提升网站的性能。在实际应用中，你可以根据需求自定义缓存键，以满足不同的缓存需求。

## 附加资源

- [Nginx官方文档](https://nginx.org/en/docs/)
- [Nginx缓存配置指南](https://www.nginx.com/resources/wiki/start/topics/examples/caching/)

## 练习

1. 尝试在你的Nginx配置中自定义缓存键，并观察缓存命中率的变化。
2. 假设你有一个多语言网站，如何在缓存键中包含语言信息？
3. 研究Nginx的其他缓存相关指令，如`proxy_cache_valid`和`proxy_cache_bypass`，并尝试在配置中使用它们。
