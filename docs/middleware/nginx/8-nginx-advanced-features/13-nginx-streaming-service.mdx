---
title: Nginx 流媒体服务
description: 了解如何使用Nginx配置流媒体服务，支持视频和音频的实时传输与播放。
---

# Nginx 流媒体服务

Nginx 不仅仅是一个高性能的 Web 服务器，它还可以作为流媒体服务器，支持视频和音频的实时传输与播放。通过 Nginx 的流媒体模块，您可以轻松地搭建一个支持 HLS（HTTP Live Streaming）或 RTMP（Real-Time Messaging Protocol）的流媒体服务。本文将逐步介绍如何配置 Nginx 以实现流媒体服务，并通过实际案例展示其应用场景。

## 什么是流媒体服务？

流媒体服务允许用户通过网络实时传输和播放音频或视频内容，而无需等待整个文件下载完成。常见的流媒体协议包括 HLS 和 RTMP。HLS 是基于 HTTP 的流媒体协议，广泛用于移动设备和 Web 浏览器；而 RTMP 是一种低延迟的流媒体协议，常用于直播场景。

## 配置 Nginx 支持 HLS

HLS 是苹果公司开发的流媒体协议，它将视频文件分割成多个小片段（通常是 `.ts` 文件），并通过一个 `.m3u8` 播放列表文件来索引这些片段。Nginx 可以通过 `nginx-rtmp-module` 模块来支持 HLS。

### 安装 Nginx 和 RTMP 模块

首先，您需要安装 Nginx 并启用 RTMP 模块。以下是在 Ubuntu 系统上安装 Nginx 和 RTMP 模块的步骤：

```bash
sudo apt update
sudo apt install nginx
sudo apt install libnginx-mod-rtmp
```

### 配置 Nginx 支持 HLS

接下来，您需要在 Nginx 配置文件中添加 RTMP 模块的配置。打开 `/etc/nginx/nginx.conf` 文件，并添加以下内容：

```nginx
rtmp {
    server {
        listen 1935; # RTMP 默认端口
        chunk_size 4096;

        application live {
            live on;
            hls on;
            hls_path /var/www/html/stream/hls;
            hls_fragment 3;
            hls_playlist_length 60;
        }
    }
}
```

在上述配置中，`hls_path` 指定了 HLS 文件的存储路径，`hls_fragment` 定义了每个视频片段的时长（以秒为单位），`hls_playlist_length` 定义了播放列表的长度（以秒为单位）。

### 配置 HTTP 服务器

为了让客户端能够访问 HLS 文件，您还需要配置 Nginx 的 HTTP 服务器部分。在 `/etc/nginx/sites-available/default` 文件中添加以下内容：

```nginx
server {
    listen 80;
    server_name your_domain.com;

    location /hls {
        types {
            application/vnd.apple.mpegurl m3u8;
            video/mp2t ts;
        }
        root /var/www/html/stream;
        add_header Cache-Control no-cache;
    }
}
```

### 启动 Nginx

完成配置后，重新启动 Nginx 以应用更改：

```bash
sudo systemctl restart nginx
```

### 测试 HLS 流媒体服务

您可以使用 FFmpeg 将视频流推送到 Nginx 服务器：

```bash
ffmpeg -re -i input.mp4 -c:v libx264 -c:a aac -f flv rtmp://your_domain.com/live/stream
```

然后，您可以通过访问 `http://your_domain.com/hls/stream.m3u8` 来播放 HLS 流。

## 配置 Nginx 支持 RTMP

RTMP 是一种低延迟的流媒体协议，常用于直播场景。Nginx 可以通过 `nginx-rtmp-module` 模块来支持 RTMP。

### 配置 RTMP 服务器

在 `/etc/nginx/nginx.conf` 文件中添加以下内容：

```nginx
rtmp {
    server {
        listen 1935;
        chunk_size 4096;

        application live {
            live on;
            record off;
        }
    }
}
```

### 测试 RTMP 流媒体服务

您可以使用 OBS Studio 或其他 RTMP 客户端将视频流推送到 Nginx 服务器：

```bash
rtmp://your_domain.com/live/stream
```

然后，您可以使用 VLC 或其他支持 RTMP 的播放器来播放流媒体内容。

## 实际应用场景

### 直播平台

Nginx 的流媒体服务可以用于搭建直播平台。通过 RTMP 协议，主播可以将视频流推送到 Nginx 服务器，而观众可以通过 HLS 或 RTMP 协议观看直播。

### 视频点播

Nginx 的 HLS 功能可以用于搭建视频点播平台。您可以将视频文件分割成多个小片段，并通过 HLS 协议进行传输，用户可以通过 Web 浏览器或移动设备观看视频。

## 总结

通过本文，您已经了解了如何使用 Nginx 配置流媒体服务，支持 HLS 和 RTMP 协议。Nginx 的流媒体功能非常强大，适用于直播、视频点播等多种场景。希望本文能帮助您快速上手 Nginx 流媒体服务。

## 附加资源

- [Nginx RTMP 模块文档](https://github.com/arut/nginx-rtmp-module)
- [FFmpeg 官方文档](https://ffmpeg.org/documentation.html)
- [OBS Studio 官方文档](https://obsproject.com/wiki/)

## 练习

1. 尝试配置 Nginx 支持 HLS，并使用 FFmpeg 推送视频流。
2. 使用 OBS Studio 将视频流推送到 Nginx 服务器，并通过 VLC 播放。
3. 探索如何优化 Nginx 的流媒体配置，以支持更多的并发用户。