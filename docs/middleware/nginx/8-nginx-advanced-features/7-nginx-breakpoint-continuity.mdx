---
title: Nginx 断点续传
description: 了解Nginx如何支持断点续传功能，帮助用户在网络中断或暂停后继续下载文件。
---

## 介绍

断点续传是一种允许用户在网络中断或暂停后继续下载文件的功能。对于大文件下载来说，这一功能尤为重要，因为它可以避免用户重新下载整个文件，从而节省时间和带宽。Nginx 作为一款高性能的 Web 服务器，原生支持断点续传功能。

在本教程中，我们将逐步讲解 Nginx 如何实现断点续传，并通过实际案例展示其应用场景。

## Nginx 断点续传的工作原理

Nginx 通过 HTTP/1.1 协议中的 `Range` 请求头来实现断点续传。当客户端请求下载文件时，可以通过 `Range` 头指定需要下载的文件范围。Nginx 会根据这个范围返回相应的文件片段，而不是整个文件。

### HTTP Range 请求示例

假设客户端需要下载一个 100MB 的文件，但只下载了前 50MB 后中断了连接。当客户端重新连接时，可以通过以下请求头继续下载剩余的 50MB：

```http
GET /largefile.zip HTTP/1.1
Host: example.com
Range: bytes=50000000-
```

Nginx 会返回从 50MB 开始的文件内容，并附带以下响应头：

```http
HTTP/1.1 206 Partial Content
Content-Range: bytes 50000000-99999999/100000000
Content-Length: 50000000
```

### Nginx 配置

Nginx 默认支持断点续传功能，无需额外配置。但如果你需要确保该功能正常工作，可以检查以下配置项：

```nginx
server {
    listen 80;
    server_name example.com;

    location / {
        root /var/www/html;
        # 确保支持 Range 请求
        add_header Accept-Ranges bytes;
    }
}
```

:::note
`Accept-Ranges: bytes` 响应头告诉客户端服务器支持字节范围的请求。如果服务器不支持断点续传，可以设置为 `none`。
:::

## 实际案例

### 案例 1：大文件下载

假设你有一个 1GB 的视频文件需要提供给用户下载。由于文件较大，用户可能会在下载过程中遇到网络中断。通过 Nginx 的断点续传功能，用户可以在网络恢复后继续下载，而无需重新开始。

### 案例 2：流媒体服务

在流媒体服务中，用户可能会频繁地暂停和继续播放视频。Nginx 的断点续传功能可以确保用户在暂停后继续从上次中断的位置播放视频，从而提供更好的用户体验。

## 总结

Nginx 的断点续传功能通过 HTTP/1.1 的 `Range` 请求头实现，能够有效提升大文件下载和流媒体服务的用户体验。默认情况下，Nginx 已经支持该功能，但你可以通过配置 `Accept-Ranges` 响应头来确保其正常工作。

## 附加资源

- [Nginx 官方文档](https://nginx.org/en/docs/)
- [HTTP/1.1 Range Requests](https://developer.mozilla.org/en-US/docs/Web/HTTP/Range_requests)

## 练习

1. 配置一个 Nginx 服务器，提供一个大文件下载服务，并测试断点续传功能。
2. 使用 `curl` 命令模拟断点续传请求，观察 Nginx 的响应。

```bash
curl -r 50000000- -o largefile.part2 http://example.com/largefile.zip
```

通过以上练习，你将更深入地理解 Nginx 断点续传的工作原理和应用场景。