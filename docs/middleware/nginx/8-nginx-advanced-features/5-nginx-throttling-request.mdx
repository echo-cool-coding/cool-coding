---
title: Nginx 限制请求
description: 学习如何使用Nginx限制请求，保护服务器免受恶意流量和DDoS攻击。本文适合初学者，包含代码示例和实际案例。
---

# Nginx 限制请求

Nginx是一个高性能的Web服务器和反向代理服务器，广泛用于处理高并发请求。在实际应用中，为了保护服务器免受恶意流量和DDoS攻击，限制请求速率是一个非常重要的功能。本文将详细介绍如何使用Nginx限制请求速率，并通过实际案例帮助您理解其应用场景。

## 什么是请求限制？

请求限制是指通过配置Nginx，限制客户端在一定时间内可以发送的请求数量。这可以有效防止恶意用户或自动化脚本对服务器进行滥用，从而保护服务器的稳定性和安全性。

## 如何配置Nginx限制请求？

Nginx提供了`limit_req`模块来实现请求限制。该模块允许您根据IP地址或其他条件限制请求速率。以下是配置请求限制的基本步骤：

### 1. 定义限制区域

首先，您需要在Nginx配置文件中定义一个限制区域。这个区域将存储每个客户端的请求状态。

```nginx
http {
    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;
}
```

- `$binary_remote_addr`：基于客户端的IP地址进行限制。
- `zone=one:10m`：定义一个名为`one`的限制区域，大小为10MB。
- `rate=1r/s`：限制每个客户端每秒只能发送1个请求。

### 2. 应用限制区域

接下来，您可以在具体的`location`块中应用这个限制区域。

```nginx
server {
    location /api/ {
        limit_req zone=one burst=5 nodelay;
        proxy_pass http://backend;
    }
}
```

- `zone=one`：指定使用之前定义的`one`限制区域。
- `burst=5`：允许突发5个请求，超过限制的请求将被延迟处理。
- `nodelay`：立即处理突发请求，而不是延迟。

### 3. 测试配置

保存配置文件后，重新加载Nginx以使配置生效。

```bash
sudo nginx -s reload
```

现在，Nginx将限制每个客户端每秒只能发送1个请求到`/api/`路径。如果客户端发送的请求超过限制，Nginx将返回`503 Service Temporarily Unavailable`错误。

## 实际案例

假设您运营一个电商网站，某个API接口被恶意用户频繁调用，导致服务器负载过高。您可以使用Nginx的请求限制功能来保护这个API接口。

```nginx
http {
    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;
}

server {
    location /checkout/ {
        limit_req zone=api_limit burst=20 nodelay;
        proxy_pass http://backend;
    }
}
```

在这个案例中，我们定义了一个名为`api_limit`的限制区域，限制每个客户端每秒只能发送10个请求到`/checkout/`路径。同时，允许突发20个请求，并立即处理这些请求。

## 总结

通过Nginx的`limit_req`模块，您可以有效地限制客户端请求速率，保护服务器免受恶意流量和DDoS攻击。本文介绍了如何配置请求限制，并通过实际案例展示了其应用场景。希望这些内容能帮助您更好地理解和使用Nginx的请求限制功能。

## 附加资源

- [Nginx官方文档](https://nginx.org/en/docs/)
- [Nginx请求限制模块详解](https://nginx.org/en/docs/http/ngx_http_limit_req_module.html)

## 练习

1. 在您的Nginx服务器上配置一个请求限制区域，限制每个客户端每分钟只能发送60个请求。
2. 测试配置，观察当请求超过限制时Nginx的行为。
