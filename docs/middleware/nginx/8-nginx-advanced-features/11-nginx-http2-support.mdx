---
title: Nginx HTTP/2 支持
description: "了解如何在 Nginx 中启用和配置 HTTP/2，提升网站性能和用户体验。"
---

## 介绍

HTTP/2 是 HTTP 协议的第二个主要版本，旨在提高 Web 性能。与 HTTP/1.1 相比，HTTP/2 引入了多路复用、头部压缩和服务器推送等特性，能够显著减少页面加载时间并提升用户体验。Nginx 从 1.9.5 版本开始支持 HTTP/2，本文将详细介绍如何在 Nginx 中启用和配置 HTTP/2。

:::note
HTTP/2 需要 HTTPS（即 TLS/SSL）支持。因此，在启用 HTTP/2 之前，请确保您的服务器已配置 SSL 证书。
:::

## 启用 HTTP/2

要在 Nginx 中启用 HTTP/2，您需要在服务器块（`server` block）的 `listen` 指令中添加 `http2` 参数。以下是一个简单的配置示例：

```nginx
server {
    listen 443 ssl http2;
    server_name example.com;

    ssl_certificate /etc/nginx/ssl/example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/example.com.key;

    location / {
        root /var/www/html;
        index index.html;
    }
}
```

### 解释
- `listen 443 ssl http2;`：监听 443 端口，启用 SSL 和 HTTP/2。
- `ssl_certificate` 和 `ssl_certificate_key`：指定 SSL 证书和私钥的路径。
- `location /`：定义根路径的处理方式。

:::tip
如果您希望同时支持 HTTP/1.1 和 HTTP/2，可以保留 `listen 80;` 配置，以便处理未加密的 HTTP 请求。
:::

## HTTP/2 的优势

### 多路复用
HTTP/2 允许在单个连接上同时传输多个请求和响应，避免了 HTTP/1.1 中的队头阻塞问题。这意味着浏览器可以并行加载资源，而不需要为每个资源建立多个连接。

### 头部压缩
HTTP/2 使用 HPACK 算法对 HTTP 头部进行压缩，减少了数据传输量，从而提高了性能。

### 服务器推送
HTTP/2 允许服务器主动向客户端推送资源，而不需要客户端明确请求。例如，当客户端请求一个 HTML 页面时，服务器可以主动推送相关的 CSS 和 JavaScript 文件。

## 实际案例

假设您正在运行一个电子商务网站，首页包含大量图片和脚本文件。使用 HTTP/1.1 时，浏览器需要为每个资源建立单独的连接，导致页面加载时间较长。启用 HTTP/2 后，浏览器可以通过单个连接并行加载所有资源，显著减少页面加载时间。

以下是一个简单的 Nginx 配置示例，展示了如何为电子商务网站启用 HTTP/2：

```nginx
server {
    listen 443 ssl http2;
    server_name shop.example.com;

    ssl_certificate /etc/nginx/ssl/shop.example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/shop.example.com.key;

    location / {
        root /var/www/shop;
        index index.html;
    }

    location /static/ {
        alias /var/www/shop/static/;
    }
}
```

### 解释
- `location /static/`：为静态资源（如图片、CSS 和 JavaScript 文件）设置单独的路径，以便更好地管理和缓存。

:::caution
确保您的 SSL 证书有效且配置正确，否则 HTTP/2 将无法正常工作。
:::

## 总结

通过启用 HTTP/2，您可以显著提升网站的性能和用户体验。Nginx 提供了简单的配置选项，使您能够轻松启用 HTTP/2 并享受其带来的优势。在实际应用中，HTTP/2 的多路复用、头部压缩和服务器推送等特性能够有效减少页面加载时间，特别是在资源密集型的网站中。

## 附加资源

- [Nginx 官方文档](https://nginx.org/en/docs/)
- [HTTP/2 规范](https://httpwg.org/specs/rfc7540.html)
- [SSL/TLS 配置指南](https://ssl-config.mozilla.org/)

## 练习

1. 在您的 Nginx 服务器上启用 HTTP/2，并使用浏览器开发者工具验证 HTTP/2 是否正常工作。
2. 尝试配置服务器推送功能，观察其对页面加载时间的影响。
3. 比较 HTTP/1.1 和 HTTP/2 在相同页面加载时的性能差异。

:::warning
在修改 Nginx 配置后，请务必使用 `nginx -t` 命令测试配置文件的正确性，然后使用 `systemctl reload nginx` 重新加载配置。
:::