---
title: Nginx 多站点管理
description: 学习如何使用Nginx管理多个站点，包括配置文件的组织、虚拟主机的设置以及常见问题的解决方案。
---

## 介绍

Nginx 是一个高性能的 HTTP 服务器和反向代理服务器，广泛用于托管多个网站。通过合理配置 Nginx，您可以在同一台服务器上托管多个站点，每个站点可以拥有独立的域名和配置。本文将详细介绍如何在 Nginx 中管理多个站点，适合初学者学习和实践。

## Nginx 配置文件结构

Nginx 的配置文件通常位于 `/etc/nginx/` 目录下。主要的配置文件是 `nginx.conf`，而站点配置文件通常放在 `/etc/nginx/sites-available/` 目录中，并通过符号链接到 `/etc/nginx/sites-enabled/` 目录来启用。

### 1. 主配置文件 (`nginx.conf`)

`nginx.conf` 是 Nginx 的主配置文件，通常包含全局配置和默认的服务器块（server block）。以下是一个简单的 `nginx.conf` 示例：

```nginx
user www-data;
worker_processes auto;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;
}
```

### 2. 站点配置文件

每个站点的配置文件通常放在 `/etc/nginx/sites-available/` 目录中。例如，假设我们有两个站点 `example.com` 和 `example.org`，我们可以为每个站点创建一个配置文件：

- `/etc/nginx/sites-available/example.com`
- `/etc/nginx/sites-available/example.org`

然后，通过创建符号链接将这些文件链接到 `/etc/nginx/sites-enabled/` 目录：

```bash
sudo ln -s /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/
sudo ln -s /etc/nginx/sites-available/example.org /etc/nginx/sites-enabled/
```

## 配置虚拟主机

虚拟主机（Virtual Host）是 Nginx 中用于托管多个站点的核心概念。每个虚拟主机对应一个 `server` 块，定义了站点的域名、根目录、日志文件等。

### 1. 基本虚拟主机配置

以下是一个简单的虚拟主机配置示例，用于托管 `example.com`：

```nginx
server {
    listen 80;
    server_name example.com;

    root /var/www/example.com;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    access_log /var/log/nginx/example.com.access.log;
    error_log /var/log/nginx/example.com.error.log;
}
```

### 2. 多个虚拟主机配置

如果您有多个站点，可以为每个站点创建一个类似的 `server` 块。例如，托管 `example.org` 的配置如下：

```nginx
server {
    listen 80;
    server_name example.org;

    root /var/www/example.org;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    access_log /var/log/nginx/example.org.access.log;
    error_log /var/log/nginx/example.org.error.log;
}
```

## 实际案例

假设您正在托管两个网站：`blog.example.com` 和 `shop.example.com`。您可以使用以下配置来管理这两个站点：

```nginx
# blog.example.com
server {
    listen 80;
    server_name blog.example.com;

    root /var/www/blog;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    access_log /var/log/nginx/blog.access.log;
    error_log /var/log/nginx/blog.error.log;
}

# shop.example.com
server {
    listen 80;
    server_name shop.example.com;

    root /var/www/shop;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    access_log /var/log/nginx/shop.access.log;
    error_log /var/log/nginx/shop.error.log;
}
```

## 常见问题与解决方案

### 1. 站点无法访问

如果某个站点无法访问，首先检查 Nginx 的配置文件是否有语法错误：

```bash
sudo nginx -t
```

如果配置文件没有问题，检查站点的根目录和文件权限是否正确。

### 2. 域名解析问题

确保域名已正确解析到服务器的 IP 地址。您可以使用 `dig` 或 `nslookup` 命令来检查域名解析：

```bash
dig example.com
```

## 总结

通过本文，您已经学习了如何在 Nginx 中管理多个站点。我们介绍了 Nginx 的配置文件结构、虚拟主机的配置方法，并通过实际案例展示了如何托管多个站点。希望这些内容能帮助您更好地理解和使用 Nginx。

## 附加资源与练习

- **练习**：尝试在您的服务器上配置两个虚拟主机，分别托管不同的站点。
- **资源**：
  - [Nginx 官方文档](https://nginx.org/en/docs/)
  - [Nginx 配置指南](https://www.digitalocean.com/community/tutorials/understanding-nginx-server-and-location-block-selection-algorithms)

:::tip
如果您在配置过程中遇到问题，可以随时查看 Nginx 的错误日志 `/var/log/nginx/error.log`，这通常会提供有用的调试信息。
:::