---
title: Zookeeper API 基本操作
description: 本文介绍了 Zookeeper API 的基本操作，包括创建节点、读取节点、更新节点和删除节点等。通过代码示例和实际案例，帮助初学者快速掌握 Zookeeper API 的使用。
---

# Zookeeper API 基本操作

Zookeeper 是一个分布式协调服务，广泛用于分布式系统中的配置管理、命名服务、分布式锁等场景。Zookeeper 提供了一套简单的 API，允许开发者通过编程方式与 Zookeeper 集群进行交互。本文将介绍 Zookeeper API 的基本操作，帮助初学者快速上手。

## 1. Zookeeper API 简介

Zookeeper API 提供了一系列方法，用于在 Zookeeper 集群中创建、读取、更新和删除节点（ZNode）。每个节点可以存储数据，并且可以设置访问权限。Zookeeper 的节点结构类似于文件系统的目录树，节点路径以 `/` 分隔。

## 2. 基本操作

### 2.1 创建节点

在 Zookeeper 中，可以使用 `create` 方法创建一个新的节点。创建节点时需要指定节点的路径、数据、访问权限和节点类型。

```java
// 创建节点
String path = "/myNode";
byte[] data = "Hello Zookeeper".getBytes();
List<ACL> acl = ZooDefs.Ids.OPEN_ACL_UNSAFE;
CreateMode createMode = CreateMode.PERSISTENT;

String createdPath = zk.create(path, data, acl, createMode);
System.out.println("Node created at: " + createdPath);
```

**输入：**
- `path`: 节点路径，例如 `/myNode`
- `data`: 节点数据，例如 `"Hello Zookeeper"`
- `acl`: 访问控制列表，例如 `ZooDefs.Ids.OPEN_ACL_UNSAFE`
- `createMode`: 节点类型，例如 `CreateMode.PERSISTENT`

**输出：**
- `createdPath`: 创建的节点路径，例如 `/myNode`

### 2.2 读取节点

使用 `getData` 方法可以读取节点的数据。

```java
// 读取节点数据
Stat stat = new Stat();
byte[] data = zk.getData(path, false, stat);
System.out.println("Node data: " + new String(data));
```

**输入：**
- `path`: 节点路径，例如 `/myNode`
- `watch`: 是否监听节点变化，例如 `false`
- `stat`: 节点状态信息

**输出：**
- `data`: 节点数据，例如 `"Hello Zookeeper"`

### 2.3 更新节点

使用 `setData` 方法可以更新节点的数据。

```java
// 更新节点数据
byte[] newData = "Updated data".getBytes();
zk.setData(path, newData, stat.getVersion());
System.out.println("Node data updated");
```

**输入：**
- `path`: 节点路径，例如 `/myNode`
- `data`: 新的节点数据，例如 `"Updated data"`
- `version`: 节点版本号，例如 `stat.getVersion()`

**输出：**
- 无返回值，节点数据被更新

### 2.4 删除节点

使用 `delete` 方法可以删除节点。

```java
// 删除节点
zk.delete(path, stat.getVersion());
System.out.println("Node deleted");
```

**输入：**
- `path`: 节点路径，例如 `/myNode`
- `version`: 节点版本号，例如 `stat.getVersion()`

**输出：**
- 无返回值，节点被删除

## 3. 实际案例

### 3.1 分布式锁

Zookeeper 可以用于实现分布式锁。通过创建一个临时顺序节点，客户端可以竞争锁。只有创建了最小序号的节点的客户端才能获得锁。

```java
// 创建临时顺序节点
String lockPath = zk.create("/locks/lock-", null, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);

// 获取所有锁节点
List<String> children = zk.getChildren("/locks", false);
Collections.sort(children);

// 检查是否获得锁
if (lockPath.endsWith(children.get(0))) {
    System.out.println("Lock acquired");
} else {
    System.out.println("Waiting for lock");
}
```

**输入：**
- `path`: 锁节点路径，例如 `/locks/lock-`
- `data`: 节点数据，例如 `null`
- `acl`: 访问控制列表，例如 `ZooDefs.Ids.OPEN_ACL_UNSAFE`
- `createMode`: 节点类型，例如 `CreateMode.EPHEMERAL_SEQUENTIAL`

**输出：**
- `lockPath`: 创建的锁节点路径，例如 `/locks/lock-0000000001`
- `children`: 所有锁节点列表，例如 `["lock-0000000001", "lock-0000000002"]`

## 4. 总结

本文介绍了 Zookeeper API 的基本操作，包括创建节点、读取节点、更新节点和删除节点。通过实际案例，展示了 Zookeeper 在分布式锁中的应用。掌握这些基本操作是使用 Zookeeper 进行分布式系统开发的基础。

## 5. 附加资源

- [Zookeeper 官方文档](https://zookeeper.apache.org/doc/current/)
- [Zookeeper Java API 文档](https://zookeeper.apache.org/doc/current/api/index.html)

## 6. 练习

1. 尝试使用 Zookeeper API 创建一个临时节点，并观察节点的生命周期。
2. 实现一个简单的分布式锁，并测试多个客户端同时竞争锁的场景。
