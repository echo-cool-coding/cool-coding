---
title: Zookeeper 基本概念
description: 了解 Zookeeper 的核心概念，包括其架构、节点类型、数据模型和实际应用场景。适合初学者快速入门。
---

# Zookeeper 基本概念

Zookeeper 是一个分布式协调服务，广泛应用于分布式系统中，用于管理配置信息、命名服务、分布式同步和组服务等。它通过一个简单的分层命名空间（类似于文件系统）来存储数据，并提供高可用性和强一致性。

## 1. Zookeeper 的核心概念

### 1.1 分布式协调服务
Zookeeper 的主要目标是提供一个可靠的分布式协调服务。它通过维护一个共享的、一致的数据存储来实现这一点。多个客户端可以同时连接到 Zookeeper 集群，并通过读写操作来共享和同步数据。

### 1.2 数据模型
Zookeeper 的数据模型类似于文件系统的树形结构，每个节点称为 **ZNode**。ZNode 可以存储数据，并且可以有子节点。ZNode 的类型决定了它的行为和生命周期。

```mermaid
graph TD
    A[/] --> B[/app1]
    A --> C[/app2]
    B --> D[/app1/config]
    B --> E[/app1/locks]
    C --> F[/app2/config]
    C --> G[/app2/locks]
```

### 1.3 ZNode 类型
Zookeeper 中的 ZNode 有以下几种类型：

- **持久节点（Persistent Node）**：一旦创建，除非显式删除，否则会一直存在。
- **临时节点（Ephemeral Node）**：与客户端会话绑定，会话结束时节点自动删除。
- **顺序节点（Sequential Node）**：在创建时，Zookeeper 会自动在节点名称后附加一个单调递增的数字。

:::tip
临时节点非常适合用于实现分布式锁或服务注册与发现。
:::

### 1.4 Watcher 机制
Zookeeper 提供了 **Watcher** 机制，允许客户端在 ZNode 发生变化时收到通知。Watcher 是一次性的，即触发一次后需要重新注册。

## 2. Zookeeper 的实际应用

### 2.1 分布式锁
Zookeeper 可以用来实现分布式锁。通过创建一个临时顺序节点，客户端可以竞争锁。只有持有最小顺序号的客户端才能获得锁。

```bash
# 创建锁节点
create /locks/lock_0000000001
```

### 2.2 配置管理
Zookeeper 可以用于集中管理分布式系统的配置信息。所有客户端都可以监听配置节点的变化，并在配置更新时自动获取最新配置。

```bash
# 设置配置
set /app1/config "key=value"
```

### 2.3 服务发现
在微服务架构中，Zookeeper 可以用于服务注册与发现。服务启动时在 Zookeeper 中注册自己的地址，客户端通过查询 Zookeeper 来获取服务地址。

```bash
# 注册服务
create /services/service1 "192.168.1.1:8080"
```

## 3. 总结

Zookeeper 是一个强大的分布式协调工具，广泛应用于分布式系统中。通过理解其核心概念，如 ZNode、Watcher 机制以及实际应用场景，你可以更好地利用 Zookeeper 来构建可靠的分布式系统。

:::note
**附加资源：**
- [Zookeeper 官方文档](https://zookeeper.apache.org/doc/current/)
- 《从 Paxos 到 Zookeeper：分布式一致性原理与实践》
:::

:::tip
**练习：**
1. 尝试在本地搭建一个 Zookeeper 集群。
2. 使用 Zookeeper 实现一个简单的分布式锁。
3. 编写一个 Watcher 程序，监听某个 ZNode 的变化并打印日志。
:::