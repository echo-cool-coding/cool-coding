---
title: Zookeeper Digest认证
description: 了解Zookeeper的Digest认证机制，掌握如何通过用户名和密码实现访问控制。
---

# Zookeeper Digest认证

Zookeeper是一个分布式协调服务，广泛用于分布式系统中的配置管理、命名服务、分布式锁等场景。为了确保Zookeeper集群的安全性，Zookeeper提供了多种认证机制，其中**Digest认证**是最常用的一种。本文将详细介绍Zookeeper的Digest认证机制，帮助初学者理解并掌握如何通过用户名和密码实现访问控制。

## 什么是Digest认证？

Digest认证是一种基于用户名和密码的认证机制。在Zookeeper中，Digest认证通过将用户名和密码进行哈希处理，生成一个唯一的标识符（Digest），用于验证客户端的身份。这种方式避免了明文传输密码，提高了安全性。

### 工作原理

1. **客户端**：客户端在连接Zookeeper时，提供用户名和密码。
2. **Zookeeper**：Zookeeper将用户名和密码进行哈希处理，生成Digest，并与存储在Zookeeper中的Digest进行比对。
3. **认证结果**：如果比对成功，客户端通过认证，可以访问Zookeeper中的资源；否则，认证失败，访问被拒绝。

## 配置Digest认证

### 1. 在Zookeeper服务器端配置

首先，需要在Zookeeper服务器端配置Digest认证。可以通过修改`zoo.cfg`文件来启用认证。

```plaintext
authProvider.1=org.apache.zookeeper.server.auth.DigestAuthenticationProvider
```

### 2. 添加用户

在Zookeeper中，用户信息以`username:password`的形式存储在ACL（访问控制列表）中。可以通过Zookeeper的命令行工具`zkCli.sh`添加用户。

```bash
# 连接到Zookeeper
./zkCli.sh -server localhost:2181

# 添加用户
addauth digest username:password
```

### 3. 设置ACL

在Zookeeper中，ACL用于控制对节点的访问权限。可以通过`setAcl`命令为节点设置ACL。

```bash
# 设置ACL
setAcl /path/to/node auth:username:password:cdrwa
```

其中，`cdrwa`表示权限：
- `c`：创建子节点
- `d`：删除子节点
- `r`：读取节点数据
- `w`：写入节点数据
- `a`：管理ACL

## 代码示例

以下是一个使用Java客户端连接Zookeeper并进行Digest认证的示例。

```java
import org.apache.zookeeper.ZooKeeper;
import org.apache.zookeeper.ZooDefs;
import org.apache.zookeeper.data.ACL;
import org.apache.zookeeper.data.Id;
import org.apache.zookeeper.server.auth.DigestAuthenticationProvider;

import java.util.ArrayList;
import java.util.List;

public class ZookeeperDigestAuthExample {
    public static void main(String[] args) throws Exception {
        // 连接到Zookeeper
        ZooKeeper zk = new ZooKeeper("localhost:2181", 3000, null);

        // 添加Digest认证
        zk.addAuthInfo("digest", "username:password".getBytes());

        // 设置ACL
        List<ACL> acls = new ArrayList<>();
        acls.add(new ACL(ZooDefs.Perms.ALL, new Id("digest", DigestAuthenticationProvider.generateDigest("username:password"))));

        // 创建节点并设置ACL
        zk.create("/secureNode", "secureData".getBytes(), acls, ZooDefs.Ids.OPEN_ACL_UNSAFE);

        // 关闭连接
        zk.close();
    }
}
```

### 输出

如果认证成功，节点`/secureNode`将被创建，并且只有通过Digest认证的用户才能访问该节点。

## 实际应用场景

### 场景1：分布式配置管理

在分布式系统中，配置信息通常存储在Zookeeper中。通过Digest认证，可以确保只有授权的客户端才能读取或修改配置信息，从而提高系统的安全性。

### 场景2：分布式锁

在分布式锁的实现中，Zookeeper用于协调多个客户端之间的锁竞争。通过Digest认证，可以确保只有授权的客户端才能参与锁竞争，防止未授权的客户端干扰锁的正常工作。

## 总结

Zookeeper的Digest认证机制通过用户名和密码实现访问控制，确保了Zookeeper集群的安全性。本文详细介绍了Digest认证的工作原理、配置方法以及实际应用场景，并通过代码示例展示了如何在Java客户端中使用Digest认证。

## 附加资源

- [Zookeeper官方文档](https://zookeeper.apache.org/doc/current/zookeeperProgrammers.html#sc_ZooKeeperAccessControl)
- [Zookeeper ACL详解](https://zookeeper.apache.org/doc/current/zookeeperProgrammers.html#sc_ZooKeeperAccessControl)

## 练习

1. 尝试在本地Zookeeper集群中配置Digest认证，并创建一个受保护的节点。
2. 编写一个Java客户端程序，使用Digest认证连接到Zookeeper，并访问受保护的节点。
3. 修改ACL权限，观察不同权限对节点访问的影响。

:::tip
在配置Digest认证时，请确保密码的安全性，避免使用弱密码或明文存储密码。
:::