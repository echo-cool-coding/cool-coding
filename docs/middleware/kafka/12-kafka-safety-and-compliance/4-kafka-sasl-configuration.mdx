---
title: Kafka SASL 配置
description: 了解如何在 Apache Kafka 中配置 SASL（Simple Authentication and Security Layer）以实现安全的身份验证和通信。
---

## 介绍

在 Apache Kafka 中，SASL（Simple Authentication and Security Layer）是一种用于身份验证的框架，它允许客户端和服务器之间进行安全的通信。SASL 支持多种身份验证机制，例如 PLAIN、SCRAM-SHA-256 和 GSSAPI（Kerberos）。通过配置 SASL，您可以确保只有经过身份验证的客户端才能访问 Kafka 集群，从而提高系统的安全性。

本文将逐步介绍如何在 Kafka 中配置 SASL，并通过实际案例展示其应用场景。

## SASL 配置步骤

### 1. 选择 SASL 机制

Kafka 支持多种 SASL 机制，您需要根据您的安全需求选择合适的机制。常见的机制包括：

- **PLAIN**：简单的用户名和密码验证。
- **SCRAM-SHA-256** 和 **SCRAM-SHA-512**：基于 Salted Challenge Response Authentication Mechanism (SCRAM) 的机制，提供更强的安全性。
- **GSSAPI**：用于 Kerberos 身份验证。

在本教程中，我们将以 **SCRAM-SHA-256** 为例进行配置。

### 2. 配置 Kafka Broker

首先，您需要在 Kafka Broker 的配置文件 `server.properties` 中启用 SASL。以下是配置示例：

```properties
# 启用 SASL 机制
sasl.enabled.mechanisms=SCRAM-SHA-256

# 配置监听器
listeners=SASL_PLAINTEXT://:9092

# 配置安全协议
security.inter.broker.protocol=SASL_PLAINTEXT

# 配置 SASL 机制
sasl.mechanism.inter.broker.protocol=SCRAM-SHA-256
```

### 3. 创建 SASL 用户

接下来，您需要为 Kafka 创建 SASL 用户。Kafka 提供了一个工具 `kafka-configs.sh` 来管理用户。以下是创建用户的命令：

```bash
bin/kafka-configs.sh --zookeeper localhost:2181 --alter --add-config 'SCRAM-SHA-256=[password=my-secret-password]' --entity-type users --entity-name my-user
```

### 4. 配置 Kafka 客户端

在客户端，您需要配置 SASL 以连接到 Kafka Broker。以下是 Java 客户端的配置示例：

```java
Properties props = new Properties();
props.put("bootstrap.servers", "localhost:9092");
props.put("security.protocol", "SASL_PLAINTEXT");
props.put("sasl.mechanism", "SCRAM-SHA-256");
props.put("sasl.jaas.config", "org.apache.kafka.common.security.scram.ScramLoginModule required username=\"my-user\" password=\"my-secret-password\";");

KafkaProducer<String, String> producer = new KafkaProducer<>(props);
```

### 5. 启动 Kafka Broker 和客户端

完成配置后，启动 Kafka Broker 和客户端。如果配置正确，客户端将能够成功连接到 Kafka Broker 并进行身份验证。

## 实际案例

假设您正在为一个金融应用程序构建 Kafka 集群，该集群需要处理敏感的交易数据。为了确保数据的安全性，您决定使用 SASL 进行身份验证。通过配置 SASL，您可以确保只有经过身份验证的客户端才能访问 Kafka 集群，从而防止未经授权的访问。

## 总结

通过本文，您已经了解了如何在 Kafka 中配置 SASL 以实现安全的身份验证。我们以 SCRAM-SHA-256 为例，详细介绍了配置步骤，并通过实际案例展示了其应用场景。

## 附加资源

- [Kafka 官方文档 - SASL 配置](https://kafka.apache.org/documentation/#security_sasl)
- [Kafka 安全指南](https://kafka.apache.org/documentation/#security)
- [Kafka 客户端配置示例](https://kafka.apache.org/documentation/#producerconfigs)

## 练习

1. 尝试在您的本地 Kafka 集群中配置 SASL，并使用不同的 SASL 机制（如 PLAIN 和 SCRAM-SHA-512）进行测试。
2. 编写一个 Kafka 客户端程序，使用 SASL 进行身份验证，并发送和接收消息。
