---
title: Sentinel CPU 使用率保护
description: 了解 Sentinel 如何通过 CPU 使用率保护机制防止系统过载，确保服务的稳定性。
---

# Sentinel CPU 使用率保护

在现代分布式系统中，资源的使用率（如 CPU、内存等）是衡量系统健康状态的重要指标之一。当系统负载过高时，可能会导致服务响应变慢甚至崩溃。Sentinel 提供了一种基于 CPU 使用率的自适应保护机制，能够在系统资源紧张时自动限制流量，从而保护系统的稳定性。

## 什么是 CPU 使用率保护？

CPU 使用率保护是 Sentinel 的一种自适应流量控制机制。它通过监控系统的 CPU 使用率，动态调整流量限制，确保系统在高负载情况下仍能正常运行。当 CPU 使用率超过设定的阈值时，Sentinel 会自动触发保护机制，限制部分请求的通过，从而降低系统负载。

### 为什么需要 CPU 使用率保护？

在高并发场景下，系统的 CPU 使用率可能会迅速飙升。如果没有有效的保护机制，系统可能会因为资源耗尽而崩溃。CPU 使用率保护能够：

- **防止系统过载**：通过限制流量，避免 CPU 使用率过高。
- **提高系统稳定性**：在资源紧张时，优先保障核心服务的正常运行。
- **动态调整**：根据实时 CPU 使用率，动态调整流量限制。

## 如何配置 CPU 使用率保护？

在 Sentinel 中，CPU 使用率保护的配置非常简单。以下是一个基本的配置示例：

```java
// 设置 CPU 使用率保护的阈值
FlowRule rule = new FlowRule();
rule.setResource("myResource");
rule.setGrade(RuleConstant.FLOW_GRADE_QPS);
rule.setCount(10); // 设置 QPS 限制
rule.setControlBehavior(RuleConstant.CONTROL_BEHAVIOR_DEFAULT);
rule.setLimitApp("default");
rule.setCpuUsageThreshold(0.8); // 设置 CPU 使用率阈值为 80%

// 将规则添加到 Sentinel 中
FlowRuleManager.loadRules(Collections.singletonList(rule));
```

### 代码解释

- `setResource("myResource")`：设置需要保护的资源名称。
- `setGrade(RuleConstant.FLOW_GRADE_QPS)`：设置流量控制的类型为 QPS（每秒查询数）。
- `setCount(10)`：设置 QPS 限制为 10。
- `setCpuUsageThreshold(0.8)`：设置 CPU 使用率阈值为 80%。当 CPU 使用率超过 80% 时，Sentinel 会自动触发保护机制。

## 实际应用场景

假设你正在运行一个电商网站，在促销活动期间，流量可能会激增。如果没有 CPU 使用率保护机制，系统可能会因为 CPU 使用率过高而崩溃。通过配置 Sentinel 的 CPU 使用率保护，你可以在 CPU 使用率达到 80% 时自动限制流量，确保系统在高负载情况下仍能正常运行。

### 示例场景

1. **正常流量**：CPU 使用率低于 80%，所有请求正常处理。
2. **高流量**：CPU 使用率超过 80%，Sentinel 自动触发保护机制，限制部分请求的通过。
3. **流量回落**：CPU 使用率下降到 80% 以下，Sentinel 自动解除流量限制。

## 总结

Sentinel 的 CPU 使用率保护机制是一种有效的系统保护手段，能够在高负载情况下自动限制流量，确保系统的稳定性。通过合理配置 CPU 使用率阈值，你可以有效防止系统过载，提高服务的可靠性。

### 附加资源

- [Sentinel 官方文档](https://sentinelguard.io/)
- [Sentinel GitHub 仓库](https://github.com/alibaba/Sentinel)

### 练习

1. 在你的本地环境中配置 Sentinel 的 CPU 使用率保护，并模拟高流量场景，观察 Sentinel 的行为。
2. 尝试调整 CPU 使用率阈值，观察不同阈值下系统的表现。

:::tip
在实际生产环境中，建议结合其他 Sentinel 功能（如熔断、降级等）一起使用，以构建更加健壮的系统保护机制。
:::