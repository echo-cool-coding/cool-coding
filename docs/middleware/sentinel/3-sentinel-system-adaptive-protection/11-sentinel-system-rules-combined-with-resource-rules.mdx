---
title: Sentinel 系统规则与资源规则结合
description: 了解如何在Sentinel系统中将系统规则与资源规则结合使用，以实现更高效的自适应保护机制。
---

# Sentinel 系统规则与资源规则结合

Sentinel是阿里巴巴开源的一款轻量级流量控制组件，广泛应用于微服务架构中，用于保护系统的稳定性和高可用性。在Sentinel中，系统规则和资源规则是两个核心概念，它们可以结合使用，以实现更精细化的流量控制和自适应保护。

## 什么是系统规则与资源规则？

### 系统规则
系统规则是针对整个系统的全局规则，用于保护系统的整体稳定性。它主要关注系统的整体负载、CPU使用率、平均响应时间等指标。当系统资源达到预设的阈值时，Sentinel会根据系统规则进行限流或降级，以防止系统崩溃。

### 资源规则
资源规则是针对具体资源的规则，用于保护某个特定的资源（如API接口、服务方法等）。资源规则可以设置QPS（每秒查询数）、线程数、响应时间等阈值，当资源的使用超过这些阈值时，Sentinel会触发相应的保护措施。

## 系统规则与资源规则的结合

在实际应用中，系统规则和资源规则可以结合使用，以实现更全面的保护机制。例如，当系统整体负载较高时，可以通过系统规则限制全局流量；同时，针对某些关键资源，可以通过资源规则进行更精细化的控制。

### 结合使用的优势
1. **全局与局部结合**：系统规则保护整体系统，资源规则保护具体资源，两者结合可以实现全局与局部的双重保护。
2. **自适应保护**：系统规则可以根据系统负载动态调整，资源规则可以根据资源的使用情况动态调整，两者结合可以实现更灵活的自适应保护。
3. **优先级控制**：系统规则和资源规则可以设置不同的优先级，确保在系统资源紧张时，优先保护关键资源。

## 代码示例

以下是一个简单的代码示例，展示如何在Sentinel中结合使用系统规则和资源规则。

```java
// 定义系统规则
SystemRule systemRule = new SystemRule();
systemRule.setHighestSystemLoad(4.0); // 设置系统最高负载为4.0
systemRule.setAvgRt(100); // 设置平均响应时间为100ms
SystemRuleManager.loadRules(Collections.singletonList(systemRule));

// 定义资源规则
FlowRule flowRule = new FlowRule();
flowRule.setResource("myResource"); // 设置资源名称
flowRule.setGrade(RuleConstant.FLOW_GRADE_QPS); // 设置限流类型为QPS
flowRule.setCount(10); // 设置QPS阈值为10
FlowRuleManager.loadRules(Collections.singletonList(flowRule));
```

### 输入与输出
- **输入**：系统负载为5.0，资源`myResource`的QPS为15。
- **输出**：系统规则触发，全局流量被限制；同时，资源规则触发，`myResource`的QPS被限制为10。

## 实际应用场景

### 场景描述
假设我们有一个电商系统，其中有一个关键的下单接口`/order`。在高并发场景下，系统整体负载可能会急剧上升，同时下单接口的QPS也会大幅增加。为了确保系统的稳定性，我们可以结合使用系统规则和资源规则。

### 解决方案
1. **系统规则**：设置系统最高负载为4.0，当系统负载超过4.0时，触发全局限流。
2. **资源规则**：设置下单接口`/order`的QPS阈值为100，当QPS超过100时，触发限流。

通过这种方式，我们可以在系统负载过高时，优先保护下单接口，确保核心业务不受影响。

## 总结

Sentinel的系统规则和资源规则结合使用，可以实现更全面、更灵活的自适应保护机制。系统规则保护整体系统，资源规则保护具体资源，两者结合可以在高并发场景下有效防止系统崩溃，确保核心业务的稳定性。

## 附加资源与练习

- **附加资源**：
  - [Sentinel官方文档](https://sentinelguard.io/zh-cn/docs/introduction.html)
  - [Sentinel GitHub仓库](https://github.com/alibaba/Sentinel)

- **练习**：
  - 尝试在你的项目中配置系统规则和资源规则，观察在高并发场景下的系统表现。
  - 修改系统规则和资源规则的阈值，测试不同配置下的系统稳定性。

:::tip
在实际应用中，建议根据系统的具体需求和业务场景，灵活调整系统规则和资源规则的配置，以达到最佳的保护效果。
:::