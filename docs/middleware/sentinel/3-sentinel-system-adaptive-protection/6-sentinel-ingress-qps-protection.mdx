---
title: Sentinel 入口QPS保护
description: 了解Sentinel系统中的入口QPS保护机制，掌握如何通过QPS限制保护系统免受流量过载的影响。
---

# Sentinel 入口QPS保护

Sentinel是阿里巴巴开源的一款轻量级流量控制组件，广泛应用于微服务架构中，用于保护系统免受突发流量的冲击。其中，**入口QPS保护**是Sentinel的核心功能之一，它通过限制每秒请求数（QPS）来防止系统过载。本文将详细介绍Sentinel入口QPS保护的原理、实现方式以及实际应用场景。

## 什么是入口QPS保护？

**QPS（Queries Per Second）** 是指系统每秒处理的请求数量。当系统的QPS超过其处理能力时，可能会导致系统响应变慢、资源耗尽甚至崩溃。**入口QPS保护** 是Sentinel提供的一种流量控制机制，它通过限制进入系统的请求数量，确保系统在可承受的范围内运行。

:::note
QPS保护通常用于保护系统的入口点，例如API网关、服务接口等，以防止突发流量对系统造成冲击。
:::

## 如何实现入口QPS保护？

Sentinel通过定义**流量规则**来实现QPS保护。流量规则可以指定某个资源的QPS阈值，当请求超过该阈值时，Sentinel会触发限流策略，例如直接拒绝请求或排队等待。

### 1. 定义流量规则

在Sentinel中，可以通过代码或配置文件定义流量规则。以下是一个通过Java代码定义QPS规则的示例：

```java
FlowRule rule = new FlowRule();
rule.setResource("myResource"); // 资源名称
rule.setGrade(RuleConstant.FLOW_GRADE_QPS); // 限流类型为QPS
rule.setCount(10); // QPS阈值为10
FlowRuleManager.loadRules(Collections.singletonList(rule));
```

在这个示例中，`myResource` 是受保护的资源名称，`setCount(10)` 表示该资源的QPS阈值为10。当请求超过10 QPS时，Sentinel会触发限流。

### 2. 处理限流

当请求超过QPS阈值时，Sentinel会触发限流策略。默认情况下，Sentinel会直接拒绝请求，并返回一个`BlockException`异常。开发者可以通过捕获该异常来处理限流情况：

```java
try {
    // 业务逻辑
} catch (BlockException e) {
    // 处理限流逻辑
    System.out.println("请求被限流，请稍后重试");
}
```

### 3. 动态调整规则

Sentinel支持动态调整流量规则，这意味着可以在运行时修改QPS阈值，而无需重启应用。例如，可以通过Sentinel Dashboard动态调整规则：

```java
FlowRule updatedRule = new FlowRule();
updatedRule.setResource("myResource");
updatedRule.setGrade(RuleConstant.FLOW_GRADE_QPS);
updatedRule.setCount(20); // 将QPS阈值调整为20
FlowRuleManager.loadRules(Collections.singletonList(updatedRule));
```

## 实际应用场景

### 场景1：API网关限流

假设你有一个API网关，负责处理所有外部请求。为了防止突发流量导致后端服务崩溃，你可以在API网关上配置Sentinel的QPS保护。例如，设置每个API的QPS阈值为100，当请求超过100 QPS时，Sentinel会自动拒绝多余的请求，确保后端服务的稳定性。

### 场景2：秒杀活动

在电商平台的秒杀活动中，流量往往会瞬间激增。为了防止系统崩溃，可以在秒杀接口上配置QPS保护。例如，设置秒杀接口的QPS阈值为1000，当请求超过1000 QPS时，Sentinel会拒绝多余的请求，确保系统能够平稳处理高并发流量。

## 总结

Sentinel的入口QPS保护是一种简单而有效的流量控制机制，能够帮助系统在面对突发流量时保持稳定。通过定义流量规则，开发者可以灵活地控制系统的QPS阈值，防止系统过载。在实际应用中，QPS保护广泛应用于API网关、秒杀活动等场景，是保障系统高可用性的重要手段。

:::tip
如果你对Sentinel的更多功能感兴趣，可以访问[Sentinel官方文档](https://sentinelguard.io/)获取更多信息。
:::

## 附加资源与练习

1. **练习**：尝试在你的项目中集成Sentinel，并为一个接口配置QPS保护。观察当请求超过QPS阈值时，Sentinel的行为。
2. **资源**：阅读Sentinel的[流量控制文档](https://sentinelguard.io/zh-cn/docs/flow-control.html)，了解更多高级功能，如熔断降级、热点参数限流等。
3. **思考**：在什么情况下，QPS保护可能无法完全解决系统的流量问题？你还能想到哪些其他保护机制？