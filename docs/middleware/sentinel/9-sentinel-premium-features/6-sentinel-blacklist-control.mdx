---
title: Sentinel 黑名单控制
description: 了解如何使用Sentinel的黑名单控制功能来限制特定用户或IP的访问，保护系统免受恶意请求的侵害。
---

# Sentinel 黑名单控制

Sentinel是阿里巴巴开源的一款流量控制组件，广泛应用于微服务架构中，用于保护系统免受流量洪峰的冲击。其中，**黑名单控制**是Sentinel的一项重要功能，它允许开发者将某些用户或IP地址列入黑名单，从而限制或阻止它们的访问。本文将详细介绍Sentinel的黑名单控制功能，并通过实际案例展示其应用场景。

## 什么是黑名单控制？

黑名单控制是一种访问控制机制，用于限制或阻止特定用户、IP地址或其他标识符的访问。在Sentinel中，黑名单控制可以基于以下条件进行配置：

- **用户ID**：限制特定用户的访问。
- **IP地址**：限制特定IP地址的访问。
- **自定义规则**：根据业务需求自定义黑名单规则。

通过黑名单控制，开发者可以有效防止恶意用户或异常流量对系统造成损害。

## 如何配置黑名单控制？

在Sentinel中，黑名单控制可以通过配置文件或代码进行设置。以下是一个简单的代码示例，展示如何在Java中配置黑名单控制。

### 代码示例

```java
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.csp.sentinel.slots.block.authority.AuthorityRule;
import com.alibaba.csp.sentinel.slots.block.authority.AuthorityRuleManager;
import com.alibaba.csp.sentinel.slots.block.authority.AuthorityException;

public class SentinelBlacklistDemo {

    public static void main(String[] args) {
        // 配置黑名单规则
        AuthorityRule rule = new AuthorityRule();
        rule.setResource("testResource");
        rule.setLimitApp("192.168.1.1"); // 限制IP地址为192.168.1.1的访问
        rule.setStrategy(AuthorityRule.Strategy.BLACK); // 设置为黑名单模式

        AuthorityRuleManager.loadRules(Collections.singletonList(rule));

        // 模拟请求
        try {
            // 检查是否在黑名单中
            if (AuthorityRuleManager.checkAuthority("testResource", "192.168.1.1")) {
                System.out.println("Access denied: IP is in blacklist.");
            } else {
                System.out.println("Access granted.");
            }
        } catch (BlockException e) {
            System.out.println("Blocked by Sentinel: " + e.getMessage());
        }
    }
}
```

### 输入与输出

- **输入**：IP地址 `192.168.1.1` 尝试访问资源 `testResource`。
- **输出**：如果IP地址在黑名单中，输出 `Access denied: IP is in blacklist.`；否则输出 `Access granted.`。

## 实际应用场景

### 场景1：防止恶意爬虫

假设你的网站经常受到某个IP地址的恶意爬虫攻击，导致服务器负载过高。你可以通过Sentinel的黑名单控制功能，将该IP地址列入黑名单，从而阻止其访问。

```java
AuthorityRule rule = new AuthorityRule();
rule.setResource("webPageResource");
rule.setLimitApp("123.45.67.89"); // 恶意爬虫的IP地址
rule.setStrategy(AuthorityRule.Strategy.BLACK);

AuthorityRuleManager.loadRules(Collections.singletonList(rule));
```

### 场景2：限制特定用户的访问

在某些情况下，你可能需要限制某些用户的访问权限。例如，某个用户多次尝试登录失败，你可以将其用户ID列入黑名单，暂时禁止其访问。

```java
AuthorityRule rule = new AuthorityRule();
rule.setResource("loginResource");
rule.setLimitApp("user123"); // 用户ID
rule.setStrategy(AuthorityRule.Strategy.BLACK);

AuthorityRuleManager.loadRules(Collections.singletonList(rule));
```

## 总结

Sentinel的黑名单控制功能为开发者提供了一种简单而有效的方式来限制或阻止特定用户或IP地址的访问。通过合理配置黑名单规则，可以有效保护系统免受恶意请求的侵害。

:::tip
在实际应用中，建议结合日志监控和自动化工具，动态更新黑名单规则，以应对不断变化的威胁。
:::

## 附加资源与练习

- **练习1**：尝试在本地环境中配置Sentinel的黑名单控制，并模拟不同IP地址的访问，观察输出结果。
- **练习2**：扩展黑名单规则，支持多个IP地址或用户ID的批量配置。

:::note
更多关于Sentinel的详细文档，请参考[Sentinel官方文档](https://sentinelguard.io/)。
:::