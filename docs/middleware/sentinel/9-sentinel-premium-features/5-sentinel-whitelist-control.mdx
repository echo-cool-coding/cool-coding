---
title: Sentinel 白名单控制
description: 了解Sentinel白名单控制的概念、实现方式及其在实际应用中的使用场景。
---

# Sentinel 白名单控制

Sentinel是阿里巴巴开源的一款流量控制组件，广泛应用于微服务架构中，用于保护系统的稳定性。**白名单控制**是Sentinel提供的一种高级功能，允许开发者定义一组“受信任”的请求来源或用户，这些请求可以绕过Sentinel的流量控制规则，直接访问资源。本文将详细介绍Sentinel白名单控制的概念、实现方式以及实际应用场景。

---

## 什么是白名单控制？

白名单控制是一种访问控制机制，允许特定的请求来源或用户绕过系统的流量限制。在Sentinel中，白名单通常用于以下场景：

1. **内部系统调用**：某些内部系统或服务需要频繁调用某个接口，为了避免流量控制对这些调用造成影响，可以将这些调用来源加入白名单。
2. **测试环境**：在测试环境中，某些测试工具或脚本需要频繁访问接口，白名单可以确保这些请求不受限。
3. **特权用户**：某些特权用户（如管理员）需要无限制地访问某些资源，白名单可以满足这一需求。

---

## 如何实现白名单控制？

Sentinel提供了`AuthorityRule`来实现白名单控制。`AuthorityRule`允许开发者根据请求的来源（如IP地址、用户ID等）定义白名单规则。以下是一个简单的实现示例：

### 1. 定义白名单规则

```java
// 创建AuthorityRule对象
AuthorityRule rule = new AuthorityRule();
rule.setResource("myResource"); // 资源名称
rule.setStrategy(RuleConstant.AUTHORITY_WHITE); // 白名单策略
rule.setLimitApp("192.168.1.1,192.168.1.2"); // 允许的IP地址
```

### 2. 加载规则

```java
// 将规则加载到Sentinel中
AuthorityRuleManager.loadRules(Collections.singletonList(rule));
```

### 3. 在代码中应用规则

```java
// 在资源访问处添加Sentinel的限流逻辑
try (Entry entry = SphU.entry("myResource")) {
    // 业务逻辑
} catch (BlockException e) {
    // 处理被限流的请求
}
```

### 4. 测试白名单

- 如果请求来源的IP地址是`192.168.1.1`或`192.168.1.2`，则请求会直接通过，不受限流规则影响。
- 如果请求来源的IP地址不在白名单中，则请求会受到Sentinel的限流规则限制。

---

## 实际应用场景

### 场景1：内部系统调用

假设你有一个订单服务，需要频繁调用库存服务来更新库存。为了避免库存服务对订单服务的调用进行限流，可以将订单服务的IP地址加入白名单。

```java
AuthorityRule rule = new AuthorityRule();
rule.setResource("updateInventory");
rule.setStrategy(RuleConstant.AUTHORITY_WHITE);
rule.setLimitApp("10.0.0.1"); // 订单服务的IP地址
AuthorityRuleManager.loadRules(Collections.singletonList(rule));
```

### 场景2：特权用户访问

假设你的系统中有一个管理员用户`admin`，需要无限制地访问某些敏感资源。可以将`admin`用户加入白名单。

```java
AuthorityRule rule = new AuthorityRule();
rule.setResource("sensitiveResource");
rule.setStrategy(RuleConstant.AUTHORITY_WHITE);
rule.setLimitApp("admin"); // 管理员用户ID
AuthorityRuleManager.loadRules(Collections.singletonList(rule));
```

---

## 总结

Sentinel的白名单控制功能为开发者提供了一种灵活的方式来管理系统的流量控制规则。通过白名单，可以确保某些特定的请求来源或用户不受限流规则的影响，从而提高系统的灵活性和可用性。

:::tip
在实际使用中，建议将白名单规则与动态配置中心（如Nacos、Apollo）结合使用，以便在不重启服务的情况下动态调整白名单。
:::

---

## 附加资源与练习

1. **练习**：尝试在你的本地环境中配置一个简单的Sentinel白名单规则，并测试其效果。
2. **扩展阅读**：
   - [Sentinel官方文档](https://sentinelguard.io/)
   - [Sentinel与Spring Cloud集成指南](https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel)

通过本文的学习，你应该已经掌握了Sentinel白名单控制的基本概念和实现方法。希望你能在实际项目中灵活运用这一功能，提升系统的稳定性和灵活性！