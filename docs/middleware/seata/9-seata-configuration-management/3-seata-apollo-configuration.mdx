---
title: Seata Apollo 配置
description: 了解如何在 Seata 中使用 Apollo 作为配置中心，实现分布式事务的配置管理。
---

## 介绍

Seata 是一款开源的分布式事务解决方案，旨在简化微服务架构下的分布式事务管理。为了更灵活地管理 Seata 的配置，Seata 支持多种配置中心，其中 Apollo 是一个流行的配置中心解决方案。本文将详细介绍如何在 Seata 中集成 Apollo 配置中心，并逐步讲解相关配置和使用方法。

## 什么是 Apollo？

Apollo 是携程开源的一款分布式配置中心，支持配置的集中管理、实时更新、版本控制等功能。通过 Apollo，开发者可以方便地管理和动态调整应用程序的配置，而无需重启服务。

## Seata 与 Apollo 的集成

Seata 支持将 Apollo 作为配置中心，用于存储和管理 Seata 的配置项。通过这种方式，Seata 的配置可以集中管理，并且可以在运行时动态调整。

### 1. 配置 Apollo

首先，确保你已经安装并运行了 Apollo 配置中心。如果还没有安装，可以参考 [Apollo 官方文档](https://www.apolloconfig.com/) 进行安装和配置。

### 2. 在 Seata 中配置 Apollo

在 Seata 中集成 Apollo 非常简单，只需要在 Seata 的配置文件中指定 Apollo 的相关配置即可。

#### 2.1 修改 `registry.conf` 文件

在 Seata 的 `registry.conf` 文件中，找到 `config` 部分，将其配置为使用 Apollo：

```plaintext
config {
  type = "apollo"
  apollo {
    appId = "seata-server"
    apolloMeta = "http://localhost:8080"
    namespace = "application"
    cluster = "default"
  }
}
```

- `appId`: Apollo 中的应用 ID，通常为 `seata-server`。
- `apolloMeta`: Apollo 配置中心的地址。
- `namespace`: Apollo 中的命名空间，通常为 `application`。
- `cluster`: Apollo 中的集群名称，通常为 `default`。

#### 2.2 配置 Seata 的其他参数

在 Apollo 配置中心中，你可以添加 Seata 的相关配置项。例如：

```plaintext
service.vgroupMapping.my_test_tx_group=default
store.mode=db
store.db.url=jdbc:mysql://127.0.0.1:3306/seata?useSSL=false
store.db.user=root
store.db.password=root
```

这些配置项将覆盖 Seata 的默认配置，并动态生效。

### 3. 启动 Seata 服务

完成上述配置后，启动 Seata 服务。Seata 将自动从 Apollo 配置中心读取配置，并根据配置启动相应的服务。

## 实际案例

假设我们有一个微服务架构的电商系统，其中包含订单服务、库存服务和支付服务。为了确保订单创建、库存扣减和支付操作的一致性，我们使用 Seata 来管理分布式事务。

### 场景描述

1. 用户下单时，订单服务创建订单。
2. 库存服务扣减库存。
3. 支付服务处理支付。

如果任何一个步骤失败，整个事务需要回滚。

### 配置步骤

1. 在 Apollo 配置中心中配置 Seata 的事务组映射：

   ```plaintext
   service.vgroupMapping.order_tx_group=default
   service.vgroupMapping.stock_tx_group=default
   service.vgroupMapping.payment_tx_group=default
   ```

2. 配置 Seata 的存储模式为数据库：

   ```plaintext
   store.mode=db
   store.db.url=jdbc:mysql://127.0.0.1:3306/seata?useSSL=false
   store.db.user=root
   store.db.password=root
   ```

3. 启动 Seata 服务，并确保各个微服务连接到 Seata 的事务协调器。

### 运行效果

当用户下单时，Seata 将协调订单服务、库存服务和支付服务的事务。如果任何一个服务失败，Seata 将自动回滚整个事务，确保数据的一致性。

## 总结

通过本文，我们了解了如何在 Seata 中集成 Apollo 配置中心，并实际应用在一个电商系统的分布式事务管理中。Apollo 作为配置中心，为 Seata 提供了灵活的配置管理能力，使得分布式事务的配置更加动态和可维护。

## 附加资源

- [Seata 官方文档](https://seata.io/zh-cn/)
- [Apollo 官方文档](https://www.apolloconfig.com/)

## 练习

1. 尝试在本地搭建 Apollo 配置中心，并将其与 Seata 集成。
2. 修改 Apollo 中的配置项，观察 Seata 的行为变化。
3. 设计一个简单的微服务场景，使用 Seata 和 Apollo 实现分布式事务管理。
