---
title: Seata Nacos配置
description: 了解如何在Seata中使用Nacos作为配置中心，管理分布式事务的配置。
---

# Seata Nacos配置

## 介绍

Seata 是一个开源的分布式事务解决方案，旨在解决微服务架构中的分布式事务问题。Nacos 是一个动态服务发现、配置和服务管理平台。通过将 Seata 与 Nacos 结合，我们可以将 Seata 的配置集中管理，从而实现更灵活和高效的配置管理。

在本教程中，我们将逐步介绍如何在 Seata 中使用 Nacos 作为配置中心，并通过实际案例展示其应用场景。

## 前置条件

在开始之前，请确保你已经具备以下条件：

- 已安装并运行 Nacos 服务。
- 已安装并运行 Seata 服务。
- 熟悉基本的 Java 和 Spring Boot 开发。

## 配置 Seata 使用 Nacos

### 1. 配置 Nacos 作为 Seata 的配置中心

首先，我们需要在 Seata 的配置文件中指定 Nacos 作为配置中心。打开 `registry.conf` 文件，找到 `config` 部分，并将其配置为使用 Nacos。

```plaintext
config {
  type = "nacos"
  nacos {
    serverAddr = "127.0.0.1:8848"
    namespace = ""
    group = "SEATA_GROUP"
    username = ""
    password = ""
    dataId = "seataServer.properties"
  }
}
```

:::note
- `serverAddr`：Nacos 服务器的地址。
- `namespace`：Nacos 的命名空间，默认为空。
- `group`：配置分组，默认为 `SEATA_GROUP`。
- `dataId`：配置文件的唯一标识符。
:::

### 2. 在 Nacos 中创建配置

接下来，我们需要在 Nacos 中创建 Seata 的配置文件。登录 Nacos 控制台，进入 `配置管理` -> `配置列表`，点击 `+` 按钮创建新的配置。

- **Data ID**: `seataServer.properties`
- **Group**: `SEATA_GROUP`
- **配置格式**: `Properties`
- **配置内容**:

```properties
store.mode=db
store.db.datasource=druid
store.db.dbType=mysql
store.db.driverClassName=com.mysql.cj.jdbc.Driver
store.db.url=jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true
store.db.user=root
store.db.password=root
```

:::tip
确保数据库连接信息正确，并且数据库已经创建了 Seata 所需的表结构。
:::

### 3. 启动 Seata 服务

配置完成后，启动 Seata 服务。Seata 将自动从 Nacos 中读取配置并应用。

```bash
sh seata-server.sh
```

### 4. 验证配置

启动 Seata 服务后，可以通过查看日志文件来验证配置是否成功加载。如果配置加载成功，日志中会显示类似以下内容：

```plaintext
2023-10-01 12:00:00 INFO  io.seata.config.nacos.NacosConfiguration - Loaded configuration from Nacos: {store.mode=db, store.db.datasource=druid, ...}
```

## 实际案例

假设我们有一个简单的订单服务，使用 Seata 来管理分布式事务。订单服务需要调用库存服务和支付服务来完成一个订单的创建。

### 1. 创建订单服务

在订单服务中，我们使用 `@GlobalTransactional` 注解来标记一个全局事务。

```java
@Service
public class OrderService {

    @Autowired
    private InventoryService inventoryService;

    @Autowired
    private PaymentService paymentService;

    @GlobalTransactional
    public void createOrder(Order order) {
        // 扣减库存
        inventoryService.deduct(order.getProductId(), order.getQuantity());

        // 创建支付
        paymentService.createPayment(order.getOrderId(), order.getAmount());

        // 创建订单
        saveOrder(order);
    }

    private void saveOrder(Order order) {
        // 保存订单到数据库
    }
}
```

### 2. 配置 Seata 客户端

在订单服务的 `application.yml` 中，配置 Seata 客户端使用 Nacos 作为配置中心。

```yaml
seata:
  enabled: true
  application-id: order-service
  tx-service-group: my_tx_group
  config:
    type: nacos
    nacos:
      server-addr: 127.0.0.1:8848
      namespace: ""
      group: SEATA_GROUP
      username: ""
      password: ""
      data-id: seataServer.properties
```

### 3. 启动服务并测试

启动订单服务、库存服务和支付服务，然后调用订单服务的 `createOrder` 方法。如果所有服务都配置正确，Seata 将确保整个分布式事务的一致性。

## 总结

通过本教程，我们学习了如何在 Seata 中使用 Nacos 作为配置中心。Nacos 提供了集中化的配置管理能力，使得 Seata 的配置更加灵活和易于维护。我们还通过一个实际案例展示了如何在微服务架构中使用 Seata 管理分布式事务。

## 附加资源

- [Seata 官方文档](https://seata.io/zh-cn/docs/overview/what-is-seata.html)
- [Nacos 官方文档](https://nacos.io/zh-cn/docs/what-is-nacos.html)

## 练习

1. 尝试将 Seata 的配置从 Nacos 迁移到其他配置中心（如 Apollo）。
2. 在本地环境中搭建一个简单的微服务项目，并使用 Seata 和 Nacos 管理分布式事务。

:::caution
在实际生产环境中，请确保 Nacos 和 Seata 的高可用性和安全性配置。
:::