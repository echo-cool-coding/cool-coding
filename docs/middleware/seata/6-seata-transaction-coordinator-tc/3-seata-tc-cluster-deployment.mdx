---
title: Seata TC集群部署
description: 了解如何部署Seata事务协调器（TC）集群，确保分布式事务的高可用性和可扩展性。
---

# Seata TC集群部署

Seata（Simple Extensible Autonomous Transaction Architecture）是一个开源的分布式事务解决方案，旨在解决微服务架构中的事务一致性问题。Seata的事务协调器（Transaction Coordinator，简称TC）是Seata架构中的核心组件，负责协调全局事务的提交和回滚。为了确保高可用性和可扩展性，Seata TC通常以集群方式部署。

本文将详细介绍如何部署Seata TC集群，并解释其背后的原理和实际应用场景。

## 什么是Seata TC集群？

Seata TC集群是指将多个Seata TC实例部署在不同的服务器上，并通过某种机制（如注册中心）进行协调。集群部署的主要目的是提高系统的可用性和容错能力。当某个TC实例发生故障时，其他实例可以接管其工作，确保事务的持续处理。

## Seata TC集群部署步骤

### 1. 准备工作

在部署Seata TC集群之前，需要确保以下条件已满足：

- 已安装Java环境（JDK 8或更高版本）。
- 已下载Seata的发行版（可以从[Seata GitHub](https://github.com/seata/seata)下载）。
- 已配置好注册中心（如Nacos、Eureka等）。

### 2. 配置注册中心

Seata TC集群依赖于注册中心来发现和管理各个TC实例。以下以Nacos为例，展示如何配置注册中心。

在`registry.conf`文件中，配置Nacos作为注册中心：

```conf
registry {
  type = "nacos"
  nacos {
    serverAddr = "127.0.0.1:8848"
    namespace = ""
    cluster = "default"
  }
}
```

### 3. 配置数据库

Seata TC需要将事务日志存储在数据库中。因此，需要配置数据库连接信息。在`file.conf`文件中，配置数据库连接：

```conf
store {
  mode = "db"
  db {
    datasource = "druid"
    dbType = "mysql"
    driverClassName = "com.mysql.cj.jdbc.Driver"
    url = "jdbc:mysql://127.0.0.1:3306/seata?useSSL=false"
    user = "root"
    password = "password"
    minConn = 5
    maxConn = 30
    globalTable = "global_table"
    branchTable = "branch_table"
    lockTable = "lock_table"
  }
}
```

### 4. 启动Seata TC实例

在多个服务器上启动Seata TC实例。确保每个实例的`serverAddr`和`cluster`配置一致。启动命令如下：

```bash
sh seata-server.sh -p 8091 -h 127.0.0.1 -m db
```

其中，`-p`指定端口号，`-h`指定主机地址，`-m`指定存储模式（这里使用数据库模式）。

### 5. 验证集群部署

启动多个TC实例后，可以通过Nacos控制台查看已注册的TC实例。如果所有实例都成功注册，说明集群部署成功。

## 实际应用场景

假设你有一个电商系统，包含订单服务、库存服务和支付服务。每个服务都运行在不同的微服务实例上。当用户下单时，系统需要确保订单创建、库存扣减和支付扣款这三个操作要么全部成功，要么全部回滚。

通过部署Seata TC集群，可以确保即使某个TC实例发生故障，其他实例仍能继续处理事务，保证系统的高可用性。

## 总结

Seata TC集群部署是确保分布式事务高可用性和可扩展性的关键步骤。通过配置注册中心和数据库，并启动多个TC实例，可以构建一个健壮的Seata TC集群。在实际应用中，这种部署方式能够有效应对系统故障，确保事务的持续处理。

## 附加资源

- [Seata官方文档](https://seata.io/zh-cn/docs/overview/what-is-seata.html)
- [Nacos官方文档](https://nacos.io/zh-cn/docs/what-is-nacos.html)

## 练习

1. 尝试在不同的服务器上部署Seata TC集群，并使用Nacos作为注册中心。
2. 模拟一个TC实例故障，观察其他实例是否能够接管事务处理。
3. 修改数据库配置，使用不同的数据库（如PostgreSQL）存储事务日志，并验证其可行性。
