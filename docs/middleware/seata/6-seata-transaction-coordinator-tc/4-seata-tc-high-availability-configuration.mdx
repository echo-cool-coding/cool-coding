---
title: Seata TC 高可用配置
description: 了解如何配置 Seata 事务协调器（TC）以实现高可用性，确保分布式事务的稳定性和可靠性。
---

## 介绍

Seata 是一个开源的分布式事务解决方案，旨在简化分布式事务的管理。Seata 的事务协调器（Transaction Coordinator, TC）是 Seata 的核心组件之一，负责协调全局事务的提交和回滚。在生产环境中，TC 的高可用性至关重要，因为它直接影响到分布式事务的稳定性和可靠性。

本文将详细介绍如何配置 Seata TC 以实现高可用性，并通过实际案例展示其应用场景。

## Seata TC 高可用配置

### 1. 高可用性概述

高可用性（High Availability, HA）是指系统能够在长时间内持续运行而不中断的能力。对于 Seata TC 来说，高可用性意味着即使某个 TC 实例发生故障，系统仍然能够继续处理事务请求。

### 2. 配置步骤

#### 2.1 使用数据库存储模式

Seata TC 支持多种存储模式，其中数据库存储模式是实现高可用性的关键。通过将事务日志存储在数据库中，多个 TC 实例可以共享同一份数据，从而实现故障切换。

```yaml
store:
  mode: db
  db:
    datasource: druid
    db-type: mysql
    url: jdbc:mysql://127.0.0.1:3306/seata
    user: root
    password: root
    min-conn: 5
    max-conn: 30
    global-table: global_table
    branch-table: branch_table
    lock-table: lock_table
    query-limit: 100
```

#### 2.2 配置多个 TC 实例

为了实现高可用性，您需要部署多个 TC 实例，并将它们配置为使用相同的数据库存储。这样，即使某个 TC 实例发生故障，其他实例仍然可以继续处理事务请求。

```yaml
server:
  port: 8091
  service-port: 8092
  vgroup-mapping:
    my_test_tx_group: default
  enable-degrade: false
  disable-global-transaction: false
```

#### 2.3 使用负载均衡器

为了将事务请求均匀地分配到多个 TC 实例上，您可以使用负载均衡器（如 Nginx 或 HAProxy）。以下是一个简单的 Nginx 配置示例：

```nginx
upstream seata_tc {
    server 192.168.1.101:8091;
    server 192.168.1.102:8091;
    server 192.168.1.103:8091;
}

server {
    listen 80;
    server_name seata.example.com;

    location / {
        proxy_pass http://seata_tc;
    }
}
```

### 3. 实际案例

假设您有一个电商系统，用户在下单时需要同时更新库存和订单状态。为了确保事务的原子性，您可以使用 Seata 来管理分布式事务。通过配置高可用的 TC，即使某个 TC 实例发生故障，系统仍然可以继续处理订单请求，从而保证业务的连续性。

```java
@GlobalTransactional
public void placeOrder(Order order) {
    // 更新库存
    inventoryService.updateStock(order.getProductId(), order.getQuantity());
    // 创建订单
    orderService.createOrder(order);
}
```

### 4. 总结

通过配置 Seata TC 的高可用性，您可以确保分布式事务的稳定性和可靠性。本文介绍了如何使用数据库存储模式、配置多个 TC 实例以及使用负载均衡器来实现高可用性。希望这些内容能帮助您更好地理解和应用 Seata TC 的高可用配置。

### 5. 附加资源

- [Seata 官方文档](https://seata.io/zh-cn/docs/overview/what-is-seata.html)
- [Nginx 官方文档](https://nginx.org/en/docs/)
- [HAProxy 官方文档](http://www.haproxy.org/)

### 6. 练习

1. 尝试在本地环境中部署多个 Seata TC 实例，并配置它们使用相同的数据库存储。
2. 使用 Nginx 或 HAProxy 配置负载均衡，将请求均匀分配到多个 TC 实例上。
3. 模拟一个 TC 实例的故障，观察系统是否能够继续处理事务请求。

通过完成这些练习，您将更深入地理解 Seata TC 的高可用配置及其在实际应用中的重要性。