---
title: Seata Spring Boot集成
description: 本教程将详细介绍如何在Spring Boot项目中集成Seata分布式事务框架，帮助初学者理解并掌握Seata的基本使用。
---

# Seata Spring Boot集成

## 介绍

Seata 是一款开源的分布式事务解决方案，旨在解决微服务架构下的分布式事务问题。它提供了高性能、易用的事务管理功能，支持多种事务模式，如AT（自动补偿事务）、TCC（Try-Confirm-Cancel）和Saga模式。在微服务架构中，多个服务之间的数据一致性是一个常见的挑战，Seata通过全局事务管理机制，确保跨服务的事务操作能够正确提交或回滚。

本教程将逐步指导你如何在Spring Boot项目中集成Seata，并通过实际案例展示其应用场景。

## 准备工作

在开始之前，确保你已经具备以下条件：

1. 一个Spring Boot项目（可以使用Spring Initializr快速创建）。
2. JDK 1.8或更高版本。
3. Maven或Gradle构建工具。
4. Seata Server（可以通过Docker或本地安装运行）。

## 集成步骤

### 1. 添加依赖

首先，在你的Spring Boot项目的`pom.xml`文件中添加Seata的依赖：

```xml
<dependency>
    <groupId>io.seata</groupId>
    <artifactId>seata-spring-boot-starter</artifactId>
    <version>1.5.0</version>
</dependency>
```

如果你使用的是Gradle，可以在`build.gradle`中添加：

```groovy
implementation 'io.seata:seata-spring-boot-starter:1.5.0'
```

### 2. 配置Seata

接下来，你需要在`application.yml`或`application.properties`中配置Seata的相关参数。以下是一个典型的配置示例：

```yaml
seata:
  enabled: true
  application-id: your-application-id
  tx-service-group: my_tx_group
  service:
    vgroup-mapping:
      my_tx_group: default
    grouplist:
      default: 127.0.0.1:8091
  registry:
    type: file
  config:
    type: file
    file:
      name: file.conf
```

:::note
`tx-service-group`是事务组的名称，`vgroup-mapping`将事务组映射到Seata Server的集群名称，`grouplist`指定Seata Server的地址。
:::

### 3. 创建全局事务

在Spring Boot中，你可以使用`@GlobalTransactional`注解来标记一个全局事务。以下是一个简单的示例：

```java
@Service
public class OrderService {

    @Autowired
    private OrderMapper orderMapper;

    @GlobalTransactional
    public void createOrder(Order order) {
        orderMapper.insert(order);
        // 调用其他服务
    }
}
```

在这个示例中，`createOrder`方法被标记为一个全局事务。如果在方法执行过程中发生异常，Seata会自动回滚所有相关操作。

### 4. 启动Seata Server

在本地开发环境中，你可以通过Docker快速启动Seata Server：

```bash
docker run --name seata-server -p 8091:8091 -d seataio/seata-server:1.5.0
```

确保Seata Server的地址与配置文件中的`grouplist`一致。

### 5. 测试全局事务

现在，你可以编写一个简单的测试用例来验证全局事务是否正常工作：

```java
@SpringBootTest
public class OrderServiceTest {

    @Autowired
    private OrderService orderService;

    @Test
    public void testCreateOrder() {
        Order order = new Order();
        order.setUserId(1L);
        order.setAmount(100.0);
        orderService.createOrder(order);
    }
}
```

如果`createOrder`方法执行成功，订单数据将被插入数据库；如果发生异常，所有操作将被回滚。

## 实际应用场景

假设你正在开发一个电商系统，用户下单时需要同时更新库存和创建订单。这两个操作分别由不同的微服务处理，使用Seata可以确保这两个操作要么全部成功，要么全部回滚。

```java
@Service
public class OrderServiceImpl implements OrderService {

    @Autowired
    private OrderMapper orderMapper;

    @Autowired
    private InventoryService inventoryService;

    @GlobalTransactional
    public void createOrder(Order order) {
        orderMapper.insert(order);
        inventoryService.deductStock(order.getProductId(), order.getQuantity());
    }
}
```

在这个场景中，如果库存不足导致`deductStock`方法抛出异常，订单创建操作也会被回滚，确保数据一致性。

## 总结

通过本教程，你已经学会了如何在Spring Boot项目中集成Seata分布式事务框架。Seata通过全局事务管理机制，帮助你在微服务架构中实现跨服务的事务一致性。你可以通过`@GlobalTransactional`注解轻松标记全局事务，并通过配置Seata Server来管理事务的提交和回滚。

## 附加资源

- [Seata官方文档](https://seata.io/zh-cn/docs/overview/what-is-seata.html)
- [Spring Boot官方文档](https://spring.io/projects/spring-boot)

## 练习

1. 尝试在一个Spring Boot项目中集成Seata，并编写一个简单的全局事务示例。
2. 修改`createOrder`方法，使其在库存不足时抛出异常，并验证事务回滚是否生效。
3. 探索Seata的其他事务模式（如TCC和Saga），并尝试在项目中使用它们。

希望本教程对你有所帮助，祝你在学习Seata的过程中取得成功！