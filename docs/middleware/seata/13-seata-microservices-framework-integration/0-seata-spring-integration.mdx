---
title: Seata Spring集成
description: 了解如何在Spring项目中集成Seata微服务框架，实现分布式事务管理。
---

# Seata Spring集成

## 介绍

Seata 是一款开源的分布式事务解决方案，旨在解决微服务架构下的分布式事务问题。它提供了简单易用的 API，帮助开发者在分布式系统中实现事务的一致性。Spring 是 Java 生态中最流行的框架之一，Seata 提供了与 Spring 的无缝集成，使得在 Spring 项目中使用 Seata 变得非常简单。

本文将逐步讲解如何在 Spring 项目中集成 Seata，并通过实际案例展示其应用场景。

## 环境准备

在开始之前，请确保你已经具备以下环境：

- JDK 1.8 或更高版本
- Maven 3.x 或更高版本
- Spring Boot 2.x
- Seata 1.4.x 或更高版本

## 添加依赖

首先，在你的 `pom.xml` 文件中添加 Seata 和 Spring 相关的依赖：

```xml
<dependencies>
    <!-- Spring Boot Starter -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter</artifactId>
    </dependency>

    <!-- Seata Spring Boot Starter -->
    <dependency>
        <groupId>io.seata</groupId>
        <artifactId>seata-spring-boot-starter</artifactId>
        <version>1.4.2</version>
    </dependency>

    <!-- 其他依赖 -->
</dependencies>
```

## 配置 Seata

接下来，你需要在 `application.yml` 或 `application.properties` 文件中配置 Seata 的相关参数。以下是一个示例配置：

```yaml
seata:
  enabled: true
  application-id: your-application-id
  tx-service-group: my_tx_group
  service:
    vgroup-mapping:
      my_tx_group: default
    grouplist:
      default: 127.0.0.1:8091
  config:
    type: file
    file:
      name: file.conf
  registry:
    type: file
    file:
      name: file.conf
```

:::note
`tx-service-group` 是事务组的名称，`vgroup-mapping` 和 `grouplist` 用于指定 Seata 服务器的地址。
:::

## 创建分布式事务

在 Spring 项目中，你可以使用 `@GlobalTransactional` 注解来标记一个分布式事务。以下是一个简单的示例：

```java
@Service
public class OrderService {

    @Autowired
    private AccountService accountService;

    @Autowired
    private StorageService storageService;

    @GlobalTransactional
    public void createOrder(Order order) {
        // 扣减库存
        storageService.deduct(order.getProductId(), order.getCount());

        // 扣减账户余额
        accountService.debit(order.getUserId(), order.getMoney());

        // 创建订单
        // orderMapper.create(order);
    }
}
```

在这个示例中，`createOrder` 方法被标记为一个分布式事务。如果任何一个步骤失败，Seata 会自动回滚整个事务。

## 实际案例

假设我们有一个电商系统，包含订单服务、库存服务和账户服务。当用户下单时，系统需要同时扣减库存和账户余额。如果其中任何一个操作失败，整个事务需要回滚。

```java
@Service
public class OrderServiceImpl implements OrderService {

    @Autowired
    private AccountService accountService;

    @Autowired
    private StorageService storageService;

    @GlobalTransactional
    public void createOrder(Order order) {
        // 扣减库存
        storageService.deduct(order.getProductId(), order.getCount());

        // 扣减账户余额
        accountService.debit(order.getUserId(), order.getMoney());

        // 创建订单
        // orderMapper.create(order);
    }
}
```

在这个案例中，`createOrder` 方法被标记为一个分布式事务。如果库存扣减或账户扣减失败，Seata 会自动回滚整个事务，确保数据的一致性。

## 总结

通过本文，你已经学会了如何在 Spring 项目中集成 Seata，并使用 `@GlobalTransactional` 注解来管理分布式事务。Seata 提供了简单易用的 API，帮助开发者在微服务架构下实现事务的一致性。

## 附加资源

- [Seata 官方文档](https://seata.io/zh-cn/docs/overview/what-is-seata.html)
- [Spring Boot 官方文档](https://spring.io/projects/spring-boot)

## 练习

1. 尝试在你的 Spring Boot 项目中集成 Seata，并实现一个简单的分布式事务。
2. 修改 `createOrder` 方法，使其在库存不足时抛出异常，并观察事务的回滚行为。
