---
title: Seata 客户端接入
description: 本文详细介绍了如何在分布式事务管理框架Seata中接入客户端，包括配置、代码示例和实际应用场景。
---

# Seata 客户端接入

## 介绍

Seata（Simple Extensible Autonomous Transaction Architecture）是一款开源的分布式事务解决方案，旨在解决微服务架构下的分布式事务问题。Seata客户端接入是使用Seata的第一步，它允许你的应用程序与Seata服务器进行通信，从而管理分布式事务。

本文将逐步讲解如何在你的项目中接入Seata客户端，并提供代码示例和实际应用场景。

## 前置条件

在开始之前，请确保你已经完成以下准备工作：

1. 安装并配置了Seata服务器。
2. 你的项目已经使用了Spring Boot或其他支持Seata的框架。

## 配置Seata客户端

### 1. 添加依赖

首先，你需要在项目的`pom.xml`文件中添加Seata客户端的依赖。如果你使用的是Maven，可以添加以下依赖：

```xml
<dependency>
    <groupId>io.seata</groupId>
    <artifactId>seata-spring-boot-starter</artifactId>
    <version>1.4.2</version>
</dependency>
```

### 2. 配置文件

接下来，你需要在`application.yml`或`application.properties`文件中配置Seata客户端。以下是一个典型的配置示例：

```yaml
seata:
  enabled: true
  application-id: your-app-name
  tx-service-group: my_tx_group
  service:
    vgroup-mapping:
      my_tx_group: default
    grouplist:
      default: 127.0.0.1:8091
  registry:
    type: file
    file:
      name: file.conf
```

### 3. 配置数据源代理

为了确保Seata能够管理分布式事务，你需要将数据源代理配置为Seata的`DataSourceProxy`。以下是一个Spring Boot的配置示例：

```java
@Configuration
public class DataSourceConfiguration {

    @Bean
    @ConfigurationProperties(prefix = "spring.datasource")
    public DruidDataSource druidDataSource() {
        return new DruidDataSource();
    }

    @Bean
    public DataSource dataSource(DruidDataSource druidDataSource) {
        return new DataSourceProxy(druidDataSource);
    }
}
```

## 代码示例

### 1. 开启全局事务

在你的业务方法上使用`@GlobalTransactional`注解来开启全局事务。以下是一个简单的示例：

```java
@Service
public class OrderService {

    @Autowired
    private OrderMapper orderMapper;

    @GlobalTransactional
    public void createOrder(Order order) {
        orderMapper.insert(order);
        // 其他业务逻辑
    }
}
```

### 2. 回滚事务

如果事务中的某个操作失败，Seata会自动回滚整个事务。你可以在代码中抛出异常来触发回滚：

```java
@Service
public class OrderService {

    @Autowired
    private OrderMapper orderMapper;

    @GlobalTransactional
    public void createOrder(Order order) {
        orderMapper.insert(order);
        if (order.getAmount() <= 0) {
            throw new RuntimeException("订单金额必须大于0");
        }
    }
}
```

## 实际应用场景

假设你有一个电商系统，用户下单时需要同时更新库存和订单表。如果库存不足或订单创建失败，整个操作需要回滚。使用Seata客户端接入后，你可以轻松管理这种分布式事务。

```java
@Service
public class OrderService {

    @Autowired
    private OrderMapper orderMapper;

    @Autowired
    private InventoryService inventoryService;

    @GlobalTransactional
    public void createOrder(Order order) {
        orderMapper.insert(order);
        inventoryService.decreaseStock(order.getProductId(), order.getQuantity());
    }
}
```

在这个例子中，如果`decreaseStock`方法失败，Seata会自动回滚`orderMapper.insert(order)`操作，确保数据一致性。

## 总结

通过本文，你已经学会了如何在项目中接入Seata客户端，并了解了如何配置和使用Seata来管理分布式事务。Seata客户端接入是使用Seata的第一步，掌握它对于构建可靠的微服务系统至关重要。

## 附加资源

- [Seata官方文档](https://seata.io/zh-cn/docs/overview/what-is-seata.html)
- [Spring Boot集成Seata示例](https://github.com/seata/seata-samples)

## 练习

1. 在你的Spring Boot项目中接入Seata客户端，并尝试创建一个简单的分布式事务。
2. 修改代码，模拟事务失败的情况，观察Seata的回滚机制。
