---
title: Seata AT数据库支持
description: 了解Seata AT模式中支持的数据库类型及其工作原理，帮助初学者掌握分布式事务的实现。
---

# Seata AT数据库支持

Seata AT（Automatic Transaction）模式是Seata框架中的一种分布式事务解决方案，它通过自动补偿机制实现事务的一致性。在Seata AT模式中，数据库的支持是实现分布式事务的关键。本文将详细介绍Seata AT模式支持的数据库类型及其工作原理，并通过实际案例帮助初学者更好地理解。

## 什么是Seata AT模式？

Seata AT模式是一种基于两阶段提交（2PC）的分布式事务解决方案。它通过在业务代码中自动拦截SQL语句，生成对应的回滚日志，并在事务提交或回滚时自动执行补偿操作，从而保证分布式事务的一致性。

## Seata AT模式支持的数据库

Seata AT模式目前支持以下主流数据库：

- MySQL
- PostgreSQL
- Oracle
- SQL Server
- MariaDB

这些数据库的支持使得Seata AT模式能够在大多数业务场景中应用。

## Seata AT模式的工作原理

Seata AT模式的工作原理可以分为以下几个步骤：

1. **SQL解析**：Seata会拦截业务代码中的SQL语句，并解析出SQL的类型（INSERT、UPDATE、DELETE等）以及操作的表和字段。
2. **生成回滚日志**：在执行SQL之前，Seata会生成对应的回滚日志，记录下SQL执行前的数据状态。
3. **执行SQL**：Seata执行SQL语句，并将结果返回给业务代码。
4. **提交或回滚**：如果事务提交成功，Seata会删除回滚日志；如果事务回滚，Seata会根据回滚日志自动执行补偿操作，恢复数据到执行前的状态。

### 代码示例

以下是一个简单的Seata AT模式的使用示例：

```java
@GlobalTransactional
public void purchase(String userId, String commodityCode, int orderCount) {
    // 扣减库存
    stockService.deduct(commodityCode, orderCount);
    // 创建订单
    orderService.create(userId, commodityCode, orderCount);
}
```

在这个示例中，`@GlobalTransactional`注解标识了一个全局事务。如果`stockService.deduct`或`orderService.create`中的任何一个操作失败，Seata会自动回滚整个事务。

## 实际案例

假设我们有一个电商系统，用户在下单时需要同时扣减库存和创建订单。这两个操作分别由不同的服务处理，并且存储在不同的数据库中。使用Seata AT模式，我们可以确保这两个操作要么同时成功，要么同时失败。

### 案例代码

```java
@GlobalTransactional
public void placeOrder(String userId, String productId, int quantity) {
    // 扣减库存
    inventoryService.decreaseStock(productId, quantity);
    // 创建订单
    orderService.createOrder(userId, productId, quantity);
}
```

在这个案例中，如果`inventoryService.decreaseStock`成功但`orderService.createOrder`失败，Seata会自动回滚`inventoryService.decreaseStock`操作，确保数据的一致性。

## 总结

Seata AT模式通过自动生成回滚日志和执行补偿操作，简化了分布式事务的实现。它支持多种主流数据库，适用于大多数业务场景。通过本文的介绍和示例，初学者可以更好地理解Seata AT模式的工作原理及其在实际中的应用。

## 附加资源

- [Seata官方文档](https://seata.io/zh-cn/docs/overview/what-is-seata.html)
- [分布式事务解决方案比较](https://dzone.com/articles/distributed-transaction-solutions-comparison)

## 练习

1. 尝试在自己的项目中集成Seata AT模式，并实现一个简单的分布式事务。
2. 阅读Seata官方文档，了解其他模式（如TCC、Saga）的工作原理及其适用场景。
