---
title: Seata RM接口定义
description: 了解Seata资源管理器（RM）的接口定义，掌握如何通过RM接口实现分布式事务管理。
---

# Seata RM接口定义

Seata（Simple Extensible Autonomous Transaction Architecture）是一个开源的分布式事务解决方案，旨在简化分布式事务的管理。在Seata的架构中，资源管理器（Resource Manager，简称RM）负责管理本地资源，并与事务协调器（TC）协作，确保分布式事务的一致性。本文将详细介绍Seata RM的接口定义，帮助初学者理解其核心功能和使用方法。

## 什么是Seata RM？

Seata RM是Seata架构中的一个关键组件，负责与本地资源（如数据库）进行交互，并执行事务的提交或回滚操作。RM通过与事务协调器（TC）通信，确保分布式事务的原子性和一致性。

### RM的核心职责

1. **注册分支事务**：在分布式事务开始时，RM需要向TC注册分支事务。
2. **提交或回滚事务**：根据TC的指令，RM负责执行本地事务的提交或回滚操作。
3. **报告事务状态**：RM需要向TC报告本地事务的执行状态。

## Seata RM接口定义

Seata RM的核心接口定义在 `io.seata.rm.datasource.DataSourceProxy` 类中。以下是RM接口的主要方法：

### 1. `branchRegister`

该方法用于向TC注册分支事务。

```java
BranchRegisterResponse branchRegister(BranchRegisterRequest request);
```

**参数**：
- `request`：包含分支事务的注册信息，如事务ID、资源ID等。

**返回值**：
- `BranchRegisterResponse`：包含TC返回的分支事务注册结果。

### 2. `branchReport`

该方法用于向TC报告分支事务的执行状态。

```java
BranchReportResponse branchReport(BranchReportRequest request);
```

**参数**：
- `request`：包含分支事务的状态信息，如事务ID、分支ID、状态等。

**返回值**：
- `BranchReportResponse`：包含TC返回的报告结果。

### 3. `branchCommit`

该方法用于提交分支事务。

```java
BranchCommitResponse branchCommit(BranchCommitRequest request);
```

**参数**：
- `request`：包含分支事务的提交信息，如事务ID、分支ID等。

**返回值**：
- `BranchCommitResponse`：包含TC返回的提交结果。

### 4. `branchRollback`

该方法用于回滚分支事务。

```java
BranchRollbackResponse branchRollback(BranchRollbackRequest request);
```

**参数**：
- `request`：包含分支事务的回滚信息，如事务ID、分支ID等。

**返回值**：
- `BranchRollbackResponse`：包含TC返回的回滚结果。

## 实际案例

假设我们有一个分布式事务场景，涉及两个数据库操作：向用户表插入一条记录，并向订单表插入一条记录。以下是使用Seata RM接口的示例代码：

```java
// 初始化Seata RM
DataSourceProxy dataSourceProxy = new DataSourceProxy(dataSource);

// 注册分支事务
BranchRegisterRequest registerRequest = new BranchRegisterRequest();
registerRequest.setXid("全局事务ID");
registerRequest.setResourceId("资源ID");
BranchRegisterResponse registerResponse = dataSourceProxy.branchRegister(registerRequest);

// 执行本地事务
try {
    // 插入用户表
    userDao.insert(user);
    // 插入订单表
    orderDao.insert(order);

    // 报告事务状态
    BranchReportRequest reportRequest = new BranchReportRequest();
    reportRequest.setXid("全局事务ID");
    reportRequest.setBranchId(registerResponse.getBranchId());
    reportRequest.setStatus(BranchStatus.PhaseOne_Done);
    dataSourceProxy.branchReport(reportRequest);

    // 提交事务
    BranchCommitRequest commitRequest = new BranchCommitRequest();
    commitRequest.setXid("全局事务ID");
    commitRequest.setBranchId(registerResponse.getBranchId());
    dataSourceProxy.branchCommit(commitRequest);
} catch (Exception e) {
    // 回滚事务
    BranchRollbackRequest rollbackRequest = new BranchRollbackRequest();
    rollbackRequest.setXid("全局事务ID");
    rollbackRequest.setBranchId(registerResponse.getBranchId());
    dataSourceProxy.branchRollback(rollbackRequest);
}
```

:::note
在实际应用中，Seata会自动处理大部分事务管理逻辑，开发者只需关注业务代码的实现。
:::

## 总结

Seata RM接口是分布式事务管理中的关键组件，负责与本地资源进行交互，并确保事务的一致性。通过理解RM的核心接口和方法，开发者可以更好地掌握Seata的使用方法，并在实际项目中应用分布式事务解决方案。

### 附加资源

- [Seata官方文档](https://seata.io/zh-cn/docs/overview/what-is-seata.html)
- [Seata GitHub仓库](https://github.com/seata/seata)

### 练习

1. 尝试在本地环境中配置Seata，并使用RM接口实现一个简单的分布式事务。
2. 修改上述示例代码，使其支持多个分支事务的注册和提交。

通过本文的学习，你应该对Seata RM接口有了初步的了解。继续深入学习Seata的其他组件，将有助于你更好地掌握分布式事务的管理。