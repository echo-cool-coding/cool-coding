---
title: RocketMQ ACL权限控制
description: 了解RocketMQ的ACL（Access Control List）权限控制机制，掌握如何通过ACL实现消息队列的安全管理。
---

# RocketMQ ACL权限控制

RocketMQ 是一个分布式消息中间件，广泛应用于大规模分布式系统中。为了确保消息队列的安全性，RocketMQ 提供了 ACL（Access Control List）权限控制机制。通过 ACL，管理员可以精确控制哪些用户或客户端可以访问特定的主题（Topic）或消费者组（Consumer Group），从而防止未经授权的访问。

## 什么是 ACL 权限控制？

ACL 权限控制是一种基于用户身份的访问控制机制。它允许管理员为不同的用户或客户端分配不同的权限，例如：

- **PUB**：允许发布消息到指定的主题。
- **SUB**：允许订阅指定的主题。
- **DENY**：拒绝所有操作。

通过 ACL，RocketMQ 可以实现细粒度的权限管理，确保只有经过授权的用户或客户端才能执行特定的操作。

## 如何配置 ACL？

RocketMQ 的 ACL 配置主要通过 `plain_acl.yml` 文件来实现。以下是一个简单的 ACL 配置示例：

```yaml
globalWhiteRemoteAddresses:
  - 192.168.1.1
  - 192.168.1.2

accounts:
  - accessKey: admin
    secretKey: 123456
    whiteRemoteAddress:
    admin: true
    defaultTopicPerm: PUB|SUB
    defaultGroupPerm: PUB|SUB
    topicPerms:
      - topicA=PUB
      - topicB=SUB
    groupPerms:
      - groupA=PUB
      - groupB=SUB

  - accessKey: user
    secretKey: 654321
    whiteRemoteAddress:
    admin: false
    defaultTopicPerm: DENY
    defaultGroupPerm: DENY
    topicPerms:
      - topicA=SUB
    groupPerms:
      - groupA=SUB
```

### 配置说明

- **globalWhiteRemoteAddresses**：全局白名单，允许指定的 IP 地址访问 RocketMQ。
- **accounts**：用户账户列表，每个账户包含以下字段：
  - **accessKey** 和 **secretKey**：用户的访问密钥和密钥。
  - **whiteRemoteAddress**：用户的白名单 IP 地址。
  - **admin**：是否为管理员账户。
  - **defaultTopicPerm** 和 **defaultGroupPerm**：默认的 Topic 和 Group 权限。
  - **topicPerms** 和 **groupPerms**：针对特定 Topic 和 Group 的权限。

## 实际应用场景

假设我们有一个电商系统，其中包含以下组件：

- **订单服务**：负责创建订单并发布到 `order_topic`。
- **库存服务**：订阅 `order_topic` 并处理库存更新。

为了确保系统的安全性，我们可以通过 ACL 配置来限制不同服务的访问权限：

```yaml
accounts:
  - accessKey: order_service
    secretKey: order123
    whiteRemoteAddress:
    admin: false
    defaultTopicPerm: PUB
    topicPerms:
      - order_topic=PUB

  - accessKey: inventory_service
    secretKey: inventory123
    whiteRemoteAddress:
    admin: false
    defaultTopicPerm: SUB
    topicPerms:
      - order_topic=SUB
```

在这个配置中：

- **order_service** 只能发布消息到 `order_topic`。
- **inventory_service** 只能订阅 `order_topic`。

这样，即使某个服务的密钥泄露，攻击者也无法利用该密钥执行未经授权的操作。

## 总结

RocketMQ 的 ACL 权限控制机制为消息队列的安全性提供了强有力的保障。通过合理的 ACL 配置，管理员可以精确控制不同用户或客户端的访问权限，防止未经授权的操作。

### 附加资源

- [RocketMQ 官方文档](https://rocketmq.apache.org/docs/)
- [RocketMQ ACL 配置指南](https://rocketmq.apache.org/docs/acl-guide/)

### 练习

1. 尝试为你的 RocketMQ 实例配置 ACL，限制某个客户端只能订阅特定的 Topic。
2. 创建一个新的用户账户，并为其分配不同的 Topic 和 Group 权限。

:::tip
在实际生产环境中，建议定期更新 ACL 配置，并确保密钥的安全性。
:::