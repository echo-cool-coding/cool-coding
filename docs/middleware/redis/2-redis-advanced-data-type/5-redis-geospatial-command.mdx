---
title: Redis 地理空间命令
description: 了解Redis中的地理空间数据类型及其相关命令，掌握如何存储和查询地理位置信息。
---

# Redis 地理空间命令

Redis不仅支持字符串、列表、集合等基本数据类型，还提供了强大的地理空间数据类型（Geospatial）。通过地理空间数据类型，你可以存储地理位置信息（如经度和纬度），并执行基于位置的查询操作。本文将详细介绍Redis的地理空间命令及其实际应用。

## 什么是Redis地理空间数据类型？

Redis的地理空间数据类型是基于**有序集合（Sorted Set）**实现的。它允许你存储地理位置信息（经度和纬度），并支持以下操作：

- 添加地理位置信息。
- 计算两个地理位置之间的距离。
- 查找某个位置附近的其他位置。
- 获取某个地理位置的经纬度。

这些功能非常适合需要处理地理位置信息的应用场景，例如附近的人、附近的商家、物流跟踪等。

---

## 地理空间命令详解

### 1. 添加地理位置：`GEOADD`

`GEOADD`命令用于将一个或多个地理位置添加到指定的键中。每个位置需要提供经度（longitude）、纬度（latitude）和成员名称（member）。

**语法：**
```bash
GEOADD key longitude latitude member [longitude latitude member ...]
```

**示例：**
```bash
GEOADD cities 116.397128 39.916527 "Beijing" 121.473701 31.230416 "Shanghai"
```

**输出：**
```bash
(integer) 2
```

:::tip
- 经度的范围是`-180`到`180`，纬度的范围是`-85.05112878`到`85.05112878`。
- 如果成员已经存在，`GEOADD`会更新其位置信息。
:::

---

### 2. 获取地理位置：`GEOPOS`

`GEOPOS`命令用于获取指定成员的经纬度。

**语法：**
```bash
GEOPOS key member [member ...]
```

**示例：**
```bash
GEOPOS cities "Beijing"
```

**输出：**
```bash
1) 1) "116.39712804555892944"
   2) "39.91652675983917893"
```

---

### 3. 计算距离：`GEODIST`

`GEODIST`命令用于计算两个成员之间的地理距离。默认单位是米（m），但也可以指定为千米（km）、英里（mi）或英尺（ft）。

**语法：**
```bash
GEODIST key member1 member2 [unit]
```

**示例：**
```bash
GEODIST cities "Beijing" "Shanghai" km
```

**输出：**
```bash
"1067.6090"
```

:::note
- 如果某个成员不存在，返回`nil`。
- 支持的单位：`m`（米）、`km`（千米）、`mi`（英里）、`ft`（英尺）。
:::

---

### 4. 查找附近的位置：`GEORADIUS` 和 `GEORADIUSBYMEMBER`

#### `GEORADIUS`
`GEORADIUS`命令用于查找以某个经纬度为中心、指定半径范围内的成员。

**语法：**
```bash
GEORADIUS key longitude latitude radius unit [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC]
```

**示例：**
```bash
GEORADIUS cities 116.397128 39.916527 100 km WITHDIST
```

**输出：**
```bash
1) 1) "Beijing"
   2) "0.0000"
```

#### `GEORADIUSBYMEMBER`
`GEORADIUSBYMEMBER`命令与`GEORADIUS`类似，但以某个成员为中心。

**语法：**
```bash
GEORADIUSBYMEMBER key member radius unit [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC]
```

**示例：**
```bash
GEORADIUSBYMEMBER cities "Beijing" 100 km WITHDIST
```

**输出：**
```bash
1) 1) "Beijing"
   2) "0.0000"
```

:::caution
- `GEORADIUS`和`GEORADIUSBYMEMBER`在Redis 6.2.0版本中被标记为弃用，推荐使用`GEOSEARCH`。
:::

---

### 5. 搜索地理位置：`GEOSEARCH`

`GEOSEARCH`是Redis 6.2.0引入的命令，用于替代`GEORADIUS`和`GEORADIUSBYMEMBER`。它支持更灵活的搜索方式。

**语法：**
```bash
GEOSEARCH key [FROMMEMBER member] [FROMLONLAT longitude latitude] [BYRADIUS radius unit] [BYBOX width height unit] [ASC|DESC] [COUNT count] [WITHCOORD] [WITHDIST] [WITHHASH]
```

**示例：**
```bash
GEOSEARCH cities FROMMEMBER "Beijing" BYRADIUS 100 km WITHDIST
```

**输出：**
```bash
1) 1) "Beijing"
   2) "0.0000"
```

---

## 实际应用场景

### 场景1：查找附近的商家
假设你正在开发一个外卖应用，用户需要查找附近的餐厅。你可以使用`GEOSEARCH`命令来实现这一功能。

**步骤：**
1. 使用`GEOADD`将所有餐厅的地理位置存储到Redis中。
2. 当用户查询时，使用`GEOSEARCH`查找用户当前位置附近的餐厅。

### 场景2：物流跟踪
在物流系统中，你可以使用Redis存储配送员的位置信息，并实时计算配送员与目的地之间的距离。

---

## 总结

Redis的地理空间数据类型为处理地理位置信息提供了强大的支持。通过`GEOADD`、`GEOPOS`、`GEODIST`、`GEOSEARCH`等命令，你可以轻松实现基于位置的查询和计算功能。无论是开发附近的人、附近的商家，还是物流跟踪系统，Redis都能满足你的需求。

---

## 附加资源与练习

### 练习
1. 使用`GEOADD`添加5个城市的地理位置。
2. 使用`GEODIST`计算其中两个城市之间的距离。
3. 使用`GEOSEARCH`查找某个城市附近的其他城市。

### 参考文档
- [Redis官方文档 - Geospatial](https://redis.io/commands#geo)
- [Redis地理空间数据类型详解](https://redis.io/topics/data-types#geospatial)