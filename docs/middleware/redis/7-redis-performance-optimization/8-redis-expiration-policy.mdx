---
title: Redis 过期策略
description: 了解Redis的过期策略，掌握如何通过合理设置键的过期时间来优化Redis性能。
---

# Redis 过期策略

Redis是一个高性能的键值存储系统，广泛应用于缓存、消息队列等场景。为了有效管理内存，Redis提供了键的过期功能。本文将详细介绍Redis的过期策略，帮助初学者理解如何通过合理设置键的过期时间来优化Redis性能。

## 什么是Redis过期策略？

Redis允许为键设置过期时间，当键的过期时间到达时，Redis会自动删除该键。这种机制可以帮助我们自动清理不再需要的数据，从而释放内存空间。Redis的过期策略主要包括以下两种：

1. **惰性删除（Lazy Expiration）**：当客户端尝试访问一个键时，Redis会检查该键是否已过期。如果过期，则删除该键并返回空值。
2. **定期删除（Active Expiration）**：Redis会定期随机检查一部分键，删除其中已过期的键。

### 惰性删除

惰性删除是Redis默认的过期策略。它的优点是只有在访问键时才会检查过期时间，因此不会对系统性能造成额外负担。然而，如果大量键已经过期但未被访问，这些键会一直占用内存，直到被访问时才会被删除。

### 定期删除

为了弥补惰性删除的不足，Redis还引入了定期删除策略。Redis会每隔一段时间（默认100毫秒）随机检查一部分键，并删除其中已过期的键。这种方式可以确保即使某些键长时间未被访问，也能被及时清理。

## 如何设置键的过期时间？

在Redis中，可以使用以下命令为键设置过期时间：

- `EXPIRE key seconds`：为键设置过期时间，单位为秒。
- `PEXPIRE key milliseconds`：为键设置过期时间，单位为毫秒。
- `EXPIREAT key timestamp`：为键设置过期时间，使用Unix时间戳（秒）。
- `PEXPIREAT key timestamp`：为键设置过期时间，使用Unix时间戳（毫秒）。

### 示例

假设我们有一个键 `user:1001`，我们希望它在10秒后过期：

```bash
SET user:1001 "John Doe"
EXPIRE user:1001 10
```

10秒后，当我们尝试获取 `user:1001` 时，Redis会返回空值：

```bash
GET user:1001
# 输出: (nil)
```

## 实际应用场景

### 缓存失效

在Web应用中，Redis常用于缓存数据库查询结果。通过为缓存键设置合理的过期时间，可以确保缓存数据不会过时，同时避免内存被无效数据占用。

例如，假设我们缓存了一个热门商品列表，并希望每5分钟更新一次缓存：

```bash
SET product:hotlist "[...]"
EXPIRE product:hotlist 300
```

### 会话管理

在用户会话管理中，Redis可以存储用户的会话信息。通过为会话键设置过期时间，可以自动清理长时间未活动的用户会话，从而节省内存。

例如，假设我们存储了一个用户的会话信息，并希望会话在30分钟后过期：

```bash
SET session:user123 "{...}"
EXPIRE session:user123 1800
```

## 总结

Redis的过期策略是管理内存的重要手段。通过合理设置键的过期时间，可以有效避免内存浪费，提升系统性能。惰性删除和定期删除两种策略相辅相成，确保了过期键的及时清理。

:::tip
在实际应用中，建议根据业务需求合理设置键的过期时间，避免设置过短或过长的过期时间，以免影响系统性能或数据一致性。
:::

## 附加资源

- [Redis官方文档](https://redis.io/documentation)
- [Redis命令参考](https://redis.io/commands)

## 练习

1. 使用 `EXPIRE` 命令为一个键设置过期时间，并观察过期后的行为。
2. 尝试使用 `PEXPIRE` 命令为键设置毫秒级的过期时间，并验证其准确性。
3. 思考在实际项目中，哪些场景适合使用Redis的过期策略，并设计一个简单的缓存方案。