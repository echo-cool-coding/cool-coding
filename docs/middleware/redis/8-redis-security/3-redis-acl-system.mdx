---
title: Redis ACL 系统
description: 了解 Redis 的访问控制列表（ACL）系统，掌握如何通过 ACL 提高 Redis 的安全性。
---

# Redis ACL 系统

Redis 是一个高性能的键值存储系统，广泛应用于缓存、消息队列和数据库等场景。随着 Redis 的使用场景越来越广泛，安全性也成为了一个不可忽视的问题。Redis 6.0 引入了 **ACL（Access Control List）** 系统，允许管理员对用户进行细粒度的权限控制，从而提升 Redis 的安全性。

## 什么是 Redis ACL 系统？

Redis ACL 系统是一种基于用户的权限控制机制，允许管理员为不同的用户分配不同的权限。通过 ACL，管理员可以控制用户能够执行哪些命令、访问哪些键空间，从而减少潜在的安全风险。

### ACL 的核心概念

- **用户（User）**：Redis 中的用户是 ACL 的基本单位，每个用户都有自己的用户名和密码。
- **权限（Permissions）**：权限定义了用户可以执行的操作，例如读取、写入、执行命令等。
- **命令类别（Command Categories）**：Redis 将命令分为不同的类别，例如 `read`、`write`、`admin` 等，管理员可以根据类别分配权限。
- **键模式（Key Patterns）**：管理员可以为用户指定允许访问的键模式，例如 `user:*` 表示允许访问以 `user:` 开头的键。

## 如何使用 Redis ACL

### 1. 创建用户

在 Redis 中，可以使用 `ACL SETUSER` 命令创建用户并分配权限。以下是一个创建用户的示例：

```redis
ACL SETUSER alice on >password +@read -@write ~user:*
```

- `alice` 是用户名。
- `on` 表示启用该用户。
- `>password` 设置用户的密码为 `password`。
- `+@read` 允许用户执行所有读取命令。
- `-@write` 禁止用户执行所有写入命令。
- `~user:*` 允许用户访问以 `user:` 开头的键。

### 2. 查看用户权限

可以使用 `ACL LIST` 命令查看当前所有用户的权限：

```redis
ACL LIST
```

输出示例：

```
1) "user alice on >password ~user:* +@read -@write"
```

### 3. 修改用户权限

可以使用 `ACL SETUSER` 命令修改用户的权限。例如，允许用户 `alice` 执行写入命令：

```redis
ACL SETUSER alice +@write
```

### 4. 删除用户

可以使用 `ACL DELUSER` 命令删除用户：

```redis
ACL DELUSER alice
```

## 实际应用场景

### 场景 1：限制用户访问特定键空间

假设你有一个 Redis 实例，存储了多个应用程序的数据。为了防止不同应用程序之间的数据干扰，你可以为每个应用程序创建一个用户，并限制他们只能访问自己的键空间。

例如，为应用程序 A 创建用户 `app_a`，并限制其只能访问以 `app_a:` 开头的键：

```redis
ACL SETUSER app_a on >app_a_password ~app_a:* +@all
```

### 场景 2：限制用户执行危险命令

某些 Redis 命令（如 `FLUSHALL`、`CONFIG`）可能会对系统造成严重影响。你可以通过 ACL 限制用户执行这些命令。

例如，创建一个只允许读取数据的用户 `readonly_user`：

```redis
ACL SETUSER readonly_user on >readonly_password +@read -@all ~*
```

## 总结

Redis ACL 系统为管理员提供了强大的权限控制能力，能够有效提升 Redis 的安全性。通过合理配置 ACL，管理员可以限制用户的访问范围、控制用户能够执行的命令，从而减少潜在的安全风险。

:::tip 提示
在实际生产环境中，建议为每个应用程序或服务创建独立的用户，并根据最小权限原则分配权限。
:::

## 附加资源

- [Redis 官方文档 - ACL](https://redis.io/topics/acl)
- [Redis 命令参考 - ACL](https://redis.io/commands/acl)

## 练习

1. 创建一个用户 `bob`，允许其执行所有读取命令，但禁止执行写入命令，并限制其只能访问以 `bob:` 开头的键。
2. 使用 `ACL LIST` 命令查看当前所有用户的权限，并验证 `bob` 的权限是否正确配置。
3. 尝试使用 `bob` 用户执行写入命令，观察 Redis 的响应。

通过以上练习，你将更好地理解 Redis ACL 系统的使用方法和实际应用场景。