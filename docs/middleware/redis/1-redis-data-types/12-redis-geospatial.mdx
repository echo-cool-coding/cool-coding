---
title: Redis 地理空间
description: 了解Redis地理空间数据类型及其在实际应用中的使用场景，掌握如何存储和查询地理位置数据。
---

# Redis 地理空间

Redis地理空间（Geospatial）是一种特殊的数据类型，用于存储和操作地理位置数据。它基于经纬度坐标，允许你存储地理位置信息，并执行诸如计算两点之间距离、查找附近位置等操作。地理空间数据类型非常适合用于构建基于位置的服务，如附近的人、附近的商家、配送范围等。

## 地理空间数据类型简介

Redis地理空间数据类型是通过`GEOADD`命令将地理位置数据存储在有序集合（Sorted Set）中实现的。每个地理位置由经度（longitude）、纬度（latitude）和名称（name）组成。Redis使用GeoHash算法将经纬度编码为52位整数，并将其存储在有序集合中。

### 主要命令

以下是Redis地理空间数据类型的主要命令：

- `GEOADD`：添加一个或多个地理位置到指定的键中。
- `GEOPOS`：获取一个或多个地理位置的经纬度。
- `GEODIST`：计算两个地理位置之间的距离。
- `GEORADIUS`：查找指定半径内的地理位置。
- `GEORADIUSBYMEMBER`：查找与指定成员位置在指定半径内的其他成员。

## 代码示例

### 添加地理位置

使用`GEOADD`命令将地理位置添加到Redis中。以下示例添加了三个城市的经纬度：

```bash
GEOADD cities 13.361389 38.115556 "Palermo" 15.087269 37.502669 "Catania"
```

### 获取地理位置

使用`GEOPOS`命令获取指定地理位置的经纬度：

```bash
GEOPOS cities "Palermo"
```

输出：

```bash
1) 1) "13.36138933897018433"
   2) "38.11555639549629859"
```

### 计算距离

使用`GEODIST`命令计算两个地理位置之间的距离。默认单位为米：

```bash
GEODIST cities "Palermo" "Catania"
```

输出：

```bash
"166274.1516"
```

### 查找附近位置

使用`GEORADIUS`命令查找指定半径内的地理位置。以下示例查找距离Palermo 100公里内的城市：

```bash
GEORADIUS cities 13.361389 38.115556 100 km
```

输出：

```bash
1) "Palermo"
2) "Catania"
```

## 实际应用场景

### 附近的人

在社交应用中，可以使用Redis地理空间数据类型实现“附近的人”功能。用户的地理位置被存储在Redis中，系统可以根据用户的位置查找附近的其他用户。

### 配送范围

在配送服务中，可以使用Redis地理空间数据类型确定某个地点是否在配送范围内。商家可以设置配送半径，系统可以快速判断某个地址是否在配送范围内。

### 景点推荐

在旅游应用中，可以使用Redis地理空间数据类型推荐附近的景点。用户的位置被存储在Redis中，系统可以根据用户的位置推荐附近的景点。

## 总结

Redis地理空间数据类型为存储和操作地理位置数据提供了强大的支持。通过`GEOADD`、`GEOPOS`、`GEODIST`、`GEORADIUS`等命令，你可以轻松实现基于位置的服务。无论是社交应用、配送服务还是旅游应用，Redis地理空间数据类型都能帮助你快速构建功能强大的位置服务。

## 附加资源

- [Redis官方文档 - 地理空间](https://redis.io/commands#geo)
- [GeoHash算法详解](https://en.wikipedia.org/wiki/Geohash)

## 练习

1. 使用`GEOADD`命令添加你所在城市的经纬度到Redis中。
2. 使用`GEODIST`命令计算你所在城市与另一个城市之间的距离。
3. 使用`GEORADIUS`命令查找距离你所在城市50公里内的其他城市。
