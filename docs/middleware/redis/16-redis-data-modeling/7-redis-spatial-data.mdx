---
title: Redis 空间数据
description: 了解如何在Redis中存储和查询空间数据，包括地理坐标和范围查询的实际应用。
---

# Redis 空间数据

Redis不仅是一个高性能的键值存储数据库，还支持存储和查询空间数据。空间数据通常指地理坐标（如经度和纬度），Redis通过其**GEO**数据类型和相关命令，使得处理地理位置信息变得非常简单。本文将逐步介绍Redis中的空间数据概念，并通过实际案例展示其应用。

## 什么是Redis空间数据？

Redis空间数据是指存储在Redis中的地理坐标信息。Redis使用**GEO**数据类型来存储这些数据，并提供了一系列命令来执行地理位置的添加、查询和计算。例如，你可以存储城市的地理坐标，并查询某个位置附近的其他城市。

:::note
Redis的GEO数据类型实际上是基于**Sorted Set**（有序集合）实现的。每个地理坐标被编码为一个分数（score），从而支持高效的范围查询。
:::

## 基本命令

以下是Redis中处理空间数据的基本命令：

1. **GEOADD**：将地理位置添加到指定的键中。
2. **GEOPOS**：获取指定地理位置的坐标。
3. **GEODIST**：计算两个地理位置之间的距离。
4. **GEORADIUS**：查询指定半径范围内的地理位置。
5. **GEORADIUSBYMEMBER**：以某个成员为中心，查询指定半径范围内的其他成员。

### 示例：存储和查询地理位置

以下是一个简单的示例，展示如何使用Redis存储和查询地理位置。

```bash
# 添加地理位置
GEOADD cities 13.361389 38.115556 "Palermo" 15.087269 37.502669 "Catania"

# 获取地理位置的坐标
GEOPOS cities "Palermo"

# 计算两个城市之间的距离（单位：米）
GEODIST cities "Palermo" "Catania" m

# 查询距离某个坐标100公里范围内的城市
GEORADIUS cities 15 37 100 km
```

**输出：**

```bash
1) "13.36138933897018433"
2) "38.11555639549629859"

1) "166274.1516"

1) "Catania"
```

## 实际应用场景

### 案例：附近商店查询

假设你正在开发一个应用程序，用户可以通过输入自己的位置，查找附近的商店。Redis的GEO数据类型非常适合这种场景。

1. **存储商店位置**：使用`GEOADD`将商店的地理坐标存储到Redis中。
2. **查询附近商店**：使用`GEORADIUS`或`GEORADIUSBYMEMBER`查询用户位置附近的商店。

```bash
# 添加商店位置
GEOADD stores 13.361389 38.115556 "Store A" 15.087269 37.502669 "Store B"

# 查询距离用户位置50公里范围内的商店
GEORADIUS stores 14 37.5 50 km
```

**输出：**

```bash
1) "Store B"
```

### 案例：计算配送距离

在物流系统中，你可能需要计算两个地点之间的距离，以确定配送路线。Redis的`GEODIST`命令可以帮助你快速计算两个地理坐标之间的距离。

```bash
# 计算两个配送中心之间的距离
GEODIST delivery_centers "Center A" "Center B" km
```

**输出：**

```bash
"120.4567"
```

## 总结

Redis的空间数据功能为处理地理位置信息提供了强大的支持。通过`GEOADD`、`GEOPOS`、`GEODIST`、`GEORADIUS`等命令，你可以轻松地存储、查询和计算地理坐标。无论是附近的商店查询，还是物流配送距离计算，Redis都能高效地满足需求。

:::tip
如果你需要处理更复杂的地理空间查询（如多边形范围查询），可以考虑使用专门的地理空间数据库（如PostGIS），或者结合Redis与其他工具使用。
:::

## 附加资源

- [Redis官方文档 - GEO命令](https://redis.io/commands#geo)
- [Redis地理空间数据教程](https://redislabs.com/redis-best-practices/indexing-patterns/geospatial/)

## 练习

1. 使用`GEOADD`命令添加你所在城市的几个地标坐标。
2. 使用`GEORADIUS`查询距离某个坐标10公里范围内的地标。
3. 使用`GEODIST`计算两个地标之间的距离，并尝试不同的单位（米、千米、英里）。